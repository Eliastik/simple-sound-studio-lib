function e(e,t,n,i){var r,a=arguments.length,s=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,n,s):r(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s}function t(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function n(e,t,n,i){return new(n||(n=Promise))(function(r,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,o)}l((i=i.apply(e,t||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;const i={calcAudioDuration:(e,t)=>{if(e){let n=e.duration+1;return null!=t&&(n/=t),n}return 0},loadAudioBuffer:(e,t)=>n(void 0,void 0,void 0,function*(){const n=yield i.readAsArrayBufferPromisified(t),r=yield e.decodeAudioData(n);return i.decodeBuffer(e,r)}),readAsArrayBufferPromisified:e=>new Promise((t,n)=>{const i=new FileReader;i.onload=e=>{var i;const r=null===(i=null==e?void 0:e.target)||void 0===i?void 0:i.result;r instanceof ArrayBuffer?t(r):n()},e&&i.readAsArrayBuffer(e)}),decodeBuffer:(e,t)=>{if(1==t.numberOfChannels){e.resume();const{duration:n}=t,{sampleRate:i}=e,r=e.createBuffer(2,i*n+2*i,i),a=t.getChannelData(0),s=r.getChannelData(0),o=r.getChannelData(1);for(let e=0;e<a.length;e++)s[e]=a[e],o[e]=a[e];return r}return t},convertAudioBufferToFloat32Array:e=>{const t=[];for(let n=0;n<e.numberOfChannels;n++)t.push(e.getChannelData(n));return t},convertAudioParamToFloat32Array:(e,t)=>{const n=new Float32Array(t);for(let i=0;i<t;i++)n.set([e.value],i);return n},sumAudioBufferChannel:(e,t)=>e.getChannelData(t).reduce((e,t)=>e+t,0),sumAudioBuffer(e){let t=0;for(let n=0;n<e.numberOfChannels;n++)t+=this.sumAudioBufferChannel(e,n);return t},isAudioWorkletCompatible:e=>void 0!==e&&void 0!==e.audioWorklet,isSettingValueValid:e=>!(void 0===e||isNaN(Number(e))||"string"==typeof e&&""===e.trim()),calculateAudioDuration(e,t,n){if(e&&t){const i=this.calcAudioDuration(e,n),r=t.getAddingTime();return r?i+r:i}return 0},forceDownload(e,t){const n=window.document.createElement("a"),i=URL.createObjectURL(e);window.document.body.appendChild(n),n.href=i,n.download=t||"output.wav",n.click(),URL.revokeObjectURL(i),window.document.body.removeChild(n)},clearAudioBuffer(e){if(e)for(let t=0;t<e.numberOfChannels;t++){const n=e.getChannelData(t);for(let e=0;e<n.length;e++)n[e]=0}},floatTo16BitPCM(e,t,n){for(let i=0;i<n.length;i++,t+=2){const r=this.clampFloatValue(n[i]);e.setInt16(t,r<0?32768*r:32767*r,!0)}},convertFloat32Array2Int16(e){const t=new Int16Array(e.length);for(let n=0,i=e.length;n<i;n++){const i=this.clampFloatValue(e[n]);t[n]=Math.round(32767*i)}return t},clampFloatValue:e=>Math.max(-1,Math.min(1,e)),writeStringToDataView(e,t,n){for(let i=0;i<n.length;i++)e.setUint8(t+i,n.charCodeAt(i))},interleaveBuffers(e,t){const n=e.length+t.length;if(0===n)throw new Error("interleaveBuffers: input buffers are empty or invalid");const i=new(0,e.constructor)(n);let r=0,a=0;for(;r<n;)i[r++]=e[a],i[r++]=t[a],a++;return i},getLengthFromBuffers:e=>e?e.reduce((e,t)=>e+t.length,0):0,mergeBuffers(e){const t=this.getLengthFromBuffers(e);if(0===t)throw new Error("mergeTypedArrayBuffers: input buffers are empty or invalid");const n=new(0,e[0].constructor)(t);let i=0;for(const t of e)t?(n.set(t,i),i+=t.length):console.warn("mergeTypedArrayBuffers: undefined buffer has been detected");return n}},r={AudioEncoderManager:Symbol.for("AudioEncoderManager"),AudioEncoders:Symbol.for("AudioEncoders")};var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function s(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var o,l={};
/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0
THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.
See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function c(e){return("object"==typeof e&&null!==e||"function"==typeof e)&&"function"==typeof e.then}function _(e){switch(typeof e){case"string":case"symbol":return e.toString();case"function":return e.name;default:throw new Error(`Unexpected ${typeof e} service id type`)}}!function(){return o||(o=1,function(e){!function(){var t="object"==typeof globalThis?globalThis:"object"==typeof a?a:"object"==typeof self?self:"object"==typeof this?this:function(){try{return Function("return this;")()}catch(e){}}()||function(){try{return(0,eval)("(function() { return this; })()")}catch(e){}}(),n=i(e);function i(e,t){return function(n,i){Object.defineProperty(e,n,{configurable:!0,writable:!0,value:i}),t&&t(n,i)}}void 0!==t.Reflect&&(n=i(t.Reflect,n)),function(e,t){var n=Object.prototype.hasOwnProperty,i="function"==typeof Symbol,r=i&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",a=i&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",s="function"==typeof Object.create,o={__proto__:[]}instanceof Array,l=!s&&!o,c={create:s?function(){return ue(Object.create(null))}:o?function(){return ue({__proto__:null})}:function(){return ue({})},has:l?function(e,t){return n.call(e,t)}:function(e,t){return t in e},get:l?function(e,t){return n.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},_=Object.getPrototypeOf(Function),u="function"==typeof Map&&"function"==typeof Map.prototype.entries?Map:le(),f="function"==typeof Set&&"function"==typeof Set.prototype.entries?Set:ce(),h="function"==typeof WeakMap?WeakMap:_e(),d=i?Symbol.for("@reflect-metadata:registry"):void 0,p=re(),v=ae(p);function m(e,t,n,i){if(V(n)){if(!G(e))throw new TypeError;if(!z(t))throw new TypeError;return E(e,t)}if(!G(e))throw new TypeError;if(!F(t))throw new TypeError;if(!F(i)&&!V(i)&&!D(i))throw new TypeError;return D(i)&&(i=void 0),k(e,t,n=U(n),i)}function b(e,t){function n(n,i){if(!F(n))throw new TypeError;if(!V(i)&&!Z(i))throw new TypeError;O(e,t,n,i)}return n}function g(e,t,n,i){if(!F(n))throw new TypeError;return V(i)||(i=U(i)),O(e,t,n,i)}function y(e,t,n){if(!F(t))throw new TypeError;return V(n)||(n=U(n)),T(e,t,n)}function w(e,t,n){if(!F(t))throw new TypeError;return V(n)||(n=U(n)),I(e,t,n)}function S(e,t,n){if(!F(t))throw new TypeError;return V(n)||(n=U(n)),x(e,t,n)}function A(e,t,n){if(!F(t))throw new TypeError;return V(n)||(n=U(n)),P(e,t,n)}function M(e,t){if(!F(e))throw new TypeError;return V(t)||(t=U(t)),C(e,t)}function B(e,t){if(!F(e))throw new TypeError;return V(t)||(t=U(t)),N(e,t)}function R(e,t,n){if(!F(t))throw new TypeError;if(V(n)||(n=U(n)),!F(t))throw new TypeError;V(n)||(n=U(n));var i=oe(t,n,!1);return!V(i)&&i.OrdinaryDeleteMetadata(e,t,n)}function E(e,t){for(var n=e.length-1;n>=0;--n){var i=(0,e[n])(t);if(!V(i)&&!D(i)){if(!z(i))throw new TypeError;t=i}}return t}function k(e,t,n,i){for(var r=e.length-1;r>=0;--r){var a=(0,e[r])(t,n,i);if(!V(a)&&!D(a)){if(!F(a))throw new TypeError;i=a}}return i}function T(e,t,n){if(I(e,t,n))return!0;var i=ne(t);return!D(i)&&T(e,i,n)}function I(e,t,n){var i=oe(t,n,!1);return!V(i)&&q(i.OrdinaryHasOwnMetadata(e,t,n))}function x(e,t,n){if(I(e,t,n))return P(e,t,n);var i=ne(t);return D(i)?void 0:x(e,i,n)}function P(e,t,n){var i=oe(t,n,!1);if(!V(i))return i.OrdinaryGetOwnMetadata(e,t,n)}function O(e,t,n,i){oe(n,i,!0).OrdinaryDefineOwnMetadata(e,t,n,i)}function C(e,t){var n=N(e,t),i=ne(e);if(null===i)return n;var r=C(i,t);if(r.length<=0)return n;if(n.length<=0)return r;for(var a=new f,s=[],o=0,l=n;o<l.length;o++){var c=l[o];a.has(c)||(a.add(c),s.push(c))}for(var _=0,u=r;_<u.length;_++){c=u[_];a.has(c)||(a.add(c),s.push(c))}return s}function N(e,t){var n=oe(e,t,!1);return n?n.OrdinaryOwnMetadataKeys(e,t):[]}function L(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function V(e){return void 0===e}function D(e){return null===e}function H(e){return"symbol"==typeof e}function F(e){return"object"==typeof e?null!==e:"function"==typeof e}function j(e,t){switch(L(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n="string",i=$(e,r);if(void 0!==i){var a=i.call(e,n);if(F(a))throw new TypeError;return a}return X(e)}function X(e,t){var n,i,r=e.toString;if(K(r)&&!F(i=r.call(e)))return i;if(K(n=e.valueOf)&&!F(i=n.call(e)))return i;throw new TypeError}function q(e){return!!e}function Y(e){return""+e}function U(e){var t=j(e);return H(t)?t:Y(t)}function G(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function K(e){return"function"==typeof e}function z(e){return"function"==typeof e}function Z(e){switch(L(e)){case 3:case 4:return!0;default:return!1}}function W(e,t){return e===t||e!=e&&t!=t}function $(e,t){var n=e[t];if(null!=n){if(!K(n))throw new TypeError;return n}}function Q(e){var t=$(e,a);if(!K(t))throw new TypeError;var n=t.call(e);if(!F(n))throw new TypeError;return n}function J(e){return e.value}function ee(e){var t=e.next();return!t.done&&t}function te(e){var t=e.return;t&&t.call(e)}function ne(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===_)return t;if(t!==_)return t;var n=e.prototype,i=n&&Object.getPrototypeOf(n);if(null==i||i===Object.prototype)return t;var r=i.constructor;return"function"!=typeof r||r===e?t:r}function ie(){var e,n,i,r;V(d)||void 0===t.Reflect||d in t.Reflect||"function"!=typeof t.Reflect.defineMetadata||(e=se(t.Reflect));var a=new h,s={registerProvider:o,getProvider:c,setProvider:p};return s;function o(t){if(!Object.isExtensible(s))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===t:break;case V(n):n=t;break;case n===t:break;case V(i):i=t;break;case i===t:break;default:void 0===r&&(r=new f),r.add(t)}}function l(t,a){if(!V(n)){if(n.isProviderFor(t,a))return n;if(!V(i)){if(i.isProviderFor(t,a))return n;if(!V(r))for(var s=Q(r);;){var o=ee(s);if(!o)return;var l=J(o);if(l.isProviderFor(t,a))return te(s),l}}}if(!V(e)&&e.isProviderFor(t,a))return e}function c(e,t){var n,i=a.get(e);return V(i)||(n=i.get(t)),V(n)?(V(n=l(e,t))||(V(i)&&(i=new u,a.set(e,i)),i.set(t,n)),n):n}function _(e){if(V(e))throw new TypeError;return n===e||i===e||!V(r)&&r.has(e)}function p(e,t,n){if(!_(n))throw new Error("Metadata provider not registered.");var i=c(e,t);if(i!==n){if(!V(i))return!1;var r=a.get(e);V(r)&&(r=new u,a.set(e,r)),r.set(t,n)}return!0}}function re(){var e;return!V(d)&&F(t.Reflect)&&Object.isExtensible(t.Reflect)&&(e=t.Reflect[d]),V(e)&&(e=ie()),!V(d)&&F(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,d,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}function ae(e){var t=new h,n={isProviderFor:function(e,n){var i=t.get(e);return!V(i)&&i.has(n)},OrdinaryDefineOwnMetadata:s,OrdinaryHasOwnMetadata:r,OrdinaryGetOwnMetadata:a,OrdinaryOwnMetadataKeys:o,OrdinaryDeleteMetadata:l};return p.registerProvider(n),n;function i(i,r,a){var s=t.get(i),o=!1;if(V(s)){if(!a)return;s=new u,t.set(i,s),o=!0}var l=s.get(r);if(V(l)){if(!a)return;if(l=new u,s.set(r,l),!e.setProvider(i,r,n))throw s.delete(r),o&&t.delete(i),new Error("Wrong provider for target.")}return l}function r(e,t,n){var r=i(t,n,!1);return!V(r)&&q(r.has(e))}function a(e,t,n){var r=i(t,n,!1);if(!V(r))return r.get(e)}function s(e,t,n,r){i(n,r,!0).set(e,t)}function o(e,t){var n=[],r=i(e,t,!1);if(V(r))return n;for(var a=Q(r.keys()),s=0;;){var o=ee(a);if(!o)return n.length=s,n;var l=J(o);try{n[s]=l}catch(e){try{te(a)}finally{throw e}}s++}}function l(e,n,r){var a=i(n,r,!1);if(V(a))return!1;if(!a.delete(e))return!1;if(0===a.size){var s=t.get(n);V(s)||(s.delete(r),0===s.size&&t.delete(s))}return!0}}function se(e){var t=e.defineMetadata,n=e.hasOwnMetadata,i=e.getOwnMetadata,r=e.getOwnMetadataKeys,a=e.deleteMetadata,s=new h,o={isProviderFor:function(e,t){var n=s.get(e);return!(V(n)||!n.has(t))||!!r(e,t).length&&(V(n)&&(n=new f,s.set(e,n)),n.add(t),!0)},OrdinaryDefineOwnMetadata:t,OrdinaryHasOwnMetadata:n,OrdinaryGetOwnMetadata:i,OrdinaryOwnMetadataKeys:r,OrdinaryDeleteMetadata:a};return o}function oe(e,t,n){var i=p.getProvider(e,t);if(!V(i))return i;if(n){if(p.setProvider(e,t,v))return v;throw new Error("Illegal state.")}}function le(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[a]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}(),i=function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var i=this._keys.length,r=n+1;r<i;r++)this._keys[r-1]=this._keys[r],this._values[r-1]=this._values[r];return this._keys.length--,this._values.length--,W(t,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,s)},t.prototype.entries=function(){return new n(this._keys,this._values,o)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[a]=function(){return this.entries()},t.prototype._find=function(e,t){if(!W(this._cacheKey,e)){this._cacheIndex=-1;for(var n=0;n<this._keys.length;n++)if(W(this._keys[n],e)){this._cacheIndex=n;break}}return this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();return i;function r(e,t){return e}function s(e,t){return t}function o(e,t){return[e,t]}}function ce(){return function(){function e(){this._map=new u}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.keys()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[a]=function(){return this.keys()},e}()}function _e(){var e=16,t=c.create(),i=r();return function(){function e(){this._key=r()}return e.prototype.has=function(e){var t=a(e,!1);return void 0!==t&&c.has(t,this._key)},e.prototype.get=function(e){var t=a(e,!1);return void 0!==t?c.get(t,this._key):void 0},e.prototype.set=function(e,t){return a(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=a(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=r()},e}();function r(){var e;do{e="@@WeakMap@@"+l()}while(c.has(t,e));return t[e]=!0,e}function a(e,t){if(!n.call(e,i)){if(!t)return;Object.defineProperty(e,i,{value:c.create()})}return e[i]}function s(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function o(e){if("function"==typeof Uint8Array){var t=new Uint8Array(e);return"undefined"!=typeof crypto?crypto.getRandomValues(t):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(t):s(t,e),t}return s(new Array(e),e)}function l(){var t=o(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",i=0;i<e;++i){var r=t[i];4!==i&&6!==i&&8!==i||(n+="-"),r<16&&(n+="0"),n+=r.toString(16).toLowerCase()}return n}}function ue(e){return e.__=void 0,delete e.__,e}e("decorate",m),e("metadata",b),e("defineMetadata",g),e("hasMetadata",y),e("hasOwnMetadata",w),e("getMetadata",S),e("getOwnMetadata",A),e("getMetadataKeys",M),e("getOwnMetadataKeys",B),e("deleteMetadata",R)}(n,t),void 0===t.Reflect&&(t.Reflect=e)}()}(e||(e={}))),l;var e}();const u=Symbol.for("@inversifyjs/common/islazyServiceIdentifier");class f{[u];#e;constructor(e){this.#e=e,this[u]=!0}static is(e){return"object"==typeof e&&null!==e&&!0===e[u]}unwrap(){return this.#e()}}function h(e,t,n){return Reflect.getOwnMetadata(t,e,n)}function d(e,t,n,i){Reflect.defineMetadata(t,n,e,i)}function p(e,t,n,i,r){const a=i(h(e,t,r)??n());Reflect.defineMetadata(t,a,e,r)}const v="@inversifyjs/container/bindingId";function m(){const e=h(Object,v)??0;return e===Number.MAX_SAFE_INTEGER?d(Object,v,Number.MIN_SAFE_INTEGER):p(Object,v,()=>e,e=>e+1),e}const b="Request",g="Singleton",y="Transient",w="ConstantValue",S="DynamicValue",A="Factory",M="Instance",B="Provider",R="ResolvedValue",E="ServiceRedirection";function*k(...e){for(const t of e)yield*t}class T{#e;#t;#n;constructor(e){this.#e=new Map,this.#t={};for(const t of Reflect.ownKeys(e))this.#t[t]=new Map;this.#n=e}add(e,t){this.#i(e).push(t);for(const n of Reflect.ownKeys(t))this.#r(n,t[n]).push(e)}clone(){const e=this.#a(),t=this.#s(),n=Reflect.ownKeys(this.#n),i=this._buildNewInstance(this.#n);this.#o(this.#e,i.#e,e,t);for(const t of n)this.#l(this.#t[t],i.#t[t],e);return i}get(e,t){return this.#t[e].get(t)}getAllKeys(e){return this.#t[e].keys()}removeByRelation(e,t){const n=this.get(e,t);if(void 0===n)return;const i=new Set(n);for(const n of i){const i=this.#e.get(n);if(void 0===i)throw new Error("Expecting model relation, none found");for(const r of i)r[e]===t&&this.#c(n,r);this.#e.delete(n)}}_buildNewInstance(e){return new T(e)}_cloneModel(e){return e}_cloneRelation(e){return e}#a(){const e=new Map;for(const t of this.#e.keys()){const n=this._cloneModel(t);e.set(t,n)}return e}#s(){const e=new Map;for(const t of this.#e.values())for(const n of t){const t=this._cloneRelation(n);e.set(n,t)}return e}#i(e){let t=this.#e.get(e);return void 0===t&&(t=[],this.#e.set(e,t)),t}#r(e,t){let n=this.#t[e].get(t);return void 0===n&&(n=[],this.#t[e].set(t,n)),n}#_(e,t){const n=t.get(e);if(void 0===n)throw new Error("Expecting model to be cloned, none found");return n}#u(e,t){const n=t.get(e);if(void 0===n)throw new Error("Expecting relation to be cloned, none found");return n}#l(e,t,n){for(const[i,r]of e){const e=new Array;for(const t of r)e.push(this.#_(t,n));t.set(i,e)}}#o(e,t,n,i){for(const[r,a]of e){const e=new Array;for(const t of a)e.push(this.#u(t,i));t.set(this.#_(r,n),e)}}#c(e,t){for(const n of Reflect.ownKeys(t))this.#f(e,n,t[n])}#f(e,t,n){const i=this.#t[t].get(n);if(void 0!==i){const r=i.indexOf(e);-1!==r&&i.splice(r,1),0===i.length&&this.#t[t].delete(n)}}}var I;!function(e){e.moduleId="moduleId",e.serviceId="serviceId"}(I||(I={}));class x{#h;#d;constructor(e,t){this.#h=t??new T({moduleId:{isOptional:!0},serviceId:{isOptional:!1}}),this.#d=e}static build(e){return new x(e)}add(e,t){this.#h.add(e,t)}clone(){return new x(this.#d,this.#h.clone())}get(e){const t=[],n=this.#h.get(I.serviceId,e);void 0!==n&&t.push(n);const i=this.#d()?.get(e);if(void 0!==i&&t.push(i),0!==t.length)return k(...t)}removeAllByModuleId(e){this.#h.removeByRelation(I.moduleId,e)}removeAllByServiceId(e){this.#h.removeByRelation(I.serviceId,e)}}const P="@inversifyjs/core/classMetadataReflectKey";function O(){return{constructorArguments:[],lifecycle:{postConstructMethodNames:new Set,preDestroyMethodNames:new Set},properties:new Map,scope:void 0}}const C="@inversifyjs/core/pendingClassMetadataCountReflectKey",N=Symbol.for("@inversifyjs/core/InversifyCoreError");class L extends Error{[N];kind;constructor(e,t,n){super(t,n),this[N]=!0,this.kind=e}static is(e){return"object"==typeof e&&null!==e&&!0===e[N]}static isErrorOfKind(e,t){return L.is(e)&&e.kind===t}}var V,D,H,F,j;function X(e){const t=h(e,P)??O();if(!function(e){const t=h(e,C);return void 0!==t&&0!==t}(e))return function(e,t){const n=[];if(t.length<e.length)throw new L(V.missingInjectionDecorator,`Found unexpected missing metadata on type "${e.name}". "${e.name}" constructor requires at least ${e.length.toString()} arguments, found ${t.length.toString()} instead.\nAre you using @inject, @multiInject or @unmanaged decorators in every non optional constructor argument?\n\nIf you're using typescript and want to rely on auto injection, set "emitDecoratorMetadata" compiler option to true`);for(let e=0;e<t.length;++e)void 0===t[e]&&n.push(e);if(n.length>0)throw new L(V.missingInjectionDecorator,`Found unexpected missing metadata on type "${e.name}" at constructor indexes "${n.join('", "')}".\n\nAre you using @inject, @multiInject or @unmanaged decorators at those indexes?\n\nIf you're using typescript and want to rely on auto injection, set "emitDecoratorMetadata" compiler option to true`)}(e,t.constructorArguments),t;!function(e,t){const n=[];for(let i=0;i<t.constructorArguments.length;++i){const r=t.constructorArguments[i];void 0!==r&&r.kind!==D.unknown||n.push(`  - Missing or incomplete metadata for type "${e.name}" at constructor argument with index ${i.toString()}.\nEvery constructor parameter must be decorated either with @inject, @multiInject or @unmanaged decorator.`)}for(const[i,r]of t.properties)r.kind===D.unknown&&n.push(`  - Missing or incomplete metadata for type "${e.name}" at property "${i.toString()}".\nThis property must be decorated either with @inject or @multiInject decorator.`);if(0===n.length)throw new L(V.unknown,`Unexpected class metadata for type "${e.name}" with uncompletion traces.\nThis might be caused by one of the following reasons:\n\n1. A third party library is targeting inversify reflection metadata.\n2. A bug is causing the issue. Consider submiting an issue to fix it.`);throw new L(V.missingInjectionDecorator,`Invalid class metadata at type ${e.name}:\n\n${n.join("\n\n")}`)}(e,t)}function q(e,t){const n=X(t).scope??e.scope;return{cache:{isRight:!1,value:void 0},id:m(),implementationType:t,isSatisfiedBy:()=>!0,moduleId:void 0,onActivation:void 0,onDeactivation:void 0,scope:n,serviceIdentifier:t,type:M}}function Y(e){return e.isRight?{isRight:!0,value:e.value}:e}!function(e){e[e.injectionDecoratorConflict=0]="injectionDecoratorConflict",e[e.missingInjectionDecorator=1]="missingInjectionDecorator",e[e.planning=2]="planning",e[e.resolution=3]="resolution",e[e.unknown=4]="unknown"}(V||(V={})),function(e){e[e.unknown=32]="unknown"}(D||(D={})),function(e){e.id="id",e.moduleId="moduleId",e.serviceId="serviceId"}(H||(H={}));let U=class e extends T{_buildNewInstance(t){return new e(t)}_cloneModel(e){return function(e){switch(e.type){case w:case S:return function(e){return{cache:Y(e.cache),id:e.id,isSatisfiedBy:e.isSatisfiedBy,moduleId:e.moduleId,onActivation:e.onActivation,onDeactivation:e.onDeactivation,scope:e.scope,serviceIdentifier:e.serviceIdentifier,type:e.type,value:e.value}}(e);case A:return function(e){return{cache:Y(e.cache),factory:e.factory,id:e.id,isSatisfiedBy:e.isSatisfiedBy,moduleId:e.moduleId,onActivation:e.onActivation,onDeactivation:e.onDeactivation,scope:e.scope,serviceIdentifier:e.serviceIdentifier,type:e.type}}(e);case M:return function(e){return{cache:Y(e.cache),id:e.id,implementationType:e.implementationType,isSatisfiedBy:e.isSatisfiedBy,moduleId:e.moduleId,onActivation:e.onActivation,onDeactivation:e.onDeactivation,scope:e.scope,serviceIdentifier:e.serviceIdentifier,type:e.type}}(e);case B:return function(e){return{cache:Y(e.cache),id:e.id,isSatisfiedBy:e.isSatisfiedBy,moduleId:e.moduleId,onActivation:e.onActivation,onDeactivation:e.onDeactivation,provider:e.provider,scope:e.scope,serviceIdentifier:e.serviceIdentifier,type:e.type}}(e);case R:return function(e){return{cache:Y(e.cache),factory:e.factory,id:e.id,isSatisfiedBy:e.isSatisfiedBy,metadata:e.metadata,moduleId:e.moduleId,onActivation:e.onActivation,onDeactivation:e.onDeactivation,scope:e.scope,serviceIdentifier:e.serviceIdentifier,type:e.type}}(e);case E:return function(e){return{id:e.id,isSatisfiedBy:e.isSatisfiedBy,moduleId:e.moduleId,serviceIdentifier:e.serviceIdentifier,targetServiceIdentifier:e.targetServiceIdentifier,type:e.type}}(e)}}(e)}},G=class e{#p;#v;#d;constructor(e,t,n){this.#v=n??new U({id:{isOptional:!1},moduleId:{isOptional:!0},serviceId:{isOptional:!1}}),this.#d=e,this.#p=t}static build(t,n){return new e(t,n)}clone(){return new e(this.#d,this.#p,this.#v.clone())}get(e){const t=this.getNonParentBindings(e)??this.#d()?.get(e);if(void 0!==t)return t;const n=this.#m(e);return void 0===n?n:[n]}*getChained(e){const t=this.getNonParentBindings(e);void 0!==t&&(yield*t);const n=this.#d();if(void 0===n){if(void 0===t){const t=this.#m(e);void 0!==t&&(yield t)}}else yield*n.getChained(e)}getBoundServices(){const e=new Set(this.#v.getAllKeys(H.serviceId)),t=this.#d();if(void 0!==t)for(const n of t.getBoundServices())e.add(n);return e}getById(e){return this.#v.get(H.id,e)??this.#d()?.getById(e)}getByModuleId(e){return this.#v.get(H.moduleId,e)??this.#d()?.getByModuleId(e)}getNonParentBindings(e){return this.#v.get(H.serviceId,e)}getNonParentBoundServices(){return this.#v.getAllKeys(H.serviceId)}removeById(e){this.#v.removeByRelation(H.id,e)}removeAllByModuleId(e){this.#v.removeByRelation(H.moduleId,e)}removeAllByServiceId(e){this.#v.removeByRelation(H.serviceId,e)}set(e){const t={[H.id]:e.id,[H.serviceId]:e.serviceIdentifier};void 0!==e.moduleId&&(t[H.moduleId]=e.moduleId),this.#v.add(e,t)}#m(e){if(void 0===this.#p||"function"!=typeof e)return;const t=q(this.#p,e);return this.set(t),t}};!function(e){e.moduleId="moduleId",e.serviceId="serviceId"}(F||(F={}));let K=class e{#b;#d;constructor(e,t){this.#b=t??new T({moduleId:{isOptional:!0},serviceId:{isOptional:!1}}),this.#d=e}static build(t){return new e(t)}add(e,t){this.#b.add(e,t)}clone(){return new e(this.#d,this.#b.clone())}get(e){const t=[],n=this.#b.get(F.serviceId,e);void 0!==n&&t.push(n);const i=this.#d()?.get(e);if(void 0!==i&&t.push(i),0!==t.length)return k(...t)}removeAllByModuleId(e){this.#b.removeByRelation(F.moduleId,e)}removeAllByServiceId(e){this.#b.removeByRelation(F.serviceId,e)}};function z(){return 0}function Z(e){return t=>{void 0!==t&&t.kind===D.unknown&&p(e,C,z,e=>e-1)}}!function(e){e[e.multipleInjection=0]="multipleInjection",e[e.singleInjection=1]="singleInjection",e[e.unmanaged=2]="unmanaged"}(j||(j={}));const W=function(e,t){return(...n)=>i=>{if(void 0===i)return e(...n);if(i.kind===j.unmanaged)throw new L(V.injectionDecoratorConflict,"Unexpected injection found. Multiple @inject, @multiInject or @unmanaged decorators found");return t(i,...n)}}(function(e,t,n){return e===j.multipleInjection?{chained:n?.chained??!1,kind:e,name:void 0,optional:!1,tags:new Map,value:t}:{kind:e,name:void 0,optional:!1,tags:new Map,value:t}},function(e,t,n,i){return function(e){if(e.kind!==D.unknown&&!0!==e.isFromTypescriptParamType)throw new L(V.injectionDecoratorConflict,"Unexpected injection found. Multiple @inject, @multiInject or @unmanaged decorators found")}(e),t===j.multipleInjection?{...e,chained:i?.chained??!1,kind:t,value:n}:{...e,kind:t,value:n}});function $(e,t){return n=>{const i=n.properties.get(t);return n.properties.set(t,e(i)),n}}var Q;function J(e,t,n,i){if(L.isErrorOfKind(i,V.injectionDecoratorConflict)){const r=function(e,t,n){if(void 0===n){if(void 0===t)throw new L(V.unknown,"Unexpected undefined property and index values");return{kind:Q.property,property:t,targetClass:e.constructor}}return"number"==typeof n?{index:n,kind:Q.parameter,targetClass:e}:{kind:Q.method,method:t,targetClass:e}}(e,t,n);throw new L(V.injectionDecoratorConflict,`Unexpected injection error.\n\nCause:\n\n${i.message}\n\nDetails\n\n${function(e){switch(e.kind){case Q.method:return`[class: "${e.targetClass.name}", method: "${e.method.toString()}"]`;case Q.parameter:return`[class: "${e.targetClass.name}", index: "${e.index.toString()}"]`;case Q.property:return`[class: "${e.targetClass.name}", property: "${e.property.toString()}"]`}}(r)}`,{cause:i})}throw i}function ee(e,t){return n=>{const i=t(n);return t=>(i(t),e(t))}}!function(e){e[e.method=0]="method",e[e.parameter=1]="parameter",e[e.property=2]="property"}(Q||(Q={}));const te="@inversifyjs/core/classIsInjectableFlagReflectKey",ne=[Array,BigInt,Boolean,Function,Number,Object,String];function ie(e){return e=>{!function(e){if(void 0!==h(e,te))throw new L(V.injectionDecoratorConflict,`Cannot apply @injectable decorator multiple times at class "${e.name}"`);d(e,te,!0)}(e),function(e){const t=h(e,"design:paramtypes");void 0!==t&&p(e,P,O,function(e){return t=>(e.forEach((e,n)=>{var i;void 0!==t.constructorArguments[n]||(i=e,ne.includes(i))||(t.constructorArguments[n]=function(e){return{isFromTypescriptParamType:!0,kind:j.singleInjection,name:void 0,optional:!1,tags:new Map,value:e}}(e))}),t)}(t))}(e)}}var re;function ae(e){return e instanceof Error&&(e instanceof RangeError&&/stack space|call stack|too much recursion/i.test(e.message)||"InternalError"===e.name&&/too much recursion/.test(e.message))}!function(e){e[e.multipleInjection=0]="multipleInjection",e[e.singleInjection=1]="singleInjection"}(re||(re={}));const se=Symbol.for("@inversifyjs/core/LazyPlanServiceNode");class oe{[se];_serviceIdentifier;_serviceNode;constructor(e,t){this[se]=!0,this._serviceNode=e,this._serviceIdentifier=t}get bindings(){return this._getNode().bindings}get isContextFree(){return this._getNode().isContextFree}get serviceIdentifier(){return this._serviceIdentifier}set bindings(e){this._getNode().bindings=e}set isContextFree(e){this._getNode().isContextFree=e}static is(e){return"object"==typeof e&&null!==e&&!0===e[se]}invalidate(){this._serviceNode=void 0}isExpanded(){return void 0!==this._serviceNode}_getNode(){return void 0===this._serviceNode&&(this._serviceNode=this._buildPlanServiceNode()),this._serviceNode}}class le{#g;constructor(e){this.#g=e}get name(){return this.#g.elem.name}get serviceIdentifier(){return this.#g.elem.serviceIdentifier}get tags(){return this.#g.elem.tags}getAncestor(){if(this.#g.elem.getAncestorsCalled=!0,void 0!==this.#g.previous)return new le(this.#g.previous)}}function ce(e,t,n){const i=n?.customServiceIdentifier??t.serviceIdentifier,r=(!0===n?.chained?[...e.operations.getBindingsChained(i)]:[...e.operations.getBindings(i)??[]]).filter(e=>e.isSatisfiedBy(t));if(0===r.length&&void 0!==e.autobindOptions&&"function"==typeof i){const n=q(e.autobindOptions,i);e.operations.setBinding(n),n.isSatisfiedBy(t)&&r.push(n)}return r}class _e{last;constructor(e){this.last=e}concat(e){return new _e({elem:e,previous:this.last})}[Symbol.iterator](){let e=this.last;return{next:()=>{if(void 0===e)return{done:!0,value:void 0};const t=e.elem;return e=e.previous,{done:!1,value:t}}}}}function ue(e){const t=new Map;return void 0!==e.rootConstraints.tag&&t.set(e.rootConstraints.tag.key,e.rootConstraints.tag.value),new _e({elem:{getAncestorsCalled:!1,name:e.rootConstraints.name,serviceIdentifier:e.rootConstraints.serviceIdentifier,tags:t},previous:void 0})}function fe(e){return void 0!==e.redirections}function he(e,t,n,i){const r=n.elem.serviceIdentifier,a=n.previous?.elem.serviceIdentifier;Array.isArray(e)?function(e,t,n,i,r,a){if(0!==e.length){const t=`Ambiguous bindings found for service: "${_(a[a.length-1]??n)}".${me(a)}\n\nRegistered bindings:\n\n${e.map(e=>function(e){switch(e.type){case M:return`[ type: "${e.type}", serviceIdentifier: "${_(e.serviceIdentifier)}", scope: "${e.scope}", implementationType: "${e.implementationType.name}" ]`;case E:return`[ type: "${e.type}", serviceIdentifier: "${_(e.serviceIdentifier)}", redirection: "${_(e.targetServiceIdentifier)}" ]`;default:return`[ type: "${e.type}", serviceIdentifier: "${_(e.serviceIdentifier)}", scope: "${e.scope}" ]`}}(e.binding)).join("\n")}\n\nTrying to resolve bindings for "${pe(n,i)}".${ve(r)}`;throw new L(V.planning,t)}t||de(n,i,r,a)}(e,t,r,a,n.elem,i):function(e,t,n,i,r,a){void 0!==e||t||de(n,i,r,a)}(e,t,r,a,n.elem,i)}function de(e,t,n,i){const r=`No bindings found for service: "${_(i[i.length-1]??e)}".\n\nTrying to resolve bindings for "${pe(e,t)}".${me(i)}${ve(n)}`;throw new L(V.planning,r)}function pe(e,t){return void 0===t?`${_(e)} (Root service)`:_(t)}function ve(e){const t=0===e.tags.size?"":`\n- tags:\n  - ${[...e.tags.keys()].map(e=>e.toString()).join("\n  - ")}`;return`\n\nBinding constraints:\n- service identifier: ${_(e.serviceIdentifier)}\n- name: ${e.name?.toString()??"-"}${t}`}function me(e){return 0===e.length?"":`\n\n- service redirections:\n  - ${e.map(e=>_(e)).join("\n  - ")}`}function be(e,t,n,i){if(1===e.redirections.length){const[r]=e.redirections;return void(fe(r)&&be(r,t,n,[...i,r.binding.targetServiceIdentifier]))}he(e.redirections,t,n,i)}function ge(e,t,n){if(Array.isArray(e.bindings)&&1===e.bindings.length){const[i]=e.bindings;return void(fe(i)&&be(i,t,n,[i.binding.targetServiceIdentifier]))}he(e.bindings,t,n,[])}function ye(e){return f.is(e)?e.unwrap():e}function we(e){return(t,n,i)=>{const r=ye(i.value),a=n.concat({getAncestorsCalled:!1,name:i.name,serviceIdentifier:r,tags:i.tags}),s=new le(a.last),o=i.kind===j.multipleInjection&&i.chained,l=ce(t,s,{chained:o}),c=[],_={bindings:c,isContextFree:!0,serviceIdentifier:r};if(c.push(...e(t,a,l,_,o)),_.isContextFree=!a.last.elem.getAncestorsCalled,i.kind===j.singleInjection){ge(_,i.optional,a.last);const[e]=c;_.bindings=e}return _}}function Se(e){return(t,n,i)=>{const r=ye(i.value),a=n.concat({getAncestorsCalled:!1,name:i.name,serviceIdentifier:r,tags:i.tags}),s=new le(a.last),o=i.kind===re.multipleInjection&&i.chained,l=ce(t,s,{chained:o}),c=[],_={bindings:c,isContextFree:!0,serviceIdentifier:r};if(c.push(...e(t,a,l,_,o)),_.isContextFree=!a.last.elem.getAncestorsCalled,i.kind===re.singleInjection){ge(_,i.optional,a.last);const[e]=c;_.bindings=e}return _}}function Ae(e){const t=function(e){return(t,n,i)=>{const r={binding:n,classMetadata:t.operations.getClassMetadata(n.implementationType),constructorParams:[],propertyParams:new Map},a={autobindOptions:t.autobindOptions,node:r,operations:t.operations,servicesBranch:t.servicesBranch};return e(a,i)}}(e),n=function(e){return(t,n,i)=>{const r={binding:n,params:[]},a={autobindOptions:t.autobindOptions,node:r,operations:t.operations,servicesBranch:t.servicesBranch};return e(a,i)}}(e),i=(e,i,a,s,o)=>{const l=fe(s)?s.binding.targetServiceIdentifier:s.serviceIdentifier;e.servicesBranch.push(l);const c=[];for(const s of a)switch(s.type){case M:c.push(t(e,s,i));break;case R:c.push(n(e,s,i));break;case E:{const t=r(e,i,s,o);c.push(t);break}default:c.push({binding:s})}return e.servicesBranch.pop(),c},r=function(e){return(t,n,i,r)=>{const a={binding:i,redirections:[]},s=ce(t,new le(n.last),{chained:r,customServiceIdentifier:i.targetServiceIdentifier});return a.redirections.push(...e(t,n,s,a,r)),a}}(i);return i}function Me(e,t,n,i){if(void 0!==e&&(oe.is(n)&&!n.isExpanded()||n.isContextFree)){const i={tree:{root:n}};t.setPlan(e,i)}else t.setNonCachedServiceNode(n,i)}class Be extends oe{#y;#w;#S;#A;constructor(e,t,n,i,r){super(r,ye(i.value)),this.#w=t,this.#y=e,this.#S=n,this.#A=i}_buildPlanServiceNode(){return this.#w(this.#y,this.#S,this.#A)}}class Re extends oe{#y;#M;#S;#B;constructor(e,t,n,i,r){super(r,ye(i.value)),this.#y=e,this.#M=t,this.#S=n,this.#B=i}_buildPlanServiceNode(){return this.#M(this.#y,this.#S,this.#B)}}function Ee(e,t,n,i){const r=function(e,t){const n=function(e,t){return(n,i,r)=>{if(r.kind===j.unmanaged)return;const a=function(e){let t;if(0===e.tags.size)t=void 0;else{if(1!==e.tags.size)return;{const[n,i]=e.tags.entries().next().value;t={key:n,value:i}}}const n=f.is(e.value)?e.value.unwrap():e.value;return e.kind===j.multipleInjection?{chained:e.chained,isMultiple:!0,name:e.name,optional:e.optional,serviceIdentifier:n,tag:t}:{isMultiple:!1,name:e.name,optional:e.optional,serviceIdentifier:n,tag:t}}(r);if(void 0!==a){const e=n.operations.getPlan(a);if(void 0!==e&&e.tree.root.isContextFree)return e.tree.root}const s=t(n,i,r),o=new Be(n,e,i,r,s);return Me(a,n.operations,o,{bindingConstraintsList:i,chainedBindings:r.kind===j.multipleInjection&&r.chained,optionalBindings:r.optional}),o}}(e,t);return(e,t,i)=>{const r=t.classMetadata;for(const[a,s]of r.constructorArguments.entries())t.constructorParams[a]=n(e,i,s);for(const[a,s]of r.properties){const r=n(e,i,s);void 0!==r&&t.propertyParams.set(a,r)}return e.node}}(e,n),a=function(e,t){const n=function(e,t){return(n,i,r)=>{const a=function(e){let t;if(0===e.tags.size)t=void 0;else{if(1!==e.tags.size)return;{const[n,i]=e.tags.entries().next().value;t={key:n,value:i}}}const n=f.is(e.value)?e.value.unwrap():e.value;return e.kind===re.multipleInjection?{chained:e.chained,isMultiple:!0,name:e.name,optional:e.optional,serviceIdentifier:n,tag:t}:{isMultiple:!1,name:e.name,optional:e.optional,serviceIdentifier:n,tag:t}}(r);if(void 0!==a){const e=n.operations.getPlan(a);if(void 0!==e&&e.tree.root.isContextFree)return e.tree.root}const s=t(n,i,r),o=new Re(n,e,i,r,s);return Me(a,n.operations,o,{bindingConstraintsList:i,chainedBindings:r.kind===re.multipleInjection&&r.chained,optionalBindings:r.optional}),o}}(e,t);return(e,t,i)=>{const r=t.binding.metadata;for(const[a,s]of r.arguments.entries())t.params[a]=n(e,i,s);return e.node}}(t,i);return(e,t)=>e.node.binding.type===M?r(e,e.node,t):a(e,e.node,t)}class ke extends oe{#y;constructor(e,t){super(t,t.serviceIdentifier),this.#y=e}_buildPlanServiceNode(){return Oe(this.#y)}}const Te=we(Pe),Ie=Se(Pe),xe=Ae(Ee(Te,Ie,Te,Ie));function Pe(e,t,n,i,r){return xe(e,t,n,i,r)}const Oe=function(e){return t=>{const n=ue(t),i=new le(n.last),r=t.rootConstraints.isMultiple&&t.rootConstraints.chained,a=ce(t,i,{chained:r}),s=[],o={bindings:s,isContextFree:!0,serviceIdentifier:t.rootConstraints.serviceIdentifier};if(s.push(...e(t,n,a,o,r)),o.isContextFree=!n.last.elem.getAncestorsCalled,!t.rootConstraints.isMultiple){ge(o,t.rootConstraints.isOptional??!1,n.last);const[e]=s;o.bindings=e}return o}}(xe);function Ce(e){try{const t=function(e){return e.rootConstraints.isMultiple?{chained:e.rootConstraints.chained,isMultiple:!0,name:e.rootConstraints.name,optional:e.rootConstraints.isOptional??!1,serviceIdentifier:e.rootConstraints.serviceIdentifier,tag:e.rootConstraints.tag}:{isMultiple:!1,name:e.rootConstraints.name,optional:e.rootConstraints.isOptional??!1,serviceIdentifier:e.rootConstraints.serviceIdentifier,tag:e.rootConstraints.tag}}(e),n=e.operations.getPlan(t);if(void 0!==n)return n;const i=Oe(e),r={tree:{root:new ke(e,i)}};return e.operations.setPlan(t,r),r}catch(t){!function(e,t){if(ae(t)){const n=function(e){const t=[...e];return 0===t.length?"(No dependency trace)":t.map(_).join(" -> ")}(function(e){const t=new Set;for(const n of e.servicesBranch){if(t.has(n))return[...t,n];t.add(n)}return[...t]}(e));throw new L(V.planning,`Circular dependency found: ${n}`,{cause:t})}throw t}(e,t)}}var Ne;!function(e){e.bindingAdded="bindingAdded",e.bindingRemoved="bindingRemoved"}(Ne||(Ne={}));class Le{#R;#E;#k;constructor(){this.#R=[],this.#E=8,this.#k=1024}*[Symbol.iterator](){let e=0;for(const t of this.#R){const n=t.deref();void 0===n?++e:yield n}this.#R.length>=this.#E&&this.#T(e)&&this.#I(e)}push(e){const t=new WeakRef(e);if(this.#R.push(t),this.#R.length>=this.#E&&this.#R.length%this.#k===0){let e=0;for(const t of this.#R)void 0===t.deref()&&++e;this.#T(e)&&this.#I(e)}}#I(e){const t=new Array(this.#R.length-e);let n=0;for(const e of this.#R)e.deref()&&(t[n++]=e);this.#R=t}#T(e){return e>=.5*this.#R.length}}const Ve=Ae(Ee(Te,Ie,function(e,t,n){return De(e,t,n)},function(e,t,n){return He(e,t,n)})),De=function(){const e=we(Ve);return(t,n,i)=>{try{return e(t,n,i)}catch(t){if(L.isErrorOfKind(t,V.planning))return;throw t}}}(),He=function(){const e=Se(Ve);return(t,n,i)=>{try{return e(t,n,i)}catch(t){if(L.isErrorOfKind(t,V.planning))return;throw t}}}();function Fe(e,t,n,i,r){if(oe.is(t)&&!t.isExpanded())return{isContextFreeBinding:!0,shouldInvalidateServiceNode:!1};const a=new le(i.last);return!n.isSatisfiedBy(a)||i.last.elem.getAncestorsCalled?{isContextFreeBinding:!i.last.elem.getAncestorsCalled,shouldInvalidateServiceNode:!1}:function(e,t,n,i,r){let a;try{[a]=Ve(e,i,[n],t,r)}catch(e){if(ae(e))return{isContextFreeBinding:!1,shouldInvalidateServiceNode:!0};throw e}return function(e,t){if(Array.isArray(e.bindings))e.bindings.push(t);else{if(void 0!==e.bindings){if(!oe.is(e))throw new L(V.planning,"Unexpected non-lazy plan service node. This is likely a bug in the planning logic. Please, report this issue");return{isContextFreeBinding:!0,shouldInvalidateServiceNode:!0}}e.bindings=t}return{isContextFreeBinding:!0,shouldInvalidateServiceNode:!1}}(t,a)}(e,t,n,i,r)}function je(e,t,n,i){if(oe.is(e)&&!e.isExpanded())return{bindingNodeRemoved:void 0,isContextFreeBinding:!0};const r=new le(n.last);if(!t.isSatisfiedBy(r)||n.last.elem.getAncestorsCalled)return{bindingNodeRemoved:void 0,isContextFreeBinding:!n.last.elem.getAncestorsCalled};let a;if(Array.isArray(e.bindings))e.bindings=e.bindings.filter(e=>e.binding!==t||(a=e,!1));else if(e.bindings?.binding===t)if(a=e.bindings,i)e.bindings=void 0;else{if(!oe.is(e))throw new L(V.planning,"Unexpected non-lazy plan service node. This is likely a bug in the planning logic. Please, report this issue");e.invalidate()}return{bindingNodeRemoved:a,isContextFreeBinding:!0}}class Xe{#x;#P;#O;#C;#N;#L;constructor(){this.#x=new Map,this.#P=this.#V(),this.#O=this.#V(),this.#C=this.#V(),this.#N=this.#V(),this.#L=new Le}clearCache(){for(const e of this.#D())e.clear();for(const e of this.#L)e.clearCache()}get(e){return void 0===e.name?void 0===e.tag?this.#H(this.#P,e).get(e.serviceIdentifier):this.#H(this.#N,e).get(e.serviceIdentifier)?.get(e.tag.key)?.get(e.tag.value):void 0===e.tag?this.#H(this.#O,e).get(e.serviceIdentifier)?.get(e.name):this.#H(this.#C,e).get(e.serviceIdentifier)?.get(e.name)?.get(e.tag.key)?.get(e.tag.value)}invalidateServiceBinding(e){this.#F(e),this.#j(e),this.#X(e),this.#q(e),this.#Y(e);for(const t of this.#L)t.invalidateServiceBinding(e)}set(e,t){void 0===e.name?void 0===e.tag?this.#H(this.#P,e).set(e.serviceIdentifier,t):this.#U(this.#U(this.#H(this.#N,e),e.serviceIdentifier),e.tag.key).set(e.tag.value,t):void 0===e.tag?this.#U(this.#H(this.#O,e),e.serviceIdentifier).set(e.name,t):this.#U(this.#U(this.#U(this.#H(this.#C,e),e.serviceIdentifier),e.name),e.tag.key).set(e.tag.value,t)}setNonCachedServiceNode(e,t){let n=this.#x.get(e.serviceIdentifier);void 0===n&&(n=new Map,this.#x.set(e.serviceIdentifier,n)),n.set(e,t)}subscribe(e){this.#L.push(e)}#V(){const e=new Array(8);for(let t=0;t<e.length;++t)e[t]=new Map;return e}#G(e,t,n,i){const r=!!(2&t);let a;return a=r?{chained:!!(0&t),isMultiple:r,serviceIdentifier:e.binding.serviceIdentifier}:{isMultiple:r,serviceIdentifier:e.binding.serviceIdentifier},!!(1&t)&&(a.isOptional=!0),void 0!==n&&(a.name=n),void 0!==i&&(a.tag=i),{autobindOptions:void 0,operations:e.operations,rootConstraints:a,servicesBranch:[]}}#U(e,t){let n=e.get(t);return void 0===n&&(n=new Map,e.set(t,n)),n}#H(e,t){return e[this.#K(t)]}#D(){return[this.#x,...this.#P,...this.#O,...this.#C,...this.#N]}#K(e){return e.isMultiple?(e.chained?4:0)|(e.optional?1:0)|2:e.optional?1:0}#j(e){for(const[t,n]of this.#O.entries()){const i=n.get(e.binding.serviceIdentifier);if(void 0!==i)for(const[n,r]of i.entries())this.#z(e,r,t,n,void 0)}}#X(e){for(const[t,n]of this.#C.entries()){const i=n.get(e.binding.serviceIdentifier);if(void 0!==i)for(const[n,r]of i.entries())for(const[i,a]of r.entries())for(const[r,s]of a.entries())this.#z(e,s,t,n,{key:i,value:r})}}#Z(e){switch(e.binding.type){case E:for(const t of e.redirections)this.#Z(t);break;case M:for(const t of e.constructorParams)void 0!==t&&this.#W(t);for(const t of e.propertyParams.values())this.#W(t);break;case R:for(const t of e.params)this.#W(t)}}#W(e){const t=this.#x.get(e.serviceIdentifier);void 0!==t&&t.has(e)&&(t.delete(e),this.#$(e))}#$(e){if((!oe.is(e)||e.isExpanded())&&void 0!==e.bindings)if(Array.isArray(e.bindings))for(const t of e.bindings)this.#Z(t);else this.#Z(e.bindings)}#Y(e){const t=this.#x.get(e.binding.serviceIdentifier);if(void 0!==t)switch(e.kind){case Ne.bindingAdded:for(const[n,i]of t){const t=Fe({autobindOptions:void 0,operations:e.operations,servicesBranch:[]},n,e.binding,i.bindingConstraintsList,i.chainedBindings);t.isContextFreeBinding?t.shouldInvalidateServiceNode&&oe.is(n)&&(this.#$(n),n.invalidate()):this.clearCache()}break;case Ne.bindingRemoved:for(const[n,i]of t){const t=je(n,e.binding,i.bindingConstraintsList,i.optionalBindings);t.isContextFreeBinding?void 0!==t.bindingNodeRemoved&&this.#Z(t.bindingNodeRemoved):this.clearCache()}}}#F(e){for(const[t,n]of this.#P.entries()){const i=n.get(e.binding.serviceIdentifier);this.#z(e,i,t,void 0,void 0)}}#q(e){for(const[t,n]of this.#N.entries()){const i=n.get(e.binding.serviceIdentifier);if(void 0!==i)for(const[n,r]of i.entries())for(const[i,a]of r.entries())this.#z(e,a,t,void 0,{key:n,value:i})}}#z(e,t,n,i,r){if(void 0!==t&&oe.is(t.tree.root)){const l=this.#G(e,n,i,r);switch(e.kind){case Ne.bindingAdded:{const n=(a=l,s=t.tree.root,o=e.binding,oe.is(s)&&!s.isExpanded()?{isContextFreeBinding:!0,shouldInvalidateServiceNode:!1}:Fe(a,s,o,ue(a),a.rootConstraints.isMultiple&&a.rootConstraints.chained));n.isContextFreeBinding?n.shouldInvalidateServiceNode&&(this.#$(t.tree.root),t.tree.root.invalidate()):this.clearCache()}break;case Ne.bindingRemoved:{const n=function(e,t,n){return oe.is(t)&&!t.isExpanded()?{bindingNodeRemoved:void 0,isContextFreeBinding:!0}:je(t,n,ue(e),e.rootConstraints.isOptional??!1)}(l,t.tree.root,e.binding);n.isContextFreeBinding?void 0!==n.bindingNodeRemoved&&this.#Z(n.bindingNodeRemoved):this.clearCache()}}}var a,s,o}}function qe(e,t){return c(t)?(e.cache={isRight:!0,value:t},t.then(t=>Ye(e,t))):Ye(e,t)}function Ye(e,t){return e.cache={isRight:!0,value:t},t}async function Ue(e,t,n){let i=await t,r=n.next();for(;!0!==r.done;)i=await r.value(e.context,i),r=n.next();return i}function Ge(e,t,n){let i=n;if(void 0!==t.onActivation){const n=t.onActivation;i=c(i)?i.then(t=>n(e.context,t)):n(e.context,i)}return function(e,t,n){const i=e.getActivations(t);return void 0===i?n:c(n)?Ue(e,n,i[Symbol.iterator]()):function(e,t,n){let i=t,r=n.next();for(;!0!==r.done;){const t=r.value(e.context,i);if(c(t))return Ue(e,t,n);i=t,r=n.next()}return i}(e,n,i[Symbol.iterator]())}(e,t.serviceIdentifier,i)}function Ke(e){return(t,n)=>n.cache.isRight?n.cache.value:qe(n,Ge(t,n,e(t,n)))}const ze=Ke(function(e,t){return t.value});function Ze(e){return e}function We(e,t){return(n,i)=>{const r=e(i);switch(r.scope){case g:return r.cache.isRight?r.cache.value:qe(r,Ge(n,r,t(n,i)));case b:{if(n.requestScopeCache.has(r.id))return n.requestScopeCache.get(r.id);const e=Ge(n,r,t(n,i));return n.requestScopeCache.set(r.id,e),e}case y:return Ge(n,r,t(n,i))}}}const $e=We(Ze,function(e,t){return t.value(e.context)}),Qe=Ke(function(e,t){return t.factory(e.context)});function Je(e,t,n){const i=function(e,t,n){if(!(n in e))throw new L(V.resolution,`Expecting a "${n.toString()}" property when resolving "${t.implementationType.name}" class @postConstruct decorated method, none found.`);if("function"!=typeof e[n])throw new L(V.resolution,`Expecting a "${n.toString()}" method when resolving "${t.implementationType.name}" class @postConstruct decorated method, a non function property was found instead.`);{let i;try{i=e[n]()}catch(e){throw new L(V.resolution,`Unexpected error found when calling "${n.toString()}" @postConstruct decorated method on class "${t.implementationType.name}"`,{cause:e})}if(c(i))return async function(e,t,n){try{await n}catch(n){throw new L(V.resolution,`Unexpected error found when calling "${t.toString()}" @postConstruct decorated method on class "${e.implementationType.name}"`,{cause:n})}}(t,n,i)}}(e,t,n);return c(i)?i.then(()=>e):e}function et(e,t,n){if(0===n.size)return e;let i=e;for(const e of n)i=c(i)?i.then(n=>Je(n,t,e)):Je(i,t,e);return i}function tt(e){return(t,n,i)=>{const r=new i.binding.implementationType(...t),a=e(n,r,i);return c(a)?a.then(()=>et(r,i.binding,i.classMetadata.lifecycle.postConstructMethodNames)):et(r,i.binding,i.classMetadata.lifecycle.postConstructMethodNames)}}const nt=Ke(function(e,t){return t.provider(e.context)});function it(e){return e.binding}function rt(e){return e.binding}const at=(ut=dt,(e,t,n)=>{const i=[];for(const[r,a]of n.propertyParams){const s=n.classMetadata.properties.get(r);if(void 0===s)throw new L(V.resolution,`Expecting metadata at property "${r.toString()}", none found`);s.kind!==j.unmanaged&&void 0!==a.bindings&&(t[r]=ut(e,a),c(t[r])&&i.push((async()=>{t[r]=await t[r]})()))}if(i.length>0)return Promise.all(i).then(()=>{})}),st=function(e){return function t(n,i){const r=[];for(const a of i.redirections)fe(a)?r.push(...t(n,a)):r.push(e(n,a));return r}}(ht),ot=function(e,t,n){return(i,r)=>{const a=e(i,r);return c(a)?t(a,i,r):n(a,i,r)}}(function(e){return(t,n)=>{const i=[];for(const r of n.constructorParams)void 0===r?i.push(void 0):i.push(e(t,r));return i.some(c)?Promise.all(i):i}}(dt),function(e){return async(t,n,i)=>{const r=await t;return e(r,n,i)}}(tt(at)),tt(at)),lt=function(e){return(t,n)=>{const i=e(t,n);return c(i)?i.then(e=>n.binding.factory(...e)):n.binding.factory(...i)}}(function(e){return(t,n)=>{const i=[];for(const r of n.params)i.push(e(t,r));return i.some(c)?Promise.all(i):i}}(dt)),ct=We(it,ot),_t=We(rt,lt);var ut;function ft(e){try{return dt(e,e.planResult.tree.root)}catch(t){!function(e,t){if(ae(t)){const n=function(e){const t=[...e];return 0===t.length?"(No dependency trace)":t.map(_).join(" -> ")}(function(e){const t=e.planResult.tree.root,n=[];return function e(t){const i=n.indexOf(t);if(-1!==i)return[...n.slice(i),t].map(e=>e.serviceIdentifier);n.push(t);try{for(const n of function(e){const t=[],n=e.bindings;if(void 0===n)return t;const i=e=>{if(fe(e))for(const t of e.redirections)i(t);else switch(e.binding.type){case M:{const n=e;for(const e of n.constructorParams)void 0!==e&&t.push(e);for(const e of n.propertyParams.values())t.push(e);break}case R:{const n=e;for(const e of n.params)t.push(e);break}}};if(Array.isArray(n))for(const e of n)i(e);else i(n);return t}(t)){const t=e(n);if(void 0!==t)return t}}finally{n.pop()}}(t)??[]}(e));throw new L(V.planning,`Circular dependency found: ${n}`,{cause:t})}throw t}(e,t)}}function ht(e,t){switch(t.binding.type){case w:return ze(e,t.binding);case S:return $e(e,t.binding);case A:return Qe(e,t.binding);case M:return ct(e,t);case B:return nt(e,t.binding);case R:return _t(e,t)}}function dt(e,t){if(void 0!==t.bindings)return Array.isArray(t.bindings)?function(e,t){const n=[];for(const i of t)fe(i)?n.push(...st(e,i)):n.push(ht(e,i));return n.some(c)?Promise.all(n):n}(e,t.bindings):function(e,t){if(fe(t)){const n=st(e,t);if(1===n.length)return n[0];throw new L(V.resolution,"Unexpected multiple resolved values on single injection")}return ht(e,t)}(e,t.bindings)}function pt(e){return void 0!==e.scope}function vt(e,t){if("function"==typeof e[t])return e[t]()}function mt(e,t){const n=e.lifecycle.preDestroyMethodNames;if(0===n.size)return;let i;for(const e of n)i=void 0===i?vt(t,e):i.then(()=>vt(t,e));return i}function bt(e,t,n){const i=e.getDeactivations(t);if(void 0!==i)return c(n)?gt(n,i[Symbol.iterator]()):function(e,t){let n=t.next();for(;!0!==n.done;){if(c(n.value(e)))return gt(e,t);n=t.next()}}(n,i[Symbol.iterator]())}async function gt(e,t){const n=await e;let i=t.next();for(;!0!==i.done;)await i.value(n),i=t.next()}function yt(e,t){const n=function(e,t){if(t.type===M){const n=e.getClassMetadata(t.implementationType),i=t.cache.value;return c(i)?i.then(e=>mt(n,e)):mt(n,i)}}(e,t);return void 0===n?wt(e,t):n.then(()=>wt(e,t))}function wt(e,t){const n=t.cache;return c(n.value)?n.value.then(n=>St(e,t,n)):St(e,t,n.value)}function St(e,t,n){let i;return void 0!==t.onDeactivation&&(i=(0,t.onDeactivation)(n)),void 0===i?bt(e,t.serviceIdentifier,n):i.then(()=>bt(e,t.serviceIdentifier,n))}function At(e,t){if(void 0===t)return;const n=function(e){const t=[];for(const n of e)pt(n)&&n.scope===g&&n.cache.isRight&&t.push(n);return t}(t),i=[];for(const t of n){const n=yt(e,t);void 0!==n&&i.push(n)}return i.length>0?Promise.all(i).then(()=>{}):void 0}const Mt=Symbol.for("@inversifyjs/plugin/isPlugin"),Bt=Symbol.for("@inversifyjs/container/bindingIdentifier");function Rt(e){return"object"==typeof e&&null!==e&&!0===e[Bt]}class Et{static always=e=>!0}const kt=Symbol.for("@inversifyjs/container/InversifyContainerError");class Tt extends Error{[kt];kind;constructor(e,t,n){super(t,n),this[kt]=!0,this.kind=e}static is(e){return"object"==typeof e&&null!==e&&!0===e[kt]}static isErrorOfKind(e,t){return Tt.is(e)&&e.kind===t}}var It;function xt(e){return{[Bt]:!0,id:e.id}}function Pt(e){return t=>{for(let n=t.getAncestor();void 0!==n;n=n.getAncestor())if(e(n))return!0;return!1}}function Ot(e){return t=>t.name===e}function Ct(e){return t=>t.serviceIdentifier===e}function Nt(e,t){return n=>n.tags.has(e)&&n.tags.get(e)===t}function Lt(e){return void 0===e.name&&0===e.tags.size}function Vt(e){const t=Pt(e);return e=>!t(e)}function Dt(e){return t=>{const n=t.getAncestor();return void 0===n||!e(n)}}function Ht(e){return t=>{const n=t.getAncestor();return void 0!==n&&e(n)}}!function(e){e[e.invalidOperation=0]="invalidOperation"}(It||(It={}));class Ft{#i;constructor(e){this.#i=e}getIdentifier(){return xt(this.#i)}inRequestScope(){return this.#i.scope=b,new Yt(this.#i)}inSingletonScope(){return this.#i.scope=g,new Yt(this.#i)}inTransientScope(){return this.#i.scope=y,new Yt(this.#i)}}class jt{#t;#a;#o;#s;constructor(e,t,n,i){this.#t=e,this.#a=t,this.#o=n,this.#s=i}to(e){const t=X(e),n={cache:{isRight:!1,value:void 0},id:m(),implementationType:e,isSatisfiedBy:Et.always,moduleId:this.#a,onActivation:void 0,onDeactivation:void 0,scope:t.scope??this.#o,serviceIdentifier:this.#s,type:M};return this.#t(n),new Ut(n)}toSelf(){if("function"!=typeof this.#s)throw new Error('"toSelf" function can only be applied when a newable function is used as service identifier');return this.to(this.#s)}toConstantValue(e){const t={cache:{isRight:!1,value:void 0},id:m(),isSatisfiedBy:Et.always,moduleId:this.#a,onActivation:void 0,onDeactivation:void 0,scope:g,serviceIdentifier:this.#s,type:w,value:e};return this.#t(t),new Yt(t)}toDynamicValue(e){const t={cache:{isRight:!1,value:void 0},id:m(),isSatisfiedBy:Et.always,moduleId:this.#a,onActivation:void 0,onDeactivation:void 0,scope:this.#o,serviceIdentifier:this.#s,type:S,value:e};return this.#t(t),new Ut(t)}toResolvedValue(e,t){const n={cache:{isRight:!1,value:void 0},factory:e,id:m(),isSatisfiedBy:Et.always,metadata:this.#r(t),moduleId:this.#a,onActivation:void 0,onDeactivation:void 0,scope:this.#o,serviceIdentifier:this.#s,type:R};return this.#t(n),new Ut(n)}toFactory(e){const t={cache:{isRight:!1,value:void 0},factory:e,id:m(),isSatisfiedBy:Et.always,moduleId:this.#a,onActivation:void 0,onDeactivation:void 0,scope:g,serviceIdentifier:this.#s,type:A};return this.#t(t),new Yt(t)}toProvider(e){const t={cache:{isRight:!1,value:void 0},id:m(),isSatisfiedBy:Et.always,moduleId:this.#a,onActivation:void 0,onDeactivation:void 0,provider:e,scope:g,serviceIdentifier:this.#s,type:B};return this.#t(t),new Yt(t)}toService(e){const t={id:m(),isSatisfiedBy:Et.always,moduleId:this.#a,serviceIdentifier:this.#s,targetServiceIdentifier:e,type:E};this.#t(t)}#r(e){return{arguments:(e??[]).map(e=>function(e){return"object"==typeof e&&!f.is(e)}(e)?function(e){return!0===e.isMultiple}(e)?{chained:e.chained??!1,kind:re.multipleInjection,name:e.name,optional:e.optional??!1,tags:new Map((e.tags??[]).map(e=>[e.key,e.value])),value:e.serviceIdentifier}:{kind:re.singleInjection,name:e.name,optional:e.optional??!1,tags:new Map((e.tags??[]).map(e=>[e.key,e.value])),value:e.serviceIdentifier}:{kind:re.singleInjection,name:void 0,optional:!1,tags:new Map,value:e})}}}class Xt{#i;constructor(e){this.#i=e}getIdentifier(){return xt(this.#i)}onActivation(e){return this.#i.onActivation=e,new qt(this.#i)}onDeactivation(e){if(this.#i.onDeactivation=e,this.#i.scope!==g)throw new Tt(It.invalidOperation,`Binding for service "${_(this.#i.serviceIdentifier)}" has a deactivation function, but its scope is not singleton. Deactivation functions can only be used with singleton bindings.`);return new qt(this.#i)}}class qt{#i;constructor(e){this.#i=e}getIdentifier(){return xt(this.#i)}when(e){return this.#i.isSatisfiedBy=e,new Xt(this.#i)}whenAnyAncestor(e){return this.when(Pt(e))}whenAnyAncestorIs(e){return this.when(Pt(Ct(e)))}whenAnyAncestorNamed(e){return this.when(function(e){return Pt(Ot(e))}(e))}whenAnyAncestorTagged(e,t){return this.when(function(e,t){return Pt(Nt(e,t))}(e,t))}whenDefault(){return this.when(Lt)}whenNamed(e){return this.when(Ot(e))}whenNoParent(e){return this.when(Dt(e))}whenNoParentIs(e){return this.when(Dt(Ct(e)))}whenNoParentNamed(e){return this.when(function(e){return Dt(Ot(e))}(e))}whenNoParentTagged(e,t){return this.when(function(e,t){return Dt(Nt(e,t))}(e,t))}whenParent(e){return this.when(Ht(e))}whenParentIs(e){return this.when(Ht(Ct(e)))}whenParentNamed(e){return this.when(function(e){return Ht(Ot(e))}(e))}whenParentTagged(e,t){return this.when(function(e,t){return Ht(Nt(e,t))}(e,t))}whenTagged(e,t){return this.when(Nt(e,t))}whenNoAncestor(e){return this.when(Vt(e))}whenNoAncestorIs(e){return this.when(Vt(Ct(e)))}whenNoAncestorNamed(e){return this.when(function(e){return Vt(Ot(e))}(e))}whenNoAncestorTagged(e,t){return this.when(function(e,t){return Vt(Nt(e,t))}(e,t))}}class Yt extends qt{#l;constructor(e){super(e),this.#l=new Xt(e)}onActivation(e){return this.#l.onActivation(e)}onDeactivation(e){return this.#l.onDeactivation(e)}}class Ut extends Yt{#c;constructor(e){super(e),this.#c=new Ft(e)}inRequestScope(){return this.#c.inRequestScope()}inSingletonScope(){return this.#c.inSingletonScope()}inTransientScope(){return this.#c.inTransientScope()}}class Gt{#u;#o;#_;#p;constructor(e,t,n,i){this.#u=e,this.#o=t,this.#_=n,this.#p=i}bind(e){return new jt(e=>{this.#d(e)},void 0,this.#o,e)}isBound(e,t){const n=this.#p.bindingService.get(e);return this.#v(e,n,t)}isCurrentBound(e,t){const n=this.#p.bindingService.getNonParentBindings(e);return this.#v(e,n,t)}async rebind(e){return await this.unbind(e),this.bind(e)}rebindSync(e){return this.unbindSync(e),this.bind(e)}async unbind(e){await this.#h(e)}async unbindAll(){const e=[...this.#p.bindingService.getNonParentBoundServices()];await Promise.all(e.map(async e=>function(e,t){const n=e.getBindings(t);return At(e,n)}(this.#u,e)));for(const t of e)this.#p.activationService.removeAllByServiceId(t),this.#p.bindingService.removeAllByServiceId(t),this.#p.deactivationService.removeAllByServiceId(t);this.#p.planResultCacheService.clearCache()}unbindSync(e){void 0!==this.#h(e)&&this.#w(e)}#d(e){this.#p.bindingService.set(e),this.#_.invalidateService({binding:e,kind:Ne.bindingAdded})}#w(e){let t;if(Rt(e)){const i=this.#p.bindingService.getById(e.id),r=(n=i,function(e){if(void 0===e)return;const t=e.next();return!0!==t.done?t.value:void 0}(n?.[Symbol.iterator]()))?.serviceIdentifier;t=void 0===r?"Unexpected asynchronous deactivation when unbinding binding identifier. Consider using Container.unbind() instead.":`Unexpected asynchronous deactivation when unbinding "${_(r)}" binding. Consider using Container.unbind() instead.`}else t=`Unexpected asynchronous deactivation when unbinding "${_(e)}" service. Consider using Container.unbind() instead.`;var n;throw new Tt(It.invalidOperation,t)}#h(e){return Rt(e)?this.#f(e):this.#M(e)}#f(e){const t=this.#p.bindingService.getById(e.id),n=void 0===t?void 0:[...t],i=At(this.#u,t);if(void 0!==i)return i.then(()=>{this.#g(n,e)});this.#g(n,e)}#g(e,t){if(this.#p.bindingService.removeById(t.id),void 0!==e)for(const t of e)this.#_.invalidateService({binding:t,kind:Ne.bindingRemoved})}#M(e){const t=this.#p.bindingService.get(e),n=void 0===t?void 0:[...t],i=At(this.#u,t);if(void 0!==i)return i.then(()=>{this.#k(e,n)});this.#k(e,n)}#k(e,t){if(this.#p.activationService.removeAllByServiceId(e),this.#p.bindingService.removeAllByServiceId(e),this.#p.deactivationService.removeAllByServiceId(e),void 0!==t)for(const e of t)this.#_.invalidateService({binding:e,kind:Ne.bindingRemoved})}#v(e,t,n){if(void 0===t)return!1;const i={getAncestor:()=>{},name:n?.name,serviceIdentifier:e,tags:new Map};void 0!==n?.tag&&i.tags.set(n.tag.key,n.tag.value);for(const e of t)if(e.isSatisfiedBy(i))return!0;return!1}}class Kt{#b;#u;#o;#_;#p;constructor(e,t,n,i,r){this.#b=e,this.#u=t,this.#o=n,this.#_=i,this.#p=r}async load(...e){await Promise.all(this.#n(...e))}loadSync(...e){const t=this.#n(...e);for(const e of t)if(void 0!==e)throw new Tt(It.invalidOperation,"Unexpected asynchronous module load. Consider using Container.load() instead.")}async unload(...e){await Promise.all(this.#m(...e)),this.#S(e)}unloadSync(...e){const t=this.#m(...e);for(const e of t)if(void 0!==e)throw new Tt(It.invalidOperation,"Unexpected asynchronous module unload. Consider using Container.unload() instead.");this.#S(e)}#y(e){return{bind:t=>new jt(e=>{this.#d(e)},e,this.#o,t),isBound:this.#b.isBound.bind(this.#b),onActivation:(t,n)=>{this.#p.activationService.add(n,{moduleId:e,serviceId:t})},onDeactivation:(t,n)=>{this.#p.deactivationService.add(n,{moduleId:e,serviceId:t})},rebind:this.#b.rebind.bind(this.#b),rebindSync:this.#b.rebindSync.bind(this.#b),unbind:this.#b.unbind.bind(this.#b),unbindSync:this.#b.unbindSync.bind(this.#b)}}#S(e){for(const t of e)this.#p.activationService.removeAllByModuleId(t.id),this.#p.bindingService.removeAllByModuleId(t.id),this.#p.deactivationService.removeAllByModuleId(t.id);this.#p.planResultCacheService.clearCache()}#n(...e){return e.map(e=>e.load(this.#y(e.id)))}#d(e){this.#p.bindingService.set(e),this.#_.invalidateService({binding:e,kind:Ne.bindingAdded})}#m(...e){return e.map(e=>function(e,t){const n=e.getBindingsFromModule(t);return At(e,n)}(this.#u,e.id))}}class zt{deactivationParams;constructor(e){this.deactivationParams=function(e){return{getBindings:e.bindingService.get.bind(e.bindingService),getBindingsFromModule:e.bindingService.getByModuleId.bind(e.bindingService),getClassMetadata:X,getDeactivations:e.deactivationService.get.bind(e.deactivationService)}}(e),e.onReset(()=>{!function(e,t){t.getBindings=e.bindingService.get.bind(e.bindingService),t.getBindingsFromModule=e.bindingService.getByModuleId.bind(e.bindingService),t.getDeactivations=e.deactivationService.get.bind(e.deactivationService)}(e,this.deactivationParams)})}}class Zt{planParamsOperations;#p;constructor(e){this.#p=e,this.planParamsOperations={getBindings:this.#p.bindingService.get.bind(this.#p.bindingService),getBindingsChained:this.#p.bindingService.getChained.bind(this.#p.bindingService),getClassMetadata:X,getPlan:this.#p.planResultCacheService.get.bind(this.#p.planResultCacheService),setBinding:this.#d.bind(this),setNonCachedServiceNode:this.#p.planResultCacheService.setNonCachedServiceNode.bind(this.#p.planResultCacheService),setPlan:this.#p.planResultCacheService.set.bind(this.#p.planResultCacheService)},this.#p.onReset(()=>{this.#E()})}#E(){this.planParamsOperations.getBindings=this.#p.bindingService.get.bind(this.#p.bindingService),this.planParamsOperations.getBindingsChained=this.#p.bindingService.getChained.bind(this.#p.bindingService),this.planParamsOperations.setBinding=this.#d.bind(this)}#d(e){this.#p.bindingService.set(e),this.#p.planResultCacheService.invalidateServiceBinding({binding:e,kind:Ne.bindingAdded,operations:this.planParamsOperations})}}class Wt{#R;#p;constructor(e,t){this.#R=e,this.#p=t}invalidateService(e){this.#p.planResultCacheService.invalidateServiceBinding({...e,operations:this.#R.planParamsOperations})}}class $t{#A;#P;#D;#p;constructor(e,t,n){this.#p=t,this.#D=n,this.#A=this.#T(e),this.#P=this.#C()}register(e,t){const n=new t(e,this.#P);if(!0!==n[Mt])throw new Tt(It.invalidOperation,"Invalid plugin. The plugin must extend the Plugin class");n.load(this.#A)}#T(e){return{define:(t,n)=>{if(Object.prototype.hasOwnProperty.call(e,t))throw new Tt(It.invalidOperation,`Container already has a method named "${String(t)}"`);e[t]=n},onPlan:this.#D.onPlan.bind(this.#D)}}#C(){const e=this.#p;return{get activationService(){return e.activationService},get bindingService(){return e.bindingService},get deactivationService(){return e.deactivationService},get planResultCacheService(){return e.planResultCacheService}}}}class Qt{activationService;bindingService;deactivationService;planResultCacheService;#B;constructor(e,t,n,i){this.activationService=e,this.bindingService=t,this.deactivationService=n,this.planResultCacheService=i,this.#B=[]}reset(e,t,n){this.activationService=e,this.bindingService=t,this.deactivationService=n,this.planResultCacheService.clearCache();for(const e of this.#B)e()}onReset(e){this.#B.push(e)}}class Jt{#O;#o;#q;#L;#x;#R;#p;constructor(e,t,n,i){this.#R=e,this.#p=t,this.#L=this.#I(),this.#O=n,this.#o=i,this.#q=e=>this.#p.activationService.get(e),this.#x=[],this.#p.onReset(()=>{this.#E()})}get(e,t){const n=this.#V(!1,e,t),i=this.#H(n);if(c(i))throw new Tt(It.invalidOperation,`Unexpected asynchronous service when resolving service "${_(e)}"`);return i}getAll(e,t){const n=this.#V(!0,e,t),i=this.#H(n);if(c(i))throw new Tt(It.invalidOperation,`Unexpected asynchronous service when resolving service "${_(e)}"`);return i}async getAllAsync(e,t){const n=this.#V(!0,e,t);return this.#H(n)}async getAsync(e,t){const n=this.#V(!1,e,t);return this.#H(n)}onPlan(e){this.#x.push(e)}#E(){this.#L=this.#I()}#X(e,t,n){const i=n?.name,r=n?.optional??!1,a=n?.tag;return e?{chained:n?.chained??!1,isMultiple:e,name:i,optional:r,serviceIdentifier:t,tag:a}:{isMultiple:e,name:i,optional:r,serviceIdentifier:t,tag:a}}#N(e,t,n){const i={autobindOptions:n?.autobind??this.#O?{scope:this.#o}:void 0,operations:this.#R.planParamsOperations,rootConstraints:this.#U(e,t,n),servicesBranch:[]};return this.#G(i,n),i}#U(e,t,n){return t?{chained:n?.chained??!1,isMultiple:t,serviceIdentifier:e}:{isMultiple:t,serviceIdentifier:e}}#V(e,t,n){const i=this.#X(e,t,n),r=this.#p.planResultCacheService.get(i);if(void 0!==r)return r;const a=Ce(this.#N(t,e,n));for(const e of this.#x)e(i,a);return a}#I(){return{get:this.get.bind(this),getAll:this.getAll.bind(this),getAllAsync:this.getAllAsync.bind(this),getAsync:this.getAsync.bind(this)}}#H(e){return ft({context:this.#L,getActivations:this.#q,planResult:e,requestScopeCache:new Map})}#G(e,t){void 0!==t&&(void 0!==t.name&&(e.rootConstraints.name=t.name),!0===t.optional&&(e.rootConstraints.isOptional=!0),void 0!==t.tag&&(e.rootConstraints.tag={key:t.tag.key,value:t.tag.value}),e.rootConstraints.isMultiple&&(e.rootConstraints.chained=t?.chained??!1))}}class en{#p;#Z;constructor(e){this.#p=e,this.#Z=[]}restore(){const e=this.#Z.pop();if(void 0===e)throw new Tt(It.invalidOperation,"No snapshot available to restore");this.#p.reset(e.activationService,e.bindingService,e.deactivationService)}snapshot(){this.#Z.push({activationService:this.#p.activationService.clone(),bindingService:this.#p.bindingService.clone(),deactivationService:this.#p.deactivationService.clone()})}}const tn=y;class nn{#b;#F;#j;#p;#D;#Y;constructor(e){const t=e?.autobind??!1,n=e?.defaultScope??tn;this.#p=this.#z(e,t,n);const i=new Zt(this.#p),r=new Wt(i,this.#p),a=new zt(this.#p);this.#b=new Gt(a.deactivationParams,n,r,this.#p),this.#F=new Kt(this.#b,a.deactivationParams,n,r,this.#p),this.#D=new Jt(i,this.#p,t,n),this.#j=new $t(this,this.#p,this.#D),this.#Y=new en(this.#p)}bind(e){return this.#b.bind(e)}get(e,t){return this.#D.get(e,t)}getAll(e,t){return this.#D.getAll(e,t)}async getAllAsync(e,t){return this.#D.getAllAsync(e,t)}async getAsync(e,t){return this.#D.getAsync(e,t)}isBound(e,t){return this.#b.isBound(e,t)}isCurrentBound(e,t){return this.#b.isCurrentBound(e,t)}async load(...e){return this.#F.load(...e)}loadSync(...e){this.#F.loadSync(...e)}onActivation(e,t){this.#p.activationService.add(t,{serviceId:e})}onDeactivation(e,t){this.#p.deactivationService.add(t,{serviceId:e})}register(e){this.#j.register(this,e)}restore(){this.#Y.restore()}async rebind(e){return this.#b.rebind(e)}rebindSync(e){return this.#b.rebindSync(e)}snapshot(){this.#Y.snapshot()}async unbind(e){await this.#b.unbind(e)}async unbindAll(){return this.#b.unbindAll()}unbindSync(e){this.#b.unbindSync(e)}async unload(...e){return this.#F.unload(...e)}unloadSync(...e){this.#F.unloadSync(...e)}#W(e,t){if(e)return{scope:t}}#z(e,t,n){const i=this.#W(t,n);if(void 0===e?.parent)return new Qt(x.build(()=>{}),G.build(()=>{},i),K.build(()=>{}),new Xe);const r=new Xe,a=e.parent;return a.#p.planResultCacheService.subscribe(r),new Qt(x.build(()=>a.#p.activationService),G.build(()=>a.#p.bindingService,i),K.build(()=>a.#p.deactivationService),r)}}let rn=class{constructor(e){this.audioEncoders=e}getAudioEncoderByFormat(e){return n(this,void 0,void 0,function*(){for(const t of this.audioEncoders){if((yield t.getMetadata()).format===e)return t}})}getAudioEncodersMetadata(){return n(this,void 0,void 0,function*(){const e=[];for(const t of this.audioEncoders)e.push(yield t.getMetadata());return e})}encodeAudio(e,t){return n(this,void 0,void 0,function*(){const n=yield this.getAudioEncoderByFormat(t.format);if(n)return n.encodeAudio(e,t);throw new Error(`BaseAudioEncoder.encodeAudio: cannot find encoder for ${t.format} format`)})}};var an,sn;rn=e([ie(),(an=0,sn=function(e,t){return function(e,t){return(n,i,r)=>{try{void 0===r?function(e,t){const n=ee(e,t);return(e,t)=>{p(e.constructor,P,O,$(n(e),t))}}(e,t)(n,i):"number"==typeof r?function(e,t){const n=ee(e,t);return(e,t,i)=>{if(!function(e,t){return"function"==typeof e&&void 0===t}(e,t))throw new L(V.injectionDecoratorConflict,`Found an @inject decorator in a non constructor parameter.\nFound @inject decorator at method "${t?.toString()??""}" at class "${e.constructor.name}"`);p(e,P,O,function(e,t){return n=>{const i=n.constructorArguments[t];return n.constructorArguments[t]=e(i),n}}(n(e),i))}}(e,t)(n,i,r):function(e,t){const n=ee(e,t);return(e,t,i)=>{if(!function(e){return void 0!==e.set}(i))throw new L(V.injectionDecoratorConflict,`Found an @inject decorator in a non setter property method.\nFound @inject decorator at method "${t.toString()}" at class "${e.constructor.name}"`);p(e.constructor,P,O,$(n(e),t))}}(e,t)(n,i,r)}catch(e){J(n,i,r,e)}}}(W(j.multipleInjection,e,t),Z)}(r.AudioEncoders),function(e,t){sn(e,t,an)}),t("design:paramtypes",[Array])],rn);var on=rn;class ln{isWebAudioEncoderAPISupportedForSettings(e){return n(this,void 0,void 0,function*(){if(!AudioEncoder||!AudioEncoder.isConfigSupported)return!1;const t=yield AudioEncoder.isConfigSupported({codec:e.format,sampleRate:e.sampleRate,numberOfChannels:e.numChannels,bitrate:1e3*(e.bitrate||0)});return Boolean(t.supported)})}encodeWithWebAudioEncoderAPI(e,t){return n(this,void 0,void 0,function*(){const n=(yield this.getMetadata()).format;if(!n)throw new Error("encodeWebAudioEncoderAPI: No format provided");const r=[],a=new AudioEncoder({output:e=>r.push(e),error:e=>console.error(e)});a.configure({codec:n,sampleRate:t.sampleRate,numberOfChannels:t.numChannels,bitrate:1e3*(t.bitrate||0)});const s=e[0].length;let o;o=2===t.numChannels?i.interleaveBuffers(e[0],e[1]):e[0];const l=new Float32Array(o),c=new AudioData({format:"f32",sampleRate:t.sampleRate,numberOfFrames:s,numberOfChannels:2,timestamp:0,data:l});a.encode(c),yield a.flush(),a.close();const _=r.reduce((e,t)=>e+t.byteLength,0),u=new Uint8Array(_);let f=0;for(const e of r){const t=new Uint8Array(e.byteLength);e.copyTo(t),u.set(t,f),f+=t.length}return u.buffer})}}let cn=class extends ln{getMetadata(){return Promise.resolve({format:"wav",implementationType:"custom",supported:!0})}encodeAudio(e,t){let n;n=2===t.numChannels?i.interleaveBuffers(e[0],e[1]):e[0];const r=new ArrayBuffer(44+2*n.length),a=new DataView(r);return i.writeStringToDataView(a,0,"RIFF"),a.setUint32(4,36+2*n.length,!0),i.writeStringToDataView(a,8,"WAVE"),i.writeStringToDataView(a,12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,t.numChannels,!0),a.setUint32(24,t.sampleRate,!0),a.setUint32(28,4*t.sampleRate,!0),a.setUint16(32,2*t.numChannels,!0),a.setUint16(34,16,!0),i.writeStringToDataView(a,36,"data"),a.setUint32(40,2*n.length,!0),i.floatTo16BitPCM(a,44,n),Promise.resolve(a.buffer)}};cn=e([ie()],cn);var _n,un,fn,hn,dn,pn,vn,mn,bn,gn,yn,wn,Sn,An,Mn,Bn,Rn,En,kn,Tn,In,xn,Pn,On,Cn,Nn,Ln,Vn,Dn,Hn,Fn,jn,Xn,qn,Yn,Un,Gn,Kn,zn,Zn,Wn,$n,Qn,Jn,ei,ti,ni,ii,ri,ai,si,oi,li,ci,_i,ui,fi,hi,di,pi,vi,mi,bi,gi,yi,wi,Si,Ai,Mi,Bi=cn,Ri={};function Ei(){if(un)return _n;function e(e){return new Int16Array(e)}function t(e){return new Int32Array(e)}function n(e){return new Float32Array(e)}un=1;var i={fill:function(e,t,n,i){if(2==arguments.length)for(var r=0;r<e.length;r++)e[r]=arguments[1];else for(r=t;r<n;r++)e[r]=i}},r={arraycopy:function(e,t,n,i,r){for(var a=t+r;t<a;)n[i++]=e[t++]},out:{}};r.out.println=function(e){console.log(e)},r.out.printf=function(){console.log.apply(console,arguments)};var a={};function s(e){this.ordinal=e}a.SQRT2=1.4142135623730951,a.FAST_LOG10=function(e){return Math.log10(e)},a.FAST_LOG10_X=function(e,t){return Math.log10(e)*t},s.short_block_allowed=new s(0),s.short_block_coupled=new s(1),s.short_block_dispensed=new s(2),s.short_block_forced=new s(3);var o={};function l(e){this.ordinal=e}o.MAX_VALUE=34028235e31,l.vbr_off=new l(0),l.vbr_mt=new l(1),l.vbr_rh=new l(2),l.vbr_abr=new l(3),l.vbr_mtrh=new l(4),l.vbr_default=l.vbr_mtrh;return _n={System:r,VbrMode:l,Float:o,ShortBlock:s,Util:a,Arrays:i,new_array_n:function e(t){if(1==t.length)return new Array(t[0]);var n=t[0];t=t.slice(1);for(var i=[],r=0;r<n;r++)i.push(e(t));return i},new_byte:function(e){return new Int8Array(e)},new_double:function(e){return new Float64Array(e)},new_float:n,new_float_n:function e(t){if(1==t.length)return n(t[0]);var i=t[0];t=t.slice(1);for(var r=[],a=0;a<i;a++)r.push(e(t));return r},new_int:t,new_int_n:function e(n){if(1==n.length)return t(n[0]);var i=n[0];n=n.slice(1);for(var r=[],a=0;a<i;a++)r.push(e(n));return r},new_short:e,new_short_n:function t(n){if(1==n.length)return e(n[0]);var i=n[0];n=n.slice(1);for(var r=[],a=0;a<i;a++)r.push(t(n));return r},assert:function(e){}},_n}function ki(){if(pn)return dn;pn=1;var e=Ti(),t=Ei(),n=t.System;t.VbrMode,t.Float,t.ShortBlock,t.Util,t.Arrays,t.new_array_n,t.new_byte,t.new_double;var i=t.new_float,r=t.new_float_n;return t.new_int,t.new_int_n,t.assert,dn=function(){this.l=i(e.SBMAX_l),this.s=r([e.SBMAX_s,3]);var t=this;this.assign=function(i){n.arraycopy(i.l,0,t.l,0,e.SBMAX_l);for(var r=0;r<e.SBMAX_s;r++)for(var a=0;a<3;a++)t.s[r][a]=i.s[r][a]}},dn}function Ti(){if(gn)return bn;gn=1;var e=Ei(),t=e.System,n=e.VbrMode;e.Float,e.ShortBlock,e.Util,e.Arrays;var i=e.new_array_n;e.new_byte,e.new_double;var r=e.new_float,a=e.new_float_n,s=e.new_int;e.new_int_n;var o=e.assert;function l(){var e=function(){if(hn)return fn;hn=1;var e=Ei(),t=e.System;e.VbrMode,e.Float,e.ShortBlock;var n=e.Util,i=e.Arrays;e.new_array_n,e.new_byte,e.new_double;var r=e.new_float;e.new_float_n,e.new_int,e.new_int_n,e.assert;var a=Ti();return fn=function(){var e=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*n.SQRT2*.5/2384e-9,.017876148*n.SQRT2*.5/2384e-9,.003134727*n.SQRT2*.5/2384e-9,.002457142*n.SQRT2*.5/2384e-9,971317e-9*n.SQRT2*.5/2384e-9,218868e-9*n.SQRT2*.5/2384e-9,101566e-9*n.SQRT2*.5/2384e-9,13828e-9*n.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],s=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],o=s[a.SHORT_TYPE],l=s[a.SHORT_TYPE],c=s[a.SHORT_TYPE],_=s[a.SHORT_TYPE],u=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function f(t,i,r){for(var a,s,o,l=10,c=i+238-14-286,_=-15;_<0;_++){var u,f,h;u=e[l+-10],f=t[c+-224]*u,h=t[i+224]*u,u=e[l+-9],f+=t[c+-160]*u,h+=t[i+160]*u,u=e[l+-8],f+=t[c+-96]*u,h+=t[i+96]*u,u=e[l+-7],f+=t[c+-32]*u,h+=t[i+32]*u,u=e[l+-6],f+=t[c+32]*u,h+=t[i+-32]*u,u=e[l+-5],f+=t[c+96]*u,h+=t[i+-96]*u,u=e[l+-4],f+=t[c+160]*u,h+=t[i+-160]*u,u=e[l+-3],f+=t[c+224]*u,h+=t[i+-224]*u,u=e[l+-2],f+=t[i+-256]*u,h-=t[c+256]*u,u=e[l+-1],f+=t[i+-192]*u,h-=t[c+192]*u,u=e[l+0],f+=t[i+-128]*u,h-=t[c+128]*u,u=e[l+1],f+=t[i+-64]*u,h-=t[c+64]*u,u=e[l+2],f+=t[i+0]*u,h-=t[c+0]*u,u=e[l+3],f+=t[i+64]*u,h-=t[c+-64]*u,u=e[l+4],f+=t[i+128]*u,h-=t[c+-128]*u,u=e[l+5],f+=t[i+192]*u,u=(h-=t[c+-192]*u)-(f*=e[l+6]),r[30+2*_]=h+f,r[31+2*_]=e[l+7]*u,l+=18,i--,c++}h=t[i+-16]*e[l+-10],f=t[i+-32]*e[l+-2],h+=(t[i+-48]-t[i+16])*e[l+-9],f+=t[i+-96]*e[l+-1],h+=(t[i+-80]+t[i+48])*e[l+-8],f+=t[i+-160]*e[l+0],h+=(t[i+-112]-t[i+80])*e[l+-7],f+=t[i+-224]*e[l+1],h+=(t[i+-144]+t[i+112])*e[l+-6],f-=t[i+32]*e[l+2],h+=(t[i+-176]-t[i+144])*e[l+-5],f-=t[i+96]*e[l+3],h+=(t[i+-208]+t[i+176])*e[l+-4],f-=t[i+160]*e[l+4],h+=(t[i+-240]-t[i+208])*e[l+-3],a=(f-=t[i+224])-h,s=f+h,h=r[14],f=r[15]-h,r[31]=s+h,r[30]=a+f,r[15]=a-f,r[14]=s-h,o=r[28]-r[0],r[0]+=r[28],r[28]=o*e[l+-36+7],o=r[29]-r[1],r[1]+=r[29],r[29]=o*e[l+-36+7],o=r[26]-r[2],r[2]+=r[26],r[26]=o*e[l+-72+7],o=r[27]-r[3],r[3]+=r[27],r[27]=o*e[l+-72+7],o=r[24]-r[4],r[4]+=r[24],r[24]=o*e[l+-108+7],o=r[25]-r[5],r[5]+=r[25],r[25]=o*e[l+-108+7],o=r[22]-r[6],r[6]+=r[22],r[22]=o*n.SQRT2,o=r[23]-r[7],r[7]+=r[23],r[23]=o*n.SQRT2-r[7],r[7]-=r[6],r[22]-=r[7],r[23]-=r[22],o=r[6],r[6]=r[31]-o,r[31]=r[31]+o,o=r[7],r[7]=r[30]-o,r[30]=r[30]+o,o=r[22],r[22]=r[15]-o,r[15]=r[15]+o,o=r[23],r[23]=r[14]-o,r[14]=r[14]+o,o=r[20]-r[8],r[8]+=r[20],r[20]=o*e[l+-180+7],o=r[21]-r[9],r[9]+=r[21],r[21]=o*e[l+-180+7],o=r[18]-r[10],r[10]+=r[18],r[18]=o*e[l+-216+7],o=r[19]-r[11],r[11]+=r[19],r[19]=o*e[l+-216+7],o=r[16]-r[12],r[12]+=r[16],r[16]=o*e[l+-252+7],o=r[17]-r[13],r[13]+=r[17],r[17]=o*e[l+-252+7],o=-r[20]+r[24],r[20]+=r[24],r[24]=o*e[l+-216+7],o=-r[21]+r[25],r[21]+=r[25],r[25]=o*e[l+-216+7],o=r[4]-r[8],r[4]+=r[8],r[8]=o*e[l+-216+7],o=r[5]-r[9],r[5]+=r[9],r[9]=o*e[l+-216+7],o=r[0]-r[12],r[0]+=r[12],r[12]=o*e[l+-72+7],o=r[1]-r[13],r[1]+=r[13],r[13]=o*e[l+-72+7],o=r[16]-r[28],r[16]+=r[28],r[28]=o*e[l+-72+7],o=-r[17]+r[29],r[17]+=r[29],r[29]=o*e[l+-72+7],o=n.SQRT2*(r[2]-r[10]),r[2]+=r[10],r[10]=o,o=n.SQRT2*(r[3]-r[11]),r[3]+=r[11],r[11]=o,o=n.SQRT2*(-r[18]+r[26]),r[18]+=r[26],r[26]=o-r[18],o=n.SQRT2*(-r[19]+r[27]),r[19]+=r[27],r[27]=o-r[19],o=r[2],r[19]-=r[3],r[3]-=o,r[2]=r[31]-o,r[31]+=o,o=r[3],r[11]-=r[19],r[18]-=o,r[3]=r[30]-o,r[30]+=o,o=r[18],r[27]-=r[11],r[19]-=o,r[18]=r[15]-o,r[15]+=o,o=r[19],r[10]-=o,r[19]=r[14]-o,r[14]+=o,o=r[10],r[11]-=o,r[10]=r[23]-o,r[23]+=o,o=r[11],r[26]-=o,r[11]=r[22]-o,r[22]+=o,o=r[26],r[27]-=o,r[26]=r[7]-o,r[7]+=o,o=r[27],r[27]=r[6]-o,r[6]+=o,o=n.SQRT2*(r[0]-r[4]),r[0]+=r[4],r[4]=o,o=n.SQRT2*(r[1]-r[5]),r[1]+=r[5],r[5]=o,o=n.SQRT2*(r[16]-r[20]),r[16]+=r[20],r[20]=o,o=n.SQRT2*(r[17]-r[21]),r[17]+=r[21],r[21]=o,o=-n.SQRT2*(r[8]-r[12]),r[8]+=r[12],r[12]=o-r[8],o=-n.SQRT2*(r[9]-r[13]),r[9]+=r[13],r[13]=o-r[9],o=-n.SQRT2*(r[25]-r[29]),r[25]+=r[29],r[29]=o-r[25],o=-n.SQRT2*(r[24]+r[28]),r[24]-=r[28],r[28]=o-r[24],o=r[24]-r[16],r[24]=o,o=r[20]-o,r[20]=o,o=r[28]-o,r[28]=o,o=r[25]-r[17],r[25]=o,o=r[21]-o,r[21]=o,o=r[29]-o,r[29]=o,o=r[17]-r[1],r[17]=o,o=r[9]-o,r[9]=o,o=r[25]-o,r[25]=o,o=r[5]-o,r[5]=o,o=r[21]-o,r[21]=o,o=r[13]-o,r[13]=o,o=r[29]-o,r[29]=o,o=r[1]-r[0],r[1]=o,o=r[16]-o,r[16]=o,o=r[17]-o,r[17]=o,o=r[8]-o,r[8]=o,o=r[9]-o,r[9]=o,o=r[24]-o,r[24]=o,o=r[25]-o,r[25]=o,o=r[4]-o,r[4]=o,o=r[5]-o,r[5]=o,o=r[20]-o,r[20]=o,o=r[21]-o,r[21]=o,o=r[12]-o,r[12]=o,o=r[13]-o,r[13]=o,o=r[28]-o,r[28]=o,o=r[29]-o,r[29]=o,o=r[0],r[0]+=r[31],r[31]-=o,o=r[1],r[1]+=r[30],r[30]-=o,o=r[16],r[16]+=r[15],r[15]-=o,o=r[17],r[17]+=r[14],r[14]-=o,o=r[8],r[8]+=r[23],r[23]-=o,o=r[9],r[9]+=r[22],r[22]-=o,o=r[24],r[24]+=r[7],r[7]-=o,o=r[25],r[25]+=r[6],r[6]-=o,o=r[4],r[4]+=r[27],r[27]-=o,o=r[5],r[5]+=r[26],r[26]-=o,o=r[20],r[20]+=r[11],r[11]-=o,o=r[21],r[21]+=r[10],r[10]-=o,o=r[12],r[12]+=r[19],r[19]-=o,o=r[13],r[13]+=r[18],r[18]-=o,o=r[28],r[28]+=r[3],r[3]-=o,o=r[29],r[29]+=r[2],r[2]-=o}function h(e,t){for(var n=0;n<3;n++){var i,r,o,l,c,_;r=(l=e[t+6]*s[a.SHORT_TYPE][0]-e[t+15])+(i=e[t+0]*s[a.SHORT_TYPE][2]-e[t+9]),o=l-i,c=(l=e[t+15]*s[a.SHORT_TYPE][0]+e[t+6])+(i=e[t+9]*s[a.SHORT_TYPE][2]+e[t+0]),_=-l+i,i=2069978111953089e-26*(e[t+3]*s[a.SHORT_TYPE][1]-e[t+12]),l=2069978111953089e-26*(e[t+12]*s[a.SHORT_TYPE][1]+e[t+3]),e[t+0]=190752519173728e-25*r+i,e[t+15]=190752519173728e-25*-c+l,o=.8660254037844387*o*1907525191737281e-26,c=.5*c*1907525191737281e-26+l,e[t+3]=o-c,e[t+6]=o+c,r=.5*r*1907525191737281e-26-i,_=.8660254037844387*_*1907525191737281e-26,e[t+9]=r+_,e[t+12]=r-_,t++}}function d(e,t,n){var i,r,a,s,o,c,_,u,f,h,d,p,v,m,b,g,y,w;a=n[17]-n[9],o=n[15]-n[11],c=n[14]-n[12],_=n[0]+n[8],u=n[1]+n[7],f=n[2]+n[6],h=n[3]+n[5],e[t+17]=_+f-h-(u-n[4]),r=(_+f-h)*l[19]+(u-n[4]),i=(a-o-c)*l[18],e[t+5]=i+r,e[t+6]=i-r,s=(n[16]-n[10])*l[18],u=u*l[19]+n[4],i=a*l[12]+s+o*l[13]+c*l[14],r=-_*l[16]+u-f*l[17]+h*l[15],e[t+1]=i+r,e[t+2]=i-r,i=a*l[13]-s-o*l[14]+c*l[12],r=-_*l[17]+u-f*l[15]+h*l[16],e[t+9]=i+r,e[t+10]=i-r,i=a*l[14]-s+o*l[12]-c*l[13],r=_*l[15]-u+f*l[16]-h*l[17],e[t+13]=i+r,e[t+14]=i-r,d=n[8]-n[0],v=n[6]-n[2],m=n[5]-n[3],b=n[17]+n[9],g=n[16]+n[10],y=n[15]+n[11],w=n[14]+n[12],e[t+0]=b+y+w+(g+n[13]),i=(b+y+w)*l[19]-(g+n[13]),r=(d-v+m)*l[18],e[t+11]=i+r,e[t+12]=i-r,p=(n[7]-n[1])*l[18],g=n[13]-g*l[19],i=b*l[15]-g+y*l[16]+w*l[17],r=d*l[14]+p+v*l[12]+m*l[13],e[t+3]=i+r,e[t+4]=i-r,i=-b*l[17]+g-y*l[15]-w*l[16],r=d*l[13]+p-v*l[14]-m*l[12],e[t+7]=i+r,e[t+8]=i-r,i=-b*l[16]+g-y*l[17]-w*l[15],r=d*l[12]-p+v*l[13]-m*l[14],e[t+15]=i+r,e[t+16]=i-r}this.mdct_sub48=function(e,n,l){for(var p=n,v=286,m=0;m<e.channels_out;m++){for(var b=0;b<e.mode_gr;b++){for(var g,y=e.l3_side.tt[b][m],w=y.xr,S=0,A=e.sb_sample[m][1-b],M=0,B=0;B<9;B++)for(f(p,v,A[M]),f(p,v+32,A[M+1]),M+=2,v+=64,g=1;g<32;g+=2)A[M-1][g]*=-1;for(g=0;g<32;g++,S+=18){var R=y.block_type,E=e.sb_sample[m][b],k=e.sb_sample[m][1-b];if(0!=y.mixed_block_flag&&g<2&&(R=0),e.amp_filter[g]<1e-12)i.fill(w,S+0,S+18,0);else{if(e.amp_filter[g]<1)for(B=0;B<18;B++)k[B][u[g]]*=e.amp_filter[g];if(R==a.SHORT_TYPE){for(B=-3;B<0;B++){var T=s[a.SHORT_TYPE][B+3];w[S+3*B+9]=E[9+B][u[g]]*T-E[8-B][u[g]],w[S+3*B+18]=E[14-B][u[g]]*T+E[15+B][u[g]],w[S+3*B+10]=E[15+B][u[g]]*T-E[14-B][u[g]],w[S+3*B+19]=k[2-B][u[g]]*T+k[3+B][u[g]],w[S+3*B+11]=k[3+B][u[g]]*T-k[2-B][u[g]],w[S+3*B+20]=k[8-B][u[g]]*T+k[9+B][u[g]]}h(w,S)}else{var I=r(18);for(B=-9;B<0;B++){var x,P;x=s[R][B+27]*k[B+9][u[g]]+s[R][B+36]*k[8-B][u[g]],P=s[R][B+9]*E[B+9][u[g]]-s[R][B+18]*E[8-B][u[g]],I[B+9]=x-P*o[3+B+9],I[B+18]=x*o[3+B+9]+P}d(w,S,I)}}if(R!=a.SHORT_TYPE&&0!=g)for(B=7;B>=0;--B){var O,C;O=w[S+B]*c[20+B]+w[S+-1-B]*_[28+B],C=w[S+B]*_[28+B]-w[S+-1-B]*c[20+B],w[S+-1-B]=O,w[S+B]=C}}}if(p=l,v=286,1==e.mode_gr)for(var N=0;N<18;N++)t.arraycopy(e.sb_sample[m][1][N],0,e.sb_sample[m][0][N],0,32)}}},fn}(),c=function(){if(mn)return vn;mn=1;var e=ki();return vn=function(){this.thm=new e,this.en=new e}}(),_=l.FFTOFFSET,u=l.MPG_MD_MS_LR,f=null;this.psy=null;var h=null,d=null,p=null;this.setModules=function(e,t,n,i){f=e,this.psy=t,h=t,d=i,p=n};var v=new e;this.lame_encode_mp3_frame=function(e,m,b,g,y,w){var S,A=i([2,2]);A[0][0]=new c,A[0][1]=new c,A[1][0]=new c,A[1][1]=new c;var M,B=i([2,2]);B[0][0]=new c,B[0][1]=new c,B[1][0]=new c,B[1][1]=new c;var R,E,k,T=[null,null],I=e.internal_flags,x=a([2,4]),P=[.5,.5],O=[[0,0],[0,0]],C=[[0,0],[0,0]];if(T[0]=m,T[1]=b,0==I.lame_encode_frame_init&&function(e,t){var n,i,a=e.internal_flags;if(0==a.lame_encode_frame_init){var s,c,_=r(2014),u=r(2014);for(a.lame_encode_frame_init=1,s=0,c=0;s<286+576*(1+a.mode_gr);++s)s<576*a.mode_gr?(_[s]=0,2==a.channels_out&&(u[s]=0)):(_[s]=t[0][c],2==a.channels_out&&(u[s]=t[1][c]),++c);for(i=0;i<a.mode_gr;i++)for(n=0;n<a.channels_out;n++)a.l3_side.tt[i][n].block_type=l.SHORT_TYPE;v.mdct_sub48(a,_,u),o(576>=l.FFTOFFSET),o(a.mf_size>=l.BLKSIZE+e.framesize-l.FFTOFFSET),o(a.mf_size>=512+e.framesize-32)}}(e,T),I.padding=0,(I.slot_lag-=I.frac_SpF)<0&&(I.slot_lag+=e.out_samplerate,I.padding=1),0!=I.psymodel){var N=[null,null],L=0,V=s(2);for(k=0;k<I.mode_gr;k++){for(E=0;E<I.channels_out;E++)N[E]=T[E],L=576+576*k-l.FFTOFFSET;if(0!=(e.VBR==n.vbr_mtrh||e.VBR==n.vbr_mt?h.L3psycho_anal_vbr(e,N,L,k,A,B,O[k],C[k],x[k],V):h.L3psycho_anal_ns(e,N,L,k,A,B,O[k],C[k],x[k],V)))return-4;for(e.mode==MPEGMode.JOINT_STEREO&&(P[k]=x[k][2]+x[k][3],P[k]>0&&(P[k]=x[k][3]/P[k])),E=0;E<I.channels_out;E++){var D=I.l3_side.tt[k][E];D.block_type=V[E],D.mixed_block_flag=0}}}else for(k=0;k<I.mode_gr;k++)for(E=0;E<I.channels_out;E++)I.l3_side.tt[k][E].block_type=l.NORM_TYPE,I.l3_side.tt[k][E].mixed_block_flag=0,C[k][E]=O[k][E]=700;if(function(e){var t,n;if(0!=e.ATH.useAdjust)if(n=e.loudness_sq[0][0],t=e.loudness_sq[1][0],2==e.channels_out?(n+=e.loudness_sq[0][1],t+=e.loudness_sq[1][1]):(n+=n,t+=t),2==e.mode_gr&&(n=Math.max(n,t)),n*=.5,(n*=e.ATH.aaSensitivityP)>.03125)e.ATH.adjust>=1?e.ATH.adjust=1:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=1;else{var i=31.98*n+625e-6;e.ATH.adjust>=i?(e.ATH.adjust*=.075*i+.925,e.ATH.adjust<i&&(e.ATH.adjust=i)):e.ATH.adjustLimit>=i?e.ATH.adjust=i:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=i}else e.ATH.adjust=1}(I),v.mdct_sub48(I,T[0],T[1]),I.mode_ext=l.MPG_MD_LR_LR,e.force_ms)I.mode_ext=l.MPG_MD_MS_LR;else if(e.mode==MPEGMode.JOINT_STEREO){var H=0,F=0;for(k=0;k<I.mode_gr;k++)for(E=0;E<I.channels_out;E++)H+=C[k][E],F+=O[k][E];if(H<=1*F){var j=I.l3_side.tt[0],X=I.l3_side.tt[I.mode_gr-1];j[0].block_type==j[1].block_type&&X[0].block_type==X[1].block_type&&(I.mode_ext=l.MPG_MD_MS_LR)}}if(I.mode_ext==u?(M=B,R=C):(M=A,R=O),e.analysis&&null!=I.pinfo)for(k=0;k<I.mode_gr;k++)for(E=0;E<I.channels_out;E++)I.pinfo.ms_ratio[k]=I.ms_ratio[k],I.pinfo.ms_ener_ratio[k]=P[k],I.pinfo.blocktype[k][E]=I.l3_side.tt[k][E].block_type,I.pinfo.pe[k][E]=R[k][E],t.arraycopy(I.l3_side.tt[k][E].xr,0,I.pinfo.xr[k][E],0,576),I.mode_ext==u&&(I.pinfo.ers[k][E]=I.pinfo.ers[k][E+2],t.arraycopy(I.pinfo.energy[k][E+2],0,I.pinfo.energy[k][E],0,I.pinfo.energy[k][E].length));if(e.VBR==n.vbr_off||e.VBR==n.vbr_abr){var q,Y;for(q=0;q<18;q++)I.nsPsy.pefirbuf[q]=I.nsPsy.pefirbuf[q+1];for(Y=0,k=0;k<I.mode_gr;k++)for(E=0;E<I.channels_out;E++)Y+=R[k][E];for(I.nsPsy.pefirbuf[18]=Y,Y=I.nsPsy.pefirbuf[9],q=0;q<9;q++)Y+=(I.nsPsy.pefirbuf[q]+I.nsPsy.pefirbuf[18-q])*l.fircoef[q];for(Y=3350*I.mode_gr*I.channels_out/Y,k=0;k<I.mode_gr;k++)for(E=0;E<I.channels_out;E++)R[k][E]*=Y}if(I.iteration_loop.iteration_loop(e,R,P,M),f.format_bitstream(e),S=f.copy_buffer(I,g,y,w,1),e.bWriteVbrTag&&d.addVbrFrame(e),e.analysis&&null!=I.pinfo){for(E=0;E<I.channels_out;E++){var U;for(U=0;U<_;U++)I.pinfo.pcmdata[E][U]=I.pinfo.pcmdata[E][U+e.framesize];for(U=_;U<1600;U++)I.pinfo.pcmdata[E][U]=T[E][U-_]}p.set_frame_pinfo(e,M)}return function(e){var t,n;for(o(0<=e.bitrate_index&&e.bitrate_index<16),o(0<=e.mode_ext&&e.mode_ext<4),e.bitrate_stereoMode_Hist[e.bitrate_index][4]++,e.bitrate_stereoMode_Hist[15][4]++,2==e.channels_out&&(e.bitrate_stereoMode_Hist[e.bitrate_index][e.mode_ext]++,e.bitrate_stereoMode_Hist[15][e.mode_ext]++),t=0;t<e.mode_gr;++t)for(n=0;n<e.channels_out;++n){var i=0|e.l3_side.tt[t][n].block_type;0!=e.l3_side.tt[t][n].mixed_block_flag&&(i=4),e.bitrate_blockType_Hist[e.bitrate_index][i]++,e.bitrate_blockType_Hist[e.bitrate_index][5]++,e.bitrate_blockType_Hist[15][i]++,e.bitrate_blockType_Hist[15][5]++}}(I),S}}return l.ENCDELAY=576,l.POSTDELAY=1152,l.MDCTDELAY=48,l.FFTOFFSET=224+l.MDCTDELAY,l.DECDELAY=528,l.SBLIMIT=32,l.CBANDS=64,l.SBPSY_l=21,l.SBPSY_s=12,l.SBMAX_l=22,l.SBMAX_s=13,l.PSFB21=6,l.PSFB12=6,l.BLKSIZE=1024,l.HBLKSIZE=l.BLKSIZE/2+1,l.BLKSIZE_s=256,l.HBLKSIZE_s=l.BLKSIZE_s/2+1,l.NORM_TYPE=0,l.START_TYPE=1,l.SHORT_TYPE=2,l.STOP_TYPE=3,l.MPG_MD_LR_LR=0,l.MPG_MD_LR_I=1,l.MPG_MD_MS_LR=2,l.MPG_MD_MS_I=3,l.fircoef=[-.1039435,-.1892065,5*-.0432472,-.155915,3898045e-23,.0467745*5,.50455,.756825,.187098*5],bn=l}function Ii(){if(An)return Sn;An=1;var e=Ei();e.System;var t=e.VbrMode,n=e.Float,i=e.ShortBlock,r=e.Util,a=e.Arrays;e.new_array_n,e.new_byte,e.new_double;var s=e.new_float,o=e.new_float_n,l=e.new_int;e.new_int_n;var c=e.assert,_=function(){if(wn)return yn;wn=1;var e=Ei();e.System,e.VbrMode,e.Float,e.ShortBlock;var t=e.Util;e.Arrays,e.new_array_n,e.new_byte,e.new_double;var n=e.new_float;e.new_float_n,e.new_int,e.new_int_n,e.assert;var i=Ti();return yn=function(){var e=n(i.BLKSIZE),r=n(i.BLKSIZE_s/2),a=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function s(e,n,i){var r,s,o,l=0,c=n+(i<<=1);r=4;do{var _,u,f,h,d,p,v;v=r>>1,p=(d=r<<1)+(h=r),r=d<<1,o=(s=n)+v;do{A=e[s+0]-e[s+h],S=e[s+0]+e[s+h],E=e[s+d]-e[s+p],B=e[s+d]+e[s+p],e[s+d]=S-B,e[s+0]=S+B,e[s+p]=A-E,e[s+h]=A+E,A=e[o+0]-e[o+h],S=e[o+0]+e[o+h],E=t.SQRT2*e[o+p],B=t.SQRT2*e[o+d],e[o+d]=S-B,e[o+0]=S+B,e[o+p]=A-E,e[o+h]=A+E,o+=r,s+=r}while(s<c);for(u=a[l+0],_=a[l+1],f=1;f<v;f++){var m,b;m=1-2*_*_,b=2*_*u,s=n+f,o=n+h-f;do{var g,y,w,S,A,M,B,R,E,k;y=b*e[s+h]-m*e[o+h],g=m*e[s+h]+b*e[o+h],A=e[s+0]-g,S=e[s+0]+g,M=e[o+0]-y,w=e[o+0]+y,y=b*e[s+p]-m*e[o+p],g=m*e[s+p]+b*e[o+p],E=e[s+d]-g,B=e[s+d]+g,k=e[o+d]-y,R=e[o+d]+y,y=_*B-u*k,g=u*B+_*k,e[s+d]=S-g,e[s+0]=S+g,e[o+p]=M-y,e[o+h]=M+y,y=u*R-_*E,g=_*R+u*E,e[o+d]=w-g,e[o+0]=w+g,e[s+p]=A-y,e[s+h]=A+y,o+=r,s+=r}while(s<c);u=(m=u)*a[l+0]-_*a[l+1],_=m*a[l+1]+_*a[l+0]}l+=2}while(r<i)}var o=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(e,t,n,a,l){for(var c=0;c<3;c++){var _=i.BLKSIZE_s/2,u=65535&192*(c+1),f=i.BLKSIZE_s/8-1;do{var h,d,p,v,m,b=255&o[f<<2];d=(h=r[b]*a[n][l+b+u])-(m=r[127-b]*a[n][l+b+u+128]),h+=m,v=(p=r[b+64]*a[n][l+b+u+64])-(m=r[63-b]*a[n][l+b+u+192]),p+=m,_-=4,t[c][_+0]=h+p,t[c][_+2]=h-p,t[c][_+1]=d+v,t[c][_+3]=d-v,d=(h=r[b+1]*a[n][l+b+u+1])-(m=r[126-b]*a[n][l+b+u+129]),h+=m,v=(p=r[b+65]*a[n][l+b+u+65])-(m=r[62-b]*a[n][l+b+u+193]),p+=m,t[c][_+i.BLKSIZE_s/2+0]=h+p,t[c][_+i.BLKSIZE_s/2+2]=h-p,t[c][_+i.BLKSIZE_s/2+1]=d+v,t[c][_+i.BLKSIZE_s/2+3]=d-v}while(--f>=0);s(t[c],_,i.BLKSIZE_s/2)}},this.fft_long=function(t,n,r,a,l){var c=i.BLKSIZE/8-1,_=i.BLKSIZE/2;do{var u,f,h,d,p,v=255&o[c];f=(u=e[v]*a[r][l+v])-(p=e[v+512]*a[r][l+v+512]),u+=p,d=(h=e[v+256]*a[r][l+v+256])-(p=e[v+768]*a[r][l+v+768]),h+=p,n[0+(_-=4)]=u+h,n[_+2]=u-h,n[_+1]=f+d,n[_+3]=f-d,f=(u=e[v+1]*a[r][l+v+1])-(p=e[v+513]*a[r][l+v+513]),u+=p,d=(h=e[v+257]*a[r][l+v+257])-(p=e[v+769]*a[r][l+v+769]),h+=p,n[_+i.BLKSIZE/2+0]=u+h,n[_+i.BLKSIZE/2+2]=u-h,n[_+i.BLKSIZE/2+1]=f+d,n[_+i.BLKSIZE/2+3]=f-d}while(--c>=0);s(n,_,i.BLKSIZE/2)},this.init_fft=function(t){for(var n=0;n<i.BLKSIZE;n++)e[n]=.42-.5*Math.cos(2*Math.PI*(n+.5)/i.BLKSIZE)+.08*Math.cos(4*Math.PI*(n+.5)/i.BLKSIZE);for(n=0;n<i.BLKSIZE_s/2;n++)r[n]=.5*(1-Math.cos(2*Math.PI*(n+.5)/i.BLKSIZE_s))}},yn}(),u=Ti();return Sn=function(){var e=new _,f=2.302585092994046,h=1/217621504/(u.BLKSIZE/2),d=.3,p=21,v=.2302585093;function m(e){return e}function b(e,t){for(var n=0,i=0;i<u.BLKSIZE/2;++i)n+=e[i]*t.ATH.eql_w[i];return n*=h}function g(t,n,i,a,s,o,l,c,_,f,h){var d=t.internal_flags;if(_<2)e.fft_long(d,a[s],_,f,h),e.fft_short(d,o[l],_,f,h);else if(2==_){for(var p=u.BLKSIZE-1;p>=0;--p){var v=a[s+0][p],g=a[s+1][p];a[s+0][p]=(v+g)*r.SQRT2*.5,a[s+1][p]=(v-g)*r.SQRT2*.5}for(var y=2;y>=0;--y)for(p=u.BLKSIZE_s-1;p>=0;--p){v=o[l+0][y][p],g=o[l+1][y][p];o[l+0][y][p]=(v+g)*r.SQRT2*.5,o[l+1][y][p]=(v-g)*r.SQRT2*.5}}n[0]=a[s+0][0],n[0]*=n[0];for(p=u.BLKSIZE/2-1;p>=0;--p){var w=a[s+0][u.BLKSIZE/2-p],S=a[s+0][u.BLKSIZE/2+p];n[u.BLKSIZE/2-p]=m(.5*(w*w+S*S))}for(y=2;y>=0;--y){i[y][0]=o[l+0][y][0],i[y][0]*=i[y][0];for(p=u.BLKSIZE_s/2-1;p>=0;--p){w=o[l+0][y][u.BLKSIZE_s/2-p],S=o[l+0][y][u.BLKSIZE_s/2+p];i[y][u.BLKSIZE_s/2-p]=m(.5*(w*w+S*S))}}var A=0;for(p=11;p<u.HBLKSIZE;p++)A+=n[p];if(d.tot_ener[_]=A,t.analysis){for(p=0;p<u.HBLKSIZE;p++)d.pinfo.energy[c][_][p]=d.pinfo.energy_save[_][p],d.pinfo.energy_save[_][p]=n[p];d.pinfo.pe[c][_]=d.pe[_]}2==t.athaa_loudapprox&&_<2&&(d.loudness_sq[c][_]=d.loudness_sq_save[_],d.loudness_sq_save[_]=b(n,d))}var y,w,S,A=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749],M=[3.3246*3.3246,3.23837*3.23837,9.9500500969,9.0247369744,8.1854926609,7.0440875649,2.46209*2.46209,2.284*2.284,4.4892710641,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,2.4621061921,2.1508568964,1.37074*1.37074,1.31036*1.31036,1.5691069696,1.4555939904,1.16203*1.16203,1.2715945225,1.09428*1.09428,1.0659*1.0659,1.0779838276,1.0382591025,1],B=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],R=[5.5396212496,2.29259*2.29259,4.9868695969,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,2.2499700001,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.2339655056,1.0779838276];function E(e,t,n,i,a,s){var o;if(t>e){if(!(t<e*w))return e+t;o=t/e}else{if(e>=t*w)return e+t;o=e/t}if(c(e>=0),c(t>=0),e+=t,i+3<=6){if(o>=y)return e;var l=0|r.FAST_LOG10_X(o,16);return e*B[l]}var _,u;l=0|r.FAST_LOG10_X(o,16);return t=a.ATH.cb_l[n]*a.ATH.adjust,c(t>=0),e<S*t?e>t?(_=1,l<=13&&(_=R[l]),u=r.FAST_LOG10_X(e/t,10/15),e*((M[l]-_)*u+_)):l>13?e:e*R[l]:e*M[l]}var k=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1];function T(e,t,n){var i;if(e<0&&(e=0),t<0&&(t=0),e<=0)return t;if(t<=0)return e;if(i=t>e?t/e:e/t,-2<=n&&n<=2){if(i>=y)return e+t;var a=0|r.FAST_LOG10_X(i,16);return(e+t)*k[a]}return i<w?e+t:(e<t&&(e=t),e)}function I(e,t,n,i,r){var a,s,o=0,l=0;for(a=s=0;a<u.SBMAX_s;++s,++a){for(var _=e.bo_s[a],f=e.npart_s,h=_<f?_:f;s<h;)c(t[s]>=0),c(n[s]>=0),o+=t[s],l+=n[s],s++;if(e.en[i].s[a][r]=o,e.thm[i].s[a][r]=l,s>=f){++a;break}c(t[s]>=0),c(n[s]>=0);var d=e.PSY.bo_s_weight[a],p=1-d;o=d*t[s],l=d*n[s],e.en[i].s[a][r]+=o,e.thm[i].s[a][r]+=l,o=p*t[s],l=p*n[s]}for(;a<u.SBMAX_s;++a)e.en[i].s[a][r]=0,e.thm[i].s[a][r]=0}function x(e,t,n,i){var r,a,s=0,o=0;for(r=a=0;r<u.SBMAX_l;++a,++r){for(var l=e.bo_l[r],_=e.npart_l,f=l<_?l:_;a<f;)c(t[a]>=0),c(n[a]>=0),s+=t[a],o+=n[a],a++;if(e.en[i].l[r]=s,e.thm[i].l[r]=o,a>=_){++r;break}c(t[a]>=0),c(n[a]>=0);var h=e.PSY.bo_l_weight[r],d=1-h;s=h*t[a],o=h*n[a],e.en[i].l[r]+=s,e.thm[i].l[r]+=o,s=d*t[a],o=d*n[a]}for(;r<u.SBMAX_l;++r)e.en[i].l[r]=0,e.thm[i].l[r]=0}function P(e,t,n,i,r,a){var s,o,l=e.internal_flags;for(o=s=0;o<l.npart_s;++o){for(var _=0,f=l.numlines_s[o],h=0;h<f;++h,++s){_+=t[a][s]}n[o]=_}for(c(o==l.npart_s),c(129==s),s=o=0;o<l.npart_s;o++){var d=l.s3ind_s[o][0],p=l.s3_ss[s++]*n[d];for(++d;d<=l.s3ind_s[o][1];)p+=l.s3_ss[s]*n[d],++s,++d;var v=2*l.nb_s1[r][o];if(i[o]=Math.min(p,v),l.blocktype_old[1&r]==u.SHORT_TYPE){v=16*l.nb_s2[r][o];var m=i[o];i[o]=Math.min(v,m)}l.nb_s2[r][o]=l.nb_s1[r][o],l.nb_s1[r][o]=p,c(i[o]>=0)}for(;o<=u.CBANDS;++o)n[o]=0,i[o]=0}function O(e,t,n){return n>=1?e:n<=0?t:t>0?Math.pow(e/t,n)*t:0}var C=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function N(e,t){for(var n=309.07,i=0;i<u.SBMAX_s-1;i++)for(var a=0;a<3;a++){var s=e.thm.s[i][a];if(c(i<C.length),s>0){var o=s*t,l=e.en.s[i][a];l>o&&(l>1e10*o?n+=C[i]*(10*f):(c(o>0),n+=C[i]*r.FAST_LOG10(l/o)))}}return n}var L=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function V(e,t){for(var n=281.0575,i=0;i<u.SBMAX_l-1;i++){var a=e.thm.l[i];if(c(i<L.length),a>0){var s=a*t,o=e.en.l[i];o>s&&(o>1e10*s?n+=L[i]*(10*f):(c(s>0),n+=L[i]*r.FAST_LOG10(o/s)))}}return n}function D(e,t,n,i,r){var a,s;for(a=s=0;a<e.npart_l;++a){var o,l=0,_=0;for(o=0;o<e.numlines_l[a];++o,++s){var u=t[s];c(u>=0),l+=u,_<u&&(_=u)}n[a]=l,i[a]=_,r[a]=l*e.rnumlines_l[a],c(e.rnumlines_l[a]>=0),c(l>=0),c(n[a]>=0),c(i[a]>=0),c(r[a]>=0)}}function H(e,t,n,i){var r=A.length-1,a=0,s=n[a]+n[a+1];(c(s>=0),s>0)?((o=t[a])<t[a+1]&&(o=t[a+1]),c(e.numlines_l[a]+e.numlines_l[a+1]-1>0),(l=0|(s=20*(2*o-s)/(s*(e.numlines_l[a]+e.numlines_l[a+1]-1))))>r&&(l=r),i[a]=l):i[a]=0;for(a=1;a<e.npart_l-1;a++){var o,l;if(s=n[a-1]+n[a]+n[a+1],c(s>=0),s>0)(o=t[a-1])<t[a]&&(o=t[a]),o<t[a+1]&&(o=t[a+1]),c(e.numlines_l[a-1]+e.numlines_l[a]+e.numlines_l[a+1]-1>0),(l=0|(s=20*(3*o-s)/(s*(e.numlines_l[a-1]+e.numlines_l[a]+e.numlines_l[a+1]-1))))>r&&(l=r),i[a]=l;else i[a]=0}(c(a>0),c(a==e.npart_l-1),s=n[a-1]+n[a],c(s>=0),s>0)?((o=t[a-1])<t[a]&&(o=t[a]),c(e.numlines_l[a-1]+e.numlines_l[a]-1>0),(l=0|(s=20*(2*o-s)/(s*(e.numlines_l[a-1]+e.numlines_l[a]-1))))>r&&(l=r),i[a]=l):i[a]=0;c(a==e.npart_l-1)}var F=[-1730326e-23,-.01703172,-1349528e-23,.0418072,-673278e-22,-.0876324,-30835e-21,.1863476,-1104424e-22,-.627638];function j(t,n,i,a,s,o,l,c){var _=t.internal_flags;if(a<2)e.fft_long(_,l[c],a,n,i);else if(2==a)for(var f=u.BLKSIZE-1;f>=0;--f){var h=l[c+0][f],d=l[c+1][f];l[c+0][f]=(h+d)*r.SQRT2*.5,l[c+1][f]=(h-d)*r.SQRT2*.5}o[0]=l[c+0][0],o[0]*=o[0];for(f=u.BLKSIZE/2-1;f>=0;--f){var p=l[c+0][u.BLKSIZE/2-f],v=l[c+0][u.BLKSIZE/2+f];o[u.BLKSIZE/2-f]=m(.5*(p*p+v*v))}var b=0;for(f=11;f<u.HBLKSIZE;f++)b+=o[f];if(_.tot_ener[a]=b,t.analysis){for(f=0;f<u.HBLKSIZE;f++)_.pinfo.energy[s][a][f]=_.pinfo.energy_save[a][f],_.pinfo.energy_save[a][f]=o[f];_.pinfo.pe[s][a]=_.pe[a]}}function X(t,n,i,a,s,o,l,c){var _=t.internal_flags;if(0==s&&a<2&&e.fft_short(_,l[c],a,n,i),2==a)for(var f=u.BLKSIZE_s-1;f>=0;--f){var h=l[c+0][s][f],d=l[c+1][s][f];l[c+0][s][f]=(h+d)*r.SQRT2*.5,l[c+1][s][f]=(h-d)*r.SQRT2*.5}o[s][0]=l[c+0][s][0],o[s][0]*=o[s][0];for(f=u.BLKSIZE_s/2-1;f>=0;--f){var p=l[c+0][s][u.BLKSIZE_s/2-f],v=l[c+0][s][u.BLKSIZE_s/2+f];o[s][u.BLKSIZE_s/2-f]=m(.5*(p*p+v*v))}}function q(e,t,n,i){var r=e.internal_flags;2==e.athaa_loudapprox&&n<2&&(r.loudness_sq[t][n]=r.loudness_sq_save[n],r.loudness_sq_save[n]=b(i,r))}this.L3psycho_anal_ns=function(e,n,r,_,f,h,v,m,b,y){var w,S,M,B,R,k,T,C,L,j,X=e.internal_flags,q=o([2,u.BLKSIZE]),Y=o([2,3,u.BLKSIZE_s]),U=s(u.CBANDS+1),G=s(u.CBANDS+1),K=s(u.CBANDS+2),z=l(2),Z=l(2),W=o([2,576]),$=l(u.CBANDS+2),Q=l(u.CBANDS+2);for(a.fill(Q,0),w=X.channels_out,e.mode==MPEGMode.JOINT_STEREO&&(w=4),L=e.VBR==t.vbr_off?0==X.ResvMax?0:X.ResvSize/X.ResvMax*.5:e.VBR==t.vbr_rh||e.VBR==t.vbr_mtrh||e.VBR==t.vbr_mt?.6:1,S=0;S<X.channels_out;S++){var J=n[S],ee=r+576-350-p+192;for(c(10==F.length),B=0;B<576;B++){var te,ne;for(te=J[ee+B+10],ne=0,R=0;R<9;R+=2)te+=F[R]*(J[ee+B+R]+J[ee+B+p-R]),ne+=F[R+1]*(J[ee+B+R+1]+J[ee+B+p-R-1]);W[S][B]=te+ne}f[_][S].en.assign(X.en[S]),f[_][S].thm.assign(X.thm[S]),w>2&&(h[_][S].en.assign(X.en[S+2]),h[_][S].thm.assign(X.thm[S+2]))}for(S=0;S<w;S++){var ie,re=s(12),ae=[0,0,0,0],se=s(12),oe=1,le=s(u.CBANDS),ce=s(u.CBANDS),_e=[0,0,0,0],ue=s(u.HBLKSIZE),fe=o([3,u.HBLKSIZE_s]);for(c(X.npart_s<=u.CBANDS),c(X.npart_l<=u.CBANDS),B=0;B<3;B++)re[B]=X.nsPsy.last_en_subshort[S][B+6],c(X.nsPsy.last_en_subshort[S][B+4]>0),se[B]=re[B]/X.nsPsy.last_en_subshort[S][B+4],ae[0]+=re[B];if(2==S)for(B=0;B<576;B++){var he,de;he=W[0][B],de=W[1][B],W[0][B]=he+de,W[1][B]=he-de}var pe=W[1&S],ve=0;for(B=0;B<9;B++){for(var me=ve+64,be=1;ve<me;ve++)be<Math.abs(pe[ve])&&(be=Math.abs(pe[ve]));X.nsPsy.last_en_subshort[S][B]=re[B+3]=be,ae[1+B/3]+=be,be>re[B+3-2]?(c(re[B+3-2]>0),be/=re[B+3-2]):re[B+3-2]>10*be?(c(be>0),be=re[B+3-2]/(10*be)):be=0,se[B+3]=be}if(e.analysis){var ge=se[0];for(B=1;B<12;B++)ge<se[B]&&(ge=se[B]);X.pinfo.ers[_][S]=X.pinfo.ers_save[S],X.pinfo.ers_save[S]=ge}for(ie=3==S?X.nsPsy.attackthre_s:X.nsPsy.attackthre,B=0;B<12;B++)0==_e[B/3]&&se[B]>ie&&(_e[B/3]=B%3+1);for(B=1;B<4;B++){var ye;ae[B-1]>ae[B]?(c(ae[B]>0),ye=ae[B-1]/ae[B]):(c(ae[B-1]>0),ye=ae[B]/ae[B-1]),ye<1.7&&(_e[B]=0,1==B&&(_e[0]=0))}for(0!=_e[0]&&0!=X.nsPsy.lastAttacks[S]&&(_e[0]=0),3!=X.nsPsy.lastAttacks[S]&&_e[0]+_e[1]+_e[2]+_e[3]==0||(oe=0,0!=_e[1]&&0!=_e[0]&&(_e[1]=0),0!=_e[2]&&0!=_e[1]&&(_e[2]=0),0!=_e[3]&&0!=_e[2]&&(_e[3]=0)),S<2?Z[S]=oe:0==oe&&(Z[0]=Z[1]=0),b[S]=X.tot_ener[S],g(e,ue,fe,q,1&S,Y,1&S,_,S,n,r),D(X,ue,U,le,ce),H(X,le,ce,$),C=0;C<3;C++){var we,Se;for(P(e,fe,G,K,S,C),I(X,G,K,S,C),T=0;T<u.SBMAX_s;T++){if(Se=X.thm[S].s[T][C],Se*=.8,_e[C]>=2||1==_e[C+1]){var Ae=0!=C?C-1:2;be=O(X.thm[S].s[T][Ae],Se,.6*L);Se=Math.min(Se,be)}if(1==_e[C]){Ae=0!=C?C-1:2,be=O(X.thm[S].s[T][Ae],Se,d*L);Se=Math.min(Se,be)}else if(0!=C&&3==_e[C-1]||0==C&&3==X.nsPsy.lastAttacks[S]){Ae=2!=C?C+1:0,be=O(X.thm[S].s[T][Ae],Se,d*L);Se=Math.min(Se,be)}we=re[3*C+3]+re[3*C+4]+re[3*C+5],6*re[3*C+5]<we&&(Se*=.5,6*re[3*C+4]<we&&(Se*=.5)),X.thm[S].s[T][C]=Se}}for(X.nsPsy.lastAttacks[S]=_e[2],k=0,M=0;M<X.npart_l;M++){for(var Me=X.s3ind[M][0],Be=U[Me]*A[$[Me]],Re=X.s3_ll[k++]*Be;++Me<=X.s3ind[M][1];)Be=U[Me]*A[$[Me]],Re=E(Re,X.s3_ll[k++]*Be,Me,Me-M,X);Re*=.158489319246111,X.blocktype_old[1&S]==u.SHORT_TYPE?K[M]=Re:K[M]=O(Math.min(Re,Math.min(2*X.nb_1[S][M],16*X.nb_2[S][M])),Re,L),X.nb_2[S][M]=X.nb_1[S][M],X.nb_1[S][M]=Re}for(;M<=u.CBANDS;++M)U[M]=0,K[M]=0;x(X,U,K,S)}(e.mode!=MPEGMode.STEREO&&e.mode!=MPEGMode.JOINT_STEREO||e.interChRatio>0&&function(e,t){var n=e.internal_flags;if(n.channels_out>1){for(var i=0;i<u.SBMAX_l;i++){var r=n.thm[0].l[i],a=n.thm[1].l[i];n.thm[0].l[i]+=a*t,n.thm[1].l[i]+=r*t}for(i=0;i<u.SBMAX_s;i++)for(var s=0;s<3;s++)r=n.thm[0].s[i][s],a=n.thm[1].s[i][s],n.thm[0].s[i][s]+=a*t,n.thm[1].s[i][s]+=r*t}}(e,e.interChRatio),e.mode==MPEGMode.JOINT_STEREO)&&(!function(e){for(var t=0;t<u.SBMAX_l;t++)if(!(e.thm[0].l[t]>1.58*e.thm[1].l[t]||e.thm[1].l[t]>1.58*e.thm[0].l[t])){var n=e.mld_l[t]*e.en[3].l[t],i=Math.max(e.thm[2].l[t],Math.min(e.thm[3].l[t],n));n=e.mld_l[t]*e.en[2].l[t];var r=Math.max(e.thm[3].l[t],Math.min(e.thm[2].l[t],n));e.thm[2].l[t]=i,e.thm[3].l[t]=r}for(t=0;t<u.SBMAX_s;t++)for(var a=0;a<3;a++)e.thm[0].s[t][a]>1.58*e.thm[1].s[t][a]||e.thm[1].s[t][a]>1.58*e.thm[0].s[t][a]||(n=e.mld_s[t]*e.en[3].s[t][a],i=Math.max(e.thm[2].s[t][a],Math.min(e.thm[3].s[t][a],n)),n=e.mld_s[t]*e.en[2].s[t][a],r=Math.max(e.thm[3].s[t][a],Math.min(e.thm[2].s[t][a],n)),e.thm[2].s[t][a]=i,e.thm[3].s[t][a]=r)}(X),j=e.msfix,Math.abs(j)>0&&function(e,t,n){var i=t,r=Math.pow(10,n);t*=2,i*=2;for(var a=0;a<u.SBMAX_l;a++)f=e.ATH.cb_l[e.bm_l[a]]*r,(o=Math.min(Math.max(e.thm[0].l[a],f),Math.max(e.thm[1].l[a],f)))*t<(l=Math.max(e.thm[2].l[a],f))+(_=Math.max(e.thm[3].l[a],f))&&c((l*=h=o*i/(l+_))+(_*=h)>0),e.thm[2].l[a]=Math.min(l,e.thm[2].l[a]),e.thm[3].l[a]=Math.min(_,e.thm[3].l[a]);for(r*=u.BLKSIZE_s/u.BLKSIZE,a=0;a<u.SBMAX_s;a++)for(var s=0;s<3;s++){var o,l,_,f,h;f=e.ATH.cb_s[e.bm_s[a]]*r,(o=Math.min(Math.max(e.thm[0].s[a][s],f),Math.max(e.thm[1].s[a][s],f)))*t<(l=Math.max(e.thm[2].s[a][s],f))+(_=Math.max(e.thm[3].s[a][s],f))&&c((l*=h=o*t/(l+_))+(_*=h)>0),e.thm[2].s[a][s]=Math.min(e.thm[2].s[a][s],l),e.thm[3].s[a][s]=Math.min(e.thm[3].s[a][s],_)}}(X,j,e.ATHlower*X.ATH.adjust));for(function(e,t,n,r){var a=e.internal_flags;e.short_blocks!=i.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var s=0;s<a.channels_out;s++)r[s]=u.NORM_TYPE,e.short_blocks==i.short_block_dispensed&&(t[s]=1),e.short_blocks==i.short_block_forced&&(t[s]=0),0!=t[s]?(c(a.blocktype_old[s]!=u.START_TYPE),a.blocktype_old[s]==u.SHORT_TYPE&&(r[s]=u.STOP_TYPE)):(r[s]=u.SHORT_TYPE,a.blocktype_old[s]==u.NORM_TYPE&&(a.blocktype_old[s]=u.START_TYPE),a.blocktype_old[s]==u.STOP_TYPE&&(a.blocktype_old[s]=u.SHORT_TYPE)),n[s]=a.blocktype_old[s],a.blocktype_old[s]=r[s]}(e,Z,y,z),S=0;S<w;S++){var Ee,ke,Te,Ie=0;S>1?(Ee=m,Ie=-2,ke=u.NORM_TYPE,y[0]!=u.SHORT_TYPE&&y[1]!=u.SHORT_TYPE||(ke=u.SHORT_TYPE),Te=h[_][S-2]):(Ee=v,Ie=0,ke=y[S],Te=f[_][S]),ke==u.SHORT_TYPE?Ee[Ie+S]=N(Te,X.masking_lower):Ee[Ie+S]=V(Te,X.masking_lower),e.analysis&&(X.pinfo.pe[_][S]=Ee[Ie+S])}return 0};var Y=[-1730326e-23,-.01703172,-1349528e-23,.0418072,-673278e-22,-.0876324,-30835e-21,.1863476,-1104424e-22,-.627638];function U(e,t,n){if(0==n)for(var i=0;i<e.npart_s;i++)e.nb_s2[t][i]=e.nb_s1[t][i],e.nb_s1[t][i]=0}function G(e,t){for(var n=0;n<e.npart_l;n++)e.nb_2[t][n]=e.nb_1[t][n],e.nb_1[t][n]=0}function K(e,t,n,i,r,a){var o,l,_,f=e.internal_flags,h=new float[u.CBANDS],d=s(u.CBANDS),p=new int[u.CBANDS];for(_=l=0;_<f.npart_s;++_){var v=0,m=0,b=f.numlines_s[_];for(o=0;o<b;++o,++l){var g=t[a][l];v+=g,m<g&&(m=g)}n[_]=v,c(v>=0),h[_]=m,c(b>0),d[_]=v/b,c(d[_]>=0)}for(c(_==f.npart_s),c(129==l);_<u.CBANDS;++_)h[_]=0,d[_]=0;for(function(e,t,n,i){var r=A.length-1,a=0,s=n[a]+n[a+1];for(c(s>=0),s>0?((o=t[a])<t[a+1]&&(o=t[a+1]),c(e.numlines_s[a]+e.numlines_s[a+1]-1>0),(l=0|(s=20*(2*o-s)/(s*(e.numlines_s[a]+e.numlines_s[a+1]-1))))>r&&(l=r),i[a]=l):i[a]=0,a=1;a<e.npart_s-1;a++){var o,l;s=n[a-1]+n[a]+n[a+1],c(a+1<e.npart_s),c(s>=0),s>0?((o=t[a-1])<t[a]&&(o=t[a]),o<t[a+1]&&(o=t[a+1]),c(e.numlines_s[a-1]+e.numlines_s[a]+e.numlines_s[a+1]-1>0),(l=0|(s=20*(3*o-s)/(s*(e.numlines_s[a-1]+e.numlines_s[a]+e.numlines_s[a+1]-1))))>r&&(l=r),i[a]=l):i[a]=0}c(a>0),c(a==e.npart_s-1),s=n[a-1]+n[a],c(s>=0),s>0?((o=t[a-1])<t[a]&&(o=t[a]),c(e.numlines_s[a-1]+e.numlines_s[a]-1>0),(l=0|(s=20*(2*o-s)/(s*(e.numlines_s[a-1]+e.numlines_s[a]-1))))>r&&(l=r),i[a]=l):i[a]=0,c(a==e.npart_s-1)}(f,h,d,p),l=_=0;_<f.npart_s;_++){var y,w,S,M,B,R=f.s3ind_s[_][0],E=f.s3ind_s[_][1];for(y=p[R],w=1,M=f.s3_ss[l]*n[R]*A[p[R]],++l,++R;R<=E;)y+=p[R],w+=1,M=T(M,S=f.s3_ss[l]*n[R]*A[p[R]],R-_),++l,++R;M*=B=.5*A[y=(1+2*y)/(2*w)],i[_]=M,f.nb_s2[r][_]=f.nb_s1[r][_],f.nb_s1[r][_]=M,S=h[_],S*=f.minval_s[_],S*=B,i[_]>S&&(i[_]=S),f.masking_lower>1&&(i[_]*=f.masking_lower),i[_]>n[_]&&(i[_]=n[_]),f.masking_lower<1&&(i[_]*=f.masking_lower),c(i[_]>=0)}for(;_<u.CBANDS;++_)n[_]=0,i[_]=0}function z(e,t,n,i,r){var a,o=s(u.CBANDS),_=s(u.CBANDS),f=l(u.CBANDS+2);D(e,t,n,o,_),H(e,o,_,f);var h=0;for(a=0;a<e.npart_l;a++){var p,v,m,b=e.s3ind[a][0],g=e.s3ind[a][1],y=0,w=0;for(y=f[b],w+=1,v=e.s3_ll[h]*n[b]*A[f[b]],++h,++b;b<=g;)y+=f[b],w+=1,v=T(v,p=e.s3_ll[h]*n[b]*A[f[b]],b-a),++h,++b;if(v*=m=.5*A[y=(1+2*y)/(2*w)],e.blocktype_old[1&r]==u.SHORT_TYPE){var S=2*e.nb_1[r][a];i[a]=S>0?Math.min(v,S):Math.min(v,n[a]*d)}else{var M=16*e.nb_2[r][a],B=2*e.nb_1[r][a];M<=0&&(M=v),B<=0&&(B=v),S=e.blocktype_old[1&r]==u.NORM_TYPE?Math.min(B,M):B,i[a]=Math.min(v,S)}e.nb_2[r][a]=e.nb_1[r][a],e.nb_1[r][a]=v,p=o[a],p*=e.minval_l[a],p*=m,i[a]>p&&(i[a]=p),e.masking_lower>1&&(i[a]*=e.masking_lower),i[a]>n[a]&&(i[a]=n[a]),e.masking_lower<1&&(i[a]*=e.masking_lower),c(i[a]>=0)}for(;a<u.CBANDS;++a)n[a]=0,i[a]=0}function Z(e,t,n,i,r,a,s){for(var o,l,_=2*a,u=a>0?Math.pow(10,r):1,f=0;f<s;++f){var h=e[2][f],d=e[3][f],p=t[0][f],v=t[1][f],m=t[2][f],b=t[3][f];if(p<=1.58*v&&v<=1.58*p){var g=n[f]*d,y=n[f]*h;l=Math.max(m,Math.min(b,g)),o=Math.max(b,Math.min(m,y))}else l=m,o=b;if(a>0){var w,S,A=i[f]*u;if(w=Math.min(Math.max(p,A),Math.max(v,A)),(S=(m=Math.max(l,A))+(b=Math.max(o,A)))>0&&w*_<S){var M=w*_/S;m*=M,b*=M,c(S>0)}l=Math.min(m,l),o=Math.min(b,o)}l>h&&(l=h),o>d&&(o=d),t[2][f]=l,t[3][f]=o}}function W(e,t){var n;return(n=e>=0?27*-e:e*t)<=-72?0:Math.exp(n*v)}function $(e){var t,n,i=0;for(i=0;W(i,e)>1e-20;i-=1);for(r=i,a=0;Math.abs(a-r)>1e-12;)W(i=(a+r)/2,e)>0?a=i:r=i;t=r;var r,a;i=0;for(i=0;W(i,e)>1e-20;i+=1);for(r=0,a=i;Math.abs(a-r)>1e-12;)W(i=(a+r)/2,e)>0?r=i:a=i;n=a;var s,o=0,l=1e3;for(s=0;s<=l;++s){o+=W(i=t+s*(n-t)/l,e)}return(l+1)/(o*(n-t))}function Q(e){var t,n,i,r;return t=e,n=(t*=t>=0?3:1.5)>=.5&&t<=2.5?8*((r=t-.5)*r-2*r):0,(i=15.811389+7.5*(t+=.474)-17.5*Math.sqrt(1+t*t))<=-60?0:(t=Math.exp((n+i)*v),t/=.6609193)}function J(e){return e<0&&(e=0),e*=.001,13*Math.atan(.76*e)+3.5*Math.atan(e*e/56.25)}function ee(e,t,n,i,r,a,o,_,f,h,d,p){var v,m=s(u.CBANDS+1),b=_/(p>15?1152:384),g=l(u.HBLKSIZE);_/=f;var y=0,w=0;for(v=0;v<u.CBANDS;v++){var S;for(x=J(_*y),m[v]=_*y,S=y;J(_*S)-x<.34&&S<=f/2;S++);for(e[v]=S-y,w=v+1;y<S;)c(y<u.HBLKSIZE),g[y++]=v;if(y>f/2){y=f/2,++v;break}}c(v<u.CBANDS),m[v]=_*y;for(var A=0;A<p;A++){var M,B,R,E,k;R=h[A],E=h[A+1],(M=0|Math.floor(.5+d*(R-.5)))<0&&(M=0),(B=0|Math.floor(.5+d*(E-.5)))>f/2&&(B=f/2),n[A]=(g[M]+g[B])/2,t[A]=g[B];var T=b*E;o[A]=(T-m[t[A]])/(m[t[A]+1]-m[t[A]]),o[A]<0?o[A]=0:o[A]>1&&(o[A]=1),k=J(_*h[A]*d),k=Math.min(k,15.5)/15.5,a[A]=Math.pow(10,1.25*(1-Math.cos(Math.PI*k))-2.5)}y=0;for(var I=0;I<w;I++){var x,P,O=e[I];x=J(_*y),P=J(_*(y+O-1)),i[I]=.5*(x+P),x=J(_*(y-.5)),P=J(_*(y+O-.5)),r[I]=P-x,y+=O}return w}function te(e,t,n,i,r,a){var l,c=o([u.CBANDS,u.CBANDS]),_=0;if(a)for(var f=0;f<t;f++)for(l=0;l<t;l++){var h=Q(n[f]-n[l])*i[l];c[f][l]=h*r[f]}else for(l=0;l<t;l++){var d=15+Math.min(21/n[l],12),p=$(d);for(f=0;f<t;f++){h=p*W(n[f]-n[l],d)*i[l];c[f][l]=h*r[f]}}for(f=0;f<t;f++){for(l=0;l<t&&!(c[f][l]>0);l++);for(e[f][0]=l,l=t-1;l>0&&!(c[f][l]>0);l--);e[f][1]=l,_+=e[f][1]-e[f][0]+1}var v=s(_),m=0;for(f=0;f<t;f++)for(l=e[f][0];l<=e[f][1];l++)v[m++]=c[f][l];return v}function ne(e){var t=J(e);return t=Math.min(t,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*t))-2.5)}function ie(e,t){return e<-.3&&(e=3410),e/=1e3,e=Math.max(.1,e),3.64*Math.pow(e,-.8)-6.8*Math.exp(-.6*Math.pow(e-3.4,2))+6*Math.exp(-.15*Math.pow(e-8.7,2))+.001*(.6+.04*t)*Math.pow(e,4)}this.L3psycho_anal_vbr=function(e,t,n,r,a,_,f,h,d,v){var m=e.internal_flags,b=s(u.HBLKSIZE),g=o([3,u.HBLKSIZE_s]),y=o([2,u.BLKSIZE]),w=o([2,3,u.BLKSIZE_s]),S=o([4,u.CBANDS]),A=o([4,u.CBANDS]),M=o([4,3]),B=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],R=l(2),E=e.mode==MPEGMode.JOINT_STEREO?4:m.channels_out;!function(e,t,n,i,r,a,l,_,u,f){for(var h=o([2,576]),d=e.internal_flags,v=d.channels_out,m=e.mode==MPEGMode.JOINT_STEREO?4:v,b=0;b<v;b++){firbuf=t[b];var g=n+576-350-p+192;c(10==Y.length);for(var y=0;y<576;y++){var w,S;w=firbuf[g+y+10],S=0;for(var A=0;A<9;A+=2)w+=Y[A]*(firbuf[g+y+A]+firbuf[g+y+p-A]),S+=Y[A+1]*(firbuf[g+y+A+1]+firbuf[g+y+p-A-1]);h[b][y]=w+S}r[i][b].en.assign(d.en[b]),r[i][b].thm.assign(d.thm[b]),m>2&&(a[i][b].en.assign(d.en[b+2]),a[i][b].thm.assign(d.thm[b+2]))}for(b=0;b<m;b++){var M=s(12),B=s(12),R=[0,0,0,0],E=h[1&b],k=0,T=3==b?d.nsPsy.attackthre_s:d.nsPsy.attackthre,I=1;if(2==b)for(y=0,A=576;A>0;++y,--A){var x=h[0][y],P=h[1][y];h[0][y]=x+P,h[1][y]=x-P}for(y=0;y<3;y++)B[y]=d.nsPsy.last_en_subshort[b][y+6],c(d.nsPsy.last_en_subshort[b][y+4]>0),M[y]=B[y]/d.nsPsy.last_en_subshort[b][y+4],R[0]+=B[y];for(y=0;y<9;y++){for(var O=k+64,C=1;k<O;k++)C<Math.abs(E[k])&&(C=Math.abs(E[k]));d.nsPsy.last_en_subshort[b][y]=B[y+3]=C,R[1+y/3]+=C,C>B[y+3-2]?(c(B[y+3-2]>0),C/=B[y+3-2]):B[y+3-2]>10*C?(c(C>0),C=B[y+3-2]/(10*C)):C=0,M[y+3]=C}for(y=0;y<3;++y){var N=B[3*y+3]+B[3*y+4]+B[3*y+5],L=1;6*B[3*y+5]<N&&(L*=.5,6*B[3*y+4]<N&&(L*=.5)),_[b][y]=L}if(e.analysis){var V=M[0];for(y=1;y<12;y++)V<M[y]&&(V=M[y]);d.pinfo.ers[i][b]=d.pinfo.ers_save[b],d.pinfo.ers_save[b]=V}for(y=0;y<12;y++)0==u[b][y/3]&&M[y]>T&&(u[b][y/3]=y%3+1);for(y=1;y<4;y++){var D=R[y-1],H=R[y];Math.max(D,H)<4e4&&D<1.7*H&&H<1.7*D&&(1==y&&u[b][0]<=u[b][y]&&(u[b][0]=0),u[b][y]=0)}u[b][0]<=d.nsPsy.lastAttacks[b]&&(u[b][0]=0),3!=d.nsPsy.lastAttacks[b]&&u[b][0]+u[b][1]+u[b][2]+u[b][3]==0||(I=0,0!=u[b][1]&&0!=u[b][0]&&(u[b][1]=0),0!=u[b][2]&&0!=u[b][1]&&(u[b][2]=0),0!=u[b][3]&&0!=u[b][2]&&(u[b][3]=0)),b<2?f[b]=I:0==I&&(f[0]=f[1]=0),l[b]=d.tot_ener[b]}}(e,t,n,r,a,_,d,M,B,R),function(e,t){var n=e.internal_flags;e.short_blocks!=i.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var r=0;r<n.channels_out;r++)e.short_blocks==i.short_block_dispensed&&(t[r]=1),e.short_blocks==i.short_block_forced&&(t[r]=0)}(e,R);for(var k=0;k<E;k++){j(e,t,n,k,r,b,y,P=1&k),q(e,r,k,b),0!=R[P]?z(m,b,S[k],A[k],k):G(m,k)}R[0]+R[1]==2&&e.mode==MPEGMode.JOINT_STEREO&&Z(S,A,m.mld_cb_l,m.ATH.cb_l,e.ATHlower*m.ATH.adjust,e.msfix,m.npart_l);for(k=0;k<E;k++){0!=R[P=1&k]&&x(m,S[k],A[k],k)}for(var T=0;T<3;T++){for(k=0;k<E;++k){0!=R[P=1&k]?U(m,k,T):(X(e,t,n,k,T,g,w,P),K(e,g,S[k],A[k],k,T))}R[0]+R[1]==0&&e.mode==MPEGMode.JOINT_STEREO&&Z(S,A,m.mld_cb_s,m.ATH.cb_s,e.ATHlower*m.ATH.adjust,e.msfix,m.npart_s);for(k=0;k<E;++k){0==R[P=1&k]&&I(m,S[k],A[k],k,T)}}for(k=0;k<E;k++){var P;if(0==R[P=1&k])for(var C=0;C<u.SBMAX_s;C++){var L=s(3);for(T=0;T<3;T++){var D=m.thm[k].s[C][T];if(D*=.8,B[k][T]>=2||1==B[k][T+1]){var H=0!=T?T-1:2,F=O(m.thm[k].s[C][H],D,.36);D=Math.min(D,F)}else if(1==B[k][T]){H=0!=T?T-1:2,F=O(m.thm[k].s[C][H],D,.18);D=Math.min(D,F)}else if(0!=T&&3==B[k][T-1]||0==T&&3==m.nsPsy.lastAttacks[k]){H=2!=T?T+1:0,F=O(m.thm[k].s[C][H],D,.18);D=Math.min(D,F)}D*=M[k][T],L[T]=D}for(T=0;T<3;T++)m.thm[k].s[C][T]=L[T]}}for(k=0;k<E;k++)m.nsPsy.lastAttacks[k]=B[k][2];!function(e,t,n){for(var i=e.internal_flags,r=0;r<i.channels_out;r++){var a=u.NORM_TYPE;0!=t[r]?(c(i.blocktype_old[r]!=u.START_TYPE),i.blocktype_old[r]==u.SHORT_TYPE&&(a=u.STOP_TYPE)):(a=u.SHORT_TYPE,i.blocktype_old[r]==u.NORM_TYPE&&(i.blocktype_old[r]=u.START_TYPE),i.blocktype_old[r]==u.STOP_TYPE&&(i.blocktype_old[r]=u.SHORT_TYPE)),n[r]=i.blocktype_old[r],i.blocktype_old[r]=a}}(e,R,v);for(k=0;k<E;k++){var W,$,Q,J;k>1?(W=h,$=-2,Q=u.NORM_TYPE,v[0]!=u.SHORT_TYPE&&v[1]!=u.SHORT_TYPE||(Q=u.SHORT_TYPE),J=_[r][k-2]):(W=f,$=0,Q=v[k],J=a[r][k]),Q==u.SHORT_TYPE?W[$+k]=N(J,m.masking_lower):W[$+k]=V(J,m.masking_lower),e.analysis&&(m.pinfo.pe[r][k]=W[$+k])}return 0},this.psymodel_init=function(i){var r,a=i.internal_flags,o=!0,l=13,_=24,h=0,d=0,p=-8.25,v=-4.5,m=s(u.CBANDS),b=s(u.CBANDS),g=s(u.CBANDS),A=i.out_samplerate;switch(i.experimentalZ){default:case 0:o=!0;break;case 1:o=i.VBR!=t.vbr_mtrh&&i.VBR!=t.vbr_mt;break;case 2:o=!1;break;case 3:l=8,h=-1.75,d=-.0125,p=-8.25,v=-2.25}for(a.ms_ener_ratio_old=.25,a.blocktype_old[0]=a.blocktype_old[1]=u.NORM_TYPE,r=0;r<4;++r){for(var M=0;M<u.CBANDS;++M)a.nb_1[r][M]=1e20,a.nb_2[r][M]=1e20,a.nb_s1[r][M]=a.nb_s2[r][M]=1;for(var B=0;B<u.SBMAX_l;B++)a.en[r].l[B]=1e20,a.thm[r].l[B]=1e20;for(M=0;M<3;++M){for(B=0;B<u.SBMAX_s;B++)a.en[r].s[B][M]=1e20,a.thm[r].s[B][M]=1e20;a.nsPsy.lastAttacks[r]=0}for(M=0;M<9;M++)a.nsPsy.last_en_subshort[r][M]=10}for(a.loudness_sq_save[0]=a.loudness_sq_save[1]=0,a.npart_l=ee(a.numlines_l,a.bo_l,a.bm_l,m,b,a.mld_l,a.PSY.bo_l_weight,A,u.BLKSIZE,a.scalefac_band.l,u.BLKSIZE/1152,u.SBMAX_l),c(a.npart_l<u.CBANDS),r=0;r<a.npart_l;r++){var R=h;m[r]>=l&&(R=d*(m[r]-l)/(_-l)+h*(_-m[r])/(_-l)),g[r]=Math.pow(10,R/10),a.numlines_l[r]>0?a.rnumlines_l[r]=1/a.numlines_l[r]:a.rnumlines_l[r]=0}a.s3_ll=te(a.s3ind,a.npart_l,m,b,g,o);var E;M=0;for(r=0;r<a.npart_l;r++){I=n.MAX_VALUE;for(var k=0;k<a.numlines_l[r];k++,M++){var T=A*M/(1e3*u.BLKSIZE);x=this.ATHformula(1e3*T,i)-20,x=Math.pow(10,.1*x),I>(x*=a.numlines_l[r])&&(I=x)}a.ATH.cb_l[r]=I,(I=20*m[r]/10-20)>6&&(I=100),I<-15&&(I=-15),I-=8,a.minval_l[r]=Math.pow(10,I/10)*a.numlines_l[r]}for(a.npart_s=ee(a.numlines_s,a.bo_s,a.bm_s,m,b,a.mld_s,a.PSY.bo_s_weight,A,u.BLKSIZE_s,a.scalefac_band.s,u.BLKSIZE_s/384,u.SBMAX_s),c(a.npart_s<u.CBANDS),M=0,r=0;r<a.npart_s;r++){var I;R=p;m[r]>=l&&(R=v*(m[r]-l)/(_-l)+p*(_-m[r])/(_-l)),g[r]=Math.pow(10,R/10),I=n.MAX_VALUE;for(k=0;k<a.numlines_s[r];k++,M++){var x;T=A*M/(1e3*u.BLKSIZE_s);x=this.ATHformula(1e3*T,i)-20,x=Math.pow(10,.1*x),I>(x*=a.numlines_s[r])&&(I=x)}a.ATH.cb_s[r]=I,I=7*m[r]/12-7,m[r]>12&&(I*=1+3.1*Math.log(1+I)),m[r]<12&&(I*=1+2.3*Math.log(1-I)),I<-15&&(I=-15),I-=8,a.minval_s[r]=Math.pow(10,I/10)*a.numlines_s[r]}a.s3_ss=te(a.s3ind_s,a.npart_s,m,b,g,o),y=Math.pow(10,9/16),w=Math.pow(10,1.5),S=Math.pow(10,1.5),e.init_fft(a),a.decay=Math.exp(-1*f/(.01*A/192)),E=3.5,2&i.exp_nspsytune&&(E=1),Math.abs(i.msfix)>0&&(E=i.msfix),i.msfix=E;for(var P=0;P<a.npart_l;P++)a.s3ind[P][1]>a.npart_l-1&&(a.s3ind[P][1]=a.npart_l-1);var O=576*a.mode_gr/A;if(a.ATH.decay=Math.pow(10,-1.2*O),a.ATH.adjust=.01,a.ATH.adjustLimit=1,c(a.bo_l[u.SBMAX_l-1]<=a.npart_l),c(a.bo_s[u.SBMAX_s-1]<=a.npart_s),-1!=i.ATHtype){var C=i.out_samplerate/u.BLKSIZE,N=0;for(T=0,r=0;r<u.BLKSIZE/2;++r)T+=C,a.ATH.eql_w[r]=1/Math.pow(10,this.ATHformula(T,i)/10),N+=a.ATH.eql_w[r];for(N=1/N,r=u.BLKSIZE/2;--r>=0;)a.ATH.eql_w[r]*=N}for(P=M=0;P<a.npart_s;++P)for(r=0;r<a.numlines_s[P];++r)++M;c(129==M);for(P=M=0;P<a.npart_l;++P)for(r=0;r<a.numlines_l[P];++r)++M;for(c(513==M),M=0,r=0;r<a.npart_l;r++){T=A*(M+a.numlines_l[r]/2)/(1*u.BLKSIZE);a.mld_cb_l[r]=ne(T),M+=a.numlines_l[r]}for(;r<u.CBANDS;++r)a.mld_cb_l[r]=1;for(M=0,r=0;r<a.npart_s;r++){T=A*(M+a.numlines_s[r]/2)/(1*u.BLKSIZE_s);a.mld_cb_s[r]=ne(T),M+=a.numlines_s[r]}for(;r<u.CBANDS;++r)a.mld_cb_s[r]=1;return 0},this.ATHformula=function(e,t){var n;switch(t.ATHtype){case 0:n=ie(e,9);break;case 1:n=ie(e,-1);break;case 2:default:n=ie(e,0);break;case 3:n=ie(e,1)+6;break;case 4:n=ie(e,t.ATHcurve)}return n}},Sn}function xi(){if(Bn)return Mn;function e(e){var t=e;this.ordinal=function(){return t}}return Bn=1,e.STEREO=new e(0),e.JOINT_STEREO=new e(1),e.DUAL_CHANNEL=new e(2),e.MONO=new e(3),e.NOT_SET=new e(4),Mn=e}function Pi(){if(Tn)return kn;Tn=1;var e=Ti(),t={};return t.SFBMAX=3*e.SBMAX_s,kn=t}function Oi(){if(xn)return In;xn=1;var e=Ei();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double;var t=e.new_float;e.new_float_n;var n=e.new_int;e.new_int_n,e.assert;var i=Pi();return In=function(){this.xr=t(576),this.l3_enc=n(576),this.scalefac=n(i.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=n(3),this.subblock_gain=n(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=n(i.SFBMAX),this.window=n(i.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=n(4),this.max_nonzero_coeff=0;var e=this;function r(e){return new Int32Array(e)}this.assign=function(t){var n;e.xr=(n=t.xr,new Float32Array(n)),e.l3_enc=r(t.l3_enc),e.scalefac=r(t.scalefac),e.xrpow_max=t.xrpow_max,e.part2_3_length=t.part2_3_length,e.big_values=t.big_values,e.count1=t.count1,e.global_gain=t.global_gain,e.scalefac_compress=t.scalefac_compress,e.block_type=t.block_type,e.mixed_block_flag=t.mixed_block_flag,e.table_select=r(t.table_select),e.subblock_gain=r(t.subblock_gain),e.region0_count=t.region0_count,e.region1_count=t.region1_count,e.preflag=t.preflag,e.scalefac_scale=t.scalefac_scale,e.count1table_select=t.count1table_select,e.part2_length=t.part2_length,e.sfb_lmax=t.sfb_lmax,e.sfb_smin=t.sfb_smin,e.psy_lmax=t.psy_lmax,e.sfbmax=t.sfbmax,e.psymax=t.psymax,e.sfbdivide=t.sfbdivide,e.width=r(t.width),e.window=r(t.window),e.count1bits=t.count1bits,e.sfb_partition_table=t.sfb_partition_table.slice(0),e.slen=r(t.slen),e.max_nonzero_coeff=t.max_nonzero_coeff}}}function Ci(){if(Nn)return Cn;Nn=1;var e=Ei(),t=e.System;e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double,e.new_float,e.new_float_n;var n=e.new_int;e.new_int_n,e.assert;var i=Ti();return Cn=function(e,r,a,s){this.l=n(1+i.SBMAX_l),this.s=n(1+i.SBMAX_s),this.psfb21=n(1+i.PSFB21),this.psfb12=n(1+i.PSFB12);var o=this.l,l=this.s;4==arguments.length&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],t.arraycopy(this.arrL,0,o,0,Math.min(this.arrL.length,this.l.length)),t.arraycopy(this.arrS,0,l,0,Math.min(this.arrS.length,this.s.length)),t.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),t.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))},Cn}function Ni(){if(jn)return Fn;jn=1;var e=Ei();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n;var t=e.new_byte,n=e.new_double,i=e.new_float,r=e.new_float_n,a=e.new_int,s=e.new_int_n;e.assert;var o=function(){if(On)return Pn;On=1;var e=Ei();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double,e.new_float,e.new_float_n;var t=e.new_int;e.new_int_n,e.assert;var n=Oi();return Pn=function(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[t(4),t(4)];for(var e=0;e<2;e++)for(var i=0;i<2;i++)this.tt[e][i]=new n}}(),l=Ci(),c=function(){if(Vn)return Ln;Vn=1;var e=Ei();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double;var t=e.new_float,n=e.new_float_n,i=e.new_int;e.new_int_n,e.assert;var r=Ti();return Ln=function(){this.last_en_subshort=n([4,9]),this.lastAttacks=i(4),this.pefirbuf=t(19),this.longfact=t(r.SBMAX_l),this.shortfact=t(r.SBMAX_s),this.attackthre=0,this.attackthre_s=0}}(),_=Hn?Dn:(Hn=1,Dn=function(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}),u=ki(),f=Ti(),h=Pi();function d(){function e(){this.write_timing=0,this.ptr=0,this.buf=t(40)}this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=r([2,d.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new o,this.ms_ratio=i(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=a(2),this.CurrentStep=a(2),this.masking_lower=0,this.bv_scf=a(576),this.pseudohalf=a(h.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*d.BPC+1),this.itime=n(2),this.sideinfo_len=0,this.sb_sample=r([2,2,18,f.SBLIMIT]),this.amp_filter=i(32),this.header=new Array(d.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new l,this.minval_l=i(f.CBANDS),this.minval_s=i(f.CBANDS),this.nb_1=r([4,f.CBANDS]),this.nb_2=r([4,f.CBANDS]),this.nb_s1=r([4,f.CBANDS]),this.nb_s2=r([4,f.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=i(4),this.loudness_sq=r([2,2]),this.loudness_sq_save=i(2),this.mld_l=i(f.SBMAX_l),this.mld_s=i(f.SBMAX_s),this.bm_l=a(f.SBMAX_l),this.bo_l=a(f.SBMAX_l),this.bm_s=a(f.SBMAX_s),this.bo_s=a(f.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=s([f.CBANDS,2]),this.s3ind_s=s([f.CBANDS,2]),this.numlines_s=a(f.CBANDS),this.numlines_l=a(f.CBANDS),this.rnumlines_l=i(f.CBANDS),this.mld_cb_l=i(f.CBANDS),this.mld_cb_s=i(f.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=i(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=a(2),this.nsPsy=new c,this.VBR_seek_table=new _,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=s([16,5]),this.bitrate_blockType_Hist=s([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var p=0;p<this.en.length;p++)this.en[p]=new u;for(p=0;p<this.thm.length;p++)this.thm[p]=new u;for(p=0;p<this.header.length;p++)this.header[p]=new e}return d.MFSIZE=3456+f.ENCDELAY-f.MDCTDELAY,d.MAX_HEADER_BUF=256,d.MAX_BITS_PER_CHANNEL=4095,d.MAX_BITS_PER_GRANULE=7680,d.BPC=320,Fn=d}function Li(){if(Un)return Yn;Un=1;var e=Ei(),t=e.System;e.VbrMode,e.Float,e.ShortBlock,e.Util;var n=e.Arrays;function i(){i.YULE_ORDER;i.MAX_SAMP_FREQ;var e=i.RMS_WINDOW_TIME_NUMERATOR,r=i.RMS_WINDOW_TIME_DENOMINATOR;i.MAX_SAMPLES_PER_WINDOW;var a=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],s=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function o(e,t,n,i,r,a){for(;0!=r--;)n[i]=1e-10+e[t+0]*a[0]-n[i-1]*a[1]+e[t-1]*a[2]-n[i-2]*a[3]+e[t-2]*a[4]-n[i-3]*a[5]+e[t-3]*a[6]-n[i-4]*a[7]+e[t-4]*a[8]-n[i-5]*a[9]+e[t-5]*a[10]-n[i-6]*a[11]+e[t-6]*a[12]-n[i-7]*a[13]+e[t-7]*a[14]-n[i-8]*a[15]+e[t-8]*a[16]-n[i-9]*a[17]+e[t-9]*a[18]-n[i-10]*a[19]+e[t-10]*a[20],++i,++t}function l(e,t,n,i,r,a){for(;0!=r--;)n[i]=e[t+0]*a[0]-n[i-1]*a[1]+e[t-1]*a[2]-n[i-2]*a[3]+e[t-2]*a[4],++i,++t}function c(e){return e*e}this.InitGainAnalysis=function(t,i){return function(t,i){for(var a=0;a<MAX_ORDER;a++)t.linprebuf[a]=t.lstepbuf[a]=t.loutbuf[a]=t.rinprebuf[a]=t.rstepbuf[a]=t.routbuf[a]=0;switch(0|i){case 48e3:t.reqindex=0;break;case 44100:t.reqindex=1;break;case 32e3:t.reqindex=2;break;case 24e3:t.reqindex=3;break;case 22050:t.reqindex=4;break;case 16e3:t.reqindex=5;break;case 12e3:t.reqindex=6;break;case 11025:t.reqindex=7;break;case 8e3:t.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return t.sampleWindow=0|(i*e+r-1)/r,t.lsum=0,t.rsum=0,t.totsamp=0,n.ill(t.A,0),INIT_GAIN_ANALYSIS_OK}(t,i)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(t.linpre=MAX_ORDER,t.rinpre=MAX_ORDER,t.lstep=MAX_ORDER,t.rstep=MAX_ORDER,t.lout=MAX_ORDER,t.rout=MAX_ORDER,n.fill(t.B,0),INIT_GAIN_ANALYSIS_OK)},this.AnalyzeSamples=function(e,n,r,_,u,f,h){var d,p,v,m,b,g,y;if(0==f)return GAIN_ANALYSIS_OK;switch(y=0,b=f,h){case 1:_=n,u=r;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(f<MAX_ORDER?(t.arraycopy(n,r,e.linprebuf,MAX_ORDER,f),t.arraycopy(_,u,e.rinprebuf,MAX_ORDER,f)):(t.arraycopy(n,r,e.linprebuf,MAX_ORDER,MAX_ORDER),t.arraycopy(_,u,e.rinprebuf,MAX_ORDER,MAX_ORDER));b>0;){g=b>e.sampleWindow-e.totsamp?e.sampleWindow-e.totsamp:b,y<MAX_ORDER?(d=e.linpre+y,p=e.linprebuf,v=e.rinpre+y,m=e.rinprebuf,g>MAX_ORDER-y&&(g=MAX_ORDER-y)):(d=r+y,p=n,v=u+y,m=_),o(p,d,e.lstepbuf,e.lstep+e.totsamp,g,a[e.reqindex]),o(m,v,e.rstepbuf,e.rstep+e.totsamp,g,a[e.reqindex]),l(e.lstepbuf,e.lstep+e.totsamp,e.loutbuf,e.lout+e.totsamp,g,s[e.reqindex]),l(e.rstepbuf,e.rstep+e.totsamp,e.routbuf,e.rout+e.totsamp,g,s[e.reqindex]),d=e.lout+e.totsamp,p=e.loutbuf,v=e.rout+e.totsamp,m=e.routbuf;for(var w=g%8;0!=w--;)e.lsum+=c(p[d++]),e.rsum+=c(m[v++]);for(w=g/8;0!=w--;)e.lsum+=c(p[d+0])+c(p[d+1])+c(p[d+2])+c(p[d+3])+c(p[d+4])+c(p[d+5])+c(p[d+6])+c(p[d+7]),d+=8,e.rsum+=c(m[v+0])+c(m[v+1])+c(m[v+2])+c(m[v+3])+c(m[v+4])+c(m[v+5])+c(m[v+6])+c(m[v+7]),v+=8;if(b-=g,y+=g,e.totsamp+=g,e.totsamp==e.sampleWindow){var S=10*i.STEPS_per_dB*Math.log10((e.lsum+e.rsum)/e.totsamp*.5+1e-37),A=S<=0?0:0|S;A>=e.A.length&&(A=e.A.length-1),e.A[A]++,e.lsum=e.rsum=0,t.arraycopy(e.loutbuf,e.totsamp,e.loutbuf,0,MAX_ORDER),t.arraycopy(e.routbuf,e.totsamp,e.routbuf,0,MAX_ORDER),t.arraycopy(e.lstepbuf,e.totsamp,e.lstepbuf,0,MAX_ORDER),t.arraycopy(e.rstepbuf,e.totsamp,e.rstepbuf,0,MAX_ORDER),e.totsamp=0}if(e.totsamp>e.sampleWindow)return GAIN_ANALYSIS_ERROR}return f<MAX_ORDER?(t.arraycopy(e.linprebuf,f,e.linprebuf,0,MAX_ORDER-f),t.arraycopy(e.rinprebuf,f,e.rinprebuf,0,MAX_ORDER-f),t.arraycopy(n,r,e.linprebuf,MAX_ORDER-f,f),t.arraycopy(_,u,e.rinprebuf,MAX_ORDER-f,f)):(t.arraycopy(n,r+f-MAX_ORDER,e.linprebuf,0,MAX_ORDER),t.arraycopy(_,u+f-MAX_ORDER,e.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK},this.GetTitleGain=function(e){for(var t=function(e,t){var n,r=0;for(n=0;n<t;n++)r+=e[n];if(0==r)return GAIN_NOT_ENOUGH_SAMPLES;var a=0|Math.ceil(r*(1-.95));for(n=t;n-- >0&&!((a-=e[n])<=0););return 64.82-n/i.STEPS_per_dB}(e.A,e.A.length),n=0;n<e.A.length;n++)e.B[n]+=e.A[n],e.A[n]=0;for(n=0;n<MAX_ORDER;n++)e.linprebuf[n]=e.lstepbuf[n]=e.loutbuf[n]=e.rinprebuf[n]=e.rstepbuf[n]=e.routbuf[n]=0;return e.totsamp=0,e.lsum=e.rsum=0,t}}return e.new_array_n,e.new_byte,e.new_double,e.new_float,e.new_float_n,e.new_int,e.new_int_n,e.assert,i.STEPS_per_dB=100,i.MAX_dB=120,i.GAIN_NOT_ENOUGH_SAMPLES=-24601,i.GAIN_ANALYSIS_ERROR=0,i.GAIN_ANALYSIS_OK=1,i.INIT_GAIN_ANALYSIS_ERROR=0,i.INIT_GAIN_ANALYSIS_OK=1,i.YULE_ORDER=10,i.MAX_ORDER=i.YULE_ORDER,i.MAX_SAMP_FREQ=48e3,i.RMS_WINDOW_TIME_NUMERATOR=1,i.RMS_WINDOW_TIME_DENOMINATOR=20,i.MAX_SAMPLES_PER_WINDOW=i.MAX_SAMP_FREQ*i.RMS_WINDOW_TIME_NUMERATOR/i.RMS_WINDOW_TIME_DENOMINATOR+1,Yn=i}function Vi(){if(Zn)return zn;return Zn=1,zn=function(e){this.bits=e}}function Di(){if(Jn)return Qn;function e(e,t,n,i){this.xlen=e,this.linmax=t,this.table=n,this.hlen=i}Jn=1;var t={t1HB:[1,1,1,0],t2HB:[1,2,1,3,1,1,3,2,0],t3HB:[3,2,1,1,1,1,3,2,0],t5HB:[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],t6HB:[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],t7HB:[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],t8HB:[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],t9HB:[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],t10HB:[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],t11HB:[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],t12HB:[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],t13HB:[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],t15HB:[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],t16HB:[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],t24HB:[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],t32HB:[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16],t33HB:[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0],t1l:[1,4,3,5],t2l:[1,4,7,4,5,7,6,7,8],t3l:[2,3,7,4,4,7,6,7,8],t5l:[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],t6l:[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],t7l:[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],t8l:[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],t9l:[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],t10l:[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],t11l:[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],t12l:[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],t13l:[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],t15l:[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],t16_5l:[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],t16l:[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],t24l:[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],t32l:[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10],t33l:[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8]};return t.ht=[new e(0,0,null,null),new e(2,0,t.t1HB,t.t1l),new e(3,0,t.t2HB,t.t2l),new e(3,0,t.t3HB,t.t3l),new e(0,0,null,null),new e(4,0,t.t5HB,t.t5l),new e(4,0,t.t6HB,t.t6l),new e(6,0,t.t7HB,t.t7l),new e(6,0,t.t8HB,t.t8l),new e(6,0,t.t9HB,t.t9l),new e(8,0,t.t10HB,t.t10l),new e(8,0,t.t11HB,t.t11l),new e(8,0,t.t12HB,t.t12l),new e(16,0,t.t13HB,t.t13l),new e(0,0,null,t.t16_5l),new e(16,0,t.t15HB,t.t15l),new e(1,1,t.t16HB,t.t16l),new e(2,3,t.t16HB,t.t16l),new e(3,7,t.t16HB,t.t16l),new e(4,15,t.t16HB,t.t16l),new e(6,63,t.t16HB,t.t16l),new e(8,255,t.t16HB,t.t16l),new e(10,1023,t.t16HB,t.t16l),new e(13,8191,t.t16HB,t.t16l),new e(4,15,t.t24HB,t.t24l),new e(5,31,t.t24HB,t.t24l),new e(6,63,t.t24HB,t.t24l),new e(7,127,t.t24HB,t.t24l),new e(8,255,t.t24HB,t.t24l),new e(9,511,t.t24HB,t.t24l),new e(11,2047,t.t24HB,t.t24l),new e(13,8191,t.t24HB,t.t24l),new e(0,0,t.t32HB,t.t32l),new e(0,0,t.t33HB,t.t33l)],t.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],t.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296],t.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],t.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]],t.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]],t.scfsi_band=[0,6,11,16,21],Qn=t}function Hi(){if(ti)return ei;ti=1;var e=Ci(),t=Ei();t.System;var n=t.VbrMode,i=t.Float;t.ShortBlock;var r=t.Util;t.Arrays,t.new_array_n,t.new_byte,t.new_double;var a=t.new_float;t.new_float_n;var s=t.new_int;t.new_int_n;var o=t.assert,l=Ti(),c=Vi(),_=Ni();function u(){var t=null,f=null,h=null;function d(e){return o(0<=e+u.Q_MAX2&&e<u.Q_MAX),y[e+u.Q_MAX2]}this.setModules=function(e,n,i){t=e,f=n,h=i},this.IPOW20=function(e){return o(0<=e&&e<u.Q_MAX),w[e]};var p=2220446049250313e-31,v=u.IXMAX_VAL+2,m=u.Q_MAX,b=u.Q_MAX2;u.LARGE_BITS;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var g=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=g,this.sfBandIndex=[new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0,8,16,24,36,52,72,96,124,160,162,164,166,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var y=a(m+b+1),w=a(m),S=a(v),A=a(v);function M(e,t){var n=h.ATHformula(t,e);return n-=100,n=Math.pow(10,n/10+e.ATHlower)}function B(e){this.s=e}this.adj43=A,this.iteration_init=function(e){var n,r=e.internal_flags,a=r.l3_side;if(0==r.iteration_init_init){for(r.iteration_init_init=1,a.main_data_begin=0,function(e){for(var t=e.internal_flags.ATH.l,n=e.internal_flags.ATH.psfb21,r=e.internal_flags.ATH.s,a=e.internal_flags.ATH.psfb12,s=e.internal_flags,o=e.out_samplerate,c=0;c<l.SBMAX_l;c++){var _=s.scalefac_band.l[c],u=s.scalefac_band.l[c+1];t[c]=i.MAX_VALUE;for(var f=_;f<u;f++){var h=M(e,f*o/1152);t[c]=Math.min(t[c],h)}}for(c=0;c<l.PSFB21;c++)for(_=s.scalefac_band.psfb21[c],u=s.scalefac_band.psfb21[c+1],n[c]=i.MAX_VALUE,f=_;f<u;f++)h=M(e,f*o/1152),n[c]=Math.min(n[c],h);for(c=0;c<l.SBMAX_s;c++){for(_=s.scalefac_band.s[c],u=s.scalefac_band.s[c+1],r[c]=i.MAX_VALUE,f=_;f<u;f++)h=M(e,f*o/384),r[c]=Math.min(r[c],h);r[c]*=s.scalefac_band.s[c+1]-s.scalefac_band.s[c]}for(c=0;c<l.PSFB12;c++){for(_=s.scalefac_band.psfb12[c],u=s.scalefac_band.psfb12[c+1],a[c]=i.MAX_VALUE,f=_;f<u;f++)h=M(e,f*o/384),a[c]=Math.min(a[c],h);a[c]*=s.scalefac_band.s[13]-s.scalefac_band.s[12]}if(e.noATH){for(c=0;c<l.SBMAX_l;c++)t[c]=1e-20;for(c=0;c<l.PSFB21;c++)n[c]=1e-20;for(c=0;c<l.SBMAX_s;c++)r[c]=1e-20;for(c=0;c<l.PSFB12;c++)a[c]=1e-20}s.ATH.floor=10*Math.log10(M(e,-1))}(e),S[0]=0,n=1;n<v;n++)S[n]=Math.pow(n,4/3);for(n=0;n<v-1;n++)A[n]=n+1-Math.pow(.5*(S[n]+S[n+1]),.75);for(A[n]=.5,n=0;n<m;n++)w[n]=Math.pow(2,-.1875*(n-210));for(n=0;n<=m+b;n++)y[n]=Math.pow(2,.25*(n-210-b));var s,o,c,_;for(t.huffman_init(r),(n=e.exp_nspsytune>>2&63)>=32&&(n-=64),s=Math.pow(10,n/4/10),(n=e.exp_nspsytune>>8&63)>=32&&(n-=64),o=Math.pow(10,n/4/10),(n=e.exp_nspsytune>>14&63)>=32&&(n-=64),c=Math.pow(10,n/4/10),(n=e.exp_nspsytune>>20&63)>=32&&(n-=64),_=c*Math.pow(10,n/4/10),n=0;n<l.SBMAX_l;n++){u=n<=6?s:n<=13?o:n<=20?c:_,r.nsPsy.longfact[n]=u}for(n=0;n<l.SBMAX_s;n++){var u;u=n<=5?s:n<=10?o:n<=11?c:_,r.nsPsy.shortfact[n]=u}}},this.on_pe=function(e,t,n,i,r,a){var l,u,h=e.internal_flags,d=0,p=s(2),v=new c(d),m=f.ResvMaxBits(e,i,v,a),b=(d=v.bits)+m;for(b>_.MAX_BITS_PER_GRANULE&&(b=_.MAX_BITS_PER_GRANULE),l=0,u=0;u<h.channels_out;++u)n[u]=Math.min(_.MAX_BITS_PER_CHANNEL,d/h.channels_out),p[u]=0|n[u]*t[r][u]/700-n[u],p[u]>3*i/4&&(p[u]=3*i/4),p[u]<0&&(p[u]=0),p[u]+n[u]>_.MAX_BITS_PER_CHANNEL&&(p[u]=Math.max(0,_.MAX_BITS_PER_CHANNEL-n[u])),l+=p[u];if(l>m)for(u=0;u<h.channels_out;++u)p[u]=m*p[u]/l;for(u=0;u<h.channels_out;++u)n[u]+=p[u],m-=p[u];for(l=0,u=0;u<h.channels_out;++u)l+=n[u];if(l>_.MAX_BITS_PER_GRANULE){var g=0;for(u=0;u<h.channels_out;++u)n[u]*=_.MAX_BITS_PER_GRANULE,n[u]/=l,g+=n[u];o(g<=_.MAX_BITS_PER_GRANULE)}return b},this.reduce_side=function(e,t,n,i){o(i<=_.MAX_BITS_PER_GRANULE),o(e[0]+e[1]<=_.MAX_BITS_PER_GRANULE);var r=.33*(.5-t)/.5;r<0&&(r=0),r>.5&&(r=.5);var a=0|.5*r*(e[0]+e[1]);a>_.MAX_BITS_PER_CHANNEL-e[0]&&(a=_.MAX_BITS_PER_CHANNEL-e[0]),a<0&&(a=0),e[1]>=125&&(e[1]-a>125?(e[0]<n&&(e[0]+=a),e[1]-=a):(e[0]+=e[1]-125,e[1]=125)),(a=e[0]+e[1])>i&&(e[0]=i*e[0]/a,e[1]=i*e[1]/a),o(e[0]<=_.MAX_BITS_PER_CHANNEL),o(e[1]<=_.MAX_BITS_PER_CHANNEL),o(e[0]+e[1]<=_.MAX_BITS_PER_GRANULE)},this.athAdjust=function(e,t,n){var i=90.30873362,a=r.FAST_LOG10_X(t,10),s=e*e,o=0;return a-=n,s>1e-20&&(o=1+r.FAST_LOG10_X(s,10/i)),o<0&&(o=0),a*=o,a+=n+i-94.82444863,Math.pow(10,.1*a)},this.calc_xmin=function(e,t,i,r){var a,s=0,o=e.internal_flags,c=0,_=0,u=o.ATH,f=i.xr,h=e.VBR==n.vbr_mtrh?1:0,d=o.masking_lower;for(e.VBR!=n.vbr_mtrh&&e.VBR!=n.vbr_mt||(d=1),a=0;a<i.psy_lmax;a++){A=(S=e.VBR==n.vbr_rh||e.VBR==n.vbr_mtrh?athAdjust(u.adjust,u.l[a],u.floor):u.adjust*u.l[a])/(g=i.width[a]),M=p,k=g>>1,E=0;do{E+=T=f[c]*f[c],M+=T<A?T:A,E+=I=f[++c]*f[c],M+=I<A?I:A,c++}while(--k>0);if(E>S&&_++,a==l.SBPSY_l)M<(R=S*o.nsPsy.longfact[a])&&(M=R);if(0!=h&&(S=M),!e.ATHonly)if((B=t.en.l[a])>0)R=E*t.thm.l[a]*d/B,0!=h&&(R*=o.nsPsy.longfact[a]),S<R&&(S=R);r[s++]=0!=h?S:S*o.nsPsy.longfact[a]}var v=575;if(i.block_type!=l.SHORT_TYPE)for(var m=576;0!=m--&&BitStream.EQ(f[m],0);)v=m;i.max_nonzero_coeff=v;for(var b=i.sfb_smin;a<i.psymax;b++,a+=3){var g,y,w;for(w=e.VBR==n.vbr_rh||e.VBR==n.vbr_mtrh?athAdjust(u.adjust,u.s[b],u.floor):u.adjust*u.s[b],g=i.width[a],y=0;y<3;y++){var S,A,M,B,R,E=0,k=g>>1;A=w/g,M=p;do{var T,I;E+=T=f[c]*f[c],M+=T<A?T:A,E+=I=f[++c]*f[c],M+=I<A?I:A,c++}while(--k>0);if(E>w&&_++,b==l.SBPSY_s)M<(R=w*o.nsPsy.shortfact[b])&&(M=R);if(S=0!=h?M:w,!e.ATHonly&&!e.ATHshort)if((B=t.en.s[b][y])>0)R=E*t.thm.s[b][y]*d/B,0!=h&&(R*=o.nsPsy.shortfact[b]),S<R&&(S=R);r[s++]=0!=h?S:S*o.nsPsy.shortfact[b]}e.useTemporal&&(r[s-3]>r[s-3+1]&&(r[s-3+1]+=(r[s-3]-r[s-3+1])*o.decay),r[s-3+1]>r[s-3+2]&&(r[s-3+2]+=(r[s-3+1]-r[s-3+2])*o.decay))}return _},this.calc_noise_core=function(e,t,n,i){var r=0,s=t.s,o=e.l3_enc;if(s>e.count1)for(;0!=n--;){c=e.xr[s],s++,r+=c*c,c=e.xr[s],s++,r+=c*c}else if(s>e.big_values){var l=a(2);for(l[0]=0,l[1]=i;0!=n--;){c=Math.abs(e.xr[s])-l[o[s]],s++,r+=c*c,c=Math.abs(e.xr[s])-l[o[s]],s++,r+=c*c}}else for(;0!=n--;){var c;c=Math.abs(e.xr[s])-S[o[s]]*i,s++,r+=c*c,c=Math.abs(e.xr[s])-S[o[s]]*i,s++,r+=c*c}return t.s=s,r},this.calc_noise=function(e,t,n,i,a){var s,o,l=0,c=0,_=0,u=0,f=0,h=-20,p=0,v=e.scalefac,m=0;for(i.over_SSD=0,s=0;s<e.psymax;s++){var b,y=e.global_gain-(v[m++]+(0!=e.preflag?g[s]:0)<<e.scalefac_scale+1)-8*e.subblock_gain[e.window[s]],w=0;if(null!=a&&a.step[s]==y)w=a.noise[s],p+=e.width[s],n[l++]=w/t[c++],w=a.noise_log[s];else{var S,A=d(y);if(o=e.width[s]>>1,p+e.width[s]>e.max_nonzero_coeff)o=(S=e.max_nonzero_coeff-p+1)>0?S>>1:0;var M=new B(p);w=this.calc_noise_core(e,M,o,A),p=M.s,null!=a&&(a.step[s]=y,a.noise[s]=w),w=n[l++]=w/t[c++],w=r.FAST_LOG10(Math.max(w,1e-20)),null!=a&&(a.noise_log[s]=w)}if(null!=a&&(a.global_gain=e.global_gain),f+=w,w>0)b=Math.max(0|10*w+.5,1),i.over_SSD+=b*b,_++,u+=w;h=Math.max(h,w)}return i.over_count=_,i.tot_noise=f,i.over_noise=u,i.max_noise=h,_},this.set_pinfo=function(e,t,n,i,r){var s,c,_,u,f,h=e.internal_flags,d=0==t.scalefac_scale?.5:1,p=t.scalefac,v=a(L3Side.SFBMAX),m=a(L3Side.SFBMAX),b=new CalcNoiseResult;calc_xmin(e,n,t,v),calc_noise(t,v,m,b,null);var y=0;for(c=t.sfb_lmax,t.block_type!=l.SHORT_TYPE&&0==t.mixed_block_flag&&(c=22),s=0;s<c;s++){var w=h.scalefac_band.l[s],S=(A=h.scalefac_band.l[s+1])-w;for(u=0;y<A;y++)u+=t.xr[y]*t.xr[y];u/=S,f=1e15,h.pinfo.en[i][r][s]=f*u,h.pinfo.xfsf[i][r][s]=f*v[s]*m[s]/S,n.en.l[s]>0&&!e.ATHonly?u/=n.en.l[s]:u=0,h.pinfo.thr[i][r][s]=f*Math.max(u*n.thm.l[s],h.ATH.l[s]),h.pinfo.LAMEsfb[i][r][s]=0,0!=t.preflag&&s>=11&&(h.pinfo.LAMEsfb[i][r][s]=-d*g[s]),s<l.SBPSY_l&&(o(p[s]>=0),h.pinfo.LAMEsfb[i][r][s]-=d*p[s])}if(t.block_type==l.SHORT_TYPE)for(c=s,s=t.sfb_smin;s<l.SBMAX_s;s++){w=h.scalefac_band.s[s],S=(A=h.scalefac_band.s[s+1])-w;for(var A,M=0;M<3;M++){for(u=0,_=w;_<A;_++)u+=t.xr[y]*t.xr[y],y++;u=Math.max(u/S,1e-20),f=1e15,h.pinfo.en_s[i][r][3*s+M]=f*u,h.pinfo.xfsf_s[i][r][3*s+M]=f*v[c]*m[c]/S,n.en.s[s][M]>0?u/=n.en.s[s][M]:u=0,(e.ATHonly||e.ATHshort)&&(u=0),h.pinfo.thr_s[i][r][3*s+M]=f*Math.max(u*n.thm.s[s][M],h.ATH.s[s]),h.pinfo.LAMEsfb_s[i][r][3*s+M]=-2*t.subblock_gain[M],s<l.SBPSY_s&&(h.pinfo.LAMEsfb_s[i][r][3*s+M]-=d*p[c]),c++}}h.pinfo.LAMEqss[i][r]=t.global_gain,h.pinfo.LAMEmainbits[i][r]=t.part2_3_length+t.part2_length,h.pinfo.LAMEsfbits[i][r]=t.part2_length,h.pinfo.over[i][r]=b.over_count,h.pinfo.max_noise[i][r]=10*b.max_noise,h.pinfo.over_noise[i][r]=10*b.over_noise,h.pinfo.tot_noise[i][r]=10*b.tot_noise,h.pinfo.over_SSD[i][r]=b.over_SSD}}return u.Q_MAX=257,u.Q_MAX2=116,u.LARGE_BITS=1e5,u.IXMAX_VAL=8206,ei=u}function Fi(){if(ii)return ni;ii=1;var e=Ei(),t=e.System;e.VbrMode,e.Float,e.ShortBlock,e.Util;var n=e.Arrays;e.new_array_n,e.new_byte,e.new_double,e.new_float,e.new_float_n;var i=e.new_int;e.new_int_n;var r=e.assert,a=Ti(),s=Di(),o=Oi(),l=Hi();return ni=function e(){var c=null;function _(e){this.bits=0|e}this.qupvt=null,this.setModules=function(e){this.qupvt=e,c=e};var u=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function f(e,t,n,i,a,s){var o=.5946/t;for(r(e>0),e>>=1;0!=e--;)a[s++]=o>n[i++]?0:1,a[s++]=o>n[i++]?0:1}function h(e,t,n,i,a,s){r(e>0);var o=(e>>=1)%2;for(e>>=1;0!=e--;){var l,_,u,f,h,d,p,v;l=n[i++]*t,_=n[i++]*t,h=0|l,u=n[i++]*t,d=0|_,f=n[i++]*t,p=0|u,l+=c.adj43[h],v=0|f,_+=c.adj43[d],a[s++]=0|l,u+=c.adj43[p],a[s++]=0|_,f+=c.adj43[v],a[s++]=0|u,a[s++]=0|f}0!=o&&(h=0|(l=n[i++]*t),d=0|(_=n[i++]*t),l+=c.adj43[h],_+=c.adj43[d],a[s++]=0|l,a[s++]=0|_)}var d=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function p(e,t,n,i){var r=function(e,t,n){var i=0,r=0;do{var a=e[t++],s=e[t++];i<a&&(i=a),r<s&&(r=s)}while(t<n);return i<r&&(i=r),i}(e,t,n);switch(r){case 0:return r;case 1:return function(e,t,n,i){var r=0,a=s.ht[1].hlen;do{var o=2*e[t+0]+e[t+1];t+=2,r+=a[o]}while(t<n);return i.bits+=r,1}(e,t,n,i);case 2:case 3:return function(e,t,n,i,r){var a,o,l=0,c=s.ht[i].xlen;o=2==i?s.table23:s.table56;do{var _=e[t+0]*c+e[t+1];t+=2,l+=o[_]}while(t<n);return a=65535&l,(l>>=16)>a&&(l=a,i++),r.bits+=l,i}(e,t,n,d[r-1],i);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return function(e,t,n,i,r){var a=0,o=0,l=0,c=s.ht[i].xlen,_=s.ht[i].hlen,u=s.ht[i+1].hlen,f=s.ht[i+2].hlen;do{var h=e[t+0]*c+e[t+1];t+=2,a+=_[h],o+=u[h],l+=f[h]}while(t<n);var d=i;return a>o&&(a=o,d++),a>l&&(a=l,d=i+2),r.bits+=a,d}(e,t,n,d[r-1],i);default:if(r>l.IXMAX_VAL)return i.bits=l.LARGE_BITS,-1;var a,o;for(r-=15,a=24;a<32&&!(s.ht[a].linmax>=r);a++);for(o=a-8;o<24&&!(s.ht[o].linmax>=r);o++);return function(e,t,n,i,r,a){var o,l=65536*s.ht[i].xlen+s.ht[r].xlen,c=0;do{var _=e[t++],u=e[t++];0!=_&&(_>14&&(_=15,c+=l),_*=16),0!=u&&(u>14&&(u=15,c+=l),_+=u),c+=s.largetbl[_]}while(t<n);return o=65535&c,(c>>=16)>o&&(c=o,i=r),a.bits+=c,i}(e,t,n,o,a,i)}}function v(e,t,n,i,r,s,o,l){for(var c=t.big_values,u=2;u<a.SBMAX_l+1;u++){var f=e.scalefac_band.l[u];if(f>=c)break;var h=r[u-2]+t.count1bits;if(n.part2_3_length<=h)break;var d=new _(h),v=p(i,f,c,d);h=d.bits,n.part2_3_length<=h||(n.assign(t),n.part2_3_length=h,n.region0_count=s[u-2],n.region1_count=u-2-s[u-2],n.table_select[0]=o[u-2],n.table_select[1]=l[u-2],n.table_select[2]=v)}}this.noquant_count_bits=function(e,t,n){var i=t.l3_enc,o=Math.min(576,t.max_nonzero_coeff+2>>1<<1);for(null!=n&&(n.sfb_count1=0);o>1&&0==(i[o-1]|i[o-2]);o-=2);t.count1=o;for(var l=0,c=0;o>3;o-=4){var u;if((2147483647&(i[o-1]|i[o-2]|i[o-3]|i[o-4]))>1)break;u=2*(2*(2*i[o-4]+i[o-3])+i[o-2])+i[o-1],l+=s.t32l[u],c+=s.t33l[u]}var f=l;if(t.count1table_select=0,l>c&&(f=c,t.count1table_select=1),t.count1bits=f,t.big_values=o,0==o)return f;if(t.block_type==a.SHORT_TYPE)(l=3*e.scalefac_band.s[3])>t.big_values&&(l=t.big_values),c=t.big_values;else if(t.block_type==a.NORM_TYPE){if(r(o<=576),l=t.region0_count=e.bv_scf[o-2],c=t.region1_count=e.bv_scf[o-1],r(l+c+2<a.SBPSY_l),c=e.scalefac_band.l[l+c+2],l=e.scalefac_band.l[l+1],c<o){var h=new _(f);t.table_select[2]=p(i,c,o,h),f=h.bits}}else t.region0_count=7,t.region1_count=a.SBMAX_l-1-7-1,(l=e.scalefac_band.l[8])>(c=o)&&(l=c);if(l=Math.min(l,o),c=Math.min(c,o),r(l>=0),r(c>=0),0<l){h=new _(f);t.table_select[0]=p(i,0,l,h),f=h.bits}if(l<c){h=new _(f);t.table_select[1]=p(i,l,c,h),f=h.bits}if(2==e.use_best_huffman&&(t.part2_3_length=f,best_huffman_divide(e,t),f=t.part2_3_length),null!=n&&t.block_type==a.NORM_TYPE){for(var d=0;e.scalefac_band.l[d]<t.big_values;)d++;n.sfb_count1=d}return f},this.count_bits=function(e,t,i,s){var o=i.l3_enc,_=l.IXMAX_VAL/c.IPOW20(i.global_gain);if(i.xrpow_max>_)return l.LARGE_BITS;if(function(e,t,i,s,o){var l,_,u,d=0,p=0,v=0,m=0,b=t,g=0,y=b,w=0,S=e,A=0;for(u=null!=o&&s.global_gain==o.global_gain,_=s.block_type==a.SHORT_TYPE?38:21,l=0;l<=_;l++){var M=-1;if((u||s.block_type==a.NORM_TYPE)&&(M=s.global_gain-(s.scalefac[l]+(0!=s.preflag?c.pretab[l]:0)<<s.scalefac_scale+1)-8*s.subblock_gain[s.window[l]]),r(s.width[l]>=0),u&&o.step[l]==M)0!=p&&(h(p,i,S,A,y,w),p=0),0!=v&&(f(v,i,S,A,y,w),v=0);else{var B,R=s.width[l];if(d+s.width[l]>s.max_nonzero_coeff&&(B=s.max_nonzero_coeff-d+1,n.fill(t,s.max_nonzero_coeff,576,0),(R=B)<0&&(R=0),l=_+1),0==p&&0==v&&(y=b,w=g,S=e,A=m),null!=o&&o.sfb_count1>0&&l>=o.sfb_count1&&o.step[l]>0&&M>=o.step[l]?(0!=p&&(h(p,i,S,A,y,w),p=0,y=b,w=g,S=e,A=m),v+=R):(0!=v&&(f(v,i,S,A,y,w),v=0,y=b,w=g,S=e,A=m),p+=R),R<=0){0!=v&&(f(v,i,S,A,y,w),v=0),0!=p&&(h(p,i,S,A,y,w),p=0);break}}l<=_&&(g+=s.width[l],m+=s.width[l],d+=s.width[l])}0!=p&&(h(p,i,S,A,y,w),p=0),0!=v&&(f(v,i,S,A,y,w),v=0)}(t,o,c.IPOW20(i.global_gain),i,s),2&e.substep_shaping)for(var u=0,d=i.global_gain+i.scalefac_scale,p=.634521682242439/c.IPOW20(d),v=0;v<i.sfbmax;v++){var m,b=i.width[v];if(r(b>=0),0==e.pseudohalf[v])u+=b;else for(m=u,u+=b;m<u;++m)o[m]=t[m]>=p?o[m]:0}return this.noquant_count_bits(e,i,s)},this.best_huffman_divide=function(e,t){var n=new o,c=t.l3_enc,u=i(23),f=i(23),h=i(23),d=i(23);if(t.block_type!=a.SHORT_TYPE||1!=e.mode_gr){n.assign(t),t.block_type==a.NORM_TYPE&&(!function(e,t,n,i,r,a,s){for(var o=t.big_values,c=0;c<=22;c++)i[c]=l.LARGE_BITS;for(c=0;c<16;c++){var u=e.scalefac_band.l[c+1];if(u>=o)break;var f=0,h=new _(f),d=p(n,0,u,h);f=h.bits;for(var v=0;v<8;v++){var m=e.scalefac_band.l[c+v+2];if(m>=o)break;var b=f,g=p(n,u,m,h=new _(b));b=h.bits,i[c+v]>b&&(i[c+v]=b,r[c+v]=c,a[c+v]=d,s[c+v]=g)}}}(e,t,c,u,f,h,d),v(e,n,t,c,u,f,h,d));var m=n.big_values;if(!(0==m||(c[m-2]|c[m-1])>1||(m=t.count1+2)>576)){n.assign(t),n.count1=m;var b=0,g=0;for(r(m<=576);m>n.big_values;m-=4){var y=2*(2*(2*c[m-4]+c[m-3])+c[m-2])+c[m-1];b+=s.t32l[y],g+=s.t33l[y]}if(n.big_values=m,n.count1table_select=0,b>g&&(b=g,n.count1table_select=1),n.count1bits=b,n.block_type==a.NORM_TYPE)v(e,n,t,c,u,f,h,d);else{if(n.part2_3_length=b,(b=e.scalefac_band.l[8])>m&&(b=m),b>0){var w=new _(n.part2_3_length);n.table_select[0]=p(c,0,b,w),n.part2_3_length=w.bits}if(m>b){w=new _(n.part2_3_length);n.table_select[1]=p(c,b,m,w),n.part2_3_length=w.bits}t.part2_3_length>n.part2_3_length&&t.assign(n)}}}};var m=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],b=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],g=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],y=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];e.slen1_tab=g,e.slen2_tab=y,this.best_scalefac_store=function(e,t,n,i){var o,l,_,u,f=i.tt[t][n],h=0;for(_=0,o=0;o<f.sfbmax;o++){var d=f.width[o];for(r(d>=0),_+=d,u=-d;u<0&&0==f.l3_enc[u+_];u++);0==u&&(f.scalefac[o]=h=-2)}if(0==f.scalefac_scale&&0==f.preflag){var p=0;for(o=0;o<f.sfbmax;o++)f.scalefac[o]>0&&(p|=f.scalefac[o]);if(!(1&p)&&0!=p){for(o=0;o<f.sfbmax;o++)f.scalefac[o]>0&&(f.scalefac[o]>>=1);f.scalefac_scale=h=1}}if(0==f.preflag&&f.block_type!=a.SHORT_TYPE&&2==e.mode_gr){for(o=11;o<a.SBPSY_l&&!(f.scalefac[o]<c.pretab[o]&&-2!=f.scalefac[o]);o++);if(o==a.SBPSY_l){for(o=11;o<a.SBPSY_l;o++)f.scalefac[o]>0&&(f.scalefac[o]-=c.pretab[o]);f.preflag=h=1}}for(l=0;l<4;l++)i.scfsi[n][l]=0;for(2==e.mode_gr&&1==t&&i.tt[0][n].block_type!=a.SHORT_TYPE&&i.tt[1][n].block_type!=a.SHORT_TYPE&&(!function(e,t){for(var n,i=t.tt[1][e],r=t.tt[0][e],o=0;o<s.scfsi_band.length-1;o++){for(n=s.scfsi_band[o];n<s.scfsi_band[o+1]&&!(r.scalefac[n]!=i.scalefac[n]&&i.scalefac[n]>=0);n++);if(n==s.scfsi_band[o+1]){for(n=s.scfsi_band[o];n<s.scfsi_band[o+1];n++)i.scalefac[n]=-1;t.scfsi[e][o]=1}}var l=0,c=0;for(n=0;n<11;n++)-1!=i.scalefac[n]&&(c++,l<i.scalefac[n]&&(l=i.scalefac[n]));for(var _=0,u=0;n<a.SBPSY_l;n++)-1!=i.scalefac[n]&&(u++,_<i.scalefac[n]&&(_=i.scalefac[n]));for(o=0;o<16;o++)if(l<m[o]&&_<b[o]){var f=g[o]*c+y[o]*u;i.part2_length>f&&(i.part2_length=f,i.scalefac_compress=o)}}(n,i),h=0),o=0;o<f.sfbmax;o++)-2==f.scalefac[o]&&(f.scalefac[o]=0);0!=h&&(2==e.mode_gr?this.scale_bitcount(f):this.scale_bitcount_lsf(e,f))};var w=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],S=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],A=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(e){var t,n,i,s=0,o=0,_=e.scalefac;if(r(function(e,t){for(var n=0;n<t;++n)if(e[n]<0)return!1;return!0}(_,e.sfbmax)),e.block_type==a.SHORT_TYPE)i=w,0!=e.mixed_block_flag&&(i=S);else if(i=A,0==e.preflag){for(n=11;n<a.SBPSY_l&&!(_[n]<c.pretab[n]);n++);if(n==a.SBPSY_l)for(e.preflag=1,n=11;n<a.SBPSY_l;n++)_[n]-=c.pretab[n]}for(n=0;n<e.sfbdivide;n++)s<_[n]&&(s=_[n]);for(;n<e.sfbmax;n++)o<_[n]&&(o=_[n]);for(e.part2_length=l.LARGE_BITS,t=0;t<16;t++)s<m[t]&&o<b[t]&&e.part2_length>i[t]&&(e.part2_length=i[t],e.scalefac_compress=t);return e.part2_length==l.LARGE_BITS};var M=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(e,n){var s,o,l,_,u,f,h,d,p=i(4),v=n.scalefac;for(s=0!=n.preflag?2:0,h=0;h<4;h++)p[h]=0;if(n.block_type==a.SHORT_TYPE){o=1;var m=c.nr_of_sfb_block[s][o];for(d=0,l=0;l<4;l++)for(_=m[l]/3,h=0;h<_;h++,d++)for(u=0;u<3;u++)v[3*d+u]>p[l]&&(p[l]=v[3*d+u])}else{o=0;m=c.nr_of_sfb_block[s][o];for(d=0,l=0;l<4;l++)for(_=m[l],h=0;h<_;h++,d++)v[d]>p[l]&&(p[l]=v[d])}for(f=!1,l=0;l<4;l++)p[l]>M[s][l]&&(f=!0);if(!f){var b,g,y,w;for(n.sfb_partition_table=c.nr_of_sfb_block[s][o],l=0;l<4;l++)n.slen[l]=B[p[l]];switch(b=n.slen[0],g=n.slen[1],y=n.slen[2],w=n.slen[3],s){case 0:n.scalefac_compress=(5*b+g<<4)+(y<<2)+w;break;case 1:n.scalefac_compress=400+(5*b+g<<2)+y;break;case 2:n.scalefac_compress=500+3*b+g;break;default:t.err.printf("intensity stereo not implemented yet\n")}}if(!f)for(r(null!=n.sfb_partition_table),n.part2_length=0,l=0;l<4;l++)n.part2_length+=n.slen[l]*n.sfb_partition_table[l];return f};var B=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(e){for(var t=2;t<=576;t+=2){for(var n,i=0;e.scalefac_band.l[++i]<t;);for(n=u[i][0];e.scalefac_band.l[n+1]>t;)n--;for(n<0&&(n=u[i][0]),e.bv_scf[t-2]=n,n=u[i][1];e.scalefac_band.l[n+e.bv_scf[t-2]+2]>t;)n--;n<0&&(n=u[i][1]),e.bv_scf[t-1]=n}}},ni}function ji(){if(ai)return ri;ai=1;var e=Ei(),t=e.System;e.VbrMode,e.Float,e.ShortBlock,e.Util;var n=e.Arrays;e.new_array_n;var i=e.new_byte;e.new_double,e.new_float;var r=e.new_float_n,a=e.new_int;e.new_int_n;var s=e.assert,o=Fi(),l=Di(),c=Ti(),_=Ni();function u(){var e=this,u=32,f=null,h=null,d=null,p=null;this.setModules=function(e,t,n,i){f=e,h=t,d=n,p=i};var v=null,m=0,b=0,g=0;function y(e){t.arraycopy(e.header[e.w_ptr].buf,0,v,b,e.sideinfo_len),b+=e.sideinfo_len,m+=8*e.sideinfo_len,e.w_ptr=e.w_ptr+1&_.MAX_HEADER_BUF-1}function w(e,t,n){for(s(n<30);n>0;){var i;0==g&&(g=8,b++,s(b<Lame.LAME_MAXMP3BUFFER),s(e.header[e.w_ptr].write_timing>=m),e.header[e.w_ptr].write_timing==m&&y(e),v[b]=0),i=Math.min(n,g),g-=i,s((n-=i)<u),s(g<u),v[b]|=t>>n<<g,m+=i}}function S(e,t,n){for(s(n<30);n>0;){var i;0==g&&(g=8,b++,s(b<Lame.LAME_MAXMP3BUFFER),v[b]=0),i=Math.min(n,g),g-=i,s((n-=i)<u),s(g<u),v[b]|=t>>n<<g,m+=i}}function A(e,t){var n,i=e.internal_flags;if(s(t>=0),t>=8&&(w(i,76,8),t-=8),t>=8&&(w(i,65,8),t-=8),t>=8&&(w(i,77,8),t-=8),t>=8&&(w(i,69,8),t-=8),t>=32){var r=d.getLameShortVersion();if(t>=32)for(n=0;n<r.length&&t>=8;++n)t-=8,w(i,r.charAt(n),8)}for(;t>=1;t-=1)w(i,i.ancillary_flag,1),i.ancillary_flag^=e.disable_reservoir?0:1;s(0==t)}function M(e,t,n){for(var i=e.header[e.h_ptr].ptr;n>0;){var r=Math.min(n,8-(7&i));s((n-=r)<u),e.header[e.h_ptr].buf[i>>3]|=t>>n<<8-(7&i)-r,i+=r}e.header[e.h_ptr].ptr=i}function B(e,t){e<<=8;for(var n=0;n<8;n++)65536&((t<<=1)^(e<<=1))&&(t^=32773);return t}function R(e,t){var n,i=l.ht[t.count1table_select+32],r=0,a=t.big_values,o=t.big_values;for(s(t.count1table_select<2),n=(t.count1-t.big_values)/4;n>0;--n){var c,_=0,u=0;0!=(c=t.l3_enc[a+0])&&(u+=8,t.xr[o+0]<0&&_++,s(c<=1)),0!=(c=t.l3_enc[a+1])&&(u+=4,_*=2,t.xr[o+1]<0&&_++,s(c<=1)),0!=(c=t.l3_enc[a+2])&&(u+=2,_*=2,t.xr[o+2]<0&&_++,s(c<=1)),0!=(c=t.l3_enc[a+3])&&(u++,_*=2,t.xr[o+3]<0&&_++,s(c<=1)),a+=4,o+=4,w(e,_+i.table[u],i.hlen[u]),r+=i.hlen[u]}return r}function E(e,t,n,i,r){var a=l.ht[t],o=0;if(s(t<32),0==t)return o;for(var c=n;c<i;c+=2){var _=0,f=0,h=a.xlen,d=a.xlen,p=0,v=r.l3_enc[c],m=r.l3_enc[c+1];if(0!=v&&(r.xr[c]<0&&p++,_--),t>15){if(v>14){var b=v-15;s(b<=a.linmax),p|=b<<1,f=h,v=15}if(m>14){var g=m-15;s(g<=a.linmax),p<<=h,p|=g,f+=h,m=15}d=16}0!=m&&(p<<=1,r.xr[c+1]<0&&p++,_--),s((v|m)<16),v=v*d+m,f-=_,_+=a.hlen[v],s(_<=u),s(f<=u),w(e,a.table[v],_),w(e,p,f),o+=_+f}return o}function k(e,t){var n=3*e.scalefac_band.s[3];n>t.big_values&&(n=t.big_values);var i=E(e,t.table_select[0],0,n,t);return i+=E(e,t.table_select[1],n,t.big_values,t)}function T(e,t){var n,i,r,a;n=t.big_values,s(0<=n&&n<=576);var o=t.region0_count+1;return s(0<=o),s(o<e.scalefac_band.l.length),r=e.scalefac_band.l[o],o+=t.region1_count+1,s(0<=o),s(o<e.scalefac_band.l.length),r>n&&(r=n),(a=e.scalefac_band.l[o])>n&&(a=n),i=E(e,t.table_select[0],0,r,t),i+=E(e,t.table_select[1],r,a,t),i+=E(e,t.table_select[2],a,n,t)}function I(){this.total=0}function x(n,i){var r,a,s,o,l,c=n.internal_flags;return l=c.w_ptr,-1==(o=c.h_ptr-1)&&(o=_.MAX_HEADER_BUF-1),r=c.header[o].write_timing-m,i.total=r,r>=0&&(a=1+o-l,o<l&&(a=1+o-l+_.MAX_HEADER_BUF),r-=8*a*c.sideinfo_len),r+=s=e.getframebits(n),i.total+=s,i.total%8!=0?i.total=1+i.total/8:i.total=i.total/8,i.total+=b+1,r<0&&t.err.println("strange error flushing buffer ... \n"),r}this.getframebits=function(e){var t,n=e.internal_flags;return t=0!=n.bitrate_index?l.bitrate_table[e.version][n.bitrate_index]:e.brate,s(8<=t&&t<=640),8*(0|72e3*(e.version+1)*t/e.out_samplerate+n.padding)},this.CRC_writeheader=function(e,t){var n=65535;n=B(255&t[2],n),n=B(255&t[3],n);for(var i=6;i<e.sideinfo_len;i++)n=B(255&t[i],n);t[4]=byte(n>>8),t[5]=byte(255&n)},this.flush_bitstream=function(e){var t,n,i=e.internal_flags,r=i.h_ptr-1;if(-1==r&&(r=_.MAX_HEADER_BUF-1),t=i.l3_side,!((n=x(e,new I))<0)){if(A(e,n),s(i.header[r].write_timing+this.getframebits(e)==m),i.ResvSize=0,t.main_data_begin=0,i.findReplayGain){var a=f.GetTitleGain(i.rgdata);s(NEQ(a,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),i.RadioGain=0|Math.floor(10*a+.5)}i.findPeakSample&&(i.noclipGainChange=0|Math.ceil(20*Math.log10(i.PeakSample/32767)*10),i.noclipGainChange>0&&(EQ(e.scale,1)||EQ(e.scale,0))?i.noclipScale=Math.floor(32767/i.PeakSample*100)/100:i.noclipScale=-1)}},this.add_dummy_byte=function(e,t,n){for(var i,r=e.internal_flags;n-- >0;)for(S(0,t,8),i=0;i<_.MAX_HEADER_BUF;++i)r.header[i].write_timing+=8},this.format_bitstream=function(e){var i,r=e.internal_flags;i=r.l3_side;var a=this.getframebits(e);A(e,i.resvDrain_pre),function(e,i){var r,a,o,l=e.internal_flags;if(r=l.l3_side,l.header[l.h_ptr].ptr=0,n.fill(l.header[l.h_ptr].buf,0,l.sideinfo_len,0),e.out_samplerate<16e3?M(l,4094,12):M(l,4095,12),M(l,e.version,1),M(l,1,2),M(l,e.error_protection?0:1,1),M(l,l.bitrate_index,4),M(l,l.samplerate_index,2),M(l,l.padding,1),M(l,e.extension,1),M(l,e.mode.ordinal(),2),M(l,l.mode_ext,2),M(l,e.copyright,1),M(l,e.original,1),M(l,e.emphasis,2),e.error_protection&&M(l,0,16),1==e.version){for(s(r.main_data_begin>=0),M(l,r.main_data_begin,9),2==l.channels_out?M(l,r.private_bits,3):M(l,r.private_bits,5),o=0;o<l.channels_out;o++){var u;for(u=0;u<4;u++)M(l,r.scfsi[o][u],1)}for(a=0;a<2;a++)for(o=0;o<l.channels_out;o++)M(l,(f=r.tt[a][o]).part2_3_length+f.part2_length,12),M(l,f.big_values/2,9),M(l,f.global_gain,8),M(l,f.scalefac_compress,4),f.block_type!=c.NORM_TYPE?(M(l,1,1),M(l,f.block_type,2),M(l,f.mixed_block_flag,1),14==f.table_select[0]&&(f.table_select[0]=16),M(l,f.table_select[0],5),14==f.table_select[1]&&(f.table_select[1]=16),M(l,f.table_select[1],5),M(l,f.subblock_gain[0],3),M(l,f.subblock_gain[1],3),M(l,f.subblock_gain[2],3)):(M(l,0,1),14==f.table_select[0]&&(f.table_select[0]=16),M(l,f.table_select[0],5),14==f.table_select[1]&&(f.table_select[1]=16),M(l,f.table_select[1],5),14==f.table_select[2]&&(f.table_select[2]=16),M(l,f.table_select[2],5),s(0<=f.region0_count&&f.region0_count<16),s(0<=f.region1_count&&f.region1_count<8),M(l,f.region0_count,4),M(l,f.region1_count,3)),M(l,f.preflag,1),M(l,f.scalefac_scale,1),M(l,f.count1table_select,1)}else for(s(r.main_data_begin>=0),M(l,r.main_data_begin,8),M(l,r.private_bits,l.channels_out),a=0,o=0;o<l.channels_out;o++){var f;M(l,(f=r.tt[a][o]).part2_3_length+f.part2_length,12),M(l,f.big_values/2,9),M(l,f.global_gain,8),M(l,f.scalefac_compress,9),f.block_type!=c.NORM_TYPE?(M(l,1,1),M(l,f.block_type,2),M(l,f.mixed_block_flag,1),14==f.table_select[0]&&(f.table_select[0]=16),M(l,f.table_select[0],5),14==f.table_select[1]&&(f.table_select[1]=16),M(l,f.table_select[1],5),M(l,f.subblock_gain[0],3),M(l,f.subblock_gain[1],3),M(l,f.subblock_gain[2],3)):(M(l,0,1),14==f.table_select[0]&&(f.table_select[0]=16),M(l,f.table_select[0],5),14==f.table_select[1]&&(f.table_select[1]=16),M(l,f.table_select[1],5),14==f.table_select[2]&&(f.table_select[2]=16),M(l,f.table_select[2],5),s(0<=f.region0_count&&f.region0_count<16),s(0<=f.region1_count&&f.region1_count<8),M(l,f.region0_count,4),M(l,f.region1_count,3)),M(l,f.scalefac_scale,1),M(l,f.count1table_select,1)}e.error_protection&&CRC_writeheader(l,l.header[l.h_ptr].buf);var h=l.h_ptr;s(l.header[h].ptr==8*l.sideinfo_len),l.h_ptr=h+1&_.MAX_HEADER_BUF-1,l.header[l.h_ptr].write_timing=l.header[h].write_timing+i,l.h_ptr==l.w_ptr&&t.err.println("Error: MAX_HEADER_BUF too small in bitstream.c \n")}(e,a);var l=8*r.sideinfo_len;if(l+=function(e){var t,n,i,r,a=0,l=e.internal_flags,_=l.l3_side;if(1==e.version)for(t=0;t<2;t++)for(n=0;n<l.channels_out;n++){var u=_.tt[t][n],f=o.slen1_tab[u.scalefac_compress],h=o.slen2_tab[u.scalefac_compress];for(r=0,i=0;i<u.sfbdivide;i++)-1!=u.scalefac[i]&&(w(l,u.scalefac[i],f),r+=f);for(;i<u.sfbmax;i++)-1!=u.scalefac[i]&&(w(l,u.scalefac[i],h),r+=h);s(r==u.part2_length),u.block_type==c.SHORT_TYPE?r+=k(l,u):r+=T(l,u),r+=R(l,u),s(r==u.part2_3_length+u.part2_length),a+=r}else for(t=0,n=0;n<l.channels_out;n++){u=_.tt[t][n];var d,p,v=0;if(s(null!=u.sfb_partition_table),r=0,i=0,p=0,u.block_type==c.SHORT_TYPE){for(;p<4;p++){var m=u.sfb_partition_table[p]/3,b=u.slen[p];for(d=0;d<m;d++,i++)w(l,Math.max(u.scalefac[3*i+0],0),b),w(l,Math.max(u.scalefac[3*i+1],0),b),w(l,Math.max(u.scalefac[3*i+2],0),b),v+=3*b}r+=k(l,u)}else{for(;p<4;p++)for(m=u.sfb_partition_table[p],b=u.slen[p],d=0;d<m;d++,i++)w(l,Math.max(u.scalefac[i],0),b),v+=b;r+=T(l,u)}r+=R(l,u),s(r==u.part2_3_length),s(v==u.part2_length),a+=v+r}return a}(e),A(e,i.resvDrain_post),l+=i.resvDrain_post,i.main_data_begin+=(a-l)/8,x(e,new I)!=r.ResvSize&&t.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),8*i.main_data_begin!=r.ResvSize&&(t.err.printf("bit reservoir error: \nl3_side.main_data_begin: %d \nResvoir size:             %d \nresv drain (post)         %d \nresv drain (pre)          %d \nheader and sideinfo:      %d \ndata bits:                %d \ntotal bits:               %d (remainder: %d) \nbitsperframe:             %d \n",8*i.main_data_begin,r.ResvSize,i.resvDrain_post,i.resvDrain_pre,8*r.sideinfo_len,l-i.resvDrain_post-8*r.sideinfo_len,l,l%8,a),t.err.println("This is a fatal error.  It has several possible causes:"),t.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),t.err.println(" 9%%  Your system is overclocked"),t.err.println(" 1%%  bug in LAME encoding library"),r.ResvSize=8*i.main_data_begin),s(m%8==0),m>1e9){var u;for(u=0;u<_.MAX_HEADER_BUF;++u)r.header[u].write_timing-=m;m=0}return 0},this.copy_buffer=function(e,n,i,o,l){var c=b+1;if(c<=0)return 0;if(0!=o&&c>o)return-1;if(t.arraycopy(v,0,n,i,c),b=-1,g=0,0!=l){var _=a(1);if(_[0]=e.nMusicCRC,p.updateMusicCRC(_,n,i,c),e.nMusicCRC=_[0],c>0&&(e.VBR_seek_table.nBytesWritten+=c),e.decode_on_the_fly)for(var u,d=r([2,1152]),m=c,y=-1;0!=y;)if(y=h.hip_decode1_unclipped(e.hip,n,i,m,d[0],d[1]),m=0,-1==y&&(y=0),y>0){if(s(y<=1152),e.findPeakSample){for(u=0;u<y;u++)d[0][u]>e.PeakSample?e.PeakSample=d[0][u]:-d[0][u]>e.PeakSample&&(e.PeakSample=-d[0][u]);if(e.channels_out>1)for(u=0;u<y;u++)d[1][u]>e.PeakSample?e.PeakSample=d[1][u]:-d[1][u]>e.PeakSample&&(e.PeakSample=-d[1][u])}if(e.findReplayGain&&f.AnalyzeSamples(e.rgdata,d[0],0,d[1],0,y,e.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}return c},this.init_bit_stream_w=function(e){v=i(Lame.LAME_MAXMP3BUFFER),e.h_ptr=e.w_ptr=0,e.header[e.h_ptr].write_timing=0,b=-1,g=0,m=0}}return u.EQ=function(e,t){return Math.abs(e)>Math.abs(t)?Math.abs(e-t)<=1e-6*Math.abs(e):Math.abs(e-t)<=1e-6*Math.abs(t)},u.NEQ=function(e,t){return!u.EQ(e,t)},ri=u}function Xi(){if(oi)return si;oi=1;var e=Ei(),t=e.System,n=e.VbrMode;e.Float;var i=e.ShortBlock;e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double;var r=e.new_float;e.new_float_n,e.new_int;var a=e.new_int_n,s=e.new_short_n,o=e.assert,l=Ii(),c=function(){if(En)return Rn;En=1;var e=xi();return Rn=function(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=e.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}}(),_=Ni(),u=function(){if(qn)return Xn;qn=1;var e=Ei();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double;var t=e.new_float;e.new_float_n,e.new_int,e.new_int_n,e.assert;var n=Ti();return Xn=function(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=t(n.SBMAX_l),this.s=t(n.SBMAX_s),this.psfb21=t(n.PSFB21),this.psfb12=t(n.PSFB12),this.cb_l=t(n.CBANDS),this.cb_s=t(n.CBANDS),this.eql_w=t(n.BLKSIZE/2)}}(),f=function(){if(Kn)return Gn;Kn=1;var e=Ei();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double;var t=e.new_float;e.new_float_n;var n=e.new_int;e.new_int_n,e.assert;var i=Li();return Gn=function(){this.linprebuf=t(2*i.MAX_ORDER),this.linpre=0,this.lstepbuf=t(i.MAX_SAMPLES_PER_WINDOW+i.MAX_ORDER),this.lstep=0,this.loutbuf=t(i.MAX_SAMPLES_PER_WINDOW+i.MAX_ORDER),this.lout=0,this.rinprebuf=t(2*i.MAX_ORDER),this.rinpre=0,this.rstepbuf=t(i.MAX_SAMPLES_PER_WINDOW+i.MAX_ORDER),this.rstep=0,this.routbuf=t(i.MAX_SAMPLES_PER_WINDOW+i.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=n(0|i.STEPS_per_dB*i.MAX_dB),this.B=n(0|i.STEPS_per_dB*i.MAX_dB)}}(),h=function(){if($n)return Wn;$n=1;var e=Ei();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double;var t=e.new_float;e.new_float_n;var n=e.new_int;e.new_int_n;var i=e.assert,r=Vi(),a=Ti(),s=Pi(),o=Ni();return Wn=function(e){var l=e;this.quantize=l,this.iteration_loop=function(e,l,c,_){var u,f=e.internal_flags,h=t(s.SFBMAX),d=t(576),p=n(2),v=0,m=f.l3_side,b=new r(v);this.quantize.rv.ResvFrameBegin(e,b),v=b.bits;for(var g=0;g<f.mode_gr;g++){u=this.quantize.qupvt.on_pe(e,l,p,v,g,g),f.mode_ext==a.MPG_MD_MS_LR&&(this.quantize.ms_convert(f.l3_side,g),this.quantize.qupvt.reduce_side(p,c[g],v,u));for(var y=0;y<f.channels_out;y++){var w,S,A=m.tt[g][y];A.block_type!=a.SHORT_TYPE?(w=0,S=f.PSY.mask_adjust-w):(w=0,S=f.PSY.mask_adjust_short-w),f.masking_lower=Math.pow(10,.1*S),this.quantize.init_outer_loop(f,A),this.quantize.init_xrpow(f,A,d)&&(this.quantize.qupvt.calc_xmin(e,_[g][y],A,h),this.quantize.outer_loop(e,A,h,d,y,p[y])),this.quantize.iteration_finish_one(f,g,y),i(A.part2_3_length<=o.MAX_BITS_PER_CHANNEL),i(A.part2_3_length<=p[y])}}this.quantize.rv.ResvFrameEnd(f,v)}}}(),d=ji(),p=Di(),v=Ti();return si=function e(){var m,b,g,y,w,S=this;e.V9=410,e.V8=420,e.V7=430,e.V6=440,e.V5=450,e.V4=460,e.V3=470,e.V2=480,e.V1=490,e.V0=500,e.R3MIX=1e3,e.STANDARD=1001,e.EXTREME=1002,e.INSANE=1003,e.STANDARD_FAST=1004,e.EXTREME_FAST=1005,e.MEDIUM=1006,e.MEDIUM_FAST=1007,e.LAME_MAXMP3BUFFER=147456;var A,M,B,R=new l;function E(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=r(v.SBMAX_l),this.bo_s_weight=r(v.SBMAX_s)}function k(){this.lowerlimit=0}function T(e,t){this.lowpass=t}this.enc=new v,this.setModules=function(e,t,n,i,r,a,s,o,l){m=e,b=t,g=n,y=i,w=r,A=a,M=o,B=l,this.enc.setModules(b,R,y,A)};var I=4294479419;function x(e){return e>1?0:e<=0?1:Math.cos(Math.PI/2*e)}function P(e,t){switch(e){case 44100:return t.version=1,0;case 48e3:return t.version=1,1;case 32e3:return t.version=1,2;case 22050:case 11025:return t.version=0,0;case 24e3:case 12e3:return t.version=0,1;case 16e3:case 8e3:return t.version=0,2;default:return t.version=0,-1}}function O(e,t,n){n<16e3&&(t=2);for(var i=p.bitrate_table[t][1],r=2;r<=14;r++)p.bitrate_table[t][r]>0&&Math.abs(p.bitrate_table[t][r]-e)<Math.abs(i-e)&&(i=p.bitrate_table[t][r]);return i}function C(e,t,n){n<16e3&&(t=2);for(var i=0;i<=14;i++)if(p.bitrate_table[t][i]>0&&p.bitrate_table[t][i]==e)return i;return-1}function N(e,t){var n=[new T(8,2e3),new T(16,3700),new T(24,3900),new T(32,5500),new T(40,7e3),new T(48,7500),new T(56,1e4),new T(64,11e3),new T(80,13500),new T(96,15100),new T(112,15600),new T(128,17e3),new T(160,17500),new T(192,18600),new T(224,19400),new T(256,19700),new T(320,20500)],i=S.nearestBitrateFullIndex(t);e.lowerlimit=n[i].lowpass}function L(e){var t=v.BLKSIZE+e.framesize-v.FFTOFFSET;return t=Math.max(t,512+e.framesize-32),o(_.MFSIZE>=t),t}function V(e,t,n,i,r,a){var s=S.enc.lame_encode_mp3_frame(e,t,n,i,r,a);return e.frameNum++,s}function D(){this.n_in=0,this.n_out=0}function H(){this.num_used=0}function F(e,t){return 0!=t?F(t,e%t):e}function j(e,t,n){var i=Math.PI*t;(e/=n)<0&&(e=0),e>1&&(e=1);var r=e-.5,a=.42-.5*Math.cos(2*e*Math.PI)+.08*Math.cos(4*e*Math.PI);return Math.abs(r)<1e-9?i/Math.PI:a*Math.sin(n*i*r)/(Math.PI*n*r)}function X(e,t,n,i,a,s,l,c,u){var f,h,d=e.internal_flags,p=0,v=e.out_samplerate/F(e.out_samplerate,e.in_samplerate);v>_.BPC&&(v=_.BPC);var m=Math.abs(d.resample_ratio-Math.floor(.5+d.resample_ratio))<1e-4?1:0,b=1/d.resample_ratio;b>1&&(b=1);var g=31;0==g%2&&--g;var y=(g+=m)+1;if(0==d.fill_buffer_resample_init){for(d.inbuf_old[0]=r(y),d.inbuf_old[1]=r(y),f=0;f<=2*v;++f)d.blackfilt[f]=r(y);for(d.itime[0]=0,d.itime[1]=0,p=0;p<=2*v;p++){var w=0,S=(p-v)/(2*v);for(f=0;f<=g;f++)w+=d.blackfilt[p][f]=j(f-S,b,g);for(f=0;f<=g;f++)d.blackfilt[p][f]/=w}d.fill_buffer_resample_init=1}var A=d.inbuf_old[u];for(h=0;h<i;h++){var M,B;if(M=h*d.resample_ratio,g+(p=0|Math.floor(M-d.itime[u]))-g/2>=l)break;S=M-d.itime[u]-(p+g%2*.5);o(Math.abs(S)<=.501),B=0|Math.floor(2*S*v+v+.5);var R=0;for(f=0;f<=g;++f){var E=0|f+p-g/2;o(E<l),o(E+y>=0),R+=(E<0?A[y+E]:a[s+E])*d.blackfilt[B][f]}t[n+h]=R}if(c.num_used=Math.min(l,g+p-g/2),d.itime[u]+=c.num_used-h*d.resample_ratio,c.num_used>=y)for(f=0;f<y;f++)A[f]=a[s+c.num_used+f-y];else{var k=y-c.num_used;for(f=0;f<k;++f)A[f]=A[f+c.num_used];for(p=0;f<y;++f,++p)A[f]=a[s+p];o(p==c.num_used)}return h}function q(e,t,n,i,r,a){var s=e.internal_flags;if(s.resample_ratio<.9999||s.resample_ratio>1.0001)for(var o=0;o<s.channels_out;o++){var l=new H;a.n_out=X(e,t[o],s.mf_size,e.framesize,n[o],i,r,l,o),a.n_in=l.num_used}else{a.n_out=Math.min(e.framesize,r),a.n_in=a.n_out;for(var c=0;c<a.n_out;++c)t[0][s.mf_size+c]=n[0][i+c],2==s.channels_out&&(t[1][s.mf_size+c]=n[1][i+c])}}this.lame_init=function(){var e=new c;return function(e){var t;e.class_id=I,t=e.internal_flags=new _,e.mode=MPEGMode.NOT_SET,e.original=1,e.in_samplerate=44100,e.num_channels=2,e.num_samples=-1,e.bWriteVbrTag=!0,e.quality=-1,e.short_blocks=null,t.subblock_gain=-1,e.lowpassfreq=0,e.highpassfreq=0,e.lowpasswidth=-1,e.highpasswidth=-1,e.VBR=n.vbr_off,e.VBR_q=4,e.ATHcurve=-1,e.VBR_mean_bitrate_kbps=128,e.VBR_min_bitrate_kbps=0,e.VBR_max_bitrate_kbps=0,e.VBR_hard_min=0,t.VBR_min_bitrate=1,t.VBR_max_bitrate=13,e.quant_comp=-1,e.quant_comp_short=-1,e.msfix=-1,t.resample_ratio=1,t.OldValue[0]=180,t.OldValue[1]=180,t.CurrentStep[0]=4,t.CurrentStep[1]=4,t.masking_lower=1,t.nsPsy.attackthre=-1,t.nsPsy.attackthre_s=-1,e.scale=-1,e.athaa_type=-1,e.ATHtype=-1,e.athaa_loudapprox=-1,e.athaa_sensitivity=0,e.useTemporal=null,e.interChRatio=-1,t.mf_samples_to_encode=v.ENCDELAY+v.POSTDELAY,e.encoder_padding=0,t.mf_size=v.ENCDELAY-v.MDCTDELAY,e.findReplayGain=!1,e.decode_on_the_fly=!1,t.decode_on_the_fly=!1,t.findReplayGain=!1,t.findPeakSample=!1,t.RadioGain=0,t.AudiophileGain=0,t.noclipGainChange=0,t.noclipScale=-1,e.preset=0,e.write_id3tag_automatic=!0}(e),e.lame_allocated_gfp=1,e},this.nearestBitrateFullIndex=function(e){var t=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],n=0,i=0,r=0,a=0;a=t[16],r=16,i=t[16],n=16;for(var s=0;s<16;s++)if(Math.max(e,t[s+1])!=e){a=t[s+1],r=s+1,i=t[s],n=s;break}return a-e>e-i?n:r},this.lame_init_params=function(e){var r,s,c,_=e.internal_flags;if(_.Class_ID=0,null==_.ATH&&(_.ATH=new u),null==_.PSY&&(_.PSY=new E),null==_.rgdata&&(_.rgdata=new f),_.channels_in=e.num_channels,1==_.channels_in&&(e.mode=MPEGMode.MONO),_.channels_out=e.mode==MPEGMode.MONO?1:2,_.mode_ext=v.MPG_MD_MS_LR,e.mode==MPEGMode.MONO&&(e.force_ms=!1),e.VBR==n.vbr_off&&128!=e.VBR_mean_bitrate_kbps&&0==e.brate&&(e.brate=e.VBR_mean_bitrate_kbps),e.VBR==n.vbr_off||e.VBR==n.vbr_mtrh||e.VBR==n.vbr_mt||(e.free_format=!1),e.VBR==n.vbr_off&&0==e.brate&&d.EQ(e.compression_ratio,0)&&(e.compression_ratio=11.025),e.VBR==n.vbr_off&&e.compression_ratio>0&&(0==e.out_samplerate&&(e.out_samplerate=map2MP3Frequency(int(.97*e.in_samplerate))),e.brate=0|16*e.out_samplerate*_.channels_out/(1e3*e.compression_ratio),_.samplerate_index=P(e.out_samplerate,e),e.free_format||(e.brate=O(e.brate,e.version,e.out_samplerate))),0!=e.out_samplerate&&(e.out_samplerate<16e3?(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,64)):e.out_samplerate<32e3?(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,160)):(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,32),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320))),0==e.lowpassfreq){var S=16e3;switch(e.VBR){case n.vbr_off:N(T=new k,e.brate),S=T.lowerlimit;break;case n.vbr_abr:var T;N(T=new k,e.VBR_mean_bitrate_kbps),S=T.lowerlimit;break;case n.vbr_rh:var L=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=e.VBR_q&&e.VBR_q<=9){var V=L[e.VBR_q],D=L[e.VBR_q+1],H=e.VBR_q_frac;S=linear_int(V,D,H)}else S=19500;break;default:L=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=e.VBR_q&&e.VBR_q<=9){V=L[e.VBR_q],D=L[e.VBR_q+1],H=e.VBR_q_frac;S=linear_int(V,D,H)}else S=19500}e.mode!=MPEGMode.MONO||e.VBR!=n.vbr_off&&e.VBR!=n.vbr_abr||(S*=1.5),e.lowpassfreq=0|S}if(0==e.out_samplerate&&(2*e.lowpassfreq>e.in_samplerate&&(e.lowpassfreq=e.in_samplerate/2),e.out_samplerate=(r=0|e.lowpassfreq,s=e.in_samplerate,c=44100,s>=48e3?c=48e3:s>=44100?c=44100:s>=32e3?c=32e3:s>=24e3?c=24e3:s>=22050?c=22050:s>=16e3?c=16e3:s>=12e3?c=12e3:s>=11025?c=11025:s>=8e3&&(c=8e3),-1==r?c:(r<=15960&&(c=44100),r<=15250&&(c=32e3),r<=11220&&(c=24e3),r<=9970&&(c=22050),r<=7230&&(c=16e3),r<=5420&&(c=12e3),r<=4510&&(c=11025),r<=3970&&(c=8e3),s<c?s>44100?48e3:s>32e3?44100:s>24e3?32e3:s>22050?24e3:s>16e3?22050:s>12e3?16e3:s>11025?12e3:s>8e3?11025:8e3:c))),e.lowpassfreq=Math.min(20500,e.lowpassfreq),e.lowpassfreq=Math.min(e.out_samplerate/2,e.lowpassfreq),e.VBR==n.vbr_off&&(e.compression_ratio=16*e.out_samplerate*_.channels_out/(1e3*e.brate)),e.VBR==n.vbr_abr&&(e.compression_ratio=16*e.out_samplerate*_.channels_out/(1e3*e.VBR_mean_bitrate_kbps)),e.bWriteVbrTag||(e.findReplayGain=!1,e.decode_on_the_fly=!1,_.findPeakSample=!1),_.findReplayGain=e.findReplayGain,_.decode_on_the_fly=e.decode_on_the_fly,_.decode_on_the_fly&&(_.findPeakSample=!0),_.findReplayGain&&m.InitGainAnalysis(_.rgdata,e.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return e.internal_flags=null,-6;switch(_.decode_on_the_fly&&!e.decode_only&&(null!=_.hip&&B.hip_decode_exit(_.hip),_.hip=B.hip_decode_init()),_.mode_gr=e.out_samplerate<=24e3?1:2,e.framesize=576*_.mode_gr,e.encoder_delay=v.ENCDELAY,_.resample_ratio=e.in_samplerate/e.out_samplerate,e.VBR){case n.vbr_mt:case n.vbr_rh:case n.vbr_mtrh:e.compression_ratio=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5][e.VBR_q];break;case n.vbr_abr:e.compression_ratio=16*e.out_samplerate*_.channels_out/(1e3*e.VBR_mean_bitrate_kbps);break;default:e.compression_ratio=16*e.out_samplerate*_.channels_out/(1e3*e.brate)}if(e.mode==MPEGMode.NOT_SET&&(e.mode=MPEGMode.JOINT_STEREO),e.highpassfreq>0?(_.highpass1=2*e.highpassfreq,e.highpasswidth>=0?_.highpass2=2*(e.highpassfreq+e.highpasswidth):_.highpass2=2*e.highpassfreq,_.highpass1/=e.out_samplerate,_.highpass2/=e.out_samplerate):(_.highpass1=0,_.highpass2=0),e.lowpassfreq>0?(_.lowpass2=2*e.lowpassfreq,e.lowpasswidth>=0?(_.lowpass1=2*(e.lowpassfreq-e.lowpasswidth),_.lowpass1<0&&(_.lowpass1=0)):_.lowpass1=2*e.lowpassfreq,_.lowpass1/=e.out_samplerate,_.lowpass2/=e.out_samplerate):(_.lowpass1=0,_.lowpass2=0),function(e){var n=e.internal_flags,i=32,r=-1;if(n.lowpass1>0){for(var a=999,s=0;s<=31;s++)(_=s/31)>=n.lowpass2&&(i=Math.min(i,s)),n.lowpass1<_&&_<n.lowpass2&&(a=Math.min(a,s));n.lowpass1=999==a?(i-.75)/31:(a-.75)/31,n.lowpass2=i/31}if(n.highpass2>0&&n.highpass2<.75/31*.9&&(n.highpass1=0,n.highpass2=0,t.err.println("Warning: highpass filter disabled.  highpass frequency too small\n")),n.highpass2>0){var o=-1;for(s=0;s<=31;s++)(_=s/31)<=n.highpass1&&(r=Math.max(r,s)),n.highpass1<_&&_<n.highpass2&&(o=Math.max(o,s));n.highpass1=r/31,n.highpass2=-1==o?(r+.75)/31:(o+.75)/31}for(s=0;s<32;s++){var l,c,_=s/31;l=n.highpass2>n.highpass1?x((n.highpass2-_)/(n.highpass2-n.highpass1+1e-20)):1,c=n.lowpass2>n.lowpass1?x((_-n.lowpass1)/(n.lowpass2-n.lowpass1+1e-20)):1,n.amp_filter[s]=l*c}}(e),_.samplerate_index=P(e.out_samplerate,e),_.samplerate_index<0)return e.internal_flags=null,-1;if(e.VBR==n.vbr_off){if(e.free_format)_.bitrate_index=0;else if(e.brate=O(e.brate,e.version,e.out_samplerate),_.bitrate_index=C(e.brate,e.version,e.out_samplerate),_.bitrate_index<=0)return e.internal_flags=null,-1}else _.bitrate_index=1;e.analysis&&(e.bWriteVbrTag=!1),null!=_.pinfo&&(e.bWriteVbrTag=!1),b.init_bit_stream_w(_);for(var F,j=_.samplerate_index+3*e.version+6*(e.out_samplerate<16e3?1:0),X=0;X<v.SBMAX_l+1;X++)_.scalefac_band.l[X]=y.sfBandIndex[j].l[X];for(X=0;X<v.PSFB21+1;X++){var q=(_.scalefac_band.l[22]-_.scalefac_band.l[21])/v.PSFB21,Y=_.scalefac_band.l[21]+X*q;_.scalefac_band.psfb21[X]=Y}_.scalefac_band.psfb21[v.PSFB21]=576;for(X=0;X<v.SBMAX_s+1;X++)_.scalefac_band.s[X]=y.sfBandIndex[j].s[X];for(X=0;X<v.PSFB12+1;X++){q=(_.scalefac_band.s[13]-_.scalefac_band.s[12])/v.PSFB12,Y=_.scalefac_band.s[12]+X*q;_.scalefac_band.psfb12[X]=Y}for(_.scalefac_band.psfb12[v.PSFB12]=192,1==e.version?_.sideinfo_len=1==_.channels_out?21:36:_.sideinfo_len=1==_.channels_out?13:21,e.error_protection&&(_.sideinfo_len+=2),function(e){var t=e.internal_flags;e.frameNum=0,e.write_id3tag_automatic&&M.id3tag_write_v2(e),t.bitrate_stereoMode_Hist=a([16,5]),t.bitrate_blockType_Hist=a([16,6]),t.PeakSample=0,e.bWriteVbrTag&&A.InitVbrTag(e)}(e),_.Class_ID=I,F=0;F<19;F++)_.nsPsy.pefirbuf[F]=700*_.mode_gr*_.channels_out;switch(-1==e.ATHtype&&(e.ATHtype=4),o(e.VBR_q<=9),o(e.VBR_q>=0),e.VBR){case n.vbr_mt:e.VBR=n.vbr_mtrh;case n.vbr_mtrh:null==e.useTemporal&&(e.useTemporal=!1),g.apply_preset(e,500-10*e.VBR_q,0),e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),e.quality<5&&(e.quality=0),e.quality>5&&(e.quality=5),_.PSY.mask_adjust=e.maskingadjust,_.PSY.mask_adjust_short=e.maskingadjust_short,e.experimentalY?_.sfb21_extra=!1:_.sfb21_extra=e.out_samplerate>44e3,_.iteration_loop=new VBRNewIterationLoop(w);break;case n.vbr_rh:g.apply_preset(e,500-10*e.VBR_q,0),_.PSY.mask_adjust=e.maskingadjust,_.PSY.mask_adjust_short=e.maskingadjust_short,e.experimentalY?_.sfb21_extra=!1:_.sfb21_extra=e.out_samplerate>44e3,e.quality>6&&(e.quality=6),e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),_.iteration_loop=new VBROldIterationLoop(w);break;default:var U;_.sfb21_extra=!1,e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),(U=e.VBR)==n.vbr_off&&(e.VBR_mean_bitrate_kbps=e.brate),g.apply_preset(e,e.VBR_mean_bitrate_kbps,0),e.VBR=U,_.PSY.mask_adjust=e.maskingadjust,_.PSY.mask_adjust_short=e.maskingadjust_short,U==n.vbr_off?_.iteration_loop=new h(w):_.iteration_loop=new ABRIterationLoop(w)}if(o(e.scale>=0),e.VBR!=n.vbr_off){if(_.VBR_min_bitrate=1,_.VBR_max_bitrate=14,e.out_samplerate<16e3&&(_.VBR_max_bitrate=8),0!=e.VBR_min_bitrate_kbps&&(e.VBR_min_bitrate_kbps=O(e.VBR_min_bitrate_kbps,e.version,e.out_samplerate),_.VBR_min_bitrate=C(e.VBR_min_bitrate_kbps,e.version,e.out_samplerate),_.VBR_min_bitrate<0))return-1;if(0!=e.VBR_max_bitrate_kbps&&(e.VBR_max_bitrate_kbps=O(e.VBR_max_bitrate_kbps,e.version,e.out_samplerate),_.VBR_max_bitrate=C(e.VBR_max_bitrate_kbps,e.version,e.out_samplerate),_.VBR_max_bitrate<0))return-1;e.VBR_min_bitrate_kbps=p.bitrate_table[e.version][_.VBR_min_bitrate],e.VBR_max_bitrate_kbps=p.bitrate_table[e.version][_.VBR_max_bitrate],e.VBR_mean_bitrate_kbps=Math.min(p.bitrate_table[e.version][_.VBR_max_bitrate],e.VBR_mean_bitrate_kbps),e.VBR_mean_bitrate_kbps=Math.max(p.bitrate_table[e.version][_.VBR_min_bitrate],e.VBR_mean_bitrate_kbps)}return e.tune&&(_.PSY.mask_adjust+=e.tune_value_a,_.PSY.mask_adjust_short+=e.tune_value_a),function(e){var t=e.internal_flags;switch(e.quality){default:case 9:t.psymodel=0,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 8:e.quality=7;case 7:t.psymodel=1,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 6:case 5:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=0,t.full_outer_loop=0;break;case 4:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 3:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=1,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 2:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=1,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 1:case 0:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=2,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0}}(e),o(e.scale>=0),e.athaa_type<0?_.ATH.useAdjust=3:_.ATH.useAdjust=e.athaa_type,_.ATH.aaSensitivityP=Math.pow(10,e.athaa_sensitivity/-10),null==e.short_blocks&&(e.short_blocks=i.short_block_allowed),e.short_blocks!=i.short_block_allowed||e.mode!=MPEGMode.JOINT_STEREO&&e.mode!=MPEGMode.STEREO||(e.short_blocks=i.short_block_coupled),e.quant_comp<0&&(e.quant_comp=1),e.quant_comp_short<0&&(e.quant_comp_short=0),e.msfix<0&&(e.msfix=0),e.exp_nspsytune=1|e.exp_nspsytune,e.internal_flags.nsPsy.attackthre<0&&(e.internal_flags.nsPsy.attackthre=l.NSATTACKTHRE),e.internal_flags.nsPsy.attackthre_s<0&&(e.internal_flags.nsPsy.attackthre_s=l.NSATTACKTHRE_S),o(e.scale>=0),e.scale<0&&(e.scale=1),e.ATHtype<0&&(e.ATHtype=4),e.ATHcurve<0&&(e.ATHcurve=4),e.athaa_loudapprox<0&&(e.athaa_loudapprox=2),e.interChRatio<0&&(e.interChRatio=0),null==e.useTemporal&&(e.useTemporal=!0),_.slot_lag=_.frac_SpF=0,e.VBR==n.vbr_off&&(_.slot_lag=_.frac_SpF=72e3*(e.version+1)*e.brate%e.out_samplerate|0),y.iteration_init(e),R.psymodel_init(e),o(e.scale>=0),0},this.lame_encode_flush=function(e,t,n,i){var r,a,o,l,c=e.internal_flags,_=s([2,1152]),u=0,f=c.mf_samples_to_encode-v.POSTDELAY,h=L(e);if(c.mf_samples_to_encode<1)return 0;for(r=0,e.in_samplerate!=e.out_samplerate&&(f+=16*e.out_samplerate/e.in_samplerate),(o=e.framesize-f%e.framesize)<576&&(o+=e.framesize),e.encoder_padding=o,l=(f+o)/e.framesize;l>0&&u>=0;){var d=h-c.mf_size,p=e.frameNum;d*=e.in_samplerate,(d/=e.out_samplerate)>1152&&(d=1152),d<1&&(d=1),a=i-r,0==i&&(a=0),n+=u=this.lame_encode_buffer(e,_[0],_[1],d,t,n,a),r+=u,l-=p!=e.frameNum?1:0}if(c.mf_samples_to_encode=0,u<0)return u;if(a=i-r,0==i&&(a=0),b.flush_bitstream(e),(u=b.copy_buffer(c,t,n,a,1))<0)return u;if(n+=u,a=i-(r+=u),0==i&&(a=0),e.write_id3tag_automatic){if(M.id3tag_write_v1(e),(u=b.copy_buffer(c,t,n,a,0))<0)return u;r+=u}return r},this.lame_encode_buffer=function(e,t,n,i,a,s,l){var c=e.internal_flags,u=[null,null];if(c.Class_ID!=I)return-3;if(0==i)return 0;!function(e,t){(null==e.in_buffer_0||e.in_buffer_nsamples<t)&&(e.in_buffer_0=r(t),e.in_buffer_1=r(t),e.in_buffer_nsamples=t)}(c,i),u[0]=c.in_buffer_0,u[1]=c.in_buffer_1;for(var f=0;f<i;f++)u[0][f]=t[f],c.channels_in>1&&(u[1][f]=n[f]);return function(e,t,n,i,r,a,s){var l,c,u,f,h,p=e.internal_flags,g=0,y=[null,null],w=[null,null];if(p.Class_ID!=I)return-3;if(0==i)return 0;if(h=b.copy_buffer(p,r,a,s,0),h<0)return h;if(a+=h,g+=h,w[0]=t,w[1]=n,d.NEQ(e.scale,0)&&d.NEQ(e.scale,1))for(c=0;c<i;++c)w[0][c]*=e.scale,2==p.channels_out&&(w[1][c]*=e.scale);if(d.NEQ(e.scale_left,0)&&d.NEQ(e.scale_left,1))for(c=0;c<i;++c)w[0][c]*=e.scale_left;if(d.NEQ(e.scale_right,0)&&d.NEQ(e.scale_right,1))for(c=0;c<i;++c)w[1][c]*=e.scale_right;if(2==e.num_channels&&1==p.channels_out)for(c=0;c<i;++c)w[0][c]=.5*(w[0][c]+w[1][c]),w[1][c]=0;f=L(e),y[0]=p.mfbuf[0],y[1]=p.mfbuf[1];var S=0;for(;i>0;){var A=[null,null],M=0,B=0;A[0]=w[0],A[1]=w[1];var R=new D;if(q(e,y,A,S,i,R),M=R.n_in,B=R.n_out,p.findReplayGain&&!p.decode_on_the_fly&&m.AnalyzeSamples(p.rgdata,y[0],p.mf_size,y[1],p.mf_size,B,p.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(i-=M,S+=M,p.channels_out,p.mf_size+=B,o(p.mf_size<=_.MFSIZE),p.mf_samples_to_encode<1&&(p.mf_samples_to_encode=v.ENCDELAY+v.POSTDELAY),p.mf_samples_to_encode+=B,p.mf_size>=f){var E=s-g;if(0==s&&(E=0),(l=V(e,y[0],y[1],r,a,E))<0)return l;for(a+=l,g+=l,p.mf_size-=e.framesize,p.mf_samples_to_encode-=e.framesize,u=0;u<p.channels_out;u++)for(c=0;c<p.mf_size;c++)y[u][c]=y[u][c+e.framesize]}}return o(0==i),g}(e,u[0],u[1],i,a,s,l)}},si}function qi(){if(ci)return li;ci=1;var e=Ei();e.System;var t=e.VbrMode;return e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double,e.new_float,e.new_float_n,e.new_int,e.new_int_n,e.assert,li=function(){function e(e,t,n,i,r,a,s,o,l,c,_,u,f,h,d){this.vbr_q=e,this.quant_comp=t,this.quant_comp_s=n,this.expY=i,this.st_lrm=r,this.st_s=a,this.masking_adj=s,this.masking_adj_short=o,this.ath_lower=l,this.ath_curve=c,this.ath_sensitivity=_,this.interch=u,this.safejoint=f,this.sfb21mod=h,this.msfix=d}function n(e,t,n,i,r,a,s,o,l,c,_,u,f,h){this.quant_comp=t,this.quant_comp_s=n,this.safejoint=i,this.nsmsfix=r,this.st_lrm=a,this.st_s=s,this.nsbass=o,this.scale=l,this.masking_adj=c,this.ath_lower=_,this.ath_curve=u,this.interch=f,this.sfscale=h}var i;this.setModules=function(e){i=e};var r=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],a=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function s(e,n,i){var s=e.VBR==t.vbr_rh?r:a,o=e.VBR_q_frac,l=s[n],c=s[n+1],_=l;l.st_lrm=l.st_lrm+o*(c.st_lrm-l.st_lrm),l.st_s=l.st_s+o*(c.st_s-l.st_s),l.masking_adj=l.masking_adj+o*(c.masking_adj-l.masking_adj),l.masking_adj_short=l.masking_adj_short+o*(c.masking_adj_short-l.masking_adj_short),l.ath_lower=l.ath_lower+o*(c.ath_lower-l.ath_lower),l.ath_curve=l.ath_curve+o*(c.ath_curve-l.ath_curve),l.ath_sensitivity=l.ath_sensitivity+o*(c.ath_sensitivity-l.ath_sensitivity),l.interch=l.interch+o*(c.interch-l.interch),l.msfix=l.msfix+o*(c.msfix-l.msfix),function(e,t){var n=0;0>t&&(n=-1,t=0);9<t&&(n=-1,t=9);e.VBR_q=t,e.VBR_q_frac=0}(e,_.vbr_q),0!=i?e.quant_comp=_.quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=_.quant_comp),0!=i?e.quant_comp_short=_.quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=_.quant_comp_s),0!=_.expY&&(e.experimentalY=0!=_.expY),0!=i?e.internal_flags.nsPsy.attackthre=_.st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=_.st_lrm),0!=i?e.internal_flags.nsPsy.attackthre_s=_.st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=_.st_s),0!=i?e.maskingadjust=_.masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=_.masking_adj),0!=i?e.maskingadjust_short=_.masking_adj_short:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=_.masking_adj_short),0!=i?e.ATHlower=-_.ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-_.ath_lower/10),0!=i?e.ATHcurve=_.ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=_.ath_curve),0!=i?e.athaa_sensitivity=_.ath_sensitivity:Math.abs(e.athaa_sensitivity- -1)>0||(e.athaa_sensitivity=_.ath_sensitivity),_.interch>0&&(0!=i?e.interChRatio=_.interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=_.interch)),_.safejoint>0&&(e.exp_nspsytune=e.exp_nspsytune|_.safejoint),_.sfb21mod>0&&(e.exp_nspsytune=e.exp_nspsytune|_.sfb21mod<<20),0!=i?e.msfix=_.msfix:Math.abs(e.msfix- -1)>0||(e.msfix=_.msfix),0==i&&(e.VBR_q=n,e.VBR_q_frac=o)}var o=[new n(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new n(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new n(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new n(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new n(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new n(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new n(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new n(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new n(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new n(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new n(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new n(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new n(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new n(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new n(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new n(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new n(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function l(e,n,r){var a=n,s=i.nearestBitrateFullIndex(n);if(e.VBR=t.vbr_abr,e.VBR_mean_bitrate_kbps=a,e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320),e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.brate=e.VBR_mean_bitrate_kbps,e.VBR_mean_bitrate_kbps>320&&(e.disable_reservoir=!0),o[s].safejoint>0&&(e.exp_nspsytune=2|e.exp_nspsytune),o[s].sfscale>0&&(e.internal_flags.noise_shaping=2),Math.abs(o[s].nsbass)>0){var l=int(4*o[s].nsbass);l<0&&(l+=64),e.exp_nspsytune=e.exp_nspsytune|l<<2}return 0!=r?e.quant_comp=o[s].quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=o[s].quant_comp),0!=r?e.quant_comp_short=o[s].quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=o[s].quant_comp_s),0!=r?e.msfix=o[s].nsmsfix:Math.abs(e.msfix- -1)>0||(e.msfix=o[s].nsmsfix),0!=r?e.internal_flags.nsPsy.attackthre=o[s].st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=o[s].st_lrm),0!=r?e.internal_flags.nsPsy.attackthre_s=o[s].st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=o[s].st_s),0!=r?e.scale=o[s].scale:Math.abs(e.scale- -1)>0||(e.scale=o[s].scale),0!=r?e.maskingadjust=o[s].masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=o[s].masking_adj),o[s].masking_adj>0?0!=r?e.maskingadjust_short=.9*o[s].masking_adj:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=.9*o[s].masking_adj):0!=r?e.maskingadjust_short=1.1*o[s].masking_adj:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=1.1*o[s].masking_adj),0!=r?e.ATHlower=-o[s].ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-o[s].ath_lower/10),0!=r?e.ATHcurve=o[s].ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=o[s].ath_curve),0!=r?e.interChRatio=o[s].interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=o[s].interch),n}this.apply_preset=function(e,n,i){switch(n){case Lame.R3MIX:n=Lame.V3,e.VBR=t.vbr_mtrh;break;case Lame.MEDIUM:n=Lame.V4,e.VBR=t.vbr_rh;break;case Lame.MEDIUM_FAST:n=Lame.V4,e.VBR=t.vbr_mtrh;break;case Lame.STANDARD:n=Lame.V2,e.VBR=t.vbr_rh;break;case Lame.STANDARD_FAST:n=Lame.V2,e.VBR=t.vbr_mtrh;break;case Lame.EXTREME:n=Lame.V0,e.VBR=t.vbr_rh;break;case Lame.EXTREME_FAST:n=Lame.V0,e.VBR=t.vbr_mtrh;break;case Lame.INSANE:return n=320,e.preset=n,l(e,n,i),e.VBR=t.vbr_off,n}switch(e.preset=n,n){case Lame.V9:return s(e,9,i),n;case Lame.V8:return s(e,8,i),n;case Lame.V7:return s(e,7,i),n;case Lame.V6:return s(e,6,i),n;case Lame.V5:return s(e,5,i),n;case Lame.V4:return s(e,4,i),n;case Lame.V3:return s(e,3,i),n;case Lame.V2:return s(e,2,i),n;case Lame.V1:return s(e,1,i),n;case Lame.V0:return s(e,0,i),n}return 8<=n&&n<=320?l(e,n,i):(e.preset=0,n)}},li}function Yi(){if(mi)return vi;mi=1;var e=Ei(),t=e.System,n=e.VbrMode;e.Float,e.ShortBlock;var i=e.Util,r=e.Arrays;e.new_array_n,e.new_byte,e.new_double;var a=e.new_float;e.new_float_n,e.new_int,e.new_int_n;var s=e.assert,o=ui?_i:(ui=1,_i=function(){this.setModules=function(e,t){}}),l=hi?fi:(hi=1,fi=function(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}),c=function(){if(pi)return di;pi=1;var e=Ei(),t=e.new_float,n=e.new_int;return e.assert,di=function(){this.global_gain=0,this.sfb_count1=0,this.step=n(39),this.noise=t(39),this.noise_log=t(39)}}(),_=Ti(),u=Oi(),f=Pi();return vi=function(){var e,h,d;this.rv=null,this.qupvt=null;var p,v=new o;function m(e){this.ordinal=e}function b(e){for(var t=0;t<e.sfbmax;t++)if(e.scalefac[t]+e.subblock_gain[e.window[t]]==0)return!1;return!0}function g(e){return i.FAST_LOG10(.368+.632*e*e*e)}function y(e,t,n,i,r){var a;switch(e){default:case 9:t.over_count>0?(a=n.over_SSD<=t.over_SSD,n.over_SSD==t.over_SSD&&(a=n.bits<t.bits)):a=n.max_noise<0&&10*n.max_noise+n.bits<=10*t.max_noise+t.bits;break;case 0:a=n.over_count<t.over_count||n.over_count==t.over_count&&n.over_noise<t.over_noise||n.over_count==t.over_count&&BitStream.EQ(n.over_noise,t.over_noise)&&n.tot_noise<t.tot_noise;break;case 8:n.max_noise=function(e,t){for(var n=1e-37,i=0;i<t.psymax;i++)n+=g(e[i]);return Math.max(1e-20,n)}(r,i);case 1:a=n.max_noise<t.max_noise;break;case 2:a=n.tot_noise<t.tot_noise;break;case 3:a=n.tot_noise<t.tot_noise&&n.max_noise<t.max_noise;break;case 4:a=n.max_noise<=0&&t.max_noise>.2||n.max_noise<=0&&t.max_noise<0&&t.max_noise>n.max_noise-.2&&n.tot_noise<t.tot_noise||n.max_noise<=0&&t.max_noise>0&&t.max_noise>n.max_noise-.2&&n.tot_noise<t.tot_noise+t.over_noise||n.max_noise>0&&t.max_noise>-.05&&t.max_noise>n.max_noise-.1&&n.tot_noise+n.over_noise<t.tot_noise+t.over_noise||n.max_noise>0&&t.max_noise>-.1&&t.max_noise>n.max_noise-.15&&n.tot_noise+n.over_noise+n.over_noise<t.tot_noise+t.over_noise+t.over_noise;break;case 5:a=n.over_noise<t.over_noise||BitStream.EQ(n.over_noise,t.over_noise)&&n.tot_noise<t.tot_noise;break;case 6:a=n.over_noise<t.over_noise||BitStream.EQ(n.over_noise,t.over_noise)&&(n.max_noise<t.max_noise||BitStream.EQ(n.max_noise,t.max_noise)&&n.tot_noise<=t.tot_noise);break;case 7:a=n.over_count<t.over_count||n.over_noise<t.over_noise}return 0==t.over_count&&(a=a&&n.bits<t.bits),a}function w(e,t,n,i,a){var o=e.internal_flags;!function(e,t,n,i,r){var a,s=e.internal_flags;a=0==t.scalefac_scale?1.2968395546510096:1.6817928305074292;for(var o=0,l=0;l<t.sfbmax;l++)o<n[l]&&(o=n[l]);var c=s.noise_shaping_amp;switch(3==c&&(c=r?2:1),c){case 2:break;case 1:o>1?o=Math.pow(o,.5):o*=.95;break;default:o>1?o=1:o*=.95}var _=0;for(l=0;l<t.sfbmax;l++){var u,f=t.width[l];if(_+=f,!(n[l]<o)){if(2&s.substep_shaping&&(s.pseudohalf[l]=0==s.pseudohalf[l]?1:0,0==s.pseudohalf[l]&&2==s.noise_shaping_amp))return;for(t.scalefac[l]++,u=-f;u<0;u++)i[_+u]*=a,i[_+u]>t.xrpow_max&&(t.xrpow_max=i[_+u]);if(2==s.noise_shaping_amp)return}}}(e,t,n,i,a);var l=b(t);return!l&&(!(l=2==o.mode_gr?p.scale_bitcount(t):p.scale_bitcount_lsf(o,t))||(o.noise_shaping>1&&(r.fill(o.pseudohalf,0),0==t.scalefac_scale?(!function(e,t){for(var n=0,i=0;i<e.sfbmax;i++){var r=e.width[i],a=e.scalefac[i];if(0!=e.preflag&&(a+=d.pretab[i]),n+=r,1&a){a++;for(var s=-r;s<0;s++)t[n+s]*=1.2968395546510096,t[n+s]>e.xrpow_max&&(e.xrpow_max=t[n+s])}e.scalefac[i]=a>>1}e.preflag=0,e.scalefac_scale=1}(t,i),l=!1):t.block_type==_.SHORT_TYPE&&o.subblock_gain>0&&(l=function(e,t,n){var i,r=t.scalefac;for(i=0;i<t.sfb_lmax;i++)if(r[i]>=16)return!0;for(var a=0;a<3;a++){var o=0,l=0;for(i=t.sfb_lmax+a;i<t.sfbdivide;i+=3)o<r[i]&&(o=r[i]);for(;i<t.sfbmax;i+=3)l<r[i]&&(l=r[i]);if(!(o<16&&l<8)){if(t.subblock_gain[a]>=7)return!0;t.subblock_gain[a]++;var c=e.scalefac_band.l[t.sfb_lmax];for(i=t.sfb_lmax+a;i<t.sfbmax;i+=3){var _=t.width[i],u=r[i];if(s(u>=0),(u-=4>>t.scalefac_scale)>=0)r[i]=u,c+=3*_;else{r[i]=0;var f=210+(u<<t.scalefac_scale+1);p=d.IPOW20(f),c+=_*(a+1);for(var h=-_;h<0;h++)n[c+h]*=p,n[c+h]>t.xrpow_max&&(t.xrpow_max=n[c+h]);c+=_*(3-a-1)}}var p=d.IPOW20(202);for(c+=t.width[i]*(a+1),h=-t.width[i];h<0;h++)n[c+h]*=p,n[c+h]>t.xrpow_max&&(t.xrpow_max=n[c+h])}}return!1}(o,t,i)||b(t))),l||(l=2==o.mode_gr?p.scale_bitcount(t):p.scale_bitcount_lsf(o,t)),!l))}this.setModules=function(t,n,i,r){e=t,h=n,this.rv=n,d=i,this.qupvt=i,p=r,v.setModules(d,p)},this.ms_convert=function(e,t){for(var n=0;n<576;++n){var r=e.tt[t][0].xr[n],a=e.tt[t][1].xr[n];e.tt[t][0].xr[n]=(r+a)*(.5*i.SQRT2),e.tt[t][1].xr[n]=(r-a)*(.5*i.SQRT2)}},this.init_xrpow=function(e,t,n){var i=0,a=0|t.max_nonzero_coeff;if(s(null!=n),t.xrpow_max=0,s(0<=a&&a<=575),r.fill(n,a,576,0),i=function(e,t,n,i){i=0;for(var r=0;r<=n;++r){var a=Math.abs(e.xr[r]);i+=a,t[r]=Math.sqrt(a*Math.sqrt(a)),t[r]>e.xrpow_max&&(e.xrpow_max=t[r])}return i}(t,n,a,i),i>1e-20){var o=0;2&e.substep_shaping&&(o=1);for(var l=0;l<t.psymax;l++)e.pseudohalf[l]=o;return!0}return r.fill(t.l3_enc,0,576,0),!1},this.init_outer_loop=function(e,n){n.part2_3_length=0,n.big_values=0,n.count1=0,n.global_gain=210,n.scalefac_compress=0,n.table_select[0]=0,n.table_select[1]=0,n.table_select[2]=0,n.subblock_gain[0]=0,n.subblock_gain[1]=0,n.subblock_gain[2]=0,n.subblock_gain[3]=0,n.region0_count=0,n.region1_count=0,n.preflag=0,n.scalefac_scale=0,n.count1table_select=0,n.part2_length=0,n.sfb_lmax=_.SBPSY_l,n.sfb_smin=_.SBPSY_s,n.psy_lmax=e.sfb21_extra?_.SBMAX_l:_.SBPSY_l,n.psymax=n.psy_lmax,n.sfbmax=n.sfb_lmax,n.sfbdivide=11;for(var i=0;i<_.SBMAX_l;i++)n.width[i]=e.scalefac_band.l[i+1]-e.scalefac_band.l[i],n.window[i]=3;if(n.block_type==_.SHORT_TYPE){var s=a(576);n.sfb_smin=0,n.sfb_lmax=0,0!=n.mixed_block_flag&&(n.sfb_smin=3,n.sfb_lmax=2*e.mode_gr+4),n.psymax=n.sfb_lmax+3*((e.sfb21_extra?_.SBMAX_s:_.SBPSY_s)-n.sfb_smin),n.sfbmax=n.sfb_lmax+3*(_.SBPSY_s-n.sfb_smin),n.sfbdivide=n.sfbmax-18,n.psy_lmax=n.sfb_lmax;var o=e.scalefac_band.l[n.sfb_lmax];t.arraycopy(n.xr,0,s,0,576);for(i=n.sfb_smin;i<_.SBMAX_s;i++)for(var l=e.scalefac_band.s[i],c=e.scalefac_band.s[i+1],u=0;u<3;u++)for(var f=l;f<c;f++)n.xr[o++]=s[3*f+u];var h=n.sfb_lmax;for(i=n.sfb_smin;i<_.SBMAX_s;i++)n.width[h]=n.width[h+1]=n.width[h+2]=e.scalefac_band.s[i+1]-e.scalefac_band.s[i],n.window[h]=0,n.window[h+1]=1,n.window[h+2]=2,h+=3}n.count1bits=0,n.sfb_partition_table=d.nr_of_sfb_block[0][0],n.slen[0]=0,n.slen[1]=0,n.slen[2]=0,n.slen[3]=0,n.max_nonzero_coeff=575,r.fill(n.scalefac,0),function(e,t){var n=e.ATH,i=t.xr;if(t.block_type!=_.SHORT_TYPE)for(var r=!1,a=_.PSFB21-1;a>=0&&!r;a--){var s=e.scalefac_band.psfb21[a],o=e.scalefac_band.psfb21[a+1],l=d.athAdjust(n.adjust,n.psfb21[a],n.floor);e.nsPsy.longfact[21]>1e-12&&(l*=e.nsPsy.longfact[21]);for(var c=o-1;c>=s;c--){if(!(Math.abs(i[c])<l)){r=!0;break}i[c]=0}}else for(var u=0;u<3;u++)for(r=!1,a=_.PSFB12-1;a>=0&&!r;a--){o=(s=3*e.scalefac_band.s[12]+(e.scalefac_band.s[13]-e.scalefac_band.s[12])*u+(e.scalefac_band.psfb12[a]-e.scalefac_band.psfb12[0]))+(e.scalefac_band.psfb12[a+1]-e.scalefac_band.psfb12[a]);var f=d.athAdjust(n.adjust,n.psfb12[a],n.floor);for(e.nsPsy.shortfact[12]>1e-12&&(f*=e.nsPsy.shortfact[12]),c=o-1;c>=s;c--){if(!(Math.abs(i[c])<f)){r=!0;break}i[c]=0}}}(e,n)},m.BINSEARCH_NONE=new m(0),m.BINSEARCH_UP=new m(1),m.BINSEARCH_DOWN=new m(2),this.trancate_smallspectrums=function(e,t,n,i){var s=a(f.SFBMAX);if((4&e.substep_shaping||t.block_type!=_.SHORT_TYPE)&&!(128&e.substep_shaping)){d.calc_noise(t,n,s,new l,null);for(var o=0;o<576;o++){var c=0;0!=t.l3_enc[o]&&(c=Math.abs(t.xr[o])),i[o]=c}o=0;var u=8;t.block_type==_.SHORT_TYPE&&(u=6);do{var h,v,m,b,g=t.width[u];if(o+=g,!(s[u]>=1||(r.sort(i,o-g,g),BitStream.EQ(i[o-1],0)))){h=(1-s[u])*n[u],v=0,b=0;do{var y;for(m=1;b+m<g&&!BitStream.NEQ(i[b+o-g],i[b+o+m-g]);m++);if(h<(y=i[b+o-g]*i[b+o-g]*m)){0!=b&&(v=i[b+o-g-1]);break}h-=y,b+=m}while(b<g);if(!BitStream.EQ(v,0))do{Math.abs(t.xr[o-g])<=v&&(t.l3_enc[o-g]=0)}while(--g>0)}}while(++u<t.psymax);t.part2_3_length=p.noquant_count_bits(e,t,null)}},this.outer_loop=function(e,i,r,o,h,v){var b=e.internal_flags,g=new u,S=a(576),A=a(f.SFBMAX),M=new l,B=new c,R=9999999,E=!1,k=!1,T=0;if(function(e,t,n,i,r){var a,o=e.CurrentStep[i],l=!1,c=e.OldValue[i],_=m.BINSEARCH_NONE;for(t.global_gain=c,n-=t.part2_length,s(0!=o);;){var u;if(a=p.count_bits(e,r,t,null),1==o||a==n)break;a>n?(_==m.BINSEARCH_DOWN&&(l=!0),l&&(o/=2),_=m.BINSEARCH_UP,u=o):(_==m.BINSEARCH_UP&&(l=!0),l&&(o/=2),_=m.BINSEARCH_DOWN,u=-o),t.global_gain+=u,t.global_gain<0&&(t.global_gain=0,l=!0),t.global_gain>255&&(t.global_gain=255,l=!0)}for(s(t.global_gain>=0),s(t.global_gain<256);a>n&&t.global_gain<255;)t.global_gain++,a=p.count_bits(e,r,t,null);e.CurrentStep[i]=c-t.global_gain>=4?4:2,e.OldValue[i]=t.global_gain,t.part2_3_length=a}(b,i,v,h,o),0==b.noise_shaping)return 100;d.calc_noise(i,r,A,M,B),M.bits=i.part2_3_length,g.assign(i);var I=0;for(t.arraycopy(o,0,S,0,576);!E;){do{var x,P=new l,O=255;if(x=2&b.substep_shaping?20:3,b.sfb21_extra){if(A[g.sfbmax]>1)break;if(g.block_type==_.SHORT_TYPE&&(A[g.sfbmax+1]>1||A[g.sfbmax+2]>1))break}if(!w(e,g,A,o,k))break;0!=g.scalefac_scale&&(O=254);var C=v-g.part2_length;if(C<=0)break;for(;(g.part2_3_length=p.count_bits(b,o,g,B))>C&&g.global_gain<=O;)g.global_gain++;if(g.global_gain>O)break;if(0==M.over_count){for(;(g.part2_3_length=p.count_bits(b,o,g,B))>R&&g.global_gain<=O;)g.global_gain++;if(g.global_gain>O)break}if(d.calc_noise(g,r,A,P,B),P.bits=g.part2_3_length,0!=(y(i.block_type!=_.SHORT_TYPE?e.quant_comp:e.quant_comp_short,M,P,g,A)?1:0))R=i.part2_3_length,M=P,i.assign(g),I=0,t.arraycopy(o,0,S,0,576);else if(0==b.full_outer_loop){if(++I>x&&0==M.over_count)break;if(3==b.noise_shaping_amp&&k&&I>30)break;if(3==b.noise_shaping_amp&&k&&g.global_gain-T>15)break}}while(g.global_gain+g.scalefac_scale<255);3==b.noise_shaping_amp?k?E=!0:(g.assign(i),t.arraycopy(S,0,o,0,576),I=0,T=g.global_gain,k=!0):E=!0}return s(i.global_gain+i.scalefac_scale<=255),e.VBR==n.vbr_rh||e.VBR==n.vbr_mtrh?t.arraycopy(S,0,o,0,576):1&b.substep_shaping&&trancate_smallspectrums(b,i,r,o),M.over_count},this.iteration_finish_one=function(e,t,n){var i=e.l3_side,r=i.tt[t][n];p.best_scalefac_store(e,t,n,i),1==e.use_best_huffman&&p.best_huffman_divide(e,r),h.ResvAdjust(e,r)},this.VBR_encode_granule=function(e,n,i,o,l,c,_){var f,h=e.internal_flags,d=new u,p=a(576),v=_,m=_+1,b=(_+c)/2,g=0,y=h.sfb21_extra;s(v<=LameInternalFlags.MAX_BITS_PER_CHANNEL),r.fill(d.l3_enc,0);do{s(b>=c),s(b<=_),s(c<=_),h.sfb21_extra=!(b>v-42)&&y,outer_loop(e,n,i,o,l,b)<=0?(g=1,m=n.part2_3_length,d.assign(n),t.arraycopy(o,0,p,0,576),f=(_=m-32)-c,b=(_+c)/2):(f=_-(c=b+32),b=(_+c)/2,0!=g&&(g=2,n.assign(d),t.arraycopy(p,0,o,0,576)))}while(f>12);h.sfb21_extra=y,2==g&&t.arraycopy(d.l3_enc,0,n.l3_enc,0,576),s(n.part2_3_length<=v)},this.get_framebits=function(t,n){var i=t.internal_flags;i.bitrate_index=i.VBR_min_bitrate;var r=e.getframebits(t);i.bitrate_index=1,r=e.getframebits(t);for(var a=1;a<=i.VBR_max_bitrate;a++){i.bitrate_index=a;var s=new MeanBits(r);n[a]=h.ResvFrameBegin(t,s),r=s.bits}},this.VBR_old_prepare=function(e,t,n,i,r,a,s,o,l){var c,u=e.internal_flags,f=0,p=1,v=0;u.bitrate_index=u.VBR_max_bitrate;var m=h.ResvFrameBegin(e,new MeanBits(0))/u.mode_gr;get_framebits(e,a);for(var b=0;b<u.mode_gr;b++){var g=d.on_pe(e,t,o[b],m,b,0);u.mode_ext==_.MPG_MD_MS_LR&&(ms_convert(u.l3_side,b),d.reduce_side(o[b],n[b],m,g));for(var y=0;y<u.channels_out;++y){var w=u.l3_side.tt[b][y];w.block_type!=_.SHORT_TYPE?(f=1.28/(1+Math.exp(3.5-t[b][y]/300))-.05,c=u.PSY.mask_adjust-f):(f=2.56/(1+Math.exp(3.5-t[b][y]/300))-.14,c=u.PSY.mask_adjust_short-f),u.masking_lower=Math.pow(10,.1*c),init_outer_loop(u,w),l[b][y]=d.calc_xmin(e,i[b][y],w,r[b][y]),0!=l[b][y]&&(p=0),s[b][y]=126,v+=o[b][y]}}for(b=0;b<u.mode_gr;b++)for(y=0;y<u.channels_out;y++)v>a[u.VBR_max_bitrate]&&(o[b][y]*=a[u.VBR_max_bitrate],o[b][y]/=v),s[b][y]>o[b][y]&&(s[b][y]=o[b][y]);return p},this.bitpressure_strategy=function(e,t,n,i){for(var r=0;r<e.mode_gr;r++)for(var a=0;a<e.channels_out;a++){for(var s=e.l3_side.tt[r][a],o=t[r][a],l=0,c=0;c<s.psy_lmax;c++)o[l++]*=1+.029*c*c/_.SBMAX_l/_.SBMAX_l;if(s.block_type==_.SHORT_TYPE)for(c=s.sfb_smin;c<_.SBMAX_s;c++)o[l++]*=1+.029*c*c/_.SBMAX_s/_.SBMAX_s,o[l++]*=1+.029*c*c/_.SBMAX_s/_.SBMAX_s,o[l++]*=1+.029*c*c/_.SBMAX_s/_.SBMAX_s;i[r][a]=0|Math.max(n[r][a],.9*i[r][a])}},this.VBR_new_prepare=function(e,t,n,i,r,a){var s,o=e.internal_flags,l=1,c=0,u=0;if(e.free_format){o.bitrate_index=0;f=new MeanBits(c);s=h.ResvFrameBegin(e,f),c=f.bits,r[0]=s}else{o.bitrate_index=o.VBR_max_bitrate;var f=new MeanBits(c);h.ResvFrameBegin(e,f),c=f.bits,get_framebits(e,r),s=r[o.VBR_max_bitrate]}for(var p=0;p<o.mode_gr;p++){d.on_pe(e,t,a[p],c,p,0),o.mode_ext==_.MPG_MD_MS_LR&&ms_convert(o.l3_side,p);for(var v=0;v<o.channels_out;++v){var m=o.l3_side.tt[p][v];o.masking_lower=Math.pow(10,.1*o.PSY.mask_adjust),init_outer_loop(o,m),0!=d.calc_xmin(e,n[p][v],m,i[p][v])&&(l=0),u+=a[p][v]}}for(p=0;p<o.mode_gr;p++)for(v=0;v<o.channels_out;v++)u>s&&(a[p][v]*=s,a[p][v]/=u);return l},this.calc_target_bits=function(t,n,i,r,a,s){var o,l,c,u,f=t.internal_flags,p=f.l3_side,v=0;f.bitrate_index=f.VBR_max_bitrate;var m=new MeanBits(v);for(s[0]=h.ResvFrameBegin(t,m),v=m.bits,f.bitrate_index=1,v=e.getframebits(t)-8*f.sideinfo_len,a[0]=v/(f.mode_gr*f.channels_out),v=t.VBR_mean_bitrate_kbps*t.framesize*1e3,1&f.substep_shaping&&(v*=1.09),v/=t.out_samplerate,v-=8*f.sideinfo_len,v/=f.mode_gr*f.channels_out,(o=.93+.07*(11-t.compression_ratio)/5.5)<.9&&(o=.9),o>1&&(o=1),l=0;l<f.mode_gr;l++){var b=0;for(c=0;c<f.channels_out;c++){if(r[l][c]=int(o*v),n[l][c]>700){var g=int((n[l][c]-700)/1.4),y=p.tt[l][c];r[l][c]=int(o*v),y.block_type==_.SHORT_TYPE&&g<v/2&&(g=v/2),g>3*v/2?g=3*v/2:g<0&&(g=0),r[l][c]+=g}r[l][c]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(r[l][c]=LameInternalFlags.MAX_BITS_PER_CHANNEL),b+=r[l][c]}if(b>LameInternalFlags.MAX_BITS_PER_GRANULE)for(c=0;c<f.channels_out;++c)r[l][c]*=LameInternalFlags.MAX_BITS_PER_GRANULE,r[l][c]/=b}if(f.mode_ext==_.MPG_MD_MS_LR)for(l=0;l<f.mode_gr;l++)d.reduce_side(r[l],i[l],v*f.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(u=0,l=0;l<f.mode_gr;l++)for(c=0;c<f.channels_out;c++)r[l][c]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(r[l][c]=LameInternalFlags.MAX_BITS_PER_CHANNEL),u+=r[l][c];if(u>s[0])for(l=0;l<f.mode_gr;l++)for(c=0;c<f.channels_out;c++)r[l][c]*=s[0],r[l][c]/=u}},vi}function Ui(){if(Ai)return Si;Ai=1;var e=Ei(),t=e.System,n=e.VbrMode;e.Float;var i=e.ShortBlock;e.Util;var r=e.Arrays;e.new_array_n;var a=e.new_byte;e.new_double,e.new_float,e.new_float_n,e.new_int,e.new_int_n;var s=e.assert;function o(){var e,l,c;this.setModules=function(t,n,i){e=t,l=n,c=i};var _=o.NUMTOCENTRIES,u=o.MAXFRAMESIZE,f=_+4+4+4+4+4+9+1+1+8+1+1+3+1+1+2+4+2+2,h="Xing",d="Info",p=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function v(e,t){var n=255&e[t+0];return n<<=8,n|=255&e[t+1],n<<=8,n|=255&e[t+2],n<<=8,n|=255&e[t+3]}function m(e,t,n){e[t+0]=255&n>>24,e[t+1]=255&n>>16,e[t+2]=255&n>>8,e[t+3]=255&n}function b(e,t,n){e[t+0]=255&n>>8,e[t+1]=255&n}function g(e,t,n){return 255&(e<<t|n&~(-1<<t))}function y(t,i){var r=t.internal_flags;i[0]=g(i[0],8,255),i[1]=g(i[1],3,7),i[1]=g(i[1],1,t.out_samplerate<16e3?0:1),i[1]=g(i[1],1,t.version),i[1]=g(i[1],2,1),i[1]=g(i[1],1,t.error_protection?0:1),i[2]=g(i[2],4,r.bitrate_index),i[2]=g(i[2],2,r.samplerate_index),i[2]=g(i[2],1,0),i[2]=g(i[2],1,t.extension),i[3]=g(i[3],2,t.mode.ordinal()),i[3]=g(i[3],2,r.mode_ext),i[3]=g(i[3],1,t.copyright),i[3]=g(i[3],1,t.original),i[3]=g(i[3],2,t.emphasis),i[0]=255;var a,s,o=241&i[1];a=1==t.version?128:t.out_samplerate<16e3?32:64,t.VBR==n.vbr_off&&(a=t.brate),s=t.free_format?0:255&16*e.BitrateIndex(a,t.version,t.out_samplerate),1==t.version?(i[1]=255&o|10,o=13&i[2],i[2]=255&(s|o)):(i[1]=255&o|2,o=13&i[2],i[2]=255&(s|o))}function w(e,t){return t=t>>8^p[255&(t^e)]}this.addVbrFrame=function(e){var t=e.internal_flags,n=Tables.bitrate_table[e.version][t.bitrate_index];s(null!=t.VBR_seek_table.bag),function(e,t){if(e.nVbrNumFrames++,e.sum+=t,e.seen++,!(e.seen<e.want)&&(e.pos<e.size&&(e.bag[e.pos]=e.sum,e.pos++,e.seen=0),e.pos==e.size)){for(var n=1;n<e.size;n+=2)e.bag[n/2]=e.bag[n];e.want*=2,e.pos/=2}}(t.VBR_seek_table,n)},this.getVbrTag=function(e){var t=new VBRTagData,n=0;t.flags=0;var i=e[n+1]>>3&1,r=e[n+2]>>2&3,a=e[n+3]>>6&3,s=e[n+2]>>4&15;if(s=Tables.bitrate_table[i][s],e[n+1]>>4==14?t.samprate=Tables.samplerate_table[2][r]:t.samprate=Tables.samplerate_table[i][r],!function(e,t){return new String(e,t,4(),null).equals(h)||new String(e,t,4(),null).equals(d)}(e,n+=0!=i?3!=a?36:21:3!=a?21:13))return null;n+=4,t.hId=i;var o=t.flags=v(e,n);if(n+=4,1&o&&(t.frames=v(e,n),n+=4),2&o&&(t.bytes=v(e,n),n+=4),4&o){if(null!=t.toc)for(var l=0;l<_;l++)t.toc[l]=e[n+l];n+=_}t.vbrScale=-1,8&o&&(t.vbrScale=v(e,n),n+=4),t.headersize=72e3*(i+1)*s/t.samprate;var c=e[(n+=21)+0]<<4;c+=e[n+1]>>4;var u=(15&e[n+1])<<8;return(c<0||c>3e3)&&(c=-1),((u+=255&e[n+2])<0||u>3e3)&&(u=-1),t.encDelay=c,t.encPadding=u,t},this.InitVbrTag=function(e){var t,i=e.internal_flags;t=1==e.version?128:e.out_samplerate<16e3?32:64,e.VBR==n.vbr_off&&(t=e.brate);var r=72e3*(e.version+1)*t/e.out_samplerate,s=i.sideinfo_len+f;if(i.VBR_seek_table.TotalFrameSize=r,r<s||r>u)e.bWriteVbrTag=!1;else{i.VBR_seek_table.nVbrNumFrames=0,i.VBR_seek_table.nBytesWritten=0,i.VBR_seek_table.sum=0,i.VBR_seek_table.seen=0,i.VBR_seek_table.want=1,i.VBR_seek_table.pos=0,null==i.VBR_seek_table.bag&&(i.VBR_seek_table.bag=new int[400],i.VBR_seek_table.size=400);var o=a(u);y(e,o);for(var c=i.VBR_seek_table.TotalFrameSize,_=0;_<c;++_)l.add_dummy_byte(e,255&o[_],1)}},this.updateMusicCRC=function(e,t,n,i){for(var r=0;r<i;++r)e[0]=w(t[n+r],e[0])},this.getLameTagFrame=function(e,s){var o=e.internal_flags;if(!e.bWriteVbrTag)return 0;if(o.Class_ID!=Lame.LAME_ID)return 0;if(o.VBR_seek_table.pos<=0)return 0;if(s.length<o.VBR_seek_table.TotalFrameSize)return o.VBR_seek_table.TotalFrameSize;r.fill(s,0,o.VBR_seek_table.TotalFrameSize,0),y(e,s);var u=a(_);if(e.free_format)for(var f=1;f<_;++f)u[f]=255&255*f/100;else!function(e,t){if(!(e.pos<=0))for(var n=1;n<_;++n){var i=n/_,r=0|Math.floor(i*e.pos);r>e.pos-1&&(r=e.pos-1);var a=0|256*e.bag[r]/e.sum;a>255&&(a=255),t[n]=255&a}}(o.VBR_seek_table,u);var p=o.sideinfo_len;e.error_protection&&(p-=2),e.VBR==n.vbr_off?(s[p++]=255&d.charAt(0),s[p++]=255&d.charAt(1),s[p++]=255&d.charAt(2),s[p++]=255&d.charAt(3)):(s[p++]=255&h.charAt(0),s[p++]=255&h.charAt(1),s[p++]=255&h.charAt(2),s[p++]=255&h.charAt(3)),m(s,p,15),m(s,p+=4,o.VBR_seek_table.nVbrNumFrames),p+=4;var v=o.VBR_seek_table.nBytesWritten+o.VBR_seek_table.TotalFrameSize;m(s,p,0|v),p+=4,t.arraycopy(u,0,s,p,u.length),p+=u.length,e.error_protection&&l.CRC_writeheader(o,s);var g=0;for(f=0;f<p;f++)g=w(s[f],g);return p+=function(e,t,n,r,a){var s,o,l,_,u,f=e.internal_flags,h=0,d=e.encoder_delay,p=e.encoder_padding,v=100-10*e.VBR_q-e.quality,g=c.getLameVeryShortVersion(),y=[1,5,3,2,4,0,3],S=0|(e.lowpassfreq/100+.5>255?255:e.lowpassfreq/100+.5),A=0,M=0,B=e.internal_flags.noise_shaping,R=0,E=0,k=0,T=!!(1&e.exp_nspsytune),I=!!(2&e.exp_nspsytune),x=!1,P=!1,O=e.internal_flags.nogap_total,C=e.internal_flags.nogap_current,N=e.ATHtype;switch(e.VBR){case vbr_abr:u=e.VBR_mean_bitrate_kbps;break;case vbr_off:u=e.brate;break;default:u=e.VBR_min_bitrate_kbps}switch(s=0+(e.VBR.ordinal()<y.length?y[e.VBR.ordinal()]:0),f.findReplayGain&&(f.RadioGain>510&&(f.RadioGain=510),f.RadioGain<-510&&(f.RadioGain=-510),M=8192,M|=3072,f.RadioGain>=0?M|=f.RadioGain:(M|=512,M|=-f.RadioGain)),f.findPeakSample&&(A=Math.abs(0|f.PeakSample/32767*Math.pow(2,23)+.5)),-1!=O&&(C>0&&(P=!0),C<O-1&&(x=!0)),_=N+((T?1:0)<<4)+((I?1:0)<<5)+((x?1:0)<<6)+((P?1:0)<<7),v<0&&(v=0),e.mode){case MONO:R=0;break;case STEREO:R=1;break;case DUAL_CHANNEL:R=2;break;case JOINT_STEREO:R=e.force_ms?4:3;break;case NOT_SET:default:R=7}k=e.in_samplerate<=32e3?0:48e3==e.in_samplerate?2:e.in_samplerate>48e3?3:1,(e.short_blocks==i.short_block_forced||e.short_blocks==i.short_block_dispensed||-1==e.lowpassfreq&&-1==e.highpassfreq||e.scale_left<e.scale_right||e.scale_left>e.scale_right||e.disable_reservoir&&e.brate<320||e.noATH||e.ATHonly||0==N||e.in_samplerate<=32e3)&&(E=1),o=B+(R<<2)+(E<<5)+(k<<6),l=f.nMusicCRC,m(n,r+h,v),h+=4;for(var L=0;L<9;L++)n[r+h+L]=255&g.charAt(L);n[r+(h+=9)]=255&s,n[r+ ++h]=255&S,m(n,r+ ++h,A),b(n,r+(h+=4),M),b(n,r+(h+=2),0),n[r+(h+=2)]=255&_,n[r+ ++h]=u>=255?255:255&u,n[r+ ++h]=255&d>>4,n[r+h+1]=255&(d<<4)+(p>>8),n[r+h+2]=255&p,n[r+(h+=3)]=255&o,h++,n[r+h++]=0,b(n,r+h,e.preset),m(n,r+(h+=2),t),b(n,r+(h+=4),l),h+=2;for(var V=0;V<h;V++)a=w(n[r+V],a);return b(n,r+h,a),h+2}(e,v,s,p,g),o.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(e,t){if(e.internal_flags.VBR_seek_table.pos<=0)return-1;if(t.seek(t.length()),0==t.length())return-1;var n=function(e){e.seek(0);var t=a(10);return e.readFully(t),new String(t,"ISO-8859-1").startsWith("ID3")?0:((127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9])+t.length}(t);t.seek(n);var i=a(u),r=getLameTagFrame(e,i);return r>i.length?-1:(r<1||t.write(i,0,r),0)}}return o.NUMTOCENTRIES=100,o.MAXFRAMESIZE=2880,Si=o}var Gi=function(){if(Mi)return Ri;Mi=1;var e=Ei();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n;var t=e.new_byte;e.new_double,e.new_float,e.new_float_n,e.new_int,e.new_int_n;var n=e.assert,i=Xi(),r=qi(),a=Li(),s=Hi(),o=Yi(),l=Fi(),c=function(){if(gi)return bi;gi=1;var e=Ei().assert;return bi=function(){var t;this.setModules=function(e){t=e},this.ResvFrameBegin=function(n,i){var r,a=n.internal_flags,s=a.l3_side,o=t.getframebits(n);i.bits=(o-8*a.sideinfo_len)/a.mode_gr;var l=2048*a.mode_gr-8;n.brate>320?r=8*int(1e3*n.brate/(n.out_samplerate/1152)/8+.5):(r=11520,n.strict_ISO&&(r=8*int(32e4/(n.out_samplerate/1152)/8+.5))),a.ResvMax=r-o,a.ResvMax>l&&(a.ResvMax=l),(a.ResvMax<0||n.disable_reservoir)&&(a.ResvMax=0);var c=i.bits*a.mode_gr+Math.min(a.ResvSize,a.ResvMax);return c>r&&(c=r),e(0==a.ResvMax%8),e(a.ResvMax>=0),s.resvDrain_pre=0,null!=a.pinfo&&(a.pinfo.mean_bits=i.bits/2,a.pinfo.resvsize=a.ResvSize),c},this.ResvMaxBits=function(e,t,n,i){var r,a=e.internal_flags,s=a.ResvSize,o=a.ResvMax;0!=i&&(s+=t),1&a.substep_shaping&&(o*=.9),n.bits=t,10*s>9*o?(r=s-9*o/10,n.bits+=r,a.substep_shaping|=128):(r=0,a.substep_shaping&=127,e.disable_reservoir||1&a.substep_shaping||(n.bits-=.1*t));var l=s<6*a.ResvMax/10?s:6*a.ResvMax/10;return(l-=r)<0&&(l=0),l},this.ResvAdjust=function(e,t){e.ResvSize-=t.part2_3_length+t.part2_length},this.ResvFrameEnd=function(t,n){var i,r=t.l3_side;t.ResvSize+=n*t.mode_gr;var a=0;r.resvDrain_post=0,r.resvDrain_pre=0,0!=(i=t.ResvSize%8)&&(a+=i),(i=t.ResvSize-a-t.ResvMax)>0&&(e(0==i%8),e(i>=0),a+=i);var s=Math.min(8*r.main_data_begin,a)/8;r.resvDrain_pre+=8*s,a-=8*s,t.ResvSize-=8*s,r.main_data_begin-=s,r.resvDrain_post+=a,t.ResvSize-=a}}}(),_=xi(),u=ji();Ti();var f=wi?yi:(wi=1,yi=function(){this.getLameVersion=function(){return"3.98.4"},this.getLameShortVersion=function(){return"3.98.4"},this.getLameVeryShortVersion=function(){return"LAME3.98r"},this.getPsyVersion=function(){return"0.93"},this.getLameUrl=function(){return"http://www.mp3dev.org/"},this.getLameOsBitness=function(){return"32bits"}}),h=Ui();function d(){this.setModules=function(e,t){}}function p(){this.setModules=function(e,t,n){}}function v(){}function m(){this.setModules=function(e,t){}}function b(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function g(e){return e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3)}return b.RIFF=g("RIFF"),b.WAVE=g("WAVE"),b.fmt_=g("fmt "),b.data=g("data"),b.readHeader=function(e){var t=new b,n=e.getUint32(0,!1);if(b.RIFF==n&&(e.getUint32(4,!0),b.WAVE==e.getUint32(8,!1)&&b.fmt_==e.getUint32(12,!1))){var i=e.getUint32(16,!0),r=20;switch(i){case 16:case 18:t.channels=e.getUint16(r+2,!0),t.sampleRate=e.getUint32(r+4,!0);break;default:throw"extended fmt chunk not implemented"}r+=i;for(var a=b.data,s=0;a!=n&&(n=e.getUint32(r,!1),s=e.getUint32(r+4,!0),a!=n);)r+=s+8;return t.dataLen=s,t.dataOffset=r+8,t}},Ri.Mp3Encoder=function(e,b,g){3!=arguments.length&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),e=1,b=44100,g=128);var y=new i,w=new d,S=new a,A=new u,M=new r,B=new s,R=new o,E=new h,k=new f,T=new m,I=new c,x=new l,P=new p,O=new v;y.setModules(S,A,M,B,R,E,k,T,O),A.setModules(S,O,k,E),T.setModules(A,k),M.setModules(y),R.setModules(A,I,B,x),B.setModules(x,I,y.enc.psy),I.setModules(A),x.setModules(B),E.setModules(y,A,k),w.setModules(P,O),P.setModules(k,T,M);var C=y.lame_init();C.num_channels=e,C.in_samplerate=b,C.brate=g,C.mode=_.STEREO,C.quality=3,C.bWriteVbrTag=!1,C.disable_reservoir=!0,C.write_id3tag_automatic=!1;var N=y.lame_init_params(C);n(0==N);var L=1152,V=0|1.25*L+7200,D=t(V);this.encodeBuffer=function(i,r){1==e&&(r=i),n(i.length==r.length),i.length>L&&(L=i.length,D=t(V=0|1.25*L+7200));var a=y.lame_encode_buffer(C,i,r,i.length,D,0,V);return new Int8Array(D.subarray(0,a))},this.flush=function(){var e=y.lame_encode_flush(C,D,0,V);return new Int8Array(D.subarray(0,e))}},Ri.WavHeader=b,Ri}(),Ki=s(Gi),zi=s(xi()),Zi=s(Xi()),Wi=s(ji());let $i=class extends ln{getMetadata(){return Promise.resolve({format:"mp3",implementationType:"custom",supported:!0})}init(){const e="undefined"!=typeof self?self:window;e.MPEGMode=zi,e.Lame=Zi,e.BitStream=Wi}encodeAudio(e,t){return n(this,void 0,void 0,function*(){return(yield this.isWebAudioEncoderAPISupportedForSettings(t))?this.encodeWithWebAudioEncoderAPI(e,t):this.encodeMP3LameJS(e,t)})}encodeMP3LameJS(e,t){const n=new Ki.Mp3Encoder(Math.max(2,t.numChannels),t.sampleRate,t.bitrate),r=[],a=i.convertFloat32Array2Int16(e[0]),s=i.convertFloat32Array2Int16(e[1]),o=1152;for(let e=0;e<a.length;e+=o){const t=a.subarray(e,e+o),i=s.subarray(e,e+o),l=n.encodeBuffer(t,i);l.length>0&&r.push(l)}const l=n.flush();return l.length>0&&r.push(l),i.mergeBuffers(r).buffer}};e([(e,t,n)=>{try{p(e.constructor,P,O,(i=t,e=>{if(e.lifecycle.postConstructMethodNames.has(i))throw new L(V.injectionDecoratorConflict,`Unexpected duplicated postConstruct method ${i.toString()}`);return e.lifecycle.postConstructMethodNames.add(i),e}))}catch(n){J(e,t,void 0,n)}var i},t("design:type",Function),t("design:paramtypes",[]),t("design:returntype",void 0)],$i.prototype,"init",null),$i=e([ie()],$i);var Qi=$i;const Ji="audio/wav",er="audio/mp3";let tr,nr,ir,rr=0,ar=[];const sr=function(){const e=new nn({defaultScope:"Singleton"});return e.bind(r.AudioEncoderManager).to(on),e.bind(r.AudioEncoders).to(Bi),e.bind(r.AudioEncoders).to(Qi),e}().get(r.AudioEncoderManager),or=()=>{for(let e=0;e<nr;e++)ar[e]=[]},lr=()=>{const e=[];for(let t=0;t<nr;t++)e.push(i.mergeBuffers(ar[t]));return e},cr=(e,t,i)=>n(void 0,void 0,void 0,function*(){const n=yield sr.encodeAudio(lr(),{audioLength:rr,bitrate:ir,format:e,numChannels:nr,sampleRate:tr}),r=new Blob([n],{type:i});self.postMessage({command:t,data:r})});self.onmessage=function(e){switch(e.data.command){case"init":t=e.data.config,tr=t.sampleRate,nr=t.numChannels,ir=t.bitrate||128,or();break;case"record":(e=>{for(let t=0;t<nr;t++)ar[t].push(e[t]);rr+=e[0].length})(e.data.buffer);break;case"exportWAV":cr("wav","exportWAV",Ji);break;case"exportMP3":cr("mp3","exportMP3",er);break;case"getBuffer":(()=>{const e=lr();self.postMessage({command:"getBuffer",data:e})})();break;case"clear":rr=0,ar=[],or()}var t};
