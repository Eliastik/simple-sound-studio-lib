function e(e,t,n,r){var a,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(i<3?a(s):i>3?a(t,n,s):a(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}function t(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function n(e,t,n,r){return new(n||(n=Promise))((function(a,i){function s(e){try{l(r.next(e))}catch(e){i(e)}}function o(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((r=r.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const r={calcAudioDuration:(e,t)=>{if(e){let n=e.duration+1;return null!=t&&(n/=t),n}return 0},loadAudioBuffer:(e,t)=>n(void 0,void 0,void 0,(function*(){const n=yield r.readAsArrayBufferPromisified(t),a=yield e.decodeAudioData(n);return r.decodeBuffer(e,a)})),readAsArrayBufferPromisified:e=>new Promise(((t,n)=>{const r=new FileReader;r.onload=e=>{var r;const a=null===(r=null==e?void 0:e.target)||void 0===r?void 0:r.result;a instanceof ArrayBuffer?t(a):n()},e&&r.readAsArrayBuffer(e)})),decodeBuffer:(e,t)=>{if(1==t.numberOfChannels){e.resume();const{duration:n}=t,{sampleRate:r}=e,a=e.createBuffer(2,r*n+2*r,r),i=t.getChannelData(0),s=a.getChannelData(0),o=a.getChannelData(1);for(let e=0;e<i.length;e++)s[e]=i[e],o[e]=i[e];return a}return t},convertAudioBufferToFloat32Array:e=>{const t=[];for(let n=0;n<e.numberOfChannels;n++)t.push(e.getChannelData(n));return t},convertAudioParamToFloat32Array:(e,t)=>{const n=new Float32Array(t);for(let r=0;r<t;r++)n.set([e.value],r);return n},sumAudioBufferChannel:(e,t)=>e.getChannelData(t).reduce(((e,t)=>e+t),0),sumAudioBuffer(e){let t=0;for(let n=0;n<e.numberOfChannels;n++)t+=this.sumAudioBufferChannel(e,n);return t},isAudioWorkletCompatible:e=>void 0!==e&&void 0!==e.audioWorklet,isSettingValueValid:e=>!(void 0===e||isNaN(Number(e))||"string"==typeof e&&""===e.trim()),calculateAudioDuration(e,t,n){if(e&&t){const r=this.calcAudioDuration(e,n),a=t.getAddingTime();return a?r+a:r}return 0},forceDownload(e,t){const n=window.document.createElement("a"),r=URL.createObjectURL(e);window.document.body.appendChild(n),n.href=r,n.download=t||"output.wav",n.click(),URL.revokeObjectURL(r),window.document.body.removeChild(n)},clearAudioBuffer(e){if(e)for(let t=0;t<e.numberOfChannels;t++){const n=e.getChannelData(t);for(let e=0;e<n.length;e++)n[e]=0}},floatTo16BitPCM(e,t,n){for(let r=0;r<n.length;r++,t+=2){const a=this.clampFloatValue(n[r]);e.setInt16(t,a<0?32768*a:32767*a,!0)}},convertFloat32Array2Int16(e){const t=new Int16Array(e.length);for(let n=0,r=e.length;n<r;n++){const r=this.clampFloatValue(e[n]);t[n]=Math.round(32767*r)}return t},clampFloatValue:e=>Math.max(-1,Math.min(1,e)),writeStringToDataView(e,t,n){for(let r=0;r<n.length;r++)e.setUint8(t+r,n.charCodeAt(r))},interleaveBuffers(e,t){const n=e.length+t.length;if(0===n)throw new Error("interleaveBuffers: input buffers are empty or invalid");const r=new(0,e.constructor)(n);let a=0,i=0;for(;a<n;)r[a++]=e[i],r[a++]=t[i],i++;return r},getLengthFromBuffers:e=>e?e.reduce(((e,t)=>e+t.length),0):0,mergeBuffers(e){const t=this.getLengthFromBuffers(e);if(0===t)throw new Error("mergeTypedArrayBuffers: input buffers are empty or invalid");const n=new(0,e[0].constructor)(t);let r=0;for(const t of e)t?(n.set(t,r),r+=t.length):console.warn("mergeTypedArrayBuffers: undefined buffer has been detected");return n}},a={BaseAudioEncoder:Symbol.for("BaseAudioEncoder"),AudioEncoders:Symbol.for("AudioEncoders")};var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function s(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var o,l={};
/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0
THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.
See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function _(e){return("object"==typeof e&&null!==e||"function"==typeof e)&&"function"==typeof e.then}function c(e){switch(typeof e){case"string":case"symbol":return e.toString();case"function":return e.name;default:throw new Error(`Unexpected ${typeof e} service id type`)}}!function(){return o||(o=1,function(e){!function(){var t="object"==typeof globalThis?globalThis:"object"==typeof i?i:"object"==typeof self?self:"object"==typeof this?this:function(){try{return Function("return this;")()}catch(e){}}()||function(){try{return(0,eval)("(function() { return this; })()")}catch(e){}}(),n=r(e);function r(e,t){return function(n,r){Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0!==t.Reflect&&(n=r(t.Reflect,n)),function(e,t){var n=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,a=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",s="function"==typeof Object.create,o={__proto__:[]}instanceof Array,l=!s&&!o,_={create:s?function(){return fe(Object.create(null))}:o?function(){return fe({__proto__:null})}:function(){return fe({})},has:l?function(e,t){return n.call(e,t)}:function(e,t){return t in e},get:l?function(e,t){return n.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},c=Object.getPrototypeOf(Function),f="function"==typeof Map&&"function"==typeof Map.prototype.entries?Map:le(),u="function"==typeof Set&&"function"==typeof Set.prototype.entries?Set:_e(),h="function"==typeof WeakMap?WeakMap:ce(),d=r?Symbol.for("@reflect-metadata:registry"):void 0,p=ae(),m=ie(p);function b(e,t,n,r){if(H(n)){if(!U(e))throw new TypeError;if(!z(t))throw new TypeError;return E(e,t)}if(!U(e))throw new TypeError;if(!F(t))throw new TypeError;if(!F(r)&&!H(r)&&!D(r))throw new TypeError;return D(r)&&(r=void 0),k(e,t,n=G(n),r)}function v(e,t){function n(n,r){if(!F(n))throw new TypeError;if(!H(r)&&!Z(r))throw new TypeError;O(e,t,n,r)}return n}function g(e,t,n,r){if(!F(n))throw new TypeError;return H(r)||(r=G(r)),O(e,t,n,r)}function w(e,t,n){if(!F(t))throw new TypeError;return H(n)||(n=G(n)),T(e,t,n)}function y(e,t,n){if(!F(t))throw new TypeError;return H(n)||(n=G(n)),x(e,t,n)}function S(e,t,n){if(!F(t))throw new TypeError;return H(n)||(n=G(n)),I(e,t,n)}function A(e,t,n){if(!F(t))throw new TypeError;return H(n)||(n=G(n)),P(e,t,n)}function M(e,t){if(!F(e))throw new TypeError;return H(t)||(t=G(t)),V(e,t)}function B(e,t){if(!F(e))throw new TypeError;return H(t)||(t=G(t)),L(e,t)}function R(e,t,n){if(!F(t))throw new TypeError;if(H(n)||(n=G(n)),!F(t))throw new TypeError;H(n)||(n=G(n));var r=oe(t,n,!1);return!H(r)&&r.OrdinaryDeleteMetadata(e,t,n)}function E(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!H(r)&&!D(r)){if(!z(r))throw new TypeError;t=r}}return t}function k(e,t,n,r){for(var a=e.length-1;a>=0;--a){var i=(0,e[a])(t,n,r);if(!H(i)&&!D(i)){if(!F(i))throw new TypeError;r=i}}return r}function T(e,t,n){if(x(e,t,n))return!0;var r=ne(t);return!D(r)&&T(e,r,n)}function x(e,t,n){var r=oe(t,n,!1);return!H(r)&&q(r.OrdinaryHasOwnMetadata(e,t,n))}function I(e,t,n){if(x(e,t,n))return P(e,t,n);var r=ne(t);return D(r)?void 0:I(e,r,n)}function P(e,t,n){var r=oe(t,n,!1);if(!H(r))return r.OrdinaryGetOwnMetadata(e,t,n)}function O(e,t,n,r){oe(n,r,!0).OrdinaryDefineOwnMetadata(e,t,n,r)}function V(e,t){var n=L(e,t),r=ne(e);if(null===r)return n;var a=V(r,t);if(a.length<=0)return n;if(n.length<=0)return a;for(var i=new u,s=[],o=0,l=n;o<l.length;o++){var _=l[o];i.has(_)||(i.add(_),s.push(_))}for(var c=0,f=a;c<f.length;c++){_=f[c];i.has(_)||(i.add(_),s.push(_))}return s}function L(e,t){var n=oe(e,t,!1);return n?n.OrdinaryOwnMetadataKeys(e,t):[]}function N(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function H(e){return void 0===e}function D(e){return null===e}function C(e){return"symbol"==typeof e}function F(e){return"object"==typeof e?null!==e:"function"==typeof e}function j(e,t){switch(N(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n="string",r=Q(e,a);if(void 0!==r){var i=r.call(e,n);if(F(i))throw new TypeError;return i}return X(e)}function X(e,t){var n,r,a=e.toString;if(K(a)&&!F(r=a.call(e)))return r;if(K(n=e.valueOf)&&!F(r=n.call(e)))return r;throw new TypeError}function q(e){return!!e}function Y(e){return""+e}function G(e){var t=j(e);return C(t)?t:Y(t)}function U(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function K(e){return"function"==typeof e}function z(e){return"function"==typeof e}function Z(e){switch(N(e)){case 3:case 4:return!0;default:return!1}}function W(e,t){return e===t||e!=e&&t!=t}function Q(e,t){var n=e[t];if(null!=n){if(!K(n))throw new TypeError;return n}}function $(e){var t=Q(e,i);if(!K(t))throw new TypeError;var n=t.call(e);if(!F(n))throw new TypeError;return n}function J(e){return e.value}function ee(e){var t=e.next();return!t.done&&t}function te(e){var t=e.return;t&&t.call(e)}function ne(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===c)return t;if(t!==c)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var a=r.constructor;return"function"!=typeof a||a===e?t:a}function re(){var e,n,r,a;H(d)||void 0===t.Reflect||d in t.Reflect||"function"!=typeof t.Reflect.defineMetadata||(e=se(t.Reflect));var i=new h,s={registerProvider:o,getProvider:_,setProvider:p};return s;function o(t){if(!Object.isExtensible(s))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===t:break;case H(n):n=t;break;case n===t:break;case H(r):r=t;break;case r===t:break;default:void 0===a&&(a=new u),a.add(t)}}function l(t,i){if(!H(n)){if(n.isProviderFor(t,i))return n;if(!H(r)){if(r.isProviderFor(t,i))return n;if(!H(a))for(var s=$(a);;){var o=ee(s);if(!o)return;var l=J(o);if(l.isProviderFor(t,i))return te(s),l}}}if(!H(e)&&e.isProviderFor(t,i))return e}function _(e,t){var n,r=i.get(e);return H(r)||(n=r.get(t)),H(n)?(H(n=l(e,t))||(H(r)&&(r=new f,i.set(e,r)),r.set(t,n)),n):n}function c(e){if(H(e))throw new TypeError;return n===e||r===e||!H(a)&&a.has(e)}function p(e,t,n){if(!c(n))throw new Error("Metadata provider not registered.");var r=_(e,t);if(r!==n){if(!H(r))return!1;var a=i.get(e);H(a)&&(a=new f,i.set(e,a)),a.set(t,n)}return!0}}function ae(){var e;return!H(d)&&F(t.Reflect)&&Object.isExtensible(t.Reflect)&&(e=t.Reflect[d]),H(e)&&(e=re()),!H(d)&&F(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,d,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}function ie(e){var t=new h,n={isProviderFor:function(e,n){var r=t.get(e);return!H(r)&&r.has(n)},OrdinaryDefineOwnMetadata:s,OrdinaryHasOwnMetadata:a,OrdinaryGetOwnMetadata:i,OrdinaryOwnMetadataKeys:o,OrdinaryDeleteMetadata:l};return p.registerProvider(n),n;function r(r,a,i){var s=t.get(r),o=!1;if(H(s)){if(!i)return;s=new f,t.set(r,s),o=!0}var l=s.get(a);if(H(l)){if(!i)return;if(l=new f,s.set(a,l),!e.setProvider(r,a,n))throw s.delete(a),o&&t.delete(r),new Error("Wrong provider for target.")}return l}function a(e,t,n){var a=r(t,n,!1);return!H(a)&&q(a.has(e))}function i(e,t,n){var a=r(t,n,!1);if(!H(a))return a.get(e)}function s(e,t,n,a){r(n,a,!0).set(e,t)}function o(e,t){var n=[],a=r(e,t,!1);if(H(a))return n;for(var i=$(a.keys()),s=0;;){var o=ee(i);if(!o)return n.length=s,n;var l=J(o);try{n[s]=l}catch(e){try{te(i)}finally{throw e}}s++}}function l(e,n,a){var i=r(n,a,!1);if(H(i))return!1;if(!i.delete(e))return!1;if(0===i.size){var s=t.get(n);H(s)||(s.delete(a),0===s.size&&t.delete(s))}return!0}}function se(e){var t=e.defineMetadata,n=e.hasOwnMetadata,r=e.getOwnMetadata,a=e.getOwnMetadataKeys,i=e.deleteMetadata,s=new h,o={isProviderFor:function(e,t){var n=s.get(e);return!(H(n)||!n.has(t))||!!a(e,t).length&&(H(n)&&(n=new u,s.set(e,n)),n.add(t),!0)},OrdinaryDefineOwnMetadata:t,OrdinaryHasOwnMetadata:n,OrdinaryGetOwnMetadata:r,OrdinaryOwnMetadataKeys:a,OrdinaryDeleteMetadata:i};return o}function oe(e,t,n){var r=p.getProvider(e,t);if(!H(r))return r;if(n){if(p.setProvider(e,t,m))return m;throw new Error("Illegal state.")}}function le(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[i]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,a=n+1;a<r;a++)this._keys[a-1]=this._keys[a],this._values[a-1]=this._values[a];return this._keys.length--,this._values.length--,W(t,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,a)},t.prototype.entries=function(){return new n(this._keys,this._values,s)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[i]=function(){return this.entries()},t.prototype._find=function(e,t){if(!W(this._cacheKey,e)){this._cacheIndex=-1;for(var n=0;n<this._keys.length;n++)if(W(this._keys[n],e)){this._cacheIndex=n;break}}return this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function a(e,t){return t}function s(e,t){return[e,t]}}function _e(){return function(){function e(){this._map=new f}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.keys()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[i]=function(){return this.keys()},e}()}function ce(){var e=16,t=_.create(),r=a();return function(){function e(){this._key=a()}return e.prototype.has=function(e){var t=i(e,!1);return void 0!==t&&_.has(t,this._key)},e.prototype.get=function(e){var t=i(e,!1);return void 0!==t?_.get(t,this._key):void 0},e.prototype.set=function(e,t){return i(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=i(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=a()},e}();function a(){var e;do{e="@@WeakMap@@"+l()}while(_.has(t,e));return t[e]=!0,e}function i(e,t){if(!n.call(e,r)){if(!t)return;Object.defineProperty(e,r,{value:_.create()})}return e[r]}function s(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function o(e){if("function"==typeof Uint8Array){var t=new Uint8Array(e);return"undefined"!=typeof crypto?crypto.getRandomValues(t):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(t):s(t,e),t}return s(new Array(e),e)}function l(){var t=o(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",r=0;r<e;++r){var a=t[r];4!==r&&6!==r&&8!==r||(n+="-"),a<16&&(n+="0"),n+=a.toString(16).toLowerCase()}return n}}function fe(e){return e.__=void 0,delete e.__,e}e("decorate",b),e("metadata",v),e("defineMetadata",g),e("hasMetadata",w),e("hasOwnMetadata",y),e("getMetadata",S),e("getOwnMetadata",A),e("getMetadataKeys",M),e("getOwnMetadataKeys",B),e("deleteMetadata",R)}(n,t),void 0===t.Reflect&&(t.Reflect=e)}()}(e||(e={}))),l;var e}();const f=Symbol.for("@inversifyjs/common/islazyServiceIdentifier");class u{[f];#e;constructor(e){this.#e=e,this[f]=!0}static is(e){return"object"==typeof e&&null!==e&&!0===e[f]}unwrap(){return this.#e()}}function h(e,t){return Reflect.getOwnMetadata(t,e)}function d(e,t,n){Reflect.defineMetadata(t,n,e)}function p(e,t,n,r){const a=r(h(e,t)??n());Reflect.defineMetadata(t,a,e)}const m="@inversifyjs/container/bindingId";function b(){const e=h(Object,m)??0;return e===Number.MAX_SAFE_INTEGER?d(Object,m,Number.MIN_SAFE_INTEGER):p(Object,m,(()=>e),(e=>e+1)),e}const v="Request",g="Singleton",w="Transient",y="ConstantValue",S="DynamicValue",A="Factory",M="Instance",B="Provider",R="ResolvedValue",E="ServiceRedirection";function*k(...e){for(const t of e)yield*t}class T{#e;#t;#n;constructor(e){this.#e=new Map,this.#t={};for(const t of Reflect.ownKeys(e))this.#t[t]=new Map;this.#n=e}add(e,t){this.#r(e).push(t);for(const n of Reflect.ownKeys(t))this.#a(n,t[n]).push(e)}clone(){const e=Reflect.ownKeys(this.#n),t=new T(this.#n);this.#i(this.#e,t.#e);for(const n of e)this.#i(this.#t[n],t.#t[n]);return t}get(e,t){return this.#t[e].get(t)}getAllKeys(e){return this.#t[e].keys()}removeByRelation(e,t){const n=this.get(e,t);if(void 0===n)return;const r=new Set(n);for(const n of r){const r=this.#e.get(n);if(void 0===r)throw new Error("Expecting model relation, none found");for(const a of r)a[e]===t&&this.#s(n,a);this.#e.delete(n)}}#r(e){let t=this.#e.get(e);return void 0===t&&(t=[],this.#e.set(e,t)),t}#a(e,t){let n=this.#t[e].get(t);return void 0===n&&(n=[],this.#t[e].set(t,n)),n}#i(e,t){for(const[n,r]of e)t.set(n,[...r])}#s(e,t){for(const n of Reflect.ownKeys(t))this.#o(e,n,t[n])}#o(e,t,n){const r=this.#t[t].get(n);if(void 0!==r){const a=r.indexOf(e);-1!==a&&r.splice(a,1),0===r.length&&this.#t[t].delete(n)}}}var x,I,P;!function(e){e.moduleId="moduleId",e.serviceId="serviceId"}(x||(x={}));class O{#l;#_;constructor(e,t){this.#l=t??new T({moduleId:{isOptional:!0},serviceId:{isOptional:!1}}),this.#_=e}static build(e){return new O(e)}add(e,t){this.#l.add(e,t)}clone(){return new O(this.#_,this.#l.clone())}get(e){const t=[],n=this.#l.get(x.serviceId,e);void 0!==n&&t.push(n);const r=this.#_?.get(e);if(void 0!==r&&t.push(r),0!==t.length)return k(...t)}removeAllByModuleId(e){this.#l.removeByRelation(x.moduleId,e)}removeAllByServiceId(e){this.#l.removeByRelation(x.serviceId,e)}}!function(e){e.id="id",e.moduleId="moduleId",e.serviceId="serviceId"}(I||(I={}));class V{#c;#_;constructor(e,t){this.#c=t??new T({id:{isOptional:!1},moduleId:{isOptional:!0},serviceId:{isOptional:!1}}),this.#_=e}static build(e){return new V(e)}clone(){return new V(this.#_,this.#c.clone())}get(e){return this.getNonParentBindings(e)??this.#_?.get(e)}getById(e){return this.#c.get(I.id,e)??this.#_?.getById(e)}getByModuleId(e){return this.#c.get(I.moduleId,e)??this.#_?.getByModuleId(e)}getNonParentBindings(e){return this.#c.get(I.serviceId,e)}getNonParentBoundServices(){return this.#c.getAllKeys(I.serviceId)}removeById(e){this.#c.removeByRelation(I.id,e)}removeAllByModuleId(e){this.#c.removeByRelation(I.moduleId,e)}removeAllByServiceId(e){this.#c.removeByRelation(I.serviceId,e)}set(e){const t={[I.id]:e.id,[I.serviceId]:e.serviceIdentifier};void 0!==e.moduleId&&(t[I.moduleId]=e.moduleId),this.#c.add(e,t)}}!function(e){e.moduleId="moduleId",e.serviceId="serviceId"}(P||(P={}));class L{#f;#_;constructor(e,t){this.#f=t??new T({moduleId:{isOptional:!0},serviceId:{isOptional:!1}}),this.#_=e}static build(e){return new L(e)}add(e,t){this.#f.add(e,t)}clone(){return new L(this.#_,this.#f.clone())}get(e){const t=[],n=this.#f.get(P.serviceId,e);void 0!==n&&t.push(n);const r=this.#_?.get(e);if(void 0!==r&&t.push(r),0!==t.length)return k(...t)}removeAllByModuleId(e){this.#f.removeByRelation(P.moduleId,e)}removeAllByServiceId(e){this.#f.removeByRelation(P.serviceId,e)}}const N="@inversifyjs/core/classMetadataReflectKey";function H(){return{constructorArguments:[],lifecycle:{postConstructMethodName:void 0,preDestroyMethodName:void 0},properties:new Map,scope:void 0}}const D="@inversifyjs/core/pendingClassMetadataCountReflectKey",C=Symbol.for("@inversifyjs/core/InversifyCoreError");let F=class e extends Error{[C];kind;constructor(e,t,n){super(t,n),this[C]=!0,this.kind=e}static is(e){return"object"==typeof e&&null!==e&&!0===e[C]}static isErrorOfKind(t,n){return e.is(t)&&t.kind===n}};var j,X,q;function Y(e){const t=h(e,N)??H();if(!function(e){const t=h(e,D);return void 0!==t&&0!==t}(e))return function(e,t){const n=[];if(t.length<e.length)throw new F(j.missingInjectionDecorator,`Found unexpected missing metadata on type "${e.name}". "${e.name}" constructor requires at least ${e.length.toString()} arguments, found ${t.length.toString()} instead.\nAre you using @inject, @multiInject or @unmanaged decorators in every non optional constructor argument?\n\nIf you're using typescript and want to rely on auto injection, set "emitDecoratorMetadata" compiler option to true`);for(let e=0;e<t.length;++e)void 0===t[e]&&n.push(e);if(n.length>0)throw new F(j.missingInjectionDecorator,`Found unexpected missing metadata on type "${e.name}" at constructor indexes "${n.join('", "')}".\n\nAre you using @inject, @multiInject or @unmanaged decorators at those indexes?\n\nIf you're using typescript and want to rely on auto injection, set "emitDecoratorMetadata" compiler option to true`)}(e,t.constructorArguments),t;!function(e,t){const n=[];for(let r=0;r<t.constructorArguments.length;++r){const a=t.constructorArguments[r];void 0!==a&&a.kind!==X.unknown||n.push(`  - Missing or incomplete metadata for type "${e.name}" at constructor argument with index ${r.toString()}.\nEvery constructor parameter must be decorated either with @inject, @multiInject or @unmanaged decorator.`)}for(const[r,a]of t.properties)a.kind===X.unknown&&n.push(`  - Missing or incomplete metadata for type "${e.name}" at property "${r.toString()}".\nThis property must be decorated either with @inject or @multiInject decorator.`);if(0===n.length)throw new F(j.unknown,`Unexpected class metadata for type "${e.name}" with uncompletion traces.\nThis might be caused by one of the following reasons:\n\n1. A third party library is targeting inversify reflection metadata.\n2. A bug is causing the issue. Consider submiting an issue to fix it.`);throw new F(j.missingInjectionDecorator,`Invalid class metadata at type ${e.name}:\n\n${n.join("\n\n")}`)}(e,t)}function G(){return 0}function U(e){return t=>{void 0!==t&&t.kind===X.unknown&&p(e,D,G,(e=>e-1))}}!function(e){e[e.injectionDecoratorConflict=0]="injectionDecoratorConflict",e[e.missingInjectionDecorator=1]="missingInjectionDecorator",e[e.planning=2]="planning",e[e.resolution=3]="resolution",e[e.unknown=4]="unknown"}(j||(j={})),function(e){e[e.unknown=32]="unknown"}(X||(X={})),function(e){e[e.multipleInjection=0]="multipleInjection",e[e.singleInjection=1]="singleInjection",e[e.unmanaged=2]="unmanaged"}(q||(q={}));const K=function(e,t){return(...n)=>r=>{if(void 0===r)return e(...n);if(r.kind===q.unmanaged)throw new F(j.injectionDecoratorConflict,"Unexpected injection found. Multiple @inject, @multiInject or @unmanaged decorators found");return t(r,...n)}}((function(e,t){return{kind:e,name:void 0,optional:!1,tags:new Map,value:t}}),(function(e,t,n){return function(e){if(e.kind!==X.unknown&&!0!==e.isFromTypescriptParamType)throw new F(j.injectionDecoratorConflict,"Unexpected injection found. Multiple @inject, @multiInject or @unmanaged decorators found")}(e),{...e,kind:t,value:n}}));function z(e,t){return n=>{const r=n.properties.get(t);return n.properties.set(t,e(r)),n}}var Z;function W(e,t,n,r){if(F.isErrorOfKind(r,j.injectionDecoratorConflict)){const a=function(e,t,n){if(void 0===n){if(void 0===t)throw new F(j.unknown,"Unexpected undefined property and index values");return{kind:Z.property,property:t,targetClass:e.constructor}}return"number"==typeof n?{index:n,kind:Z.parameter,targetClass:e}:{kind:Z.method,method:t,targetClass:e}}(e,t,n);throw new F(j.injectionDecoratorConflict,`Unexpected injection error.\n\nCause:\n\n${r.message}\n\nDetails\n\n${function(e){switch(e.kind){case Z.method:return`[class: "${e.targetClass.name}", method: "${e.method.toString()}"]`;case Z.parameter:return`[class: "${e.targetClass.name}", index: "${e.index.toString()}"]`;case Z.property:return`[class: "${e.targetClass.name}", property: "${e.property.toString()}"]`}}(a)}`,{cause:r})}throw r}function Q(e,t){return n=>{const r=t(n);return t=>(r(t),e(t))}}!function(e){e[e.method=0]="method",e[e.parameter=1]="parameter",e[e.property=2]="property"}(Z||(Z={}));const $="@inversifyjs/core/classIsInjectableFlagReflectKey",J=[Array,BigInt,Boolean,Function,Number,Object,String];function ee(e){return e=>{!function(e){if(void 0!==h(e,$))throw new F(j.injectionDecoratorConflict,`Cannot apply @injectable decorator multiple times at class "${e.name}"`);d(e,$,!0)}(e),function(e){const t=h(e,"design:paramtypes");void 0!==t&&p(e,N,H,function(e){return t=>(e.forEach(((e,n)=>{var r;void 0!==t.constructorArguments[n]||(r=e,J.includes(r))||(t.constructorArguments[n]=function(e){return{isFromTypescriptParamType:!0,kind:q.singleInjection,name:void 0,optional:!1,tags:new Map,value:e}}(e))})),t)}(t))}(e)}}var te,ne;!function(e){e[e.multipleInjection=0]="multipleInjection",e[e.singleInjection=1]="singleInjection"}(te||(te={}));class re{#u;constructor(e){this.#u=e}get name(){return this.#u.elem.name}get serviceIdentifier(){return this.#u.elem.serviceIdentifier}get tags(){return this.#u.elem.tags}getAncestor(){if(void 0!==this.#u.previous)return new re(this.#u.previous)}}class ae{last;constructor(e){this.last=e}concat(e){return new ae({elem:e,previous:this.last})}[Symbol.iterator](){let e=this.last;return{next:()=>{if(void 0===e)return{done:!0,value:void 0};const t=e.elem;return e=e.previous,{done:!1,value:t}}}}}function ie(e,t,n){const r=n?.customServiceIdentifier??t.serviceIdentifier,a=[...e.getBindings(r)??[]].filter((e=>e.isSatisfiedBy(t)));if(0===a.length&&void 0!==e.autobindOptions&&"function"==typeof r){const t=function(e,t){const n=Y(t).scope??e.scope;return{cache:{isRight:!1,value:void 0},id:b(),implementationType:t,isSatisfiedBy:()=>!0,moduleId:void 0,onActivation:void 0,onDeactivation:void 0,scope:n,serviceIdentifier:t,type:M}}(e.autobindOptions,r);e.setBinding(t),a.push(t)}return a}function se(e){return void 0!==e.redirections}function oe(e,t,n,r){let a,i;se(n)?(a=n.binding.targetServiceIdentifier,i=n.binding.serviceIdentifier):(a=n.serviceIdentifier,i=n.parent?.binding.serviceIdentifier),Array.isArray(e)?function(e,t,n,r,a){if(0!==e.length){const t=`Ambiguous bindings found for service: "${c(n)}".\n\nRegistered bindings:\n\n${e.map((e=>function(e){switch(e.type){case M:return`[ type: "${e.type}", serviceIdentifier: "${c(e.serviceIdentifier)}", scope: "${e.scope}", implementationType: "${e.implementationType.name}" ]`;case E:return`[ type: "${e.type}", serviceIdentifier: "${c(e.serviceIdentifier)}", redirection: "${c(e.targetServiceIdentifier)}" ]`;default:return`[ type: "${e.type}", serviceIdentifier: "${c(e.serviceIdentifier)}", scope: "${e.scope}" ]`}}(e.binding))).join("\n")}\n\nTrying to resolve bindings for "${_e(n,r)}".\n\n${ce(a)}`;throw new F(j.planning,t)}t||le(n,r,a)}(e,t,a,i,r):function(e,t,n,r,a){void 0!==e||t||le(n,r,a)}(e,t,a,i,r)}function le(e,t,n){const r=`No bindings found for service: "${c(e)}".\n\nTrying to resolve bindings for "${_e(e,t)}".\n\n${ce(n)}`;throw new F(j.planning,r)}function _e(e,t){return void 0===t?`${c(e)} (Root service)`:c(t)}function ce(e){const t=0===e.tags.size?"":`\n- tags:\n  - ${[...e.tags.keys()].map((e=>e.toString())).join("\n  - ")}`;return`Binding constraints:\n- service identifier: ${c(e.serviceIdentifier)}\n- name: ${e.name?.toString()??"-"}${t}`}function fe(e,t,n){if(1!==e.redirections.length)oe(e.redirections,t,e,n);else{const[r]=e.redirections;se(r)&&fe(r,t,n)}}function ue(e,t,n){if(Array.isArray(e.bindings)&&1===e.bindings.length){const[r]=e.bindings;se(r)&&fe(r,t,n)}else oe(e.bindings,t,e,n)}function he(e){try{const t=new Map;void 0!==e.rootConstraints.tag&&t.set(e.rootConstraints.tag.key,e.rootConstraints.tag.value);const n=new ae({elem:{name:e.rootConstraints.name,serviceIdentifier:e.rootConstraints.serviceIdentifier,tags:t},previous:void 0}),r=new re(n.last),a=ie(e,r),i=[],s={bindings:i,parent:void 0,serviceIdentifier:e.rootConstraints.serviceIdentifier};if(i.push(...ve(e,n,a,s)),!e.rootConstraints.isMultiple){ue(s,e.rootConstraints.isOptional??!1,r);const[t]=i;s.bindings=t}return{tree:{root:s}}}catch(t){!function(e,t){if(function(e){return e instanceof Error&&(e instanceof RangeError&&/stack space|call stack|too much recursion/i.test(e.message)||"InternalError"===e.name&&/too much recursion/.test(e.message))}(t)){const n=function(e){const t=[...e];return 0===t.length?"(No dependency trace)":t.map(c).join(" -> ")}(function(e){const t=new Set;for(const n of e.servicesBranch){if(t.has(n))return[...t,n];t.add(n)}return[...t]}(e));throw new F(j.planning,`Circular dependency found: ${n}`,{cause:t})}throw t}(e,t)}}function de(e,t,n,r){const a={binding:t,classMetadata:e.getClassMetadata(t.implementationType),constructorParams:[],parent:r,propertyParams:new Map};return we({autobindOptions:e.autobindOptions,getBindings:e.getBindings,getClassMetadata:e.getClassMetadata,node:a,servicesBranch:e.servicesBranch,setBinding:e.setBinding},n)}function pe(e,t,n){if(n.kind===q.unmanaged)return;const r=u.is(n.value)?n.value.unwrap():n.value,a=t.concat({name:n.name,serviceIdentifier:r,tags:n.tags}),i=new re(a.last),s=ie(e,i),o=[],l={bindings:o,parent:e.node,serviceIdentifier:r};if(o.push(...ve(e,a,s,l)),n.kind===q.singleInjection){ue(l,n.optional,i);const[e]=o;l.bindings=e}return l}function me(e,t,n){const r=u.is(n.value)?n.value.unwrap():n.value,a=t.concat({name:n.name,serviceIdentifier:r,tags:n.tags}),i=new re(a.last),s=ie(e,i),o=[],l={bindings:o,parent:e.node,serviceIdentifier:r};if(o.push(...ve(e,a,s,l)),n.kind===te.singleInjection){ue(l,n.optional,i);const[e]=o;l.bindings=e}return l}function be(e,t,n,r){const a={binding:t,params:[],parent:r};return we({autobindOptions:e.autobindOptions,getBindings:e.getBindings,getClassMetadata:e.getClassMetadata,node:a,servicesBranch:e.servicesBranch,setBinding:e.setBinding},n)}function ve(e,t,n,r){const a=se(r)?r.binding.targetServiceIdentifier:r.serviceIdentifier;e.servicesBranch.push(a);const i=[];for(const a of n)switch(a.type){case M:i.push(de(e,a,t,r));break;case R:i.push(be(e,a,t,r));break;case E:{const n=ge(e,t,a,r);i.push(n);break}default:i.push({binding:a,parent:r})}return e.servicesBranch.pop(),i}function ge(e,t,n,r){const a={binding:n,parent:r,redirections:[]},i=ie(e,new re(t.last),{customServiceIdentifier:n.targetServiceIdentifier});return a.redirections.push(...ve(e,t,i,a)),a}function we(e,t){return e.node.binding.type===M?function(e,t,n){const r=t.classMetadata;for(const[a,i]of r.constructorArguments.entries())t.constructorParams[a]=pe(e,n,i);for(const[a,i]of r.properties){const r=pe(e,n,i);void 0!==r&&t.propertyParams.set(a,r)}return e.node}(e,e.node,t):function(e,t,n){const r=t.binding.metadata;for(const[a,i]of r.arguments.entries())t.params[a]=me(e,n,i);return e.node}(e,e.node,t)}!function(e){e[e.singleMandatory=0]="singleMandatory",e[e.singleOptional=1]="singleOptional",e[e.multipleMandatory=2]="multipleMandatory",e[e.multipleOptional=3]="multipleOptional",e[e.length=4]="length"}(ne||(ne={}));class ye{#h;#d;#p;#m;#b;constructor(){this.#h=this.#v(),this.#d=this.#v(),this.#m=this.#v(),this.#p=this.#v(),this.#b=[]}clearCache(){for(const e of this.#g())e.clear();for(const e of this.#b)e.clearCache()}get(e){return void 0===e.name?void 0===e.tag?this.#w(this.#h,e).get(e.serviceIdentifier):this.#w(this.#p,e).get(e.serviceIdentifier)?.get(e.tag.key)?.get(e.tag.value):void 0===e.tag?this.#w(this.#d,e).get(e.serviceIdentifier)?.get(e.name):this.#w(this.#m,e).get(e.serviceIdentifier)?.get(e.name)?.get(e.tag.key)?.get(e.tag.value)}set(e,t){void 0===e.name?void 0===e.tag?this.#w(this.#h,e).set(e.serviceIdentifier,t):this.#y(this.#y(this.#w(this.#p,e),e.serviceIdentifier),e.tag.key).set(e.tag.value,t):void 0===e.tag?this.#y(this.#w(this.#d,e),e.serviceIdentifier).set(e.name,t):this.#y(this.#y(this.#y(this.#w(this.#m,e),e.serviceIdentifier),e.name),e.tag.key).set(e.tag.value,t)}subscribe(e){this.#b.push(e)}#v(){const e=new Array(ne.length);for(let t=0;t<e.length;++t)e[t]=new Map;return e}#y(e,t){let n=e.get(t);return void 0===n&&(n=new Map,e.set(t,n)),n}#w(e,t){return e[this.#S(t)]}#g(){return[...this.#h,...this.#d,...this.#m,...this.#p]}#S(e){return e.isMultiple?!0===e.optional?ne.multipleOptional:ne.multipleMandatory:!0===e.optional?ne.singleOptional:ne.singleMandatory}}function Se(e,t){return _(t)?(e.cache={isRight:!0,value:t},t.then((t=>Ae(e,t)))):Ae(e,t)}function Ae(e,t){return e.cache={isRight:!0,value:t},t}async function Me(e,t,n){let r=await t,a=n.next();for(;!0!==a.done;)r=await a.value(e.context,r),a=n.next();return r}function Be(e,t,n){let r=n;if(void 0!==t.onActivation){const n=t.onActivation;r=_(r)?r.then((t=>n(e.context,t))):n(e.context,r)}return function(e,t,n){const r=e.getActivations(t);return void 0===r?n:_(n)?Me(e,n,r[Symbol.iterator]()):function(e,t,n){let r=t,a=n.next();for(;!0!==a.done;){const t=a.value(e.context,r);if(_(t))return Me(e,t,n);r=t,a=n.next()}return r}(e,n,r[Symbol.iterator]())}(e,t.serviceIdentifier,r)}function Re(e){return(t,n)=>n.cache.isRight?n.cache.value:Se(n,Be(t,n,e(t,n)))}const Ee=Re((function(e,t){return t.value}));function ke(e){return e}function Te(e,t){return(n,r)=>{const a=e(r);switch(a.scope){case g:return a.cache.isRight?a.cache.value:Se(a,Be(n,a,t(n,r)));case v:{if(n.requestScopeCache.has(a.id))return n.requestScopeCache.get(a.id);const e=Be(n,a,t(n,r));return n.requestScopeCache.set(a.id,e),e}case w:return Be(n,a,t(n,r))}}}const xe=Te(ke,(function(e,t){return t.value(e.context)})),Ie=Re((function(e,t){return t.factory(e.context)}));function Pe(e,t,n){const r=function(e,t,n){if(void 0!==n){if(!(n in e))throw new F(j.resolution,`Expecting a "${n.toString()}" property when resolving "${t.implementationType.name}" class @postConstruct decorated method, none found.`);if("function"!=typeof e[n])throw new F(j.resolution,`Expecting a "${n.toString()}" method when resolving "${t.implementationType.name}" class @postConstruct decorated method, a non function property was found instead.`);{let r;try{r=e[n]()}catch(e){throw new F(j.resolution,`Unexpected error found when calling "${n.toString()}" @postConstruct decorated method on class "${t.implementationType.name}"`,{cause:e})}if(_(r))return async function(e,t,n){try{await n}catch(n){throw new F(j.resolution,`Unexpected error found when calling "${t.toString()}" @postConstruct decorated method on class "${e.implementationType.name}"`,{cause:n})}}(t,n,r)}}}(e,t,n);return _(r)?r.then((()=>e)):e}function Oe(e){return(t,n,r)=>{const a=new r.binding.implementationType(...t),i=e(n,a,r);return _(i)?i.then((()=>Pe(a,r.binding,r.classMetadata.lifecycle.postConstructMethodName))):Pe(a,r.binding,r.classMetadata.lifecycle.postConstructMethodName)}}const Ve=Re((function(e,t){return t.provider(e.context)}));function Le(e){return e.binding}function Ne(e){return e.binding}const He=(qe=Ge,(e,t,n)=>{const r=[];for(const[a,i]of n.propertyParams){const s=n.classMetadata.properties.get(a);if(void 0===s)throw new F(j.resolution,`Expecting metadata at property "${a.toString()}", none found`);s.kind!==q.unmanaged&&void 0!==i.bindings&&(t[a]=qe(e,i),_(t[a])&&r.push((async()=>{t[a]=await t[a]})()))}if(r.length>0)return Promise.all(r).then((()=>{}))}),De=function(e){return function t(n,r){const a=[];for(const i of r.redirections)se(i)?a.push(...t(n,i)):a.push(e(n,i));return a}}(Ye),Ce=function(e,t,n){return(r,a)=>{const i=e(r,a);return _(i)?t(i,r,a):n(i,r,a)}}(function(e){return(t,n)=>{const r=[];for(const a of n.constructorParams)void 0===a?r.push(void 0):r.push(e(t,a));return r.some(_)?Promise.all(r):r}}(Ge),function(e){return async(t,n,r)=>{const a=await t;return e(a,n,r)}}(Oe(He)),Oe(He)),Fe=function(e){return(t,n)=>{const r=e(t,n);return _(r)?r.then((e=>n.binding.factory(...e))):n.binding.factory(...r)}}(function(e){return(t,n)=>{const r=[];for(const a of n.params)r.push(e(t,a));return r.some(_)?Promise.all(r):r}}(Ge)),je=Te(Le,Ce),Xe=Te(Ne,Fe);var qe;function Ye(e,t){switch(t.binding.type){case y:return Ee(e,t.binding);case S:return xe(e,t.binding);case A:return Ie(e,t.binding);case M:return je(e,t);case B:return Ve(e,t.binding);case R:return Xe(e,t)}}function Ge(e,t){if(void 0!==t.bindings)return Array.isArray(t.bindings)?function(e,t){const n=[];for(const r of t)se(r)?n.push(...De(e,r)):n.push(Ye(e,r));return n.some(_)?Promise.all(n):n}(e,t.bindings):function(e,t){if(se(t)){const n=De(e,t);if(1===n.length)return n[0];throw new F(j.resolution,"Unexpected multiple resolved values on single injection")}return Ye(e,t)}(e,t.bindings)}function Ue(e){return void 0!==e.scope}function Ke(e,t){if(void 0!==e.lifecycle.preDestroyMethodName&&"function"==typeof t[e.lifecycle.preDestroyMethodName])return t[e.lifecycle.preDestroyMethodName]()}function ze(e,t,n){const r=e.getDeactivations(t);if(void 0!==r)return _(n)?Ze(n,r[Symbol.iterator]()):function(e,t){let n=t.next();for(;!0!==n.done;){if(_(n.value(e)))return Ze(e,t);n=t.next()}}(n,r[Symbol.iterator]())}async function Ze(e,t){const n=await e;let r=t.next();for(;!0!==r.done;)await r.value(n),r=t.next()}function We(e,t){const n=function(e,t){if(t.type===M){const n=e.getClassMetadata(t.implementationType),r=t.cache.value;return _(r)?r.then((e=>Ke(n,e))):Ke(n,r)}}(e,t);return void 0===n?Qe(e,t):n.then((()=>Qe(e,t)))}function Qe(e,t){const n=t.cache;return _(n.value)?n.value.then((n=>$e(e,t,n))):$e(e,t,n.value)}function $e(e,t,n){let r;return void 0!==t.onDeactivation&&(r=(0,t.onDeactivation)(n)),void 0===r?ze(e,t.serviceIdentifier,n):r.then((()=>ze(e,t.serviceIdentifier,n)))}function Je(e,t){if(void 0===t)return;const n=function(e){const t=[];for(const n of e)Ue(n)&&n.scope===g&&n.cache.isRight&&t.push(n);return t}(t),r=[];for(const t of n){const n=We(e,t);void 0!==n&&r.push(n)}return r.length>0?Promise.all(r).then((()=>{})):void 0}function et(e,t){const n=e.getBindings(t);return Je(e,n)}const tt=Symbol.for("@inversifyjs/container/bindingIdentifier");function nt(e){return"object"==typeof e&&null!==e&&!0===e[tt]}class rt{static always=e=>!0}function at(e){return{[tt]:!0,id:e.id}}function it(e){return t=>{for(let n=t.getAncestor();void 0!==n;n=n.getAncestor())if(e(n))return!0;return!1}}function st(e){return t=>t.name===e}function ot(e){return t=>t.serviceIdentifier===e}function lt(e,t){return n=>n.tags.has(e)&&n.tags.get(e)===t}function _t(e){return void 0===e.name&&0===e.tags.size}function ct(e){const t=it(e);return e=>!t(e)}function ft(e){return t=>{const n=t.getAncestor();return void 0===n||!e(n)}}function ut(e){return t=>{const n=t.getAncestor();return void 0!==n&&e(n)}}class ht{#n;constructor(e){this.#n=e}getIdentifier(){return at(this.#n)}inRequestScope(){return this.#n.scope=v,new bt(this.#n)}inSingletonScope(){return this.#n.scope=g,new bt(this.#n)}inTransientScope(){return this.#n.scope=w,new bt(this.#n)}}class dt{#t;#o;#i;#s;constructor(e,t,n,r){this.#t=e,this.#o=t,this.#i=n,this.#s=r}to(e){const t=Y(e),n={cache:{isRight:!1,value:void 0},id:b(),implementationType:e,isSatisfiedBy:rt.always,moduleId:this.#o,onActivation:void 0,onDeactivation:void 0,scope:t.scope??this.#i,serviceIdentifier:this.#s,type:M};return this.#t(n),new vt(n)}toSelf(){if("function"!=typeof this.#s)throw new Error('"toSelf" function can only be applied when a newable function is used as service identifier');return this.to(this.#s)}toConstantValue(e){const t={cache:{isRight:!1,value:void 0},id:b(),isSatisfiedBy:rt.always,moduleId:this.#o,onActivation:void 0,onDeactivation:void 0,scope:g,serviceIdentifier:this.#s,type:y,value:e};return this.#t(t),new bt(t)}toDynamicValue(e){const t={cache:{isRight:!1,value:void 0},id:b(),isSatisfiedBy:rt.always,moduleId:this.#o,onActivation:void 0,onDeactivation:void 0,scope:this.#i,serviceIdentifier:this.#s,type:S,value:e};return this.#t(t),new vt(t)}toResolvedValue(e,t){const n={cache:{isRight:!1,value:void 0},factory:e,id:b(),isSatisfiedBy:rt.always,metadata:this.#a(t),moduleId:this.#o,onActivation:void 0,onDeactivation:void 0,scope:this.#i,serviceIdentifier:this.#s,type:R};return this.#t(n),new vt(n)}toFactory(e){const t={cache:{isRight:!1,value:void 0},factory:e,id:b(),isSatisfiedBy:rt.always,moduleId:this.#o,onActivation:void 0,onDeactivation:void 0,scope:g,serviceIdentifier:this.#s,type:A};return this.#t(t),new bt(t)}toProvider(e){const t={cache:{isRight:!1,value:void 0},id:b(),isSatisfiedBy:rt.always,moduleId:this.#o,onActivation:void 0,onDeactivation:void 0,provider:e,scope:g,serviceIdentifier:this.#s,type:B};return this.#t(t),new bt(t)}toService(e){const t={id:b(),isSatisfiedBy:rt.always,moduleId:this.#o,serviceIdentifier:this.#s,targetServiceIdentifier:e,type:E};this.#t(t)}#a(e){return{arguments:(e??[]).map((e=>function(e){return"object"==typeof e&&!u.is(e)}(e)?{kind:!0===e.isMultiple?te.multipleInjection:te.singleInjection,name:e.name,optional:e.optional??!1,tags:new Map((e.tags??[]).map((e=>[e.key,e.value]))),value:e.serviceIdentifier}:{kind:te.singleInjection,name:void 0,optional:!1,tags:new Map,value:e}))}}}class pt{#n;constructor(e){this.#n=e}getIdentifier(){return at(this.#n)}onActivation(e){return this.#n.onActivation=e,new mt(this.#n)}onDeactivation(e){return this.#n.onDeactivation=e,new mt(this.#n)}}class mt{#n;constructor(e){this.#n=e}getIdentifier(){return at(this.#n)}when(e){return this.#n.isSatisfiedBy=e,new pt(this.#n)}whenAnyAncestor(e){return this.when(it(e))}whenAnyAncestorIs(e){return this.when(it(ot(e)))}whenAnyAncestorNamed(e){return this.when(function(e){return it(st(e))}(e))}whenAnyAncestorTagged(e,t){return this.when(function(e,t){return it(lt(e,t))}(e,t))}whenDefault(){return this.when(_t)}whenNamed(e){return this.when(st(e))}whenNoParent(e){return this.when(ft(e))}whenNoParentIs(e){return this.when(ft(ot(e)))}whenNoParentNamed(e){return this.when(function(e){return ft(st(e))}(e))}whenNoParentTagged(e,t){return this.when(function(e,t){return ft(lt(e,t))}(e,t))}whenParent(e){return this.when(ut(e))}whenParentIs(e){return this.when(ut(ot(e)))}whenParentNamed(e){return this.when(function(e){return ut(st(e))}(e))}whenParentTagged(e,t){return this.when(function(e,t){return ut(lt(e,t))}(e,t))}whenTagged(e,t){return this.when(lt(e,t))}whenNoAncestor(e){return this.when(ct(e))}whenNoAncestorIs(e){return this.when(ct(ot(e)))}whenNoAncestorNamed(e){return this.when(function(e){return ct(st(e))}(e))}whenNoAncestorTagged(e,t){return this.when(function(e,t){return ct(lt(e,t))}(e,t))}}class bt extends mt{#c;constructor(e){super(e),this.#c=new pt(e)}onActivation(e){return this.#c.onActivation(e)}onDeactivation(e){return this.#c.onDeactivation(e)}}class vt extends bt{#l;constructor(e){super(e),this.#l=new ht(e)}inRequestScope(){return this.#l.inRequestScope()}inSingletonScope(){return this.#l.inSingletonScope()}inTransientScope(){return this.#l.inTransientScope()}}const gt=Symbol.for("@inversifyjs/container/InversifyContainerError");class wt extends Error{[gt];kind;constructor(e,t,n){super(t,n),this[gt]=!0,this.kind=e}static is(e){return"object"==typeof e&&null!==e&&!0===e[gt]}static isErrorOfKind(e,t){return wt.is(e)&&e.kind===t}}var yt,St;(St=yt||(yt={}))[St.invalidOperation=0]="invalidOperation";const At=w;class Mt{#f;#_;#m;#b;#d;#S;#h;#A;#u;#v;#p;constructor(e){this.#m=this.#y(),this.#d=e=>this.#f.get(e),this.#A=new ye,this.#u=this.#w(),void 0===e?.parent?(this.#f=O.build(void 0),this.#_=V.build(void 0),this.#b=L.build(void 0)):(this.#f=O.build(e.parent.#f),this.#_=V.build(e.parent.#_),this.#b=L.build(e.parent.#b),e.parent.#A.subscribe(this.#A)),this.#S=this.#_.get.bind(this.#_),this.#v=this.#M.bind(this),this.#h={autobind:e?.autobind??!1,defaultScope:e?.defaultScope??At},this.#p=[]}bind(e){return new dt((e=>{this.#M(e)}),void 0,this.#h.defaultScope,e)}get(e,t){const n=this.#B(!1,e,t),r=this.#R(n);if(_(r))throw new wt(yt.invalidOperation,`Unexpected asyncronous service when resolving service "${c(e)}"`);return r}getAll(e,t){const n=this.#B(!0,e,t),r=this.#R(n);if(_(r))throw new wt(yt.invalidOperation,`Unexpected asyncronous service when resolving service "${c(e)}"`);return r}async getAllAsync(e,t){const n=this.#B(!0,e,t);return this.#R(n)}async getAsync(e,t){const n=this.#B(!1,e,t);return this.#R(n)}isBound(e,t){const n=this.#_.get(e);return this.#E(e,n,t)}isCurrentBound(e,t){const n=this.#_.getNonParentBindings(e);return this.#E(e,n,t)}async load(...e){await Promise.all(this.#e(...e))}loadSync(...e){const t=this.#e(...e);for(const e of t)if(void 0!==e)throw new wt(yt.invalidOperation,"Unexpected asyncronous module load. Consider using Container.load() instead.")}onActivation(e,t){this.#f.add(t,{serviceId:e})}onDeactivation(e,t){this.#b.add(t,{serviceId:e})}restore(){const e=this.#p.pop();if(void 0===e)throw new wt(yt.invalidOperation,"No snapshot available to restore");this.#f=e.activationService,this.#_=e.bindingService,this.#b=e.deactivationService,this.#k()}async rebind(e){return await this.unbind(e),this.bind(e)}rebindSync(e){return this.unbindSync(e),this.bind(e)}snapshot(){this.#p.push({activationService:this.#f.clone(),bindingService:this.#_.clone(),deactivationService:this.#b.clone()})}async unbind(e){await this.#g(e)}async unbindAll(){const e=[...this.#_.getNonParentBoundServices()];await Promise.all(e.map((async e=>et(this.#m,e))));for(const t of e)this.#f.removeAllByServiceId(t),this.#_.removeAllByServiceId(t),this.#b.removeAllByServiceId(t);this.#A.clearCache()}unbindSync(e){void 0!==this.#g(e)&&this.#T(e)}async unload(...e){await Promise.all(this.#x(...e)),this.#I(e)}unloadSync(...e){const t=this.#x(...e);for(const e of t)if(void 0!==e)throw new wt(yt.invalidOperation,"Unexpected asyncronous module unload. Consider using Container.unload() instead.");this.#I(e)}#P(e){return{bind:t=>new dt((e=>{this.#M(e)}),e,this.#h.defaultScope,t),isBound:this.isBound.bind(this),onActivation:(t,n)=>{this.#f.add(n,{moduleId:e,serviceId:t})},onDeactivation:(t,n)=>{this.#b.add(n,{moduleId:e,serviceId:t})},rebind:this.rebind.bind(this),rebindSync:this.rebindSync.bind(this),unbind:this.unbind.bind(this),unbindSync:this.unbindSync.bind(this)}}#y(){return{getBindings:e=>this.#_.get(e),getBindingsFromModule:e=>this.#_.getByModuleId(e),getClassMetadata:Y,getDeactivations:e=>this.#b.get(e)}}#O(e,t,n){return{isMultiple:e,name:n?.name,optional:n?.optional,serviceIdentifier:t,tag:n?.tag}}#V(e,t,n){const r={autobindOptions:n?.autobind??this.#h.autobind?{scope:this.#h.defaultScope}:void 0,getBindings:this.#S,getClassMetadata:Y,rootConstraints:{isMultiple:t,serviceIdentifier:e},servicesBranch:[],setBinding:this.#v};return this.#L(r,n),r}#B(e,t,n){const r=this.#O(e,t,n),a=this.#A.get(r);if(void 0!==a)return a;const i=he(this.#V(t,e,n));return this.#A.set(r,i),i}#w(){return{get:this.get.bind(this),getAll:this.getAll.bind(this),getAllAsync:this.getAllAsync.bind(this),getAsync:this.getAsync.bind(this)}}#R(e){return function(e){return Ge(e,e.planResult.tree.root)}({context:this.#u,getActivations:this.#d,planResult:e,requestScopeCache:new Map})}#L(e,t){void 0!==t&&(void 0!==t.name&&(e.rootConstraints.name=t.name),!0===t.optional&&(e.rootConstraints.isOptional=!0),void 0!==t.tag&&(e.rootConstraints.tag={key:t.tag.key,value:t.tag.value}))}#E(e,t,n){if(void 0===t)return!1;const r={getAncestor:()=>{},name:n?.name,serviceIdentifier:e,tags:new Map};void 0!==n?.tag&&r.tags.set(n.tag.key,n.tag.value);for(const e of t)if(e.isSatisfiedBy(r))return!0;return!1}#e(...e){return e.map((e=>e.load(this.#P(e.id))))}#x(...e){return e.map((e=>function(e,t){const n=e.getBindingsFromModule(t);return Je(e,n)}(this.#m,e.id)))}#k(){this.#A.clearCache(),this.#d=e=>this.#f.get(e),this.#S=this.#_.get.bind(this.#_),this.#u=this.#w(),this.#v=this.#M.bind(this)}#M(e){this.#_.set(e),this.#A.clearCache()}#T(e){let t;if(nt(e)){const r=this.#_.getById(e.id),a=(n=r,function(e){if(void 0===e)return;const t=e.next();return!0!==t.done?t.value:void 0}(n?.[Symbol.iterator]()))?.serviceIdentifier;t=void 0===a?"Unexpected asyncronous deactivation when unbinding binding identifier. Consider using Container.unbind() instead.":`Unexpected asyncronous deactivation when unbinding "${c(a)}" binding. Consider using Container.unbind() instead.`}else t=`Unexpected asyncronous deactivation when unbinding "${c(e)}" service. Consider using Container.unbind() instead.`;var n;throw new wt(yt.invalidOperation,t)}#g(e){return nt(e)?this.#N(e):this.#H(e)}#N(e){const t=this.#_.getById(e.id),n=Je(this.#m,t);if(void 0!==n)return n.then((()=>{this.#D(e)}));this.#D(e)}#D(e){this.#_.removeById(e.id),this.#A.clearCache()}#I(e){for(const t of e)this.#f.removeAllByModuleId(t.id),this.#_.removeAllByModuleId(t.id),this.#b.removeAllByModuleId(t.id);this.#A.clearCache()}#H(e){const t=et(this.#m,e);if(void 0!==t)return t.then((()=>{this.#C(e)}));this.#C(e)}#C(e){this.#f.removeAllByServiceId(e),this.#_.removeAllByServiceId(e),this.#b.removeAllByServiceId(e),this.#A.clearCache()}}class Bt{isWebAudioEncoderAPISupportedForSettings(e){return n(this,void 0,void 0,(function*(){if(!AudioEncoder||!AudioEncoder.isConfigSupported)return!1;const t=yield AudioEncoder.isConfigSupported({codec:e.format,sampleRate:e.sampleRate,numberOfChannels:e.numChannels,bitrate:100*(e.bitrate||0)});return Boolean(t.supported)}))}encodeWithWebAudioEncoderAPI(e,t){return n(this,void 0,void 0,(function*(){const n=this.getFormat();if(!n)throw new Error("encodeWebAudioEncoderAPI: No format provided");const a=[],i=new AudioEncoder({output:e=>a.push(e),error:e=>console.error(e)});i.configure({codec:n,sampleRate:t.sampleRate,numberOfChannels:t.numChannels,bitrate:t.bitrate});const s=e[0].length;let o;o=2===t.numChannels?r.interleaveBuffers(e[0],e[1]):e[0];const l=new AudioData({format:"f32",sampleRate:sampleRate,numberOfFrames:s,numberOfChannels:2,timestamp:0,data:o});i.encode(l),yield i.flush(),i.close();const _=a.reduce(((e,t)=>e+t.byteLength),0),c=new Float32Array(_);let f=0;for(const e of a){const t=new Float32Array(e.byteLength);e.copyTo(t),c.set(t,f),f+=t.length}return c.buffer}))}}let Rt=class extends Bt{constructor(e){super(),this.audioEncoders=e}getFormat(){return null}getAudioEncoderByFormat(e){return this.audioEncoders.find((t=>t.getFormat()===e))}encodeAudio(e,t){const n=this.getAudioEncoderByFormat(t.format);if(n)return n.encodeAudio(e,t);throw new Error(`BaseAudioEncoder.encodeAudio: cannot find encoder for ${t.format} format`)}};var Et,kt;Rt=e([ee(),(Et=0,kt=function(e){return function(e,t){return(n,r,a)=>{try{void 0===a?function(e,t){const n=Q(e,t);return(e,t)=>{p(e.constructor,N,H,z(n(e),t))}}(e,t)(n,r):"number"==typeof a?function(e,t){const n=Q(e,t);return(e,t,r)=>{if(!function(e,t){return"function"==typeof e&&void 0===t}(e,t))throw new F(j.injectionDecoratorConflict,`Found an @inject decorator in a non constructor parameter.\nFound @inject decorator at method "${t?.toString()??""}" at class "${e.constructor.name}"`);p(e,N,H,function(e,t){return n=>{const r=n.constructorArguments[t];return n.constructorArguments[t]=e(r),n}}(n(e),r))}}(e,t)(n,r,a):function(e,t){const n=Q(e,t);return(e,t,r)=>{if(!function(e){return void 0!==e.set}(r))throw new F(j.injectionDecoratorConflict,`Found an @inject decorator in a non setter property method.\nFound @inject decorator at method "${t.toString()}" at class "${e.constructor.name}"`);p(e.constructor,N,H,z(n(e),t))}}(e,t)(n,r,a)}catch(e){W(n,r,a,e)}}}(K(q.multipleInjection,e),U)}(a.AudioEncoders),function(e,t){kt(e,t,Et)}),t("design:paramtypes",[Array])],Rt);var Tt=Rt;let xt=class extends Bt{getFormat(){return"wav"}encodeAudio(e,t){let n;n=2===t.numChannels?r.interleaveBuffers(e[0],e[1]):e[0];const a=new ArrayBuffer(44+2*n.length),i=new DataView(a);return r.writeStringToDataView(i,0,"RIFF"),i.setUint32(4,36+2*n.length,!0),r.writeStringToDataView(i,8,"WAVE"),r.writeStringToDataView(i,12,"fmt "),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,t.numChannels,!0),i.setUint32(24,t.sampleRate,!0),i.setUint32(28,4*t.sampleRate,!0),i.setUint16(32,2*t.numChannels,!0),i.setUint16(34,16,!0),r.writeStringToDataView(i,36,"data"),i.setUint32(40,2*n.length,!0),r.floatTo16BitPCM(i,44,n),Promise.resolve(i.buffer)}};xt=e([ee()],xt);var It,Pt,Ot,Vt,Lt,Nt,Ht,Dt,Ct,Ft,jt,Xt,qt,Yt,Gt,Ut,Kt,zt,Zt,Wt,Qt,$t,Jt,en,tn,nn,rn,an,sn,on,ln,_n,cn,fn,un,hn,dn,pn,mn,bn,vn,gn,wn,yn,Sn,An,Mn,Bn,Rn,En,kn,Tn,xn,In,Pn,On,Vn,Ln,Nn,Hn,Dn,Cn,Fn,jn,Xn,qn,Yn,Gn,Un,Kn=xt,zn={};function Zn(){if(Pt)return It;function e(e){return new Int16Array(e)}function t(e){return new Int32Array(e)}function n(e){return new Float32Array(e)}Pt=1;var r={fill:function(e,t,n,r){if(2==arguments.length)for(var a=0;a<e.length;a++)e[a]=arguments[1];else for(a=t;a<n;a++)e[a]=r}},a={arraycopy:function(e,t,n,r,a){for(var i=t+a;t<i;)n[r++]=e[t++]},out:{}};a.out.println=function(e){console.log(e)},a.out.printf=function(){console.log.apply(console,arguments)};var i={};function s(e){this.ordinal=e}i.SQRT2=1.4142135623730951,i.FAST_LOG10=function(e){return Math.log10(e)},i.FAST_LOG10_X=function(e,t){return Math.log10(e)*t},s.short_block_allowed=new s(0),s.short_block_coupled=new s(1),s.short_block_dispensed=new s(2),s.short_block_forced=new s(3);var o={};function l(e){this.ordinal=e}o.MAX_VALUE=34028235e31,l.vbr_off=new l(0),l.vbr_mt=new l(1),l.vbr_rh=new l(2),l.vbr_abr=new l(3),l.vbr_mtrh=new l(4),l.vbr_default=l.vbr_mtrh;return It={System:a,VbrMode:l,Float:o,ShortBlock:s,Util:i,Arrays:r,new_array_n:function e(t){if(1==t.length)return new Array(t[0]);var n=t[0];t=t.slice(1);for(var r=[],a=0;a<n;a++)r.push(e(t));return r},new_byte:function(e){return new Int8Array(e)},new_double:function(e){return new Float64Array(e)},new_float:n,new_float_n:function e(t){if(1==t.length)return n(t[0]);var r=t[0];t=t.slice(1);for(var a=[],i=0;i<r;i++)a.push(e(t));return a},new_int:t,new_int_n:function e(n){if(1==n.length)return t(n[0]);var r=n[0];n=n.slice(1);for(var a=[],i=0;i<r;i++)a.push(e(n));return a},new_short:e,new_short_n:function t(n){if(1==n.length)return e(n[0]);var r=n[0];n=n.slice(1);for(var a=[],i=0;i<r;i++)a.push(t(n));return a},assert:function(e){}},It}function Wn(){if(Nt)return Lt;Nt=1;var e=Qn(),t=Zn(),n=t.System;t.VbrMode,t.Float,t.ShortBlock,t.Util,t.Arrays,t.new_array_n,t.new_byte,t.new_double;var r=t.new_float,a=t.new_float_n;return t.new_int,t.new_int_n,t.assert,Lt=function(){this.l=r(e.SBMAX_l),this.s=a([e.SBMAX_s,3]);var t=this;this.assign=function(r){n.arraycopy(r.l,0,t.l,0,e.SBMAX_l);for(var a=0;a<e.SBMAX_s;a++)for(var i=0;i<3;i++)t.s[a][i]=r.s[a][i]}},Lt}function Qn(){if(Ft)return Ct;Ft=1;var e=Zn(),t=e.System,n=e.VbrMode;e.Float,e.ShortBlock,e.Util,e.Arrays;var r=e.new_array_n;e.new_byte,e.new_double;var a=e.new_float,i=e.new_float_n,s=e.new_int;e.new_int_n;var o=e.assert;function l(){var e=function(){if(Vt)return Ot;Vt=1;var e=Zn(),t=e.System;e.VbrMode,e.Float,e.ShortBlock;var n=e.Util,r=e.Arrays;e.new_array_n,e.new_byte,e.new_double;var a=e.new_float;e.new_float_n,e.new_int,e.new_int_n,e.assert;var i=Qn();return Ot=function(){var e=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*n.SQRT2*.5/2384e-9,.017876148*n.SQRT2*.5/2384e-9,.003134727*n.SQRT2*.5/2384e-9,.002457142*n.SQRT2*.5/2384e-9,971317e-9*n.SQRT2*.5/2384e-9,218868e-9*n.SQRT2*.5/2384e-9,101566e-9*n.SQRT2*.5/2384e-9,13828e-9*n.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],s=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],o=s[i.SHORT_TYPE],l=s[i.SHORT_TYPE],_=s[i.SHORT_TYPE],c=s[i.SHORT_TYPE],f=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function u(t,r,a){for(var i,s,o,l=10,_=r+238-14-286,c=-15;c<0;c++){var f,u,h;f=e[l+-10],u=t[_+-224]*f,h=t[r+224]*f,f=e[l+-9],u+=t[_+-160]*f,h+=t[r+160]*f,f=e[l+-8],u+=t[_+-96]*f,h+=t[r+96]*f,f=e[l+-7],u+=t[_+-32]*f,h+=t[r+32]*f,f=e[l+-6],u+=t[_+32]*f,h+=t[r+-32]*f,f=e[l+-5],u+=t[_+96]*f,h+=t[r+-96]*f,f=e[l+-4],u+=t[_+160]*f,h+=t[r+-160]*f,f=e[l+-3],u+=t[_+224]*f,h+=t[r+-224]*f,f=e[l+-2],u+=t[r+-256]*f,h-=t[_+256]*f,f=e[l+-1],u+=t[r+-192]*f,h-=t[_+192]*f,f=e[l+0],u+=t[r+-128]*f,h-=t[_+128]*f,f=e[l+1],u+=t[r+-64]*f,h-=t[_+64]*f,f=e[l+2],u+=t[r+0]*f,h-=t[_+0]*f,f=e[l+3],u+=t[r+64]*f,h-=t[_+-64]*f,f=e[l+4],u+=t[r+128]*f,h-=t[_+-128]*f,f=e[l+5],u+=t[r+192]*f,f=(h-=t[_+-192]*f)-(u*=e[l+6]),a[30+2*c]=h+u,a[31+2*c]=e[l+7]*f,l+=18,r--,_++}h=t[r+-16]*e[l+-10],u=t[r+-32]*e[l+-2],h+=(t[r+-48]-t[r+16])*e[l+-9],u+=t[r+-96]*e[l+-1],h+=(t[r+-80]+t[r+48])*e[l+-8],u+=t[r+-160]*e[l+0],h+=(t[r+-112]-t[r+80])*e[l+-7],u+=t[r+-224]*e[l+1],h+=(t[r+-144]+t[r+112])*e[l+-6],u-=t[r+32]*e[l+2],h+=(t[r+-176]-t[r+144])*e[l+-5],u-=t[r+96]*e[l+3],h+=(t[r+-208]+t[r+176])*e[l+-4],u-=t[r+160]*e[l+4],h+=(t[r+-240]-t[r+208])*e[l+-3],i=(u-=t[r+224])-h,s=u+h,h=a[14],u=a[15]-h,a[31]=s+h,a[30]=i+u,a[15]=i-u,a[14]=s-h,o=a[28]-a[0],a[0]+=a[28],a[28]=o*e[l+-36+7],o=a[29]-a[1],a[1]+=a[29],a[29]=o*e[l+-36+7],o=a[26]-a[2],a[2]+=a[26],a[26]=o*e[l+-72+7],o=a[27]-a[3],a[3]+=a[27],a[27]=o*e[l+-72+7],o=a[24]-a[4],a[4]+=a[24],a[24]=o*e[l+-108+7],o=a[25]-a[5],a[5]+=a[25],a[25]=o*e[l+-108+7],o=a[22]-a[6],a[6]+=a[22],a[22]=o*n.SQRT2,o=a[23]-a[7],a[7]+=a[23],a[23]=o*n.SQRT2-a[7],a[7]-=a[6],a[22]-=a[7],a[23]-=a[22],o=a[6],a[6]=a[31]-o,a[31]=a[31]+o,o=a[7],a[7]=a[30]-o,a[30]=a[30]+o,o=a[22],a[22]=a[15]-o,a[15]=a[15]+o,o=a[23],a[23]=a[14]-o,a[14]=a[14]+o,o=a[20]-a[8],a[8]+=a[20],a[20]=o*e[l+-180+7],o=a[21]-a[9],a[9]+=a[21],a[21]=o*e[l+-180+7],o=a[18]-a[10],a[10]+=a[18],a[18]=o*e[l+-216+7],o=a[19]-a[11],a[11]+=a[19],a[19]=o*e[l+-216+7],o=a[16]-a[12],a[12]+=a[16],a[16]=o*e[l+-252+7],o=a[17]-a[13],a[13]+=a[17],a[17]=o*e[l+-252+7],o=-a[20]+a[24],a[20]+=a[24],a[24]=o*e[l+-216+7],o=-a[21]+a[25],a[21]+=a[25],a[25]=o*e[l+-216+7],o=a[4]-a[8],a[4]+=a[8],a[8]=o*e[l+-216+7],o=a[5]-a[9],a[5]+=a[9],a[9]=o*e[l+-216+7],o=a[0]-a[12],a[0]+=a[12],a[12]=o*e[l+-72+7],o=a[1]-a[13],a[1]+=a[13],a[13]=o*e[l+-72+7],o=a[16]-a[28],a[16]+=a[28],a[28]=o*e[l+-72+7],o=-a[17]+a[29],a[17]+=a[29],a[29]=o*e[l+-72+7],o=n.SQRT2*(a[2]-a[10]),a[2]+=a[10],a[10]=o,o=n.SQRT2*(a[3]-a[11]),a[3]+=a[11],a[11]=o,o=n.SQRT2*(-a[18]+a[26]),a[18]+=a[26],a[26]=o-a[18],o=n.SQRT2*(-a[19]+a[27]),a[19]+=a[27],a[27]=o-a[19],o=a[2],a[19]-=a[3],a[3]-=o,a[2]=a[31]-o,a[31]+=o,o=a[3],a[11]-=a[19],a[18]-=o,a[3]=a[30]-o,a[30]+=o,o=a[18],a[27]-=a[11],a[19]-=o,a[18]=a[15]-o,a[15]+=o,o=a[19],a[10]-=o,a[19]=a[14]-o,a[14]+=o,o=a[10],a[11]-=o,a[10]=a[23]-o,a[23]+=o,o=a[11],a[26]-=o,a[11]=a[22]-o,a[22]+=o,o=a[26],a[27]-=o,a[26]=a[7]-o,a[7]+=o,o=a[27],a[27]=a[6]-o,a[6]+=o,o=n.SQRT2*(a[0]-a[4]),a[0]+=a[4],a[4]=o,o=n.SQRT2*(a[1]-a[5]),a[1]+=a[5],a[5]=o,o=n.SQRT2*(a[16]-a[20]),a[16]+=a[20],a[20]=o,o=n.SQRT2*(a[17]-a[21]),a[17]+=a[21],a[21]=o,o=-n.SQRT2*(a[8]-a[12]),a[8]+=a[12],a[12]=o-a[8],o=-n.SQRT2*(a[9]-a[13]),a[9]+=a[13],a[13]=o-a[9],o=-n.SQRT2*(a[25]-a[29]),a[25]+=a[29],a[29]=o-a[25],o=-n.SQRT2*(a[24]+a[28]),a[24]-=a[28],a[28]=o-a[24],o=a[24]-a[16],a[24]=o,o=a[20]-o,a[20]=o,o=a[28]-o,a[28]=o,o=a[25]-a[17],a[25]=o,o=a[21]-o,a[21]=o,o=a[29]-o,a[29]=o,o=a[17]-a[1],a[17]=o,o=a[9]-o,a[9]=o,o=a[25]-o,a[25]=o,o=a[5]-o,a[5]=o,o=a[21]-o,a[21]=o,o=a[13]-o,a[13]=o,o=a[29]-o,a[29]=o,o=a[1]-a[0],a[1]=o,o=a[16]-o,a[16]=o,o=a[17]-o,a[17]=o,o=a[8]-o,a[8]=o,o=a[9]-o,a[9]=o,o=a[24]-o,a[24]=o,o=a[25]-o,a[25]=o,o=a[4]-o,a[4]=o,o=a[5]-o,a[5]=o,o=a[20]-o,a[20]=o,o=a[21]-o,a[21]=o,o=a[12]-o,a[12]=o,o=a[13]-o,a[13]=o,o=a[28]-o,a[28]=o,o=a[29]-o,a[29]=o,o=a[0],a[0]+=a[31],a[31]-=o,o=a[1],a[1]+=a[30],a[30]-=o,o=a[16],a[16]+=a[15],a[15]-=o,o=a[17],a[17]+=a[14],a[14]-=o,o=a[8],a[8]+=a[23],a[23]-=o,o=a[9],a[9]+=a[22],a[22]-=o,o=a[24],a[24]+=a[7],a[7]-=o,o=a[25],a[25]+=a[6],a[6]-=o,o=a[4],a[4]+=a[27],a[27]-=o,o=a[5],a[5]+=a[26],a[26]-=o,o=a[20],a[20]+=a[11],a[11]-=o,o=a[21],a[21]+=a[10],a[10]-=o,o=a[12],a[12]+=a[19],a[19]-=o,o=a[13],a[13]+=a[18],a[18]-=o,o=a[28],a[28]+=a[3],a[3]-=o,o=a[29],a[29]+=a[2],a[2]-=o}function h(e,t){for(var n=0;n<3;n++){var r,a,o,l,_,c;a=(l=e[t+6]*s[i.SHORT_TYPE][0]-e[t+15])+(r=e[t+0]*s[i.SHORT_TYPE][2]-e[t+9]),o=l-r,_=(l=e[t+15]*s[i.SHORT_TYPE][0]+e[t+6])+(r=e[t+9]*s[i.SHORT_TYPE][2]+e[t+0]),c=-l+r,r=2069978111953089e-26*(e[t+3]*s[i.SHORT_TYPE][1]-e[t+12]),l=2069978111953089e-26*(e[t+12]*s[i.SHORT_TYPE][1]+e[t+3]),e[t+0]=190752519173728e-25*a+r,e[t+15]=190752519173728e-25*-_+l,o=.8660254037844387*o*1907525191737281e-26,_=.5*_*1907525191737281e-26+l,e[t+3]=o-_,e[t+6]=o+_,a=.5*a*1907525191737281e-26-r,c=.8660254037844387*c*1907525191737281e-26,e[t+9]=a+c,e[t+12]=a-c,t++}}function d(e,t,n){var r,a,i,s,o,_,c,f,u,h,d,p,m,b,v,g,w,y;i=n[17]-n[9],o=n[15]-n[11],_=n[14]-n[12],c=n[0]+n[8],f=n[1]+n[7],u=n[2]+n[6],h=n[3]+n[5],e[t+17]=c+u-h-(f-n[4]),a=(c+u-h)*l[19]+(f-n[4]),r=(i-o-_)*l[18],e[t+5]=r+a,e[t+6]=r-a,s=(n[16]-n[10])*l[18],f=f*l[19]+n[4],r=i*l[12]+s+o*l[13]+_*l[14],a=-c*l[16]+f-u*l[17]+h*l[15],e[t+1]=r+a,e[t+2]=r-a,r=i*l[13]-s-o*l[14]+_*l[12],a=-c*l[17]+f-u*l[15]+h*l[16],e[t+9]=r+a,e[t+10]=r-a,r=i*l[14]-s+o*l[12]-_*l[13],a=c*l[15]-f+u*l[16]-h*l[17],e[t+13]=r+a,e[t+14]=r-a,d=n[8]-n[0],m=n[6]-n[2],b=n[5]-n[3],v=n[17]+n[9],g=n[16]+n[10],w=n[15]+n[11],y=n[14]+n[12],e[t+0]=v+w+y+(g+n[13]),r=(v+w+y)*l[19]-(g+n[13]),a=(d-m+b)*l[18],e[t+11]=r+a,e[t+12]=r-a,p=(n[7]-n[1])*l[18],g=n[13]-g*l[19],r=v*l[15]-g+w*l[16]+y*l[17],a=d*l[14]+p+m*l[12]+b*l[13],e[t+3]=r+a,e[t+4]=r-a,r=-v*l[17]+g-w*l[15]-y*l[16],a=d*l[13]+p-m*l[14]-b*l[12],e[t+7]=r+a,e[t+8]=r-a,r=-v*l[16]+g-w*l[17]-y*l[15],a=d*l[12]-p+m*l[13]-b*l[14],e[t+15]=r+a,e[t+16]=r-a}this.mdct_sub48=function(e,n,l){for(var p=n,m=286,b=0;b<e.channels_out;b++){for(var v=0;v<e.mode_gr;v++){for(var g,w=e.l3_side.tt[v][b],y=w.xr,S=0,A=e.sb_sample[b][1-v],M=0,B=0;B<9;B++)for(u(p,m,A[M]),u(p,m+32,A[M+1]),M+=2,m+=64,g=1;g<32;g+=2)A[M-1][g]*=-1;for(g=0;g<32;g++,S+=18){var R=w.block_type,E=e.sb_sample[b][v],k=e.sb_sample[b][1-v];if(0!=w.mixed_block_flag&&g<2&&(R=0),e.amp_filter[g]<1e-12)r.fill(y,S+0,S+18,0);else{if(e.amp_filter[g]<1)for(B=0;B<18;B++)k[B][f[g]]*=e.amp_filter[g];if(R==i.SHORT_TYPE){for(B=-3;B<0;B++){var T=s[i.SHORT_TYPE][B+3];y[S+3*B+9]=E[9+B][f[g]]*T-E[8-B][f[g]],y[S+3*B+18]=E[14-B][f[g]]*T+E[15+B][f[g]],y[S+3*B+10]=E[15+B][f[g]]*T-E[14-B][f[g]],y[S+3*B+19]=k[2-B][f[g]]*T+k[3+B][f[g]],y[S+3*B+11]=k[3+B][f[g]]*T-k[2-B][f[g]],y[S+3*B+20]=k[8-B][f[g]]*T+k[9+B][f[g]]}h(y,S)}else{var x=a(18);for(B=-9;B<0;B++){var I,P;I=s[R][B+27]*k[B+9][f[g]]+s[R][B+36]*k[8-B][f[g]],P=s[R][B+9]*E[B+9][f[g]]-s[R][B+18]*E[8-B][f[g]],x[B+9]=I-P*o[3+B+9],x[B+18]=I*o[3+B+9]+P}d(y,S,x)}}if(R!=i.SHORT_TYPE&&0!=g)for(B=7;B>=0;--B){var O,V;O=y[S+B]*_[20+B]+y[S+-1-B]*c[28+B],V=y[S+B]*c[28+B]-y[S+-1-B]*_[20+B],y[S+-1-B]=O,y[S+B]=V}}}if(p=l,m=286,1==e.mode_gr)for(var L=0;L<18;L++)t.arraycopy(e.sb_sample[b][1][L],0,e.sb_sample[b][0][L],0,32)}}},Ot}(),_=function(){if(Dt)return Ht;Dt=1;var e=Wn();return Ht=function(){this.thm=new e,this.en=new e}}(),c=l.FFTOFFSET,f=l.MPG_MD_MS_LR,u=null;this.psy=null;var h=null,d=null,p=null;this.setModules=function(e,t,n,r){u=e,this.psy=t,h=t,d=r,p=n};var m=new e;this.lame_encode_mp3_frame=function(e,b,v,g,w,y){var S,A=r([2,2]);A[0][0]=new _,A[0][1]=new _,A[1][0]=new _,A[1][1]=new _;var M,B=r([2,2]);B[0][0]=new _,B[0][1]=new _,B[1][0]=new _,B[1][1]=new _;var R,E,k,T=[null,null],x=e.internal_flags,I=i([2,4]),P=[.5,.5],O=[[0,0],[0,0]],V=[[0,0],[0,0]];if(T[0]=b,T[1]=v,0==x.lame_encode_frame_init&&function(e,t){var n,r,i=e.internal_flags;if(0==i.lame_encode_frame_init){var s,_,c=a(2014),f=a(2014);for(i.lame_encode_frame_init=1,s=0,_=0;s<286+576*(1+i.mode_gr);++s)s<576*i.mode_gr?(c[s]=0,2==i.channels_out&&(f[s]=0)):(c[s]=t[0][_],2==i.channels_out&&(f[s]=t[1][_]),++_);for(r=0;r<i.mode_gr;r++)for(n=0;n<i.channels_out;n++)i.l3_side.tt[r][n].block_type=l.SHORT_TYPE;m.mdct_sub48(i,c,f),o(576>=l.FFTOFFSET),o(i.mf_size>=l.BLKSIZE+e.framesize-l.FFTOFFSET),o(i.mf_size>=512+e.framesize-32)}}(e,T),x.padding=0,(x.slot_lag-=x.frac_SpF)<0&&(x.slot_lag+=e.out_samplerate,x.padding=1),0!=x.psymodel){var L=[null,null],N=0,H=s(2);for(k=0;k<x.mode_gr;k++){for(E=0;E<x.channels_out;E++)L[E]=T[E],N=576+576*k-l.FFTOFFSET;if(0!=(e.VBR==n.vbr_mtrh||e.VBR==n.vbr_mt?h.L3psycho_anal_vbr(e,L,N,k,A,B,O[k],V[k],I[k],H):h.L3psycho_anal_ns(e,L,N,k,A,B,O[k],V[k],I[k],H)))return-4;for(e.mode==MPEGMode.JOINT_STEREO&&(P[k]=I[k][2]+I[k][3],P[k]>0&&(P[k]=I[k][3]/P[k])),E=0;E<x.channels_out;E++){var D=x.l3_side.tt[k][E];D.block_type=H[E],D.mixed_block_flag=0}}}else for(k=0;k<x.mode_gr;k++)for(E=0;E<x.channels_out;E++)x.l3_side.tt[k][E].block_type=l.NORM_TYPE,x.l3_side.tt[k][E].mixed_block_flag=0,V[k][E]=O[k][E]=700;if(function(e){var t,n;if(0!=e.ATH.useAdjust)if(n=e.loudness_sq[0][0],t=e.loudness_sq[1][0],2==e.channels_out?(n+=e.loudness_sq[0][1],t+=e.loudness_sq[1][1]):(n+=n,t+=t),2==e.mode_gr&&(n=Math.max(n,t)),n*=.5,(n*=e.ATH.aaSensitivityP)>.03125)e.ATH.adjust>=1?e.ATH.adjust=1:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=1;else{var r=31.98*n+625e-6;e.ATH.adjust>=r?(e.ATH.adjust*=.075*r+.925,e.ATH.adjust<r&&(e.ATH.adjust=r)):e.ATH.adjustLimit>=r?e.ATH.adjust=r:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=r}else e.ATH.adjust=1}(x),m.mdct_sub48(x,T[0],T[1]),x.mode_ext=l.MPG_MD_LR_LR,e.force_ms)x.mode_ext=l.MPG_MD_MS_LR;else if(e.mode==MPEGMode.JOINT_STEREO){var C=0,F=0;for(k=0;k<x.mode_gr;k++)for(E=0;E<x.channels_out;E++)C+=V[k][E],F+=O[k][E];if(C<=1*F){var j=x.l3_side.tt[0],X=x.l3_side.tt[x.mode_gr-1];j[0].block_type==j[1].block_type&&X[0].block_type==X[1].block_type&&(x.mode_ext=l.MPG_MD_MS_LR)}}if(x.mode_ext==f?(M=B,R=V):(M=A,R=O),e.analysis&&null!=x.pinfo)for(k=0;k<x.mode_gr;k++)for(E=0;E<x.channels_out;E++)x.pinfo.ms_ratio[k]=x.ms_ratio[k],x.pinfo.ms_ener_ratio[k]=P[k],x.pinfo.blocktype[k][E]=x.l3_side.tt[k][E].block_type,x.pinfo.pe[k][E]=R[k][E],t.arraycopy(x.l3_side.tt[k][E].xr,0,x.pinfo.xr[k][E],0,576),x.mode_ext==f&&(x.pinfo.ers[k][E]=x.pinfo.ers[k][E+2],t.arraycopy(x.pinfo.energy[k][E+2],0,x.pinfo.energy[k][E],0,x.pinfo.energy[k][E].length));if(e.VBR==n.vbr_off||e.VBR==n.vbr_abr){var q,Y;for(q=0;q<18;q++)x.nsPsy.pefirbuf[q]=x.nsPsy.pefirbuf[q+1];for(Y=0,k=0;k<x.mode_gr;k++)for(E=0;E<x.channels_out;E++)Y+=R[k][E];for(x.nsPsy.pefirbuf[18]=Y,Y=x.nsPsy.pefirbuf[9],q=0;q<9;q++)Y+=(x.nsPsy.pefirbuf[q]+x.nsPsy.pefirbuf[18-q])*l.fircoef[q];for(Y=3350*x.mode_gr*x.channels_out/Y,k=0;k<x.mode_gr;k++)for(E=0;E<x.channels_out;E++)R[k][E]*=Y}if(x.iteration_loop.iteration_loop(e,R,P,M),u.format_bitstream(e),S=u.copy_buffer(x,g,w,y,1),e.bWriteVbrTag&&d.addVbrFrame(e),e.analysis&&null!=x.pinfo){for(E=0;E<x.channels_out;E++){var G;for(G=0;G<c;G++)x.pinfo.pcmdata[E][G]=x.pinfo.pcmdata[E][G+e.framesize];for(G=c;G<1600;G++)x.pinfo.pcmdata[E][G]=T[E][G-c]}p.set_frame_pinfo(e,M)}return function(e){var t,n;for(o(0<=e.bitrate_index&&e.bitrate_index<16),o(0<=e.mode_ext&&e.mode_ext<4),e.bitrate_stereoMode_Hist[e.bitrate_index][4]++,e.bitrate_stereoMode_Hist[15][4]++,2==e.channels_out&&(e.bitrate_stereoMode_Hist[e.bitrate_index][e.mode_ext]++,e.bitrate_stereoMode_Hist[15][e.mode_ext]++),t=0;t<e.mode_gr;++t)for(n=0;n<e.channels_out;++n){var r=0|e.l3_side.tt[t][n].block_type;0!=e.l3_side.tt[t][n].mixed_block_flag&&(r=4),e.bitrate_blockType_Hist[e.bitrate_index][r]++,e.bitrate_blockType_Hist[e.bitrate_index][5]++,e.bitrate_blockType_Hist[15][r]++,e.bitrate_blockType_Hist[15][5]++}}(x),S}}return l.ENCDELAY=576,l.POSTDELAY=1152,l.MDCTDELAY=48,l.FFTOFFSET=224+l.MDCTDELAY,l.DECDELAY=528,l.SBLIMIT=32,l.CBANDS=64,l.SBPSY_l=21,l.SBPSY_s=12,l.SBMAX_l=22,l.SBMAX_s=13,l.PSFB21=6,l.PSFB12=6,l.BLKSIZE=1024,l.HBLKSIZE=l.BLKSIZE/2+1,l.BLKSIZE_s=256,l.HBLKSIZE_s=l.BLKSIZE_s/2+1,l.NORM_TYPE=0,l.START_TYPE=1,l.SHORT_TYPE=2,l.STOP_TYPE=3,l.MPG_MD_LR_LR=0,l.MPG_MD_LR_I=1,l.MPG_MD_MS_LR=2,l.MPG_MD_MS_I=3,l.fircoef=[-.1039435,-.1892065,5*-.0432472,-.155915,3898045e-23,.0467745*5,.50455,.756825,.187098*5],Ct=l}function $n(){if(Yt)return qt;Yt=1;var e=Zn();e.System;var t=e.VbrMode,n=e.Float,r=e.ShortBlock,a=e.Util,i=e.Arrays;e.new_array_n,e.new_byte,e.new_double;var s=e.new_float,o=e.new_float_n,l=e.new_int;e.new_int_n;var _=e.assert,c=function(){if(Xt)return jt;Xt=1;var e=Zn();e.System,e.VbrMode,e.Float,e.ShortBlock;var t=e.Util;e.Arrays,e.new_array_n,e.new_byte,e.new_double;var n=e.new_float;e.new_float_n,e.new_int,e.new_int_n,e.assert;var r=Qn();return jt=function(){var e=n(r.BLKSIZE),a=n(r.BLKSIZE_s/2),i=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function s(e,n,r){var a,s,o,l=0,_=n+(r<<=1);a=4;do{var c,f,u,h,d,p,m;m=a>>1,p=(d=a<<1)+(h=a),a=d<<1,o=(s=n)+m;do{A=e[s+0]-e[s+h],S=e[s+0]+e[s+h],E=e[s+d]-e[s+p],B=e[s+d]+e[s+p],e[s+d]=S-B,e[s+0]=S+B,e[s+p]=A-E,e[s+h]=A+E,A=e[o+0]-e[o+h],S=e[o+0]+e[o+h],E=t.SQRT2*e[o+p],B=t.SQRT2*e[o+d],e[o+d]=S-B,e[o+0]=S+B,e[o+p]=A-E,e[o+h]=A+E,o+=a,s+=a}while(s<_);for(f=i[l+0],c=i[l+1],u=1;u<m;u++){var b,v;b=1-2*c*c,v=2*c*f,s=n+u,o=n+h-u;do{var g,w,y,S,A,M,B,R,E,k;w=v*e[s+h]-b*e[o+h],g=b*e[s+h]+v*e[o+h],A=e[s+0]-g,S=e[s+0]+g,M=e[o+0]-w,y=e[o+0]+w,w=v*e[s+p]-b*e[o+p],g=b*e[s+p]+v*e[o+p],E=e[s+d]-g,B=e[s+d]+g,k=e[o+d]-w,R=e[o+d]+w,w=c*B-f*k,g=f*B+c*k,e[s+d]=S-g,e[s+0]=S+g,e[o+p]=M-w,e[o+h]=M+w,w=f*R-c*E,g=c*R+f*E,e[o+d]=y-g,e[o+0]=y+g,e[s+p]=A-w,e[s+h]=A+w,o+=a,s+=a}while(s<_);f=(b=f)*i[l+0]-c*i[l+1],c=b*i[l+1]+c*i[l+0]}l+=2}while(a<r)}var o=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(e,t,n,i,l){for(var _=0;_<3;_++){var c=r.BLKSIZE_s/2,f=65535&192*(_+1),u=r.BLKSIZE_s/8-1;do{var h,d,p,m,b,v=255&o[u<<2];d=(h=a[v]*i[n][l+v+f])-(b=a[127-v]*i[n][l+v+f+128]),h+=b,m=(p=a[v+64]*i[n][l+v+f+64])-(b=a[63-v]*i[n][l+v+f+192]),p+=b,c-=4,t[_][c+0]=h+p,t[_][c+2]=h-p,t[_][c+1]=d+m,t[_][c+3]=d-m,d=(h=a[v+1]*i[n][l+v+f+1])-(b=a[126-v]*i[n][l+v+f+129]),h+=b,m=(p=a[v+65]*i[n][l+v+f+65])-(b=a[62-v]*i[n][l+v+f+193]),p+=b,t[_][c+r.BLKSIZE_s/2+0]=h+p,t[_][c+r.BLKSIZE_s/2+2]=h-p,t[_][c+r.BLKSIZE_s/2+1]=d+m,t[_][c+r.BLKSIZE_s/2+3]=d-m}while(--u>=0);s(t[_],c,r.BLKSIZE_s/2)}},this.fft_long=function(t,n,a,i,l){var _=r.BLKSIZE/8-1,c=r.BLKSIZE/2;do{var f,u,h,d,p,m=255&o[_];u=(f=e[m]*i[a][l+m])-(p=e[m+512]*i[a][l+m+512]),f+=p,d=(h=e[m+256]*i[a][l+m+256])-(p=e[m+768]*i[a][l+m+768]),h+=p,n[0+(c-=4)]=f+h,n[c+2]=f-h,n[c+1]=u+d,n[c+3]=u-d,u=(f=e[m+1]*i[a][l+m+1])-(p=e[m+513]*i[a][l+m+513]),f+=p,d=(h=e[m+257]*i[a][l+m+257])-(p=e[m+769]*i[a][l+m+769]),h+=p,n[c+r.BLKSIZE/2+0]=f+h,n[c+r.BLKSIZE/2+2]=f-h,n[c+r.BLKSIZE/2+1]=u+d,n[c+r.BLKSIZE/2+3]=u-d}while(--_>=0);s(n,c,r.BLKSIZE/2)},this.init_fft=function(t){for(var n=0;n<r.BLKSIZE;n++)e[n]=.42-.5*Math.cos(2*Math.PI*(n+.5)/r.BLKSIZE)+.08*Math.cos(4*Math.PI*(n+.5)/r.BLKSIZE);for(n=0;n<r.BLKSIZE_s/2;n++)a[n]=.5*(1-Math.cos(2*Math.PI*(n+.5)/r.BLKSIZE_s))}},jt}(),f=Qn();return qt=function(){var e=new c,u=2.302585092994046,h=1/217621504/(f.BLKSIZE/2),d=.3,p=21,m=.2302585093;function b(e,t){for(var n=0,r=0;r<f.BLKSIZE/2;++r)n+=e[r]*t.ATH.eql_w[r];return n*=h}function v(t,n,r,i,s,o,l,_,c,u,h){var d=t.internal_flags;if(c<2)e.fft_long(d,i[s],c,u,h),e.fft_short(d,o[l],c,u,h);else if(2==c){for(var p=f.BLKSIZE-1;p>=0;--p){var m=i[s+0][p],v=i[s+1][p];i[s+0][p]=(m+v)*a.SQRT2*.5,i[s+1][p]=(m-v)*a.SQRT2*.5}for(var g=2;g>=0;--g)for(p=f.BLKSIZE_s-1;p>=0;--p){m=o[l+0][g][p],v=o[l+1][g][p];o[l+0][g][p]=(m+v)*a.SQRT2*.5,o[l+1][g][p]=(m-v)*a.SQRT2*.5}}n[0]=i[s+0][0],n[0]*=n[0];for(p=f.BLKSIZE/2-1;p>=0;--p){var w=i[s+0][f.BLKSIZE/2-p],y=i[s+0][f.BLKSIZE/2+p];n[f.BLKSIZE/2-p]=.5*(w*w+y*y)}for(g=2;g>=0;--g){r[g][0]=o[l+0][g][0],r[g][0]*=r[g][0];for(p=f.BLKSIZE_s/2-1;p>=0;--p){w=o[l+0][g][f.BLKSIZE_s/2-p],y=o[l+0][g][f.BLKSIZE_s/2+p];r[g][f.BLKSIZE_s/2-p]=.5*(w*w+y*y)}}var S=0;for(p=11;p<f.HBLKSIZE;p++)S+=n[p];if(d.tot_ener[c]=S,t.analysis){for(p=0;p<f.HBLKSIZE;p++)d.pinfo.energy[_][c][p]=d.pinfo.energy_save[c][p],d.pinfo.energy_save[c][p]=n[p];d.pinfo.pe[_][c]=d.pe[c]}2==t.athaa_loudapprox&&c<2&&(d.loudness_sq[_][c]=d.loudness_sq_save[c],d.loudness_sq_save[c]=b(n,d))}var g,w,y,S=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749],A=[3.3246*3.3246,3.23837*3.23837,9.9500500969,9.0247369744,8.1854926609,7.0440875649,2.46209*2.46209,2.284*2.284,4.4892710641,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,2.4621061921,2.1508568964,1.37074*1.37074,1.31036*1.31036,1.5691069696,1.4555939904,1.16203*1.16203,1.2715945225,1.09428*1.09428,1.0659*1.0659,1.0779838276,1.0382591025,1],M=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],B=[5.5396212496,2.29259*2.29259,4.9868695969,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,2.2499700001,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.2339655056,1.0779838276];function R(e,t,n,r,i,s){var o;if(t>e){if(!(t<e*w))return e+t;o=t/e}else{if(e>=t*w)return e+t;o=e/t}if(_(e>=0),_(t>=0),e+=t,r+3<=6){if(o>=g)return e;var l=0|a.FAST_LOG10_X(o,16);return e*M[l]}var c,f;l=0|a.FAST_LOG10_X(o,16);return t=i.ATH.cb_l[n]*i.ATH.adjust,_(t>=0),e<y*t?e>t?(c=1,l<=13&&(c=B[l]),f=a.FAST_LOG10_X(e/t,10/15),e*((A[l]-c)*f+c)):l>13?e:e*B[l]:e*A[l]}var E=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1];function k(e,t,n){var r;if(e<0&&(e=0),t<0&&(t=0),e<=0)return t;if(t<=0)return e;if(r=t>e?t/e:e/t,-2<=n&&n<=2){if(r>=g)return e+t;var i=0|a.FAST_LOG10_X(r,16);return(e+t)*E[i]}return r<w?e+t:(e<t&&(e=t),e)}function T(e,t,n,r,a){var i,s,o=0,l=0;for(i=s=0;i<f.SBMAX_s;++s,++i){for(var c=e.bo_s[i],u=e.npart_s,h=c<u?c:u;s<h;)_(t[s]>=0),_(n[s]>=0),o+=t[s],l+=n[s],s++;if(e.en[r].s[i][a]=o,e.thm[r].s[i][a]=l,s>=u){++i;break}_(t[s]>=0),_(n[s]>=0);var d=e.PSY.bo_s_weight[i],p=1-d;o=d*t[s],l=d*n[s],e.en[r].s[i][a]+=o,e.thm[r].s[i][a]+=l,o=p*t[s],l=p*n[s]}for(;i<f.SBMAX_s;++i)e.en[r].s[i][a]=0,e.thm[r].s[i][a]=0}function x(e,t,n,r){var a,i,s=0,o=0;for(a=i=0;a<f.SBMAX_l;++i,++a){for(var l=e.bo_l[a],c=e.npart_l,u=l<c?l:c;i<u;)_(t[i]>=0),_(n[i]>=0),s+=t[i],o+=n[i],i++;if(e.en[r].l[a]=s,e.thm[r].l[a]=o,i>=c){++a;break}_(t[i]>=0),_(n[i]>=0);var h=e.PSY.bo_l_weight[a],d=1-h;s=h*t[i],o=h*n[i],e.en[r].l[a]+=s,e.thm[r].l[a]+=o,s=d*t[i],o=d*n[i]}for(;a<f.SBMAX_l;++a)e.en[r].l[a]=0,e.thm[r].l[a]=0}function I(e,t,n,r,a,i){var s,o,l=e.internal_flags;for(o=s=0;o<l.npart_s;++o){for(var c=0,u=l.numlines_s[o],h=0;h<u;++h,++s){c+=t[i][s]}n[o]=c}for(_(o==l.npart_s),_(129==s),s=o=0;o<l.npart_s;o++){var d=l.s3ind_s[o][0],p=l.s3_ss[s++]*n[d];for(++d;d<=l.s3ind_s[o][1];)p+=l.s3_ss[s]*n[d],++s,++d;var m=2*l.nb_s1[a][o];if(r[o]=Math.min(p,m),l.blocktype_old[1&a]==f.SHORT_TYPE){m=16*l.nb_s2[a][o];var b=r[o];r[o]=Math.min(m,b)}l.nb_s2[a][o]=l.nb_s1[a][o],l.nb_s1[a][o]=p,_(r[o]>=0)}for(;o<=f.CBANDS;++o)n[o]=0,r[o]=0}function P(e,t,n){return n>=1?e:n<=0?t:t>0?Math.pow(e/t,n)*t:0}var O=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function V(e,t){for(var n=309.07,r=0;r<f.SBMAX_s-1;r++)for(var i=0;i<3;i++){var s=e.thm.s[r][i];if(_(r<O.length),s>0){var o=s*t,l=e.en.s[r][i];l>o&&(l>1e10*o?n+=O[r]*(10*u):(_(o>0),n+=O[r]*a.FAST_LOG10(l/o)))}}return n}var L=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function N(e,t){for(var n=281.0575,r=0;r<f.SBMAX_l-1;r++){var i=e.thm.l[r];if(_(r<L.length),i>0){var s=i*t,o=e.en.l[r];o>s&&(o>1e10*s?n+=L[r]*(10*u):(_(s>0),n+=L[r]*a.FAST_LOG10(o/s)))}}return n}function H(e,t,n,r,a){var i,s;for(i=s=0;i<e.npart_l;++i){var o,l=0,c=0;for(o=0;o<e.numlines_l[i];++o,++s){var f=t[s];_(f>=0),l+=f,c<f&&(c=f)}n[i]=l,r[i]=c,a[i]=l*e.rnumlines_l[i],_(e.rnumlines_l[i]>=0),_(l>=0),_(n[i]>=0),_(r[i]>=0),_(a[i]>=0)}}function D(e,t,n,r){var a=S.length-1,i=0,s=n[i]+n[i+1];(_(s>=0),s>0)?((o=t[i])<t[i+1]&&(o=t[i+1]),_(e.numlines_l[i]+e.numlines_l[i+1]-1>0),(l=0|(s=20*(2*o-s)/(s*(e.numlines_l[i]+e.numlines_l[i+1]-1))))>a&&(l=a),r[i]=l):r[i]=0;for(i=1;i<e.npart_l-1;i++){var o,l;if(s=n[i-1]+n[i]+n[i+1],_(s>=0),s>0)(o=t[i-1])<t[i]&&(o=t[i]),o<t[i+1]&&(o=t[i+1]),_(e.numlines_l[i-1]+e.numlines_l[i]+e.numlines_l[i+1]-1>0),(l=0|(s=20*(3*o-s)/(s*(e.numlines_l[i-1]+e.numlines_l[i]+e.numlines_l[i+1]-1))))>a&&(l=a),r[i]=l;else r[i]=0}(_(i>0),_(i==e.npart_l-1),s=n[i-1]+n[i],_(s>=0),s>0)?((o=t[i-1])<t[i]&&(o=t[i]),_(e.numlines_l[i-1]+e.numlines_l[i]-1>0),(l=0|(s=20*(2*o-s)/(s*(e.numlines_l[i-1]+e.numlines_l[i]-1))))>a&&(l=a),r[i]=l):r[i]=0;_(i==e.npart_l-1)}var C=[-1730326e-23,-.01703172,-1349528e-23,.0418072,-673278e-22,-.0876324,-30835e-21,.1863476,-1104424e-22,-.627638];function F(t,n,r,i,s,o,l,_){var c=t.internal_flags;if(i<2)e.fft_long(c,l[_],i,n,r);else if(2==i)for(var u=f.BLKSIZE-1;u>=0;--u){var h=l[_+0][u],d=l[_+1][u];l[_+0][u]=(h+d)*a.SQRT2*.5,l[_+1][u]=(h-d)*a.SQRT2*.5}o[0]=l[_+0][0],o[0]*=o[0];for(u=f.BLKSIZE/2-1;u>=0;--u){var p=l[_+0][f.BLKSIZE/2-u],m=l[_+0][f.BLKSIZE/2+u];o[f.BLKSIZE/2-u]=.5*(p*p+m*m)}var b=0;for(u=11;u<f.HBLKSIZE;u++)b+=o[u];if(c.tot_ener[i]=b,t.analysis){for(u=0;u<f.HBLKSIZE;u++)c.pinfo.energy[s][i][u]=c.pinfo.energy_save[i][u],c.pinfo.energy_save[i][u]=o[u];c.pinfo.pe[s][i]=c.pe[i]}}function j(t,n,r,i,s,o,l,_){var c=t.internal_flags;if(0==s&&i<2&&e.fft_short(c,l[_],i,n,r),2==i)for(var u=f.BLKSIZE_s-1;u>=0;--u){var h=l[_+0][s][u],d=l[_+1][s][u];l[_+0][s][u]=(h+d)*a.SQRT2*.5,l[_+1][s][u]=(h-d)*a.SQRT2*.5}o[s][0]=l[_+0][s][0],o[s][0]*=o[s][0];for(u=f.BLKSIZE_s/2-1;u>=0;--u){var p=l[_+0][s][f.BLKSIZE_s/2-u],m=l[_+0][s][f.BLKSIZE_s/2+u];o[s][f.BLKSIZE_s/2-u]=.5*(p*p+m*m)}}function X(e,t,n,r){var a=e.internal_flags;2==e.athaa_loudapprox&&n<2&&(a.loudness_sq[t][n]=a.loudness_sq_save[n],a.loudness_sq_save[n]=b(r,a))}this.L3psycho_anal_ns=function(e,n,a,c,u,h,m,b,g,w){var y,A,M,B,E,k,O,L,F,j,X=e.internal_flags,q=o([2,f.BLKSIZE]),Y=o([2,3,f.BLKSIZE_s]),G=s(f.CBANDS+1),U=s(f.CBANDS+1),K=s(f.CBANDS+2),z=l(2),Z=l(2),W=o([2,576]),Q=l(f.CBANDS+2),$=l(f.CBANDS+2);for(i.fill($,0),y=X.channels_out,e.mode==MPEGMode.JOINT_STEREO&&(y=4),F=e.VBR==t.vbr_off?0==X.ResvMax?0:X.ResvSize/X.ResvMax*.5:e.VBR==t.vbr_rh||e.VBR==t.vbr_mtrh||e.VBR==t.vbr_mt?.6:1,A=0;A<X.channels_out;A++){var J=n[A],ee=a+576-350-p+192;for(_(10==C.length),B=0;B<576;B++){var te,ne;for(te=J[ee+B+10],ne=0,E=0;E<9;E+=2)te+=C[E]*(J[ee+B+E]+J[ee+B+p-E]),ne+=C[E+1]*(J[ee+B+E+1]+J[ee+B+p-E-1]);W[A][B]=te+ne}u[c][A].en.assign(X.en[A]),u[c][A].thm.assign(X.thm[A]),y>2&&(h[c][A].en.assign(X.en[A+2]),h[c][A].thm.assign(X.thm[A+2]))}for(A=0;A<y;A++){var re,ae=s(12),ie=[0,0,0,0],se=s(12),oe=1,le=s(f.CBANDS),_e=s(f.CBANDS),ce=[0,0,0,0],fe=s(f.HBLKSIZE),ue=o([3,f.HBLKSIZE_s]);for(_(X.npart_s<=f.CBANDS),_(X.npart_l<=f.CBANDS),B=0;B<3;B++)ae[B]=X.nsPsy.last_en_subshort[A][B+6],_(X.nsPsy.last_en_subshort[A][B+4]>0),se[B]=ae[B]/X.nsPsy.last_en_subshort[A][B+4],ie[0]+=ae[B];if(2==A)for(B=0;B<576;B++){var he,de;he=W[0][B],de=W[1][B],W[0][B]=he+de,W[1][B]=he-de}var pe=W[1&A],me=0;for(B=0;B<9;B++){for(var be=me+64,ve=1;me<be;me++)ve<Math.abs(pe[me])&&(ve=Math.abs(pe[me]));X.nsPsy.last_en_subshort[A][B]=ae[B+3]=ve,ie[1+B/3]+=ve,ve>ae[B+3-2]?(_(ae[B+3-2]>0),ve/=ae[B+3-2]):ae[B+3-2]>10*ve?(_(ve>0),ve=ae[B+3-2]/(10*ve)):ve=0,se[B+3]=ve}if(e.analysis){var ge=se[0];for(B=1;B<12;B++)ge<se[B]&&(ge=se[B]);X.pinfo.ers[c][A]=X.pinfo.ers_save[A],X.pinfo.ers_save[A]=ge}for(re=3==A?X.nsPsy.attackthre_s:X.nsPsy.attackthre,B=0;B<12;B++)0==ce[B/3]&&se[B]>re&&(ce[B/3]=B%3+1);for(B=1;B<4;B++){var we;ie[B-1]>ie[B]?(_(ie[B]>0),we=ie[B-1]/ie[B]):(_(ie[B-1]>0),we=ie[B]/ie[B-1]),we<1.7&&(ce[B]=0,1==B&&(ce[0]=0))}for(0!=ce[0]&&0!=X.nsPsy.lastAttacks[A]&&(ce[0]=0),3!=X.nsPsy.lastAttacks[A]&&ce[0]+ce[1]+ce[2]+ce[3]==0||(oe=0,0!=ce[1]&&0!=ce[0]&&(ce[1]=0),0!=ce[2]&&0!=ce[1]&&(ce[2]=0),0!=ce[3]&&0!=ce[2]&&(ce[3]=0)),A<2?Z[A]=oe:0==oe&&(Z[0]=Z[1]=0),g[A]=X.tot_ener[A],v(e,fe,ue,q,1&A,Y,1&A,c,A,n,a),H(X,fe,G,le,_e),D(X,le,_e,Q),L=0;L<3;L++){var ye,Se;for(I(e,ue,U,K,A,L),T(X,U,K,A,L),O=0;O<f.SBMAX_s;O++){if(Se=X.thm[A].s[O][L],Se*=.8,ce[L]>=2||1==ce[L+1]){var Ae=0!=L?L-1:2;ve=P(X.thm[A].s[O][Ae],Se,.6*F);Se=Math.min(Se,ve)}if(1==ce[L]){Ae=0!=L?L-1:2,ve=P(X.thm[A].s[O][Ae],Se,d*F);Se=Math.min(Se,ve)}else if(0!=L&&3==ce[L-1]||0==L&&3==X.nsPsy.lastAttacks[A]){Ae=2!=L?L+1:0,ve=P(X.thm[A].s[O][Ae],Se,d*F);Se=Math.min(Se,ve)}ye=ae[3*L+3]+ae[3*L+4]+ae[3*L+5],6*ae[3*L+5]<ye&&(Se*=.5,6*ae[3*L+4]<ye&&(Se*=.5)),X.thm[A].s[O][L]=Se}}for(X.nsPsy.lastAttacks[A]=ce[2],k=0,M=0;M<X.npart_l;M++){for(var Me=X.s3ind[M][0],Be=G[Me]*S[Q[Me]],Re=X.s3_ll[k++]*Be;++Me<=X.s3ind[M][1];)Be=G[Me]*S[Q[Me]],Re=R(Re,X.s3_ll[k++]*Be,Me,Me-M,X);Re*=.158489319246111,X.blocktype_old[1&A]==f.SHORT_TYPE?K[M]=Re:K[M]=P(Math.min(Re,Math.min(2*X.nb_1[A][M],16*X.nb_2[A][M])),Re,F),X.nb_2[A][M]=X.nb_1[A][M],X.nb_1[A][M]=Re}for(;M<=f.CBANDS;++M)G[M]=0,K[M]=0;x(X,G,K,A)}(e.mode!=MPEGMode.STEREO&&e.mode!=MPEGMode.JOINT_STEREO||e.interChRatio>0&&function(e,t){var n=e.internal_flags;if(n.channels_out>1){for(var r=0;r<f.SBMAX_l;r++){var a=n.thm[0].l[r],i=n.thm[1].l[r];n.thm[0].l[r]+=i*t,n.thm[1].l[r]+=a*t}for(r=0;r<f.SBMAX_s;r++)for(var s=0;s<3;s++)a=n.thm[0].s[r][s],i=n.thm[1].s[r][s],n.thm[0].s[r][s]+=i*t,n.thm[1].s[r][s]+=a*t}}(e,e.interChRatio),e.mode==MPEGMode.JOINT_STEREO)&&(!function(e){for(var t=0;t<f.SBMAX_l;t++)if(!(e.thm[0].l[t]>1.58*e.thm[1].l[t]||e.thm[1].l[t]>1.58*e.thm[0].l[t])){var n=e.mld_l[t]*e.en[3].l[t],r=Math.max(e.thm[2].l[t],Math.min(e.thm[3].l[t],n));n=e.mld_l[t]*e.en[2].l[t];var a=Math.max(e.thm[3].l[t],Math.min(e.thm[2].l[t],n));e.thm[2].l[t]=r,e.thm[3].l[t]=a}for(t=0;t<f.SBMAX_s;t++)for(var i=0;i<3;i++)e.thm[0].s[t][i]>1.58*e.thm[1].s[t][i]||e.thm[1].s[t][i]>1.58*e.thm[0].s[t][i]||(n=e.mld_s[t]*e.en[3].s[t][i],r=Math.max(e.thm[2].s[t][i],Math.min(e.thm[3].s[t][i],n)),n=e.mld_s[t]*e.en[2].s[t][i],a=Math.max(e.thm[3].s[t][i],Math.min(e.thm[2].s[t][i],n)),e.thm[2].s[t][i]=r,e.thm[3].s[t][i]=a)}(X),j=e.msfix,Math.abs(j)>0&&function(e,t,n){var r=t,a=Math.pow(10,n);t*=2,r*=2;for(var i=0;i<f.SBMAX_l;i++)u=e.ATH.cb_l[e.bm_l[i]]*a,(o=Math.min(Math.max(e.thm[0].l[i],u),Math.max(e.thm[1].l[i],u)))*t<(l=Math.max(e.thm[2].l[i],u))+(c=Math.max(e.thm[3].l[i],u))&&_((l*=h=o*r/(l+c))+(c*=h)>0),e.thm[2].l[i]=Math.min(l,e.thm[2].l[i]),e.thm[3].l[i]=Math.min(c,e.thm[3].l[i]);for(a*=f.BLKSIZE_s/f.BLKSIZE,i=0;i<f.SBMAX_s;i++)for(var s=0;s<3;s++){var o,l,c,u,h;u=e.ATH.cb_s[e.bm_s[i]]*a,(o=Math.min(Math.max(e.thm[0].s[i][s],u),Math.max(e.thm[1].s[i][s],u)))*t<(l=Math.max(e.thm[2].s[i][s],u))+(c=Math.max(e.thm[3].s[i][s],u))&&_((l*=h=o*t/(l+c))+(c*=h)>0),e.thm[2].s[i][s]=Math.min(e.thm[2].s[i][s],l),e.thm[3].s[i][s]=Math.min(e.thm[3].s[i][s],c)}}(X,j,e.ATHlower*X.ATH.adjust));for(function(e,t,n,a){var i=e.internal_flags;e.short_blocks!=r.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var s=0;s<i.channels_out;s++)a[s]=f.NORM_TYPE,e.short_blocks==r.short_block_dispensed&&(t[s]=1),e.short_blocks==r.short_block_forced&&(t[s]=0),0!=t[s]?(_(i.blocktype_old[s]!=f.START_TYPE),i.blocktype_old[s]==f.SHORT_TYPE&&(a[s]=f.STOP_TYPE)):(a[s]=f.SHORT_TYPE,i.blocktype_old[s]==f.NORM_TYPE&&(i.blocktype_old[s]=f.START_TYPE),i.blocktype_old[s]==f.STOP_TYPE&&(i.blocktype_old[s]=f.SHORT_TYPE)),n[s]=i.blocktype_old[s],i.blocktype_old[s]=a[s]}(e,Z,w,z),A=0;A<y;A++){var Ee,ke,Te,xe=0;A>1?(Ee=b,xe=-2,ke=f.NORM_TYPE,w[0]!=f.SHORT_TYPE&&w[1]!=f.SHORT_TYPE||(ke=f.SHORT_TYPE),Te=h[c][A-2]):(Ee=m,xe=0,ke=w[A],Te=u[c][A]),ke==f.SHORT_TYPE?Ee[xe+A]=V(Te,X.masking_lower):Ee[xe+A]=N(Te,X.masking_lower),e.analysis&&(X.pinfo.pe[c][A]=Ee[xe+A])}return 0};var q=[-1730326e-23,-.01703172,-1349528e-23,.0418072,-673278e-22,-.0876324,-30835e-21,.1863476,-1104424e-22,-.627638];function Y(e,t,n){if(0==n)for(var r=0;r<e.npart_s;r++)e.nb_s2[t][r]=e.nb_s1[t][r],e.nb_s1[t][r]=0}function G(e,t){for(var n=0;n<e.npart_l;n++)e.nb_2[t][n]=e.nb_1[t][n],e.nb_1[t][n]=0}function U(e,t,n,r,a,i){var o,l,c,u=e.internal_flags,h=new float[f.CBANDS],d=s(f.CBANDS),p=new int[f.CBANDS];for(c=l=0;c<u.npart_s;++c){var m=0,b=0,v=u.numlines_s[c];for(o=0;o<v;++o,++l){var g=t[i][l];m+=g,b<g&&(b=g)}n[c]=m,_(m>=0),h[c]=b,_(v>0),d[c]=m/v,_(d[c]>=0)}for(_(c==u.npart_s),_(129==l);c<f.CBANDS;++c)h[c]=0,d[c]=0;for(function(e,t,n,r){var a=S.length-1,i=0,s=n[i]+n[i+1];for(_(s>=0),s>0?((o=t[i])<t[i+1]&&(o=t[i+1]),_(e.numlines_s[i]+e.numlines_s[i+1]-1>0),(l=0|(s=20*(2*o-s)/(s*(e.numlines_s[i]+e.numlines_s[i+1]-1))))>a&&(l=a),r[i]=l):r[i]=0,i=1;i<e.npart_s-1;i++){var o,l;s=n[i-1]+n[i]+n[i+1],_(i+1<e.npart_s),_(s>=0),s>0?((o=t[i-1])<t[i]&&(o=t[i]),o<t[i+1]&&(o=t[i+1]),_(e.numlines_s[i-1]+e.numlines_s[i]+e.numlines_s[i+1]-1>0),(l=0|(s=20*(3*o-s)/(s*(e.numlines_s[i-1]+e.numlines_s[i]+e.numlines_s[i+1]-1))))>a&&(l=a),r[i]=l):r[i]=0}_(i>0),_(i==e.npart_s-1),s=n[i-1]+n[i],_(s>=0),s>0?((o=t[i-1])<t[i]&&(o=t[i]),_(e.numlines_s[i-1]+e.numlines_s[i]-1>0),(l=0|(s=20*(2*o-s)/(s*(e.numlines_s[i-1]+e.numlines_s[i]-1))))>a&&(l=a),r[i]=l):r[i]=0,_(i==e.npart_s-1)}(u,h,d,p),l=c=0;c<u.npart_s;c++){var w,y,A,M,B,R=u.s3ind_s[c][0],E=u.s3ind_s[c][1];for(w=p[R],y=1,M=u.s3_ss[l]*n[R]*S[p[R]],++l,++R;R<=E;)w+=p[R],y+=1,M=k(M,A=u.s3_ss[l]*n[R]*S[p[R]],R-c),++l,++R;M*=B=.5*S[w=(1+2*w)/(2*y)],r[c]=M,u.nb_s2[a][c]=u.nb_s1[a][c],u.nb_s1[a][c]=M,A=h[c],A*=u.minval_s[c],A*=B,r[c]>A&&(r[c]=A),u.masking_lower>1&&(r[c]*=u.masking_lower),r[c]>n[c]&&(r[c]=n[c]),u.masking_lower<1&&(r[c]*=u.masking_lower),_(r[c]>=0)}for(;c<f.CBANDS;++c)n[c]=0,r[c]=0}function K(e,t,n,r,a){var i,o=s(f.CBANDS),c=s(f.CBANDS),u=l(f.CBANDS+2);H(e,t,n,o,c),D(e,o,c,u);var h=0;for(i=0;i<e.npart_l;i++){var p,m,b,v=e.s3ind[i][0],g=e.s3ind[i][1],w=0,y=0;for(w=u[v],y+=1,m=e.s3_ll[h]*n[v]*S[u[v]],++h,++v;v<=g;)w+=u[v],y+=1,m=k(m,p=e.s3_ll[h]*n[v]*S[u[v]],v-i),++h,++v;if(m*=b=.5*S[w=(1+2*w)/(2*y)],e.blocktype_old[1&a]==f.SHORT_TYPE){var A=2*e.nb_1[a][i];r[i]=A>0?Math.min(m,A):Math.min(m,n[i]*d)}else{var M=16*e.nb_2[a][i],B=2*e.nb_1[a][i];M<=0&&(M=m),B<=0&&(B=m),A=e.blocktype_old[1&a]==f.NORM_TYPE?Math.min(B,M):B,r[i]=Math.min(m,A)}e.nb_2[a][i]=e.nb_1[a][i],e.nb_1[a][i]=m,p=o[i],p*=e.minval_l[i],p*=b,r[i]>p&&(r[i]=p),e.masking_lower>1&&(r[i]*=e.masking_lower),r[i]>n[i]&&(r[i]=n[i]),e.masking_lower<1&&(r[i]*=e.masking_lower),_(r[i]>=0)}for(;i<f.CBANDS;++i)n[i]=0,r[i]=0}function z(e,t,n,r,a,i,s){for(var o,l,c=2*i,f=i>0?Math.pow(10,a):1,u=0;u<s;++u){var h=e[2][u],d=e[3][u],p=t[0][u],m=t[1][u],b=t[2][u],v=t[3][u];if(p<=1.58*m&&m<=1.58*p){var g=n[u]*d,w=n[u]*h;l=Math.max(b,Math.min(v,g)),o=Math.max(v,Math.min(b,w))}else l=b,o=v;if(i>0){var y,S,A=r[u]*f;if(y=Math.min(Math.max(p,A),Math.max(m,A)),(S=(b=Math.max(l,A))+(v=Math.max(o,A)))>0&&y*c<S){var M=y*c/S;b*=M,v*=M,_(S>0)}l=Math.min(b,l),o=Math.min(v,o)}l>h&&(l=h),o>d&&(o=d),t[2][u]=l,t[3][u]=o}}function Z(e,t){var n;return(n=e>=0?27*-e:e*t)<=-72?0:Math.exp(n*m)}function W(e){var t,n,r=0;for(r=0;Z(r,e)>1e-20;r-=1);for(a=r,i=0;Math.abs(i-a)>1e-12;)Z(r=(i+a)/2,e)>0?i=r:a=r;t=a;var a,i;r=0;for(r=0;Z(r,e)>1e-20;r+=1);for(a=0,i=r;Math.abs(i-a)>1e-12;)Z(r=(i+a)/2,e)>0?a=r:i=r;n=i;var s,o=0,l=1e3;for(s=0;s<=l;++s){o+=Z(r=t+s*(n-t)/l,e)}return(l+1)/(o*(n-t))}function Q(e){var t,n,r,a;return t=e,n=(t*=t>=0?3:1.5)>=.5&&t<=2.5?8*((a=t-.5)*a-2*a):0,(r=15.811389+7.5*(t+=.474)-17.5*Math.sqrt(1+t*t))<=-60?0:(t=Math.exp((n+r)*m),t/=.6609193)}function $(e){return e<0&&(e=0),e*=.001,13*Math.atan(.76*e)+3.5*Math.atan(e*e/56.25)}function J(e,t,n,r,a,i,o,c,u,h,d,p){var m,b=s(f.CBANDS+1),v=c/(p>15?1152:384),g=l(f.HBLKSIZE);c/=u;var w=0,y=0;for(m=0;m<f.CBANDS;m++){var S;for(I=$(c*w),b[m]=c*w,S=w;$(c*S)-I<.34&&S<=u/2;S++);for(e[m]=S-w,y=m+1;w<S;)_(w<f.HBLKSIZE),g[w++]=m;if(w>u/2){w=u/2,++m;break}}_(m<f.CBANDS),b[m]=c*w;for(var A=0;A<p;A++){var M,B,R,E,k;R=h[A],E=h[A+1],(M=0|Math.floor(.5+d*(R-.5)))<0&&(M=0),(B=0|Math.floor(.5+d*(E-.5)))>u/2&&(B=u/2),n[A]=(g[M]+g[B])/2,t[A]=g[B];var T=v*E;o[A]=(T-b[t[A]])/(b[t[A]+1]-b[t[A]]),o[A]<0?o[A]=0:o[A]>1&&(o[A]=1),k=$(c*h[A]*d),k=Math.min(k,15.5)/15.5,i[A]=Math.pow(10,1.25*(1-Math.cos(Math.PI*k))-2.5)}w=0;for(var x=0;x<y;x++){var I,P,O=e[x];I=$(c*w),P=$(c*(w+O-1)),r[x]=.5*(I+P),I=$(c*(w-.5)),P=$(c*(w+O-.5)),a[x]=P-I,w+=O}return y}function ee(e,t,n,r,a,i){var l,_=o([f.CBANDS,f.CBANDS]),c=0;if(i)for(var u=0;u<t;u++)for(l=0;l<t;l++){var h=Q(n[u]-n[l])*r[l];_[u][l]=h*a[u]}else for(l=0;l<t;l++){var d=15+Math.min(21/n[l],12),p=W(d);for(u=0;u<t;u++){h=p*Z(n[u]-n[l],d)*r[l];_[u][l]=h*a[u]}}for(u=0;u<t;u++){for(l=0;l<t&&!(_[u][l]>0);l++);for(e[u][0]=l,l=t-1;l>0&&!(_[u][l]>0);l--);e[u][1]=l,c+=e[u][1]-e[u][0]+1}var m=s(c),b=0;for(u=0;u<t;u++)for(l=e[u][0];l<=e[u][1];l++)m[b++]=_[u][l];return m}function te(e){var t=$(e);return t=Math.min(t,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*t))-2.5)}function ne(e,t){return e<-.3&&(e=3410),e/=1e3,e=Math.max(.1,e),3.64*Math.pow(e,-.8)-6.8*Math.exp(-.6*Math.pow(e-3.4,2))+6*Math.exp(-.15*Math.pow(e-8.7,2))+.001*(.6+.04*t)*Math.pow(e,4)}this.L3psycho_anal_vbr=function(e,t,n,a,i,c,u,h,d,m){var b=e.internal_flags,v=s(f.HBLKSIZE),g=o([3,f.HBLKSIZE_s]),w=o([2,f.BLKSIZE]),y=o([2,3,f.BLKSIZE_s]),S=o([4,f.CBANDS]),A=o([4,f.CBANDS]),M=o([4,3]),B=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],R=l(2),E=e.mode==MPEGMode.JOINT_STEREO?4:b.channels_out;!function(e,t,n,r,a,i,l,c,f,u){for(var h=o([2,576]),d=e.internal_flags,m=d.channels_out,b=e.mode==MPEGMode.JOINT_STEREO?4:m,v=0;v<m;v++){firbuf=t[v];var g=n+576-350-p+192;_(10==q.length);for(var w=0;w<576;w++){var y,S;y=firbuf[g+w+10],S=0;for(var A=0;A<9;A+=2)y+=q[A]*(firbuf[g+w+A]+firbuf[g+w+p-A]),S+=q[A+1]*(firbuf[g+w+A+1]+firbuf[g+w+p-A-1]);h[v][w]=y+S}a[r][v].en.assign(d.en[v]),a[r][v].thm.assign(d.thm[v]),b>2&&(i[r][v].en.assign(d.en[v+2]),i[r][v].thm.assign(d.thm[v+2]))}for(v=0;v<b;v++){var M=s(12),B=s(12),R=[0,0,0,0],E=h[1&v],k=0,T=3==v?d.nsPsy.attackthre_s:d.nsPsy.attackthre,x=1;if(2==v)for(w=0,A=576;A>0;++w,--A){var I=h[0][w],P=h[1][w];h[0][w]=I+P,h[1][w]=I-P}for(w=0;w<3;w++)B[w]=d.nsPsy.last_en_subshort[v][w+6],_(d.nsPsy.last_en_subshort[v][w+4]>0),M[w]=B[w]/d.nsPsy.last_en_subshort[v][w+4],R[0]+=B[w];for(w=0;w<9;w++){for(var O=k+64,V=1;k<O;k++)V<Math.abs(E[k])&&(V=Math.abs(E[k]));d.nsPsy.last_en_subshort[v][w]=B[w+3]=V,R[1+w/3]+=V,V>B[w+3-2]?(_(B[w+3-2]>0),V/=B[w+3-2]):B[w+3-2]>10*V?(_(V>0),V=B[w+3-2]/(10*V)):V=0,M[w+3]=V}for(w=0;w<3;++w){var L=B[3*w+3]+B[3*w+4]+B[3*w+5],N=1;6*B[3*w+5]<L&&(N*=.5,6*B[3*w+4]<L&&(N*=.5)),c[v][w]=N}if(e.analysis){var H=M[0];for(w=1;w<12;w++)H<M[w]&&(H=M[w]);d.pinfo.ers[r][v]=d.pinfo.ers_save[v],d.pinfo.ers_save[v]=H}for(w=0;w<12;w++)0==f[v][w/3]&&M[w]>T&&(f[v][w/3]=w%3+1);for(w=1;w<4;w++){var D=R[w-1],C=R[w];Math.max(D,C)<4e4&&D<1.7*C&&C<1.7*D&&(1==w&&f[v][0]<=f[v][w]&&(f[v][0]=0),f[v][w]=0)}f[v][0]<=d.nsPsy.lastAttacks[v]&&(f[v][0]=0),3!=d.nsPsy.lastAttacks[v]&&f[v][0]+f[v][1]+f[v][2]+f[v][3]==0||(x=0,0!=f[v][1]&&0!=f[v][0]&&(f[v][1]=0),0!=f[v][2]&&0!=f[v][1]&&(f[v][2]=0),0!=f[v][3]&&0!=f[v][2]&&(f[v][3]=0)),v<2?u[v]=x:0==x&&(u[0]=u[1]=0),l[v]=d.tot_ener[v]}}(e,t,n,a,i,c,d,M,B,R),function(e,t){var n=e.internal_flags;e.short_blocks!=r.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var a=0;a<n.channels_out;a++)e.short_blocks==r.short_block_dispensed&&(t[a]=1),e.short_blocks==r.short_block_forced&&(t[a]=0)}(e,R);for(var k=0;k<E;k++){F(e,t,n,k,a,v,w,O=1&k),X(e,a,k,v),0!=R[O]?K(b,v,S[k],A[k],k):G(b,k)}R[0]+R[1]==2&&e.mode==MPEGMode.JOINT_STEREO&&z(S,A,b.mld_cb_l,b.ATH.cb_l,e.ATHlower*b.ATH.adjust,e.msfix,b.npart_l);for(k=0;k<E;k++){0!=R[O=1&k]&&x(b,S[k],A[k],k)}for(var I=0;I<3;I++){for(k=0;k<E;++k){0!=R[O=1&k]?Y(b,k,I):(j(e,t,n,k,I,g,y,O),U(e,g,S[k],A[k],k,I))}R[0]+R[1]==0&&e.mode==MPEGMode.JOINT_STEREO&&z(S,A,b.mld_cb_s,b.ATH.cb_s,e.ATHlower*b.ATH.adjust,e.msfix,b.npart_s);for(k=0;k<E;++k){0==R[O=1&k]&&T(b,S[k],A[k],k,I)}}for(k=0;k<E;k++){var O;if(0==R[O=1&k])for(var L=0;L<f.SBMAX_s;L++){var H=s(3);for(I=0;I<3;I++){var D=b.thm[k].s[L][I];if(D*=.8,B[k][I]>=2||1==B[k][I+1]){var C=0!=I?I-1:2,Z=P(b.thm[k].s[L][C],D,.36);D=Math.min(D,Z)}else if(1==B[k][I]){C=0!=I?I-1:2,Z=P(b.thm[k].s[L][C],D,.18);D=Math.min(D,Z)}else if(0!=I&&3==B[k][I-1]||0==I&&3==b.nsPsy.lastAttacks[k]){C=2!=I?I+1:0,Z=P(b.thm[k].s[L][C],D,.18);D=Math.min(D,Z)}D*=M[k][I],H[I]=D}for(I=0;I<3;I++)b.thm[k].s[L][I]=H[I]}}for(k=0;k<E;k++)b.nsPsy.lastAttacks[k]=B[k][2];!function(e,t,n){for(var r=e.internal_flags,a=0;a<r.channels_out;a++){var i=f.NORM_TYPE;0!=t[a]?(_(r.blocktype_old[a]!=f.START_TYPE),r.blocktype_old[a]==f.SHORT_TYPE&&(i=f.STOP_TYPE)):(i=f.SHORT_TYPE,r.blocktype_old[a]==f.NORM_TYPE&&(r.blocktype_old[a]=f.START_TYPE),r.blocktype_old[a]==f.STOP_TYPE&&(r.blocktype_old[a]=f.SHORT_TYPE)),n[a]=r.blocktype_old[a],r.blocktype_old[a]=i}}(e,R,m);for(k=0;k<E;k++){var W,Q,$,J;k>1?(W=h,Q=-2,$=f.NORM_TYPE,m[0]!=f.SHORT_TYPE&&m[1]!=f.SHORT_TYPE||($=f.SHORT_TYPE),J=c[a][k-2]):(W=u,Q=0,$=m[k],J=i[a][k]),$==f.SHORT_TYPE?W[Q+k]=V(J,b.masking_lower):W[Q+k]=N(J,b.masking_lower),e.analysis&&(b.pinfo.pe[a][k]=W[Q+k])}return 0},this.psymodel_init=function(r){var a,i=r.internal_flags,o=!0,l=13,c=24,h=0,d=0,p=-8.25,m=-4.5,b=s(f.CBANDS),v=s(f.CBANDS),S=s(f.CBANDS),A=r.out_samplerate;switch(r.experimentalZ){default:case 0:o=!0;break;case 1:o=r.VBR!=t.vbr_mtrh&&r.VBR!=t.vbr_mt;break;case 2:o=!1;break;case 3:l=8,h=-1.75,d=-.0125,p=-8.25,m=-2.25}for(i.ms_ener_ratio_old=.25,i.blocktype_old[0]=i.blocktype_old[1]=f.NORM_TYPE,a=0;a<4;++a){for(var M=0;M<f.CBANDS;++M)i.nb_1[a][M]=1e20,i.nb_2[a][M]=1e20,i.nb_s1[a][M]=i.nb_s2[a][M]=1;for(var B=0;B<f.SBMAX_l;B++)i.en[a].l[B]=1e20,i.thm[a].l[B]=1e20;for(M=0;M<3;++M){for(B=0;B<f.SBMAX_s;B++)i.en[a].s[B][M]=1e20,i.thm[a].s[B][M]=1e20;i.nsPsy.lastAttacks[a]=0}for(M=0;M<9;M++)i.nsPsy.last_en_subshort[a][M]=10}for(i.loudness_sq_save[0]=i.loudness_sq_save[1]=0,i.npart_l=J(i.numlines_l,i.bo_l,i.bm_l,b,v,i.mld_l,i.PSY.bo_l_weight,A,f.BLKSIZE,i.scalefac_band.l,f.BLKSIZE/1152,f.SBMAX_l),_(i.npart_l<f.CBANDS),a=0;a<i.npart_l;a++){var R=h;b[a]>=l&&(R=d*(b[a]-l)/(c-l)+h*(c-b[a])/(c-l)),S[a]=Math.pow(10,R/10),i.numlines_l[a]>0?i.rnumlines_l[a]=1/i.numlines_l[a]:i.rnumlines_l[a]=0}i.s3_ll=ee(i.s3ind,i.npart_l,b,v,S,o);var E;M=0;for(a=0;a<i.npart_l;a++){x=n.MAX_VALUE;for(var k=0;k<i.numlines_l[a];k++,M++){var T=A*M/(1e3*f.BLKSIZE);I=this.ATHformula(1e3*T,r)-20,I=Math.pow(10,.1*I),x>(I*=i.numlines_l[a])&&(x=I)}i.ATH.cb_l[a]=x,(x=20*b[a]/10-20)>6&&(x=100),x<-15&&(x=-15),x-=8,i.minval_l[a]=Math.pow(10,x/10)*i.numlines_l[a]}for(i.npart_s=J(i.numlines_s,i.bo_s,i.bm_s,b,v,i.mld_s,i.PSY.bo_s_weight,A,f.BLKSIZE_s,i.scalefac_band.s,f.BLKSIZE_s/384,f.SBMAX_s),_(i.npart_s<f.CBANDS),M=0,a=0;a<i.npart_s;a++){var x;R=p;b[a]>=l&&(R=m*(b[a]-l)/(c-l)+p*(c-b[a])/(c-l)),S[a]=Math.pow(10,R/10),x=n.MAX_VALUE;for(k=0;k<i.numlines_s[a];k++,M++){var I;T=A*M/(1e3*f.BLKSIZE_s);I=this.ATHformula(1e3*T,r)-20,I=Math.pow(10,.1*I),x>(I*=i.numlines_s[a])&&(x=I)}i.ATH.cb_s[a]=x,x=7*b[a]/12-7,b[a]>12&&(x*=1+3.1*Math.log(1+x)),b[a]<12&&(x*=1+2.3*Math.log(1-x)),x<-15&&(x=-15),x-=8,i.minval_s[a]=Math.pow(10,x/10)*i.numlines_s[a]}i.s3_ss=ee(i.s3ind_s,i.npart_s,b,v,S,o),g=Math.pow(10,9/16),w=Math.pow(10,1.5),y=Math.pow(10,1.5),e.init_fft(i),i.decay=Math.exp(-1*u/(.01*A/192)),E=3.5,2&r.exp_nspsytune&&(E=1),Math.abs(r.msfix)>0&&(E=r.msfix),r.msfix=E;for(var P=0;P<i.npart_l;P++)i.s3ind[P][1]>i.npart_l-1&&(i.s3ind[P][1]=i.npart_l-1);var O=576*i.mode_gr/A;if(i.ATH.decay=Math.pow(10,-1.2*O),i.ATH.adjust=.01,i.ATH.adjustLimit=1,_(i.bo_l[f.SBMAX_l-1]<=i.npart_l),_(i.bo_s[f.SBMAX_s-1]<=i.npart_s),-1!=r.ATHtype){var V=r.out_samplerate/f.BLKSIZE,L=0;for(T=0,a=0;a<f.BLKSIZE/2;++a)T+=V,i.ATH.eql_w[a]=1/Math.pow(10,this.ATHformula(T,r)/10),L+=i.ATH.eql_w[a];for(L=1/L,a=f.BLKSIZE/2;--a>=0;)i.ATH.eql_w[a]*=L}for(P=M=0;P<i.npart_s;++P)for(a=0;a<i.numlines_s[P];++a)++M;_(129==M);for(P=M=0;P<i.npart_l;++P)for(a=0;a<i.numlines_l[P];++a)++M;for(_(513==M),M=0,a=0;a<i.npart_l;a++){T=A*(M+i.numlines_l[a]/2)/(1*f.BLKSIZE);i.mld_cb_l[a]=te(T),M+=i.numlines_l[a]}for(;a<f.CBANDS;++a)i.mld_cb_l[a]=1;for(M=0,a=0;a<i.npart_s;a++){T=A*(M+i.numlines_s[a]/2)/(1*f.BLKSIZE_s);i.mld_cb_s[a]=te(T),M+=i.numlines_s[a]}for(;a<f.CBANDS;++a)i.mld_cb_s[a]=1;return 0},this.ATHformula=function(e,t){var n;switch(t.ATHtype){case 0:n=ne(e,9);break;case 1:n=ne(e,-1);break;case 2:default:n=ne(e,0);break;case 3:n=ne(e,1)+6;break;case 4:n=ne(e,t.ATHcurve)}return n}},qt}function Jn(){if(Ut)return Gt;function e(e){var t=e;this.ordinal=function(){return t}}return Ut=1,e.STEREO=new e(0),e.JOINT_STEREO=new e(1),e.DUAL_CHANNEL=new e(2),e.MONO=new e(3),e.NOT_SET=new e(4),Gt=e}function er(){if(Wt)return Zt;Wt=1;var e=Qn(),t={};return t.SFBMAX=3*e.SBMAX_s,Zt=t}function tr(){if($t)return Qt;$t=1;var e=Zn();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double;var t=e.new_float;e.new_float_n;var n=e.new_int;e.new_int_n,e.assert;var r=er();return Qt=function(){this.xr=t(576),this.l3_enc=n(576),this.scalefac=n(r.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=n(3),this.subblock_gain=n(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=n(r.SFBMAX),this.window=n(r.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=n(4),this.max_nonzero_coeff=0;var e=this;function a(e){return new Int32Array(e)}this.assign=function(t){var n;e.xr=(n=t.xr,new Float32Array(n)),e.l3_enc=a(t.l3_enc),e.scalefac=a(t.scalefac),e.xrpow_max=t.xrpow_max,e.part2_3_length=t.part2_3_length,e.big_values=t.big_values,e.count1=t.count1,e.global_gain=t.global_gain,e.scalefac_compress=t.scalefac_compress,e.block_type=t.block_type,e.mixed_block_flag=t.mixed_block_flag,e.table_select=a(t.table_select),e.subblock_gain=a(t.subblock_gain),e.region0_count=t.region0_count,e.region1_count=t.region1_count,e.preflag=t.preflag,e.scalefac_scale=t.scalefac_scale,e.count1table_select=t.count1table_select,e.part2_length=t.part2_length,e.sfb_lmax=t.sfb_lmax,e.sfb_smin=t.sfb_smin,e.psy_lmax=t.psy_lmax,e.sfbmax=t.sfbmax,e.psymax=t.psymax,e.sfbdivide=t.sfbdivide,e.width=a(t.width),e.window=a(t.window),e.count1bits=t.count1bits,e.sfb_partition_table=t.sfb_partition_table.slice(0),e.slen=a(t.slen),e.max_nonzero_coeff=t.max_nonzero_coeff}}}function nr(){if(nn)return tn;nn=1;var e=Zn(),t=e.System;e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double,e.new_float,e.new_float_n;var n=e.new_int;e.new_int_n,e.assert;var r=Qn();return tn=function(e,a,i,s){this.l=n(1+r.SBMAX_l),this.s=n(1+r.SBMAX_s),this.psfb21=n(1+r.PSFB21),this.psfb12=n(1+r.PSFB12);var o=this.l,l=this.s;4==arguments.length&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],t.arraycopy(this.arrL,0,o,0,Math.min(this.arrL.length,this.l.length)),t.arraycopy(this.arrS,0,l,0,Math.min(this.arrS.length,this.s.length)),t.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),t.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))},tn}function rr(){if(_n)return ln;_n=1;var e=Zn();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n;var t=e.new_byte,n=e.new_double,r=e.new_float,a=e.new_float_n,i=e.new_int,s=e.new_int_n;e.assert;var o=function(){if(en)return Jt;en=1;var e=Zn();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double,e.new_float,e.new_float_n;var t=e.new_int;e.new_int_n,e.assert;var n=tr();return Jt=function(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[t(4),t(4)];for(var e=0;e<2;e++)for(var r=0;r<2;r++)this.tt[e][r]=new n}}(),l=nr(),_=function(){if(an)return rn;an=1;var e=Zn();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double;var t=e.new_float,n=e.new_float_n,r=e.new_int;e.new_int_n,e.assert;var a=Qn();return rn=function(){this.last_en_subshort=n([4,9]),this.lastAttacks=r(4),this.pefirbuf=t(19),this.longfact=t(a.SBMAX_l),this.shortfact=t(a.SBMAX_s),this.attackthre=0,this.attackthre_s=0}}(),c=on?sn:(on=1,sn=function(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}),f=Wn(),u=Qn(),h=er();function d(){function e(){this.write_timing=0,this.ptr=0,this.buf=t(40)}this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=a([2,d.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new o,this.ms_ratio=r(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=i(2),this.CurrentStep=i(2),this.masking_lower=0,this.bv_scf=i(576),this.pseudohalf=i(h.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*d.BPC+1),this.itime=n(2),this.sideinfo_len=0,this.sb_sample=a([2,2,18,u.SBLIMIT]),this.amp_filter=r(32),this.header=new Array(d.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new l,this.minval_l=r(u.CBANDS),this.minval_s=r(u.CBANDS),this.nb_1=a([4,u.CBANDS]),this.nb_2=a([4,u.CBANDS]),this.nb_s1=a([4,u.CBANDS]),this.nb_s2=a([4,u.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=r(4),this.loudness_sq=a([2,2]),this.loudness_sq_save=r(2),this.mld_l=r(u.SBMAX_l),this.mld_s=r(u.SBMAX_s),this.bm_l=i(u.SBMAX_l),this.bo_l=i(u.SBMAX_l),this.bm_s=i(u.SBMAX_s),this.bo_s=i(u.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=s([u.CBANDS,2]),this.s3ind_s=s([u.CBANDS,2]),this.numlines_s=i(u.CBANDS),this.numlines_l=i(u.CBANDS),this.rnumlines_l=r(u.CBANDS),this.mld_cb_l=r(u.CBANDS),this.mld_cb_s=r(u.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=r(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=i(2),this.nsPsy=new _,this.VBR_seek_table=new c,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=s([16,5]),this.bitrate_blockType_Hist=s([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var p=0;p<this.en.length;p++)this.en[p]=new f;for(p=0;p<this.thm.length;p++)this.thm[p]=new f;for(p=0;p<this.header.length;p++)this.header[p]=new e}return d.MFSIZE=3456+u.ENCDELAY-u.MDCTDELAY,d.MAX_HEADER_BUF=256,d.MAX_BITS_PER_CHANNEL=4095,d.MAX_BITS_PER_GRANULE=7680,d.BPC=320,ln=d}function ar(){if(hn)return un;hn=1;var e=Zn(),t=e.System;e.VbrMode,e.Float,e.ShortBlock,e.Util;var n=e.Arrays;function r(){r.YULE_ORDER;r.MAX_SAMP_FREQ;var e=r.RMS_WINDOW_TIME_NUMERATOR,a=r.RMS_WINDOW_TIME_DENOMINATOR;r.MAX_SAMPLES_PER_WINDOW;var i=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],s=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function o(e,t,n,r,a,i){for(;0!=a--;)n[r]=1e-10+e[t+0]*i[0]-n[r-1]*i[1]+e[t-1]*i[2]-n[r-2]*i[3]+e[t-2]*i[4]-n[r-3]*i[5]+e[t-3]*i[6]-n[r-4]*i[7]+e[t-4]*i[8]-n[r-5]*i[9]+e[t-5]*i[10]-n[r-6]*i[11]+e[t-6]*i[12]-n[r-7]*i[13]+e[t-7]*i[14]-n[r-8]*i[15]+e[t-8]*i[16]-n[r-9]*i[17]+e[t-9]*i[18]-n[r-10]*i[19]+e[t-10]*i[20],++r,++t}function l(e,t,n,r,a,i){for(;0!=a--;)n[r]=e[t+0]*i[0]-n[r-1]*i[1]+e[t-1]*i[2]-n[r-2]*i[3]+e[t-2]*i[4],++r,++t}function _(e){return e*e}this.InitGainAnalysis=function(t,r){return function(t,r){for(var i=0;i<MAX_ORDER;i++)t.linprebuf[i]=t.lstepbuf[i]=t.loutbuf[i]=t.rinprebuf[i]=t.rstepbuf[i]=t.routbuf[i]=0;switch(0|r){case 48e3:t.reqindex=0;break;case 44100:t.reqindex=1;break;case 32e3:t.reqindex=2;break;case 24e3:t.reqindex=3;break;case 22050:t.reqindex=4;break;case 16e3:t.reqindex=5;break;case 12e3:t.reqindex=6;break;case 11025:t.reqindex=7;break;case 8e3:t.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return t.sampleWindow=0|(r*e+a-1)/a,t.lsum=0,t.rsum=0,t.totsamp=0,n.ill(t.A,0),INIT_GAIN_ANALYSIS_OK}(t,r)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(t.linpre=MAX_ORDER,t.rinpre=MAX_ORDER,t.lstep=MAX_ORDER,t.rstep=MAX_ORDER,t.lout=MAX_ORDER,t.rout=MAX_ORDER,n.fill(t.B,0),INIT_GAIN_ANALYSIS_OK)},this.AnalyzeSamples=function(e,n,a,c,f,u,h){var d,p,m,b,v,g,w;if(0==u)return GAIN_ANALYSIS_OK;switch(w=0,v=u,h){case 1:c=n,f=a;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(u<MAX_ORDER?(t.arraycopy(n,a,e.linprebuf,MAX_ORDER,u),t.arraycopy(c,f,e.rinprebuf,MAX_ORDER,u)):(t.arraycopy(n,a,e.linprebuf,MAX_ORDER,MAX_ORDER),t.arraycopy(c,f,e.rinprebuf,MAX_ORDER,MAX_ORDER));v>0;){g=v>e.sampleWindow-e.totsamp?e.sampleWindow-e.totsamp:v,w<MAX_ORDER?(d=e.linpre+w,p=e.linprebuf,m=e.rinpre+w,b=e.rinprebuf,g>MAX_ORDER-w&&(g=MAX_ORDER-w)):(d=a+w,p=n,m=f+w,b=c),o(p,d,e.lstepbuf,e.lstep+e.totsamp,g,i[e.reqindex]),o(b,m,e.rstepbuf,e.rstep+e.totsamp,g,i[e.reqindex]),l(e.lstepbuf,e.lstep+e.totsamp,e.loutbuf,e.lout+e.totsamp,g,s[e.reqindex]),l(e.rstepbuf,e.rstep+e.totsamp,e.routbuf,e.rout+e.totsamp,g,s[e.reqindex]),d=e.lout+e.totsamp,p=e.loutbuf,m=e.rout+e.totsamp,b=e.routbuf;for(var y=g%8;0!=y--;)e.lsum+=_(p[d++]),e.rsum+=_(b[m++]);for(y=g/8;0!=y--;)e.lsum+=_(p[d+0])+_(p[d+1])+_(p[d+2])+_(p[d+3])+_(p[d+4])+_(p[d+5])+_(p[d+6])+_(p[d+7]),d+=8,e.rsum+=_(b[m+0])+_(b[m+1])+_(b[m+2])+_(b[m+3])+_(b[m+4])+_(b[m+5])+_(b[m+6])+_(b[m+7]),m+=8;if(v-=g,w+=g,e.totsamp+=g,e.totsamp==e.sampleWindow){var S=10*r.STEPS_per_dB*Math.log10((e.lsum+e.rsum)/e.totsamp*.5+1e-37),A=S<=0?0:0|S;A>=e.A.length&&(A=e.A.length-1),e.A[A]++,e.lsum=e.rsum=0,t.arraycopy(e.loutbuf,e.totsamp,e.loutbuf,0,MAX_ORDER),t.arraycopy(e.routbuf,e.totsamp,e.routbuf,0,MAX_ORDER),t.arraycopy(e.lstepbuf,e.totsamp,e.lstepbuf,0,MAX_ORDER),t.arraycopy(e.rstepbuf,e.totsamp,e.rstepbuf,0,MAX_ORDER),e.totsamp=0}if(e.totsamp>e.sampleWindow)return GAIN_ANALYSIS_ERROR}return u<MAX_ORDER?(t.arraycopy(e.linprebuf,u,e.linprebuf,0,MAX_ORDER-u),t.arraycopy(e.rinprebuf,u,e.rinprebuf,0,MAX_ORDER-u),t.arraycopy(n,a,e.linprebuf,MAX_ORDER-u,u),t.arraycopy(c,f,e.rinprebuf,MAX_ORDER-u,u)):(t.arraycopy(n,a+u-MAX_ORDER,e.linprebuf,0,MAX_ORDER),t.arraycopy(c,f+u-MAX_ORDER,e.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK},this.GetTitleGain=function(e){for(var t=function(e,t){var n,a=0;for(n=0;n<t;n++)a+=e[n];if(0==a)return GAIN_NOT_ENOUGH_SAMPLES;var i=0|Math.ceil(a*(1-.95));for(n=t;n-- >0&&!((i-=e[n])<=0););return 64.82-n/r.STEPS_per_dB}(e.A,e.A.length),n=0;n<e.A.length;n++)e.B[n]+=e.A[n],e.A[n]=0;for(n=0;n<MAX_ORDER;n++)e.linprebuf[n]=e.lstepbuf[n]=e.loutbuf[n]=e.rinprebuf[n]=e.rstepbuf[n]=e.routbuf[n]=0;return e.totsamp=0,e.lsum=e.rsum=0,t}}return e.new_array_n,e.new_byte,e.new_double,e.new_float,e.new_float_n,e.new_int,e.new_int_n,e.assert,r.STEPS_per_dB=100,r.MAX_dB=120,r.GAIN_NOT_ENOUGH_SAMPLES=-24601,r.GAIN_ANALYSIS_ERROR=0,r.GAIN_ANALYSIS_OK=1,r.INIT_GAIN_ANALYSIS_ERROR=0,r.INIT_GAIN_ANALYSIS_OK=1,r.YULE_ORDER=10,r.MAX_ORDER=r.YULE_ORDER,r.MAX_SAMP_FREQ=48e3,r.RMS_WINDOW_TIME_NUMERATOR=1,r.RMS_WINDOW_TIME_DENOMINATOR=20,r.MAX_SAMPLES_PER_WINDOW=r.MAX_SAMP_FREQ*r.RMS_WINDOW_TIME_NUMERATOR/r.RMS_WINDOW_TIME_DENOMINATOR+1,un=r}function ir(){if(bn)return mn;return bn=1,mn=function(e){this.bits=e}}function sr(){if(yn)return wn;function e(e,t,n,r){this.xlen=e,this.linmax=t,this.table=n,this.hlen=r}yn=1;var t={t1HB:[1,1,1,0],t2HB:[1,2,1,3,1,1,3,2,0],t3HB:[3,2,1,1,1,1,3,2,0],t5HB:[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],t6HB:[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],t7HB:[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],t8HB:[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],t9HB:[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],t10HB:[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],t11HB:[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],t12HB:[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],t13HB:[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],t15HB:[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],t16HB:[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],t24HB:[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],t32HB:[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16],t33HB:[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0],t1l:[1,4,3,5],t2l:[1,4,7,4,5,7,6,7,8],t3l:[2,3,7,4,4,7,6,7,8],t5l:[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],t6l:[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],t7l:[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],t8l:[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],t9l:[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],t10l:[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],t11l:[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],t12l:[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],t13l:[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],t15l:[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],t16_5l:[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],t16l:[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],t24l:[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],t32l:[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10],t33l:[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8]};return t.ht=[new e(0,0,null,null),new e(2,0,t.t1HB,t.t1l),new e(3,0,t.t2HB,t.t2l),new e(3,0,t.t3HB,t.t3l),new e(0,0,null,null),new e(4,0,t.t5HB,t.t5l),new e(4,0,t.t6HB,t.t6l),new e(6,0,t.t7HB,t.t7l),new e(6,0,t.t8HB,t.t8l),new e(6,0,t.t9HB,t.t9l),new e(8,0,t.t10HB,t.t10l),new e(8,0,t.t11HB,t.t11l),new e(8,0,t.t12HB,t.t12l),new e(16,0,t.t13HB,t.t13l),new e(0,0,null,t.t16_5l),new e(16,0,t.t15HB,t.t15l),new e(1,1,t.t16HB,t.t16l),new e(2,3,t.t16HB,t.t16l),new e(3,7,t.t16HB,t.t16l),new e(4,15,t.t16HB,t.t16l),new e(6,63,t.t16HB,t.t16l),new e(8,255,t.t16HB,t.t16l),new e(10,1023,t.t16HB,t.t16l),new e(13,8191,t.t16HB,t.t16l),new e(4,15,t.t24HB,t.t24l),new e(5,31,t.t24HB,t.t24l),new e(6,63,t.t24HB,t.t24l),new e(7,127,t.t24HB,t.t24l),new e(8,255,t.t24HB,t.t24l),new e(9,511,t.t24HB,t.t24l),new e(11,2047,t.t24HB,t.t24l),new e(13,8191,t.t24HB,t.t24l),new e(0,0,t.t32HB,t.t32l),new e(0,0,t.t33HB,t.t33l)],t.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],t.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296],t.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],t.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]],t.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]],t.scfsi_band=[0,6,11,16,21],wn=t}function or(){if(An)return Sn;An=1;var e=nr(),t=Zn();t.System;var n=t.VbrMode,r=t.Float;t.ShortBlock;var a=t.Util;t.Arrays,t.new_array_n,t.new_byte,t.new_double;var i=t.new_float;t.new_float_n;var s=t.new_int;t.new_int_n;var o=t.assert,l=Qn(),_=ir(),c=rr();function f(){var t=null,u=null,h=null;function d(e){return o(0<=e+f.Q_MAX2&&e<f.Q_MAX),w[e+f.Q_MAX2]}this.setModules=function(e,n,r){t=e,u=n,h=r},this.IPOW20=function(e){return o(0<=e&&e<f.Q_MAX),y[e]};var p=2220446049250313e-31,m=f.IXMAX_VAL+2,b=f.Q_MAX,v=f.Q_MAX2;f.LARGE_BITS;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var g=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=g,this.sfBandIndex=[new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0,8,16,24,36,52,72,96,124,160,162,164,166,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var w=i(b+v+1),y=i(b),S=i(m),A=i(m);function M(e,t){var n=h.ATHformula(t,e);return n-=100,n=Math.pow(10,n/10+e.ATHlower)}function B(e){this.s=e}this.adj43=A,this.iteration_init=function(e){var n,a=e.internal_flags,i=a.l3_side;if(0==a.iteration_init_init){for(a.iteration_init_init=1,i.main_data_begin=0,function(e){for(var t=e.internal_flags.ATH.l,n=e.internal_flags.ATH.psfb21,a=e.internal_flags.ATH.s,i=e.internal_flags.ATH.psfb12,s=e.internal_flags,o=e.out_samplerate,_=0;_<l.SBMAX_l;_++){var c=s.scalefac_band.l[_],f=s.scalefac_band.l[_+1];t[_]=r.MAX_VALUE;for(var u=c;u<f;u++){var h=M(e,u*o/1152);t[_]=Math.min(t[_],h)}}for(_=0;_<l.PSFB21;_++)for(c=s.scalefac_band.psfb21[_],f=s.scalefac_band.psfb21[_+1],n[_]=r.MAX_VALUE,u=c;u<f;u++)h=M(e,u*o/1152),n[_]=Math.min(n[_],h);for(_=0;_<l.SBMAX_s;_++){for(c=s.scalefac_band.s[_],f=s.scalefac_band.s[_+1],a[_]=r.MAX_VALUE,u=c;u<f;u++)h=M(e,u*o/384),a[_]=Math.min(a[_],h);a[_]*=s.scalefac_band.s[_+1]-s.scalefac_band.s[_]}for(_=0;_<l.PSFB12;_++){for(c=s.scalefac_band.psfb12[_],f=s.scalefac_band.psfb12[_+1],i[_]=r.MAX_VALUE,u=c;u<f;u++)h=M(e,u*o/384),i[_]=Math.min(i[_],h);i[_]*=s.scalefac_band.s[13]-s.scalefac_band.s[12]}if(e.noATH){for(_=0;_<l.SBMAX_l;_++)t[_]=1e-20;for(_=0;_<l.PSFB21;_++)n[_]=1e-20;for(_=0;_<l.SBMAX_s;_++)a[_]=1e-20;for(_=0;_<l.PSFB12;_++)i[_]=1e-20}s.ATH.floor=10*Math.log10(M(e,-1))}(e),S[0]=0,n=1;n<m;n++)S[n]=Math.pow(n,4/3);for(n=0;n<m-1;n++)A[n]=n+1-Math.pow(.5*(S[n]+S[n+1]),.75);for(A[n]=.5,n=0;n<b;n++)y[n]=Math.pow(2,-.1875*(n-210));for(n=0;n<=b+v;n++)w[n]=Math.pow(2,.25*(n-210-v));var s,o,_,c;for(t.huffman_init(a),(n=e.exp_nspsytune>>2&63)>=32&&(n-=64),s=Math.pow(10,n/4/10),(n=e.exp_nspsytune>>8&63)>=32&&(n-=64),o=Math.pow(10,n/4/10),(n=e.exp_nspsytune>>14&63)>=32&&(n-=64),_=Math.pow(10,n/4/10),(n=e.exp_nspsytune>>20&63)>=32&&(n-=64),c=_*Math.pow(10,n/4/10),n=0;n<l.SBMAX_l;n++){f=n<=6?s:n<=13?o:n<=20?_:c,a.nsPsy.longfact[n]=f}for(n=0;n<l.SBMAX_s;n++){var f;f=n<=5?s:n<=10?o:n<=11?_:c,a.nsPsy.shortfact[n]=f}}},this.on_pe=function(e,t,n,r,a,i){var l,f,h=e.internal_flags,d=0,p=s(2),m=new _(d),b=u.ResvMaxBits(e,r,m,i),v=(d=m.bits)+b;for(v>c.MAX_BITS_PER_GRANULE&&(v=c.MAX_BITS_PER_GRANULE),l=0,f=0;f<h.channels_out;++f)n[f]=Math.min(c.MAX_BITS_PER_CHANNEL,d/h.channels_out),p[f]=0|n[f]*t[a][f]/700-n[f],p[f]>3*r/4&&(p[f]=3*r/4),p[f]<0&&(p[f]=0),p[f]+n[f]>c.MAX_BITS_PER_CHANNEL&&(p[f]=Math.max(0,c.MAX_BITS_PER_CHANNEL-n[f])),l+=p[f];if(l>b)for(f=0;f<h.channels_out;++f)p[f]=b*p[f]/l;for(f=0;f<h.channels_out;++f)n[f]+=p[f],b-=p[f];for(l=0,f=0;f<h.channels_out;++f)l+=n[f];if(l>c.MAX_BITS_PER_GRANULE){var g=0;for(f=0;f<h.channels_out;++f)n[f]*=c.MAX_BITS_PER_GRANULE,n[f]/=l,g+=n[f];o(g<=c.MAX_BITS_PER_GRANULE)}return v},this.reduce_side=function(e,t,n,r){o(r<=c.MAX_BITS_PER_GRANULE),o(e[0]+e[1]<=c.MAX_BITS_PER_GRANULE);var a=.33*(.5-t)/.5;a<0&&(a=0),a>.5&&(a=.5);var i=0|.5*a*(e[0]+e[1]);i>c.MAX_BITS_PER_CHANNEL-e[0]&&(i=c.MAX_BITS_PER_CHANNEL-e[0]),i<0&&(i=0),e[1]>=125&&(e[1]-i>125?(e[0]<n&&(e[0]+=i),e[1]-=i):(e[0]+=e[1]-125,e[1]=125)),(i=e[0]+e[1])>r&&(e[0]=r*e[0]/i,e[1]=r*e[1]/i),o(e[0]<=c.MAX_BITS_PER_CHANNEL),o(e[1]<=c.MAX_BITS_PER_CHANNEL),o(e[0]+e[1]<=c.MAX_BITS_PER_GRANULE)},this.athAdjust=function(e,t,n){var r=90.30873362,i=a.FAST_LOG10_X(t,10),s=e*e,o=0;return i-=n,s>1e-20&&(o=1+a.FAST_LOG10_X(s,10/r)),o<0&&(o=0),i*=o,i+=n+r-94.82444863,Math.pow(10,.1*i)},this.calc_xmin=function(e,t,r,a){var i,s=0,o=e.internal_flags,_=0,c=0,f=o.ATH,u=r.xr,h=e.VBR==n.vbr_mtrh?1:0,d=o.masking_lower;for(e.VBR!=n.vbr_mtrh&&e.VBR!=n.vbr_mt||(d=1),i=0;i<r.psy_lmax;i++){A=(S=e.VBR==n.vbr_rh||e.VBR==n.vbr_mtrh?athAdjust(f.adjust,f.l[i],f.floor):f.adjust*f.l[i])/(g=r.width[i]),M=p,k=g>>1,E=0;do{E+=T=u[_]*u[_],M+=T<A?T:A,E+=x=u[++_]*u[_],M+=x<A?x:A,_++}while(--k>0);if(E>S&&c++,i==l.SBPSY_l)M<(R=S*o.nsPsy.longfact[i])&&(M=R);if(0!=h&&(S=M),!e.ATHonly)if((B=t.en.l[i])>0)R=E*t.thm.l[i]*d/B,0!=h&&(R*=o.nsPsy.longfact[i]),S<R&&(S=R);a[s++]=0!=h?S:S*o.nsPsy.longfact[i]}var m=575;if(r.block_type!=l.SHORT_TYPE)for(var b=576;0!=b--&&BitStream.EQ(u[b],0);)m=b;r.max_nonzero_coeff=m;for(var v=r.sfb_smin;i<r.psymax;v++,i+=3){var g,w,y;for(y=e.VBR==n.vbr_rh||e.VBR==n.vbr_mtrh?athAdjust(f.adjust,f.s[v],f.floor):f.adjust*f.s[v],g=r.width[i],w=0;w<3;w++){var S,A,M,B,R,E=0,k=g>>1;A=y/g,M=p;do{var T,x;E+=T=u[_]*u[_],M+=T<A?T:A,E+=x=u[++_]*u[_],M+=x<A?x:A,_++}while(--k>0);if(E>y&&c++,v==l.SBPSY_s)M<(R=y*o.nsPsy.shortfact[v])&&(M=R);if(S=0!=h?M:y,!e.ATHonly&&!e.ATHshort)if((B=t.en.s[v][w])>0)R=E*t.thm.s[v][w]*d/B,0!=h&&(R*=o.nsPsy.shortfact[v]),S<R&&(S=R);a[s++]=0!=h?S:S*o.nsPsy.shortfact[v]}e.useTemporal&&(a[s-3]>a[s-3+1]&&(a[s-3+1]+=(a[s-3]-a[s-3+1])*o.decay),a[s-3+1]>a[s-3+2]&&(a[s-3+2]+=(a[s-3+1]-a[s-3+2])*o.decay))}return c},this.calc_noise_core=function(e,t,n,r){var a=0,s=t.s,o=e.l3_enc;if(s>e.count1)for(;0!=n--;){_=e.xr[s],s++,a+=_*_,_=e.xr[s],s++,a+=_*_}else if(s>e.big_values){var l=i(2);for(l[0]=0,l[1]=r;0!=n--;){_=Math.abs(e.xr[s])-l[o[s]],s++,a+=_*_,_=Math.abs(e.xr[s])-l[o[s]],s++,a+=_*_}}else for(;0!=n--;){var _;_=Math.abs(e.xr[s])-S[o[s]]*r,s++,a+=_*_,_=Math.abs(e.xr[s])-S[o[s]]*r,s++,a+=_*_}return t.s=s,a},this.calc_noise=function(e,t,n,r,i){var s,o,l=0,_=0,c=0,f=0,u=0,h=-20,p=0,m=e.scalefac,b=0;for(r.over_SSD=0,s=0;s<e.psymax;s++){var v,w=e.global_gain-(m[b++]+(0!=e.preflag?g[s]:0)<<e.scalefac_scale+1)-8*e.subblock_gain[e.window[s]],y=0;if(null!=i&&i.step[s]==w)y=i.noise[s],p+=e.width[s],n[l++]=y/t[_++],y=i.noise_log[s];else{var S,A=d(w);if(o=e.width[s]>>1,p+e.width[s]>e.max_nonzero_coeff)o=(S=e.max_nonzero_coeff-p+1)>0?S>>1:0;var M=new B(p);y=this.calc_noise_core(e,M,o,A),p=M.s,null!=i&&(i.step[s]=w,i.noise[s]=y),y=n[l++]=y/t[_++],y=a.FAST_LOG10(Math.max(y,1e-20)),null!=i&&(i.noise_log[s]=y)}if(null!=i&&(i.global_gain=e.global_gain),u+=y,y>0)v=Math.max(0|10*y+.5,1),r.over_SSD+=v*v,c++,f+=y;h=Math.max(h,y)}return r.over_count=c,r.tot_noise=u,r.over_noise=f,r.max_noise=h,c},this.set_pinfo=function(e,t,n,r,a){var s,_,c,f,u,h=e.internal_flags,d=0==t.scalefac_scale?.5:1,p=t.scalefac,m=i(L3Side.SFBMAX),b=i(L3Side.SFBMAX),v=new CalcNoiseResult;calc_xmin(e,n,t,m),calc_noise(t,m,b,v,null);var w=0;for(_=t.sfb_lmax,t.block_type!=l.SHORT_TYPE&&0==t.mixed_block_flag&&(_=22),s=0;s<_;s++){var y=h.scalefac_band.l[s],S=(A=h.scalefac_band.l[s+1])-y;for(f=0;w<A;w++)f+=t.xr[w]*t.xr[w];f/=S,u=1e15,h.pinfo.en[r][a][s]=u*f,h.pinfo.xfsf[r][a][s]=u*m[s]*b[s]/S,n.en.l[s]>0&&!e.ATHonly?f/=n.en.l[s]:f=0,h.pinfo.thr[r][a][s]=u*Math.max(f*n.thm.l[s],h.ATH.l[s]),h.pinfo.LAMEsfb[r][a][s]=0,0!=t.preflag&&s>=11&&(h.pinfo.LAMEsfb[r][a][s]=-d*g[s]),s<l.SBPSY_l&&(o(p[s]>=0),h.pinfo.LAMEsfb[r][a][s]-=d*p[s])}if(t.block_type==l.SHORT_TYPE)for(_=s,s=t.sfb_smin;s<l.SBMAX_s;s++){y=h.scalefac_band.s[s],S=(A=h.scalefac_band.s[s+1])-y;for(var A,M=0;M<3;M++){for(f=0,c=y;c<A;c++)f+=t.xr[w]*t.xr[w],w++;f=Math.max(f/S,1e-20),u=1e15,h.pinfo.en_s[r][a][3*s+M]=u*f,h.pinfo.xfsf_s[r][a][3*s+M]=u*m[_]*b[_]/S,n.en.s[s][M]>0?f/=n.en.s[s][M]:f=0,(e.ATHonly||e.ATHshort)&&(f=0),h.pinfo.thr_s[r][a][3*s+M]=u*Math.max(f*n.thm.s[s][M],h.ATH.s[s]),h.pinfo.LAMEsfb_s[r][a][3*s+M]=-2*t.subblock_gain[M],s<l.SBPSY_s&&(h.pinfo.LAMEsfb_s[r][a][3*s+M]-=d*p[_]),_++}}h.pinfo.LAMEqss[r][a]=t.global_gain,h.pinfo.LAMEmainbits[r][a]=t.part2_3_length+t.part2_length,h.pinfo.LAMEsfbits[r][a]=t.part2_length,h.pinfo.over[r][a]=v.over_count,h.pinfo.max_noise[r][a]=10*v.max_noise,h.pinfo.over_noise[r][a]=10*v.over_noise,h.pinfo.tot_noise[r][a]=10*v.tot_noise,h.pinfo.over_SSD[r][a]=v.over_SSD}}return f.Q_MAX=257,f.Q_MAX2=116,f.LARGE_BITS=1e5,f.IXMAX_VAL=8206,Sn=f}function lr(){if(Bn)return Mn;Bn=1;var e=Zn(),t=e.System;e.VbrMode,e.Float,e.ShortBlock,e.Util;var n=e.Arrays;e.new_array_n,e.new_byte,e.new_double,e.new_float,e.new_float_n;var r=e.new_int;e.new_int_n;var a=e.assert,i=Qn(),s=sr(),o=tr(),l=or();return Mn=function e(){var _=null;function c(e){this.bits=0|e}this.qupvt=null,this.setModules=function(e){this.qupvt=e,_=e};var f=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function u(e,t,n,r,i,s){var o=.5946/t;for(a(e>0),e>>=1;0!=e--;)i[s++]=o>n[r++]?0:1,i[s++]=o>n[r++]?0:1}function h(e,t,n,r,i,s){a(e>0);var o=(e>>=1)%2;for(e>>=1;0!=e--;){var l,c,f,u,h,d,p,m;l=n[r++]*t,c=n[r++]*t,h=0|l,f=n[r++]*t,d=0|c,u=n[r++]*t,p=0|f,l+=_.adj43[h],m=0|u,c+=_.adj43[d],i[s++]=0|l,f+=_.adj43[p],i[s++]=0|c,u+=_.adj43[m],i[s++]=0|f,i[s++]=0|u}0!=o&&(h=0|(l=n[r++]*t),d=0|(c=n[r++]*t),l+=_.adj43[h],c+=_.adj43[d],i[s++]=0|l,i[s++]=0|c)}var d=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function p(e,t,n,r){var a=function(e,t,n){var r=0,a=0;do{var i=e[t++],s=e[t++];r<i&&(r=i),a<s&&(a=s)}while(t<n);return r<a&&(r=a),r}(e,t,n);switch(a){case 0:return a;case 1:return function(e,t,n,r){var a=0,i=s.ht[1].hlen;do{var o=2*e[t+0]+e[t+1];t+=2,a+=i[o]}while(t<n);return r.bits+=a,1}(e,t,n,r);case 2:case 3:return function(e,t,n,r,a){var i,o,l=0,_=s.ht[r].xlen;o=2==r?s.table23:s.table56;do{var c=e[t+0]*_+e[t+1];t+=2,l+=o[c]}while(t<n);return i=65535&l,(l>>=16)>i&&(l=i,r++),a.bits+=l,r}(e,t,n,d[a-1],r);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return function(e,t,n,r,a){var i=0,o=0,l=0,_=s.ht[r].xlen,c=s.ht[r].hlen,f=s.ht[r+1].hlen,u=s.ht[r+2].hlen;do{var h=e[t+0]*_+e[t+1];t+=2,i+=c[h],o+=f[h],l+=u[h]}while(t<n);var d=r;return i>o&&(i=o,d++),i>l&&(i=l,d=r+2),a.bits+=i,d}(e,t,n,d[a-1],r);default:if(a>l.IXMAX_VAL)return r.bits=l.LARGE_BITS,-1;var i,o;for(a-=15,i=24;i<32&&!(s.ht[i].linmax>=a);i++);for(o=i-8;o<24&&!(s.ht[o].linmax>=a);o++);return function(e,t,n,r,a,i){var o,l=65536*s.ht[r].xlen+s.ht[a].xlen,_=0;do{var c=e[t++],f=e[t++];0!=c&&(c>14&&(c=15,_+=l),c*=16),0!=f&&(f>14&&(f=15,_+=l),c+=f),_+=s.largetbl[c]}while(t<n);return o=65535&_,(_>>=16)>o&&(_=o,r=a),i.bits+=_,r}(e,t,n,o,i,r)}}function m(e,t,n,r,a,s,o,l){for(var _=t.big_values,f=2;f<i.SBMAX_l+1;f++){var u=e.scalefac_band.l[f];if(u>=_)break;var h=a[f-2]+t.count1bits;if(n.part2_3_length<=h)break;var d=new c(h),m=p(r,u,_,d);h=d.bits,n.part2_3_length<=h||(n.assign(t),n.part2_3_length=h,n.region0_count=s[f-2],n.region1_count=f-2-s[f-2],n.table_select[0]=o[f-2],n.table_select[1]=l[f-2],n.table_select[2]=m)}}this.noquant_count_bits=function(e,t,n){var r=t.l3_enc,o=Math.min(576,t.max_nonzero_coeff+2>>1<<1);for(null!=n&&(n.sfb_count1=0);o>1&&0==(r[o-1]|r[o-2]);o-=2);t.count1=o;for(var l=0,_=0;o>3;o-=4){var f;if((2147483647&(r[o-1]|r[o-2]|r[o-3]|r[o-4]))>1)break;f=2*(2*(2*r[o-4]+r[o-3])+r[o-2])+r[o-1],l+=s.t32l[f],_+=s.t33l[f]}var u=l;if(t.count1table_select=0,l>_&&(u=_,t.count1table_select=1),t.count1bits=u,t.big_values=o,0==o)return u;if(t.block_type==i.SHORT_TYPE)(l=3*e.scalefac_band.s[3])>t.big_values&&(l=t.big_values),_=t.big_values;else if(t.block_type==i.NORM_TYPE){if(a(o<=576),l=t.region0_count=e.bv_scf[o-2],_=t.region1_count=e.bv_scf[o-1],a(l+_+2<i.SBPSY_l),_=e.scalefac_band.l[l+_+2],l=e.scalefac_band.l[l+1],_<o){var h=new c(u);t.table_select[2]=p(r,_,o,h),u=h.bits}}else t.region0_count=7,t.region1_count=i.SBMAX_l-1-7-1,(l=e.scalefac_band.l[8])>(_=o)&&(l=_);if(l=Math.min(l,o),_=Math.min(_,o),a(l>=0),a(_>=0),0<l){h=new c(u);t.table_select[0]=p(r,0,l,h),u=h.bits}if(l<_){h=new c(u);t.table_select[1]=p(r,l,_,h),u=h.bits}if(2==e.use_best_huffman&&(t.part2_3_length=u,best_huffman_divide(e,t),u=t.part2_3_length),null!=n&&t.block_type==i.NORM_TYPE){for(var d=0;e.scalefac_band.l[d]<t.big_values;)d++;n.sfb_count1=d}return u},this.count_bits=function(e,t,r,s){var o=r.l3_enc,c=l.IXMAX_VAL/_.IPOW20(r.global_gain);if(r.xrpow_max>c)return l.LARGE_BITS;if(function(e,t,r,s,o){var l,c,f,d=0,p=0,m=0,b=0,v=t,g=0,w=v,y=0,S=e,A=0;for(f=null!=o&&s.global_gain==o.global_gain,c=s.block_type==i.SHORT_TYPE?38:21,l=0;l<=c;l++){var M=-1;if((f||s.block_type==i.NORM_TYPE)&&(M=s.global_gain-(s.scalefac[l]+(0!=s.preflag?_.pretab[l]:0)<<s.scalefac_scale+1)-8*s.subblock_gain[s.window[l]]),a(s.width[l]>=0),f&&o.step[l]==M)0!=p&&(h(p,r,S,A,w,y),p=0),0!=m&&(u(m,r,S,A,w,y),m=0);else{var B,R=s.width[l];if(d+s.width[l]>s.max_nonzero_coeff&&(B=s.max_nonzero_coeff-d+1,n.fill(t,s.max_nonzero_coeff,576,0),(R=B)<0&&(R=0),l=c+1),0==p&&0==m&&(w=v,y=g,S=e,A=b),null!=o&&o.sfb_count1>0&&l>=o.sfb_count1&&o.step[l]>0&&M>=o.step[l]?(0!=p&&(h(p,r,S,A,w,y),p=0,w=v,y=g,S=e,A=b),m+=R):(0!=m&&(u(m,r,S,A,w,y),m=0,w=v,y=g,S=e,A=b),p+=R),R<=0){0!=m&&(u(m,r,S,A,w,y),m=0),0!=p&&(h(p,r,S,A,w,y),p=0);break}}l<=c&&(g+=s.width[l],b+=s.width[l],d+=s.width[l])}0!=p&&(h(p,r,S,A,w,y),p=0),0!=m&&(u(m,r,S,A,w,y),m=0)}(t,o,_.IPOW20(r.global_gain),r,s),2&e.substep_shaping)for(var f=0,d=r.global_gain+r.scalefac_scale,p=.634521682242439/_.IPOW20(d),m=0;m<r.sfbmax;m++){var b,v=r.width[m];if(a(v>=0),0==e.pseudohalf[m])f+=v;else for(b=f,f+=v;b<f;++b)o[b]=t[b]>=p?o[b]:0}return this.noquant_count_bits(e,r,s)},this.best_huffman_divide=function(e,t){var n=new o,_=t.l3_enc,f=r(23),u=r(23),h=r(23),d=r(23);if(t.block_type!=i.SHORT_TYPE||1!=e.mode_gr){n.assign(t),t.block_type==i.NORM_TYPE&&(!function(e,t,n,r,a,i,s){for(var o=t.big_values,_=0;_<=22;_++)r[_]=l.LARGE_BITS;for(_=0;_<16;_++){var f=e.scalefac_band.l[_+1];if(f>=o)break;var u=0,h=new c(u),d=p(n,0,f,h);u=h.bits;for(var m=0;m<8;m++){var b=e.scalefac_band.l[_+m+2];if(b>=o)break;var v=u,g=p(n,f,b,h=new c(v));v=h.bits,r[_+m]>v&&(r[_+m]=v,a[_+m]=_,i[_+m]=d,s[_+m]=g)}}}(e,t,_,f,u,h,d),m(e,n,t,_,f,u,h,d));var b=n.big_values;if(!(0==b||(_[b-2]|_[b-1])>1||(b=t.count1+2)>576)){n.assign(t),n.count1=b;var v=0,g=0;for(a(b<=576);b>n.big_values;b-=4){var w=2*(2*(2*_[b-4]+_[b-3])+_[b-2])+_[b-1];v+=s.t32l[w],g+=s.t33l[w]}if(n.big_values=b,n.count1table_select=0,v>g&&(v=g,n.count1table_select=1),n.count1bits=v,n.block_type==i.NORM_TYPE)m(e,n,t,_,f,u,h,d);else{if(n.part2_3_length=v,(v=e.scalefac_band.l[8])>b&&(v=b),v>0){var y=new c(n.part2_3_length);n.table_select[0]=p(_,0,v,y),n.part2_3_length=y.bits}if(b>v){y=new c(n.part2_3_length);n.table_select[1]=p(_,v,b,y),n.part2_3_length=y.bits}t.part2_3_length>n.part2_3_length&&t.assign(n)}}}};var b=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],v=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],g=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],w=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];e.slen1_tab=g,e.slen2_tab=w,this.best_scalefac_store=function(e,t,n,r){var o,l,c,f,u=r.tt[t][n],h=0;for(c=0,o=0;o<u.sfbmax;o++){var d=u.width[o];for(a(d>=0),c+=d,f=-d;f<0&&0==u.l3_enc[f+c];f++);0==f&&(u.scalefac[o]=h=-2)}if(0==u.scalefac_scale&&0==u.preflag){var p=0;for(o=0;o<u.sfbmax;o++)u.scalefac[o]>0&&(p|=u.scalefac[o]);if(!(1&p)&&0!=p){for(o=0;o<u.sfbmax;o++)u.scalefac[o]>0&&(u.scalefac[o]>>=1);u.scalefac_scale=h=1}}if(0==u.preflag&&u.block_type!=i.SHORT_TYPE&&2==e.mode_gr){for(o=11;o<i.SBPSY_l&&!(u.scalefac[o]<_.pretab[o]&&-2!=u.scalefac[o]);o++);if(o==i.SBPSY_l){for(o=11;o<i.SBPSY_l;o++)u.scalefac[o]>0&&(u.scalefac[o]-=_.pretab[o]);u.preflag=h=1}}for(l=0;l<4;l++)r.scfsi[n][l]=0;for(2==e.mode_gr&&1==t&&r.tt[0][n].block_type!=i.SHORT_TYPE&&r.tt[1][n].block_type!=i.SHORT_TYPE&&(!function(e,t){for(var n,r=t.tt[1][e],a=t.tt[0][e],o=0;o<s.scfsi_band.length-1;o++){for(n=s.scfsi_band[o];n<s.scfsi_band[o+1]&&!(a.scalefac[n]!=r.scalefac[n]&&r.scalefac[n]>=0);n++);if(n==s.scfsi_band[o+1]){for(n=s.scfsi_band[o];n<s.scfsi_band[o+1];n++)r.scalefac[n]=-1;t.scfsi[e][o]=1}}var l=0,_=0;for(n=0;n<11;n++)-1!=r.scalefac[n]&&(_++,l<r.scalefac[n]&&(l=r.scalefac[n]));for(var c=0,f=0;n<i.SBPSY_l;n++)-1!=r.scalefac[n]&&(f++,c<r.scalefac[n]&&(c=r.scalefac[n]));for(o=0;o<16;o++)if(l<b[o]&&c<v[o]){var u=g[o]*_+w[o]*f;r.part2_length>u&&(r.part2_length=u,r.scalefac_compress=o)}}(n,r),h=0),o=0;o<u.sfbmax;o++)-2==u.scalefac[o]&&(u.scalefac[o]=0);0!=h&&(2==e.mode_gr?this.scale_bitcount(u):this.scale_bitcount_lsf(e,u))};var y=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],S=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],A=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(e){var t,n,r,s=0,o=0,c=e.scalefac;if(a(function(e,t){for(var n=0;n<t;++n)if(e[n]<0)return!1;return!0}(c,e.sfbmax)),e.block_type==i.SHORT_TYPE)r=y,0!=e.mixed_block_flag&&(r=S);else if(r=A,0==e.preflag){for(n=11;n<i.SBPSY_l&&!(c[n]<_.pretab[n]);n++);if(n==i.SBPSY_l)for(e.preflag=1,n=11;n<i.SBPSY_l;n++)c[n]-=_.pretab[n]}for(n=0;n<e.sfbdivide;n++)s<c[n]&&(s=c[n]);for(;n<e.sfbmax;n++)o<c[n]&&(o=c[n]);for(e.part2_length=l.LARGE_BITS,t=0;t<16;t++)s<b[t]&&o<v[t]&&e.part2_length>r[t]&&(e.part2_length=r[t],e.scalefac_compress=t);return e.part2_length==l.LARGE_BITS};var M=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(e,n){var s,o,l,c,f,u,h,d,p=r(4),m=n.scalefac;for(s=0!=n.preflag?2:0,h=0;h<4;h++)p[h]=0;if(n.block_type==i.SHORT_TYPE){o=1;var b=_.nr_of_sfb_block[s][o];for(d=0,l=0;l<4;l++)for(c=b[l]/3,h=0;h<c;h++,d++)for(f=0;f<3;f++)m[3*d+f]>p[l]&&(p[l]=m[3*d+f])}else{o=0;b=_.nr_of_sfb_block[s][o];for(d=0,l=0;l<4;l++)for(c=b[l],h=0;h<c;h++,d++)m[d]>p[l]&&(p[l]=m[d])}for(u=!1,l=0;l<4;l++)p[l]>M[s][l]&&(u=!0);if(!u){var v,g,w,y;for(n.sfb_partition_table=_.nr_of_sfb_block[s][o],l=0;l<4;l++)n.slen[l]=B[p[l]];switch(v=n.slen[0],g=n.slen[1],w=n.slen[2],y=n.slen[3],s){case 0:n.scalefac_compress=(5*v+g<<4)+(w<<2)+y;break;case 1:n.scalefac_compress=400+(5*v+g<<2)+w;break;case 2:n.scalefac_compress=500+3*v+g;break;default:t.err.printf("intensity stereo not implemented yet\n")}}if(!u)for(a(null!=n.sfb_partition_table),n.part2_length=0,l=0;l<4;l++)n.part2_length+=n.slen[l]*n.sfb_partition_table[l];return u};var B=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(e){for(var t=2;t<=576;t+=2){for(var n,r=0;e.scalefac_band.l[++r]<t;);for(n=f[r][0];e.scalefac_band.l[n+1]>t;)n--;for(n<0&&(n=f[r][0]),e.bv_scf[t-2]=n,n=f[r][1];e.scalefac_band.l[n+e.bv_scf[t-2]+2]>t;)n--;n<0&&(n=f[r][1]),e.bv_scf[t-1]=n}}},Mn}function _r(){if(En)return Rn;En=1;var e=Zn(),t=e.System;e.VbrMode,e.Float,e.ShortBlock,e.Util;var n=e.Arrays;e.new_array_n;var r=e.new_byte;e.new_double,e.new_float;var a=e.new_float_n,i=e.new_int;e.new_int_n;var s=e.assert,o=lr(),l=sr(),_=Qn(),c=rr();function f(){var e=this,f=32,u=null,h=null,d=null,p=null;this.setModules=function(e,t,n,r){u=e,h=t,d=n,p=r};var m=null,b=0,v=0,g=0;function w(e){t.arraycopy(e.header[e.w_ptr].buf,0,m,v,e.sideinfo_len),v+=e.sideinfo_len,b+=8*e.sideinfo_len,e.w_ptr=e.w_ptr+1&c.MAX_HEADER_BUF-1}function y(e,t,n){for(s(n<30);n>0;){var r;0==g&&(g=8,v++,s(v<Lame.LAME_MAXMP3BUFFER),s(e.header[e.w_ptr].write_timing>=b),e.header[e.w_ptr].write_timing==b&&w(e),m[v]=0),r=Math.min(n,g),g-=r,s((n-=r)<f),s(g<f),m[v]|=t>>n<<g,b+=r}}function S(e,t,n){for(s(n<30);n>0;){var r;0==g&&(g=8,v++,s(v<Lame.LAME_MAXMP3BUFFER),m[v]=0),r=Math.min(n,g),g-=r,s((n-=r)<f),s(g<f),m[v]|=t>>n<<g,b+=r}}function A(e,t){var n,r=e.internal_flags;if(s(t>=0),t>=8&&(y(r,76,8),t-=8),t>=8&&(y(r,65,8),t-=8),t>=8&&(y(r,77,8),t-=8),t>=8&&(y(r,69,8),t-=8),t>=32){var a=d.getLameShortVersion();if(t>=32)for(n=0;n<a.length&&t>=8;++n)t-=8,y(r,a.charAt(n),8)}for(;t>=1;t-=1)y(r,r.ancillary_flag,1),r.ancillary_flag^=e.disable_reservoir?0:1;s(0==t)}function M(e,t,n){for(var r=e.header[e.h_ptr].ptr;n>0;){var a=Math.min(n,8-(7&r));s((n-=a)<f),e.header[e.h_ptr].buf[r>>3]|=t>>n<<8-(7&r)-a,r+=a}e.header[e.h_ptr].ptr=r}function B(e,t){e<<=8;for(var n=0;n<8;n++)65536&((t<<=1)^(e<<=1))&&(t^=32773);return t}function R(e,t){var n,r=l.ht[t.count1table_select+32],a=0,i=t.big_values,o=t.big_values;for(s(t.count1table_select<2),n=(t.count1-t.big_values)/4;n>0;--n){var _,c=0,f=0;0!=(_=t.l3_enc[i+0])&&(f+=8,t.xr[o+0]<0&&c++,s(_<=1)),0!=(_=t.l3_enc[i+1])&&(f+=4,c*=2,t.xr[o+1]<0&&c++,s(_<=1)),0!=(_=t.l3_enc[i+2])&&(f+=2,c*=2,t.xr[o+2]<0&&c++,s(_<=1)),0!=(_=t.l3_enc[i+3])&&(f++,c*=2,t.xr[o+3]<0&&c++,s(_<=1)),i+=4,o+=4,y(e,c+r.table[f],r.hlen[f]),a+=r.hlen[f]}return a}function E(e,t,n,r,a){var i=l.ht[t],o=0;if(s(t<32),0==t)return o;for(var _=n;_<r;_+=2){var c=0,u=0,h=i.xlen,d=i.xlen,p=0,m=a.l3_enc[_],b=a.l3_enc[_+1];if(0!=m&&(a.xr[_]<0&&p++,c--),t>15){if(m>14){var v=m-15;s(v<=i.linmax),p|=v<<1,u=h,m=15}if(b>14){var g=b-15;s(g<=i.linmax),p<<=h,p|=g,u+=h,b=15}d=16}0!=b&&(p<<=1,a.xr[_+1]<0&&p++,c--),s((m|b)<16),m=m*d+b,u-=c,c+=i.hlen[m],s(c<=f),s(u<=f),y(e,i.table[m],c),y(e,p,u),o+=c+u}return o}function k(e,t){var n=3*e.scalefac_band.s[3];n>t.big_values&&(n=t.big_values);var r=E(e,t.table_select[0],0,n,t);return r+=E(e,t.table_select[1],n,t.big_values,t)}function T(e,t){var n,r,a,i;n=t.big_values,s(0<=n&&n<=576);var o=t.region0_count+1;return s(0<=o),s(o<e.scalefac_band.l.length),a=e.scalefac_band.l[o],o+=t.region1_count+1,s(0<=o),s(o<e.scalefac_band.l.length),a>n&&(a=n),(i=e.scalefac_band.l[o])>n&&(i=n),r=E(e,t.table_select[0],0,a,t),r+=E(e,t.table_select[1],a,i,t),r+=E(e,t.table_select[2],i,n,t)}function x(){this.total=0}function I(n,r){var a,i,s,o,l,_=n.internal_flags;return l=_.w_ptr,-1==(o=_.h_ptr-1)&&(o=c.MAX_HEADER_BUF-1),a=_.header[o].write_timing-b,r.total=a,a>=0&&(i=1+o-l,o<l&&(i=1+o-l+c.MAX_HEADER_BUF),a-=8*i*_.sideinfo_len),a+=s=e.getframebits(n),r.total+=s,r.total%8!=0?r.total=1+r.total/8:r.total=r.total/8,r.total+=v+1,a<0&&t.err.println("strange error flushing buffer ... \n"),a}this.getframebits=function(e){var t,n=e.internal_flags;return t=0!=n.bitrate_index?l.bitrate_table[e.version][n.bitrate_index]:e.brate,s(8<=t&&t<=640),8*(0|72e3*(e.version+1)*t/e.out_samplerate+n.padding)},this.CRC_writeheader=function(e,t){var n=65535;n=B(255&t[2],n),n=B(255&t[3],n);for(var r=6;r<e.sideinfo_len;r++)n=B(255&t[r],n);t[4]=byte(n>>8),t[5]=byte(255&n)},this.flush_bitstream=function(e){var t,n,r=e.internal_flags,a=r.h_ptr-1;if(-1==a&&(a=c.MAX_HEADER_BUF-1),t=r.l3_side,!((n=I(e,new x))<0)){if(A(e,n),s(r.header[a].write_timing+this.getframebits(e)==b),r.ResvSize=0,t.main_data_begin=0,r.findReplayGain){var i=u.GetTitleGain(r.rgdata);s(NEQ(i,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),r.RadioGain=0|Math.floor(10*i+.5)}r.findPeakSample&&(r.noclipGainChange=0|Math.ceil(20*Math.log10(r.PeakSample/32767)*10),r.noclipGainChange>0&&(EQ(e.scale,1)||EQ(e.scale,0))?r.noclipScale=Math.floor(32767/r.PeakSample*100)/100:r.noclipScale=-1)}},this.add_dummy_byte=function(e,t,n){for(var r,a=e.internal_flags;n-- >0;)for(S(0,t,8),r=0;r<c.MAX_HEADER_BUF;++r)a.header[r].write_timing+=8},this.format_bitstream=function(e){var r,a=e.internal_flags;r=a.l3_side;var i=this.getframebits(e);A(e,r.resvDrain_pre),function(e,r){var a,i,o,l=e.internal_flags;if(a=l.l3_side,l.header[l.h_ptr].ptr=0,n.fill(l.header[l.h_ptr].buf,0,l.sideinfo_len,0),e.out_samplerate<16e3?M(l,4094,12):M(l,4095,12),M(l,e.version,1),M(l,1,2),M(l,e.error_protection?0:1,1),M(l,l.bitrate_index,4),M(l,l.samplerate_index,2),M(l,l.padding,1),M(l,e.extension,1),M(l,e.mode.ordinal(),2),M(l,l.mode_ext,2),M(l,e.copyright,1),M(l,e.original,1),M(l,e.emphasis,2),e.error_protection&&M(l,0,16),1==e.version){for(s(a.main_data_begin>=0),M(l,a.main_data_begin,9),2==l.channels_out?M(l,a.private_bits,3):M(l,a.private_bits,5),o=0;o<l.channels_out;o++){var f;for(f=0;f<4;f++)M(l,a.scfsi[o][f],1)}for(i=0;i<2;i++)for(o=0;o<l.channels_out;o++)M(l,(u=a.tt[i][o]).part2_3_length+u.part2_length,12),M(l,u.big_values/2,9),M(l,u.global_gain,8),M(l,u.scalefac_compress,4),u.block_type!=_.NORM_TYPE?(M(l,1,1),M(l,u.block_type,2),M(l,u.mixed_block_flag,1),14==u.table_select[0]&&(u.table_select[0]=16),M(l,u.table_select[0],5),14==u.table_select[1]&&(u.table_select[1]=16),M(l,u.table_select[1],5),M(l,u.subblock_gain[0],3),M(l,u.subblock_gain[1],3),M(l,u.subblock_gain[2],3)):(M(l,0,1),14==u.table_select[0]&&(u.table_select[0]=16),M(l,u.table_select[0],5),14==u.table_select[1]&&(u.table_select[1]=16),M(l,u.table_select[1],5),14==u.table_select[2]&&(u.table_select[2]=16),M(l,u.table_select[2],5),s(0<=u.region0_count&&u.region0_count<16),s(0<=u.region1_count&&u.region1_count<8),M(l,u.region0_count,4),M(l,u.region1_count,3)),M(l,u.preflag,1),M(l,u.scalefac_scale,1),M(l,u.count1table_select,1)}else for(s(a.main_data_begin>=0),M(l,a.main_data_begin,8),M(l,a.private_bits,l.channels_out),i=0,o=0;o<l.channels_out;o++){var u;M(l,(u=a.tt[i][o]).part2_3_length+u.part2_length,12),M(l,u.big_values/2,9),M(l,u.global_gain,8),M(l,u.scalefac_compress,9),u.block_type!=_.NORM_TYPE?(M(l,1,1),M(l,u.block_type,2),M(l,u.mixed_block_flag,1),14==u.table_select[0]&&(u.table_select[0]=16),M(l,u.table_select[0],5),14==u.table_select[1]&&(u.table_select[1]=16),M(l,u.table_select[1],5),M(l,u.subblock_gain[0],3),M(l,u.subblock_gain[1],3),M(l,u.subblock_gain[2],3)):(M(l,0,1),14==u.table_select[0]&&(u.table_select[0]=16),M(l,u.table_select[0],5),14==u.table_select[1]&&(u.table_select[1]=16),M(l,u.table_select[1],5),14==u.table_select[2]&&(u.table_select[2]=16),M(l,u.table_select[2],5),s(0<=u.region0_count&&u.region0_count<16),s(0<=u.region1_count&&u.region1_count<8),M(l,u.region0_count,4),M(l,u.region1_count,3)),M(l,u.scalefac_scale,1),M(l,u.count1table_select,1)}e.error_protection&&CRC_writeheader(l,l.header[l.h_ptr].buf);var h=l.h_ptr;s(l.header[h].ptr==8*l.sideinfo_len),l.h_ptr=h+1&c.MAX_HEADER_BUF-1,l.header[l.h_ptr].write_timing=l.header[h].write_timing+r,l.h_ptr==l.w_ptr&&t.err.println("Error: MAX_HEADER_BUF too small in bitstream.c \n")}(e,i);var l=8*a.sideinfo_len;if(l+=function(e){var t,n,r,a,i=0,l=e.internal_flags,c=l.l3_side;if(1==e.version)for(t=0;t<2;t++)for(n=0;n<l.channels_out;n++){var f=c.tt[t][n],u=o.slen1_tab[f.scalefac_compress],h=o.slen2_tab[f.scalefac_compress];for(a=0,r=0;r<f.sfbdivide;r++)-1!=f.scalefac[r]&&(y(l,f.scalefac[r],u),a+=u);for(;r<f.sfbmax;r++)-1!=f.scalefac[r]&&(y(l,f.scalefac[r],h),a+=h);s(a==f.part2_length),f.block_type==_.SHORT_TYPE?a+=k(l,f):a+=T(l,f),a+=R(l,f),s(a==f.part2_3_length+f.part2_length),i+=a}else for(t=0,n=0;n<l.channels_out;n++){f=c.tt[t][n];var d,p,m=0;if(s(null!=f.sfb_partition_table),a=0,r=0,p=0,f.block_type==_.SHORT_TYPE){for(;p<4;p++){var b=f.sfb_partition_table[p]/3,v=f.slen[p];for(d=0;d<b;d++,r++)y(l,Math.max(f.scalefac[3*r+0],0),v),y(l,Math.max(f.scalefac[3*r+1],0),v),y(l,Math.max(f.scalefac[3*r+2],0),v),m+=3*v}a+=k(l,f)}else{for(;p<4;p++)for(b=f.sfb_partition_table[p],v=f.slen[p],d=0;d<b;d++,r++)y(l,Math.max(f.scalefac[r],0),v),m+=v;a+=T(l,f)}a+=R(l,f),s(a==f.part2_3_length),s(m==f.part2_length),i+=m+a}return i}(e),A(e,r.resvDrain_post),l+=r.resvDrain_post,r.main_data_begin+=(i-l)/8,I(e,new x)!=a.ResvSize&&t.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),8*r.main_data_begin!=a.ResvSize&&(t.err.printf("bit reservoir error: \nl3_side.main_data_begin: %d \nResvoir size:             %d \nresv drain (post)         %d \nresv drain (pre)          %d \nheader and sideinfo:      %d \ndata bits:                %d \ntotal bits:               %d (remainder: %d) \nbitsperframe:             %d \n",8*r.main_data_begin,a.ResvSize,r.resvDrain_post,r.resvDrain_pre,8*a.sideinfo_len,l-r.resvDrain_post-8*a.sideinfo_len,l,l%8,i),t.err.println("This is a fatal error.  It has several possible causes:"),t.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),t.err.println(" 9%%  Your system is overclocked"),t.err.println(" 1%%  bug in LAME encoding library"),a.ResvSize=8*r.main_data_begin),s(b%8==0),b>1e9){var f;for(f=0;f<c.MAX_HEADER_BUF;++f)a.header[f].write_timing-=b;b=0}return 0},this.copy_buffer=function(e,n,r,o,l){var _=v+1;if(_<=0)return 0;if(0!=o&&_>o)return-1;if(t.arraycopy(m,0,n,r,_),v=-1,g=0,0!=l){var c=i(1);if(c[0]=e.nMusicCRC,p.updateMusicCRC(c,n,r,_),e.nMusicCRC=c[0],_>0&&(e.VBR_seek_table.nBytesWritten+=_),e.decode_on_the_fly)for(var f,d=a([2,1152]),b=_,w=-1;0!=w;)if(w=h.hip_decode1_unclipped(e.hip,n,r,b,d[0],d[1]),b=0,-1==w&&(w=0),w>0){if(s(w<=1152),e.findPeakSample){for(f=0;f<w;f++)d[0][f]>e.PeakSample?e.PeakSample=d[0][f]:-d[0][f]>e.PeakSample&&(e.PeakSample=-d[0][f]);if(e.channels_out>1)for(f=0;f<w;f++)d[1][f]>e.PeakSample?e.PeakSample=d[1][f]:-d[1][f]>e.PeakSample&&(e.PeakSample=-d[1][f])}if(e.findReplayGain&&u.AnalyzeSamples(e.rgdata,d[0],0,d[1],0,w,e.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}return _},this.init_bit_stream_w=function(e){m=r(Lame.LAME_MAXMP3BUFFER),e.h_ptr=e.w_ptr=0,e.header[e.h_ptr].write_timing=0,v=-1,g=0,b=0}}return f.EQ=function(e,t){return Math.abs(e)>Math.abs(t)?Math.abs(e-t)<=1e-6*Math.abs(e):Math.abs(e-t)<=1e-6*Math.abs(t)},f.NEQ=function(e,t){return!f.EQ(e,t)},Rn=f}function cr(){if(Tn)return kn;Tn=1;var e=Zn(),t=e.System,n=e.VbrMode;e.Float;var r=e.ShortBlock;e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double;var a=e.new_float;e.new_float_n,e.new_int;var i=e.new_int_n,s=e.new_short_n,o=e.assert,l=$n(),_=function(){if(zt)return Kt;zt=1;var e=Jn();return Kt=function(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=e.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}}(),c=rr(),f=function(){if(fn)return cn;fn=1;var e=Zn();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double;var t=e.new_float;e.new_float_n,e.new_int,e.new_int_n,e.assert;var n=Qn();return cn=function(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=t(n.SBMAX_l),this.s=t(n.SBMAX_s),this.psfb21=t(n.PSFB21),this.psfb12=t(n.PSFB12),this.cb_l=t(n.CBANDS),this.cb_s=t(n.CBANDS),this.eql_w=t(n.BLKSIZE/2)}}(),u=function(){if(pn)return dn;pn=1;var e=Zn();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double;var t=e.new_float;e.new_float_n;var n=e.new_int;e.new_int_n,e.assert;var r=ar();return dn=function(){this.linprebuf=t(2*r.MAX_ORDER),this.linpre=0,this.lstepbuf=t(r.MAX_SAMPLES_PER_WINDOW+r.MAX_ORDER),this.lstep=0,this.loutbuf=t(r.MAX_SAMPLES_PER_WINDOW+r.MAX_ORDER),this.lout=0,this.rinprebuf=t(2*r.MAX_ORDER),this.rinpre=0,this.rstepbuf=t(r.MAX_SAMPLES_PER_WINDOW+r.MAX_ORDER),this.rstep=0,this.routbuf=t(r.MAX_SAMPLES_PER_WINDOW+r.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=n(0|r.STEPS_per_dB*r.MAX_dB),this.B=n(0|r.STEPS_per_dB*r.MAX_dB)}}(),h=function(){if(gn)return vn;gn=1;var e=Zn();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double;var t=e.new_float;e.new_float_n;var n=e.new_int;e.new_int_n;var r=e.assert,a=ir(),i=Qn(),s=er(),o=rr();return vn=function(e){var l=e;this.quantize=l,this.iteration_loop=function(e,l,_,c){var f,u=e.internal_flags,h=t(s.SFBMAX),d=t(576),p=n(2),m=0,b=u.l3_side,v=new a(m);this.quantize.rv.ResvFrameBegin(e,v),m=v.bits;for(var g=0;g<u.mode_gr;g++){f=this.quantize.qupvt.on_pe(e,l,p,m,g,g),u.mode_ext==i.MPG_MD_MS_LR&&(this.quantize.ms_convert(u.l3_side,g),this.quantize.qupvt.reduce_side(p,_[g],m,f));for(var w=0;w<u.channels_out;w++){var y,S,A=b.tt[g][w];A.block_type!=i.SHORT_TYPE?(y=0,S=u.PSY.mask_adjust-y):(y=0,S=u.PSY.mask_adjust_short-y),u.masking_lower=Math.pow(10,.1*S),this.quantize.init_outer_loop(u,A),this.quantize.init_xrpow(u,A,d)&&(this.quantize.qupvt.calc_xmin(e,c[g][w],A,h),this.quantize.outer_loop(e,A,h,d,w,p[w])),this.quantize.iteration_finish_one(u,g,w),r(A.part2_3_length<=o.MAX_BITS_PER_CHANNEL),r(A.part2_3_length<=p[w])}}this.quantize.rv.ResvFrameEnd(u,m)}},vn}(),d=_r(),p=sr(),m=Qn();return kn=function e(){var b,v,g,w,y,S=this;e.V9=410,e.V8=420,e.V7=430,e.V6=440,e.V5=450,e.V4=460,e.V3=470,e.V2=480,e.V1=490,e.V0=500,e.R3MIX=1e3,e.STANDARD=1001,e.EXTREME=1002,e.INSANE=1003,e.STANDARD_FAST=1004,e.EXTREME_FAST=1005,e.MEDIUM=1006,e.MEDIUM_FAST=1007,e.LAME_MAXMP3BUFFER=147456;var A,M,B,R=new l;function E(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=a(m.SBMAX_l),this.bo_s_weight=a(m.SBMAX_s)}function k(){this.lowerlimit=0}function T(e,t){this.lowpass=t}this.enc=new m,this.setModules=function(e,t,n,r,a,i,s,o,l){b=e,v=t,g=n,w=r,y=a,A=i,M=o,B=l,this.enc.setModules(v,R,w,A)};var x=4294479419;function I(e){return e>1?0:e<=0?1:Math.cos(Math.PI/2*e)}function P(e,t){switch(e){case 44100:return t.version=1,0;case 48e3:return t.version=1,1;case 32e3:return t.version=1,2;case 22050:case 11025:return t.version=0,0;case 24e3:case 12e3:return t.version=0,1;case 16e3:case 8e3:return t.version=0,2;default:return t.version=0,-1}}function O(e,t,n){n<16e3&&(t=2);for(var r=p.bitrate_table[t][1],a=2;a<=14;a++)p.bitrate_table[t][a]>0&&Math.abs(p.bitrate_table[t][a]-e)<Math.abs(r-e)&&(r=p.bitrate_table[t][a]);return r}function V(e,t,n){n<16e3&&(t=2);for(var r=0;r<=14;r++)if(p.bitrate_table[t][r]>0&&p.bitrate_table[t][r]==e)return r;return-1}function L(e,t){var n=[new T(8,2e3),new T(16,3700),new T(24,3900),new T(32,5500),new T(40,7e3),new T(48,7500),new T(56,1e4),new T(64,11e3),new T(80,13500),new T(96,15100),new T(112,15600),new T(128,17e3),new T(160,17500),new T(192,18600),new T(224,19400),new T(256,19700),new T(320,20500)],r=S.nearestBitrateFullIndex(t);e.lowerlimit=n[r].lowpass}function N(e){var t=m.BLKSIZE+e.framesize-m.FFTOFFSET;return t=Math.max(t,512+e.framesize-32),o(c.MFSIZE>=t),t}function H(e,t,n,r,a,i){var s=S.enc.lame_encode_mp3_frame(e,t,n,r,a,i);return e.frameNum++,s}function D(){this.n_in=0,this.n_out=0}function C(){this.num_used=0}function F(e,t){return 0!=t?F(t,e%t):e}function j(e,t,n){var r=Math.PI*t;(e/=n)<0&&(e=0),e>1&&(e=1);var a=e-.5,i=.42-.5*Math.cos(2*e*Math.PI)+.08*Math.cos(4*e*Math.PI);return Math.abs(a)<1e-9?r/Math.PI:i*Math.sin(n*r*a)/(Math.PI*n*a)}function X(e,t,n,r,i,s,l,_,f){var u,h,d=e.internal_flags,p=0,m=e.out_samplerate/F(e.out_samplerate,e.in_samplerate);m>c.BPC&&(m=c.BPC);var b=Math.abs(d.resample_ratio-Math.floor(.5+d.resample_ratio))<1e-4?1:0,v=1/d.resample_ratio;v>1&&(v=1);var g=31;0==g%2&&--g;var w=(g+=b)+1;if(0==d.fill_buffer_resample_init){for(d.inbuf_old[0]=a(w),d.inbuf_old[1]=a(w),u=0;u<=2*m;++u)d.blackfilt[u]=a(w);for(d.itime[0]=0,d.itime[1]=0,p=0;p<=2*m;p++){var y=0,S=(p-m)/(2*m);for(u=0;u<=g;u++)y+=d.blackfilt[p][u]=j(u-S,v,g);for(u=0;u<=g;u++)d.blackfilt[p][u]/=y}d.fill_buffer_resample_init=1}var A=d.inbuf_old[f];for(h=0;h<r;h++){var M,B;if(M=h*d.resample_ratio,g+(p=0|Math.floor(M-d.itime[f]))-g/2>=l)break;S=M-d.itime[f]-(p+g%2*.5);o(Math.abs(S)<=.501),B=0|Math.floor(2*S*m+m+.5);var R=0;for(u=0;u<=g;++u){var E=0|u+p-g/2;o(E<l),o(E+w>=0),R+=(E<0?A[w+E]:i[s+E])*d.blackfilt[B][u]}t[n+h]=R}if(_.num_used=Math.min(l,g+p-g/2),d.itime[f]+=_.num_used-h*d.resample_ratio,_.num_used>=w)for(u=0;u<w;u++)A[u]=i[s+_.num_used+u-w];else{var k=w-_.num_used;for(u=0;u<k;++u)A[u]=A[u+_.num_used];for(p=0;u<w;++u,++p)A[u]=i[s+p];o(p==_.num_used)}return h}function q(e,t,n,r,a,i){var s=e.internal_flags;if(s.resample_ratio<.9999||s.resample_ratio>1.0001)for(var o=0;o<s.channels_out;o++){var l=new C;i.n_out=X(e,t[o],s.mf_size,e.framesize,n[o],r,a,l,o),i.n_in=l.num_used}else{i.n_out=Math.min(e.framesize,a),i.n_in=i.n_out;for(var _=0;_<i.n_out;++_)t[0][s.mf_size+_]=n[0][r+_],2==s.channels_out&&(t[1][s.mf_size+_]=n[1][r+_])}}this.lame_init=function(){var e=new _;return function(e){var t;e.class_id=x,t=e.internal_flags=new c,e.mode=MPEGMode.NOT_SET,e.original=1,e.in_samplerate=44100,e.num_channels=2,e.num_samples=-1,e.bWriteVbrTag=!0,e.quality=-1,e.short_blocks=null,t.subblock_gain=-1,e.lowpassfreq=0,e.highpassfreq=0,e.lowpasswidth=-1,e.highpasswidth=-1,e.VBR=n.vbr_off,e.VBR_q=4,e.ATHcurve=-1,e.VBR_mean_bitrate_kbps=128,e.VBR_min_bitrate_kbps=0,e.VBR_max_bitrate_kbps=0,e.VBR_hard_min=0,t.VBR_min_bitrate=1,t.VBR_max_bitrate=13,e.quant_comp=-1,e.quant_comp_short=-1,e.msfix=-1,t.resample_ratio=1,t.OldValue[0]=180,t.OldValue[1]=180,t.CurrentStep[0]=4,t.CurrentStep[1]=4,t.masking_lower=1,t.nsPsy.attackthre=-1,t.nsPsy.attackthre_s=-1,e.scale=-1,e.athaa_type=-1,e.ATHtype=-1,e.athaa_loudapprox=-1,e.athaa_sensitivity=0,e.useTemporal=null,e.interChRatio=-1,t.mf_samples_to_encode=m.ENCDELAY+m.POSTDELAY,e.encoder_padding=0,t.mf_size=m.ENCDELAY-m.MDCTDELAY,e.findReplayGain=!1,e.decode_on_the_fly=!1,t.decode_on_the_fly=!1,t.findReplayGain=!1,t.findPeakSample=!1,t.RadioGain=0,t.AudiophileGain=0,t.noclipGainChange=0,t.noclipScale=-1,e.preset=0,e.write_id3tag_automatic=!0}(e),e.lame_allocated_gfp=1,e},this.nearestBitrateFullIndex=function(e){var t=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],n=0,r=0,a=0,i=0;i=t[16],a=16,r=t[16],n=16;for(var s=0;s<16;s++)if(Math.max(e,t[s+1])!=e){i=t[s+1],a=s+1,r=t[s],n=s;break}return i-e>e-r?n:a},this.lame_init_params=function(e){var a,s,_,c=e.internal_flags;if(c.Class_ID=0,null==c.ATH&&(c.ATH=new f),null==c.PSY&&(c.PSY=new E),null==c.rgdata&&(c.rgdata=new u),c.channels_in=e.num_channels,1==c.channels_in&&(e.mode=MPEGMode.MONO),c.channels_out=e.mode==MPEGMode.MONO?1:2,c.mode_ext=m.MPG_MD_MS_LR,e.mode==MPEGMode.MONO&&(e.force_ms=!1),e.VBR==n.vbr_off&&128!=e.VBR_mean_bitrate_kbps&&0==e.brate&&(e.brate=e.VBR_mean_bitrate_kbps),e.VBR==n.vbr_off||e.VBR==n.vbr_mtrh||e.VBR==n.vbr_mt||(e.free_format=!1),e.VBR==n.vbr_off&&0==e.brate&&d.EQ(e.compression_ratio,0)&&(e.compression_ratio=11.025),e.VBR==n.vbr_off&&e.compression_ratio>0&&(0==e.out_samplerate&&(e.out_samplerate=map2MP3Frequency(int(.97*e.in_samplerate))),e.brate=0|16*e.out_samplerate*c.channels_out/(1e3*e.compression_ratio),c.samplerate_index=P(e.out_samplerate,e),e.free_format||(e.brate=O(e.brate,e.version,e.out_samplerate))),0!=e.out_samplerate&&(e.out_samplerate<16e3?(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,64)):e.out_samplerate<32e3?(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,160)):(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,32),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320))),0==e.lowpassfreq){var S=16e3;switch(e.VBR){case n.vbr_off:L(T=new k,e.brate),S=T.lowerlimit;break;case n.vbr_abr:var T;L(T=new k,e.VBR_mean_bitrate_kbps),S=T.lowerlimit;break;case n.vbr_rh:var N=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=e.VBR_q&&e.VBR_q<=9){var H=N[e.VBR_q],D=N[e.VBR_q+1],C=e.VBR_q_frac;S=linear_int(H,D,C)}else S=19500;break;default:N=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=e.VBR_q&&e.VBR_q<=9){H=N[e.VBR_q],D=N[e.VBR_q+1],C=e.VBR_q_frac;S=linear_int(H,D,C)}else S=19500}e.mode!=MPEGMode.MONO||e.VBR!=n.vbr_off&&e.VBR!=n.vbr_abr||(S*=1.5),e.lowpassfreq=0|S}if(0==e.out_samplerate&&(2*e.lowpassfreq>e.in_samplerate&&(e.lowpassfreq=e.in_samplerate/2),e.out_samplerate=(a=0|e.lowpassfreq,s=e.in_samplerate,_=44100,s>=48e3?_=48e3:s>=44100?_=44100:s>=32e3?_=32e3:s>=24e3?_=24e3:s>=22050?_=22050:s>=16e3?_=16e3:s>=12e3?_=12e3:s>=11025?_=11025:s>=8e3&&(_=8e3),-1==a?_:(a<=15960&&(_=44100),a<=15250&&(_=32e3),a<=11220&&(_=24e3),a<=9970&&(_=22050),a<=7230&&(_=16e3),a<=5420&&(_=12e3),a<=4510&&(_=11025),a<=3970&&(_=8e3),s<_?s>44100?48e3:s>32e3?44100:s>24e3?32e3:s>22050?24e3:s>16e3?22050:s>12e3?16e3:s>11025?12e3:s>8e3?11025:8e3:_))),e.lowpassfreq=Math.min(20500,e.lowpassfreq),e.lowpassfreq=Math.min(e.out_samplerate/2,e.lowpassfreq),e.VBR==n.vbr_off&&(e.compression_ratio=16*e.out_samplerate*c.channels_out/(1e3*e.brate)),e.VBR==n.vbr_abr&&(e.compression_ratio=16*e.out_samplerate*c.channels_out/(1e3*e.VBR_mean_bitrate_kbps)),e.bWriteVbrTag||(e.findReplayGain=!1,e.decode_on_the_fly=!1,c.findPeakSample=!1),c.findReplayGain=e.findReplayGain,c.decode_on_the_fly=e.decode_on_the_fly,c.decode_on_the_fly&&(c.findPeakSample=!0),c.findReplayGain&&b.InitGainAnalysis(c.rgdata,e.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return e.internal_flags=null,-6;switch(c.decode_on_the_fly&&!e.decode_only&&(null!=c.hip&&B.hip_decode_exit(c.hip),c.hip=B.hip_decode_init()),c.mode_gr=e.out_samplerate<=24e3?1:2,e.framesize=576*c.mode_gr,e.encoder_delay=m.ENCDELAY,c.resample_ratio=e.in_samplerate/e.out_samplerate,e.VBR){case n.vbr_mt:case n.vbr_rh:case n.vbr_mtrh:e.compression_ratio=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5][e.VBR_q];break;case n.vbr_abr:e.compression_ratio=16*e.out_samplerate*c.channels_out/(1e3*e.VBR_mean_bitrate_kbps);break;default:e.compression_ratio=16*e.out_samplerate*c.channels_out/(1e3*e.brate)}if(e.mode==MPEGMode.NOT_SET&&(e.mode=MPEGMode.JOINT_STEREO),e.highpassfreq>0?(c.highpass1=2*e.highpassfreq,e.highpasswidth>=0?c.highpass2=2*(e.highpassfreq+e.highpasswidth):c.highpass2=2*e.highpassfreq,c.highpass1/=e.out_samplerate,c.highpass2/=e.out_samplerate):(c.highpass1=0,c.highpass2=0),e.lowpassfreq>0?(c.lowpass2=2*e.lowpassfreq,e.lowpasswidth>=0?(c.lowpass1=2*(e.lowpassfreq-e.lowpasswidth),c.lowpass1<0&&(c.lowpass1=0)):c.lowpass1=2*e.lowpassfreq,c.lowpass1/=e.out_samplerate,c.lowpass2/=e.out_samplerate):(c.lowpass1=0,c.lowpass2=0),function(e){var n=e.internal_flags,r=32,a=-1;if(n.lowpass1>0){for(var i=999,s=0;s<=31;s++)(c=s/31)>=n.lowpass2&&(r=Math.min(r,s)),n.lowpass1<c&&c<n.lowpass2&&(i=Math.min(i,s));n.lowpass1=999==i?(r-.75)/31:(i-.75)/31,n.lowpass2=r/31}if(n.highpass2>0&&n.highpass2<.75/31*.9&&(n.highpass1=0,n.highpass2=0,t.err.println("Warning: highpass filter disabled.  highpass frequency too small\n")),n.highpass2>0){var o=-1;for(s=0;s<=31;s++)(c=s/31)<=n.highpass1&&(a=Math.max(a,s)),n.highpass1<c&&c<n.highpass2&&(o=Math.max(o,s));n.highpass1=a/31,n.highpass2=-1==o?(a+.75)/31:(o+.75)/31}for(s=0;s<32;s++){var l,_,c=s/31;l=n.highpass2>n.highpass1?I((n.highpass2-c)/(n.highpass2-n.highpass1+1e-20)):1,_=n.lowpass2>n.lowpass1?I((c-n.lowpass1)/(n.lowpass2-n.lowpass1+1e-20)):1,n.amp_filter[s]=l*_}}(e),c.samplerate_index=P(e.out_samplerate,e),c.samplerate_index<0)return e.internal_flags=null,-1;if(e.VBR==n.vbr_off){if(e.free_format)c.bitrate_index=0;else if(e.brate=O(e.brate,e.version,e.out_samplerate),c.bitrate_index=V(e.brate,e.version,e.out_samplerate),c.bitrate_index<=0)return e.internal_flags=null,-1}else c.bitrate_index=1;e.analysis&&(e.bWriteVbrTag=!1),null!=c.pinfo&&(e.bWriteVbrTag=!1),v.init_bit_stream_w(c);for(var F,j=c.samplerate_index+3*e.version+6*(e.out_samplerate<16e3?1:0),X=0;X<m.SBMAX_l+1;X++)c.scalefac_band.l[X]=w.sfBandIndex[j].l[X];for(X=0;X<m.PSFB21+1;X++){var q=(c.scalefac_band.l[22]-c.scalefac_band.l[21])/m.PSFB21,Y=c.scalefac_band.l[21]+X*q;c.scalefac_band.psfb21[X]=Y}c.scalefac_band.psfb21[m.PSFB21]=576;for(X=0;X<m.SBMAX_s+1;X++)c.scalefac_band.s[X]=w.sfBandIndex[j].s[X];for(X=0;X<m.PSFB12+1;X++){q=(c.scalefac_band.s[13]-c.scalefac_band.s[12])/m.PSFB12,Y=c.scalefac_band.s[12]+X*q;c.scalefac_band.psfb12[X]=Y}for(c.scalefac_band.psfb12[m.PSFB12]=192,1==e.version?c.sideinfo_len=1==c.channels_out?21:36:c.sideinfo_len=1==c.channels_out?13:21,e.error_protection&&(c.sideinfo_len+=2),function(e){var t=e.internal_flags;e.frameNum=0,e.write_id3tag_automatic&&M.id3tag_write_v2(e),t.bitrate_stereoMode_Hist=i([16,5]),t.bitrate_blockType_Hist=i([16,6]),t.PeakSample=0,e.bWriteVbrTag&&A.InitVbrTag(e)}(e),c.Class_ID=x,F=0;F<19;F++)c.nsPsy.pefirbuf[F]=700*c.mode_gr*c.channels_out;switch(-1==e.ATHtype&&(e.ATHtype=4),o(e.VBR_q<=9),o(e.VBR_q>=0),e.VBR){case n.vbr_mt:e.VBR=n.vbr_mtrh;case n.vbr_mtrh:null==e.useTemporal&&(e.useTemporal=!1),g.apply_preset(e,500-10*e.VBR_q,0),e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),e.quality<5&&(e.quality=0),e.quality>5&&(e.quality=5),c.PSY.mask_adjust=e.maskingadjust,c.PSY.mask_adjust_short=e.maskingadjust_short,e.experimentalY?c.sfb21_extra=!1:c.sfb21_extra=e.out_samplerate>44e3,c.iteration_loop=new VBRNewIterationLoop(y);break;case n.vbr_rh:g.apply_preset(e,500-10*e.VBR_q,0),c.PSY.mask_adjust=e.maskingadjust,c.PSY.mask_adjust_short=e.maskingadjust_short,e.experimentalY?c.sfb21_extra=!1:c.sfb21_extra=e.out_samplerate>44e3,e.quality>6&&(e.quality=6),e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),c.iteration_loop=new VBROldIterationLoop(y);break;default:var G;c.sfb21_extra=!1,e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),(G=e.VBR)==n.vbr_off&&(e.VBR_mean_bitrate_kbps=e.brate),g.apply_preset(e,e.VBR_mean_bitrate_kbps,0),e.VBR=G,c.PSY.mask_adjust=e.maskingadjust,c.PSY.mask_adjust_short=e.maskingadjust_short,G==n.vbr_off?c.iteration_loop=new h(y):c.iteration_loop=new ABRIterationLoop(y)}if(o(e.scale>=0),e.VBR!=n.vbr_off){if(c.VBR_min_bitrate=1,c.VBR_max_bitrate=14,e.out_samplerate<16e3&&(c.VBR_max_bitrate=8),0!=e.VBR_min_bitrate_kbps&&(e.VBR_min_bitrate_kbps=O(e.VBR_min_bitrate_kbps,e.version,e.out_samplerate),c.VBR_min_bitrate=V(e.VBR_min_bitrate_kbps,e.version,e.out_samplerate),c.VBR_min_bitrate<0))return-1;if(0!=e.VBR_max_bitrate_kbps&&(e.VBR_max_bitrate_kbps=O(e.VBR_max_bitrate_kbps,e.version,e.out_samplerate),c.VBR_max_bitrate=V(e.VBR_max_bitrate_kbps,e.version,e.out_samplerate),c.VBR_max_bitrate<0))return-1;e.VBR_min_bitrate_kbps=p.bitrate_table[e.version][c.VBR_min_bitrate],e.VBR_max_bitrate_kbps=p.bitrate_table[e.version][c.VBR_max_bitrate],e.VBR_mean_bitrate_kbps=Math.min(p.bitrate_table[e.version][c.VBR_max_bitrate],e.VBR_mean_bitrate_kbps),e.VBR_mean_bitrate_kbps=Math.max(p.bitrate_table[e.version][c.VBR_min_bitrate],e.VBR_mean_bitrate_kbps)}return e.tune&&(c.PSY.mask_adjust+=e.tune_value_a,c.PSY.mask_adjust_short+=e.tune_value_a),function(e){var t=e.internal_flags;switch(e.quality){default:case 9:t.psymodel=0,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 8:e.quality=7;case 7:t.psymodel=1,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 6:case 5:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=0,t.full_outer_loop=0;break;case 4:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 3:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=1,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 2:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=1,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 1:case 0:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=2,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0}}(e),o(e.scale>=0),e.athaa_type<0?c.ATH.useAdjust=3:c.ATH.useAdjust=e.athaa_type,c.ATH.aaSensitivityP=Math.pow(10,e.athaa_sensitivity/-10),null==e.short_blocks&&(e.short_blocks=r.short_block_allowed),e.short_blocks!=r.short_block_allowed||e.mode!=MPEGMode.JOINT_STEREO&&e.mode!=MPEGMode.STEREO||(e.short_blocks=r.short_block_coupled),e.quant_comp<0&&(e.quant_comp=1),e.quant_comp_short<0&&(e.quant_comp_short=0),e.msfix<0&&(e.msfix=0),e.exp_nspsytune=1|e.exp_nspsytune,e.internal_flags.nsPsy.attackthre<0&&(e.internal_flags.nsPsy.attackthre=l.NSATTACKTHRE),e.internal_flags.nsPsy.attackthre_s<0&&(e.internal_flags.nsPsy.attackthre_s=l.NSATTACKTHRE_S),o(e.scale>=0),e.scale<0&&(e.scale=1),e.ATHtype<0&&(e.ATHtype=4),e.ATHcurve<0&&(e.ATHcurve=4),e.athaa_loudapprox<0&&(e.athaa_loudapprox=2),e.interChRatio<0&&(e.interChRatio=0),null==e.useTemporal&&(e.useTemporal=!0),c.slot_lag=c.frac_SpF=0,e.VBR==n.vbr_off&&(c.slot_lag=c.frac_SpF=72e3*(e.version+1)*e.brate%e.out_samplerate|0),w.iteration_init(e),R.psymodel_init(e),o(e.scale>=0),0},this.lame_encode_flush=function(e,t,n,r){var a,i,o,l,_=e.internal_flags,c=s([2,1152]),f=0,u=_.mf_samples_to_encode-m.POSTDELAY,h=N(e);if(_.mf_samples_to_encode<1)return 0;for(a=0,e.in_samplerate!=e.out_samplerate&&(u+=16*e.out_samplerate/e.in_samplerate),(o=e.framesize-u%e.framesize)<576&&(o+=e.framesize),e.encoder_padding=o,l=(u+o)/e.framesize;l>0&&f>=0;){var d=h-_.mf_size,p=e.frameNum;d*=e.in_samplerate,(d/=e.out_samplerate)>1152&&(d=1152),d<1&&(d=1),i=r-a,0==r&&(i=0),n+=f=this.lame_encode_buffer(e,c[0],c[1],d,t,n,i),a+=f,l-=p!=e.frameNum?1:0}if(_.mf_samples_to_encode=0,f<0)return f;if(i=r-a,0==r&&(i=0),v.flush_bitstream(e),(f=v.copy_buffer(_,t,n,i,1))<0)return f;if(n+=f,i=r-(a+=f),0==r&&(i=0),e.write_id3tag_automatic){if(M.id3tag_write_v1(e),(f=v.copy_buffer(_,t,n,i,0))<0)return f;a+=f}return a},this.lame_encode_buffer=function(e,t,n,r,i,s,l){var _=e.internal_flags,f=[null,null];if(_.Class_ID!=x)return-3;if(0==r)return 0;!function(e,t){(null==e.in_buffer_0||e.in_buffer_nsamples<t)&&(e.in_buffer_0=a(t),e.in_buffer_1=a(t),e.in_buffer_nsamples=t)}(_,r),f[0]=_.in_buffer_0,f[1]=_.in_buffer_1;for(var u=0;u<r;u++)f[0][u]=t[u],_.channels_in>1&&(f[1][u]=n[u]);return function(e,t,n,r,a,i,s){var l,_,f,u,h,p=e.internal_flags,g=0,w=[null,null],y=[null,null];if(p.Class_ID!=x)return-3;if(0==r)return 0;if(h=v.copy_buffer(p,a,i,s,0),h<0)return h;if(i+=h,g+=h,y[0]=t,y[1]=n,d.NEQ(e.scale,0)&&d.NEQ(e.scale,1))for(_=0;_<r;++_)y[0][_]*=e.scale,2==p.channels_out&&(y[1][_]*=e.scale);if(d.NEQ(e.scale_left,0)&&d.NEQ(e.scale_left,1))for(_=0;_<r;++_)y[0][_]*=e.scale_left;if(d.NEQ(e.scale_right,0)&&d.NEQ(e.scale_right,1))for(_=0;_<r;++_)y[1][_]*=e.scale_right;if(2==e.num_channels&&1==p.channels_out)for(_=0;_<r;++_)y[0][_]=.5*(y[0][_]+y[1][_]),y[1][_]=0;u=N(e),w[0]=p.mfbuf[0],w[1]=p.mfbuf[1];var S=0;for(;r>0;){var A=[null,null],M=0,B=0;A[0]=y[0],A[1]=y[1];var R=new D;if(q(e,w,A,S,r,R),M=R.n_in,B=R.n_out,p.findReplayGain&&!p.decode_on_the_fly&&b.AnalyzeSamples(p.rgdata,w[0],p.mf_size,w[1],p.mf_size,B,p.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(r-=M,S+=M,p.channels_out,p.mf_size+=B,o(p.mf_size<=c.MFSIZE),p.mf_samples_to_encode<1&&(p.mf_samples_to_encode=m.ENCDELAY+m.POSTDELAY),p.mf_samples_to_encode+=B,p.mf_size>=u){var E=s-g;if(0==s&&(E=0),(l=H(e,w[0],w[1],a,i,E))<0)return l;for(i+=l,g+=l,p.mf_size-=e.framesize,p.mf_samples_to_encode-=e.framesize,f=0;f<p.channels_out;f++)for(_=0;_<p.mf_size;_++)w[f][_]=w[f][_+e.framesize]}}return o(0==r),g}(e,f[0],f[1],r,i,s,l)}},kn}function fr(){if(In)return xn;In=1;var e=Zn();e.System;var t=e.VbrMode;return e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double,e.new_float,e.new_float_n,e.new_int,e.new_int_n,e.assert,xn=function(){function e(e,t,n,r,a,i,s,o,l,_,c,f,u,h,d){this.vbr_q=e,this.quant_comp=t,this.quant_comp_s=n,this.expY=r,this.st_lrm=a,this.st_s=i,this.masking_adj=s,this.masking_adj_short=o,this.ath_lower=l,this.ath_curve=_,this.ath_sensitivity=c,this.interch=f,this.safejoint=u,this.sfb21mod=h,this.msfix=d}function n(e,t,n,r,a,i,s,o,l,_,c,f,u,h){this.quant_comp=t,this.quant_comp_s=n,this.safejoint=r,this.nsmsfix=a,this.st_lrm=i,this.st_s=s,this.nsbass=o,this.scale=l,this.masking_adj=_,this.ath_lower=c,this.ath_curve=f,this.interch=u,this.sfscale=h}var r;this.setModules=function(e){r=e};var a=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],i=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function s(e,n,r){var s=e.VBR==t.vbr_rh?a:i,o=e.VBR_q_frac,l=s[n],_=s[n+1],c=l;l.st_lrm=l.st_lrm+o*(_.st_lrm-l.st_lrm),l.st_s=l.st_s+o*(_.st_s-l.st_s),l.masking_adj=l.masking_adj+o*(_.masking_adj-l.masking_adj),l.masking_adj_short=l.masking_adj_short+o*(_.masking_adj_short-l.masking_adj_short),l.ath_lower=l.ath_lower+o*(_.ath_lower-l.ath_lower),l.ath_curve=l.ath_curve+o*(_.ath_curve-l.ath_curve),l.ath_sensitivity=l.ath_sensitivity+o*(_.ath_sensitivity-l.ath_sensitivity),l.interch=l.interch+o*(_.interch-l.interch),l.msfix=l.msfix+o*(_.msfix-l.msfix),function(e,t){var n=0;0>t&&(n=-1,t=0);9<t&&(n=-1,t=9);e.VBR_q=t,e.VBR_q_frac=0}(e,c.vbr_q),0!=r?e.quant_comp=c.quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=c.quant_comp),0!=r?e.quant_comp_short=c.quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=c.quant_comp_s),0!=c.expY&&(e.experimentalY=0!=c.expY),0!=r?e.internal_flags.nsPsy.attackthre=c.st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=c.st_lrm),0!=r?e.internal_flags.nsPsy.attackthre_s=c.st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=c.st_s),0!=r?e.maskingadjust=c.masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=c.masking_adj),0!=r?e.maskingadjust_short=c.masking_adj_short:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=c.masking_adj_short),0!=r?e.ATHlower=-c.ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-c.ath_lower/10),0!=r?e.ATHcurve=c.ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=c.ath_curve),0!=r?e.athaa_sensitivity=c.ath_sensitivity:Math.abs(e.athaa_sensitivity- -1)>0||(e.athaa_sensitivity=c.ath_sensitivity),c.interch>0&&(0!=r?e.interChRatio=c.interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=c.interch)),c.safejoint>0&&(e.exp_nspsytune=e.exp_nspsytune|c.safejoint),c.sfb21mod>0&&(e.exp_nspsytune=e.exp_nspsytune|c.sfb21mod<<20),0!=r?e.msfix=c.msfix:Math.abs(e.msfix- -1)>0||(e.msfix=c.msfix),0==r&&(e.VBR_q=n,e.VBR_q_frac=o)}var o=[new n(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new n(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new n(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new n(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new n(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new n(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new n(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new n(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new n(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new n(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new n(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new n(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new n(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new n(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new n(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new n(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new n(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function l(e,n,a){var i=n,s=r.nearestBitrateFullIndex(n);if(e.VBR=t.vbr_abr,e.VBR_mean_bitrate_kbps=i,e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320),e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.brate=e.VBR_mean_bitrate_kbps,e.VBR_mean_bitrate_kbps>320&&(e.disable_reservoir=!0),o[s].safejoint>0&&(e.exp_nspsytune=2|e.exp_nspsytune),o[s].sfscale>0&&(e.internal_flags.noise_shaping=2),Math.abs(o[s].nsbass)>0){var l=int(4*o[s].nsbass);l<0&&(l+=64),e.exp_nspsytune=e.exp_nspsytune|l<<2}return 0!=a?e.quant_comp=o[s].quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=o[s].quant_comp),0!=a?e.quant_comp_short=o[s].quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=o[s].quant_comp_s),0!=a?e.msfix=o[s].nsmsfix:Math.abs(e.msfix- -1)>0||(e.msfix=o[s].nsmsfix),0!=a?e.internal_flags.nsPsy.attackthre=o[s].st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=o[s].st_lrm),0!=a?e.internal_flags.nsPsy.attackthre_s=o[s].st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=o[s].st_s),0!=a?e.scale=o[s].scale:Math.abs(e.scale- -1)>0||(e.scale=o[s].scale),0!=a?e.maskingadjust=o[s].masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=o[s].masking_adj),o[s].masking_adj>0?0!=a?e.maskingadjust_short=.9*o[s].masking_adj:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=.9*o[s].masking_adj):0!=a?e.maskingadjust_short=1.1*o[s].masking_adj:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=1.1*o[s].masking_adj),0!=a?e.ATHlower=-o[s].ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-o[s].ath_lower/10),0!=a?e.ATHcurve=o[s].ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=o[s].ath_curve),0!=a?e.interChRatio=o[s].interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=o[s].interch),n}this.apply_preset=function(e,n,r){switch(n){case Lame.R3MIX:n=Lame.V3,e.VBR=t.vbr_mtrh;break;case Lame.MEDIUM:n=Lame.V4,e.VBR=t.vbr_rh;break;case Lame.MEDIUM_FAST:n=Lame.V4,e.VBR=t.vbr_mtrh;break;case Lame.STANDARD:n=Lame.V2,e.VBR=t.vbr_rh;break;case Lame.STANDARD_FAST:n=Lame.V2,e.VBR=t.vbr_mtrh;break;case Lame.EXTREME:n=Lame.V0,e.VBR=t.vbr_rh;break;case Lame.EXTREME_FAST:n=Lame.V0,e.VBR=t.vbr_mtrh;break;case Lame.INSANE:return n=320,e.preset=n,l(e,n,r),e.VBR=t.vbr_off,n}switch(e.preset=n,n){case Lame.V9:return s(e,9,r),n;case Lame.V8:return s(e,8,r),n;case Lame.V7:return s(e,7,r),n;case Lame.V6:return s(e,6,r),n;case Lame.V5:return s(e,5,r),n;case Lame.V4:return s(e,4,r),n;case Lame.V3:return s(e,3,r),n;case Lame.V2:return s(e,2,r),n;case Lame.V1:return s(e,1,r),n;case Lame.V0:return s(e,0,r),n}return 8<=n&&n<=320?l(e,n,r):(e.preset=0,n)}},xn}function ur(){if(Cn)return Dn;Cn=1;var e=Zn(),t=e.System,n=e.VbrMode;e.Float,e.ShortBlock;var r=e.Util,a=e.Arrays;e.new_array_n,e.new_byte,e.new_double;var i=e.new_float;e.new_float_n,e.new_int,e.new_int_n;var s=e.assert,o=On?Pn:(On=1,Pn=function(){this.setModules=function(e,t){}}),l=Ln?Vn:(Ln=1,Vn=function(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}),_=function(){if(Hn)return Nn;Hn=1;var e=Zn(),t=e.new_float,n=e.new_int;return e.assert,Nn=function(){this.global_gain=0,this.sfb_count1=0,this.step=n(39),this.noise=t(39),this.noise_log=t(39)}}(),c=Qn(),f=tr(),u=er();return Dn=function(){var e,h,d;this.rv=null,this.qupvt=null;var p,m=new o;function b(e){this.ordinal=e}function v(e){for(var t=0;t<e.sfbmax;t++)if(e.scalefac[t]+e.subblock_gain[e.window[t]]==0)return!1;return!0}function g(e,t,n,a,i){var s;switch(e){default:case 9:t.over_count>0?(s=n.over_SSD<=t.over_SSD,n.over_SSD==t.over_SSD&&(s=n.bits<t.bits)):s=n.max_noise<0&&10*n.max_noise+n.bits<=10*t.max_noise+t.bits;break;case 0:s=n.over_count<t.over_count||n.over_count==t.over_count&&n.over_noise<t.over_noise||n.over_count==t.over_count&&BitStream.EQ(n.over_noise,t.over_noise)&&n.tot_noise<t.tot_noise;break;case 8:n.max_noise=function(e,t){for(var n,a=1e-37,i=0;i<t.psymax;i++)a+=(n=e[i],r.FAST_LOG10(.368+.632*n*n*n));return Math.max(1e-20,a)}(i,a);case 1:s=n.max_noise<t.max_noise;break;case 2:s=n.tot_noise<t.tot_noise;break;case 3:s=n.tot_noise<t.tot_noise&&n.max_noise<t.max_noise;break;case 4:s=n.max_noise<=0&&t.max_noise>.2||n.max_noise<=0&&t.max_noise<0&&t.max_noise>n.max_noise-.2&&n.tot_noise<t.tot_noise||n.max_noise<=0&&t.max_noise>0&&t.max_noise>n.max_noise-.2&&n.tot_noise<t.tot_noise+t.over_noise||n.max_noise>0&&t.max_noise>-.05&&t.max_noise>n.max_noise-.1&&n.tot_noise+n.over_noise<t.tot_noise+t.over_noise||n.max_noise>0&&t.max_noise>-.1&&t.max_noise>n.max_noise-.15&&n.tot_noise+n.over_noise+n.over_noise<t.tot_noise+t.over_noise+t.over_noise;break;case 5:s=n.over_noise<t.over_noise||BitStream.EQ(n.over_noise,t.over_noise)&&n.tot_noise<t.tot_noise;break;case 6:s=n.over_noise<t.over_noise||BitStream.EQ(n.over_noise,t.over_noise)&&(n.max_noise<t.max_noise||BitStream.EQ(n.max_noise,t.max_noise)&&n.tot_noise<=t.tot_noise);break;case 7:s=n.over_count<t.over_count||n.over_noise<t.over_noise}return 0==t.over_count&&(s=s&&n.bits<t.bits),s}function w(e,t,n,r,i){var o=e.internal_flags;!function(e,t,n,r,a){var i,s=e.internal_flags;i=0==t.scalefac_scale?1.2968395546510096:1.6817928305074292;for(var o=0,l=0;l<t.sfbmax;l++)o<n[l]&&(o=n[l]);var _=s.noise_shaping_amp;switch(3==_&&(_=a?2:1),_){case 2:break;case 1:o>1?o=Math.pow(o,.5):o*=.95;break;default:o>1?o=1:o*=.95}var c=0;for(l=0;l<t.sfbmax;l++){var f,u=t.width[l];if(c+=u,!(n[l]<o)){if(2&s.substep_shaping&&(s.pseudohalf[l]=0==s.pseudohalf[l]?1:0,0==s.pseudohalf[l]&&2==s.noise_shaping_amp))return;for(t.scalefac[l]++,f=-u;f<0;f++)r[c+f]*=i,r[c+f]>t.xrpow_max&&(t.xrpow_max=r[c+f]);if(2==s.noise_shaping_amp)return}}}(e,t,n,r,i);var l=v(t);return!l&&(!(l=2==o.mode_gr?p.scale_bitcount(t):p.scale_bitcount_lsf(o,t))||(o.noise_shaping>1&&(a.fill(o.pseudohalf,0),0==t.scalefac_scale?(!function(e,t){for(var n=0,r=0;r<e.sfbmax;r++){var a=e.width[r],i=e.scalefac[r];if(0!=e.preflag&&(i+=d.pretab[r]),n+=a,1&i){i++;for(var s=-a;s<0;s++)t[n+s]*=1.2968395546510096,t[n+s]>e.xrpow_max&&(e.xrpow_max=t[n+s])}e.scalefac[r]=i>>1}e.preflag=0,e.scalefac_scale=1}(t,r),l=!1):t.block_type==c.SHORT_TYPE&&o.subblock_gain>0&&(l=function(e,t,n){var r,a=t.scalefac;for(r=0;r<t.sfb_lmax;r++)if(a[r]>=16)return!0;for(var i=0;i<3;i++){var o=0,l=0;for(r=t.sfb_lmax+i;r<t.sfbdivide;r+=3)o<a[r]&&(o=a[r]);for(;r<t.sfbmax;r+=3)l<a[r]&&(l=a[r]);if(!(o<16&&l<8)){if(t.subblock_gain[i]>=7)return!0;t.subblock_gain[i]++;var _=e.scalefac_band.l[t.sfb_lmax];for(r=t.sfb_lmax+i;r<t.sfbmax;r+=3){var c=t.width[r],f=a[r];if(s(f>=0),(f-=4>>t.scalefac_scale)>=0)a[r]=f,_+=3*c;else{a[r]=0;var u=210+(f<<t.scalefac_scale+1);p=d.IPOW20(u),_+=c*(i+1);for(var h=-c;h<0;h++)n[_+h]*=p,n[_+h]>t.xrpow_max&&(t.xrpow_max=n[_+h]);_+=c*(3-i-1)}}var p=d.IPOW20(202);for(_+=t.width[r]*(i+1),h=-t.width[r];h<0;h++)n[_+h]*=p,n[_+h]>t.xrpow_max&&(t.xrpow_max=n[_+h])}}return!1}(o,t,r)||v(t))),l||(l=2==o.mode_gr?p.scale_bitcount(t):p.scale_bitcount_lsf(o,t)),!l))}this.setModules=function(t,n,r,a){e=t,h=n,this.rv=n,d=r,this.qupvt=r,p=a,m.setModules(d,p)},this.ms_convert=function(e,t){for(var n=0;n<576;++n){var a=e.tt[t][0].xr[n],i=e.tt[t][1].xr[n];e.tt[t][0].xr[n]=(a+i)*(.5*r.SQRT2),e.tt[t][1].xr[n]=(a-i)*(.5*r.SQRT2)}},this.init_xrpow=function(e,t,n){var r=0,i=0|t.max_nonzero_coeff;if(s(null!=n),t.xrpow_max=0,s(0<=i&&i<=575),a.fill(n,i,576,0),r=function(e,t,n,r){r=0;for(var a=0;a<=n;++a){var i=Math.abs(e.xr[a]);r+=i,t[a]=Math.sqrt(i*Math.sqrt(i)),t[a]>e.xrpow_max&&(e.xrpow_max=t[a])}return r}(t,n,i,r),r>1e-20){var o=0;2&e.substep_shaping&&(o=1);for(var l=0;l<t.psymax;l++)e.pseudohalf[l]=o;return!0}return a.fill(t.l3_enc,0,576,0),!1},this.init_outer_loop=function(e,n){n.part2_3_length=0,n.big_values=0,n.count1=0,n.global_gain=210,n.scalefac_compress=0,n.table_select[0]=0,n.table_select[1]=0,n.table_select[2]=0,n.subblock_gain[0]=0,n.subblock_gain[1]=0,n.subblock_gain[2]=0,n.subblock_gain[3]=0,n.region0_count=0,n.region1_count=0,n.preflag=0,n.scalefac_scale=0,n.count1table_select=0,n.part2_length=0,n.sfb_lmax=c.SBPSY_l,n.sfb_smin=c.SBPSY_s,n.psy_lmax=e.sfb21_extra?c.SBMAX_l:c.SBPSY_l,n.psymax=n.psy_lmax,n.sfbmax=n.sfb_lmax,n.sfbdivide=11;for(var r=0;r<c.SBMAX_l;r++)n.width[r]=e.scalefac_band.l[r+1]-e.scalefac_band.l[r],n.window[r]=3;if(n.block_type==c.SHORT_TYPE){var s=i(576);n.sfb_smin=0,n.sfb_lmax=0,0!=n.mixed_block_flag&&(n.sfb_smin=3,n.sfb_lmax=2*e.mode_gr+4),n.psymax=n.sfb_lmax+3*((e.sfb21_extra?c.SBMAX_s:c.SBPSY_s)-n.sfb_smin),n.sfbmax=n.sfb_lmax+3*(c.SBPSY_s-n.sfb_smin),n.sfbdivide=n.sfbmax-18,n.psy_lmax=n.sfb_lmax;var o=e.scalefac_band.l[n.sfb_lmax];t.arraycopy(n.xr,0,s,0,576);for(r=n.sfb_smin;r<c.SBMAX_s;r++)for(var l=e.scalefac_band.s[r],_=e.scalefac_band.s[r+1],f=0;f<3;f++)for(var u=l;u<_;u++)n.xr[o++]=s[3*u+f];var h=n.sfb_lmax;for(r=n.sfb_smin;r<c.SBMAX_s;r++)n.width[h]=n.width[h+1]=n.width[h+2]=e.scalefac_band.s[r+1]-e.scalefac_band.s[r],n.window[h]=0,n.window[h+1]=1,n.window[h+2]=2,h+=3}n.count1bits=0,n.sfb_partition_table=d.nr_of_sfb_block[0][0],n.slen[0]=0,n.slen[1]=0,n.slen[2]=0,n.slen[3]=0,n.max_nonzero_coeff=575,a.fill(n.scalefac,0),function(e,t){var n=e.ATH,r=t.xr;if(t.block_type!=c.SHORT_TYPE)for(var a=!1,i=c.PSFB21-1;i>=0&&!a;i--){var s=e.scalefac_band.psfb21[i],o=e.scalefac_band.psfb21[i+1],l=d.athAdjust(n.adjust,n.psfb21[i],n.floor);e.nsPsy.longfact[21]>1e-12&&(l*=e.nsPsy.longfact[21]);for(var _=o-1;_>=s;_--){if(!(Math.abs(r[_])<l)){a=!0;break}r[_]=0}}else for(var f=0;f<3;f++)for(a=!1,i=c.PSFB12-1;i>=0&&!a;i--){o=(s=3*e.scalefac_band.s[12]+(e.scalefac_band.s[13]-e.scalefac_band.s[12])*f+(e.scalefac_band.psfb12[i]-e.scalefac_band.psfb12[0]))+(e.scalefac_band.psfb12[i+1]-e.scalefac_band.psfb12[i]);var u=d.athAdjust(n.adjust,n.psfb12[i],n.floor);for(e.nsPsy.shortfact[12]>1e-12&&(u*=e.nsPsy.shortfact[12]),_=o-1;_>=s;_--){if(!(Math.abs(r[_])<u)){a=!0;break}r[_]=0}}}(e,n)},b.BINSEARCH_NONE=new b(0),b.BINSEARCH_UP=new b(1),b.BINSEARCH_DOWN=new b(2),this.trancate_smallspectrums=function(e,t,n,r){var s=i(u.SFBMAX);if((4&e.substep_shaping||t.block_type!=c.SHORT_TYPE)&&!(128&e.substep_shaping)){d.calc_noise(t,n,s,new l,null);for(var o=0;o<576;o++){var _=0;0!=t.l3_enc[o]&&(_=Math.abs(t.xr[o])),r[o]=_}o=0;var f=8;t.block_type==c.SHORT_TYPE&&(f=6);do{var h,m,b,v,g=t.width[f];if(o+=g,!(s[f]>=1||(a.sort(r,o-g,g),BitStream.EQ(r[o-1],0)))){h=(1-s[f])*n[f],m=0,v=0;do{var w;for(b=1;v+b<g&&!BitStream.NEQ(r[v+o-g],r[v+o+b-g]);b++);if(h<(w=r[v+o-g]*r[v+o-g]*b)){0!=v&&(m=r[v+o-g-1]);break}h-=w,v+=b}while(v<g);if(!BitStream.EQ(m,0))do{Math.abs(t.xr[o-g])<=m&&(t.l3_enc[o-g]=0)}while(--g>0)}}while(++f<t.psymax);t.part2_3_length=p.noquant_count_bits(e,t,null)}},this.outer_loop=function(e,r,a,o,h,m){var v=e.internal_flags,y=new f,S=i(576),A=i(u.SFBMAX),M=new l,B=new _,R=9999999,E=!1,k=!1,T=0;if(function(e,t,n,r,a){var i,o=e.CurrentStep[r],l=!1,_=e.OldValue[r],c=b.BINSEARCH_NONE;for(t.global_gain=_,n-=t.part2_length,s(0!=o);;){var f;if(i=p.count_bits(e,a,t,null),1==o||i==n)break;i>n?(c==b.BINSEARCH_DOWN&&(l=!0),l&&(o/=2),c=b.BINSEARCH_UP,f=o):(c==b.BINSEARCH_UP&&(l=!0),l&&(o/=2),c=b.BINSEARCH_DOWN,f=-o),t.global_gain+=f,t.global_gain<0&&(t.global_gain=0,l=!0),t.global_gain>255&&(t.global_gain=255,l=!0)}for(s(t.global_gain>=0),s(t.global_gain<256);i>n&&t.global_gain<255;)t.global_gain++,i=p.count_bits(e,a,t,null);e.CurrentStep[r]=_-t.global_gain>=4?4:2,e.OldValue[r]=t.global_gain,t.part2_3_length=i}(v,r,m,h,o),0==v.noise_shaping)return 100;d.calc_noise(r,a,A,M,B),M.bits=r.part2_3_length,y.assign(r);var x=0;for(t.arraycopy(o,0,S,0,576);!E;){do{var I,P=new l,O=255;if(I=2&v.substep_shaping?20:3,v.sfb21_extra){if(A[y.sfbmax]>1)break;if(y.block_type==c.SHORT_TYPE&&(A[y.sfbmax+1]>1||A[y.sfbmax+2]>1))break}if(!w(e,y,A,o,k))break;0!=y.scalefac_scale&&(O=254);var V=m-y.part2_length;if(V<=0)break;for(;(y.part2_3_length=p.count_bits(v,o,y,B))>V&&y.global_gain<=O;)y.global_gain++;if(y.global_gain>O)break;if(0==M.over_count){for(;(y.part2_3_length=p.count_bits(v,o,y,B))>R&&y.global_gain<=O;)y.global_gain++;if(y.global_gain>O)break}if(d.calc_noise(y,a,A,P,B),P.bits=y.part2_3_length,0!=(g(r.block_type!=c.SHORT_TYPE?e.quant_comp:e.quant_comp_short,M,P,y,A)?1:0))R=r.part2_3_length,M=P,r.assign(y),x=0,t.arraycopy(o,0,S,0,576);else if(0==v.full_outer_loop){if(++x>I&&0==M.over_count)break;if(3==v.noise_shaping_amp&&k&&x>30)break;if(3==v.noise_shaping_amp&&k&&y.global_gain-T>15)break}}while(y.global_gain+y.scalefac_scale<255);3==v.noise_shaping_amp?k?E=!0:(y.assign(r),t.arraycopy(S,0,o,0,576),x=0,T=y.global_gain,k=!0):E=!0}return s(r.global_gain+r.scalefac_scale<=255),e.VBR==n.vbr_rh||e.VBR==n.vbr_mtrh?t.arraycopy(S,0,o,0,576):1&v.substep_shaping&&trancate_smallspectrums(v,r,a,o),M.over_count},this.iteration_finish_one=function(e,t,n){var r=e.l3_side,a=r.tt[t][n];p.best_scalefac_store(e,t,n,r),1==e.use_best_huffman&&p.best_huffman_divide(e,a),h.ResvAdjust(e,a)},this.VBR_encode_granule=function(e,n,r,o,l,_,c){var u,h=e.internal_flags,d=new f,p=i(576),m=c,b=c+1,v=(c+_)/2,g=0,w=h.sfb21_extra;s(m<=LameInternalFlags.MAX_BITS_PER_CHANNEL),a.fill(d.l3_enc,0);do{s(v>=_),s(v<=c),s(_<=c),h.sfb21_extra=!(v>m-42)&&w,outer_loop(e,n,r,o,l,v)<=0?(g=1,b=n.part2_3_length,d.assign(n),t.arraycopy(o,0,p,0,576),u=(c=b-32)-_,v=(c+_)/2):(u=c-(_=v+32),v=(c+_)/2,0!=g&&(g=2,n.assign(d),t.arraycopy(p,0,o,0,576)))}while(u>12);h.sfb21_extra=w,2==g&&t.arraycopy(d.l3_enc,0,n.l3_enc,0,576),s(n.part2_3_length<=m)},this.get_framebits=function(t,n){var r=t.internal_flags;r.bitrate_index=r.VBR_min_bitrate;var a=e.getframebits(t);r.bitrate_index=1,a=e.getframebits(t);for(var i=1;i<=r.VBR_max_bitrate;i++){r.bitrate_index=i;var s=new MeanBits(a);n[i]=h.ResvFrameBegin(t,s),a=s.bits}},this.VBR_old_prepare=function(e,t,n,r,a,i,s,o,l){var _,f=e.internal_flags,u=0,p=1,m=0;f.bitrate_index=f.VBR_max_bitrate;var b=h.ResvFrameBegin(e,new MeanBits(0))/f.mode_gr;get_framebits(e,i);for(var v=0;v<f.mode_gr;v++){var g=d.on_pe(e,t,o[v],b,v,0);f.mode_ext==c.MPG_MD_MS_LR&&(ms_convert(f.l3_side,v),d.reduce_side(o[v],n[v],b,g));for(var w=0;w<f.channels_out;++w){var y=f.l3_side.tt[v][w];y.block_type!=c.SHORT_TYPE?(u=1.28/(1+Math.exp(3.5-t[v][w]/300))-.05,_=f.PSY.mask_adjust-u):(u=2.56/(1+Math.exp(3.5-t[v][w]/300))-.14,_=f.PSY.mask_adjust_short-u),f.masking_lower=Math.pow(10,.1*_),init_outer_loop(f,y),l[v][w]=d.calc_xmin(e,r[v][w],y,a[v][w]),0!=l[v][w]&&(p=0),s[v][w]=126,m+=o[v][w]}}for(v=0;v<f.mode_gr;v++)for(w=0;w<f.channels_out;w++)m>i[f.VBR_max_bitrate]&&(o[v][w]*=i[f.VBR_max_bitrate],o[v][w]/=m),s[v][w]>o[v][w]&&(s[v][w]=o[v][w]);return p},this.bitpressure_strategy=function(e,t,n,r){for(var a=0;a<e.mode_gr;a++)for(var i=0;i<e.channels_out;i++){for(var s=e.l3_side.tt[a][i],o=t[a][i],l=0,_=0;_<s.psy_lmax;_++)o[l++]*=1+.029*_*_/c.SBMAX_l/c.SBMAX_l;if(s.block_type==c.SHORT_TYPE)for(_=s.sfb_smin;_<c.SBMAX_s;_++)o[l++]*=1+.029*_*_/c.SBMAX_s/c.SBMAX_s,o[l++]*=1+.029*_*_/c.SBMAX_s/c.SBMAX_s,o[l++]*=1+.029*_*_/c.SBMAX_s/c.SBMAX_s;r[a][i]=0|Math.max(n[a][i],.9*r[a][i])}},this.VBR_new_prepare=function(e,t,n,r,a,i){var s,o=e.internal_flags,l=1,_=0,f=0;if(e.free_format){o.bitrate_index=0;u=new MeanBits(_);s=h.ResvFrameBegin(e,u),_=u.bits,a[0]=s}else{o.bitrate_index=o.VBR_max_bitrate;var u=new MeanBits(_);h.ResvFrameBegin(e,u),_=u.bits,get_framebits(e,a),s=a[o.VBR_max_bitrate]}for(var p=0;p<o.mode_gr;p++){d.on_pe(e,t,i[p],_,p,0),o.mode_ext==c.MPG_MD_MS_LR&&ms_convert(o.l3_side,p);for(var m=0;m<o.channels_out;++m){var b=o.l3_side.tt[p][m];o.masking_lower=Math.pow(10,.1*o.PSY.mask_adjust),init_outer_loop(o,b),0!=d.calc_xmin(e,n[p][m],b,r[p][m])&&(l=0),f+=i[p][m]}}for(p=0;p<o.mode_gr;p++)for(m=0;m<o.channels_out;m++)f>s&&(i[p][m]*=s,i[p][m]/=f);return l},this.calc_target_bits=function(t,n,r,a,i,s){var o,l,_,f,u=t.internal_flags,p=u.l3_side,m=0;u.bitrate_index=u.VBR_max_bitrate;var b=new MeanBits(m);for(s[0]=h.ResvFrameBegin(t,b),m=b.bits,u.bitrate_index=1,m=e.getframebits(t)-8*u.sideinfo_len,i[0]=m/(u.mode_gr*u.channels_out),m=t.VBR_mean_bitrate_kbps*t.framesize*1e3,1&u.substep_shaping&&(m*=1.09),m/=t.out_samplerate,m-=8*u.sideinfo_len,m/=u.mode_gr*u.channels_out,(o=.93+.07*(11-t.compression_ratio)/5.5)<.9&&(o=.9),o>1&&(o=1),l=0;l<u.mode_gr;l++){var v=0;for(_=0;_<u.channels_out;_++){if(a[l][_]=int(o*m),n[l][_]>700){var g=int((n[l][_]-700)/1.4),w=p.tt[l][_];a[l][_]=int(o*m),w.block_type==c.SHORT_TYPE&&g<m/2&&(g=m/2),g>3*m/2?g=3*m/2:g<0&&(g=0),a[l][_]+=g}a[l][_]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(a[l][_]=LameInternalFlags.MAX_BITS_PER_CHANNEL),v+=a[l][_]}if(v>LameInternalFlags.MAX_BITS_PER_GRANULE)for(_=0;_<u.channels_out;++_)a[l][_]*=LameInternalFlags.MAX_BITS_PER_GRANULE,a[l][_]/=v}if(u.mode_ext==c.MPG_MD_MS_LR)for(l=0;l<u.mode_gr;l++)d.reduce_side(a[l],r[l],m*u.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(f=0,l=0;l<u.mode_gr;l++)for(_=0;_<u.channels_out;_++)a[l][_]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(a[l][_]=LameInternalFlags.MAX_BITS_PER_CHANNEL),f+=a[l][_];if(f>s[0])for(l=0;l<u.mode_gr;l++)for(_=0;_<u.channels_out;_++)a[l][_]*=s[0],a[l][_]/=f}},Dn}function hr(){if(Gn)return Yn;Gn=1;var e=Zn(),t=e.System,n=e.VbrMode;e.Float;var r=e.ShortBlock;e.Util;var a=e.Arrays;e.new_array_n;var i=e.new_byte;e.new_double,e.new_float,e.new_float_n,e.new_int,e.new_int_n;var s=e.assert;function o(){var e,l,_;this.setModules=function(t,n,r){e=t,l=n,_=r};var c=o.NUMTOCENTRIES,f=o.MAXFRAMESIZE,u=c+4+4+4+4+4+9+1+1+8+1+1+3+1+1+2+4+2+2,h="Xing",d="Info",p=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function m(e,t){var n=255&e[t+0];return n<<=8,n|=255&e[t+1],n<<=8,n|=255&e[t+2],n<<=8,n|=255&e[t+3]}function b(e,t,n){e[t+0]=255&n>>24,e[t+1]=255&n>>16,e[t+2]=255&n>>8,e[t+3]=255&n}function v(e,t,n){e[t+0]=255&n>>8,e[t+1]=255&n}function g(e,t,n){return 255&(e<<t|n&~(-1<<t))}function w(t,r){var a=t.internal_flags;r[0]=g(r[0],8,255),r[1]=g(r[1],3,7),r[1]=g(r[1],1,t.out_samplerate<16e3?0:1),r[1]=g(r[1],1,t.version),r[1]=g(r[1],2,1),r[1]=g(r[1],1,t.error_protection?0:1),r[2]=g(r[2],4,a.bitrate_index),r[2]=g(r[2],2,a.samplerate_index),r[2]=g(r[2],1,0),r[2]=g(r[2],1,t.extension),r[3]=g(r[3],2,t.mode.ordinal()),r[3]=g(r[3],2,a.mode_ext),r[3]=g(r[3],1,t.copyright),r[3]=g(r[3],1,t.original),r[3]=g(r[3],2,t.emphasis),r[0]=255;var i,s,o=241&r[1];i=1==t.version?128:t.out_samplerate<16e3?32:64,t.VBR==n.vbr_off&&(i=t.brate),s=t.free_format?0:255&16*e.BitrateIndex(i,t.version,t.out_samplerate),1==t.version?(r[1]=255&o|10,o=13&r[2],r[2]=255&(s|o)):(r[1]=255&o|2,o=13&r[2],r[2]=255&(s|o))}function y(e,t){return t=t>>8^p[255&(t^e)]}this.addVbrFrame=function(e){var t=e.internal_flags,n=Tables.bitrate_table[e.version][t.bitrate_index];s(null!=t.VBR_seek_table.bag),function(e,t){if(e.nVbrNumFrames++,e.sum+=t,e.seen++,!(e.seen<e.want)&&(e.pos<e.size&&(e.bag[e.pos]=e.sum,e.pos++,e.seen=0),e.pos==e.size)){for(var n=1;n<e.size;n+=2)e.bag[n/2]=e.bag[n];e.want*=2,e.pos/=2}}(t.VBR_seek_table,n)},this.getVbrTag=function(e){var t=new VBRTagData,n=0;t.flags=0;var r=e[n+1]>>3&1,a=e[n+2]>>2&3,i=e[n+3]>>6&3,s=e[n+2]>>4&15;if(s=Tables.bitrate_table[r][s],e[n+1]>>4==14?t.samprate=Tables.samplerate_table[2][a]:t.samprate=Tables.samplerate_table[r][a],!function(e,t){return new String(e,t,4(),null).equals(h)||new String(e,t,4(),null).equals(d)}(e,n+=0!=r?3!=i?36:21:3!=i?21:13))return null;n+=4,t.hId=r;var o=t.flags=m(e,n);if(n+=4,1&o&&(t.frames=m(e,n),n+=4),2&o&&(t.bytes=m(e,n),n+=4),4&o){if(null!=t.toc)for(var l=0;l<c;l++)t.toc[l]=e[n+l];n+=c}t.vbrScale=-1,8&o&&(t.vbrScale=m(e,n),n+=4),t.headersize=72e3*(r+1)*s/t.samprate;var _=e[(n+=21)+0]<<4;_+=e[n+1]>>4;var f=(15&e[n+1])<<8;return(_<0||_>3e3)&&(_=-1),((f+=255&e[n+2])<0||f>3e3)&&(f=-1),t.encDelay=_,t.encPadding=f,t},this.InitVbrTag=function(e){var t,r=e.internal_flags;t=1==e.version?128:e.out_samplerate<16e3?32:64,e.VBR==n.vbr_off&&(t=e.brate);var a=72e3*(e.version+1)*t/e.out_samplerate,s=r.sideinfo_len+u;if(r.VBR_seek_table.TotalFrameSize=a,a<s||a>f)e.bWriteVbrTag=!1;else{r.VBR_seek_table.nVbrNumFrames=0,r.VBR_seek_table.nBytesWritten=0,r.VBR_seek_table.sum=0,r.VBR_seek_table.seen=0,r.VBR_seek_table.want=1,r.VBR_seek_table.pos=0,null==r.VBR_seek_table.bag&&(r.VBR_seek_table.bag=new int[400],r.VBR_seek_table.size=400);var o=i(f);w(e,o);for(var _=r.VBR_seek_table.TotalFrameSize,c=0;c<_;++c)l.add_dummy_byte(e,255&o[c],1)}},this.updateMusicCRC=function(e,t,n,r){for(var a=0;a<r;++a)e[0]=y(t[n+a],e[0])},this.getLameTagFrame=function(e,s){var o=e.internal_flags;if(!e.bWriteVbrTag)return 0;if(o.Class_ID!=Lame.LAME_ID)return 0;if(o.VBR_seek_table.pos<=0)return 0;if(s.length<o.VBR_seek_table.TotalFrameSize)return o.VBR_seek_table.TotalFrameSize;a.fill(s,0,o.VBR_seek_table.TotalFrameSize,0),w(e,s);var f=i(c);if(e.free_format)for(var u=1;u<c;++u)f[u]=255&255*u/100;else!function(e,t){if(!(e.pos<=0))for(var n=1;n<c;++n){var r=n/c,a=0|Math.floor(r*e.pos);a>e.pos-1&&(a=e.pos-1);var i=0|256*e.bag[a]/e.sum;i>255&&(i=255),t[n]=255&i}}(o.VBR_seek_table,f);var p=o.sideinfo_len;e.error_protection&&(p-=2),e.VBR==n.vbr_off?(s[p++]=255&d.charAt(0),s[p++]=255&d.charAt(1),s[p++]=255&d.charAt(2),s[p++]=255&d.charAt(3)):(s[p++]=255&h.charAt(0),s[p++]=255&h.charAt(1),s[p++]=255&h.charAt(2),s[p++]=255&h.charAt(3)),b(s,p,15),b(s,p+=4,o.VBR_seek_table.nVbrNumFrames),p+=4;var m=o.VBR_seek_table.nBytesWritten+o.VBR_seek_table.TotalFrameSize;b(s,p,0|m),p+=4,t.arraycopy(f,0,s,p,f.length),p+=f.length,e.error_protection&&l.CRC_writeheader(o,s);var g=0;for(u=0;u<p;u++)g=y(s[u],g);return p+=function(e,t,n,a,i){var s,o,l,c,f,u=e.internal_flags,h=0,d=e.encoder_delay,p=e.encoder_padding,m=100-10*e.VBR_q-e.quality,g=_.getLameVeryShortVersion(),w=[1,5,3,2,4,0,3],S=0|(e.lowpassfreq/100+.5>255?255:e.lowpassfreq/100+.5),A=0,M=0,B=e.internal_flags.noise_shaping,R=0,E=0,k=0,T=!!(1&e.exp_nspsytune),x=!!(2&e.exp_nspsytune),I=!1,P=!1,O=e.internal_flags.nogap_total,V=e.internal_flags.nogap_current,L=e.ATHtype;switch(e.VBR){case vbr_abr:f=e.VBR_mean_bitrate_kbps;break;case vbr_off:f=e.brate;break;default:f=e.VBR_min_bitrate_kbps}switch(s=0+(e.VBR.ordinal()<w.length?w[e.VBR.ordinal()]:0),u.findReplayGain&&(u.RadioGain>510&&(u.RadioGain=510),u.RadioGain<-510&&(u.RadioGain=-510),M=8192,M|=3072,u.RadioGain>=0?M|=u.RadioGain:(M|=512,M|=-u.RadioGain)),u.findPeakSample&&(A=Math.abs(0|u.PeakSample/32767*Math.pow(2,23)+.5)),-1!=O&&(V>0&&(P=!0),V<O-1&&(I=!0)),c=L+((T?1:0)<<4)+((x?1:0)<<5)+((I?1:0)<<6)+((P?1:0)<<7),m<0&&(m=0),e.mode){case MONO:R=0;break;case STEREO:R=1;break;case DUAL_CHANNEL:R=2;break;case JOINT_STEREO:R=e.force_ms?4:3;break;case NOT_SET:default:R=7}k=e.in_samplerate<=32e3?0:48e3==e.in_samplerate?2:e.in_samplerate>48e3?3:1,(e.short_blocks==r.short_block_forced||e.short_blocks==r.short_block_dispensed||-1==e.lowpassfreq&&-1==e.highpassfreq||e.scale_left<e.scale_right||e.scale_left>e.scale_right||e.disable_reservoir&&e.brate<320||e.noATH||e.ATHonly||0==L||e.in_samplerate<=32e3)&&(E=1),o=B+(R<<2)+(E<<5)+(k<<6),l=u.nMusicCRC,b(n,a+h,m),h+=4;for(var N=0;N<9;N++)n[a+h+N]=255&g.charAt(N);n[a+(h+=9)]=255&s,n[a+ ++h]=255&S,b(n,a+ ++h,A),v(n,a+(h+=4),M),v(n,a+(h+=2),0),n[a+(h+=2)]=255&c,n[a+ ++h]=f>=255?255:255&f,n[a+ ++h]=255&d>>4,n[a+h+1]=255&(d<<4)+(p>>8),n[a+h+2]=255&p,n[a+(h+=3)]=255&o,h++,n[a+h++]=0,v(n,a+h,e.preset),b(n,a+(h+=2),t),v(n,a+(h+=4),l),h+=2;for(var H=0;H<h;H++)i=y(n[a+H],i);return v(n,a+h,i),h+2}(e,m,s,p,g),o.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(e,t){if(e.internal_flags.VBR_seek_table.pos<=0)return-1;if(t.seek(t.length()),0==t.length())return-1;var n=function(e){e.seek(0);var t=i(10);return e.readFully(t),new String(t,"ISO-8859-1").startsWith("ID3")?0:((127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9])+t.length}(t);t.seek(n);var r=i(f),a=getLameTagFrame(e,r);return a>r.length?-1:(a<1||t.write(r,0,a),0)}}return o.NUMTOCENTRIES=100,o.MAXFRAMESIZE=2880,Yn=o}var dr=function(){if(Un)return zn;Un=1;var e=Zn();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n;var t=e.new_byte;e.new_double,e.new_float,e.new_float_n,e.new_int,e.new_int_n;var n=e.assert,r=cr(),a=fr(),i=ar(),s=or(),o=ur(),l=lr(),_=function(){if(jn)return Fn;jn=1;var e=Zn().assert;return Fn=function(){var t;this.setModules=function(e){t=e},this.ResvFrameBegin=function(n,r){var a,i=n.internal_flags,s=i.l3_side,o=t.getframebits(n);r.bits=(o-8*i.sideinfo_len)/i.mode_gr;var l=2048*i.mode_gr-8;n.brate>320?a=8*int(1e3*n.brate/(n.out_samplerate/1152)/8+.5):(a=11520,n.strict_ISO&&(a=8*int(32e4/(n.out_samplerate/1152)/8+.5))),i.ResvMax=a-o,i.ResvMax>l&&(i.ResvMax=l),(i.ResvMax<0||n.disable_reservoir)&&(i.ResvMax=0);var _=r.bits*i.mode_gr+Math.min(i.ResvSize,i.ResvMax);return _>a&&(_=a),e(0==i.ResvMax%8),e(i.ResvMax>=0),s.resvDrain_pre=0,null!=i.pinfo&&(i.pinfo.mean_bits=r.bits/2,i.pinfo.resvsize=i.ResvSize),_},this.ResvMaxBits=function(e,t,n,r){var a,i=e.internal_flags,s=i.ResvSize,o=i.ResvMax;0!=r&&(s+=t),1&i.substep_shaping&&(o*=.9),n.bits=t,10*s>9*o?(a=s-9*o/10,n.bits+=a,i.substep_shaping|=128):(a=0,i.substep_shaping&=127,e.disable_reservoir||1&i.substep_shaping||(n.bits-=.1*t));var l=s<6*i.ResvMax/10?s:6*i.ResvMax/10;return(l-=a)<0&&(l=0),l},this.ResvAdjust=function(e,t){e.ResvSize-=t.part2_3_length+t.part2_length},this.ResvFrameEnd=function(t,n){var r,a=t.l3_side;t.ResvSize+=n*t.mode_gr;var i=0;a.resvDrain_post=0,a.resvDrain_pre=0,0!=(r=t.ResvSize%8)&&(i+=r),(r=t.ResvSize-i-t.ResvMax)>0&&(e(0==r%8),e(r>=0),i+=r);var s=Math.min(8*a.main_data_begin,i)/8;a.resvDrain_pre+=8*s,i-=8*s,t.ResvSize-=8*s,a.main_data_begin-=s,a.resvDrain_post+=i,t.ResvSize-=i}}}(),c=Jn(),f=_r();Qn();var u=qn?Xn:(qn=1,Xn=function(){this.getLameVersion=function(){return"3.98.4"},this.getLameShortVersion=function(){return"3.98.4"},this.getLameVeryShortVersion=function(){return"LAME3.98r"},this.getPsyVersion=function(){return"0.93"},this.getLameUrl=function(){return"http://www.mp3dev.org/"},this.getLameOsBitness=function(){return"32bits"}}),h=hr();function d(){this.setModules=function(e,t){}}function p(){this.setModules=function(e,t,n){}}function m(){}function b(){this.setModules=function(e,t){}}function v(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function g(e){return e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3)}return v.RIFF=g("RIFF"),v.WAVE=g("WAVE"),v.fmt_=g("fmt "),v.data=g("data"),v.readHeader=function(e){var t=new v,n=e.getUint32(0,!1);if(v.RIFF==n&&(e.getUint32(4,!0),v.WAVE==e.getUint32(8,!1)&&v.fmt_==e.getUint32(12,!1))){var r=e.getUint32(16,!0),a=20;switch(r){case 16:case 18:t.channels=e.getUint16(a+2,!0),t.sampleRate=e.getUint32(a+4,!0);break;default:throw"extended fmt chunk not implemented"}a+=r;for(var i=v.data,s=0;i!=n&&(n=e.getUint32(a,!1),s=e.getUint32(a+4,!0),i!=n);)a+=s+8;return t.dataLen=s,t.dataOffset=a+8,t}},zn.Mp3Encoder=function(e,v,g){3!=arguments.length&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),e=1,v=44100,g=128);var w=new r,y=new d,S=new i,A=new f,M=new a,B=new s,R=new o,E=new h,k=new u,T=new b,x=new _,I=new l,P=new p,O=new m;w.setModules(S,A,M,B,R,E,k,T,O),A.setModules(S,O,k,E),T.setModules(A,k),M.setModules(w),R.setModules(A,x,B,I),B.setModules(I,x,w.enc.psy),x.setModules(A),I.setModules(B),E.setModules(w,A,k),y.setModules(P,O),P.setModules(k,T,M);var V=w.lame_init();V.num_channels=e,V.in_samplerate=v,V.brate=g,V.mode=c.STEREO,V.quality=3,V.bWriteVbrTag=!1,V.disable_reservoir=!0,V.write_id3tag_automatic=!1;var L=w.lame_init_params(V);n(0==L);var N=1152,H=0|1.25*N+7200,D=t(H);this.encodeBuffer=function(r,a){1==e&&(a=r),n(r.length==a.length),r.length>N&&(N=r.length,D=t(H=0|1.25*N+7200));var i=w.lame_encode_buffer(V,r,a,r.length,D,0,H);return new Int8Array(D.subarray(0,i))},this.flush=function(){var e=w.lame_encode_flush(V,D,0,H);return new Int8Array(D.subarray(0,e))}},zn.WavHeader=v,zn}(),pr=s(dr),mr=s(Jn()),br=s(cr()),vr=s(_r());let gr=class extends Bt{getFormat(){return"mp3"}init(){const e="undefined"!=typeof self?self:window;e.MPEGMode=mr,e.Lame=br,e.BitStream=vr}encodeAudio(e,t){return n(this,void 0,void 0,(function*(){return(yield this.isWebAudioEncoderAPISupportedForSettings(t))?this.encodeWithWebAudioEncoderAPI(e,t):this.encodeMP3LameJS(e,t)}))}encodeMP3LameJS(e,t){const n=new pr.Mp3Encoder(Math.max(2,t.numChannels),t.sampleRate,t.bitrate),a=[],i=r.convertFloat32Array2Int16(e[0]),s=r.convertFloat32Array2Int16(e[1]),o=1152;for(let e=0;e<i.length;e+=o){const t=i.subarray(e,e+o),r=s.subarray(e,e+o),l=n.encodeBuffer(t,r);l.length>0&&a.push(l)}const l=n.flush();return l.length>0&&a.push(l),r.mergeBuffers(a).buffer}};e([(e,t,n)=>{try{p(e.constructor,N,H,(r=t,e=>{if(void 0!==e.lifecycle.postConstructMethodName)throw new F(j.injectionDecoratorConflict,"Unexpected duplicated postConstruct decorator");return e.lifecycle.postConstructMethodName=r,e}))}catch(n){W(e,t,void 0,n)}var r},t("design:type",Function),t("design:paramtypes",[]),t("design:returntype",void 0)],gr.prototype,"init",null),gr=e([ee()],gr);var wr=gr;let yr,Sr,Ar,Mr=0,Br=[];const Rr=function(){const e=new Mt({defaultScope:"Singleton"});return e.bind(a.BaseAudioEncoder).to(Tt),e.bind(a.AudioEncoders).to(Kn),e.bind(a.AudioEncoders).to(wr),e}().get(a.BaseAudioEncoder),Er=()=>{for(let e=0;e<Sr;e++)Br[e]=[]},kr=()=>{const e=[];for(let t=0;t<Sr;t++)e.push(r.mergeBuffers(Br[t]));return e},Tr=(e,t)=>n(void 0,void 0,void 0,(function*(){const n=yield Rr.encodeAudio(kr(),{audioLength:Mr,bitrate:Ar,format:e,numChannels:Sr,sampleRate:yr}),r=new Blob([n],{type:t});self.postMessage({command:"exportMP3",data:r})}));self.onmessage=function(e){switch(e.data.command){case"init":t=e.data.config,yr=t.sampleRate,Sr=t.numChannels,Ar=t.bitrate||128,Er();break;case"record":(e=>{for(let t=0;t<Sr;t++)Br[t].push(e[t]);Mr+=e[0].length})(e.data.buffer);break;case"exportWAV":Tr("wav",e.data.type);break;case"exportMP3":Tr("mp3",e.data.type);break;case"getBuffer":(()=>{const e=kr();self.postMessage({command:"getBuffer",data:e})})();break;case"clear":Mr=0,Br=[],Er()}var t};
