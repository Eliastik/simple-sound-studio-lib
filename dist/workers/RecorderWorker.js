function e(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s}function t(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function n(e,t,n,r){return new(n||(n=Promise))(function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,o)}l((r=r.apply(e,t||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;const r={calcAudioDuration:(e,t)=>{if(e){let n=e.duration+1;return null!=t&&(n/=t),n}return 0},loadAudioBuffer:(e,t)=>n(void 0,void 0,void 0,function*(){const n=yield r.readAsArrayBufferPromisified(t),i=yield e.decodeAudioData(n);return r.decodeBuffer(e,i)}),readAsArrayBufferPromisified:e=>new Promise((t,n)=>{const r=new FileReader;r.onload=e=>{var r;const i=null===(r=null==e?void 0:e.target)||void 0===r?void 0:r.result;i instanceof ArrayBuffer?t(i):n()},e&&r.readAsArrayBuffer(e)}),decodeBuffer:(e,t)=>{if(1==t.numberOfChannels){e.resume();const{duration:n}=t,{sampleRate:r}=e,i=e.createBuffer(2,r*n+2*r,r),a=t.getChannelData(0),s=i.getChannelData(0),o=i.getChannelData(1);for(let e=0;e<a.length;e++)s[e]=a[e],o[e]=a[e];return i}return t},convertAudioBufferToFloat32Array:e=>{const t=[];for(let n=0;n<e.numberOfChannels;n++)t.push(e.getChannelData(n));return t},convertAudioParamToFloat32Array:(e,t)=>{const n=new Float32Array(t);for(let r=0;r<t;r++)n.set([e.value],r);return n},sumAudioBufferChannel:(e,t)=>e.getChannelData(t).reduce((e,t)=>e+t,0),sumAudioBuffer(e){let t=0;for(let n=0;n<e.numberOfChannels;n++)t+=this.sumAudioBufferChannel(e,n);return t},isAudioWorkletCompatible:e=>void 0!==e&&void 0!==e.audioWorklet,isSettingValueValid:e=>!(void 0===e||isNaN(Number(e))||"string"==typeof e&&""===e.trim()),calculateAudioDuration(e,t,n){if(e&&t){const r=this.calcAudioDuration(e,n),i=t.getAddingTime();return i?r+i:r}return 0},forceDownload(e,t){const n=window.document.createElement("a"),r=URL.createObjectURL(e);window.document.body.appendChild(n),n.href=r,n.download=t||"output.wav",n.click(),URL.revokeObjectURL(r),window.document.body.removeChild(n)},clearAudioBuffer(e){if(e)for(let t=0;t<e.numberOfChannels;t++){const n=e.getChannelData(t);for(let e=0;e<n.length;e++)n[e]=0}},floatTo16BitPCM(e,t,n){for(let r=0;r<n.length;r++,t+=2){const i=this.clampFloatValue(n[r]);e.setInt16(t,i<0?32768*i:32767*i,!0)}},convertFloat32Array2Int16(e){const t=new Int16Array(e.length);for(let n=0,r=e.length;n<r;n++){const r=this.clampFloatValue(e[n]);t[n]=Math.round(32767*r)}return t},clampFloatValue:e=>Math.max(-1,Math.min(1,e)),writeStringToDataView(e,t,n){for(let r=0;r<n.length;r++)e.setUint8(t+r,n.charCodeAt(r))},interleaveBuffers(e,t){const n=e.length+t.length;if(0===n)throw new Error("interleaveBuffers: input buffers are empty or invalid");const r=new(0,e.constructor)(n);let i=0,a=0;for(;i<n;)r[i++]=e[a],r[i++]=t[a],a++;return r},getLengthFromBuffers:e=>e?e.reduce((e,t)=>e+t.length,0):0,mergeBuffers(e){const t=this.getLengthFromBuffers(e);if(0===t)throw new Error("mergeTypedArrayBuffers: input buffers are empty or invalid");const n=new(0,e[0].constructor)(t);let r=0;for(const t of e)t?(n.set(t,r),r+=t.length):console.warn("mergeTypedArrayBuffers: undefined buffer has been detected");return n}},i={AudioEncoderManager:Symbol.for("AudioEncoderManager"),AudioEncoders:Symbol.for("AudioEncoders")};var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function s(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var o,l={};
/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0
THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.
See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function _(e){return("object"==typeof e&&null!==e||"function"==typeof e)&&"function"==typeof e.then}function c(e){switch(typeof e){case"string":case"symbol":return e.toString();case"function":return e.name;default:throw new Error(`Unexpected ${typeof e} service id type`)}}!function(){return o||(o=1,function(e){!function(){var t="object"==typeof globalThis?globalThis:"object"==typeof a?a:"object"==typeof self?self:"object"==typeof this?this:function(){try{return Function("return this;")()}catch(e){}}()||function(){try{return(0,eval)("(function() { return this; })()")}catch(e){}}(),n=r(e);function r(e,t){return function(n,r){Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0!==t.Reflect&&(n=r(t.Reflect,n)),function(e,t){var n=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,i=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",a=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",s="function"==typeof Object.create,o={__proto__:[]}instanceof Array,l=!s&&!o,_={create:s?function(){return ue(Object.create(null))}:o?function(){return ue({__proto__:null})}:function(){return ue({})},has:l?function(e,t){return n.call(e,t)}:function(e,t){return t in e},get:l?function(e,t){return n.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},c=Object.getPrototypeOf(Function),u="function"==typeof Map&&"function"==typeof Map.prototype.entries?Map:le(),f="function"==typeof Set&&"function"==typeof Set.prototype.entries?Set:_e(),h="function"==typeof WeakMap?WeakMap:ce(),d=r?Symbol.for("@reflect-metadata:registry"):void 0,p=ie(),m=ae(p);function b(e,t,n,r){if(C(n)){if(!U(e))throw new TypeError;if(!z(t))throw new TypeError;return E(e,t)}if(!U(e))throw new TypeError;if(!j(t))throw new TypeError;if(!j(r)&&!C(r)&&!D(r))throw new TypeError;return D(r)&&(r=void 0),k(e,t,n=G(n),r)}function v(e,t){function n(n,r){if(!j(n))throw new TypeError;if(!C(r)&&!Z(r))throw new TypeError;O(e,t,n,r)}return n}function g(e,t,n,r){if(!j(n))throw new TypeError;return C(r)||(r=G(r)),O(e,t,n,r)}function y(e,t,n){if(!j(t))throw new TypeError;return C(n)||(n=G(n)),T(e,t,n)}function w(e,t,n){if(!j(t))throw new TypeError;return C(n)||(n=G(n)),I(e,t,n)}function S(e,t,n){if(!j(t))throw new TypeError;return C(n)||(n=G(n)),x(e,t,n)}function A(e,t,n){if(!j(t))throw new TypeError;return C(n)||(n=G(n)),P(e,t,n)}function M(e,t){if(!j(e))throw new TypeError;return C(t)||(t=G(t)),L(e,t)}function R(e,t){if(!j(e))throw new TypeError;return C(t)||(t=G(t)),N(e,t)}function B(e,t,n){if(!j(t))throw new TypeError;if(C(n)||(n=G(n)),!j(t))throw new TypeError;C(n)||(n=G(n));var r=oe(t,n,!1);return!C(r)&&r.OrdinaryDeleteMetadata(e,t,n)}function E(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!C(r)&&!D(r)){if(!z(r))throw new TypeError;t=r}}return t}function k(e,t,n,r){for(var i=e.length-1;i>=0;--i){var a=(0,e[i])(t,n,r);if(!C(a)&&!D(a)){if(!j(a))throw new TypeError;r=a}}return r}function T(e,t,n){if(I(e,t,n))return!0;var r=ne(t);return!D(r)&&T(e,r,n)}function I(e,t,n){var r=oe(t,n,!1);return!C(r)&&q(r.OrdinaryHasOwnMetadata(e,t,n))}function x(e,t,n){if(I(e,t,n))return P(e,t,n);var r=ne(t);return D(r)?void 0:x(e,r,n)}function P(e,t,n){var r=oe(t,n,!1);if(!C(r))return r.OrdinaryGetOwnMetadata(e,t,n)}function O(e,t,n,r){oe(n,r,!0).OrdinaryDefineOwnMetadata(e,t,n,r)}function L(e,t){var n=N(e,t),r=ne(e);if(null===r)return n;var i=L(r,t);if(i.length<=0)return n;if(n.length<=0)return i;for(var a=new f,s=[],o=0,l=n;o<l.length;o++){var _=l[o];a.has(_)||(a.add(_),s.push(_))}for(var c=0,u=i;c<u.length;c++){_=u[c];a.has(_)||(a.add(_),s.push(_))}return s}function N(e,t){var n=oe(e,t,!1);return n?n.OrdinaryOwnMetadataKeys(e,t):[]}function V(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function C(e){return void 0===e}function D(e){return null===e}function H(e){return"symbol"==typeof e}function j(e){return"object"==typeof e?null!==e:"function"==typeof e}function F(e,t){switch(V(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n="string",r=$(e,i);if(void 0!==r){var a=r.call(e,n);if(j(a))throw new TypeError;return a}return X(e)}function X(e,t){var n,r,i=e.toString;if(K(i)&&!j(r=i.call(e)))return r;if(K(n=e.valueOf)&&!j(r=n.call(e)))return r;throw new TypeError}function q(e){return!!e}function Y(e){return""+e}function G(e){var t=F(e);return H(t)?t:Y(t)}function U(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function K(e){return"function"==typeof e}function z(e){return"function"==typeof e}function Z(e){switch(V(e)){case 3:case 4:return!0;default:return!1}}function W(e,t){return e===t||e!=e&&t!=t}function $(e,t){var n=e[t];if(null!=n){if(!K(n))throw new TypeError;return n}}function Q(e){var t=$(e,a);if(!K(t))throw new TypeError;var n=t.call(e);if(!j(n))throw new TypeError;return n}function J(e){return e.value}function ee(e){var t=e.next();return!t.done&&t}function te(e){var t=e.return;t&&t.call(e)}function ne(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===c)return t;if(t!==c)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var i=r.constructor;return"function"!=typeof i||i===e?t:i}function re(){var e,n,r,i;C(d)||void 0===t.Reflect||d in t.Reflect||"function"!=typeof t.Reflect.defineMetadata||(e=se(t.Reflect));var a=new h,s={registerProvider:o,getProvider:_,setProvider:p};return s;function o(t){if(!Object.isExtensible(s))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===t:break;case C(n):n=t;break;case n===t:break;case C(r):r=t;break;case r===t:break;default:void 0===i&&(i=new f),i.add(t)}}function l(t,a){if(!C(n)){if(n.isProviderFor(t,a))return n;if(!C(r)){if(r.isProviderFor(t,a))return n;if(!C(i))for(var s=Q(i);;){var o=ee(s);if(!o)return;var l=J(o);if(l.isProviderFor(t,a))return te(s),l}}}if(!C(e)&&e.isProviderFor(t,a))return e}function _(e,t){var n,r=a.get(e);return C(r)||(n=r.get(t)),C(n)?(C(n=l(e,t))||(C(r)&&(r=new u,a.set(e,r)),r.set(t,n)),n):n}function c(e){if(C(e))throw new TypeError;return n===e||r===e||!C(i)&&i.has(e)}function p(e,t,n){if(!c(n))throw new Error("Metadata provider not registered.");var r=_(e,t);if(r!==n){if(!C(r))return!1;var i=a.get(e);C(i)&&(i=new u,a.set(e,i)),i.set(t,n)}return!0}}function ie(){var e;return!C(d)&&j(t.Reflect)&&Object.isExtensible(t.Reflect)&&(e=t.Reflect[d]),C(e)&&(e=re()),!C(d)&&j(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,d,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}function ae(e){var t=new h,n={isProviderFor:function(e,n){var r=t.get(e);return!C(r)&&r.has(n)},OrdinaryDefineOwnMetadata:s,OrdinaryHasOwnMetadata:i,OrdinaryGetOwnMetadata:a,OrdinaryOwnMetadataKeys:o,OrdinaryDeleteMetadata:l};return p.registerProvider(n),n;function r(r,i,a){var s=t.get(r),o=!1;if(C(s)){if(!a)return;s=new u,t.set(r,s),o=!0}var l=s.get(i);if(C(l)){if(!a)return;if(l=new u,s.set(i,l),!e.setProvider(r,i,n))throw s.delete(i),o&&t.delete(r),new Error("Wrong provider for target.")}return l}function i(e,t,n){var i=r(t,n,!1);return!C(i)&&q(i.has(e))}function a(e,t,n){var i=r(t,n,!1);if(!C(i))return i.get(e)}function s(e,t,n,i){r(n,i,!0).set(e,t)}function o(e,t){var n=[],i=r(e,t,!1);if(C(i))return n;for(var a=Q(i.keys()),s=0;;){var o=ee(a);if(!o)return n.length=s,n;var l=J(o);try{n[s]=l}catch(e){try{te(a)}finally{throw e}}s++}}function l(e,n,i){var a=r(n,i,!1);if(C(a))return!1;if(!a.delete(e))return!1;if(0===a.size){var s=t.get(n);C(s)||(s.delete(i),0===s.size&&t.delete(s))}return!0}}function se(e){var t=e.defineMetadata,n=e.hasOwnMetadata,r=e.getOwnMetadata,i=e.getOwnMetadataKeys,a=e.deleteMetadata,s=new h,o={isProviderFor:function(e,t){var n=s.get(e);return!(C(n)||!n.has(t))||!!i(e,t).length&&(C(n)&&(n=new f,s.set(e,n)),n.add(t),!0)},OrdinaryDefineOwnMetadata:t,OrdinaryHasOwnMetadata:n,OrdinaryGetOwnMetadata:r,OrdinaryOwnMetadataKeys:i,OrdinaryDeleteMetadata:a};return o}function oe(e,t,n){var r=p.getProvider(e,t);if(!C(r))return r;if(n){if(p.setProvider(e,t,m))return m;throw new Error("Illegal state.")}}function le(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[a]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,W(t,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,i)},t.prototype.entries=function(){return new n(this._keys,this._values,s)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[a]=function(){return this.entries()},t.prototype._find=function(e,t){if(!W(this._cacheKey,e)){this._cacheIndex=-1;for(var n=0;n<this._keys.length;n++)if(W(this._keys[n],e)){this._cacheIndex=n;break}}return this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function i(e,t){return t}function s(e,t){return[e,t]}}function _e(){return function(){function e(){this._map=new u}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.keys()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[a]=function(){return this.keys()},e}()}function ce(){var e=16,t=_.create(),r=i();return function(){function e(){this._key=i()}return e.prototype.has=function(e){var t=a(e,!1);return void 0!==t&&_.has(t,this._key)},e.prototype.get=function(e){var t=a(e,!1);return void 0!==t?_.get(t,this._key):void 0},e.prototype.set=function(e,t){return a(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=a(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=i()},e}();function i(){var e;do{e="@@WeakMap@@"+l()}while(_.has(t,e));return t[e]=!0,e}function a(e,t){if(!n.call(e,r)){if(!t)return;Object.defineProperty(e,r,{value:_.create()})}return e[r]}function s(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function o(e){if("function"==typeof Uint8Array){var t=new Uint8Array(e);return"undefined"!=typeof crypto?crypto.getRandomValues(t):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(t):s(t,e),t}return s(new Array(e),e)}function l(){var t=o(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",r=0;r<e;++r){var i=t[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}function ue(e){return e.__=void 0,delete e.__,e}e("decorate",b),e("metadata",v),e("defineMetadata",g),e("hasMetadata",y),e("hasOwnMetadata",w),e("getMetadata",S),e("getOwnMetadata",A),e("getMetadataKeys",M),e("getOwnMetadataKeys",R),e("deleteMetadata",B)}(n,t),void 0===t.Reflect&&(t.Reflect=e)}()}(e||(e={}))),l;var e}();const u=Symbol.for("@inversifyjs/common/islazyServiceIdentifier");class f{[u];#e;constructor(e){this.#e=e,this[u]=!0}static is(e){return"object"==typeof e&&null!==e&&!0===e[u]}unwrap(){return this.#e()}}function h(e,t,n){return Reflect.getOwnMetadata(t,e,n)}function d(e,t,n,r){Reflect.defineMetadata(t,n,e,r)}function p(e,t,n,r,i){const a=r(h(e,t,i)??n());Reflect.defineMetadata(t,a,e,i)}const m="@inversifyjs/container/bindingId";function b(){const e=h(Object,m)??0;return e===Number.MAX_SAFE_INTEGER?d(Object,m,Number.MIN_SAFE_INTEGER):p(Object,m,()=>e,e=>e+1),e}const v="Request",g="Singleton",y="Transient",w="ConstantValue",S="DynamicValue",A="Factory",M="Instance",R="Provider",B="ResolvedValue",E="ServiceRedirection";function*k(...e){for(const t of e)yield*t}class T{#e;#t;#n;constructor(e){this.#e=new Map,this.#t={};for(const t of Reflect.ownKeys(e))this.#t[t]=new Map;this.#n=e}add(e,t){this.#r(e).push(t);for(const n of Reflect.ownKeys(t))this.#i(n,t[n]).push(e)}clone(){const e=this.#a(),t=this.#s(),n=Reflect.ownKeys(this.#n),r=this._buildNewInstance(this.#n);this.#o(this.#e,r.#e,e,t);for(const t of n)this.#l(this.#t[t],r.#t[t],e);return r}get(e,t){return this.#t[e].get(t)}getAllKeys(e){return this.#t[e].keys()}removeByRelation(e,t){const n=this.get(e,t);if(void 0===n)return;const r=new Set(n);for(const n of r){const r=this.#e.get(n);if(void 0===r)throw new Error("Expecting model relation, none found");for(const i of r)i[e]===t&&this.#_(n,i);this.#e.delete(n)}}_buildNewInstance(e){return new T(e)}_cloneModel(e){return e}_cloneRelation(e){return e}#a(){const e=new Map;for(const t of this.#e.keys()){const n=this._cloneModel(t);e.set(t,n)}return e}#s(){const e=new Map;for(const t of this.#e.values())for(const n of t){const t=this._cloneRelation(n);e.set(n,t)}return e}#r(e){let t=this.#e.get(e);return void 0===t&&(t=[],this.#e.set(e,t)),t}#i(e,t){let n=this.#t[e].get(t);return void 0===n&&(n=[],this.#t[e].set(t,n)),n}#c(e,t){const n=t.get(e);if(void 0===n)throw new Error("Expecting model to be cloned, none found");return n}#u(e,t){const n=t.get(e);if(void 0===n)throw new Error("Expecting relation to be cloned, none found");return n}#l(e,t,n){for(const[r,i]of e){const e=new Array;for(const t of i)e.push(this.#c(t,n));t.set(r,e)}}#o(e,t,n,r){for(const[i,a]of e){const e=new Array;for(const t of a)e.push(this.#u(t,r));t.set(this.#c(i,n),e)}}#_(e,t){for(const n of Reflect.ownKeys(t))this.#f(e,n,t[n])}#f(e,t,n){const r=this.#t[t].get(n);if(void 0!==r){const i=r.indexOf(e);-1!==i&&r.splice(i,1),0===r.length&&this.#t[t].delete(n)}}}var I,x,P;!function(e){e.moduleId="moduleId",e.serviceId="serviceId"}(I||(I={}));class O{#h;#d;constructor(e,t){this.#h=t??new T({moduleId:{isOptional:!0},serviceId:{isOptional:!1}}),this.#d=e}static build(e){return new O(e)}add(e,t){this.#h.add(e,t)}clone(){return new O(this.#d,this.#h.clone())}get(e){const t=[],n=this.#h.get(I.serviceId,e);void 0!==n&&t.push(n);const r=this.#d?.get(e);if(void 0!==r&&t.push(r),0!==t.length)return k(...t)}removeAllByModuleId(e){this.#h.removeByRelation(I.moduleId,e)}removeAllByServiceId(e){this.#h.removeByRelation(I.serviceId,e)}}function L(e){return e.isRight?{isRight:!0,value:e.value}:e}!function(e){e.id="id",e.moduleId="moduleId",e.serviceId="serviceId"}(x||(x={}));class N extends T{_buildNewInstance(e){return new N(e)}_cloneModel(e){return function(e){switch(e.type){case w:case S:return function(e){return{cache:L(e.cache),id:e.id,isSatisfiedBy:e.isSatisfiedBy,moduleId:e.moduleId,onActivation:e.onActivation,onDeactivation:e.onDeactivation,scope:e.scope,serviceIdentifier:e.serviceIdentifier,type:e.type,value:e.value}}(e);case A:return function(e){return{cache:L(e.cache),factory:e.factory,id:e.id,isSatisfiedBy:e.isSatisfiedBy,moduleId:e.moduleId,onActivation:e.onActivation,onDeactivation:e.onDeactivation,scope:e.scope,serviceIdentifier:e.serviceIdentifier,type:e.type}}(e);case M:return function(e){return{cache:L(e.cache),id:e.id,implementationType:e.implementationType,isSatisfiedBy:e.isSatisfiedBy,moduleId:e.moduleId,onActivation:e.onActivation,onDeactivation:e.onDeactivation,scope:e.scope,serviceIdentifier:e.serviceIdentifier,type:e.type}}(e);case R:return function(e){return{cache:L(e.cache),id:e.id,isSatisfiedBy:e.isSatisfiedBy,moduleId:e.moduleId,onActivation:e.onActivation,onDeactivation:e.onDeactivation,provider:e.provider,scope:e.scope,serviceIdentifier:e.serviceIdentifier,type:e.type}}(e);case B:return function(e){return{cache:L(e.cache),factory:e.factory,id:e.id,isSatisfiedBy:e.isSatisfiedBy,metadata:e.metadata,moduleId:e.moduleId,onActivation:e.onActivation,onDeactivation:e.onDeactivation,scope:e.scope,serviceIdentifier:e.serviceIdentifier,type:e.type}}(e);case E:return function(e){return{id:e.id,isSatisfiedBy:e.isSatisfiedBy,moduleId:e.moduleId,serviceIdentifier:e.serviceIdentifier,targetServiceIdentifier:e.targetServiceIdentifier,type:e.type}}(e)}}(e)}}let V=class e{#p;#d;constructor(e,t){this.#p=t??new N({id:{isOptional:!1},moduleId:{isOptional:!0},serviceId:{isOptional:!1}}),this.#d=e}static build(t){return new e(t)}clone(){return new e(this.#d,this.#p.clone())}get(e){return this.getNonParentBindings(e)??this.#d?.get(e)}*getChained(e){const t=this.getNonParentBindings(e);void 0!==t&&(yield*t),void 0!==this.#d&&(yield*this.#d.getChained(e))}getBoundServices(){const e=new Set(this.#p.getAllKeys(x.serviceId));if(void 0!==this.#d)for(const t of this.#d.getBoundServices())e.add(t);return e}getById(e){return this.#p.get(x.id,e)??this.#d?.getById(e)}getByModuleId(e){return this.#p.get(x.moduleId,e)??this.#d?.getByModuleId(e)}getNonParentBindings(e){return this.#p.get(x.serviceId,e)}getNonParentBoundServices(){return this.#p.getAllKeys(x.serviceId)}removeById(e){this.#p.removeByRelation(x.id,e)}removeAllByModuleId(e){this.#p.removeByRelation(x.moduleId,e)}removeAllByServiceId(e){this.#p.removeByRelation(x.serviceId,e)}set(e){const t={[x.id]:e.id,[x.serviceId]:e.serviceIdentifier};void 0!==e.moduleId&&(t[x.moduleId]=e.moduleId),this.#p.add(e,t)}};!function(e){e.moduleId="moduleId",e.serviceId="serviceId"}(P||(P={}));let C=class e{#m;#d;constructor(e,t){this.#m=t??new T({moduleId:{isOptional:!0},serviceId:{isOptional:!1}}),this.#d=e}static build(t){return new e(t)}add(e,t){this.#m.add(e,t)}clone(){return new e(this.#d,this.#m.clone())}get(e){const t=[],n=this.#m.get(P.serviceId,e);void 0!==n&&t.push(n);const r=this.#d?.get(e);if(void 0!==r&&t.push(r),0!==t.length)return k(...t)}removeAllByModuleId(e){this.#m.removeByRelation(P.moduleId,e)}removeAllByServiceId(e){this.#m.removeByRelation(P.serviceId,e)}};const D="@inversifyjs/core/classMetadataReflectKey";function H(){return{constructorArguments:[],lifecycle:{postConstructMethodName:void 0,preDestroyMethodName:void 0},properties:new Map,scope:void 0}}const j="@inversifyjs/core/pendingClassMetadataCountReflectKey",F=Symbol.for("@inversifyjs/core/InversifyCoreError");let X=class e extends Error{[F];kind;constructor(e,t,n){super(t,n),this[F]=!0,this.kind=e}static is(e){return"object"==typeof e&&null!==e&&!0===e[F]}static isErrorOfKind(t,n){return e.is(t)&&t.kind===n}};var q,Y,G;function U(e){const t=h(e,D)??H();if(!function(e){const t=h(e,j);return void 0!==t&&0!==t}(e))return function(e,t){const n=[];if(t.length<e.length)throw new X(q.missingInjectionDecorator,`Found unexpected missing metadata on type "${e.name}". "${e.name}" constructor requires at least ${e.length.toString()} arguments, found ${t.length.toString()} instead.\nAre you using @inject, @multiInject or @unmanaged decorators in every non optional constructor argument?\n\nIf you're using typescript and want to rely on auto injection, set "emitDecoratorMetadata" compiler option to true`);for(let e=0;e<t.length;++e)void 0===t[e]&&n.push(e);if(n.length>0)throw new X(q.missingInjectionDecorator,`Found unexpected missing metadata on type "${e.name}" at constructor indexes "${n.join('", "')}".\n\nAre you using @inject, @multiInject or @unmanaged decorators at those indexes?\n\nIf you're using typescript and want to rely on auto injection, set "emitDecoratorMetadata" compiler option to true`)}(e,t.constructorArguments),t;!function(e,t){const n=[];for(let r=0;r<t.constructorArguments.length;++r){const i=t.constructorArguments[r];void 0!==i&&i.kind!==Y.unknown||n.push(`  - Missing or incomplete metadata for type "${e.name}" at constructor argument with index ${r.toString()}.\nEvery constructor parameter must be decorated either with @inject, @multiInject or @unmanaged decorator.`)}for(const[r,i]of t.properties)i.kind===Y.unknown&&n.push(`  - Missing or incomplete metadata for type "${e.name}" at property "${r.toString()}".\nThis property must be decorated either with @inject or @multiInject decorator.`);if(0===n.length)throw new X(q.unknown,`Unexpected class metadata for type "${e.name}" with uncompletion traces.\nThis might be caused by one of the following reasons:\n\n1. A third party library is targeting inversify reflection metadata.\n2. A bug is causing the issue. Consider submiting an issue to fix it.`);throw new X(q.missingInjectionDecorator,`Invalid class metadata at type ${e.name}:\n\n${n.join("\n\n")}`)}(e,t)}function K(){return 0}function z(e){return t=>{void 0!==t&&t.kind===Y.unknown&&p(e,j,K,e=>e-1)}}!function(e){e[e.injectionDecoratorConflict=0]="injectionDecoratorConflict",e[e.missingInjectionDecorator=1]="missingInjectionDecorator",e[e.planning=2]="planning",e[e.resolution=3]="resolution",e[e.unknown=4]="unknown"}(q||(q={})),function(e){e[e.unknown=32]="unknown"}(Y||(Y={})),function(e){e[e.multipleInjection=0]="multipleInjection",e[e.singleInjection=1]="singleInjection",e[e.unmanaged=2]="unmanaged"}(G||(G={}));const Z=function(e,t){return(...n)=>r=>{if(void 0===r)return e(...n);if(r.kind===G.unmanaged)throw new X(q.injectionDecoratorConflict,"Unexpected injection found. Multiple @inject, @multiInject or @unmanaged decorators found");return t(r,...n)}}(function(e,t,n){return e===G.multipleInjection?{chained:n?.chained??!1,kind:e,name:void 0,optional:!1,tags:new Map,value:t}:{kind:e,name:void 0,optional:!1,tags:new Map,value:t}},function(e,t,n,r){return function(e){if(e.kind!==Y.unknown&&!0!==e.isFromTypescriptParamType)throw new X(q.injectionDecoratorConflict,"Unexpected injection found. Multiple @inject, @multiInject or @unmanaged decorators found")}(e),t===G.multipleInjection?{...e,chained:r?.chained??!1,kind:t,value:n}:{...e,kind:t,value:n}});function W(e,t){return n=>{const r=n.properties.get(t);return n.properties.set(t,e(r)),n}}var $;function Q(e,t,n,r){if(X.isErrorOfKind(r,q.injectionDecoratorConflict)){const i=function(e,t,n){if(void 0===n){if(void 0===t)throw new X(q.unknown,"Unexpected undefined property and index values");return{kind:$.property,property:t,targetClass:e.constructor}}return"number"==typeof n?{index:n,kind:$.parameter,targetClass:e}:{kind:$.method,method:t,targetClass:e}}(e,t,n);throw new X(q.injectionDecoratorConflict,`Unexpected injection error.\n\nCause:\n\n${r.message}\n\nDetails\n\n${function(e){switch(e.kind){case $.method:return`[class: "${e.targetClass.name}", method: "${e.method.toString()}"]`;case $.parameter:return`[class: "${e.targetClass.name}", index: "${e.index.toString()}"]`;case $.property:return`[class: "${e.targetClass.name}", property: "${e.property.toString()}"]`}}(i)}`,{cause:r})}throw r}function J(e,t){return n=>{const r=t(n);return t=>(r(t),e(t))}}!function(e){e[e.method=0]="method",e[e.parameter=1]="parameter",e[e.property=2]="property"}($||($={}));const ee="@inversifyjs/core/classIsInjectableFlagReflectKey",te=[Array,BigInt,Boolean,Function,Number,Object,String];function ne(e){return e=>{!function(e){if(void 0!==h(e,ee))throw new X(q.injectionDecoratorConflict,`Cannot apply @injectable decorator multiple times at class "${e.name}"`);d(e,ee,!0)}(e),function(e){const t=h(e,"design:paramtypes");void 0!==t&&p(e,D,H,function(e){return t=>(e.forEach((e,n)=>{var r;void 0!==t.constructorArguments[n]||(r=e,te.includes(r))||(t.constructorArguments[n]=function(e){return{isFromTypescriptParamType:!0,kind:G.singleInjection,name:void 0,optional:!1,tags:new Map,value:e}}(e))}),t)}(t))}(e)}}var re,ie;!function(e){e[e.multipleInjection=0]="multipleInjection",e[e.singleInjection=1]="singleInjection"}(re||(re={}));class ae{#b;constructor(e){this.#b=e}get name(){return this.#b.elem.name}get serviceIdentifier(){return this.#b.elem.serviceIdentifier}get tags(){return this.#b.elem.tags}getAncestor(){if(void 0!==this.#b.previous)return new ae(this.#b.previous)}}class se{last;constructor(e){this.last=e}concat(e){return new se({elem:e,previous:this.last})}[Symbol.iterator](){let e=this.last;return{next:()=>{if(void 0===e)return{done:!0,value:void 0};const t=e.elem;return e=e.previous,{done:!1,value:t}}}}}function oe(e,t,n){const r=n?.customServiceIdentifier??t.serviceIdentifier,i=(!0===n?.chained?[...e.getBindingsChained(r)]:[...e.getBindings(r)??[]]).filter(e=>e.isSatisfiedBy(t));if(0===i.length&&void 0!==e.autobindOptions&&"function"==typeof r){const t=function(e,t){const n=U(t).scope??e.scope;return{cache:{isRight:!1,value:void 0},id:b(),implementationType:t,isSatisfiedBy:()=>!0,moduleId:void 0,onActivation:void 0,onDeactivation:void 0,scope:n,serviceIdentifier:t,type:M}}(e.autobindOptions,r);e.setBinding(t),i.push(t)}return i}function le(e){return void 0!==e.redirections}function _e(e,t,n,r){let i,a;le(n)?(i=n.binding.targetServiceIdentifier,a=n.binding.serviceIdentifier):(i=n.serviceIdentifier,a=n.parent?.binding.serviceIdentifier),Array.isArray(e)?function(e,t,n,r,i){if(0!==e.length){const t=`Ambiguous bindings found for service: "${c(n)}".\n\nRegistered bindings:\n\n${e.map(e=>function(e){switch(e.type){case M:return`[ type: "${e.type}", serviceIdentifier: "${c(e.serviceIdentifier)}", scope: "${e.scope}", implementationType: "${e.implementationType.name}" ]`;case E:return`[ type: "${e.type}", serviceIdentifier: "${c(e.serviceIdentifier)}", redirection: "${c(e.targetServiceIdentifier)}" ]`;default:return`[ type: "${e.type}", serviceIdentifier: "${c(e.serviceIdentifier)}", scope: "${e.scope}" ]`}}(e.binding)).join("\n")}\n\nTrying to resolve bindings for "${ue(n,r)}".\n\n${fe(i)}`;throw new X(q.planning,t)}t||ce(n,r,i)}(e,t,i,a,r):function(e,t,n,r,i){void 0!==e||t||ce(n,r,i)}(e,t,i,a,r)}function ce(e,t,n){const r=`No bindings found for service: "${c(e)}".\n\nTrying to resolve bindings for "${ue(e,t)}".\n\n${fe(n)}`;throw new X(q.planning,r)}function ue(e,t){return void 0===t?`${c(e)} (Root service)`:c(t)}function fe(e){const t=0===e.tags.size?"":`\n- tags:\n  - ${[...e.tags.keys()].map(e=>e.toString()).join("\n  - ")}`;return`Binding constraints:\n- service identifier: ${c(e.serviceIdentifier)}\n- name: ${e.name?.toString()??"-"}${t}`}function he(e,t,n){if(1===e.redirections.length){const[r]=e.redirections;return void(le(r)&&he(r,t,n))}_e(e.redirections,t,e,n)}function de(e,t,n,r){if(Array.isArray(e.bindings)&&1===e.bindings.length){const[r]=e.bindings;return void(le(r)&&he(r,t,n))}_e(e.bindings,t,e,n)}function pe(e){try{const t=new Map;void 0!==e.rootConstraints.tag&&t.set(e.rootConstraints.tag.key,e.rootConstraints.tag.value);const n=new se({elem:{name:e.rootConstraints.name,serviceIdentifier:e.rootConstraints.serviceIdentifier,tags:t},previous:void 0}),r=new ae(n.last),i=!!e.rootConstraints.isMultiple&&e.rootConstraints.chained,a=oe(e,r,{chained:i}),s=[],o={bindings:s,parent:void 0,serviceIdentifier:e.rootConstraints.serviceIdentifier};if(s.push(...ye(e,n,a,o,i)),!e.rootConstraints.isMultiple){de(o,e.rootConstraints.isOptional??!1,r);const[t]=s;o.bindings=t}return{tree:{root:o}}}catch(t){!function(e,t){if(function(e){return e instanceof Error&&(e instanceof RangeError&&/stack space|call stack|too much recursion/i.test(e.message)||"InternalError"===e.name&&/too much recursion/.test(e.message))}(t)){const n=function(e){const t=[...e];return 0===t.length?"(No dependency trace)":t.map(c).join(" -> ")}(function(e){const t=new Set;for(const n of e.servicesBranch){if(t.has(n))return[...t,n];t.add(n)}return[...t]}(e));throw new X(q.planning,`Circular dependency found: ${n}`,{cause:t})}throw t}(e,t)}}function me(e,t,n,r){const i={binding:t,classMetadata:e.getClassMetadata(t.implementationType),constructorParams:[],parent:r,propertyParams:new Map};return Se({autobindOptions:e.autobindOptions,getBindings:e.getBindings,getBindingsChained:e.getBindingsChained,getClassMetadata:e.getClassMetadata,node:i,servicesBranch:e.servicesBranch,setBinding:e.setBinding},n)}function be(e,t,n){if(n.kind===G.unmanaged)return;const r=f.is(n.value)?n.value.unwrap():n.value,i=t.concat({name:n.name,serviceIdentifier:r,tags:n.tags}),a=new ae(i.last),s=n.kind===G.multipleInjection&&n.chained,o=oe(e,a,{chained:s}),l=[],_={bindings:l,parent:e.node,serviceIdentifier:r};if(l.push(...ye(e,i,o,_,s)),n.kind===G.singleInjection){de(_,n.optional,a);const[e]=l;_.bindings=e}return _}function ve(e,t,n){const r=f.is(n.value)?n.value.unwrap():n.value,i=t.concat({name:n.name,serviceIdentifier:r,tags:n.tags}),a=new ae(i.last),s=n.kind===re.multipleInjection&&n.chained,o=oe(e,a,{chained:s}),l=[],_={bindings:l,parent:e.node,serviceIdentifier:r};if(l.push(...ye(e,i,o,_,s)),n.kind===re.singleInjection){de(_,n.optional,a);const[e]=l;_.bindings=e}return _}function ge(e,t,n,r){const i={binding:t,params:[],parent:r};return Se({autobindOptions:e.autobindOptions,getBindings:e.getBindings,getBindingsChained:e.getBindingsChained,getClassMetadata:e.getClassMetadata,node:i,servicesBranch:e.servicesBranch,setBinding:e.setBinding},n)}function ye(e,t,n,r,i){const a=le(r)?r.binding.targetServiceIdentifier:r.serviceIdentifier;e.servicesBranch.push(a);const s=[];for(const a of n)switch(a.type){case M:s.push(me(e,a,t,r));break;case B:s.push(ge(e,a,t,r));break;case E:{const n=we(e,t,a,r,i);s.push(n);break}default:s.push({binding:a,parent:r})}return e.servicesBranch.pop(),s}function we(e,t,n,r,i){const a={binding:n,parent:r,redirections:[]},s=oe(e,new ae(t.last),{chained:i,customServiceIdentifier:n.targetServiceIdentifier});return a.redirections.push(...ye(e,t,s,a,i)),a}function Se(e,t){return e.node.binding.type===M?function(e,t,n){const r=t.classMetadata;for(const[i,a]of r.constructorArguments.entries())t.constructorParams[i]=be(e,n,a);for(const[i,a]of r.properties){const r=be(e,n,a);void 0!==r&&t.propertyParams.set(i,r)}return e.node}(e,e.node,t):function(e,t,n){const r=t.binding.metadata;for(const[i,a]of r.arguments.entries())t.params[i]=ve(e,n,a);return e.node}(e,e.node,t)}class Ae{#v;#g;#y;constructor(){this.#v=[],this.#g=8,this.#y=1024}*[Symbol.iterator](){let e=0;for(const t of this.#v){const n=t.deref();void 0===n?++e:yield n}this.#v.length>=this.#g&&this.#w(e)&&this.#S(e)}push(e){const t=new WeakRef(e);if(this.#v.push(t),this.#v.length>=this.#g&&this.#v.length%this.#y===0){let e=0;for(const t of this.#v)void 0===t.deref()&&++e;this.#w(e)&&this.#S(e)}}#S(e){const t=new Array(this.#v.length-e);let n=0;for(const e of this.#v)e.deref()&&(t[n++]=e);this.#v=t}#w(e){return e>=.5*this.#v.length}}!function(e){e[e.singleMandatory=0]="singleMandatory",e[e.singleOptional=1]="singleOptional",e[e.multipleMandatory=2]="multipleMandatory",e[e.multipleOptional=3]="multipleOptional",e[e.length=4]="length"}(ie||(ie={}));class Me{#A;#M;#R;#B;#E;constructor(){this.#A=this.#k(),this.#M=this.#k(),this.#R=this.#k(),this.#B=this.#k(),this.#E=new Ae}clearCache(){for(const e of this.#T())e.clear();for(const e of this.#E)e.clearCache()}get(e){return void 0===e.name?void 0===e.tag?this.#I(this.#A,e).get(e.serviceIdentifier):this.#I(this.#B,e).get(e.serviceIdentifier)?.get(e.tag.key)?.get(e.tag.value):void 0===e.tag?this.#I(this.#M,e).get(e.serviceIdentifier)?.get(e.name):this.#I(this.#R,e).get(e.serviceIdentifier)?.get(e.name)?.get(e.tag.key)?.get(e.tag.value)}set(e,t){void 0===e.name?void 0===e.tag?this.#I(this.#A,e).set(e.serviceIdentifier,t):this.#x(this.#x(this.#I(this.#B,e),e.serviceIdentifier),e.tag.key).set(e.tag.value,t):void 0===e.tag?this.#x(this.#I(this.#M,e),e.serviceIdentifier).set(e.name,t):this.#x(this.#x(this.#x(this.#I(this.#R,e),e.serviceIdentifier),e.name),e.tag.key).set(e.tag.value,t)}subscribe(e){this.#E.push(e)}#k(){const e=new Array(ie.length);for(let t=0;t<e.length;++t)e[t]=new Map;return e}#x(e,t){let n=e.get(t);return void 0===n&&(n=new Map,e.set(t,n)),n}#I(e,t){return e[this.#P(t)]}#T(){return[...this.#A,...this.#M,...this.#R,...this.#B]}#P(e){return e.isMultiple?!0===e.optional?ie.multipleOptional:ie.multipleMandatory:!0===e.optional?ie.singleOptional:ie.singleMandatory}}function Re(e,t){return _(t)?(e.cache={isRight:!0,value:t},t.then(t=>Be(e,t))):Be(e,t)}function Be(e,t){return e.cache={isRight:!0,value:t},t}async function Ee(e,t,n){let r=await t,i=n.next();for(;!0!==i.done;)r=await i.value(e.context,r),i=n.next();return r}function ke(e,t,n){let r=n;if(void 0!==t.onActivation){const n=t.onActivation;r=_(r)?r.then(t=>n(e.context,t)):n(e.context,r)}return function(e,t,n){const r=e.getActivations(t);return void 0===r?n:_(n)?Ee(e,n,r[Symbol.iterator]()):function(e,t,n){let r=t,i=n.next();for(;!0!==i.done;){const t=i.value(e.context,r);if(_(t))return Ee(e,t,n);r=t,i=n.next()}return r}(e,n,r[Symbol.iterator]())}(e,t.serviceIdentifier,r)}function Te(e){return(t,n)=>n.cache.isRight?n.cache.value:Re(n,ke(t,n,e(t,n)))}const Ie=Te(function(e,t){return t.value});function xe(e){return e}function Pe(e,t){return(n,r)=>{const i=e(r);switch(i.scope){case g:return i.cache.isRight?i.cache.value:Re(i,ke(n,i,t(n,r)));case v:{if(n.requestScopeCache.has(i.id))return n.requestScopeCache.get(i.id);const e=ke(n,i,t(n,r));return n.requestScopeCache.set(i.id,e),e}case y:return ke(n,i,t(n,r))}}}const Oe=Pe(xe,function(e,t){return t.value(e.context)}),Le=Te(function(e,t){return t.factory(e.context)});function Ne(e,t,n){const r=function(e,t,n){if(void 0!==n){if(!(n in e))throw new X(q.resolution,`Expecting a "${n.toString()}" property when resolving "${t.implementationType.name}" class @postConstruct decorated method, none found.`);if("function"!=typeof e[n])throw new X(q.resolution,`Expecting a "${n.toString()}" method when resolving "${t.implementationType.name}" class @postConstruct decorated method, a non function property was found instead.`);{let r;try{r=e[n]()}catch(e){throw new X(q.resolution,`Unexpected error found when calling "${n.toString()}" @postConstruct decorated method on class "${t.implementationType.name}"`,{cause:e})}if(_(r))return async function(e,t,n){try{await n}catch(n){throw new X(q.resolution,`Unexpected error found when calling "${t.toString()}" @postConstruct decorated method on class "${e.implementationType.name}"`,{cause:n})}}(t,n,r)}}}(e,t,n);return _(r)?r.then(()=>e):e}function Ve(e){return(t,n,r)=>{const i=new r.binding.implementationType(...t),a=e(n,i,r);return _(a)?a.then(()=>Ne(i,r.binding,r.classMetadata.lifecycle.postConstructMethodName)):Ne(i,r.binding,r.classMetadata.lifecycle.postConstructMethodName)}}const Ce=Te(function(e,t){return t.provider(e.context)});function De(e){return e.binding}function He(e){return e.binding}const je=(Ue=ze,(e,t,n)=>{const r=[];for(const[i,a]of n.propertyParams){const s=n.classMetadata.properties.get(i);if(void 0===s)throw new X(q.resolution,`Expecting metadata at property "${i.toString()}", none found`);s.kind!==G.unmanaged&&void 0!==a.bindings&&(t[i]=Ue(e,a),_(t[i])&&r.push((async()=>{t[i]=await t[i]})()))}if(r.length>0)return Promise.all(r).then(()=>{})}),Fe=function(e){return function t(n,r){const i=[];for(const a of r.redirections)le(a)?i.push(...t(n,a)):i.push(e(n,a));return i}}(Ke),Xe=function(e,t,n){return(r,i)=>{const a=e(r,i);return _(a)?t(a,r,i):n(a,r,i)}}(function(e){return(t,n)=>{const r=[];for(const i of n.constructorParams)void 0===i?r.push(void 0):r.push(e(t,i));return r.some(_)?Promise.all(r):r}}(ze),function(e){return async(t,n,r)=>{const i=await t;return e(i,n,r)}}(Ve(je)),Ve(je)),qe=function(e){return(t,n)=>{const r=e(t,n);return _(r)?r.then(e=>n.binding.factory(...e)):n.binding.factory(...r)}}(function(e){return(t,n)=>{const r=[];for(const i of n.params)r.push(e(t,i));return r.some(_)?Promise.all(r):r}}(ze)),Ye=Pe(De,Xe),Ge=Pe(He,qe);var Ue;function Ke(e,t){switch(t.binding.type){case w:return Ie(e,t.binding);case S:return Oe(e,t.binding);case A:return Le(e,t.binding);case M:return Ye(e,t);case R:return Ce(e,t.binding);case B:return Ge(e,t)}}function ze(e,t){if(void 0!==t.bindings)return Array.isArray(t.bindings)?function(e,t){const n=[];for(const r of t)le(r)?n.push(...Fe(e,r)):n.push(Ke(e,r));return n.some(_)?Promise.all(n):n}(e,t.bindings):function(e,t){if(le(t)){const n=Fe(e,t);if(1===n.length)return n[0];throw new X(q.resolution,"Unexpected multiple resolved values on single injection")}return Ke(e,t)}(e,t.bindings)}function Ze(e){return void 0!==e.scope}function We(e,t){if(void 0!==e.lifecycle.preDestroyMethodName&&"function"==typeof t[e.lifecycle.preDestroyMethodName])return t[e.lifecycle.preDestroyMethodName]()}function $e(e,t,n){const r=e.getDeactivations(t);if(void 0!==r)return _(n)?Qe(n,r[Symbol.iterator]()):function(e,t){let n=t.next();for(;!0!==n.done;){if(_(n.value(e)))return Qe(e,t);n=t.next()}}(n,r[Symbol.iterator]())}async function Qe(e,t){const n=await e;let r=t.next();for(;!0!==r.done;)await r.value(n),r=t.next()}function Je(e,t){const n=function(e,t){if(t.type===M){const n=e.getClassMetadata(t.implementationType),r=t.cache.value;return _(r)?r.then(e=>We(n,e)):We(n,r)}}(e,t);return void 0===n?et(e,t):n.then(()=>et(e,t))}function et(e,t){const n=t.cache;return _(n.value)?n.value.then(n=>tt(e,t,n)):tt(e,t,n.value)}function tt(e,t,n){let r;return void 0!==t.onDeactivation&&(r=(0,t.onDeactivation)(n)),void 0===r?$e(e,t.serviceIdentifier,n):r.then(()=>$e(e,t.serviceIdentifier,n))}function nt(e,t){if(void 0===t)return;const n=function(e){const t=[];for(const n of e)Ze(n)&&n.scope===g&&n.cache.isRight&&t.push(n);return t}(t),r=[];for(const t of n){const n=Je(e,t);void 0!==n&&r.push(n)}return r.length>0?Promise.all(r).then(()=>{}):void 0}function rt(e,t){const n=e.getBindings(t);return nt(e,n)}const it=Symbol.for("@inversifyjs/plugin/isPlugin"),at=Symbol.for("@inversifyjs/container/bindingIdentifier");function st(e){return"object"==typeof e&&null!==e&&!0===e[at]}class ot{static always=e=>!0}function lt(e){return{[at]:!0,id:e.id}}function _t(e){return t=>{for(let n=t.getAncestor();void 0!==n;n=n.getAncestor())if(e(n))return!0;return!1}}function ct(e){return t=>t.name===e}function ut(e){return t=>t.serviceIdentifier===e}function ft(e,t){return n=>n.tags.has(e)&&n.tags.get(e)===t}function ht(e){return void 0===e.name&&0===e.tags.size}function dt(e){const t=_t(e);return e=>!t(e)}function pt(e){return t=>{const n=t.getAncestor();return void 0===n||!e(n)}}function mt(e){return t=>{const n=t.getAncestor();return void 0!==n&&e(n)}}class bt{#r;constructor(e){this.#r=e}getIdentifier(){return lt(this.#r)}inRequestScope(){return this.#r.scope=v,new wt(this.#r)}inSingletonScope(){return this.#r.scope=g,new wt(this.#r)}inTransientScope(){return this.#r.scope=y,new wt(this.#r)}}class vt{#t;#a;#s;#o;constructor(e,t,n,r){this.#t=e,this.#a=t,this.#s=n,this.#o=r}to(e){const t=U(e),n={cache:{isRight:!1,value:void 0},id:b(),implementationType:e,isSatisfiedBy:ot.always,moduleId:this.#a,onActivation:void 0,onDeactivation:void 0,scope:t.scope??this.#s,serviceIdentifier:this.#o,type:M};return this.#t(n),new St(n)}toSelf(){if("function"!=typeof this.#o)throw new Error('"toSelf" function can only be applied when a newable function is used as service identifier');return this.to(this.#o)}toConstantValue(e){const t={cache:{isRight:!1,value:void 0},id:b(),isSatisfiedBy:ot.always,moduleId:this.#a,onActivation:void 0,onDeactivation:void 0,scope:g,serviceIdentifier:this.#o,type:w,value:e};return this.#t(t),new wt(t)}toDynamicValue(e){const t={cache:{isRight:!1,value:void 0},id:b(),isSatisfiedBy:ot.always,moduleId:this.#a,onActivation:void 0,onDeactivation:void 0,scope:this.#s,serviceIdentifier:this.#o,type:S,value:e};return this.#t(t),new St(t)}toResolvedValue(e,t){const n={cache:{isRight:!1,value:void 0},factory:e,id:b(),isSatisfiedBy:ot.always,metadata:this.#i(t),moduleId:this.#a,onActivation:void 0,onDeactivation:void 0,scope:this.#s,serviceIdentifier:this.#o,type:B};return this.#t(n),new St(n)}toFactory(e){const t={cache:{isRight:!1,value:void 0},factory:e,id:b(),isSatisfiedBy:ot.always,moduleId:this.#a,onActivation:void 0,onDeactivation:void 0,scope:g,serviceIdentifier:this.#o,type:A};return this.#t(t),new wt(t)}toProvider(e){const t={cache:{isRight:!1,value:void 0},id:b(),isSatisfiedBy:ot.always,moduleId:this.#a,onActivation:void 0,onDeactivation:void 0,provider:e,scope:g,serviceIdentifier:this.#o,type:R};return this.#t(t),new wt(t)}toService(e){const t={id:b(),isSatisfiedBy:ot.always,moduleId:this.#a,serviceIdentifier:this.#o,targetServiceIdentifier:e,type:E};this.#t(t)}#i(e){return{arguments:(e??[]).map(e=>function(e){return"object"==typeof e&&!f.is(e)}(e)?function(e){return!0===e.isMultiple}(e)?{chained:e.chained??!1,kind:re.multipleInjection,name:e.name,optional:e.optional??!1,tags:new Map((e.tags??[]).map(e=>[e.key,e.value])),value:e.serviceIdentifier}:{kind:re.singleInjection,name:e.name,optional:e.optional??!1,tags:new Map((e.tags??[]).map(e=>[e.key,e.value])),value:e.serviceIdentifier}:{kind:re.singleInjection,name:void 0,optional:!1,tags:new Map,value:e})}}}class gt{#r;constructor(e){this.#r=e}getIdentifier(){return lt(this.#r)}onActivation(e){return this.#r.onActivation=e,new yt(this.#r)}onDeactivation(e){return this.#r.onDeactivation=e,new yt(this.#r)}}class yt{#r;constructor(e){this.#r=e}getIdentifier(){return lt(this.#r)}when(e){return this.#r.isSatisfiedBy=e,new gt(this.#r)}whenAnyAncestor(e){return this.when(_t(e))}whenAnyAncestorIs(e){return this.when(_t(ut(e)))}whenAnyAncestorNamed(e){return this.when(function(e){return _t(ct(e))}(e))}whenAnyAncestorTagged(e,t){return this.when(function(e,t){return _t(ft(e,t))}(e,t))}whenDefault(){return this.when(ht)}whenNamed(e){return this.when(ct(e))}whenNoParent(e){return this.when(pt(e))}whenNoParentIs(e){return this.when(pt(ut(e)))}whenNoParentNamed(e){return this.when(function(e){return pt(ct(e))}(e))}whenNoParentTagged(e,t){return this.when(function(e,t){return pt(ft(e,t))}(e,t))}whenParent(e){return this.when(mt(e))}whenParentIs(e){return this.when(mt(ut(e)))}whenParentNamed(e){return this.when(function(e){return mt(ct(e))}(e))}whenParentTagged(e,t){return this.when(function(e,t){return mt(ft(e,t))}(e,t))}whenTagged(e,t){return this.when(ft(e,t))}whenNoAncestor(e){return this.when(dt(e))}whenNoAncestorIs(e){return this.when(dt(ut(e)))}whenNoAncestorNamed(e){return this.when(function(e){return dt(ct(e))}(e))}whenNoAncestorTagged(e,t){return this.when(function(e,t){return dt(ft(e,t))}(e,t))}}class wt extends yt{#l;constructor(e){super(e),this.#l=new gt(e)}onActivation(e){return this.#l.onActivation(e)}onDeactivation(e){return this.#l.onDeactivation(e)}}class St extends wt{#_;constructor(e){super(e),this.#_=new bt(e)}inRequestScope(){return this.#_.inRequestScope()}inSingletonScope(){return this.#_.inSingletonScope()}inTransientScope(){return this.#_.inTransientScope()}}const At=Symbol.for("@inversifyjs/container/InversifyContainerError");class Mt extends Error{[At];kind;constructor(e,t,n){super(t,n),this[At]=!0,this.kind=e}static is(e){return"object"==typeof e&&null!==e&&!0===e[At]}static isErrorOfKind(e,t){return Mt.is(e)&&e.kind===t}}var Rt;!function(e){e[e.invalidOperation=0]="invalidOperation"}(Rt||(Rt={}));class Bt{#u;#s;#c;constructor(e,t,n){this.#u=e,this.#s=t,this.#c=n}bind(e){return new vt(e=>{this.#p(e)},void 0,this.#s,e)}isBound(e,t){const n=this.#c.bindingService.get(e);return this.#b(e,n,t)}isCurrentBound(e,t){const n=this.#c.bindingService.getNonParentBindings(e);return this.#b(e,n,t)}async rebind(e){return await this.unbind(e),this.bind(e)}rebindSync(e){return this.unbindSync(e),this.bind(e)}async unbind(e){await this.#d(e)}async unbindAll(){const e=[...this.#c.bindingService.getNonParentBoundServices()];await Promise.all(e.map(async e=>rt(this.#u,e)));for(const t of e)this.#c.activationService.removeAllByServiceId(t),this.#c.bindingService.removeAllByServiceId(t),this.#c.deactivationService.removeAllByServiceId(t);this.#c.planResultCacheService.clearCache()}unbindSync(e){void 0!==this.#d(e)&&this.#h(e)}#p(e){this.#c.bindingService.set(e),this.#c.planResultCacheService.clearCache()}#h(e){let t;if(st(e)){const r=this.#c.bindingService.getById(e.id),i=(n=r,function(e){if(void 0===e)return;const t=e.next();return!0!==t.done?t.value:void 0}(n?.[Symbol.iterator]()))?.serviceIdentifier;t=void 0===i?"Unexpected asynchronous deactivation when unbinding binding identifier. Consider using Container.unbind() instead.":`Unexpected asynchronous deactivation when unbinding "${c(i)}" binding. Consider using Container.unbind() instead.`}else t=`Unexpected asynchronous deactivation when unbinding "${c(e)}" service. Consider using Container.unbind() instead.`;var n;throw new Mt(Rt.invalidOperation,t)}#d(e){return st(e)?this.#S(e):this.#f(e)}#S(e){const t=this.#c.bindingService.getById(e.id),n=nt(this.#u,t);if(void 0!==n)return n.then(()=>{this.#M(e)});this.#M(e)}#M(e){this.#c.bindingService.removeById(e.id),this.#c.planResultCacheService.clearCache()}#f(e){const t=rt(this.#u,e);if(void 0!==t)return t.then(()=>{this.#g(e)});this.#g(e)}#g(e){this.#c.activationService.removeAllByServiceId(e),this.#c.bindingService.removeAllByServiceId(e),this.#c.deactivationService.removeAllByServiceId(e),this.#c.planResultCacheService.clearCache()}#b(e,t,n){if(void 0===t)return!1;const r={getAncestor:()=>{},name:n?.name,serviceIdentifier:e,tags:new Map};void 0!==n?.tag&&r.tags.set(n.tag.key,n.tag.value);for(const e of t)if(e.isSatisfiedBy(r))return!0;return!1}}class Et{#R;#u;#s;#c;constructor(e,t,n,r){this.#R=e,this.#u=t,this.#s=n,this.#c=r}async load(...e){await Promise.all(this.#n(...e))}loadSync(...e){const t=this.#n(...e);for(const e of t)if(void 0!==e)throw new Mt(Rt.invalidOperation,"Unexpected asynchronous module load. Consider using Container.load() instead.")}async unload(...e){await Promise.all(this.#v(...e)),this.#m(e)}unloadSync(...e){const t=this.#v(...e);for(const e of t)if(void 0!==e)throw new Mt(Rt.invalidOperation,"Unexpected asynchronous module unload. Consider using Container.unload() instead.");this.#m(e)}#w(e){return{bind:t=>new vt(e=>{this.#p(e)},e,this.#s,t),isBound:this.#R.isBound.bind(this.#R),onActivation:(t,n)=>{this.#c.activationService.add(n,{moduleId:e,serviceId:t})},onDeactivation:(t,n)=>{this.#c.deactivationService.add(n,{moduleId:e,serviceId:t})},rebind:this.#R.rebind.bind(this.#R),rebindSync:this.#R.rebindSync.bind(this.#R),unbind:this.#R.unbind.bind(this.#R),unbindSync:this.#R.unbindSync.bind(this.#R)}}#m(e){for(const t of e)this.#c.activationService.removeAllByModuleId(t.id),this.#c.bindingService.removeAllByModuleId(t.id),this.#c.deactivationService.removeAllByModuleId(t.id);this.#c.planResultCacheService.clearCache()}#n(...e){return e.map(e=>e.load(this.#w(e.id)))}#p(e){this.#c.bindingService.set(e),this.#c.planResultCacheService.clearCache()}#v(...e){return e.map(e=>function(e,t){const n=e.getBindingsFromModule(t);return nt(e,n)}(this.#u,e.id))}}class kt{#y;#O;#k;#c;constructor(e,t,n){this.#c=t,this.#k=n,this.#y=this.#E(e),this.#O=this.#T()}register(e,t){const n=new t(e,this.#O);if(!0!==n[it])throw new Mt(Rt.invalidOperation,"Invalid plugin. The plugin must extend the Plugin class");n.load(this.#y)}#E(e){return{define:(t,n)=>{if(Object.prototype.hasOwnProperty.call(e,t))throw new Mt(Rt.invalidOperation,`Container already has a method named "${String(t)}"`);e[t]=n},onPlan:this.#k.onPlan.bind(this.#k)}}#T(){const e=this.#c;return{get activationService(){return e.activationService},get bindingService(){return e.bindingService},get deactivationService(){return e.deactivationService},get planResultCacheService(){return e.planResultCacheService}}}}class Tt{activationService;bindingService;deactivationService;planResultCacheService;#x;constructor(e,t,n,r){this.activationService=e,this.bindingService=t,this.deactivationService=n,this.planResultCacheService=r,this.#x=[]}reset(e,t,n){this.activationService=e,this.bindingService=t,this.deactivationService=n,this.planResultCacheService.clearCache();for(const e of this.#x)e()}onReset(e){this.#x.push(e)}}class It{#L;#s;#N;#P;#V;#C;#A;#c;#D;constructor(e,t,n){this.#c=e,this.#C=this.#B(),this.#L=t,this.#s=n,this.#N=e=>this.#c.activationService.get(e),this.#P=this.#c.bindingService.get.bind(this.#c.bindingService),this.#V=this.#c.bindingService.getChained.bind(this.#c.bindingService),this.#A=[],this.#D=this.#p.bind(this),this.#c.onReset(()=>{this.#H()})}get(e,t){const n=this.#j(!1,e,t),r=this.#F(n);if(_(r))throw new Mt(Rt.invalidOperation,`Unexpected asynchronous service when resolving service "${c(e)}"`);return r}getAll(e,t){const n=this.#j(!0,e,t),r=this.#F(n);if(_(r))throw new Mt(Rt.invalidOperation,`Unexpected asynchronous service when resolving service "${c(e)}"`);return r}async getAllAsync(e,t){const n=this.#j(!0,e,t);return this.#F(n)}async getAsync(e,t){const n=this.#j(!1,e,t);return this.#F(n)}onPlan(e){this.#A.push(e)}#H(){this.#P=this.#c.bindingService.get.bind(this.#c.bindingService),this.#D=this.#p.bind(this),this.#C=this.#B()}#X(e,t,n){return{isMultiple:e,name:n?.name,optional:n?.optional,serviceIdentifier:t,tag:n?.tag}}#I(e,t,n){const r={autobindOptions:n?.autobind??this.#L?{scope:this.#s}:void 0,getBindings:this.#P,getBindingsChained:this.#V,getClassMetadata:U,rootConstraints:this.#q(e,t,n),servicesBranch:[],setBinding:this.#D};return this.#Y(r,n),r}#q(e,t,n){return t?{chained:n?.chained??!1,isMultiple:t,serviceIdentifier:e}:{isMultiple:t,serviceIdentifier:e}}#j(e,t,n){const r=this.#X(e,t,n),i=this.#c.planResultCacheService.get(r);if(void 0!==i)return i;const a=pe(this.#I(t,e,n));this.#c.planResultCacheService.set(r,a);for(const e of this.#A)e(r,a);return a}#B(){return{get:this.get.bind(this),getAll:this.getAll.bind(this),getAllAsync:this.getAllAsync.bind(this),getAsync:this.getAsync.bind(this)}}#F(e){return function(e){return ze(e,e.planResult.tree.root)}({context:this.#C,getActivations:this.#N,planResult:e,requestScopeCache:new Map})}#Y(e,t){void 0!==t&&(void 0!==t.name&&(e.rootConstraints.name=t.name),!0===t.optional&&(e.rootConstraints.isOptional=!0),void 0!==t.tag&&(e.rootConstraints.tag={key:t.tag.key,value:t.tag.value}),e.rootConstraints.isMultiple&&(e.rootConstraints.chained=t?.chained??!1))}#p(e){this.#c.bindingService.set(e),this.#c.planResultCacheService.clearCache()}}class xt{#c;#G;constructor(e){this.#c=e,this.#G=[]}restore(){const e=this.#G.pop();if(void 0===e)throw new Mt(Rt.invalidOperation,"No snapshot available to restore");this.#c.reset(e.activationService,e.bindingService,e.deactivationService)}snapshot(){this.#G.push({activationService:this.#c.activationService.clone(),bindingService:this.#c.bindingService.clone(),deactivationService:this.#c.deactivationService.clone()})}}const Pt=y;class Ot{#R;#U;#K;#c;#k;#z;constructor(e){this.#c=this.#Z(e);const t=e?.autobind??!1,n=e?.defaultScope??Pt,r={getBindings:(i=this.#c).bindingService.get.bind(i.bindingService),getBindingsFromModule:i.bindingService.getByModuleId.bind(i.bindingService),getClassMetadata:U,getDeactivations:i.deactivationService.get.bind(i.deactivationService)};var i;this.#R=new Bt(r,n,this.#c),this.#U=new Et(this.#R,r,n,this.#c),this.#k=new It(this.#c,t,n),this.#K=new kt(this,this.#c,this.#k),this.#z=new xt(this.#c)}bind(e){return this.#R.bind(e)}get(e,t){return this.#k.get(e,t)}getAll(e,t){return this.#k.getAll(e,t)}async getAllAsync(e,t){return this.#k.getAllAsync(e,t)}async getAsync(e,t){return this.#k.getAsync(e,t)}isBound(e,t){return this.#R.isBound(e,t)}isCurrentBound(e,t){return this.#R.isCurrentBound(e,t)}async load(...e){return this.#U.load(...e)}loadSync(...e){this.#U.loadSync(...e)}onActivation(e,t){this.#c.activationService.add(t,{serviceId:e})}onDeactivation(e,t){this.#c.deactivationService.add(t,{serviceId:e})}register(e){this.#K.register(this,e)}restore(){this.#z.restore()}async rebind(e){return this.#R.rebind(e)}rebindSync(e){return this.#R.rebindSync(e)}snapshot(){this.#z.snapshot()}async unbind(e){await this.#R.unbind(e)}async unbindAll(){return this.#R.unbindAll()}unbindSync(e){this.#R.unbindSync(e)}async unload(...e){return this.#U.unload(...e)}unloadSync(...e){this.#U.unloadSync(...e)}#Z(e){if(void 0===e?.parent)return new Tt(O.build(void 0),V.build(void 0),C.build(void 0),new Me);const t=new Me;return e.parent.#c.planResultCacheService.subscribe(t),new Tt(O.build(e.parent.#c.activationService),V.build(e.parent.#c.bindingService),C.build(e.parent.#c.deactivationService),t)}}let Lt=class{constructor(e){this.audioEncoders=e}getAudioEncoderByFormat(e){return n(this,void 0,void 0,function*(){for(const t of this.audioEncoders){if((yield t.getMetadata()).format===e)return t}})}getAudioEncodersMetadata(){return n(this,void 0,void 0,function*(){const e=[];for(const t of this.audioEncoders)e.push(yield t.getMetadata());return e})}encodeAudio(e,t){return n(this,void 0,void 0,function*(){const n=yield this.getAudioEncoderByFormat(t.format);if(n)return n.encodeAudio(e,t);throw new Error(`BaseAudioEncoder.encodeAudio: cannot find encoder for ${t.format} format`)})}};var Nt,Vt;Lt=e([ne(),(Nt=0,Vt=function(e,t){return function(e,t){return(n,r,i)=>{try{void 0===i?function(e,t){const n=J(e,t);return(e,t)=>{p(e.constructor,D,H,W(n(e),t))}}(e,t)(n,r):"number"==typeof i?function(e,t){const n=J(e,t);return(e,t,r)=>{if(!function(e,t){return"function"==typeof e&&void 0===t}(e,t))throw new X(q.injectionDecoratorConflict,`Found an @inject decorator in a non constructor parameter.\nFound @inject decorator at method "${t?.toString()??""}" at class "${e.constructor.name}"`);p(e,D,H,function(e,t){return n=>{const r=n.constructorArguments[t];return n.constructorArguments[t]=e(r),n}}(n(e),r))}}(e,t)(n,r,i):function(e,t){const n=J(e,t);return(e,t,r)=>{if(!function(e){return void 0!==e.set}(r))throw new X(q.injectionDecoratorConflict,`Found an @inject decorator in a non setter property method.\nFound @inject decorator at method "${t.toString()}" at class "${e.constructor.name}"`);p(e.constructor,D,H,W(n(e),t))}}(e,t)(n,r,i)}catch(e){Q(n,r,i,e)}}}(Z(G.multipleInjection,e,t),z)}(i.AudioEncoders),function(e,t){Vt(e,t,Nt)}),t("design:paramtypes",[Array])],Lt);var Ct=Lt;class Dt{isWebAudioEncoderAPISupportedForSettings(e){return n(this,void 0,void 0,function*(){if(!AudioEncoder||!AudioEncoder.isConfigSupported)return!1;const t=yield AudioEncoder.isConfigSupported({codec:e.format,sampleRate:e.sampleRate,numberOfChannels:e.numChannels,bitrate:1e3*(e.bitrate||0)});return Boolean(t.supported)})}encodeWithWebAudioEncoderAPI(e,t){return n(this,void 0,void 0,function*(){const n=(yield this.getMetadata()).format;if(!n)throw new Error("encodeWebAudioEncoderAPI: No format provided");const i=[],a=new AudioEncoder({output:e=>i.push(e),error:e=>console.error(e)});a.configure({codec:n,sampleRate:t.sampleRate,numberOfChannels:t.numChannels,bitrate:1e3*(t.bitrate||0)});const s=e[0].length;let o;o=2===t.numChannels?r.interleaveBuffers(e[0],e[1]):e[0];const l=new AudioData({format:"f32",sampleRate:t.sampleRate,numberOfFrames:s,numberOfChannels:2,timestamp:0,data:o});a.encode(l),yield a.flush(),a.close();const _=i.reduce((e,t)=>e+t.byteLength,0),c=new Uint8Array(_);let u=0;for(const e of i){const t=new Uint8Array(e.byteLength);e.copyTo(t),c.set(t,u),u+=t.length}return c.buffer})}}let Ht=class extends Dt{getMetadata(){return Promise.resolve({format:"wav",implementationType:"custom",supported:!0})}encodeAudio(e,t){let n;n=2===t.numChannels?r.interleaveBuffers(e[0],e[1]):e[0];const i=new ArrayBuffer(44+2*n.length),a=new DataView(i);return r.writeStringToDataView(a,0,"RIFF"),a.setUint32(4,36+2*n.length,!0),r.writeStringToDataView(a,8,"WAVE"),r.writeStringToDataView(a,12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,t.numChannels,!0),a.setUint32(24,t.sampleRate,!0),a.setUint32(28,4*t.sampleRate,!0),a.setUint16(32,2*t.numChannels,!0),a.setUint16(34,16,!0),r.writeStringToDataView(a,36,"data"),a.setUint32(40,2*n.length,!0),r.floatTo16BitPCM(a,44,n),Promise.resolve(a.buffer)}};Ht=e([ne()],Ht);var jt,Ft,Xt,qt,Yt,Gt,Ut,Kt,zt,Zt,Wt,$t,Qt,Jt,en,tn,nn,rn,an,sn,on,ln,_n,cn,un,fn,hn,dn,pn,mn,bn,vn,gn,yn,wn,Sn,An,Mn,Rn,Bn,En,kn,Tn,In,xn,Pn,On,Ln,Nn,Vn,Cn,Dn,Hn,jn,Fn,Xn,qn,Yn,Gn,Un,Kn,zn,Zn,Wn,$n,Qn,Jn,er,tr,nr=Ht,rr={};function ir(){if(Ft)return jt;function e(e){return new Int16Array(e)}function t(e){return new Int32Array(e)}function n(e){return new Float32Array(e)}Ft=1;var r={fill:function(e,t,n,r){if(2==arguments.length)for(var i=0;i<e.length;i++)e[i]=arguments[1];else for(i=t;i<n;i++)e[i]=r}},i={arraycopy:function(e,t,n,r,i){for(var a=t+i;t<a;)n[r++]=e[t++]},out:{}};i.out.println=function(e){console.log(e)},i.out.printf=function(){console.log.apply(console,arguments)};var a={};function s(e){this.ordinal=e}a.SQRT2=1.4142135623730951,a.FAST_LOG10=function(e){return Math.log10(e)},a.FAST_LOG10_X=function(e,t){return Math.log10(e)*t},s.short_block_allowed=new s(0),s.short_block_coupled=new s(1),s.short_block_dispensed=new s(2),s.short_block_forced=new s(3);var o={};function l(e){this.ordinal=e}o.MAX_VALUE=34028235e31,l.vbr_off=new l(0),l.vbr_mt=new l(1),l.vbr_rh=new l(2),l.vbr_abr=new l(3),l.vbr_mtrh=new l(4),l.vbr_default=l.vbr_mtrh;return jt={System:i,VbrMode:l,Float:o,ShortBlock:s,Util:a,Arrays:r,new_array_n:function e(t){if(1==t.length)return new Array(t[0]);var n=t[0];t=t.slice(1);for(var r=[],i=0;i<n;i++)r.push(e(t));return r},new_byte:function(e){return new Int8Array(e)},new_double:function(e){return new Float64Array(e)},new_float:n,new_float_n:function e(t){if(1==t.length)return n(t[0]);var r=t[0];t=t.slice(1);for(var i=[],a=0;a<r;a++)i.push(e(t));return i},new_int:t,new_int_n:function e(n){if(1==n.length)return t(n[0]);var r=n[0];n=n.slice(1);for(var i=[],a=0;a<r;a++)i.push(e(n));return i},new_short:e,new_short_n:function t(n){if(1==n.length)return e(n[0]);var r=n[0];n=n.slice(1);for(var i=[],a=0;a<r;a++)i.push(t(n));return i},assert:function(e){}},jt}function ar(){if(Gt)return Yt;Gt=1;var e=sr(),t=ir(),n=t.System;t.VbrMode,t.Float,t.ShortBlock,t.Util,t.Arrays,t.new_array_n,t.new_byte,t.new_double;var r=t.new_float,i=t.new_float_n;return t.new_int,t.new_int_n,t.assert,Yt=function(){this.l=r(e.SBMAX_l),this.s=i([e.SBMAX_s,3]);var t=this;this.assign=function(r){n.arraycopy(r.l,0,t.l,0,e.SBMAX_l);for(var i=0;i<e.SBMAX_s;i++)for(var a=0;a<3;a++)t.s[i][a]=r.s[i][a]}},Yt}function sr(){if(Zt)return zt;Zt=1;var e=ir(),t=e.System,n=e.VbrMode;e.Float,e.ShortBlock,e.Util,e.Arrays;var r=e.new_array_n;e.new_byte,e.new_double;var i=e.new_float,a=e.new_float_n,s=e.new_int;e.new_int_n;var o=e.assert;function l(){var e=function(){if(qt)return Xt;qt=1;var e=ir(),t=e.System;e.VbrMode,e.Float,e.ShortBlock;var n=e.Util,r=e.Arrays;e.new_array_n,e.new_byte,e.new_double;var i=e.new_float;e.new_float_n,e.new_int,e.new_int_n,e.assert;var a=sr();return Xt=function(){var e=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*n.SQRT2*.5/2384e-9,.017876148*n.SQRT2*.5/2384e-9,.003134727*n.SQRT2*.5/2384e-9,.002457142*n.SQRT2*.5/2384e-9,971317e-9*n.SQRT2*.5/2384e-9,218868e-9*n.SQRT2*.5/2384e-9,101566e-9*n.SQRT2*.5/2384e-9,13828e-9*n.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],s=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],o=s[a.SHORT_TYPE],l=s[a.SHORT_TYPE],_=s[a.SHORT_TYPE],c=s[a.SHORT_TYPE],u=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function f(t,r,i){for(var a,s,o,l=10,_=r+238-14-286,c=-15;c<0;c++){var u,f,h;u=e[l+-10],f=t[_+-224]*u,h=t[r+224]*u,u=e[l+-9],f+=t[_+-160]*u,h+=t[r+160]*u,u=e[l+-8],f+=t[_+-96]*u,h+=t[r+96]*u,u=e[l+-7],f+=t[_+-32]*u,h+=t[r+32]*u,u=e[l+-6],f+=t[_+32]*u,h+=t[r+-32]*u,u=e[l+-5],f+=t[_+96]*u,h+=t[r+-96]*u,u=e[l+-4],f+=t[_+160]*u,h+=t[r+-160]*u,u=e[l+-3],f+=t[_+224]*u,h+=t[r+-224]*u,u=e[l+-2],f+=t[r+-256]*u,h-=t[_+256]*u,u=e[l+-1],f+=t[r+-192]*u,h-=t[_+192]*u,u=e[l+0],f+=t[r+-128]*u,h-=t[_+128]*u,u=e[l+1],f+=t[r+-64]*u,h-=t[_+64]*u,u=e[l+2],f+=t[r+0]*u,h-=t[_+0]*u,u=e[l+3],f+=t[r+64]*u,h-=t[_+-64]*u,u=e[l+4],f+=t[r+128]*u,h-=t[_+-128]*u,u=e[l+5],f+=t[r+192]*u,u=(h-=t[_+-192]*u)-(f*=e[l+6]),i[30+2*c]=h+f,i[31+2*c]=e[l+7]*u,l+=18,r--,_++}h=t[r+-16]*e[l+-10],f=t[r+-32]*e[l+-2],h+=(t[r+-48]-t[r+16])*e[l+-9],f+=t[r+-96]*e[l+-1],h+=(t[r+-80]+t[r+48])*e[l+-8],f+=t[r+-160]*e[l+0],h+=(t[r+-112]-t[r+80])*e[l+-7],f+=t[r+-224]*e[l+1],h+=(t[r+-144]+t[r+112])*e[l+-6],f-=t[r+32]*e[l+2],h+=(t[r+-176]-t[r+144])*e[l+-5],f-=t[r+96]*e[l+3],h+=(t[r+-208]+t[r+176])*e[l+-4],f-=t[r+160]*e[l+4],h+=(t[r+-240]-t[r+208])*e[l+-3],a=(f-=t[r+224])-h,s=f+h,h=i[14],f=i[15]-h,i[31]=s+h,i[30]=a+f,i[15]=a-f,i[14]=s-h,o=i[28]-i[0],i[0]+=i[28],i[28]=o*e[l+-36+7],o=i[29]-i[1],i[1]+=i[29],i[29]=o*e[l+-36+7],o=i[26]-i[2],i[2]+=i[26],i[26]=o*e[l+-72+7],o=i[27]-i[3],i[3]+=i[27],i[27]=o*e[l+-72+7],o=i[24]-i[4],i[4]+=i[24],i[24]=o*e[l+-108+7],o=i[25]-i[5],i[5]+=i[25],i[25]=o*e[l+-108+7],o=i[22]-i[6],i[6]+=i[22],i[22]=o*n.SQRT2,o=i[23]-i[7],i[7]+=i[23],i[23]=o*n.SQRT2-i[7],i[7]-=i[6],i[22]-=i[7],i[23]-=i[22],o=i[6],i[6]=i[31]-o,i[31]=i[31]+o,o=i[7],i[7]=i[30]-o,i[30]=i[30]+o,o=i[22],i[22]=i[15]-o,i[15]=i[15]+o,o=i[23],i[23]=i[14]-o,i[14]=i[14]+o,o=i[20]-i[8],i[8]+=i[20],i[20]=o*e[l+-180+7],o=i[21]-i[9],i[9]+=i[21],i[21]=o*e[l+-180+7],o=i[18]-i[10],i[10]+=i[18],i[18]=o*e[l+-216+7],o=i[19]-i[11],i[11]+=i[19],i[19]=o*e[l+-216+7],o=i[16]-i[12],i[12]+=i[16],i[16]=o*e[l+-252+7],o=i[17]-i[13],i[13]+=i[17],i[17]=o*e[l+-252+7],o=-i[20]+i[24],i[20]+=i[24],i[24]=o*e[l+-216+7],o=-i[21]+i[25],i[21]+=i[25],i[25]=o*e[l+-216+7],o=i[4]-i[8],i[4]+=i[8],i[8]=o*e[l+-216+7],o=i[5]-i[9],i[5]+=i[9],i[9]=o*e[l+-216+7],o=i[0]-i[12],i[0]+=i[12],i[12]=o*e[l+-72+7],o=i[1]-i[13],i[1]+=i[13],i[13]=o*e[l+-72+7],o=i[16]-i[28],i[16]+=i[28],i[28]=o*e[l+-72+7],o=-i[17]+i[29],i[17]+=i[29],i[29]=o*e[l+-72+7],o=n.SQRT2*(i[2]-i[10]),i[2]+=i[10],i[10]=o,o=n.SQRT2*(i[3]-i[11]),i[3]+=i[11],i[11]=o,o=n.SQRT2*(-i[18]+i[26]),i[18]+=i[26],i[26]=o-i[18],o=n.SQRT2*(-i[19]+i[27]),i[19]+=i[27],i[27]=o-i[19],o=i[2],i[19]-=i[3],i[3]-=o,i[2]=i[31]-o,i[31]+=o,o=i[3],i[11]-=i[19],i[18]-=o,i[3]=i[30]-o,i[30]+=o,o=i[18],i[27]-=i[11],i[19]-=o,i[18]=i[15]-o,i[15]+=o,o=i[19],i[10]-=o,i[19]=i[14]-o,i[14]+=o,o=i[10],i[11]-=o,i[10]=i[23]-o,i[23]+=o,o=i[11],i[26]-=o,i[11]=i[22]-o,i[22]+=o,o=i[26],i[27]-=o,i[26]=i[7]-o,i[7]+=o,o=i[27],i[27]=i[6]-o,i[6]+=o,o=n.SQRT2*(i[0]-i[4]),i[0]+=i[4],i[4]=o,o=n.SQRT2*(i[1]-i[5]),i[1]+=i[5],i[5]=o,o=n.SQRT2*(i[16]-i[20]),i[16]+=i[20],i[20]=o,o=n.SQRT2*(i[17]-i[21]),i[17]+=i[21],i[21]=o,o=-n.SQRT2*(i[8]-i[12]),i[8]+=i[12],i[12]=o-i[8],o=-n.SQRT2*(i[9]-i[13]),i[9]+=i[13],i[13]=o-i[9],o=-n.SQRT2*(i[25]-i[29]),i[25]+=i[29],i[29]=o-i[25],o=-n.SQRT2*(i[24]+i[28]),i[24]-=i[28],i[28]=o-i[24],o=i[24]-i[16],i[24]=o,o=i[20]-o,i[20]=o,o=i[28]-o,i[28]=o,o=i[25]-i[17],i[25]=o,o=i[21]-o,i[21]=o,o=i[29]-o,i[29]=o,o=i[17]-i[1],i[17]=o,o=i[9]-o,i[9]=o,o=i[25]-o,i[25]=o,o=i[5]-o,i[5]=o,o=i[21]-o,i[21]=o,o=i[13]-o,i[13]=o,o=i[29]-o,i[29]=o,o=i[1]-i[0],i[1]=o,o=i[16]-o,i[16]=o,o=i[17]-o,i[17]=o,o=i[8]-o,i[8]=o,o=i[9]-o,i[9]=o,o=i[24]-o,i[24]=o,o=i[25]-o,i[25]=o,o=i[4]-o,i[4]=o,o=i[5]-o,i[5]=o,o=i[20]-o,i[20]=o,o=i[21]-o,i[21]=o,o=i[12]-o,i[12]=o,o=i[13]-o,i[13]=o,o=i[28]-o,i[28]=o,o=i[29]-o,i[29]=o,o=i[0],i[0]+=i[31],i[31]-=o,o=i[1],i[1]+=i[30],i[30]-=o,o=i[16],i[16]+=i[15],i[15]-=o,o=i[17],i[17]+=i[14],i[14]-=o,o=i[8],i[8]+=i[23],i[23]-=o,o=i[9],i[9]+=i[22],i[22]-=o,o=i[24],i[24]+=i[7],i[7]-=o,o=i[25],i[25]+=i[6],i[6]-=o,o=i[4],i[4]+=i[27],i[27]-=o,o=i[5],i[5]+=i[26],i[26]-=o,o=i[20],i[20]+=i[11],i[11]-=o,o=i[21],i[21]+=i[10],i[10]-=o,o=i[12],i[12]+=i[19],i[19]-=o,o=i[13],i[13]+=i[18],i[18]-=o,o=i[28],i[28]+=i[3],i[3]-=o,o=i[29],i[29]+=i[2],i[2]-=o}function h(e,t){for(var n=0;n<3;n++){var r,i,o,l,_,c;i=(l=e[t+6]*s[a.SHORT_TYPE][0]-e[t+15])+(r=e[t+0]*s[a.SHORT_TYPE][2]-e[t+9]),o=l-r,_=(l=e[t+15]*s[a.SHORT_TYPE][0]+e[t+6])+(r=e[t+9]*s[a.SHORT_TYPE][2]+e[t+0]),c=-l+r,r=2069978111953089e-26*(e[t+3]*s[a.SHORT_TYPE][1]-e[t+12]),l=2069978111953089e-26*(e[t+12]*s[a.SHORT_TYPE][1]+e[t+3]),e[t+0]=190752519173728e-25*i+r,e[t+15]=190752519173728e-25*-_+l,o=.8660254037844387*o*1907525191737281e-26,_=.5*_*1907525191737281e-26+l,e[t+3]=o-_,e[t+6]=o+_,i=.5*i*1907525191737281e-26-r,c=.8660254037844387*c*1907525191737281e-26,e[t+9]=i+c,e[t+12]=i-c,t++}}function d(e,t,n){var r,i,a,s,o,_,c,u,f,h,d,p,m,b,v,g,y,w;a=n[17]-n[9],o=n[15]-n[11],_=n[14]-n[12],c=n[0]+n[8],u=n[1]+n[7],f=n[2]+n[6],h=n[3]+n[5],e[t+17]=c+f-h-(u-n[4]),i=(c+f-h)*l[19]+(u-n[4]),r=(a-o-_)*l[18],e[t+5]=r+i,e[t+6]=r-i,s=(n[16]-n[10])*l[18],u=u*l[19]+n[4],r=a*l[12]+s+o*l[13]+_*l[14],i=-c*l[16]+u-f*l[17]+h*l[15],e[t+1]=r+i,e[t+2]=r-i,r=a*l[13]-s-o*l[14]+_*l[12],i=-c*l[17]+u-f*l[15]+h*l[16],e[t+9]=r+i,e[t+10]=r-i,r=a*l[14]-s+o*l[12]-_*l[13],i=c*l[15]-u+f*l[16]-h*l[17],e[t+13]=r+i,e[t+14]=r-i,d=n[8]-n[0],m=n[6]-n[2],b=n[5]-n[3],v=n[17]+n[9],g=n[16]+n[10],y=n[15]+n[11],w=n[14]+n[12],e[t+0]=v+y+w+(g+n[13]),r=(v+y+w)*l[19]-(g+n[13]),i=(d-m+b)*l[18],e[t+11]=r+i,e[t+12]=r-i,p=(n[7]-n[1])*l[18],g=n[13]-g*l[19],r=v*l[15]-g+y*l[16]+w*l[17],i=d*l[14]+p+m*l[12]+b*l[13],e[t+3]=r+i,e[t+4]=r-i,r=-v*l[17]+g-y*l[15]-w*l[16],i=d*l[13]+p-m*l[14]-b*l[12],e[t+7]=r+i,e[t+8]=r-i,r=-v*l[16]+g-y*l[17]-w*l[15],i=d*l[12]-p+m*l[13]-b*l[14],e[t+15]=r+i,e[t+16]=r-i}this.mdct_sub48=function(e,n,l){for(var p=n,m=286,b=0;b<e.channels_out;b++){for(var v=0;v<e.mode_gr;v++){for(var g,y=e.l3_side.tt[v][b],w=y.xr,S=0,A=e.sb_sample[b][1-v],M=0,R=0;R<9;R++)for(f(p,m,A[M]),f(p,m+32,A[M+1]),M+=2,m+=64,g=1;g<32;g+=2)A[M-1][g]*=-1;for(g=0;g<32;g++,S+=18){var B=y.block_type,E=e.sb_sample[b][v],k=e.sb_sample[b][1-v];if(0!=y.mixed_block_flag&&g<2&&(B=0),e.amp_filter[g]<1e-12)r.fill(w,S+0,S+18,0);else{if(e.amp_filter[g]<1)for(R=0;R<18;R++)k[R][u[g]]*=e.amp_filter[g];if(B==a.SHORT_TYPE){for(R=-3;R<0;R++){var T=s[a.SHORT_TYPE][R+3];w[S+3*R+9]=E[9+R][u[g]]*T-E[8-R][u[g]],w[S+3*R+18]=E[14-R][u[g]]*T+E[15+R][u[g]],w[S+3*R+10]=E[15+R][u[g]]*T-E[14-R][u[g]],w[S+3*R+19]=k[2-R][u[g]]*T+k[3+R][u[g]],w[S+3*R+11]=k[3+R][u[g]]*T-k[2-R][u[g]],w[S+3*R+20]=k[8-R][u[g]]*T+k[9+R][u[g]]}h(w,S)}else{var I=i(18);for(R=-9;R<0;R++){var x,P;x=s[B][R+27]*k[R+9][u[g]]+s[B][R+36]*k[8-R][u[g]],P=s[B][R+9]*E[R+9][u[g]]-s[B][R+18]*E[8-R][u[g]],I[R+9]=x-P*o[3+R+9],I[R+18]=x*o[3+R+9]+P}d(w,S,I)}}if(B!=a.SHORT_TYPE&&0!=g)for(R=7;R>=0;--R){var O,L;O=w[S+R]*_[20+R]+w[S+-1-R]*c[28+R],L=w[S+R]*c[28+R]-w[S+-1-R]*_[20+R],w[S+-1-R]=O,w[S+R]=L}}}if(p=l,m=286,1==e.mode_gr)for(var N=0;N<18;N++)t.arraycopy(e.sb_sample[b][1][N],0,e.sb_sample[b][0][N],0,32)}}},Xt}(),_=function(){if(Kt)return Ut;Kt=1;var e=ar();return Ut=function(){this.thm=new e,this.en=new e}}(),c=l.FFTOFFSET,u=l.MPG_MD_MS_LR,f=null;this.psy=null;var h=null,d=null,p=null;this.setModules=function(e,t,n,r){f=e,this.psy=t,h=t,d=r,p=n};var m=new e;this.lame_encode_mp3_frame=function(e,b,v,g,y,w){var S,A=r([2,2]);A[0][0]=new _,A[0][1]=new _,A[1][0]=new _,A[1][1]=new _;var M,R=r([2,2]);R[0][0]=new _,R[0][1]=new _,R[1][0]=new _,R[1][1]=new _;var B,E,k,T=[null,null],I=e.internal_flags,x=a([2,4]),P=[.5,.5],O=[[0,0],[0,0]],L=[[0,0],[0,0]];if(T[0]=b,T[1]=v,0==I.lame_encode_frame_init&&function(e,t){var n,r,a=e.internal_flags;if(0==a.lame_encode_frame_init){var s,_,c=i(2014),u=i(2014);for(a.lame_encode_frame_init=1,s=0,_=0;s<286+576*(1+a.mode_gr);++s)s<576*a.mode_gr?(c[s]=0,2==a.channels_out&&(u[s]=0)):(c[s]=t[0][_],2==a.channels_out&&(u[s]=t[1][_]),++_);for(r=0;r<a.mode_gr;r++)for(n=0;n<a.channels_out;n++)a.l3_side.tt[r][n].block_type=l.SHORT_TYPE;m.mdct_sub48(a,c,u),o(576>=l.FFTOFFSET),o(a.mf_size>=l.BLKSIZE+e.framesize-l.FFTOFFSET),o(a.mf_size>=512+e.framesize-32)}}(e,T),I.padding=0,(I.slot_lag-=I.frac_SpF)<0&&(I.slot_lag+=e.out_samplerate,I.padding=1),0!=I.psymodel){var N=[null,null],V=0,C=s(2);for(k=0;k<I.mode_gr;k++){for(E=0;E<I.channels_out;E++)N[E]=T[E],V=576+576*k-l.FFTOFFSET;if(0!=(e.VBR==n.vbr_mtrh||e.VBR==n.vbr_mt?h.L3psycho_anal_vbr(e,N,V,k,A,R,O[k],L[k],x[k],C):h.L3psycho_anal_ns(e,N,V,k,A,R,O[k],L[k],x[k],C)))return-4;for(e.mode==MPEGMode.JOINT_STEREO&&(P[k]=x[k][2]+x[k][3],P[k]>0&&(P[k]=x[k][3]/P[k])),E=0;E<I.channels_out;E++){var D=I.l3_side.tt[k][E];D.block_type=C[E],D.mixed_block_flag=0}}}else for(k=0;k<I.mode_gr;k++)for(E=0;E<I.channels_out;E++)I.l3_side.tt[k][E].block_type=l.NORM_TYPE,I.l3_side.tt[k][E].mixed_block_flag=0,L[k][E]=O[k][E]=700;if(function(e){var t,n;if(0!=e.ATH.useAdjust)if(n=e.loudness_sq[0][0],t=e.loudness_sq[1][0],2==e.channels_out?(n+=e.loudness_sq[0][1],t+=e.loudness_sq[1][1]):(n+=n,t+=t),2==e.mode_gr&&(n=Math.max(n,t)),n*=.5,(n*=e.ATH.aaSensitivityP)>.03125)e.ATH.adjust>=1?e.ATH.adjust=1:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=1;else{var r=31.98*n+625e-6;e.ATH.adjust>=r?(e.ATH.adjust*=.075*r+.925,e.ATH.adjust<r&&(e.ATH.adjust=r)):e.ATH.adjustLimit>=r?e.ATH.adjust=r:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=r}else e.ATH.adjust=1}(I),m.mdct_sub48(I,T[0],T[1]),I.mode_ext=l.MPG_MD_LR_LR,e.force_ms)I.mode_ext=l.MPG_MD_MS_LR;else if(e.mode==MPEGMode.JOINT_STEREO){var H=0,j=0;for(k=0;k<I.mode_gr;k++)for(E=0;E<I.channels_out;E++)H+=L[k][E],j+=O[k][E];if(H<=1*j){var F=I.l3_side.tt[0],X=I.l3_side.tt[I.mode_gr-1];F[0].block_type==F[1].block_type&&X[0].block_type==X[1].block_type&&(I.mode_ext=l.MPG_MD_MS_LR)}}if(I.mode_ext==u?(M=R,B=L):(M=A,B=O),e.analysis&&null!=I.pinfo)for(k=0;k<I.mode_gr;k++)for(E=0;E<I.channels_out;E++)I.pinfo.ms_ratio[k]=I.ms_ratio[k],I.pinfo.ms_ener_ratio[k]=P[k],I.pinfo.blocktype[k][E]=I.l3_side.tt[k][E].block_type,I.pinfo.pe[k][E]=B[k][E],t.arraycopy(I.l3_side.tt[k][E].xr,0,I.pinfo.xr[k][E],0,576),I.mode_ext==u&&(I.pinfo.ers[k][E]=I.pinfo.ers[k][E+2],t.arraycopy(I.pinfo.energy[k][E+2],0,I.pinfo.energy[k][E],0,I.pinfo.energy[k][E].length));if(e.VBR==n.vbr_off||e.VBR==n.vbr_abr){var q,Y;for(q=0;q<18;q++)I.nsPsy.pefirbuf[q]=I.nsPsy.pefirbuf[q+1];for(Y=0,k=0;k<I.mode_gr;k++)for(E=0;E<I.channels_out;E++)Y+=B[k][E];for(I.nsPsy.pefirbuf[18]=Y,Y=I.nsPsy.pefirbuf[9],q=0;q<9;q++)Y+=(I.nsPsy.pefirbuf[q]+I.nsPsy.pefirbuf[18-q])*l.fircoef[q];for(Y=3350*I.mode_gr*I.channels_out/Y,k=0;k<I.mode_gr;k++)for(E=0;E<I.channels_out;E++)B[k][E]*=Y}if(I.iteration_loop.iteration_loop(e,B,P,M),f.format_bitstream(e),S=f.copy_buffer(I,g,y,w,1),e.bWriteVbrTag&&d.addVbrFrame(e),e.analysis&&null!=I.pinfo){for(E=0;E<I.channels_out;E++){var G;for(G=0;G<c;G++)I.pinfo.pcmdata[E][G]=I.pinfo.pcmdata[E][G+e.framesize];for(G=c;G<1600;G++)I.pinfo.pcmdata[E][G]=T[E][G-c]}p.set_frame_pinfo(e,M)}return function(e){var t,n;for(o(0<=e.bitrate_index&&e.bitrate_index<16),o(0<=e.mode_ext&&e.mode_ext<4),e.bitrate_stereoMode_Hist[e.bitrate_index][4]++,e.bitrate_stereoMode_Hist[15][4]++,2==e.channels_out&&(e.bitrate_stereoMode_Hist[e.bitrate_index][e.mode_ext]++,e.bitrate_stereoMode_Hist[15][e.mode_ext]++),t=0;t<e.mode_gr;++t)for(n=0;n<e.channels_out;++n){var r=0|e.l3_side.tt[t][n].block_type;0!=e.l3_side.tt[t][n].mixed_block_flag&&(r=4),e.bitrate_blockType_Hist[e.bitrate_index][r]++,e.bitrate_blockType_Hist[e.bitrate_index][5]++,e.bitrate_blockType_Hist[15][r]++,e.bitrate_blockType_Hist[15][5]++}}(I),S}}return l.ENCDELAY=576,l.POSTDELAY=1152,l.MDCTDELAY=48,l.FFTOFFSET=224+l.MDCTDELAY,l.DECDELAY=528,l.SBLIMIT=32,l.CBANDS=64,l.SBPSY_l=21,l.SBPSY_s=12,l.SBMAX_l=22,l.SBMAX_s=13,l.PSFB21=6,l.PSFB12=6,l.BLKSIZE=1024,l.HBLKSIZE=l.BLKSIZE/2+1,l.BLKSIZE_s=256,l.HBLKSIZE_s=l.BLKSIZE_s/2+1,l.NORM_TYPE=0,l.START_TYPE=1,l.SHORT_TYPE=2,l.STOP_TYPE=3,l.MPG_MD_LR_LR=0,l.MPG_MD_LR_I=1,l.MPG_MD_MS_LR=2,l.MPG_MD_MS_I=3,l.fircoef=[-.1039435,-.1892065,5*-.0432472,-.155915,3898045e-23,.0467745*5,.50455,.756825,.187098*5],zt=l}function or(){if(Jt)return Qt;Jt=1;var e=ir();e.System;var t=e.VbrMode,n=e.Float,r=e.ShortBlock,i=e.Util,a=e.Arrays;e.new_array_n,e.new_byte,e.new_double;var s=e.new_float,o=e.new_float_n,l=e.new_int;e.new_int_n;var _=e.assert,c=function(){if($t)return Wt;$t=1;var e=ir();e.System,e.VbrMode,e.Float,e.ShortBlock;var t=e.Util;e.Arrays,e.new_array_n,e.new_byte,e.new_double;var n=e.new_float;e.new_float_n,e.new_int,e.new_int_n,e.assert;var r=sr();return Wt=function(){var e=n(r.BLKSIZE),i=n(r.BLKSIZE_s/2),a=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function s(e,n,r){var i,s,o,l=0,_=n+(r<<=1);i=4;do{var c,u,f,h,d,p,m;m=i>>1,p=(d=i<<1)+(h=i),i=d<<1,o=(s=n)+m;do{A=e[s+0]-e[s+h],S=e[s+0]+e[s+h],E=e[s+d]-e[s+p],R=e[s+d]+e[s+p],e[s+d]=S-R,e[s+0]=S+R,e[s+p]=A-E,e[s+h]=A+E,A=e[o+0]-e[o+h],S=e[o+0]+e[o+h],E=t.SQRT2*e[o+p],R=t.SQRT2*e[o+d],e[o+d]=S-R,e[o+0]=S+R,e[o+p]=A-E,e[o+h]=A+E,o+=i,s+=i}while(s<_);for(u=a[l+0],c=a[l+1],f=1;f<m;f++){var b,v;b=1-2*c*c,v=2*c*u,s=n+f,o=n+h-f;do{var g,y,w,S,A,M,R,B,E,k;y=v*e[s+h]-b*e[o+h],g=b*e[s+h]+v*e[o+h],A=e[s+0]-g,S=e[s+0]+g,M=e[o+0]-y,w=e[o+0]+y,y=v*e[s+p]-b*e[o+p],g=b*e[s+p]+v*e[o+p],E=e[s+d]-g,R=e[s+d]+g,k=e[o+d]-y,B=e[o+d]+y,y=c*R-u*k,g=u*R+c*k,e[s+d]=S-g,e[s+0]=S+g,e[o+p]=M-y,e[o+h]=M+y,y=u*B-c*E,g=c*B+u*E,e[o+d]=w-g,e[o+0]=w+g,e[s+p]=A-y,e[s+h]=A+y,o+=i,s+=i}while(s<_);u=(b=u)*a[l+0]-c*a[l+1],c=b*a[l+1]+c*a[l+0]}l+=2}while(i<r)}var o=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(e,t,n,a,l){for(var _=0;_<3;_++){var c=r.BLKSIZE_s/2,u=65535&192*(_+1),f=r.BLKSIZE_s/8-1;do{var h,d,p,m,b,v=255&o[f<<2];d=(h=i[v]*a[n][l+v+u])-(b=i[127-v]*a[n][l+v+u+128]),h+=b,m=(p=i[v+64]*a[n][l+v+u+64])-(b=i[63-v]*a[n][l+v+u+192]),p+=b,c-=4,t[_][c+0]=h+p,t[_][c+2]=h-p,t[_][c+1]=d+m,t[_][c+3]=d-m,d=(h=i[v+1]*a[n][l+v+u+1])-(b=i[126-v]*a[n][l+v+u+129]),h+=b,m=(p=i[v+65]*a[n][l+v+u+65])-(b=i[62-v]*a[n][l+v+u+193]),p+=b,t[_][c+r.BLKSIZE_s/2+0]=h+p,t[_][c+r.BLKSIZE_s/2+2]=h-p,t[_][c+r.BLKSIZE_s/2+1]=d+m,t[_][c+r.BLKSIZE_s/2+3]=d-m}while(--f>=0);s(t[_],c,r.BLKSIZE_s/2)}},this.fft_long=function(t,n,i,a,l){var _=r.BLKSIZE/8-1,c=r.BLKSIZE/2;do{var u,f,h,d,p,m=255&o[_];f=(u=e[m]*a[i][l+m])-(p=e[m+512]*a[i][l+m+512]),u+=p,d=(h=e[m+256]*a[i][l+m+256])-(p=e[m+768]*a[i][l+m+768]),h+=p,n[0+(c-=4)]=u+h,n[c+2]=u-h,n[c+1]=f+d,n[c+3]=f-d,f=(u=e[m+1]*a[i][l+m+1])-(p=e[m+513]*a[i][l+m+513]),u+=p,d=(h=e[m+257]*a[i][l+m+257])-(p=e[m+769]*a[i][l+m+769]),h+=p,n[c+r.BLKSIZE/2+0]=u+h,n[c+r.BLKSIZE/2+2]=u-h,n[c+r.BLKSIZE/2+1]=f+d,n[c+r.BLKSIZE/2+3]=f-d}while(--_>=0);s(n,c,r.BLKSIZE/2)},this.init_fft=function(t){for(var n=0;n<r.BLKSIZE;n++)e[n]=.42-.5*Math.cos(2*Math.PI*(n+.5)/r.BLKSIZE)+.08*Math.cos(4*Math.PI*(n+.5)/r.BLKSIZE);for(n=0;n<r.BLKSIZE_s/2;n++)i[n]=.5*(1-Math.cos(2*Math.PI*(n+.5)/r.BLKSIZE_s))}},Wt}(),u=sr();return Qt=function(){var e=new c,f=2.302585092994046,h=1/217621504/(u.BLKSIZE/2),d=.3,p=21,m=.2302585093;function b(e){return e}function v(e,t){for(var n=0,r=0;r<u.BLKSIZE/2;++r)n+=e[r]*t.ATH.eql_w[r];return n*=h}function g(t,n,r,a,s,o,l,_,c,f,h){var d=t.internal_flags;if(c<2)e.fft_long(d,a[s],c,f,h),e.fft_short(d,o[l],c,f,h);else if(2==c){for(var p=u.BLKSIZE-1;p>=0;--p){var m=a[s+0][p],g=a[s+1][p];a[s+0][p]=(m+g)*i.SQRT2*.5,a[s+1][p]=(m-g)*i.SQRT2*.5}for(var y=2;y>=0;--y)for(p=u.BLKSIZE_s-1;p>=0;--p){m=o[l+0][y][p],g=o[l+1][y][p];o[l+0][y][p]=(m+g)*i.SQRT2*.5,o[l+1][y][p]=(m-g)*i.SQRT2*.5}}n[0]=a[s+0][0],n[0]*=n[0];for(p=u.BLKSIZE/2-1;p>=0;--p){var w=a[s+0][u.BLKSIZE/2-p],S=a[s+0][u.BLKSIZE/2+p];n[u.BLKSIZE/2-p]=b(.5*(w*w+S*S))}for(y=2;y>=0;--y){r[y][0]=o[l+0][y][0],r[y][0]*=r[y][0];for(p=u.BLKSIZE_s/2-1;p>=0;--p){w=o[l+0][y][u.BLKSIZE_s/2-p],S=o[l+0][y][u.BLKSIZE_s/2+p];r[y][u.BLKSIZE_s/2-p]=b(.5*(w*w+S*S))}}var A=0;for(p=11;p<u.HBLKSIZE;p++)A+=n[p];if(d.tot_ener[c]=A,t.analysis){for(p=0;p<u.HBLKSIZE;p++)d.pinfo.energy[_][c][p]=d.pinfo.energy_save[c][p],d.pinfo.energy_save[c][p]=n[p];d.pinfo.pe[_][c]=d.pe[c]}2==t.athaa_loudapprox&&c<2&&(d.loudness_sq[_][c]=d.loudness_sq_save[c],d.loudness_sq_save[c]=v(n,d))}var y,w,S,A=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749],M=[3.3246*3.3246,3.23837*3.23837,9.9500500969,9.0247369744,8.1854926609,7.0440875649,2.46209*2.46209,2.284*2.284,4.4892710641,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,2.4621061921,2.1508568964,1.37074*1.37074,1.31036*1.31036,1.5691069696,1.4555939904,1.16203*1.16203,1.2715945225,1.09428*1.09428,1.0659*1.0659,1.0779838276,1.0382591025,1],R=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],B=[5.5396212496,2.29259*2.29259,4.9868695969,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,2.2499700001,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.2339655056,1.0779838276];function E(e,t,n,r,a,s){var o;if(t>e){if(!(t<e*w))return e+t;o=t/e}else{if(e>=t*w)return e+t;o=e/t}if(_(e>=0),_(t>=0),e+=t,r+3<=6){if(o>=y)return e;var l=0|i.FAST_LOG10_X(o,16);return e*R[l]}var c,u;l=0|i.FAST_LOG10_X(o,16);return t=a.ATH.cb_l[n]*a.ATH.adjust,_(t>=0),e<S*t?e>t?(c=1,l<=13&&(c=B[l]),u=i.FAST_LOG10_X(e/t,10/15),e*((M[l]-c)*u+c)):l>13?e:e*B[l]:e*M[l]}var k=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1];function T(e,t,n){var r;if(e<0&&(e=0),t<0&&(t=0),e<=0)return t;if(t<=0)return e;if(r=t>e?t/e:e/t,-2<=n&&n<=2){if(r>=y)return e+t;var a=0|i.FAST_LOG10_X(r,16);return(e+t)*k[a]}return r<w?e+t:(e<t&&(e=t),e)}function I(e,t,n,r,i){var a,s,o=0,l=0;for(a=s=0;a<u.SBMAX_s;++s,++a){for(var c=e.bo_s[a],f=e.npart_s,h=c<f?c:f;s<h;)_(t[s]>=0),_(n[s]>=0),o+=t[s],l+=n[s],s++;if(e.en[r].s[a][i]=o,e.thm[r].s[a][i]=l,s>=f){++a;break}_(t[s]>=0),_(n[s]>=0);var d=e.PSY.bo_s_weight[a],p=1-d;o=d*t[s],l=d*n[s],e.en[r].s[a][i]+=o,e.thm[r].s[a][i]+=l,o=p*t[s],l=p*n[s]}for(;a<u.SBMAX_s;++a)e.en[r].s[a][i]=0,e.thm[r].s[a][i]=0}function x(e,t,n,r){var i,a,s=0,o=0;for(i=a=0;i<u.SBMAX_l;++a,++i){for(var l=e.bo_l[i],c=e.npart_l,f=l<c?l:c;a<f;)_(t[a]>=0),_(n[a]>=0),s+=t[a],o+=n[a],a++;if(e.en[r].l[i]=s,e.thm[r].l[i]=o,a>=c){++i;break}_(t[a]>=0),_(n[a]>=0);var h=e.PSY.bo_l_weight[i],d=1-h;s=h*t[a],o=h*n[a],e.en[r].l[i]+=s,e.thm[r].l[i]+=o,s=d*t[a],o=d*n[a]}for(;i<u.SBMAX_l;++i)e.en[r].l[i]=0,e.thm[r].l[i]=0}function P(e,t,n,r,i,a){var s,o,l=e.internal_flags;for(o=s=0;o<l.npart_s;++o){for(var c=0,f=l.numlines_s[o],h=0;h<f;++h,++s){c+=t[a][s]}n[o]=c}for(_(o==l.npart_s),_(129==s),s=o=0;o<l.npart_s;o++){var d=l.s3ind_s[o][0],p=l.s3_ss[s++]*n[d];for(++d;d<=l.s3ind_s[o][1];)p+=l.s3_ss[s]*n[d],++s,++d;var m=2*l.nb_s1[i][o];if(r[o]=Math.min(p,m),l.blocktype_old[1&i]==u.SHORT_TYPE){m=16*l.nb_s2[i][o];var b=r[o];r[o]=Math.min(m,b)}l.nb_s2[i][o]=l.nb_s1[i][o],l.nb_s1[i][o]=p,_(r[o]>=0)}for(;o<=u.CBANDS;++o)n[o]=0,r[o]=0}function O(e,t,n){return n>=1?e:n<=0?t:t>0?Math.pow(e/t,n)*t:0}var L=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function N(e,t){for(var n=309.07,r=0;r<u.SBMAX_s-1;r++)for(var a=0;a<3;a++){var s=e.thm.s[r][a];if(_(r<L.length),s>0){var o=s*t,l=e.en.s[r][a];l>o&&(l>1e10*o?n+=L[r]*(10*f):(_(o>0),n+=L[r]*i.FAST_LOG10(l/o)))}}return n}var V=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function C(e,t){for(var n=281.0575,r=0;r<u.SBMAX_l-1;r++){var a=e.thm.l[r];if(_(r<V.length),a>0){var s=a*t,o=e.en.l[r];o>s&&(o>1e10*s?n+=V[r]*(10*f):(_(s>0),n+=V[r]*i.FAST_LOG10(o/s)))}}return n}function D(e,t,n,r,i){var a,s;for(a=s=0;a<e.npart_l;++a){var o,l=0,c=0;for(o=0;o<e.numlines_l[a];++o,++s){var u=t[s];_(u>=0),l+=u,c<u&&(c=u)}n[a]=l,r[a]=c,i[a]=l*e.rnumlines_l[a],_(e.rnumlines_l[a]>=0),_(l>=0),_(n[a]>=0),_(r[a]>=0),_(i[a]>=0)}}function H(e,t,n,r){var i=A.length-1,a=0,s=n[a]+n[a+1];(_(s>=0),s>0)?((o=t[a])<t[a+1]&&(o=t[a+1]),_(e.numlines_l[a]+e.numlines_l[a+1]-1>0),(l=0|(s=20*(2*o-s)/(s*(e.numlines_l[a]+e.numlines_l[a+1]-1))))>i&&(l=i),r[a]=l):r[a]=0;for(a=1;a<e.npart_l-1;a++){var o,l;if(s=n[a-1]+n[a]+n[a+1],_(s>=0),s>0)(o=t[a-1])<t[a]&&(o=t[a]),o<t[a+1]&&(o=t[a+1]),_(e.numlines_l[a-1]+e.numlines_l[a]+e.numlines_l[a+1]-1>0),(l=0|(s=20*(3*o-s)/(s*(e.numlines_l[a-1]+e.numlines_l[a]+e.numlines_l[a+1]-1))))>i&&(l=i),r[a]=l;else r[a]=0}(_(a>0),_(a==e.npart_l-1),s=n[a-1]+n[a],_(s>=0),s>0)?((o=t[a-1])<t[a]&&(o=t[a]),_(e.numlines_l[a-1]+e.numlines_l[a]-1>0),(l=0|(s=20*(2*o-s)/(s*(e.numlines_l[a-1]+e.numlines_l[a]-1))))>i&&(l=i),r[a]=l):r[a]=0;_(a==e.npart_l-1)}var j=[-1730326e-23,-.01703172,-1349528e-23,.0418072,-673278e-22,-.0876324,-30835e-21,.1863476,-1104424e-22,-.627638];function F(t,n,r,a,s,o,l,_){var c=t.internal_flags;if(a<2)e.fft_long(c,l[_],a,n,r);else if(2==a)for(var f=u.BLKSIZE-1;f>=0;--f){var h=l[_+0][f],d=l[_+1][f];l[_+0][f]=(h+d)*i.SQRT2*.5,l[_+1][f]=(h-d)*i.SQRT2*.5}o[0]=l[_+0][0],o[0]*=o[0];for(f=u.BLKSIZE/2-1;f>=0;--f){var p=l[_+0][u.BLKSIZE/2-f],m=l[_+0][u.BLKSIZE/2+f];o[u.BLKSIZE/2-f]=b(.5*(p*p+m*m))}var v=0;for(f=11;f<u.HBLKSIZE;f++)v+=o[f];if(c.tot_ener[a]=v,t.analysis){for(f=0;f<u.HBLKSIZE;f++)c.pinfo.energy[s][a][f]=c.pinfo.energy_save[a][f],c.pinfo.energy_save[a][f]=o[f];c.pinfo.pe[s][a]=c.pe[a]}}function X(t,n,r,a,s,o,l,_){var c=t.internal_flags;if(0==s&&a<2&&e.fft_short(c,l[_],a,n,r),2==a)for(var f=u.BLKSIZE_s-1;f>=0;--f){var h=l[_+0][s][f],d=l[_+1][s][f];l[_+0][s][f]=(h+d)*i.SQRT2*.5,l[_+1][s][f]=(h-d)*i.SQRT2*.5}o[s][0]=l[_+0][s][0],o[s][0]*=o[s][0];for(f=u.BLKSIZE_s/2-1;f>=0;--f){var p=l[_+0][s][u.BLKSIZE_s/2-f],m=l[_+0][s][u.BLKSIZE_s/2+f];o[s][u.BLKSIZE_s/2-f]=b(.5*(p*p+m*m))}}function q(e,t,n,r){var i=e.internal_flags;2==e.athaa_loudapprox&&n<2&&(i.loudness_sq[t][n]=i.loudness_sq_save[n],i.loudness_sq_save[n]=v(r,i))}this.L3psycho_anal_ns=function(e,n,i,c,f,h,m,b,v,y){var w,S,M,R,B,k,T,L,V,F,X=e.internal_flags,q=o([2,u.BLKSIZE]),Y=o([2,3,u.BLKSIZE_s]),G=s(u.CBANDS+1),U=s(u.CBANDS+1),K=s(u.CBANDS+2),z=l(2),Z=l(2),W=o([2,576]),$=l(u.CBANDS+2),Q=l(u.CBANDS+2);for(a.fill(Q,0),w=X.channels_out,e.mode==MPEGMode.JOINT_STEREO&&(w=4),V=e.VBR==t.vbr_off?0==X.ResvMax?0:X.ResvSize/X.ResvMax*.5:e.VBR==t.vbr_rh||e.VBR==t.vbr_mtrh||e.VBR==t.vbr_mt?.6:1,S=0;S<X.channels_out;S++){var J=n[S],ee=i+576-350-p+192;for(_(10==j.length),R=0;R<576;R++){var te,ne;for(te=J[ee+R+10],ne=0,B=0;B<9;B+=2)te+=j[B]*(J[ee+R+B]+J[ee+R+p-B]),ne+=j[B+1]*(J[ee+R+B+1]+J[ee+R+p-B-1]);W[S][R]=te+ne}f[c][S].en.assign(X.en[S]),f[c][S].thm.assign(X.thm[S]),w>2&&(h[c][S].en.assign(X.en[S+2]),h[c][S].thm.assign(X.thm[S+2]))}for(S=0;S<w;S++){var re,ie=s(12),ae=[0,0,0,0],se=s(12),oe=1,le=s(u.CBANDS),_e=s(u.CBANDS),ce=[0,0,0,0],ue=s(u.HBLKSIZE),fe=o([3,u.HBLKSIZE_s]);for(_(X.npart_s<=u.CBANDS),_(X.npart_l<=u.CBANDS),R=0;R<3;R++)ie[R]=X.nsPsy.last_en_subshort[S][R+6],_(X.nsPsy.last_en_subshort[S][R+4]>0),se[R]=ie[R]/X.nsPsy.last_en_subshort[S][R+4],ae[0]+=ie[R];if(2==S)for(R=0;R<576;R++){var he,de;he=W[0][R],de=W[1][R],W[0][R]=he+de,W[1][R]=he-de}var pe=W[1&S],me=0;for(R=0;R<9;R++){for(var be=me+64,ve=1;me<be;me++)ve<Math.abs(pe[me])&&(ve=Math.abs(pe[me]));X.nsPsy.last_en_subshort[S][R]=ie[R+3]=ve,ae[1+R/3]+=ve,ve>ie[R+3-2]?(_(ie[R+3-2]>0),ve/=ie[R+3-2]):ie[R+3-2]>10*ve?(_(ve>0),ve=ie[R+3-2]/(10*ve)):ve=0,se[R+3]=ve}if(e.analysis){var ge=se[0];for(R=1;R<12;R++)ge<se[R]&&(ge=se[R]);X.pinfo.ers[c][S]=X.pinfo.ers_save[S],X.pinfo.ers_save[S]=ge}for(re=3==S?X.nsPsy.attackthre_s:X.nsPsy.attackthre,R=0;R<12;R++)0==ce[R/3]&&se[R]>re&&(ce[R/3]=R%3+1);for(R=1;R<4;R++){var ye;ae[R-1]>ae[R]?(_(ae[R]>0),ye=ae[R-1]/ae[R]):(_(ae[R-1]>0),ye=ae[R]/ae[R-1]),ye<1.7&&(ce[R]=0,1==R&&(ce[0]=0))}for(0!=ce[0]&&0!=X.nsPsy.lastAttacks[S]&&(ce[0]=0),3!=X.nsPsy.lastAttacks[S]&&ce[0]+ce[1]+ce[2]+ce[3]==0||(oe=0,0!=ce[1]&&0!=ce[0]&&(ce[1]=0),0!=ce[2]&&0!=ce[1]&&(ce[2]=0),0!=ce[3]&&0!=ce[2]&&(ce[3]=0)),S<2?Z[S]=oe:0==oe&&(Z[0]=Z[1]=0),v[S]=X.tot_ener[S],g(e,ue,fe,q,1&S,Y,1&S,c,S,n,i),D(X,ue,G,le,_e),H(X,le,_e,$),L=0;L<3;L++){var we,Se;for(P(e,fe,U,K,S,L),I(X,U,K,S,L),T=0;T<u.SBMAX_s;T++){if(Se=X.thm[S].s[T][L],Se*=.8,ce[L]>=2||1==ce[L+1]){var Ae=0!=L?L-1:2;ve=O(X.thm[S].s[T][Ae],Se,.6*V);Se=Math.min(Se,ve)}if(1==ce[L]){Ae=0!=L?L-1:2,ve=O(X.thm[S].s[T][Ae],Se,d*V);Se=Math.min(Se,ve)}else if(0!=L&&3==ce[L-1]||0==L&&3==X.nsPsy.lastAttacks[S]){Ae=2!=L?L+1:0,ve=O(X.thm[S].s[T][Ae],Se,d*V);Se=Math.min(Se,ve)}we=ie[3*L+3]+ie[3*L+4]+ie[3*L+5],6*ie[3*L+5]<we&&(Se*=.5,6*ie[3*L+4]<we&&(Se*=.5)),X.thm[S].s[T][L]=Se}}for(X.nsPsy.lastAttacks[S]=ce[2],k=0,M=0;M<X.npart_l;M++){for(var Me=X.s3ind[M][0],Re=G[Me]*A[$[Me]],Be=X.s3_ll[k++]*Re;++Me<=X.s3ind[M][1];)Re=G[Me]*A[$[Me]],Be=E(Be,X.s3_ll[k++]*Re,Me,Me-M,X);Be*=.158489319246111,X.blocktype_old[1&S]==u.SHORT_TYPE?K[M]=Be:K[M]=O(Math.min(Be,Math.min(2*X.nb_1[S][M],16*X.nb_2[S][M])),Be,V),X.nb_2[S][M]=X.nb_1[S][M],X.nb_1[S][M]=Be}for(;M<=u.CBANDS;++M)G[M]=0,K[M]=0;x(X,G,K,S)}(e.mode!=MPEGMode.STEREO&&e.mode!=MPEGMode.JOINT_STEREO||e.interChRatio>0&&function(e,t){var n=e.internal_flags;if(n.channels_out>1){for(var r=0;r<u.SBMAX_l;r++){var i=n.thm[0].l[r],a=n.thm[1].l[r];n.thm[0].l[r]+=a*t,n.thm[1].l[r]+=i*t}for(r=0;r<u.SBMAX_s;r++)for(var s=0;s<3;s++)i=n.thm[0].s[r][s],a=n.thm[1].s[r][s],n.thm[0].s[r][s]+=a*t,n.thm[1].s[r][s]+=i*t}}(e,e.interChRatio),e.mode==MPEGMode.JOINT_STEREO)&&(!function(e){for(var t=0;t<u.SBMAX_l;t++)if(!(e.thm[0].l[t]>1.58*e.thm[1].l[t]||e.thm[1].l[t]>1.58*e.thm[0].l[t])){var n=e.mld_l[t]*e.en[3].l[t],r=Math.max(e.thm[2].l[t],Math.min(e.thm[3].l[t],n));n=e.mld_l[t]*e.en[2].l[t];var i=Math.max(e.thm[3].l[t],Math.min(e.thm[2].l[t],n));e.thm[2].l[t]=r,e.thm[3].l[t]=i}for(t=0;t<u.SBMAX_s;t++)for(var a=0;a<3;a++)e.thm[0].s[t][a]>1.58*e.thm[1].s[t][a]||e.thm[1].s[t][a]>1.58*e.thm[0].s[t][a]||(n=e.mld_s[t]*e.en[3].s[t][a],r=Math.max(e.thm[2].s[t][a],Math.min(e.thm[3].s[t][a],n)),n=e.mld_s[t]*e.en[2].s[t][a],i=Math.max(e.thm[3].s[t][a],Math.min(e.thm[2].s[t][a],n)),e.thm[2].s[t][a]=r,e.thm[3].s[t][a]=i)}(X),F=e.msfix,Math.abs(F)>0&&function(e,t,n){var r=t,i=Math.pow(10,n);t*=2,r*=2;for(var a=0;a<u.SBMAX_l;a++)f=e.ATH.cb_l[e.bm_l[a]]*i,(o=Math.min(Math.max(e.thm[0].l[a],f),Math.max(e.thm[1].l[a],f)))*t<(l=Math.max(e.thm[2].l[a],f))+(c=Math.max(e.thm[3].l[a],f))&&_((l*=h=o*r/(l+c))+(c*=h)>0),e.thm[2].l[a]=Math.min(l,e.thm[2].l[a]),e.thm[3].l[a]=Math.min(c,e.thm[3].l[a]);for(i*=u.BLKSIZE_s/u.BLKSIZE,a=0;a<u.SBMAX_s;a++)for(var s=0;s<3;s++){var o,l,c,f,h;f=e.ATH.cb_s[e.bm_s[a]]*i,(o=Math.min(Math.max(e.thm[0].s[a][s],f),Math.max(e.thm[1].s[a][s],f)))*t<(l=Math.max(e.thm[2].s[a][s],f))+(c=Math.max(e.thm[3].s[a][s],f))&&_((l*=h=o*t/(l+c))+(c*=h)>0),e.thm[2].s[a][s]=Math.min(e.thm[2].s[a][s],l),e.thm[3].s[a][s]=Math.min(e.thm[3].s[a][s],c)}}(X,F,e.ATHlower*X.ATH.adjust));for(function(e,t,n,i){var a=e.internal_flags;e.short_blocks!=r.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var s=0;s<a.channels_out;s++)i[s]=u.NORM_TYPE,e.short_blocks==r.short_block_dispensed&&(t[s]=1),e.short_blocks==r.short_block_forced&&(t[s]=0),0!=t[s]?(_(a.blocktype_old[s]!=u.START_TYPE),a.blocktype_old[s]==u.SHORT_TYPE&&(i[s]=u.STOP_TYPE)):(i[s]=u.SHORT_TYPE,a.blocktype_old[s]==u.NORM_TYPE&&(a.blocktype_old[s]=u.START_TYPE),a.blocktype_old[s]==u.STOP_TYPE&&(a.blocktype_old[s]=u.SHORT_TYPE)),n[s]=a.blocktype_old[s],a.blocktype_old[s]=i[s]}(e,Z,y,z),S=0;S<w;S++){var Ee,ke,Te,Ie=0;S>1?(Ee=b,Ie=-2,ke=u.NORM_TYPE,y[0]!=u.SHORT_TYPE&&y[1]!=u.SHORT_TYPE||(ke=u.SHORT_TYPE),Te=h[c][S-2]):(Ee=m,Ie=0,ke=y[S],Te=f[c][S]),ke==u.SHORT_TYPE?Ee[Ie+S]=N(Te,X.masking_lower):Ee[Ie+S]=C(Te,X.masking_lower),e.analysis&&(X.pinfo.pe[c][S]=Ee[Ie+S])}return 0};var Y=[-1730326e-23,-.01703172,-1349528e-23,.0418072,-673278e-22,-.0876324,-30835e-21,.1863476,-1104424e-22,-.627638];function G(e,t,n){if(0==n)for(var r=0;r<e.npart_s;r++)e.nb_s2[t][r]=e.nb_s1[t][r],e.nb_s1[t][r]=0}function U(e,t){for(var n=0;n<e.npart_l;n++)e.nb_2[t][n]=e.nb_1[t][n],e.nb_1[t][n]=0}function K(e,t,n,r,i,a){var o,l,c,f=e.internal_flags,h=new float[u.CBANDS],d=s(u.CBANDS),p=new int[u.CBANDS];for(c=l=0;c<f.npart_s;++c){var m=0,b=0,v=f.numlines_s[c];for(o=0;o<v;++o,++l){var g=t[a][l];m+=g,b<g&&(b=g)}n[c]=m,_(m>=0),h[c]=b,_(v>0),d[c]=m/v,_(d[c]>=0)}for(_(c==f.npart_s),_(129==l);c<u.CBANDS;++c)h[c]=0,d[c]=0;for(function(e,t,n,r){var i=A.length-1,a=0,s=n[a]+n[a+1];for(_(s>=0),s>0?((o=t[a])<t[a+1]&&(o=t[a+1]),_(e.numlines_s[a]+e.numlines_s[a+1]-1>0),(l=0|(s=20*(2*o-s)/(s*(e.numlines_s[a]+e.numlines_s[a+1]-1))))>i&&(l=i),r[a]=l):r[a]=0,a=1;a<e.npart_s-1;a++){var o,l;s=n[a-1]+n[a]+n[a+1],_(a+1<e.npart_s),_(s>=0),s>0?((o=t[a-1])<t[a]&&(o=t[a]),o<t[a+1]&&(o=t[a+1]),_(e.numlines_s[a-1]+e.numlines_s[a]+e.numlines_s[a+1]-1>0),(l=0|(s=20*(3*o-s)/(s*(e.numlines_s[a-1]+e.numlines_s[a]+e.numlines_s[a+1]-1))))>i&&(l=i),r[a]=l):r[a]=0}_(a>0),_(a==e.npart_s-1),s=n[a-1]+n[a],_(s>=0),s>0?((o=t[a-1])<t[a]&&(o=t[a]),_(e.numlines_s[a-1]+e.numlines_s[a]-1>0),(l=0|(s=20*(2*o-s)/(s*(e.numlines_s[a-1]+e.numlines_s[a]-1))))>i&&(l=i),r[a]=l):r[a]=0,_(a==e.npart_s-1)}(f,h,d,p),l=c=0;c<f.npart_s;c++){var y,w,S,M,R,B=f.s3ind_s[c][0],E=f.s3ind_s[c][1];for(y=p[B],w=1,M=f.s3_ss[l]*n[B]*A[p[B]],++l,++B;B<=E;)y+=p[B],w+=1,M=T(M,S=f.s3_ss[l]*n[B]*A[p[B]],B-c),++l,++B;M*=R=.5*A[y=(1+2*y)/(2*w)],r[c]=M,f.nb_s2[i][c]=f.nb_s1[i][c],f.nb_s1[i][c]=M,S=h[c],S*=f.minval_s[c],S*=R,r[c]>S&&(r[c]=S),f.masking_lower>1&&(r[c]*=f.masking_lower),r[c]>n[c]&&(r[c]=n[c]),f.masking_lower<1&&(r[c]*=f.masking_lower),_(r[c]>=0)}for(;c<u.CBANDS;++c)n[c]=0,r[c]=0}function z(e,t,n,r,i){var a,o=s(u.CBANDS),c=s(u.CBANDS),f=l(u.CBANDS+2);D(e,t,n,o,c),H(e,o,c,f);var h=0;for(a=0;a<e.npart_l;a++){var p,m,b,v=e.s3ind[a][0],g=e.s3ind[a][1],y=0,w=0;for(y=f[v],w+=1,m=e.s3_ll[h]*n[v]*A[f[v]],++h,++v;v<=g;)y+=f[v],w+=1,m=T(m,p=e.s3_ll[h]*n[v]*A[f[v]],v-a),++h,++v;if(m*=b=.5*A[y=(1+2*y)/(2*w)],e.blocktype_old[1&i]==u.SHORT_TYPE){var S=2*e.nb_1[i][a];r[a]=S>0?Math.min(m,S):Math.min(m,n[a]*d)}else{var M=16*e.nb_2[i][a],R=2*e.nb_1[i][a];M<=0&&(M=m),R<=0&&(R=m),S=e.blocktype_old[1&i]==u.NORM_TYPE?Math.min(R,M):R,r[a]=Math.min(m,S)}e.nb_2[i][a]=e.nb_1[i][a],e.nb_1[i][a]=m,p=o[a],p*=e.minval_l[a],p*=b,r[a]>p&&(r[a]=p),e.masking_lower>1&&(r[a]*=e.masking_lower),r[a]>n[a]&&(r[a]=n[a]),e.masking_lower<1&&(r[a]*=e.masking_lower),_(r[a]>=0)}for(;a<u.CBANDS;++a)n[a]=0,r[a]=0}function Z(e,t,n,r,i,a,s){for(var o,l,c=2*a,u=a>0?Math.pow(10,i):1,f=0;f<s;++f){var h=e[2][f],d=e[3][f],p=t[0][f],m=t[1][f],b=t[2][f],v=t[3][f];if(p<=1.58*m&&m<=1.58*p){var g=n[f]*d,y=n[f]*h;l=Math.max(b,Math.min(v,g)),o=Math.max(v,Math.min(b,y))}else l=b,o=v;if(a>0){var w,S,A=r[f]*u;if(w=Math.min(Math.max(p,A),Math.max(m,A)),(S=(b=Math.max(l,A))+(v=Math.max(o,A)))>0&&w*c<S){var M=w*c/S;b*=M,v*=M,_(S>0)}l=Math.min(b,l),o=Math.min(v,o)}l>h&&(l=h),o>d&&(o=d),t[2][f]=l,t[3][f]=o}}function W(e,t){var n;return(n=e>=0?27*-e:e*t)<=-72?0:Math.exp(n*m)}function $(e){var t,n,r=0;for(r=0;W(r,e)>1e-20;r-=1);for(i=r,a=0;Math.abs(a-i)>1e-12;)W(r=(a+i)/2,e)>0?a=r:i=r;t=i;var i,a;r=0;for(r=0;W(r,e)>1e-20;r+=1);for(i=0,a=r;Math.abs(a-i)>1e-12;)W(r=(a+i)/2,e)>0?i=r:a=r;n=a;var s,o=0,l=1e3;for(s=0;s<=l;++s){o+=W(r=t+s*(n-t)/l,e)}return(l+1)/(o*(n-t))}function Q(e){var t,n,r,i;return t=e,n=(t*=t>=0?3:1.5)>=.5&&t<=2.5?8*((i=t-.5)*i-2*i):0,(r=15.811389+7.5*(t+=.474)-17.5*Math.sqrt(1+t*t))<=-60?0:(t=Math.exp((n+r)*m),t/=.6609193)}function J(e){return e<0&&(e=0),e*=.001,13*Math.atan(.76*e)+3.5*Math.atan(e*e/56.25)}function ee(e,t,n,r,i,a,o,c,f,h,d,p){var m,b=s(u.CBANDS+1),v=c/(p>15?1152:384),g=l(u.HBLKSIZE);c/=f;var y=0,w=0;for(m=0;m<u.CBANDS;m++){var S;for(x=J(c*y),b[m]=c*y,S=y;J(c*S)-x<.34&&S<=f/2;S++);for(e[m]=S-y,w=m+1;y<S;)_(y<u.HBLKSIZE),g[y++]=m;if(y>f/2){y=f/2,++m;break}}_(m<u.CBANDS),b[m]=c*y;for(var A=0;A<p;A++){var M,R,B,E,k;B=h[A],E=h[A+1],(M=0|Math.floor(.5+d*(B-.5)))<0&&(M=0),(R=0|Math.floor(.5+d*(E-.5)))>f/2&&(R=f/2),n[A]=(g[M]+g[R])/2,t[A]=g[R];var T=v*E;o[A]=(T-b[t[A]])/(b[t[A]+1]-b[t[A]]),o[A]<0?o[A]=0:o[A]>1&&(o[A]=1),k=J(c*h[A]*d),k=Math.min(k,15.5)/15.5,a[A]=Math.pow(10,1.25*(1-Math.cos(Math.PI*k))-2.5)}y=0;for(var I=0;I<w;I++){var x,P,O=e[I];x=J(c*y),P=J(c*(y+O-1)),r[I]=.5*(x+P),x=J(c*(y-.5)),P=J(c*(y+O-.5)),i[I]=P-x,y+=O}return w}function te(e,t,n,r,i,a){var l,_=o([u.CBANDS,u.CBANDS]),c=0;if(a)for(var f=0;f<t;f++)for(l=0;l<t;l++){var h=Q(n[f]-n[l])*r[l];_[f][l]=h*i[f]}else for(l=0;l<t;l++){var d=15+Math.min(21/n[l],12),p=$(d);for(f=0;f<t;f++){h=p*W(n[f]-n[l],d)*r[l];_[f][l]=h*i[f]}}for(f=0;f<t;f++){for(l=0;l<t&&!(_[f][l]>0);l++);for(e[f][0]=l,l=t-1;l>0&&!(_[f][l]>0);l--);e[f][1]=l,c+=e[f][1]-e[f][0]+1}var m=s(c),b=0;for(f=0;f<t;f++)for(l=e[f][0];l<=e[f][1];l++)m[b++]=_[f][l];return m}function ne(e){var t=J(e);return t=Math.min(t,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*t))-2.5)}function re(e,t){return e<-.3&&(e=3410),e/=1e3,e=Math.max(.1,e),3.64*Math.pow(e,-.8)-6.8*Math.exp(-.6*Math.pow(e-3.4,2))+6*Math.exp(-.15*Math.pow(e-8.7,2))+.001*(.6+.04*t)*Math.pow(e,4)}this.L3psycho_anal_vbr=function(e,t,n,i,a,c,f,h,d,m){var b=e.internal_flags,v=s(u.HBLKSIZE),g=o([3,u.HBLKSIZE_s]),y=o([2,u.BLKSIZE]),w=o([2,3,u.BLKSIZE_s]),S=o([4,u.CBANDS]),A=o([4,u.CBANDS]),M=o([4,3]),R=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],B=l(2),E=e.mode==MPEGMode.JOINT_STEREO?4:b.channels_out;!function(e,t,n,r,i,a,l,c,u,f){for(var h=o([2,576]),d=e.internal_flags,m=d.channels_out,b=e.mode==MPEGMode.JOINT_STEREO?4:m,v=0;v<m;v++){firbuf=t[v];var g=n+576-350-p+192;_(10==Y.length);for(var y=0;y<576;y++){var w,S;w=firbuf[g+y+10],S=0;for(var A=0;A<9;A+=2)w+=Y[A]*(firbuf[g+y+A]+firbuf[g+y+p-A]),S+=Y[A+1]*(firbuf[g+y+A+1]+firbuf[g+y+p-A-1]);h[v][y]=w+S}i[r][v].en.assign(d.en[v]),i[r][v].thm.assign(d.thm[v]),b>2&&(a[r][v].en.assign(d.en[v+2]),a[r][v].thm.assign(d.thm[v+2]))}for(v=0;v<b;v++){var M=s(12),R=s(12),B=[0,0,0,0],E=h[1&v],k=0,T=3==v?d.nsPsy.attackthre_s:d.nsPsy.attackthre,I=1;if(2==v)for(y=0,A=576;A>0;++y,--A){var x=h[0][y],P=h[1][y];h[0][y]=x+P,h[1][y]=x-P}for(y=0;y<3;y++)R[y]=d.nsPsy.last_en_subshort[v][y+6],_(d.nsPsy.last_en_subshort[v][y+4]>0),M[y]=R[y]/d.nsPsy.last_en_subshort[v][y+4],B[0]+=R[y];for(y=0;y<9;y++){for(var O=k+64,L=1;k<O;k++)L<Math.abs(E[k])&&(L=Math.abs(E[k]));d.nsPsy.last_en_subshort[v][y]=R[y+3]=L,B[1+y/3]+=L,L>R[y+3-2]?(_(R[y+3-2]>0),L/=R[y+3-2]):R[y+3-2]>10*L?(_(L>0),L=R[y+3-2]/(10*L)):L=0,M[y+3]=L}for(y=0;y<3;++y){var N=R[3*y+3]+R[3*y+4]+R[3*y+5],V=1;6*R[3*y+5]<N&&(V*=.5,6*R[3*y+4]<N&&(V*=.5)),c[v][y]=V}if(e.analysis){var C=M[0];for(y=1;y<12;y++)C<M[y]&&(C=M[y]);d.pinfo.ers[r][v]=d.pinfo.ers_save[v],d.pinfo.ers_save[v]=C}for(y=0;y<12;y++)0==u[v][y/3]&&M[y]>T&&(u[v][y/3]=y%3+1);for(y=1;y<4;y++){var D=B[y-1],H=B[y];Math.max(D,H)<4e4&&D<1.7*H&&H<1.7*D&&(1==y&&u[v][0]<=u[v][y]&&(u[v][0]=0),u[v][y]=0)}u[v][0]<=d.nsPsy.lastAttacks[v]&&(u[v][0]=0),3!=d.nsPsy.lastAttacks[v]&&u[v][0]+u[v][1]+u[v][2]+u[v][3]==0||(I=0,0!=u[v][1]&&0!=u[v][0]&&(u[v][1]=0),0!=u[v][2]&&0!=u[v][1]&&(u[v][2]=0),0!=u[v][3]&&0!=u[v][2]&&(u[v][3]=0)),v<2?f[v]=I:0==I&&(f[0]=f[1]=0),l[v]=d.tot_ener[v]}}(e,t,n,i,a,c,d,M,R,B),function(e,t){var n=e.internal_flags;e.short_blocks!=r.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var i=0;i<n.channels_out;i++)e.short_blocks==r.short_block_dispensed&&(t[i]=1),e.short_blocks==r.short_block_forced&&(t[i]=0)}(e,B);for(var k=0;k<E;k++){F(e,t,n,k,i,v,y,P=1&k),q(e,i,k,v),0!=B[P]?z(b,v,S[k],A[k],k):U(b,k)}B[0]+B[1]==2&&e.mode==MPEGMode.JOINT_STEREO&&Z(S,A,b.mld_cb_l,b.ATH.cb_l,e.ATHlower*b.ATH.adjust,e.msfix,b.npart_l);for(k=0;k<E;k++){0!=B[P=1&k]&&x(b,S[k],A[k],k)}for(var T=0;T<3;T++){for(k=0;k<E;++k){0!=B[P=1&k]?G(b,k,T):(X(e,t,n,k,T,g,w,P),K(e,g,S[k],A[k],k,T))}B[0]+B[1]==0&&e.mode==MPEGMode.JOINT_STEREO&&Z(S,A,b.mld_cb_s,b.ATH.cb_s,e.ATHlower*b.ATH.adjust,e.msfix,b.npart_s);for(k=0;k<E;++k){0==B[P=1&k]&&I(b,S[k],A[k],k,T)}}for(k=0;k<E;k++){var P;if(0==B[P=1&k])for(var L=0;L<u.SBMAX_s;L++){var V=s(3);for(T=0;T<3;T++){var D=b.thm[k].s[L][T];if(D*=.8,R[k][T]>=2||1==R[k][T+1]){var H=0!=T?T-1:2,j=O(b.thm[k].s[L][H],D,.36);D=Math.min(D,j)}else if(1==R[k][T]){H=0!=T?T-1:2,j=O(b.thm[k].s[L][H],D,.18);D=Math.min(D,j)}else if(0!=T&&3==R[k][T-1]||0==T&&3==b.nsPsy.lastAttacks[k]){H=2!=T?T+1:0,j=O(b.thm[k].s[L][H],D,.18);D=Math.min(D,j)}D*=M[k][T],V[T]=D}for(T=0;T<3;T++)b.thm[k].s[L][T]=V[T]}}for(k=0;k<E;k++)b.nsPsy.lastAttacks[k]=R[k][2];!function(e,t,n){for(var r=e.internal_flags,i=0;i<r.channels_out;i++){var a=u.NORM_TYPE;0!=t[i]?(_(r.blocktype_old[i]!=u.START_TYPE),r.blocktype_old[i]==u.SHORT_TYPE&&(a=u.STOP_TYPE)):(a=u.SHORT_TYPE,r.blocktype_old[i]==u.NORM_TYPE&&(r.blocktype_old[i]=u.START_TYPE),r.blocktype_old[i]==u.STOP_TYPE&&(r.blocktype_old[i]=u.SHORT_TYPE)),n[i]=r.blocktype_old[i],r.blocktype_old[i]=a}}(e,B,m);for(k=0;k<E;k++){var W,$,Q,J;k>1?(W=h,$=-2,Q=u.NORM_TYPE,m[0]!=u.SHORT_TYPE&&m[1]!=u.SHORT_TYPE||(Q=u.SHORT_TYPE),J=c[i][k-2]):(W=f,$=0,Q=m[k],J=a[i][k]),Q==u.SHORT_TYPE?W[$+k]=N(J,b.masking_lower):W[$+k]=C(J,b.masking_lower),e.analysis&&(b.pinfo.pe[i][k]=W[$+k])}return 0},this.psymodel_init=function(r){var i,a=r.internal_flags,o=!0,l=13,c=24,h=0,d=0,p=-8.25,m=-4.5,b=s(u.CBANDS),v=s(u.CBANDS),g=s(u.CBANDS),A=r.out_samplerate;switch(r.experimentalZ){default:case 0:o=!0;break;case 1:o=r.VBR!=t.vbr_mtrh&&r.VBR!=t.vbr_mt;break;case 2:o=!1;break;case 3:l=8,h=-1.75,d=-.0125,p=-8.25,m=-2.25}for(a.ms_ener_ratio_old=.25,a.blocktype_old[0]=a.blocktype_old[1]=u.NORM_TYPE,i=0;i<4;++i){for(var M=0;M<u.CBANDS;++M)a.nb_1[i][M]=1e20,a.nb_2[i][M]=1e20,a.nb_s1[i][M]=a.nb_s2[i][M]=1;for(var R=0;R<u.SBMAX_l;R++)a.en[i].l[R]=1e20,a.thm[i].l[R]=1e20;for(M=0;M<3;++M){for(R=0;R<u.SBMAX_s;R++)a.en[i].s[R][M]=1e20,a.thm[i].s[R][M]=1e20;a.nsPsy.lastAttacks[i]=0}for(M=0;M<9;M++)a.nsPsy.last_en_subshort[i][M]=10}for(a.loudness_sq_save[0]=a.loudness_sq_save[1]=0,a.npart_l=ee(a.numlines_l,a.bo_l,a.bm_l,b,v,a.mld_l,a.PSY.bo_l_weight,A,u.BLKSIZE,a.scalefac_band.l,u.BLKSIZE/1152,u.SBMAX_l),_(a.npart_l<u.CBANDS),i=0;i<a.npart_l;i++){var B=h;b[i]>=l&&(B=d*(b[i]-l)/(c-l)+h*(c-b[i])/(c-l)),g[i]=Math.pow(10,B/10),a.numlines_l[i]>0?a.rnumlines_l[i]=1/a.numlines_l[i]:a.rnumlines_l[i]=0}a.s3_ll=te(a.s3ind,a.npart_l,b,v,g,o);var E;M=0;for(i=0;i<a.npart_l;i++){I=n.MAX_VALUE;for(var k=0;k<a.numlines_l[i];k++,M++){var T=A*M/(1e3*u.BLKSIZE);x=this.ATHformula(1e3*T,r)-20,x=Math.pow(10,.1*x),I>(x*=a.numlines_l[i])&&(I=x)}a.ATH.cb_l[i]=I,(I=20*b[i]/10-20)>6&&(I=100),I<-15&&(I=-15),I-=8,a.minval_l[i]=Math.pow(10,I/10)*a.numlines_l[i]}for(a.npart_s=ee(a.numlines_s,a.bo_s,a.bm_s,b,v,a.mld_s,a.PSY.bo_s_weight,A,u.BLKSIZE_s,a.scalefac_band.s,u.BLKSIZE_s/384,u.SBMAX_s),_(a.npart_s<u.CBANDS),M=0,i=0;i<a.npart_s;i++){var I;B=p;b[i]>=l&&(B=m*(b[i]-l)/(c-l)+p*(c-b[i])/(c-l)),g[i]=Math.pow(10,B/10),I=n.MAX_VALUE;for(k=0;k<a.numlines_s[i];k++,M++){var x;T=A*M/(1e3*u.BLKSIZE_s);x=this.ATHformula(1e3*T,r)-20,x=Math.pow(10,.1*x),I>(x*=a.numlines_s[i])&&(I=x)}a.ATH.cb_s[i]=I,I=7*b[i]/12-7,b[i]>12&&(I*=1+3.1*Math.log(1+I)),b[i]<12&&(I*=1+2.3*Math.log(1-I)),I<-15&&(I=-15),I-=8,a.minval_s[i]=Math.pow(10,I/10)*a.numlines_s[i]}a.s3_ss=te(a.s3ind_s,a.npart_s,b,v,g,o),y=Math.pow(10,9/16),w=Math.pow(10,1.5),S=Math.pow(10,1.5),e.init_fft(a),a.decay=Math.exp(-1*f/(.01*A/192)),E=3.5,2&r.exp_nspsytune&&(E=1),Math.abs(r.msfix)>0&&(E=r.msfix),r.msfix=E;for(var P=0;P<a.npart_l;P++)a.s3ind[P][1]>a.npart_l-1&&(a.s3ind[P][1]=a.npart_l-1);var O=576*a.mode_gr/A;if(a.ATH.decay=Math.pow(10,-1.2*O),a.ATH.adjust=.01,a.ATH.adjustLimit=1,_(a.bo_l[u.SBMAX_l-1]<=a.npart_l),_(a.bo_s[u.SBMAX_s-1]<=a.npart_s),-1!=r.ATHtype){var L=r.out_samplerate/u.BLKSIZE,N=0;for(T=0,i=0;i<u.BLKSIZE/2;++i)T+=L,a.ATH.eql_w[i]=1/Math.pow(10,this.ATHformula(T,r)/10),N+=a.ATH.eql_w[i];for(N=1/N,i=u.BLKSIZE/2;--i>=0;)a.ATH.eql_w[i]*=N}for(P=M=0;P<a.npart_s;++P)for(i=0;i<a.numlines_s[P];++i)++M;_(129==M);for(P=M=0;P<a.npart_l;++P)for(i=0;i<a.numlines_l[P];++i)++M;for(_(513==M),M=0,i=0;i<a.npart_l;i++){T=A*(M+a.numlines_l[i]/2)/(1*u.BLKSIZE);a.mld_cb_l[i]=ne(T),M+=a.numlines_l[i]}for(;i<u.CBANDS;++i)a.mld_cb_l[i]=1;for(M=0,i=0;i<a.npart_s;i++){T=A*(M+a.numlines_s[i]/2)/(1*u.BLKSIZE_s);a.mld_cb_s[i]=ne(T),M+=a.numlines_s[i]}for(;i<u.CBANDS;++i)a.mld_cb_s[i]=1;return 0},this.ATHformula=function(e,t){var n;switch(t.ATHtype){case 0:n=re(e,9);break;case 1:n=re(e,-1);break;case 2:default:n=re(e,0);break;case 3:n=re(e,1)+6;break;case 4:n=re(e,t.ATHcurve)}return n}},Qt}function lr(){if(tn)return en;function e(e){var t=e;this.ordinal=function(){return t}}return tn=1,e.STEREO=new e(0),e.JOINT_STEREO=new e(1),e.DUAL_CHANNEL=new e(2),e.MONO=new e(3),e.NOT_SET=new e(4),en=e}function _r(){if(sn)return an;sn=1;var e=sr(),t={};return t.SFBMAX=3*e.SBMAX_s,an=t}function cr(){if(ln)return on;ln=1;var e=ir();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double;var t=e.new_float;e.new_float_n;var n=e.new_int;e.new_int_n,e.assert;var r=_r();return on=function(){this.xr=t(576),this.l3_enc=n(576),this.scalefac=n(r.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=n(3),this.subblock_gain=n(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=n(r.SFBMAX),this.window=n(r.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=n(4),this.max_nonzero_coeff=0;var e=this;function i(e){return new Int32Array(e)}this.assign=function(t){var n;e.xr=(n=t.xr,new Float32Array(n)),e.l3_enc=i(t.l3_enc),e.scalefac=i(t.scalefac),e.xrpow_max=t.xrpow_max,e.part2_3_length=t.part2_3_length,e.big_values=t.big_values,e.count1=t.count1,e.global_gain=t.global_gain,e.scalefac_compress=t.scalefac_compress,e.block_type=t.block_type,e.mixed_block_flag=t.mixed_block_flag,e.table_select=i(t.table_select),e.subblock_gain=i(t.subblock_gain),e.region0_count=t.region0_count,e.region1_count=t.region1_count,e.preflag=t.preflag,e.scalefac_scale=t.scalefac_scale,e.count1table_select=t.count1table_select,e.part2_length=t.part2_length,e.sfb_lmax=t.sfb_lmax,e.sfb_smin=t.sfb_smin,e.psy_lmax=t.psy_lmax,e.sfbmax=t.sfbmax,e.psymax=t.psymax,e.sfbdivide=t.sfbdivide,e.width=i(t.width),e.window=i(t.window),e.count1bits=t.count1bits,e.sfb_partition_table=t.sfb_partition_table.slice(0),e.slen=i(t.slen),e.max_nonzero_coeff=t.max_nonzero_coeff}}}function ur(){if(fn)return un;fn=1;var e=ir(),t=e.System;e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double,e.new_float,e.new_float_n;var n=e.new_int;e.new_int_n,e.assert;var r=sr();return un=function(e,i,a,s){this.l=n(1+r.SBMAX_l),this.s=n(1+r.SBMAX_s),this.psfb21=n(1+r.PSFB21),this.psfb12=n(1+r.PSFB12);var o=this.l,l=this.s;4==arguments.length&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],t.arraycopy(this.arrL,0,o,0,Math.min(this.arrL.length,this.l.length)),t.arraycopy(this.arrS,0,l,0,Math.min(this.arrS.length,this.s.length)),t.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),t.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))},un}function fr(){if(vn)return bn;vn=1;var e=ir();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n;var t=e.new_byte,n=e.new_double,r=e.new_float,i=e.new_float_n,a=e.new_int,s=e.new_int_n;e.assert;var o=function(){if(cn)return _n;cn=1;var e=ir();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double,e.new_float,e.new_float_n;var t=e.new_int;e.new_int_n,e.assert;var n=cr();return _n=function(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[t(4),t(4)];for(var e=0;e<2;e++)for(var r=0;r<2;r++)this.tt[e][r]=new n}}(),l=ur(),_=function(){if(dn)return hn;dn=1;var e=ir();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double;var t=e.new_float,n=e.new_float_n,r=e.new_int;e.new_int_n,e.assert;var i=sr();return hn=function(){this.last_en_subshort=n([4,9]),this.lastAttacks=r(4),this.pefirbuf=t(19),this.longfact=t(i.SBMAX_l),this.shortfact=t(i.SBMAX_s),this.attackthre=0,this.attackthre_s=0}}(),c=mn?pn:(mn=1,pn=function(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}),u=ar(),f=sr(),h=_r();function d(){function e(){this.write_timing=0,this.ptr=0,this.buf=t(40)}this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=i([2,d.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new o,this.ms_ratio=r(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=a(2),this.CurrentStep=a(2),this.masking_lower=0,this.bv_scf=a(576),this.pseudohalf=a(h.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*d.BPC+1),this.itime=n(2),this.sideinfo_len=0,this.sb_sample=i([2,2,18,f.SBLIMIT]),this.amp_filter=r(32),this.header=new Array(d.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new l,this.minval_l=r(f.CBANDS),this.minval_s=r(f.CBANDS),this.nb_1=i([4,f.CBANDS]),this.nb_2=i([4,f.CBANDS]),this.nb_s1=i([4,f.CBANDS]),this.nb_s2=i([4,f.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=r(4),this.loudness_sq=i([2,2]),this.loudness_sq_save=r(2),this.mld_l=r(f.SBMAX_l),this.mld_s=r(f.SBMAX_s),this.bm_l=a(f.SBMAX_l),this.bo_l=a(f.SBMAX_l),this.bm_s=a(f.SBMAX_s),this.bo_s=a(f.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=s([f.CBANDS,2]),this.s3ind_s=s([f.CBANDS,2]),this.numlines_s=a(f.CBANDS),this.numlines_l=a(f.CBANDS),this.rnumlines_l=r(f.CBANDS),this.mld_cb_l=r(f.CBANDS),this.mld_cb_s=r(f.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=r(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=a(2),this.nsPsy=new _,this.VBR_seek_table=new c,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=s([16,5]),this.bitrate_blockType_Hist=s([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var p=0;p<this.en.length;p++)this.en[p]=new u;for(p=0;p<this.thm.length;p++)this.thm[p]=new u;for(p=0;p<this.header.length;p++)this.header[p]=new e}return d.MFSIZE=3456+f.ENCDELAY-f.MDCTDELAY,d.MAX_HEADER_BUF=256,d.MAX_BITS_PER_CHANNEL=4095,d.MAX_BITS_PER_GRANULE=7680,d.BPC=320,bn=d}function hr(){if(Sn)return wn;Sn=1;var e=ir(),t=e.System;e.VbrMode,e.Float,e.ShortBlock,e.Util;var n=e.Arrays;function r(){r.YULE_ORDER;r.MAX_SAMP_FREQ;var e=r.RMS_WINDOW_TIME_NUMERATOR,i=r.RMS_WINDOW_TIME_DENOMINATOR;r.MAX_SAMPLES_PER_WINDOW;var a=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],s=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function o(e,t,n,r,i,a){for(;0!=i--;)n[r]=1e-10+e[t+0]*a[0]-n[r-1]*a[1]+e[t-1]*a[2]-n[r-2]*a[3]+e[t-2]*a[4]-n[r-3]*a[5]+e[t-3]*a[6]-n[r-4]*a[7]+e[t-4]*a[8]-n[r-5]*a[9]+e[t-5]*a[10]-n[r-6]*a[11]+e[t-6]*a[12]-n[r-7]*a[13]+e[t-7]*a[14]-n[r-8]*a[15]+e[t-8]*a[16]-n[r-9]*a[17]+e[t-9]*a[18]-n[r-10]*a[19]+e[t-10]*a[20],++r,++t}function l(e,t,n,r,i,a){for(;0!=i--;)n[r]=e[t+0]*a[0]-n[r-1]*a[1]+e[t-1]*a[2]-n[r-2]*a[3]+e[t-2]*a[4],++r,++t}function _(e){return e*e}this.InitGainAnalysis=function(t,r){return function(t,r){for(var a=0;a<MAX_ORDER;a++)t.linprebuf[a]=t.lstepbuf[a]=t.loutbuf[a]=t.rinprebuf[a]=t.rstepbuf[a]=t.routbuf[a]=0;switch(0|r){case 48e3:t.reqindex=0;break;case 44100:t.reqindex=1;break;case 32e3:t.reqindex=2;break;case 24e3:t.reqindex=3;break;case 22050:t.reqindex=4;break;case 16e3:t.reqindex=5;break;case 12e3:t.reqindex=6;break;case 11025:t.reqindex=7;break;case 8e3:t.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return t.sampleWindow=0|(r*e+i-1)/i,t.lsum=0,t.rsum=0,t.totsamp=0,n.ill(t.A,0),INIT_GAIN_ANALYSIS_OK}(t,r)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(t.linpre=MAX_ORDER,t.rinpre=MAX_ORDER,t.lstep=MAX_ORDER,t.rstep=MAX_ORDER,t.lout=MAX_ORDER,t.rout=MAX_ORDER,n.fill(t.B,0),INIT_GAIN_ANALYSIS_OK)},this.AnalyzeSamples=function(e,n,i,c,u,f,h){var d,p,m,b,v,g,y;if(0==f)return GAIN_ANALYSIS_OK;switch(y=0,v=f,h){case 1:c=n,u=i;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(f<MAX_ORDER?(t.arraycopy(n,i,e.linprebuf,MAX_ORDER,f),t.arraycopy(c,u,e.rinprebuf,MAX_ORDER,f)):(t.arraycopy(n,i,e.linprebuf,MAX_ORDER,MAX_ORDER),t.arraycopy(c,u,e.rinprebuf,MAX_ORDER,MAX_ORDER));v>0;){g=v>e.sampleWindow-e.totsamp?e.sampleWindow-e.totsamp:v,y<MAX_ORDER?(d=e.linpre+y,p=e.linprebuf,m=e.rinpre+y,b=e.rinprebuf,g>MAX_ORDER-y&&(g=MAX_ORDER-y)):(d=i+y,p=n,m=u+y,b=c),o(p,d,e.lstepbuf,e.lstep+e.totsamp,g,a[e.reqindex]),o(b,m,e.rstepbuf,e.rstep+e.totsamp,g,a[e.reqindex]),l(e.lstepbuf,e.lstep+e.totsamp,e.loutbuf,e.lout+e.totsamp,g,s[e.reqindex]),l(e.rstepbuf,e.rstep+e.totsamp,e.routbuf,e.rout+e.totsamp,g,s[e.reqindex]),d=e.lout+e.totsamp,p=e.loutbuf,m=e.rout+e.totsamp,b=e.routbuf;for(var w=g%8;0!=w--;)e.lsum+=_(p[d++]),e.rsum+=_(b[m++]);for(w=g/8;0!=w--;)e.lsum+=_(p[d+0])+_(p[d+1])+_(p[d+2])+_(p[d+3])+_(p[d+4])+_(p[d+5])+_(p[d+6])+_(p[d+7]),d+=8,e.rsum+=_(b[m+0])+_(b[m+1])+_(b[m+2])+_(b[m+3])+_(b[m+4])+_(b[m+5])+_(b[m+6])+_(b[m+7]),m+=8;if(v-=g,y+=g,e.totsamp+=g,e.totsamp==e.sampleWindow){var S=10*r.STEPS_per_dB*Math.log10((e.lsum+e.rsum)/e.totsamp*.5+1e-37),A=S<=0?0:0|S;A>=e.A.length&&(A=e.A.length-1),e.A[A]++,e.lsum=e.rsum=0,t.arraycopy(e.loutbuf,e.totsamp,e.loutbuf,0,MAX_ORDER),t.arraycopy(e.routbuf,e.totsamp,e.routbuf,0,MAX_ORDER),t.arraycopy(e.lstepbuf,e.totsamp,e.lstepbuf,0,MAX_ORDER),t.arraycopy(e.rstepbuf,e.totsamp,e.rstepbuf,0,MAX_ORDER),e.totsamp=0}if(e.totsamp>e.sampleWindow)return GAIN_ANALYSIS_ERROR}return f<MAX_ORDER?(t.arraycopy(e.linprebuf,f,e.linprebuf,0,MAX_ORDER-f),t.arraycopy(e.rinprebuf,f,e.rinprebuf,0,MAX_ORDER-f),t.arraycopy(n,i,e.linprebuf,MAX_ORDER-f,f),t.arraycopy(c,u,e.rinprebuf,MAX_ORDER-f,f)):(t.arraycopy(n,i+f-MAX_ORDER,e.linprebuf,0,MAX_ORDER),t.arraycopy(c,u+f-MAX_ORDER,e.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK},this.GetTitleGain=function(e){for(var t=function(e,t){var n,i=0;for(n=0;n<t;n++)i+=e[n];if(0==i)return GAIN_NOT_ENOUGH_SAMPLES;var a=0|Math.ceil(i*(1-.95));for(n=t;n-- >0&&!((a-=e[n])<=0););return 64.82-n/r.STEPS_per_dB}(e.A,e.A.length),n=0;n<e.A.length;n++)e.B[n]+=e.A[n],e.A[n]=0;for(n=0;n<MAX_ORDER;n++)e.linprebuf[n]=e.lstepbuf[n]=e.loutbuf[n]=e.rinprebuf[n]=e.rstepbuf[n]=e.routbuf[n]=0;return e.totsamp=0,e.lsum=e.rsum=0,t}}return e.new_array_n,e.new_byte,e.new_double,e.new_float,e.new_float_n,e.new_int,e.new_int_n,e.assert,r.STEPS_per_dB=100,r.MAX_dB=120,r.GAIN_NOT_ENOUGH_SAMPLES=-24601,r.GAIN_ANALYSIS_ERROR=0,r.GAIN_ANALYSIS_OK=1,r.INIT_GAIN_ANALYSIS_ERROR=0,r.INIT_GAIN_ANALYSIS_OK=1,r.YULE_ORDER=10,r.MAX_ORDER=r.YULE_ORDER,r.MAX_SAMP_FREQ=48e3,r.RMS_WINDOW_TIME_NUMERATOR=1,r.RMS_WINDOW_TIME_DENOMINATOR=20,r.MAX_SAMPLES_PER_WINDOW=r.MAX_SAMP_FREQ*r.RMS_WINDOW_TIME_NUMERATOR/r.RMS_WINDOW_TIME_DENOMINATOR+1,wn=r}function dr(){if(Bn)return Rn;return Bn=1,Rn=function(e){this.bits=e}}function pr(){if(In)return Tn;function e(e,t,n,r){this.xlen=e,this.linmax=t,this.table=n,this.hlen=r}In=1;var t={t1HB:[1,1,1,0],t2HB:[1,2,1,3,1,1,3,2,0],t3HB:[3,2,1,1,1,1,3,2,0],t5HB:[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],t6HB:[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],t7HB:[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],t8HB:[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],t9HB:[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],t10HB:[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],t11HB:[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],t12HB:[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],t13HB:[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],t15HB:[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],t16HB:[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],t24HB:[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],t32HB:[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16],t33HB:[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0],t1l:[1,4,3,5],t2l:[1,4,7,4,5,7,6,7,8],t3l:[2,3,7,4,4,7,6,7,8],t5l:[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],t6l:[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],t7l:[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],t8l:[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],t9l:[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],t10l:[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],t11l:[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],t12l:[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],t13l:[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],t15l:[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],t16_5l:[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],t16l:[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],t24l:[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],t32l:[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10],t33l:[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8]};return t.ht=[new e(0,0,null,null),new e(2,0,t.t1HB,t.t1l),new e(3,0,t.t2HB,t.t2l),new e(3,0,t.t3HB,t.t3l),new e(0,0,null,null),new e(4,0,t.t5HB,t.t5l),new e(4,0,t.t6HB,t.t6l),new e(6,0,t.t7HB,t.t7l),new e(6,0,t.t8HB,t.t8l),new e(6,0,t.t9HB,t.t9l),new e(8,0,t.t10HB,t.t10l),new e(8,0,t.t11HB,t.t11l),new e(8,0,t.t12HB,t.t12l),new e(16,0,t.t13HB,t.t13l),new e(0,0,null,t.t16_5l),new e(16,0,t.t15HB,t.t15l),new e(1,1,t.t16HB,t.t16l),new e(2,3,t.t16HB,t.t16l),new e(3,7,t.t16HB,t.t16l),new e(4,15,t.t16HB,t.t16l),new e(6,63,t.t16HB,t.t16l),new e(8,255,t.t16HB,t.t16l),new e(10,1023,t.t16HB,t.t16l),new e(13,8191,t.t16HB,t.t16l),new e(4,15,t.t24HB,t.t24l),new e(5,31,t.t24HB,t.t24l),new e(6,63,t.t24HB,t.t24l),new e(7,127,t.t24HB,t.t24l),new e(8,255,t.t24HB,t.t24l),new e(9,511,t.t24HB,t.t24l),new e(11,2047,t.t24HB,t.t24l),new e(13,8191,t.t24HB,t.t24l),new e(0,0,t.t32HB,t.t32l),new e(0,0,t.t33HB,t.t33l)],t.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],t.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296],t.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],t.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]],t.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]],t.scfsi_band=[0,6,11,16,21],Tn=t}function mr(){if(Pn)return xn;Pn=1;var e=ur(),t=ir();t.System;var n=t.VbrMode,r=t.Float;t.ShortBlock;var i=t.Util;t.Arrays,t.new_array_n,t.new_byte,t.new_double;var a=t.new_float;t.new_float_n;var s=t.new_int;t.new_int_n;var o=t.assert,l=sr(),_=dr(),c=fr();function u(){var t=null,f=null,h=null;function d(e){return o(0<=e+u.Q_MAX2&&e<u.Q_MAX),y[e+u.Q_MAX2]}this.setModules=function(e,n,r){t=e,f=n,h=r},this.IPOW20=function(e){return o(0<=e&&e<u.Q_MAX),w[e]};var p=2220446049250313e-31,m=u.IXMAX_VAL+2,b=u.Q_MAX,v=u.Q_MAX2;u.LARGE_BITS;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var g=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=g,this.sfBandIndex=[new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0,8,16,24,36,52,72,96,124,160,162,164,166,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var y=a(b+v+1),w=a(b),S=a(m),A=a(m);function M(e,t){var n=h.ATHformula(t,e);return n-=100,n=Math.pow(10,n/10+e.ATHlower)}function R(e){this.s=e}this.adj43=A,this.iteration_init=function(e){var n,i=e.internal_flags,a=i.l3_side;if(0==i.iteration_init_init){for(i.iteration_init_init=1,a.main_data_begin=0,function(e){for(var t=e.internal_flags.ATH.l,n=e.internal_flags.ATH.psfb21,i=e.internal_flags.ATH.s,a=e.internal_flags.ATH.psfb12,s=e.internal_flags,o=e.out_samplerate,_=0;_<l.SBMAX_l;_++){var c=s.scalefac_band.l[_],u=s.scalefac_band.l[_+1];t[_]=r.MAX_VALUE;for(var f=c;f<u;f++){var h=M(e,f*o/1152);t[_]=Math.min(t[_],h)}}for(_=0;_<l.PSFB21;_++)for(c=s.scalefac_band.psfb21[_],u=s.scalefac_band.psfb21[_+1],n[_]=r.MAX_VALUE,f=c;f<u;f++)h=M(e,f*o/1152),n[_]=Math.min(n[_],h);for(_=0;_<l.SBMAX_s;_++){for(c=s.scalefac_band.s[_],u=s.scalefac_band.s[_+1],i[_]=r.MAX_VALUE,f=c;f<u;f++)h=M(e,f*o/384),i[_]=Math.min(i[_],h);i[_]*=s.scalefac_band.s[_+1]-s.scalefac_band.s[_]}for(_=0;_<l.PSFB12;_++){for(c=s.scalefac_band.psfb12[_],u=s.scalefac_band.psfb12[_+1],a[_]=r.MAX_VALUE,f=c;f<u;f++)h=M(e,f*o/384),a[_]=Math.min(a[_],h);a[_]*=s.scalefac_band.s[13]-s.scalefac_band.s[12]}if(e.noATH){for(_=0;_<l.SBMAX_l;_++)t[_]=1e-20;for(_=0;_<l.PSFB21;_++)n[_]=1e-20;for(_=0;_<l.SBMAX_s;_++)i[_]=1e-20;for(_=0;_<l.PSFB12;_++)a[_]=1e-20}s.ATH.floor=10*Math.log10(M(e,-1))}(e),S[0]=0,n=1;n<m;n++)S[n]=Math.pow(n,4/3);for(n=0;n<m-1;n++)A[n]=n+1-Math.pow(.5*(S[n]+S[n+1]),.75);for(A[n]=.5,n=0;n<b;n++)w[n]=Math.pow(2,-.1875*(n-210));for(n=0;n<=b+v;n++)y[n]=Math.pow(2,.25*(n-210-v));var s,o,_,c;for(t.huffman_init(i),(n=e.exp_nspsytune>>2&63)>=32&&(n-=64),s=Math.pow(10,n/4/10),(n=e.exp_nspsytune>>8&63)>=32&&(n-=64),o=Math.pow(10,n/4/10),(n=e.exp_nspsytune>>14&63)>=32&&(n-=64),_=Math.pow(10,n/4/10),(n=e.exp_nspsytune>>20&63)>=32&&(n-=64),c=_*Math.pow(10,n/4/10),n=0;n<l.SBMAX_l;n++){u=n<=6?s:n<=13?o:n<=20?_:c,i.nsPsy.longfact[n]=u}for(n=0;n<l.SBMAX_s;n++){var u;u=n<=5?s:n<=10?o:n<=11?_:c,i.nsPsy.shortfact[n]=u}}},this.on_pe=function(e,t,n,r,i,a){var l,u,h=e.internal_flags,d=0,p=s(2),m=new _(d),b=f.ResvMaxBits(e,r,m,a),v=(d=m.bits)+b;for(v>c.MAX_BITS_PER_GRANULE&&(v=c.MAX_BITS_PER_GRANULE),l=0,u=0;u<h.channels_out;++u)n[u]=Math.min(c.MAX_BITS_PER_CHANNEL,d/h.channels_out),p[u]=0|n[u]*t[i][u]/700-n[u],p[u]>3*r/4&&(p[u]=3*r/4),p[u]<0&&(p[u]=0),p[u]+n[u]>c.MAX_BITS_PER_CHANNEL&&(p[u]=Math.max(0,c.MAX_BITS_PER_CHANNEL-n[u])),l+=p[u];if(l>b)for(u=0;u<h.channels_out;++u)p[u]=b*p[u]/l;for(u=0;u<h.channels_out;++u)n[u]+=p[u],b-=p[u];for(l=0,u=0;u<h.channels_out;++u)l+=n[u];if(l>c.MAX_BITS_PER_GRANULE){var g=0;for(u=0;u<h.channels_out;++u)n[u]*=c.MAX_BITS_PER_GRANULE,n[u]/=l,g+=n[u];o(g<=c.MAX_BITS_PER_GRANULE)}return v},this.reduce_side=function(e,t,n,r){o(r<=c.MAX_BITS_PER_GRANULE),o(e[0]+e[1]<=c.MAX_BITS_PER_GRANULE);var i=.33*(.5-t)/.5;i<0&&(i=0),i>.5&&(i=.5);var a=0|.5*i*(e[0]+e[1]);a>c.MAX_BITS_PER_CHANNEL-e[0]&&(a=c.MAX_BITS_PER_CHANNEL-e[0]),a<0&&(a=0),e[1]>=125&&(e[1]-a>125?(e[0]<n&&(e[0]+=a),e[1]-=a):(e[0]+=e[1]-125,e[1]=125)),(a=e[0]+e[1])>r&&(e[0]=r*e[0]/a,e[1]=r*e[1]/a),o(e[0]<=c.MAX_BITS_PER_CHANNEL),o(e[1]<=c.MAX_BITS_PER_CHANNEL),o(e[0]+e[1]<=c.MAX_BITS_PER_GRANULE)},this.athAdjust=function(e,t,n){var r=90.30873362,a=i.FAST_LOG10_X(t,10),s=e*e,o=0;return a-=n,s>1e-20&&(o=1+i.FAST_LOG10_X(s,10/r)),o<0&&(o=0),a*=o,a+=n+r-94.82444863,Math.pow(10,.1*a)},this.calc_xmin=function(e,t,r,i){var a,s=0,o=e.internal_flags,_=0,c=0,u=o.ATH,f=r.xr,h=e.VBR==n.vbr_mtrh?1:0,d=o.masking_lower;for(e.VBR!=n.vbr_mtrh&&e.VBR!=n.vbr_mt||(d=1),a=0;a<r.psy_lmax;a++){A=(S=e.VBR==n.vbr_rh||e.VBR==n.vbr_mtrh?athAdjust(u.adjust,u.l[a],u.floor):u.adjust*u.l[a])/(g=r.width[a]),M=p,k=g>>1,E=0;do{E+=T=f[_]*f[_],M+=T<A?T:A,E+=I=f[++_]*f[_],M+=I<A?I:A,_++}while(--k>0);if(E>S&&c++,a==l.SBPSY_l)M<(B=S*o.nsPsy.longfact[a])&&(M=B);if(0!=h&&(S=M),!e.ATHonly)if((R=t.en.l[a])>0)B=E*t.thm.l[a]*d/R,0!=h&&(B*=o.nsPsy.longfact[a]),S<B&&(S=B);i[s++]=0!=h?S:S*o.nsPsy.longfact[a]}var m=575;if(r.block_type!=l.SHORT_TYPE)for(var b=576;0!=b--&&BitStream.EQ(f[b],0);)m=b;r.max_nonzero_coeff=m;for(var v=r.sfb_smin;a<r.psymax;v++,a+=3){var g,y,w;for(w=e.VBR==n.vbr_rh||e.VBR==n.vbr_mtrh?athAdjust(u.adjust,u.s[v],u.floor):u.adjust*u.s[v],g=r.width[a],y=0;y<3;y++){var S,A,M,R,B,E=0,k=g>>1;A=w/g,M=p;do{var T,I;E+=T=f[_]*f[_],M+=T<A?T:A,E+=I=f[++_]*f[_],M+=I<A?I:A,_++}while(--k>0);if(E>w&&c++,v==l.SBPSY_s)M<(B=w*o.nsPsy.shortfact[v])&&(M=B);if(S=0!=h?M:w,!e.ATHonly&&!e.ATHshort)if((R=t.en.s[v][y])>0)B=E*t.thm.s[v][y]*d/R,0!=h&&(B*=o.nsPsy.shortfact[v]),S<B&&(S=B);i[s++]=0!=h?S:S*o.nsPsy.shortfact[v]}e.useTemporal&&(i[s-3]>i[s-3+1]&&(i[s-3+1]+=(i[s-3]-i[s-3+1])*o.decay),i[s-3+1]>i[s-3+2]&&(i[s-3+2]+=(i[s-3+1]-i[s-3+2])*o.decay))}return c},this.calc_noise_core=function(e,t,n,r){var i=0,s=t.s,o=e.l3_enc;if(s>e.count1)for(;0!=n--;){_=e.xr[s],s++,i+=_*_,_=e.xr[s],s++,i+=_*_}else if(s>e.big_values){var l=a(2);for(l[0]=0,l[1]=r;0!=n--;){_=Math.abs(e.xr[s])-l[o[s]],s++,i+=_*_,_=Math.abs(e.xr[s])-l[o[s]],s++,i+=_*_}}else for(;0!=n--;){var _;_=Math.abs(e.xr[s])-S[o[s]]*r,s++,i+=_*_,_=Math.abs(e.xr[s])-S[o[s]]*r,s++,i+=_*_}return t.s=s,i},this.calc_noise=function(e,t,n,r,a){var s,o,l=0,_=0,c=0,u=0,f=0,h=-20,p=0,m=e.scalefac,b=0;for(r.over_SSD=0,s=0;s<e.psymax;s++){var v,y=e.global_gain-(m[b++]+(0!=e.preflag?g[s]:0)<<e.scalefac_scale+1)-8*e.subblock_gain[e.window[s]],w=0;if(null!=a&&a.step[s]==y)w=a.noise[s],p+=e.width[s],n[l++]=w/t[_++],w=a.noise_log[s];else{var S,A=d(y);if(o=e.width[s]>>1,p+e.width[s]>e.max_nonzero_coeff)o=(S=e.max_nonzero_coeff-p+1)>0?S>>1:0;var M=new R(p);w=this.calc_noise_core(e,M,o,A),p=M.s,null!=a&&(a.step[s]=y,a.noise[s]=w),w=n[l++]=w/t[_++],w=i.FAST_LOG10(Math.max(w,1e-20)),null!=a&&(a.noise_log[s]=w)}if(null!=a&&(a.global_gain=e.global_gain),f+=w,w>0)v=Math.max(0|10*w+.5,1),r.over_SSD+=v*v,c++,u+=w;h=Math.max(h,w)}return r.over_count=c,r.tot_noise=f,r.over_noise=u,r.max_noise=h,c},this.set_pinfo=function(e,t,n,r,i){var s,_,c,u,f,h=e.internal_flags,d=0==t.scalefac_scale?.5:1,p=t.scalefac,m=a(L3Side.SFBMAX),b=a(L3Side.SFBMAX),v=new CalcNoiseResult;calc_xmin(e,n,t,m),calc_noise(t,m,b,v,null);var y=0;for(_=t.sfb_lmax,t.block_type!=l.SHORT_TYPE&&0==t.mixed_block_flag&&(_=22),s=0;s<_;s++){var w=h.scalefac_band.l[s],S=(A=h.scalefac_band.l[s+1])-w;for(u=0;y<A;y++)u+=t.xr[y]*t.xr[y];u/=S,f=1e15,h.pinfo.en[r][i][s]=f*u,h.pinfo.xfsf[r][i][s]=f*m[s]*b[s]/S,n.en.l[s]>0&&!e.ATHonly?u/=n.en.l[s]:u=0,h.pinfo.thr[r][i][s]=f*Math.max(u*n.thm.l[s],h.ATH.l[s]),h.pinfo.LAMEsfb[r][i][s]=0,0!=t.preflag&&s>=11&&(h.pinfo.LAMEsfb[r][i][s]=-d*g[s]),s<l.SBPSY_l&&(o(p[s]>=0),h.pinfo.LAMEsfb[r][i][s]-=d*p[s])}if(t.block_type==l.SHORT_TYPE)for(_=s,s=t.sfb_smin;s<l.SBMAX_s;s++){w=h.scalefac_band.s[s],S=(A=h.scalefac_band.s[s+1])-w;for(var A,M=0;M<3;M++){for(u=0,c=w;c<A;c++)u+=t.xr[y]*t.xr[y],y++;u=Math.max(u/S,1e-20),f=1e15,h.pinfo.en_s[r][i][3*s+M]=f*u,h.pinfo.xfsf_s[r][i][3*s+M]=f*m[_]*b[_]/S,n.en.s[s][M]>0?u/=n.en.s[s][M]:u=0,(e.ATHonly||e.ATHshort)&&(u=0),h.pinfo.thr_s[r][i][3*s+M]=f*Math.max(u*n.thm.s[s][M],h.ATH.s[s]),h.pinfo.LAMEsfb_s[r][i][3*s+M]=-2*t.subblock_gain[M],s<l.SBPSY_s&&(h.pinfo.LAMEsfb_s[r][i][3*s+M]-=d*p[_]),_++}}h.pinfo.LAMEqss[r][i]=t.global_gain,h.pinfo.LAMEmainbits[r][i]=t.part2_3_length+t.part2_length,h.pinfo.LAMEsfbits[r][i]=t.part2_length,h.pinfo.over[r][i]=v.over_count,h.pinfo.max_noise[r][i]=10*v.max_noise,h.pinfo.over_noise[r][i]=10*v.over_noise,h.pinfo.tot_noise[r][i]=10*v.tot_noise,h.pinfo.over_SSD[r][i]=v.over_SSD}}return u.Q_MAX=257,u.Q_MAX2=116,u.LARGE_BITS=1e5,u.IXMAX_VAL=8206,xn=u}function br(){if(Ln)return On;Ln=1;var e=ir(),t=e.System;e.VbrMode,e.Float,e.ShortBlock,e.Util;var n=e.Arrays;e.new_array_n,e.new_byte,e.new_double,e.new_float,e.new_float_n;var r=e.new_int;e.new_int_n;var i=e.assert,a=sr(),s=pr(),o=cr(),l=mr();return On=function e(){var _=null;function c(e){this.bits=0|e}this.qupvt=null,this.setModules=function(e){this.qupvt=e,_=e};var u=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function f(e,t,n,r,a,s){var o=.5946/t;for(i(e>0),e>>=1;0!=e--;)a[s++]=o>n[r++]?0:1,a[s++]=o>n[r++]?0:1}function h(e,t,n,r,a,s){i(e>0);var o=(e>>=1)%2;for(e>>=1;0!=e--;){var l,c,u,f,h,d,p,m;l=n[r++]*t,c=n[r++]*t,h=0|l,u=n[r++]*t,d=0|c,f=n[r++]*t,p=0|u,l+=_.adj43[h],m=0|f,c+=_.adj43[d],a[s++]=0|l,u+=_.adj43[p],a[s++]=0|c,f+=_.adj43[m],a[s++]=0|u,a[s++]=0|f}0!=o&&(h=0|(l=n[r++]*t),d=0|(c=n[r++]*t),l+=_.adj43[h],c+=_.adj43[d],a[s++]=0|l,a[s++]=0|c)}var d=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function p(e,t,n,r){var i=function(e,t,n){var r=0,i=0;do{var a=e[t++],s=e[t++];r<a&&(r=a),i<s&&(i=s)}while(t<n);return r<i&&(r=i),r}(e,t,n);switch(i){case 0:return i;case 1:return function(e,t,n,r){var i=0,a=s.ht[1].hlen;do{var o=2*e[t+0]+e[t+1];t+=2,i+=a[o]}while(t<n);return r.bits+=i,1}(e,t,n,r);case 2:case 3:return function(e,t,n,r,i){var a,o,l=0,_=s.ht[r].xlen;o=2==r?s.table23:s.table56;do{var c=e[t+0]*_+e[t+1];t+=2,l+=o[c]}while(t<n);return a=65535&l,(l>>=16)>a&&(l=a,r++),i.bits+=l,r}(e,t,n,d[i-1],r);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return function(e,t,n,r,i){var a=0,o=0,l=0,_=s.ht[r].xlen,c=s.ht[r].hlen,u=s.ht[r+1].hlen,f=s.ht[r+2].hlen;do{var h=e[t+0]*_+e[t+1];t+=2,a+=c[h],o+=u[h],l+=f[h]}while(t<n);var d=r;return a>o&&(a=o,d++),a>l&&(a=l,d=r+2),i.bits+=a,d}(e,t,n,d[i-1],r);default:if(i>l.IXMAX_VAL)return r.bits=l.LARGE_BITS,-1;var a,o;for(i-=15,a=24;a<32&&!(s.ht[a].linmax>=i);a++);for(o=a-8;o<24&&!(s.ht[o].linmax>=i);o++);return function(e,t,n,r,i,a){var o,l=65536*s.ht[r].xlen+s.ht[i].xlen,_=0;do{var c=e[t++],u=e[t++];0!=c&&(c>14&&(c=15,_+=l),c*=16),0!=u&&(u>14&&(u=15,_+=l),c+=u),_+=s.largetbl[c]}while(t<n);return o=65535&_,(_>>=16)>o&&(_=o,r=i),a.bits+=_,r}(e,t,n,o,a,r)}}function m(e,t,n,r,i,s,o,l){for(var _=t.big_values,u=2;u<a.SBMAX_l+1;u++){var f=e.scalefac_band.l[u];if(f>=_)break;var h=i[u-2]+t.count1bits;if(n.part2_3_length<=h)break;var d=new c(h),m=p(r,f,_,d);h=d.bits,n.part2_3_length<=h||(n.assign(t),n.part2_3_length=h,n.region0_count=s[u-2],n.region1_count=u-2-s[u-2],n.table_select[0]=o[u-2],n.table_select[1]=l[u-2],n.table_select[2]=m)}}this.noquant_count_bits=function(e,t,n){var r=t.l3_enc,o=Math.min(576,t.max_nonzero_coeff+2>>1<<1);for(null!=n&&(n.sfb_count1=0);o>1&&0==(r[o-1]|r[o-2]);o-=2);t.count1=o;for(var l=0,_=0;o>3;o-=4){var u;if((2147483647&(r[o-1]|r[o-2]|r[o-3]|r[o-4]))>1)break;u=2*(2*(2*r[o-4]+r[o-3])+r[o-2])+r[o-1],l+=s.t32l[u],_+=s.t33l[u]}var f=l;if(t.count1table_select=0,l>_&&(f=_,t.count1table_select=1),t.count1bits=f,t.big_values=o,0==o)return f;if(t.block_type==a.SHORT_TYPE)(l=3*e.scalefac_band.s[3])>t.big_values&&(l=t.big_values),_=t.big_values;else if(t.block_type==a.NORM_TYPE){if(i(o<=576),l=t.region0_count=e.bv_scf[o-2],_=t.region1_count=e.bv_scf[o-1],i(l+_+2<a.SBPSY_l),_=e.scalefac_band.l[l+_+2],l=e.scalefac_band.l[l+1],_<o){var h=new c(f);t.table_select[2]=p(r,_,o,h),f=h.bits}}else t.region0_count=7,t.region1_count=a.SBMAX_l-1-7-1,(l=e.scalefac_band.l[8])>(_=o)&&(l=_);if(l=Math.min(l,o),_=Math.min(_,o),i(l>=0),i(_>=0),0<l){h=new c(f);t.table_select[0]=p(r,0,l,h),f=h.bits}if(l<_){h=new c(f);t.table_select[1]=p(r,l,_,h),f=h.bits}if(2==e.use_best_huffman&&(t.part2_3_length=f,best_huffman_divide(e,t),f=t.part2_3_length),null!=n&&t.block_type==a.NORM_TYPE){for(var d=0;e.scalefac_band.l[d]<t.big_values;)d++;n.sfb_count1=d}return f},this.count_bits=function(e,t,r,s){var o=r.l3_enc,c=l.IXMAX_VAL/_.IPOW20(r.global_gain);if(r.xrpow_max>c)return l.LARGE_BITS;if(function(e,t,r,s,o){var l,c,u,d=0,p=0,m=0,b=0,v=t,g=0,y=v,w=0,S=e,A=0;for(u=null!=o&&s.global_gain==o.global_gain,c=s.block_type==a.SHORT_TYPE?38:21,l=0;l<=c;l++){var M=-1;if((u||s.block_type==a.NORM_TYPE)&&(M=s.global_gain-(s.scalefac[l]+(0!=s.preflag?_.pretab[l]:0)<<s.scalefac_scale+1)-8*s.subblock_gain[s.window[l]]),i(s.width[l]>=0),u&&o.step[l]==M)0!=p&&(h(p,r,S,A,y,w),p=0),0!=m&&(f(m,r,S,A,y,w),m=0);else{var R,B=s.width[l];if(d+s.width[l]>s.max_nonzero_coeff&&(R=s.max_nonzero_coeff-d+1,n.fill(t,s.max_nonzero_coeff,576,0),(B=R)<0&&(B=0),l=c+1),0==p&&0==m&&(y=v,w=g,S=e,A=b),null!=o&&o.sfb_count1>0&&l>=o.sfb_count1&&o.step[l]>0&&M>=o.step[l]?(0!=p&&(h(p,r,S,A,y,w),p=0,y=v,w=g,S=e,A=b),m+=B):(0!=m&&(f(m,r,S,A,y,w),m=0,y=v,w=g,S=e,A=b),p+=B),B<=0){0!=m&&(f(m,r,S,A,y,w),m=0),0!=p&&(h(p,r,S,A,y,w),p=0);break}}l<=c&&(g+=s.width[l],b+=s.width[l],d+=s.width[l])}0!=p&&(h(p,r,S,A,y,w),p=0),0!=m&&(f(m,r,S,A,y,w),m=0)}(t,o,_.IPOW20(r.global_gain),r,s),2&e.substep_shaping)for(var u=0,d=r.global_gain+r.scalefac_scale,p=.634521682242439/_.IPOW20(d),m=0;m<r.sfbmax;m++){var b,v=r.width[m];if(i(v>=0),0==e.pseudohalf[m])u+=v;else for(b=u,u+=v;b<u;++b)o[b]=t[b]>=p?o[b]:0}return this.noquant_count_bits(e,r,s)},this.best_huffman_divide=function(e,t){var n=new o,_=t.l3_enc,u=r(23),f=r(23),h=r(23),d=r(23);if(t.block_type!=a.SHORT_TYPE||1!=e.mode_gr){n.assign(t),t.block_type==a.NORM_TYPE&&(!function(e,t,n,r,i,a,s){for(var o=t.big_values,_=0;_<=22;_++)r[_]=l.LARGE_BITS;for(_=0;_<16;_++){var u=e.scalefac_band.l[_+1];if(u>=o)break;var f=0,h=new c(f),d=p(n,0,u,h);f=h.bits;for(var m=0;m<8;m++){var b=e.scalefac_band.l[_+m+2];if(b>=o)break;var v=f,g=p(n,u,b,h=new c(v));v=h.bits,r[_+m]>v&&(r[_+m]=v,i[_+m]=_,a[_+m]=d,s[_+m]=g)}}}(e,t,_,u,f,h,d),m(e,n,t,_,u,f,h,d));var b=n.big_values;if(!(0==b||(_[b-2]|_[b-1])>1||(b=t.count1+2)>576)){n.assign(t),n.count1=b;var v=0,g=0;for(i(b<=576);b>n.big_values;b-=4){var y=2*(2*(2*_[b-4]+_[b-3])+_[b-2])+_[b-1];v+=s.t32l[y],g+=s.t33l[y]}if(n.big_values=b,n.count1table_select=0,v>g&&(v=g,n.count1table_select=1),n.count1bits=v,n.block_type==a.NORM_TYPE)m(e,n,t,_,u,f,h,d);else{if(n.part2_3_length=v,(v=e.scalefac_band.l[8])>b&&(v=b),v>0){var w=new c(n.part2_3_length);n.table_select[0]=p(_,0,v,w),n.part2_3_length=w.bits}if(b>v){w=new c(n.part2_3_length);n.table_select[1]=p(_,v,b,w),n.part2_3_length=w.bits}t.part2_3_length>n.part2_3_length&&t.assign(n)}}}};var b=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],v=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],g=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],y=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];e.slen1_tab=g,e.slen2_tab=y,this.best_scalefac_store=function(e,t,n,r){var o,l,c,u,f=r.tt[t][n],h=0;for(c=0,o=0;o<f.sfbmax;o++){var d=f.width[o];for(i(d>=0),c+=d,u=-d;u<0&&0==f.l3_enc[u+c];u++);0==u&&(f.scalefac[o]=h=-2)}if(0==f.scalefac_scale&&0==f.preflag){var p=0;for(o=0;o<f.sfbmax;o++)f.scalefac[o]>0&&(p|=f.scalefac[o]);if(!(1&p)&&0!=p){for(o=0;o<f.sfbmax;o++)f.scalefac[o]>0&&(f.scalefac[o]>>=1);f.scalefac_scale=h=1}}if(0==f.preflag&&f.block_type!=a.SHORT_TYPE&&2==e.mode_gr){for(o=11;o<a.SBPSY_l&&!(f.scalefac[o]<_.pretab[o]&&-2!=f.scalefac[o]);o++);if(o==a.SBPSY_l){for(o=11;o<a.SBPSY_l;o++)f.scalefac[o]>0&&(f.scalefac[o]-=_.pretab[o]);f.preflag=h=1}}for(l=0;l<4;l++)r.scfsi[n][l]=0;for(2==e.mode_gr&&1==t&&r.tt[0][n].block_type!=a.SHORT_TYPE&&r.tt[1][n].block_type!=a.SHORT_TYPE&&(!function(e,t){for(var n,r=t.tt[1][e],i=t.tt[0][e],o=0;o<s.scfsi_band.length-1;o++){for(n=s.scfsi_band[o];n<s.scfsi_band[o+1]&&!(i.scalefac[n]!=r.scalefac[n]&&r.scalefac[n]>=0);n++);if(n==s.scfsi_band[o+1]){for(n=s.scfsi_band[o];n<s.scfsi_band[o+1];n++)r.scalefac[n]=-1;t.scfsi[e][o]=1}}var l=0,_=0;for(n=0;n<11;n++)-1!=r.scalefac[n]&&(_++,l<r.scalefac[n]&&(l=r.scalefac[n]));for(var c=0,u=0;n<a.SBPSY_l;n++)-1!=r.scalefac[n]&&(u++,c<r.scalefac[n]&&(c=r.scalefac[n]));for(o=0;o<16;o++)if(l<b[o]&&c<v[o]){var f=g[o]*_+y[o]*u;r.part2_length>f&&(r.part2_length=f,r.scalefac_compress=o)}}(n,r),h=0),o=0;o<f.sfbmax;o++)-2==f.scalefac[o]&&(f.scalefac[o]=0);0!=h&&(2==e.mode_gr?this.scale_bitcount(f):this.scale_bitcount_lsf(e,f))};var w=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],S=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],A=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(e){var t,n,r,s=0,o=0,c=e.scalefac;if(i(function(e,t){for(var n=0;n<t;++n)if(e[n]<0)return!1;return!0}(c,e.sfbmax)),e.block_type==a.SHORT_TYPE)r=w,0!=e.mixed_block_flag&&(r=S);else if(r=A,0==e.preflag){for(n=11;n<a.SBPSY_l&&!(c[n]<_.pretab[n]);n++);if(n==a.SBPSY_l)for(e.preflag=1,n=11;n<a.SBPSY_l;n++)c[n]-=_.pretab[n]}for(n=0;n<e.sfbdivide;n++)s<c[n]&&(s=c[n]);for(;n<e.sfbmax;n++)o<c[n]&&(o=c[n]);for(e.part2_length=l.LARGE_BITS,t=0;t<16;t++)s<b[t]&&o<v[t]&&e.part2_length>r[t]&&(e.part2_length=r[t],e.scalefac_compress=t);return e.part2_length==l.LARGE_BITS};var M=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(e,n){var s,o,l,c,u,f,h,d,p=r(4),m=n.scalefac;for(s=0!=n.preflag?2:0,h=0;h<4;h++)p[h]=0;if(n.block_type==a.SHORT_TYPE){o=1;var b=_.nr_of_sfb_block[s][o];for(d=0,l=0;l<4;l++)for(c=b[l]/3,h=0;h<c;h++,d++)for(u=0;u<3;u++)m[3*d+u]>p[l]&&(p[l]=m[3*d+u])}else{o=0;b=_.nr_of_sfb_block[s][o];for(d=0,l=0;l<4;l++)for(c=b[l],h=0;h<c;h++,d++)m[d]>p[l]&&(p[l]=m[d])}for(f=!1,l=0;l<4;l++)p[l]>M[s][l]&&(f=!0);if(!f){var v,g,y,w;for(n.sfb_partition_table=_.nr_of_sfb_block[s][o],l=0;l<4;l++)n.slen[l]=R[p[l]];switch(v=n.slen[0],g=n.slen[1],y=n.slen[2],w=n.slen[3],s){case 0:n.scalefac_compress=(5*v+g<<4)+(y<<2)+w;break;case 1:n.scalefac_compress=400+(5*v+g<<2)+y;break;case 2:n.scalefac_compress=500+3*v+g;break;default:t.err.printf("intensity stereo not implemented yet\n")}}if(!f)for(i(null!=n.sfb_partition_table),n.part2_length=0,l=0;l<4;l++)n.part2_length+=n.slen[l]*n.sfb_partition_table[l];return f};var R=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(e){for(var t=2;t<=576;t+=2){for(var n,r=0;e.scalefac_band.l[++r]<t;);for(n=u[r][0];e.scalefac_band.l[n+1]>t;)n--;for(n<0&&(n=u[r][0]),e.bv_scf[t-2]=n,n=u[r][1];e.scalefac_band.l[n+e.bv_scf[t-2]+2]>t;)n--;n<0&&(n=u[r][1]),e.bv_scf[t-1]=n}}},On}function vr(){if(Vn)return Nn;Vn=1;var e=ir(),t=e.System;e.VbrMode,e.Float,e.ShortBlock,e.Util;var n=e.Arrays;e.new_array_n;var r=e.new_byte;e.new_double,e.new_float;var i=e.new_float_n,a=e.new_int;e.new_int_n;var s=e.assert,o=br(),l=pr(),_=sr(),c=fr();function u(){var e=this,u=32,f=null,h=null,d=null,p=null;this.setModules=function(e,t,n,r){f=e,h=t,d=n,p=r};var m=null,b=0,v=0,g=0;function y(e){t.arraycopy(e.header[e.w_ptr].buf,0,m,v,e.sideinfo_len),v+=e.sideinfo_len,b+=8*e.sideinfo_len,e.w_ptr=e.w_ptr+1&c.MAX_HEADER_BUF-1}function w(e,t,n){for(s(n<30);n>0;){var r;0==g&&(g=8,v++,s(v<Lame.LAME_MAXMP3BUFFER),s(e.header[e.w_ptr].write_timing>=b),e.header[e.w_ptr].write_timing==b&&y(e),m[v]=0),r=Math.min(n,g),g-=r,s((n-=r)<u),s(g<u),m[v]|=t>>n<<g,b+=r}}function S(e,t,n){for(s(n<30);n>0;){var r;0==g&&(g=8,v++,s(v<Lame.LAME_MAXMP3BUFFER),m[v]=0),r=Math.min(n,g),g-=r,s((n-=r)<u),s(g<u),m[v]|=t>>n<<g,b+=r}}function A(e,t){var n,r=e.internal_flags;if(s(t>=0),t>=8&&(w(r,76,8),t-=8),t>=8&&(w(r,65,8),t-=8),t>=8&&(w(r,77,8),t-=8),t>=8&&(w(r,69,8),t-=8),t>=32){var i=d.getLameShortVersion();if(t>=32)for(n=0;n<i.length&&t>=8;++n)t-=8,w(r,i.charAt(n),8)}for(;t>=1;t-=1)w(r,r.ancillary_flag,1),r.ancillary_flag^=e.disable_reservoir?0:1;s(0==t)}function M(e,t,n){for(var r=e.header[e.h_ptr].ptr;n>0;){var i=Math.min(n,8-(7&r));s((n-=i)<u),e.header[e.h_ptr].buf[r>>3]|=t>>n<<8-(7&r)-i,r+=i}e.header[e.h_ptr].ptr=r}function R(e,t){e<<=8;for(var n=0;n<8;n++)65536&((t<<=1)^(e<<=1))&&(t^=32773);return t}function B(e,t){var n,r=l.ht[t.count1table_select+32],i=0,a=t.big_values,o=t.big_values;for(s(t.count1table_select<2),n=(t.count1-t.big_values)/4;n>0;--n){var _,c=0,u=0;0!=(_=t.l3_enc[a+0])&&(u+=8,t.xr[o+0]<0&&c++,s(_<=1)),0!=(_=t.l3_enc[a+1])&&(u+=4,c*=2,t.xr[o+1]<0&&c++,s(_<=1)),0!=(_=t.l3_enc[a+2])&&(u+=2,c*=2,t.xr[o+2]<0&&c++,s(_<=1)),0!=(_=t.l3_enc[a+3])&&(u++,c*=2,t.xr[o+3]<0&&c++,s(_<=1)),a+=4,o+=4,w(e,c+r.table[u],r.hlen[u]),i+=r.hlen[u]}return i}function E(e,t,n,r,i){var a=l.ht[t],o=0;if(s(t<32),0==t)return o;for(var _=n;_<r;_+=2){var c=0,f=0,h=a.xlen,d=a.xlen,p=0,m=i.l3_enc[_],b=i.l3_enc[_+1];if(0!=m&&(i.xr[_]<0&&p++,c--),t>15){if(m>14){var v=m-15;s(v<=a.linmax),p|=v<<1,f=h,m=15}if(b>14){var g=b-15;s(g<=a.linmax),p<<=h,p|=g,f+=h,b=15}d=16}0!=b&&(p<<=1,i.xr[_+1]<0&&p++,c--),s((m|b)<16),m=m*d+b,f-=c,c+=a.hlen[m],s(c<=u),s(f<=u),w(e,a.table[m],c),w(e,p,f),o+=c+f}return o}function k(e,t){var n=3*e.scalefac_band.s[3];n>t.big_values&&(n=t.big_values);var r=E(e,t.table_select[0],0,n,t);return r+=E(e,t.table_select[1],n,t.big_values,t)}function T(e,t){var n,r,i,a;n=t.big_values,s(0<=n&&n<=576);var o=t.region0_count+1;return s(0<=o),s(o<e.scalefac_band.l.length),i=e.scalefac_band.l[o],o+=t.region1_count+1,s(0<=o),s(o<e.scalefac_band.l.length),i>n&&(i=n),(a=e.scalefac_band.l[o])>n&&(a=n),r=E(e,t.table_select[0],0,i,t),r+=E(e,t.table_select[1],i,a,t),r+=E(e,t.table_select[2],a,n,t)}function I(){this.total=0}function x(n,r){var i,a,s,o,l,_=n.internal_flags;return l=_.w_ptr,-1==(o=_.h_ptr-1)&&(o=c.MAX_HEADER_BUF-1),i=_.header[o].write_timing-b,r.total=i,i>=0&&(a=1+o-l,o<l&&(a=1+o-l+c.MAX_HEADER_BUF),i-=8*a*_.sideinfo_len),i+=s=e.getframebits(n),r.total+=s,r.total%8!=0?r.total=1+r.total/8:r.total=r.total/8,r.total+=v+1,i<0&&t.err.println("strange error flushing buffer ... \n"),i}this.getframebits=function(e){var t,n=e.internal_flags;return t=0!=n.bitrate_index?l.bitrate_table[e.version][n.bitrate_index]:e.brate,s(8<=t&&t<=640),8*(0|72e3*(e.version+1)*t/e.out_samplerate+n.padding)},this.CRC_writeheader=function(e,t){var n=65535;n=R(255&t[2],n),n=R(255&t[3],n);for(var r=6;r<e.sideinfo_len;r++)n=R(255&t[r],n);t[4]=byte(n>>8),t[5]=byte(255&n)},this.flush_bitstream=function(e){var t,n,r=e.internal_flags,i=r.h_ptr-1;if(-1==i&&(i=c.MAX_HEADER_BUF-1),t=r.l3_side,!((n=x(e,new I))<0)){if(A(e,n),s(r.header[i].write_timing+this.getframebits(e)==b),r.ResvSize=0,t.main_data_begin=0,r.findReplayGain){var a=f.GetTitleGain(r.rgdata);s(NEQ(a,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),r.RadioGain=0|Math.floor(10*a+.5)}r.findPeakSample&&(r.noclipGainChange=0|Math.ceil(20*Math.log10(r.PeakSample/32767)*10),r.noclipGainChange>0&&(EQ(e.scale,1)||EQ(e.scale,0))?r.noclipScale=Math.floor(32767/r.PeakSample*100)/100:r.noclipScale=-1)}},this.add_dummy_byte=function(e,t,n){for(var r,i=e.internal_flags;n-- >0;)for(S(0,t,8),r=0;r<c.MAX_HEADER_BUF;++r)i.header[r].write_timing+=8},this.format_bitstream=function(e){var r,i=e.internal_flags;r=i.l3_side;var a=this.getframebits(e);A(e,r.resvDrain_pre),function(e,r){var i,a,o,l=e.internal_flags;if(i=l.l3_side,l.header[l.h_ptr].ptr=0,n.fill(l.header[l.h_ptr].buf,0,l.sideinfo_len,0),e.out_samplerate<16e3?M(l,4094,12):M(l,4095,12),M(l,e.version,1),M(l,1,2),M(l,e.error_protection?0:1,1),M(l,l.bitrate_index,4),M(l,l.samplerate_index,2),M(l,l.padding,1),M(l,e.extension,1),M(l,e.mode.ordinal(),2),M(l,l.mode_ext,2),M(l,e.copyright,1),M(l,e.original,1),M(l,e.emphasis,2),e.error_protection&&M(l,0,16),1==e.version){for(s(i.main_data_begin>=0),M(l,i.main_data_begin,9),2==l.channels_out?M(l,i.private_bits,3):M(l,i.private_bits,5),o=0;o<l.channels_out;o++){var u;for(u=0;u<4;u++)M(l,i.scfsi[o][u],1)}for(a=0;a<2;a++)for(o=0;o<l.channels_out;o++)M(l,(f=i.tt[a][o]).part2_3_length+f.part2_length,12),M(l,f.big_values/2,9),M(l,f.global_gain,8),M(l,f.scalefac_compress,4),f.block_type!=_.NORM_TYPE?(M(l,1,1),M(l,f.block_type,2),M(l,f.mixed_block_flag,1),14==f.table_select[0]&&(f.table_select[0]=16),M(l,f.table_select[0],5),14==f.table_select[1]&&(f.table_select[1]=16),M(l,f.table_select[1],5),M(l,f.subblock_gain[0],3),M(l,f.subblock_gain[1],3),M(l,f.subblock_gain[2],3)):(M(l,0,1),14==f.table_select[0]&&(f.table_select[0]=16),M(l,f.table_select[0],5),14==f.table_select[1]&&(f.table_select[1]=16),M(l,f.table_select[1],5),14==f.table_select[2]&&(f.table_select[2]=16),M(l,f.table_select[2],5),s(0<=f.region0_count&&f.region0_count<16),s(0<=f.region1_count&&f.region1_count<8),M(l,f.region0_count,4),M(l,f.region1_count,3)),M(l,f.preflag,1),M(l,f.scalefac_scale,1),M(l,f.count1table_select,1)}else for(s(i.main_data_begin>=0),M(l,i.main_data_begin,8),M(l,i.private_bits,l.channels_out),a=0,o=0;o<l.channels_out;o++){var f;M(l,(f=i.tt[a][o]).part2_3_length+f.part2_length,12),M(l,f.big_values/2,9),M(l,f.global_gain,8),M(l,f.scalefac_compress,9),f.block_type!=_.NORM_TYPE?(M(l,1,1),M(l,f.block_type,2),M(l,f.mixed_block_flag,1),14==f.table_select[0]&&(f.table_select[0]=16),M(l,f.table_select[0],5),14==f.table_select[1]&&(f.table_select[1]=16),M(l,f.table_select[1],5),M(l,f.subblock_gain[0],3),M(l,f.subblock_gain[1],3),M(l,f.subblock_gain[2],3)):(M(l,0,1),14==f.table_select[0]&&(f.table_select[0]=16),M(l,f.table_select[0],5),14==f.table_select[1]&&(f.table_select[1]=16),M(l,f.table_select[1],5),14==f.table_select[2]&&(f.table_select[2]=16),M(l,f.table_select[2],5),s(0<=f.region0_count&&f.region0_count<16),s(0<=f.region1_count&&f.region1_count<8),M(l,f.region0_count,4),M(l,f.region1_count,3)),M(l,f.scalefac_scale,1),M(l,f.count1table_select,1)}e.error_protection&&CRC_writeheader(l,l.header[l.h_ptr].buf);var h=l.h_ptr;s(l.header[h].ptr==8*l.sideinfo_len),l.h_ptr=h+1&c.MAX_HEADER_BUF-1,l.header[l.h_ptr].write_timing=l.header[h].write_timing+r,l.h_ptr==l.w_ptr&&t.err.println("Error: MAX_HEADER_BUF too small in bitstream.c \n")}(e,a);var l=8*i.sideinfo_len;if(l+=function(e){var t,n,r,i,a=0,l=e.internal_flags,c=l.l3_side;if(1==e.version)for(t=0;t<2;t++)for(n=0;n<l.channels_out;n++){var u=c.tt[t][n],f=o.slen1_tab[u.scalefac_compress],h=o.slen2_tab[u.scalefac_compress];for(i=0,r=0;r<u.sfbdivide;r++)-1!=u.scalefac[r]&&(w(l,u.scalefac[r],f),i+=f);for(;r<u.sfbmax;r++)-1!=u.scalefac[r]&&(w(l,u.scalefac[r],h),i+=h);s(i==u.part2_length),u.block_type==_.SHORT_TYPE?i+=k(l,u):i+=T(l,u),i+=B(l,u),s(i==u.part2_3_length+u.part2_length),a+=i}else for(t=0,n=0;n<l.channels_out;n++){u=c.tt[t][n];var d,p,m=0;if(s(null!=u.sfb_partition_table),i=0,r=0,p=0,u.block_type==_.SHORT_TYPE){for(;p<4;p++){var b=u.sfb_partition_table[p]/3,v=u.slen[p];for(d=0;d<b;d++,r++)w(l,Math.max(u.scalefac[3*r+0],0),v),w(l,Math.max(u.scalefac[3*r+1],0),v),w(l,Math.max(u.scalefac[3*r+2],0),v),m+=3*v}i+=k(l,u)}else{for(;p<4;p++)for(b=u.sfb_partition_table[p],v=u.slen[p],d=0;d<b;d++,r++)w(l,Math.max(u.scalefac[r],0),v),m+=v;i+=T(l,u)}i+=B(l,u),s(i==u.part2_3_length),s(m==u.part2_length),a+=m+i}return a}(e),A(e,r.resvDrain_post),l+=r.resvDrain_post,r.main_data_begin+=(a-l)/8,x(e,new I)!=i.ResvSize&&t.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),8*r.main_data_begin!=i.ResvSize&&(t.err.printf("bit reservoir error: \nl3_side.main_data_begin: %d \nResvoir size:             %d \nresv drain (post)         %d \nresv drain (pre)          %d \nheader and sideinfo:      %d \ndata bits:                %d \ntotal bits:               %d (remainder: %d) \nbitsperframe:             %d \n",8*r.main_data_begin,i.ResvSize,r.resvDrain_post,r.resvDrain_pre,8*i.sideinfo_len,l-r.resvDrain_post-8*i.sideinfo_len,l,l%8,a),t.err.println("This is a fatal error.  It has several possible causes:"),t.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),t.err.println(" 9%%  Your system is overclocked"),t.err.println(" 1%%  bug in LAME encoding library"),i.ResvSize=8*r.main_data_begin),s(b%8==0),b>1e9){var u;for(u=0;u<c.MAX_HEADER_BUF;++u)i.header[u].write_timing-=b;b=0}return 0},this.copy_buffer=function(e,n,r,o,l){var _=v+1;if(_<=0)return 0;if(0!=o&&_>o)return-1;if(t.arraycopy(m,0,n,r,_),v=-1,g=0,0!=l){var c=a(1);if(c[0]=e.nMusicCRC,p.updateMusicCRC(c,n,r,_),e.nMusicCRC=c[0],_>0&&(e.VBR_seek_table.nBytesWritten+=_),e.decode_on_the_fly)for(var u,d=i([2,1152]),b=_,y=-1;0!=y;)if(y=h.hip_decode1_unclipped(e.hip,n,r,b,d[0],d[1]),b=0,-1==y&&(y=0),y>0){if(s(y<=1152),e.findPeakSample){for(u=0;u<y;u++)d[0][u]>e.PeakSample?e.PeakSample=d[0][u]:-d[0][u]>e.PeakSample&&(e.PeakSample=-d[0][u]);if(e.channels_out>1)for(u=0;u<y;u++)d[1][u]>e.PeakSample?e.PeakSample=d[1][u]:-d[1][u]>e.PeakSample&&(e.PeakSample=-d[1][u])}if(e.findReplayGain&&f.AnalyzeSamples(e.rgdata,d[0],0,d[1],0,y,e.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}return _},this.init_bit_stream_w=function(e){m=r(Lame.LAME_MAXMP3BUFFER),e.h_ptr=e.w_ptr=0,e.header[e.h_ptr].write_timing=0,v=-1,g=0,b=0}}return u.EQ=function(e,t){return Math.abs(e)>Math.abs(t)?Math.abs(e-t)<=1e-6*Math.abs(e):Math.abs(e-t)<=1e-6*Math.abs(t)},u.NEQ=function(e,t){return!u.EQ(e,t)},Nn=u}function gr(){if(Dn)return Cn;Dn=1;var e=ir(),t=e.System,n=e.VbrMode;e.Float;var r=e.ShortBlock;e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double;var i=e.new_float;e.new_float_n,e.new_int;var a=e.new_int_n,s=e.new_short_n,o=e.assert,l=or(),_=function(){if(rn)return nn;rn=1;var e=lr();return nn=function(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=e.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}}(),c=fr(),u=function(){if(yn)return gn;yn=1;var e=ir();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double;var t=e.new_float;e.new_float_n,e.new_int,e.new_int_n,e.assert;var n=sr();return gn=function(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=t(n.SBMAX_l),this.s=t(n.SBMAX_s),this.psfb21=t(n.PSFB21),this.psfb12=t(n.PSFB12),this.cb_l=t(n.CBANDS),this.cb_s=t(n.CBANDS),this.eql_w=t(n.BLKSIZE/2)}}(),f=function(){if(Mn)return An;Mn=1;var e=ir();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double;var t=e.new_float;e.new_float_n;var n=e.new_int;e.new_int_n,e.assert;var r=hr();return An=function(){this.linprebuf=t(2*r.MAX_ORDER),this.linpre=0,this.lstepbuf=t(r.MAX_SAMPLES_PER_WINDOW+r.MAX_ORDER),this.lstep=0,this.loutbuf=t(r.MAX_SAMPLES_PER_WINDOW+r.MAX_ORDER),this.lout=0,this.rinprebuf=t(2*r.MAX_ORDER),this.rinpre=0,this.rstepbuf=t(r.MAX_SAMPLES_PER_WINDOW+r.MAX_ORDER),this.rstep=0,this.routbuf=t(r.MAX_SAMPLES_PER_WINDOW+r.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=n(0|r.STEPS_per_dB*r.MAX_dB),this.B=n(0|r.STEPS_per_dB*r.MAX_dB)}}(),h=function(){if(kn)return En;kn=1;var e=ir();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double;var t=e.new_float;e.new_float_n;var n=e.new_int;e.new_int_n;var r=e.assert,i=dr(),a=sr(),s=_r(),o=fr();return En=function(e){var l=e;this.quantize=l,this.iteration_loop=function(e,l,_,c){var u,f=e.internal_flags,h=t(s.SFBMAX),d=t(576),p=n(2),m=0,b=f.l3_side,v=new i(m);this.quantize.rv.ResvFrameBegin(e,v),m=v.bits;for(var g=0;g<f.mode_gr;g++){u=this.quantize.qupvt.on_pe(e,l,p,m,g,g),f.mode_ext==a.MPG_MD_MS_LR&&(this.quantize.ms_convert(f.l3_side,g),this.quantize.qupvt.reduce_side(p,_[g],m,u));for(var y=0;y<f.channels_out;y++){var w,S,A=b.tt[g][y];A.block_type!=a.SHORT_TYPE?(w=0,S=f.PSY.mask_adjust-w):(w=0,S=f.PSY.mask_adjust_short-w),f.masking_lower=Math.pow(10,.1*S),this.quantize.init_outer_loop(f,A),this.quantize.init_xrpow(f,A,d)&&(this.quantize.qupvt.calc_xmin(e,c[g][y],A,h),this.quantize.outer_loop(e,A,h,d,y,p[y])),this.quantize.iteration_finish_one(f,g,y),r(A.part2_3_length<=o.MAX_BITS_PER_CHANNEL),r(A.part2_3_length<=p[y])}}this.quantize.rv.ResvFrameEnd(f,m)}},En}(),d=vr(),p=pr(),m=sr();return Cn=function e(){var b,v,g,y,w,S=this;e.V9=410,e.V8=420,e.V7=430,e.V6=440,e.V5=450,e.V4=460,e.V3=470,e.V2=480,e.V1=490,e.V0=500,e.R3MIX=1e3,e.STANDARD=1001,e.EXTREME=1002,e.INSANE=1003,e.STANDARD_FAST=1004,e.EXTREME_FAST=1005,e.MEDIUM=1006,e.MEDIUM_FAST=1007,e.LAME_MAXMP3BUFFER=147456;var A,M,R,B=new l;function E(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=i(m.SBMAX_l),this.bo_s_weight=i(m.SBMAX_s)}function k(){this.lowerlimit=0}function T(e,t){this.lowpass=t}this.enc=new m,this.setModules=function(e,t,n,r,i,a,s,o,l){b=e,v=t,g=n,y=r,w=i,A=a,M=o,R=l,this.enc.setModules(v,B,y,A)};var I=4294479419;function x(e){return e>1?0:e<=0?1:Math.cos(Math.PI/2*e)}function P(e,t){switch(e){case 44100:return t.version=1,0;case 48e3:return t.version=1,1;case 32e3:return t.version=1,2;case 22050:case 11025:return t.version=0,0;case 24e3:case 12e3:return t.version=0,1;case 16e3:case 8e3:return t.version=0,2;default:return t.version=0,-1}}function O(e,t,n){n<16e3&&(t=2);for(var r=p.bitrate_table[t][1],i=2;i<=14;i++)p.bitrate_table[t][i]>0&&Math.abs(p.bitrate_table[t][i]-e)<Math.abs(r-e)&&(r=p.bitrate_table[t][i]);return r}function L(e,t,n){n<16e3&&(t=2);for(var r=0;r<=14;r++)if(p.bitrate_table[t][r]>0&&p.bitrate_table[t][r]==e)return r;return-1}function N(e,t){var n=[new T(8,2e3),new T(16,3700),new T(24,3900),new T(32,5500),new T(40,7e3),new T(48,7500),new T(56,1e4),new T(64,11e3),new T(80,13500),new T(96,15100),new T(112,15600),new T(128,17e3),new T(160,17500),new T(192,18600),new T(224,19400),new T(256,19700),new T(320,20500)],r=S.nearestBitrateFullIndex(t);e.lowerlimit=n[r].lowpass}function V(e){var t=m.BLKSIZE+e.framesize-m.FFTOFFSET;return t=Math.max(t,512+e.framesize-32),o(c.MFSIZE>=t),t}function C(e,t,n,r,i,a){var s=S.enc.lame_encode_mp3_frame(e,t,n,r,i,a);return e.frameNum++,s}function D(){this.n_in=0,this.n_out=0}function H(){this.num_used=0}function j(e,t){return 0!=t?j(t,e%t):e}function F(e,t,n){var r=Math.PI*t;(e/=n)<0&&(e=0),e>1&&(e=1);var i=e-.5,a=.42-.5*Math.cos(2*e*Math.PI)+.08*Math.cos(4*e*Math.PI);return Math.abs(i)<1e-9?r/Math.PI:a*Math.sin(n*r*i)/(Math.PI*n*i)}function X(e,t,n,r,a,s,l,_,u){var f,h,d=e.internal_flags,p=0,m=e.out_samplerate/j(e.out_samplerate,e.in_samplerate);m>c.BPC&&(m=c.BPC);var b=Math.abs(d.resample_ratio-Math.floor(.5+d.resample_ratio))<1e-4?1:0,v=1/d.resample_ratio;v>1&&(v=1);var g=31;0==g%2&&--g;var y=(g+=b)+1;if(0==d.fill_buffer_resample_init){for(d.inbuf_old[0]=i(y),d.inbuf_old[1]=i(y),f=0;f<=2*m;++f)d.blackfilt[f]=i(y);for(d.itime[0]=0,d.itime[1]=0,p=0;p<=2*m;p++){var w=0,S=(p-m)/(2*m);for(f=0;f<=g;f++)w+=d.blackfilt[p][f]=F(f-S,v,g);for(f=0;f<=g;f++)d.blackfilt[p][f]/=w}d.fill_buffer_resample_init=1}var A=d.inbuf_old[u];for(h=0;h<r;h++){var M,R;if(M=h*d.resample_ratio,g+(p=0|Math.floor(M-d.itime[u]))-g/2>=l)break;S=M-d.itime[u]-(p+g%2*.5);o(Math.abs(S)<=.501),R=0|Math.floor(2*S*m+m+.5);var B=0;for(f=0;f<=g;++f){var E=0|f+p-g/2;o(E<l),o(E+y>=0),B+=(E<0?A[y+E]:a[s+E])*d.blackfilt[R][f]}t[n+h]=B}if(_.num_used=Math.min(l,g+p-g/2),d.itime[u]+=_.num_used-h*d.resample_ratio,_.num_used>=y)for(f=0;f<y;f++)A[f]=a[s+_.num_used+f-y];else{var k=y-_.num_used;for(f=0;f<k;++f)A[f]=A[f+_.num_used];for(p=0;f<y;++f,++p)A[f]=a[s+p];o(p==_.num_used)}return h}function q(e,t,n,r,i,a){var s=e.internal_flags;if(s.resample_ratio<.9999||s.resample_ratio>1.0001)for(var o=0;o<s.channels_out;o++){var l=new H;a.n_out=X(e,t[o],s.mf_size,e.framesize,n[o],r,i,l,o),a.n_in=l.num_used}else{a.n_out=Math.min(e.framesize,i),a.n_in=a.n_out;for(var _=0;_<a.n_out;++_)t[0][s.mf_size+_]=n[0][r+_],2==s.channels_out&&(t[1][s.mf_size+_]=n[1][r+_])}}this.lame_init=function(){var e=new _;return function(e){var t;e.class_id=I,t=e.internal_flags=new c,e.mode=MPEGMode.NOT_SET,e.original=1,e.in_samplerate=44100,e.num_channels=2,e.num_samples=-1,e.bWriteVbrTag=!0,e.quality=-1,e.short_blocks=null,t.subblock_gain=-1,e.lowpassfreq=0,e.highpassfreq=0,e.lowpasswidth=-1,e.highpasswidth=-1,e.VBR=n.vbr_off,e.VBR_q=4,e.ATHcurve=-1,e.VBR_mean_bitrate_kbps=128,e.VBR_min_bitrate_kbps=0,e.VBR_max_bitrate_kbps=0,e.VBR_hard_min=0,t.VBR_min_bitrate=1,t.VBR_max_bitrate=13,e.quant_comp=-1,e.quant_comp_short=-1,e.msfix=-1,t.resample_ratio=1,t.OldValue[0]=180,t.OldValue[1]=180,t.CurrentStep[0]=4,t.CurrentStep[1]=4,t.masking_lower=1,t.nsPsy.attackthre=-1,t.nsPsy.attackthre_s=-1,e.scale=-1,e.athaa_type=-1,e.ATHtype=-1,e.athaa_loudapprox=-1,e.athaa_sensitivity=0,e.useTemporal=null,e.interChRatio=-1,t.mf_samples_to_encode=m.ENCDELAY+m.POSTDELAY,e.encoder_padding=0,t.mf_size=m.ENCDELAY-m.MDCTDELAY,e.findReplayGain=!1,e.decode_on_the_fly=!1,t.decode_on_the_fly=!1,t.findReplayGain=!1,t.findPeakSample=!1,t.RadioGain=0,t.AudiophileGain=0,t.noclipGainChange=0,t.noclipScale=-1,e.preset=0,e.write_id3tag_automatic=!0}(e),e.lame_allocated_gfp=1,e},this.nearestBitrateFullIndex=function(e){var t=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],n=0,r=0,i=0,a=0;a=t[16],i=16,r=t[16],n=16;for(var s=0;s<16;s++)if(Math.max(e,t[s+1])!=e){a=t[s+1],i=s+1,r=t[s],n=s;break}return a-e>e-r?n:i},this.lame_init_params=function(e){var i,s,_,c=e.internal_flags;if(c.Class_ID=0,null==c.ATH&&(c.ATH=new u),null==c.PSY&&(c.PSY=new E),null==c.rgdata&&(c.rgdata=new f),c.channels_in=e.num_channels,1==c.channels_in&&(e.mode=MPEGMode.MONO),c.channels_out=e.mode==MPEGMode.MONO?1:2,c.mode_ext=m.MPG_MD_MS_LR,e.mode==MPEGMode.MONO&&(e.force_ms=!1),e.VBR==n.vbr_off&&128!=e.VBR_mean_bitrate_kbps&&0==e.brate&&(e.brate=e.VBR_mean_bitrate_kbps),e.VBR==n.vbr_off||e.VBR==n.vbr_mtrh||e.VBR==n.vbr_mt||(e.free_format=!1),e.VBR==n.vbr_off&&0==e.brate&&d.EQ(e.compression_ratio,0)&&(e.compression_ratio=11.025),e.VBR==n.vbr_off&&e.compression_ratio>0&&(0==e.out_samplerate&&(e.out_samplerate=map2MP3Frequency(int(.97*e.in_samplerate))),e.brate=0|16*e.out_samplerate*c.channels_out/(1e3*e.compression_ratio),c.samplerate_index=P(e.out_samplerate,e),e.free_format||(e.brate=O(e.brate,e.version,e.out_samplerate))),0!=e.out_samplerate&&(e.out_samplerate<16e3?(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,64)):e.out_samplerate<32e3?(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,160)):(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,32),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320))),0==e.lowpassfreq){var S=16e3;switch(e.VBR){case n.vbr_off:N(T=new k,e.brate),S=T.lowerlimit;break;case n.vbr_abr:var T;N(T=new k,e.VBR_mean_bitrate_kbps),S=T.lowerlimit;break;case n.vbr_rh:var V=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=e.VBR_q&&e.VBR_q<=9){var C=V[e.VBR_q],D=V[e.VBR_q+1],H=e.VBR_q_frac;S=linear_int(C,D,H)}else S=19500;break;default:V=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=e.VBR_q&&e.VBR_q<=9){C=V[e.VBR_q],D=V[e.VBR_q+1],H=e.VBR_q_frac;S=linear_int(C,D,H)}else S=19500}e.mode!=MPEGMode.MONO||e.VBR!=n.vbr_off&&e.VBR!=n.vbr_abr||(S*=1.5),e.lowpassfreq=0|S}if(0==e.out_samplerate&&(2*e.lowpassfreq>e.in_samplerate&&(e.lowpassfreq=e.in_samplerate/2),e.out_samplerate=(i=0|e.lowpassfreq,s=e.in_samplerate,_=44100,s>=48e3?_=48e3:s>=44100?_=44100:s>=32e3?_=32e3:s>=24e3?_=24e3:s>=22050?_=22050:s>=16e3?_=16e3:s>=12e3?_=12e3:s>=11025?_=11025:s>=8e3&&(_=8e3),-1==i?_:(i<=15960&&(_=44100),i<=15250&&(_=32e3),i<=11220&&(_=24e3),i<=9970&&(_=22050),i<=7230&&(_=16e3),i<=5420&&(_=12e3),i<=4510&&(_=11025),i<=3970&&(_=8e3),s<_?s>44100?48e3:s>32e3?44100:s>24e3?32e3:s>22050?24e3:s>16e3?22050:s>12e3?16e3:s>11025?12e3:s>8e3?11025:8e3:_))),e.lowpassfreq=Math.min(20500,e.lowpassfreq),e.lowpassfreq=Math.min(e.out_samplerate/2,e.lowpassfreq),e.VBR==n.vbr_off&&(e.compression_ratio=16*e.out_samplerate*c.channels_out/(1e3*e.brate)),e.VBR==n.vbr_abr&&(e.compression_ratio=16*e.out_samplerate*c.channels_out/(1e3*e.VBR_mean_bitrate_kbps)),e.bWriteVbrTag||(e.findReplayGain=!1,e.decode_on_the_fly=!1,c.findPeakSample=!1),c.findReplayGain=e.findReplayGain,c.decode_on_the_fly=e.decode_on_the_fly,c.decode_on_the_fly&&(c.findPeakSample=!0),c.findReplayGain&&b.InitGainAnalysis(c.rgdata,e.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return e.internal_flags=null,-6;switch(c.decode_on_the_fly&&!e.decode_only&&(null!=c.hip&&R.hip_decode_exit(c.hip),c.hip=R.hip_decode_init()),c.mode_gr=e.out_samplerate<=24e3?1:2,e.framesize=576*c.mode_gr,e.encoder_delay=m.ENCDELAY,c.resample_ratio=e.in_samplerate/e.out_samplerate,e.VBR){case n.vbr_mt:case n.vbr_rh:case n.vbr_mtrh:e.compression_ratio=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5][e.VBR_q];break;case n.vbr_abr:e.compression_ratio=16*e.out_samplerate*c.channels_out/(1e3*e.VBR_mean_bitrate_kbps);break;default:e.compression_ratio=16*e.out_samplerate*c.channels_out/(1e3*e.brate)}if(e.mode==MPEGMode.NOT_SET&&(e.mode=MPEGMode.JOINT_STEREO),e.highpassfreq>0?(c.highpass1=2*e.highpassfreq,e.highpasswidth>=0?c.highpass2=2*(e.highpassfreq+e.highpasswidth):c.highpass2=2*e.highpassfreq,c.highpass1/=e.out_samplerate,c.highpass2/=e.out_samplerate):(c.highpass1=0,c.highpass2=0),e.lowpassfreq>0?(c.lowpass2=2*e.lowpassfreq,e.lowpasswidth>=0?(c.lowpass1=2*(e.lowpassfreq-e.lowpasswidth),c.lowpass1<0&&(c.lowpass1=0)):c.lowpass1=2*e.lowpassfreq,c.lowpass1/=e.out_samplerate,c.lowpass2/=e.out_samplerate):(c.lowpass1=0,c.lowpass2=0),function(e){var n=e.internal_flags,r=32,i=-1;if(n.lowpass1>0){for(var a=999,s=0;s<=31;s++)(c=s/31)>=n.lowpass2&&(r=Math.min(r,s)),n.lowpass1<c&&c<n.lowpass2&&(a=Math.min(a,s));n.lowpass1=999==a?(r-.75)/31:(a-.75)/31,n.lowpass2=r/31}if(n.highpass2>0&&n.highpass2<.75/31*.9&&(n.highpass1=0,n.highpass2=0,t.err.println("Warning: highpass filter disabled.  highpass frequency too small\n")),n.highpass2>0){var o=-1;for(s=0;s<=31;s++)(c=s/31)<=n.highpass1&&(i=Math.max(i,s)),n.highpass1<c&&c<n.highpass2&&(o=Math.max(o,s));n.highpass1=i/31,n.highpass2=-1==o?(i+.75)/31:(o+.75)/31}for(s=0;s<32;s++){var l,_,c=s/31;l=n.highpass2>n.highpass1?x((n.highpass2-c)/(n.highpass2-n.highpass1+1e-20)):1,_=n.lowpass2>n.lowpass1?x((c-n.lowpass1)/(n.lowpass2-n.lowpass1+1e-20)):1,n.amp_filter[s]=l*_}}(e),c.samplerate_index=P(e.out_samplerate,e),c.samplerate_index<0)return e.internal_flags=null,-1;if(e.VBR==n.vbr_off){if(e.free_format)c.bitrate_index=0;else if(e.brate=O(e.brate,e.version,e.out_samplerate),c.bitrate_index=L(e.brate,e.version,e.out_samplerate),c.bitrate_index<=0)return e.internal_flags=null,-1}else c.bitrate_index=1;e.analysis&&(e.bWriteVbrTag=!1),null!=c.pinfo&&(e.bWriteVbrTag=!1),v.init_bit_stream_w(c);for(var j,F=c.samplerate_index+3*e.version+6*(e.out_samplerate<16e3?1:0),X=0;X<m.SBMAX_l+1;X++)c.scalefac_band.l[X]=y.sfBandIndex[F].l[X];for(X=0;X<m.PSFB21+1;X++){var q=(c.scalefac_band.l[22]-c.scalefac_band.l[21])/m.PSFB21,Y=c.scalefac_band.l[21]+X*q;c.scalefac_band.psfb21[X]=Y}c.scalefac_band.psfb21[m.PSFB21]=576;for(X=0;X<m.SBMAX_s+1;X++)c.scalefac_band.s[X]=y.sfBandIndex[F].s[X];for(X=0;X<m.PSFB12+1;X++){q=(c.scalefac_band.s[13]-c.scalefac_band.s[12])/m.PSFB12,Y=c.scalefac_band.s[12]+X*q;c.scalefac_band.psfb12[X]=Y}for(c.scalefac_band.psfb12[m.PSFB12]=192,1==e.version?c.sideinfo_len=1==c.channels_out?21:36:c.sideinfo_len=1==c.channels_out?13:21,e.error_protection&&(c.sideinfo_len+=2),function(e){var t=e.internal_flags;e.frameNum=0,e.write_id3tag_automatic&&M.id3tag_write_v2(e),t.bitrate_stereoMode_Hist=a([16,5]),t.bitrate_blockType_Hist=a([16,6]),t.PeakSample=0,e.bWriteVbrTag&&A.InitVbrTag(e)}(e),c.Class_ID=I,j=0;j<19;j++)c.nsPsy.pefirbuf[j]=700*c.mode_gr*c.channels_out;switch(-1==e.ATHtype&&(e.ATHtype=4),o(e.VBR_q<=9),o(e.VBR_q>=0),e.VBR){case n.vbr_mt:e.VBR=n.vbr_mtrh;case n.vbr_mtrh:null==e.useTemporal&&(e.useTemporal=!1),g.apply_preset(e,500-10*e.VBR_q,0),e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),e.quality<5&&(e.quality=0),e.quality>5&&(e.quality=5),c.PSY.mask_adjust=e.maskingadjust,c.PSY.mask_adjust_short=e.maskingadjust_short,e.experimentalY?c.sfb21_extra=!1:c.sfb21_extra=e.out_samplerate>44e3,c.iteration_loop=new VBRNewIterationLoop(w);break;case n.vbr_rh:g.apply_preset(e,500-10*e.VBR_q,0),c.PSY.mask_adjust=e.maskingadjust,c.PSY.mask_adjust_short=e.maskingadjust_short,e.experimentalY?c.sfb21_extra=!1:c.sfb21_extra=e.out_samplerate>44e3,e.quality>6&&(e.quality=6),e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),c.iteration_loop=new VBROldIterationLoop(w);break;default:var G;c.sfb21_extra=!1,e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),(G=e.VBR)==n.vbr_off&&(e.VBR_mean_bitrate_kbps=e.brate),g.apply_preset(e,e.VBR_mean_bitrate_kbps,0),e.VBR=G,c.PSY.mask_adjust=e.maskingadjust,c.PSY.mask_adjust_short=e.maskingadjust_short,G==n.vbr_off?c.iteration_loop=new h(w):c.iteration_loop=new ABRIterationLoop(w)}if(o(e.scale>=0),e.VBR!=n.vbr_off){if(c.VBR_min_bitrate=1,c.VBR_max_bitrate=14,e.out_samplerate<16e3&&(c.VBR_max_bitrate=8),0!=e.VBR_min_bitrate_kbps&&(e.VBR_min_bitrate_kbps=O(e.VBR_min_bitrate_kbps,e.version,e.out_samplerate),c.VBR_min_bitrate=L(e.VBR_min_bitrate_kbps,e.version,e.out_samplerate),c.VBR_min_bitrate<0))return-1;if(0!=e.VBR_max_bitrate_kbps&&(e.VBR_max_bitrate_kbps=O(e.VBR_max_bitrate_kbps,e.version,e.out_samplerate),c.VBR_max_bitrate=L(e.VBR_max_bitrate_kbps,e.version,e.out_samplerate),c.VBR_max_bitrate<0))return-1;e.VBR_min_bitrate_kbps=p.bitrate_table[e.version][c.VBR_min_bitrate],e.VBR_max_bitrate_kbps=p.bitrate_table[e.version][c.VBR_max_bitrate],e.VBR_mean_bitrate_kbps=Math.min(p.bitrate_table[e.version][c.VBR_max_bitrate],e.VBR_mean_bitrate_kbps),e.VBR_mean_bitrate_kbps=Math.max(p.bitrate_table[e.version][c.VBR_min_bitrate],e.VBR_mean_bitrate_kbps)}return e.tune&&(c.PSY.mask_adjust+=e.tune_value_a,c.PSY.mask_adjust_short+=e.tune_value_a),function(e){var t=e.internal_flags;switch(e.quality){default:case 9:t.psymodel=0,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 8:e.quality=7;case 7:t.psymodel=1,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 6:case 5:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=0,t.full_outer_loop=0;break;case 4:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 3:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=1,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 2:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=1,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 1:case 0:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=2,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0}}(e),o(e.scale>=0),e.athaa_type<0?c.ATH.useAdjust=3:c.ATH.useAdjust=e.athaa_type,c.ATH.aaSensitivityP=Math.pow(10,e.athaa_sensitivity/-10),null==e.short_blocks&&(e.short_blocks=r.short_block_allowed),e.short_blocks!=r.short_block_allowed||e.mode!=MPEGMode.JOINT_STEREO&&e.mode!=MPEGMode.STEREO||(e.short_blocks=r.short_block_coupled),e.quant_comp<0&&(e.quant_comp=1),e.quant_comp_short<0&&(e.quant_comp_short=0),e.msfix<0&&(e.msfix=0),e.exp_nspsytune=1|e.exp_nspsytune,e.internal_flags.nsPsy.attackthre<0&&(e.internal_flags.nsPsy.attackthre=l.NSATTACKTHRE),e.internal_flags.nsPsy.attackthre_s<0&&(e.internal_flags.nsPsy.attackthre_s=l.NSATTACKTHRE_S),o(e.scale>=0),e.scale<0&&(e.scale=1),e.ATHtype<0&&(e.ATHtype=4),e.ATHcurve<0&&(e.ATHcurve=4),e.athaa_loudapprox<0&&(e.athaa_loudapprox=2),e.interChRatio<0&&(e.interChRatio=0),null==e.useTemporal&&(e.useTemporal=!0),c.slot_lag=c.frac_SpF=0,e.VBR==n.vbr_off&&(c.slot_lag=c.frac_SpF=72e3*(e.version+1)*e.brate%e.out_samplerate|0),y.iteration_init(e),B.psymodel_init(e),o(e.scale>=0),0},this.lame_encode_flush=function(e,t,n,r){var i,a,o,l,_=e.internal_flags,c=s([2,1152]),u=0,f=_.mf_samples_to_encode-m.POSTDELAY,h=V(e);if(_.mf_samples_to_encode<1)return 0;for(i=0,e.in_samplerate!=e.out_samplerate&&(f+=16*e.out_samplerate/e.in_samplerate),(o=e.framesize-f%e.framesize)<576&&(o+=e.framesize),e.encoder_padding=o,l=(f+o)/e.framesize;l>0&&u>=0;){var d=h-_.mf_size,p=e.frameNum;d*=e.in_samplerate,(d/=e.out_samplerate)>1152&&(d=1152),d<1&&(d=1),a=r-i,0==r&&(a=0),n+=u=this.lame_encode_buffer(e,c[0],c[1],d,t,n,a),i+=u,l-=p!=e.frameNum?1:0}if(_.mf_samples_to_encode=0,u<0)return u;if(a=r-i,0==r&&(a=0),v.flush_bitstream(e),(u=v.copy_buffer(_,t,n,a,1))<0)return u;if(n+=u,a=r-(i+=u),0==r&&(a=0),e.write_id3tag_automatic){if(M.id3tag_write_v1(e),(u=v.copy_buffer(_,t,n,a,0))<0)return u;i+=u}return i},this.lame_encode_buffer=function(e,t,n,r,a,s,l){var _=e.internal_flags,u=[null,null];if(_.Class_ID!=I)return-3;if(0==r)return 0;!function(e,t){(null==e.in_buffer_0||e.in_buffer_nsamples<t)&&(e.in_buffer_0=i(t),e.in_buffer_1=i(t),e.in_buffer_nsamples=t)}(_,r),u[0]=_.in_buffer_0,u[1]=_.in_buffer_1;for(var f=0;f<r;f++)u[0][f]=t[f],_.channels_in>1&&(u[1][f]=n[f]);return function(e,t,n,r,i,a,s){var l,_,u,f,h,p=e.internal_flags,g=0,y=[null,null],w=[null,null];if(p.Class_ID!=I)return-3;if(0==r)return 0;if(h=v.copy_buffer(p,i,a,s,0),h<0)return h;if(a+=h,g+=h,w[0]=t,w[1]=n,d.NEQ(e.scale,0)&&d.NEQ(e.scale,1))for(_=0;_<r;++_)w[0][_]*=e.scale,2==p.channels_out&&(w[1][_]*=e.scale);if(d.NEQ(e.scale_left,0)&&d.NEQ(e.scale_left,1))for(_=0;_<r;++_)w[0][_]*=e.scale_left;if(d.NEQ(e.scale_right,0)&&d.NEQ(e.scale_right,1))for(_=0;_<r;++_)w[1][_]*=e.scale_right;if(2==e.num_channels&&1==p.channels_out)for(_=0;_<r;++_)w[0][_]=.5*(w[0][_]+w[1][_]),w[1][_]=0;f=V(e),y[0]=p.mfbuf[0],y[1]=p.mfbuf[1];var S=0;for(;r>0;){var A=[null,null],M=0,R=0;A[0]=w[0],A[1]=w[1];var B=new D;if(q(e,y,A,S,r,B),M=B.n_in,R=B.n_out,p.findReplayGain&&!p.decode_on_the_fly&&b.AnalyzeSamples(p.rgdata,y[0],p.mf_size,y[1],p.mf_size,R,p.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(r-=M,S+=M,p.channels_out,p.mf_size+=R,o(p.mf_size<=c.MFSIZE),p.mf_samples_to_encode<1&&(p.mf_samples_to_encode=m.ENCDELAY+m.POSTDELAY),p.mf_samples_to_encode+=R,p.mf_size>=f){var E=s-g;if(0==s&&(E=0),(l=C(e,y[0],y[1],i,a,E))<0)return l;for(a+=l,g+=l,p.mf_size-=e.framesize,p.mf_samples_to_encode-=e.framesize,u=0;u<p.channels_out;u++)for(_=0;_<p.mf_size;_++)y[u][_]=y[u][_+e.framesize]}}return o(0==r),g}(e,u[0],u[1],r,a,s,l)}},Cn}function yr(){if(jn)return Hn;jn=1;var e=ir();e.System;var t=e.VbrMode;return e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double,e.new_float,e.new_float_n,e.new_int,e.new_int_n,e.assert,Hn=function(){function e(e,t,n,r,i,a,s,o,l,_,c,u,f,h,d){this.vbr_q=e,this.quant_comp=t,this.quant_comp_s=n,this.expY=r,this.st_lrm=i,this.st_s=a,this.masking_adj=s,this.masking_adj_short=o,this.ath_lower=l,this.ath_curve=_,this.ath_sensitivity=c,this.interch=u,this.safejoint=f,this.sfb21mod=h,this.msfix=d}function n(e,t,n,r,i,a,s,o,l,_,c,u,f,h){this.quant_comp=t,this.quant_comp_s=n,this.safejoint=r,this.nsmsfix=i,this.st_lrm=a,this.st_s=s,this.nsbass=o,this.scale=l,this.masking_adj=_,this.ath_lower=c,this.ath_curve=u,this.interch=f,this.sfscale=h}var r;this.setModules=function(e){r=e};var i=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],a=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function s(e,n,r){var s=e.VBR==t.vbr_rh?i:a,o=e.VBR_q_frac,l=s[n],_=s[n+1],c=l;l.st_lrm=l.st_lrm+o*(_.st_lrm-l.st_lrm),l.st_s=l.st_s+o*(_.st_s-l.st_s),l.masking_adj=l.masking_adj+o*(_.masking_adj-l.masking_adj),l.masking_adj_short=l.masking_adj_short+o*(_.masking_adj_short-l.masking_adj_short),l.ath_lower=l.ath_lower+o*(_.ath_lower-l.ath_lower),l.ath_curve=l.ath_curve+o*(_.ath_curve-l.ath_curve),l.ath_sensitivity=l.ath_sensitivity+o*(_.ath_sensitivity-l.ath_sensitivity),l.interch=l.interch+o*(_.interch-l.interch),l.msfix=l.msfix+o*(_.msfix-l.msfix),function(e,t){var n=0;0>t&&(n=-1,t=0);9<t&&(n=-1,t=9);e.VBR_q=t,e.VBR_q_frac=0}(e,c.vbr_q),0!=r?e.quant_comp=c.quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=c.quant_comp),0!=r?e.quant_comp_short=c.quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=c.quant_comp_s),0!=c.expY&&(e.experimentalY=0!=c.expY),0!=r?e.internal_flags.nsPsy.attackthre=c.st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=c.st_lrm),0!=r?e.internal_flags.nsPsy.attackthre_s=c.st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=c.st_s),0!=r?e.maskingadjust=c.masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=c.masking_adj),0!=r?e.maskingadjust_short=c.masking_adj_short:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=c.masking_adj_short),0!=r?e.ATHlower=-c.ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-c.ath_lower/10),0!=r?e.ATHcurve=c.ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=c.ath_curve),0!=r?e.athaa_sensitivity=c.ath_sensitivity:Math.abs(e.athaa_sensitivity- -1)>0||(e.athaa_sensitivity=c.ath_sensitivity),c.interch>0&&(0!=r?e.interChRatio=c.interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=c.interch)),c.safejoint>0&&(e.exp_nspsytune=e.exp_nspsytune|c.safejoint),c.sfb21mod>0&&(e.exp_nspsytune=e.exp_nspsytune|c.sfb21mod<<20),0!=r?e.msfix=c.msfix:Math.abs(e.msfix- -1)>0||(e.msfix=c.msfix),0==r&&(e.VBR_q=n,e.VBR_q_frac=o)}var o=[new n(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new n(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new n(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new n(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new n(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new n(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new n(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new n(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new n(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new n(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new n(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new n(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new n(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new n(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new n(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new n(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new n(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function l(e,n,i){var a=n,s=r.nearestBitrateFullIndex(n);if(e.VBR=t.vbr_abr,e.VBR_mean_bitrate_kbps=a,e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320),e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.brate=e.VBR_mean_bitrate_kbps,e.VBR_mean_bitrate_kbps>320&&(e.disable_reservoir=!0),o[s].safejoint>0&&(e.exp_nspsytune=2|e.exp_nspsytune),o[s].sfscale>0&&(e.internal_flags.noise_shaping=2),Math.abs(o[s].nsbass)>0){var l=int(4*o[s].nsbass);l<0&&(l+=64),e.exp_nspsytune=e.exp_nspsytune|l<<2}return 0!=i?e.quant_comp=o[s].quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=o[s].quant_comp),0!=i?e.quant_comp_short=o[s].quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=o[s].quant_comp_s),0!=i?e.msfix=o[s].nsmsfix:Math.abs(e.msfix- -1)>0||(e.msfix=o[s].nsmsfix),0!=i?e.internal_flags.nsPsy.attackthre=o[s].st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=o[s].st_lrm),0!=i?e.internal_flags.nsPsy.attackthre_s=o[s].st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=o[s].st_s),0!=i?e.scale=o[s].scale:Math.abs(e.scale- -1)>0||(e.scale=o[s].scale),0!=i?e.maskingadjust=o[s].masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=o[s].masking_adj),o[s].masking_adj>0?0!=i?e.maskingadjust_short=.9*o[s].masking_adj:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=.9*o[s].masking_adj):0!=i?e.maskingadjust_short=1.1*o[s].masking_adj:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=1.1*o[s].masking_adj),0!=i?e.ATHlower=-o[s].ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-o[s].ath_lower/10),0!=i?e.ATHcurve=o[s].ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=o[s].ath_curve),0!=i?e.interChRatio=o[s].interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=o[s].interch),n}this.apply_preset=function(e,n,r){switch(n){case Lame.R3MIX:n=Lame.V3,e.VBR=t.vbr_mtrh;break;case Lame.MEDIUM:n=Lame.V4,e.VBR=t.vbr_rh;break;case Lame.MEDIUM_FAST:n=Lame.V4,e.VBR=t.vbr_mtrh;break;case Lame.STANDARD:n=Lame.V2,e.VBR=t.vbr_rh;break;case Lame.STANDARD_FAST:n=Lame.V2,e.VBR=t.vbr_mtrh;break;case Lame.EXTREME:n=Lame.V0,e.VBR=t.vbr_rh;break;case Lame.EXTREME_FAST:n=Lame.V0,e.VBR=t.vbr_mtrh;break;case Lame.INSANE:return n=320,e.preset=n,l(e,n,r),e.VBR=t.vbr_off,n}switch(e.preset=n,n){case Lame.V9:return s(e,9,r),n;case Lame.V8:return s(e,8,r),n;case Lame.V7:return s(e,7,r),n;case Lame.V6:return s(e,6,r),n;case Lame.V5:return s(e,5,r),n;case Lame.V4:return s(e,4,r),n;case Lame.V3:return s(e,3,r),n;case Lame.V2:return s(e,2,r),n;case Lame.V1:return s(e,1,r),n;case Lame.V0:return s(e,0,r),n}return 8<=n&&n<=320?l(e,n,r):(e.preset=0,n)}},Hn}function wr(){if(zn)return Kn;zn=1;var e=ir(),t=e.System,n=e.VbrMode;e.Float,e.ShortBlock;var r=e.Util,i=e.Arrays;e.new_array_n,e.new_byte,e.new_double;var a=e.new_float;e.new_float_n,e.new_int,e.new_int_n;var s=e.assert,o=Xn?Fn:(Xn=1,Fn=function(){this.setModules=function(e,t){}}),l=Yn?qn:(Yn=1,qn=function(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}),_=function(){if(Un)return Gn;Un=1;var e=ir(),t=e.new_float,n=e.new_int;return e.assert,Gn=function(){this.global_gain=0,this.sfb_count1=0,this.step=n(39),this.noise=t(39),this.noise_log=t(39)}}(),c=sr(),u=cr(),f=_r();return Kn=function(){var e,h,d;this.rv=null,this.qupvt=null;var p,m=new o;function b(e){this.ordinal=e}function v(e){for(var t=0;t<e.sfbmax;t++)if(e.scalefac[t]+e.subblock_gain[e.window[t]]==0)return!1;return!0}function g(e){return r.FAST_LOG10(.368+.632*e*e*e)}function y(e,t,n,r,i){var a;switch(e){default:case 9:t.over_count>0?(a=n.over_SSD<=t.over_SSD,n.over_SSD==t.over_SSD&&(a=n.bits<t.bits)):a=n.max_noise<0&&10*n.max_noise+n.bits<=10*t.max_noise+t.bits;break;case 0:a=n.over_count<t.over_count||n.over_count==t.over_count&&n.over_noise<t.over_noise||n.over_count==t.over_count&&BitStream.EQ(n.over_noise,t.over_noise)&&n.tot_noise<t.tot_noise;break;case 8:n.max_noise=function(e,t){for(var n=1e-37,r=0;r<t.psymax;r++)n+=g(e[r]);return Math.max(1e-20,n)}(i,r);case 1:a=n.max_noise<t.max_noise;break;case 2:a=n.tot_noise<t.tot_noise;break;case 3:a=n.tot_noise<t.tot_noise&&n.max_noise<t.max_noise;break;case 4:a=n.max_noise<=0&&t.max_noise>.2||n.max_noise<=0&&t.max_noise<0&&t.max_noise>n.max_noise-.2&&n.tot_noise<t.tot_noise||n.max_noise<=0&&t.max_noise>0&&t.max_noise>n.max_noise-.2&&n.tot_noise<t.tot_noise+t.over_noise||n.max_noise>0&&t.max_noise>-.05&&t.max_noise>n.max_noise-.1&&n.tot_noise+n.over_noise<t.tot_noise+t.over_noise||n.max_noise>0&&t.max_noise>-.1&&t.max_noise>n.max_noise-.15&&n.tot_noise+n.over_noise+n.over_noise<t.tot_noise+t.over_noise+t.over_noise;break;case 5:a=n.over_noise<t.over_noise||BitStream.EQ(n.over_noise,t.over_noise)&&n.tot_noise<t.tot_noise;break;case 6:a=n.over_noise<t.over_noise||BitStream.EQ(n.over_noise,t.over_noise)&&(n.max_noise<t.max_noise||BitStream.EQ(n.max_noise,t.max_noise)&&n.tot_noise<=t.tot_noise);break;case 7:a=n.over_count<t.over_count||n.over_noise<t.over_noise}return 0==t.over_count&&(a=a&&n.bits<t.bits),a}function w(e,t,n,r,a){var o=e.internal_flags;!function(e,t,n,r,i){var a,s=e.internal_flags;a=0==t.scalefac_scale?1.2968395546510096:1.6817928305074292;for(var o=0,l=0;l<t.sfbmax;l++)o<n[l]&&(o=n[l]);var _=s.noise_shaping_amp;switch(3==_&&(_=i?2:1),_){case 2:break;case 1:o>1?o=Math.pow(o,.5):o*=.95;break;default:o>1?o=1:o*=.95}var c=0;for(l=0;l<t.sfbmax;l++){var u,f=t.width[l];if(c+=f,!(n[l]<o)){if(2&s.substep_shaping&&(s.pseudohalf[l]=0==s.pseudohalf[l]?1:0,0==s.pseudohalf[l]&&2==s.noise_shaping_amp))return;for(t.scalefac[l]++,u=-f;u<0;u++)r[c+u]*=a,r[c+u]>t.xrpow_max&&(t.xrpow_max=r[c+u]);if(2==s.noise_shaping_amp)return}}}(e,t,n,r,a);var l=v(t);return!l&&(!(l=2==o.mode_gr?p.scale_bitcount(t):p.scale_bitcount_lsf(o,t))||(o.noise_shaping>1&&(i.fill(o.pseudohalf,0),0==t.scalefac_scale?(!function(e,t){for(var n=0,r=0;r<e.sfbmax;r++){var i=e.width[r],a=e.scalefac[r];if(0!=e.preflag&&(a+=d.pretab[r]),n+=i,1&a){a++;for(var s=-i;s<0;s++)t[n+s]*=1.2968395546510096,t[n+s]>e.xrpow_max&&(e.xrpow_max=t[n+s])}e.scalefac[r]=a>>1}e.preflag=0,e.scalefac_scale=1}(t,r),l=!1):t.block_type==c.SHORT_TYPE&&o.subblock_gain>0&&(l=function(e,t,n){var r,i=t.scalefac;for(r=0;r<t.sfb_lmax;r++)if(i[r]>=16)return!0;for(var a=0;a<3;a++){var o=0,l=0;for(r=t.sfb_lmax+a;r<t.sfbdivide;r+=3)o<i[r]&&(o=i[r]);for(;r<t.sfbmax;r+=3)l<i[r]&&(l=i[r]);if(!(o<16&&l<8)){if(t.subblock_gain[a]>=7)return!0;t.subblock_gain[a]++;var _=e.scalefac_band.l[t.sfb_lmax];for(r=t.sfb_lmax+a;r<t.sfbmax;r+=3){var c=t.width[r],u=i[r];if(s(u>=0),(u-=4>>t.scalefac_scale)>=0)i[r]=u,_+=3*c;else{i[r]=0;var f=210+(u<<t.scalefac_scale+1);p=d.IPOW20(f),_+=c*(a+1);for(var h=-c;h<0;h++)n[_+h]*=p,n[_+h]>t.xrpow_max&&(t.xrpow_max=n[_+h]);_+=c*(3-a-1)}}var p=d.IPOW20(202);for(_+=t.width[r]*(a+1),h=-t.width[r];h<0;h++)n[_+h]*=p,n[_+h]>t.xrpow_max&&(t.xrpow_max=n[_+h])}}return!1}(o,t,r)||v(t))),l||(l=2==o.mode_gr?p.scale_bitcount(t):p.scale_bitcount_lsf(o,t)),!l))}this.setModules=function(t,n,r,i){e=t,h=n,this.rv=n,d=r,this.qupvt=r,p=i,m.setModules(d,p)},this.ms_convert=function(e,t){for(var n=0;n<576;++n){var i=e.tt[t][0].xr[n],a=e.tt[t][1].xr[n];e.tt[t][0].xr[n]=(i+a)*(.5*r.SQRT2),e.tt[t][1].xr[n]=(i-a)*(.5*r.SQRT2)}},this.init_xrpow=function(e,t,n){var r=0,a=0|t.max_nonzero_coeff;if(s(null!=n),t.xrpow_max=0,s(0<=a&&a<=575),i.fill(n,a,576,0),r=function(e,t,n,r){r=0;for(var i=0;i<=n;++i){var a=Math.abs(e.xr[i]);r+=a,t[i]=Math.sqrt(a*Math.sqrt(a)),t[i]>e.xrpow_max&&(e.xrpow_max=t[i])}return r}(t,n,a,r),r>1e-20){var o=0;2&e.substep_shaping&&(o=1);for(var l=0;l<t.psymax;l++)e.pseudohalf[l]=o;return!0}return i.fill(t.l3_enc,0,576,0),!1},this.init_outer_loop=function(e,n){n.part2_3_length=0,n.big_values=0,n.count1=0,n.global_gain=210,n.scalefac_compress=0,n.table_select[0]=0,n.table_select[1]=0,n.table_select[2]=0,n.subblock_gain[0]=0,n.subblock_gain[1]=0,n.subblock_gain[2]=0,n.subblock_gain[3]=0,n.region0_count=0,n.region1_count=0,n.preflag=0,n.scalefac_scale=0,n.count1table_select=0,n.part2_length=0,n.sfb_lmax=c.SBPSY_l,n.sfb_smin=c.SBPSY_s,n.psy_lmax=e.sfb21_extra?c.SBMAX_l:c.SBPSY_l,n.psymax=n.psy_lmax,n.sfbmax=n.sfb_lmax,n.sfbdivide=11;for(var r=0;r<c.SBMAX_l;r++)n.width[r]=e.scalefac_band.l[r+1]-e.scalefac_band.l[r],n.window[r]=3;if(n.block_type==c.SHORT_TYPE){var s=a(576);n.sfb_smin=0,n.sfb_lmax=0,0!=n.mixed_block_flag&&(n.sfb_smin=3,n.sfb_lmax=2*e.mode_gr+4),n.psymax=n.sfb_lmax+3*((e.sfb21_extra?c.SBMAX_s:c.SBPSY_s)-n.sfb_smin),n.sfbmax=n.sfb_lmax+3*(c.SBPSY_s-n.sfb_smin),n.sfbdivide=n.sfbmax-18,n.psy_lmax=n.sfb_lmax;var o=e.scalefac_band.l[n.sfb_lmax];t.arraycopy(n.xr,0,s,0,576);for(r=n.sfb_smin;r<c.SBMAX_s;r++)for(var l=e.scalefac_band.s[r],_=e.scalefac_band.s[r+1],u=0;u<3;u++)for(var f=l;f<_;f++)n.xr[o++]=s[3*f+u];var h=n.sfb_lmax;for(r=n.sfb_smin;r<c.SBMAX_s;r++)n.width[h]=n.width[h+1]=n.width[h+2]=e.scalefac_band.s[r+1]-e.scalefac_band.s[r],n.window[h]=0,n.window[h+1]=1,n.window[h+2]=2,h+=3}n.count1bits=0,n.sfb_partition_table=d.nr_of_sfb_block[0][0],n.slen[0]=0,n.slen[1]=0,n.slen[2]=0,n.slen[3]=0,n.max_nonzero_coeff=575,i.fill(n.scalefac,0),function(e,t){var n=e.ATH,r=t.xr;if(t.block_type!=c.SHORT_TYPE)for(var i=!1,a=c.PSFB21-1;a>=0&&!i;a--){var s=e.scalefac_band.psfb21[a],o=e.scalefac_band.psfb21[a+1],l=d.athAdjust(n.adjust,n.psfb21[a],n.floor);e.nsPsy.longfact[21]>1e-12&&(l*=e.nsPsy.longfact[21]);for(var _=o-1;_>=s;_--){if(!(Math.abs(r[_])<l)){i=!0;break}r[_]=0}}else for(var u=0;u<3;u++)for(i=!1,a=c.PSFB12-1;a>=0&&!i;a--){o=(s=3*e.scalefac_band.s[12]+(e.scalefac_band.s[13]-e.scalefac_band.s[12])*u+(e.scalefac_band.psfb12[a]-e.scalefac_band.psfb12[0]))+(e.scalefac_band.psfb12[a+1]-e.scalefac_band.psfb12[a]);var f=d.athAdjust(n.adjust,n.psfb12[a],n.floor);for(e.nsPsy.shortfact[12]>1e-12&&(f*=e.nsPsy.shortfact[12]),_=o-1;_>=s;_--){if(!(Math.abs(r[_])<f)){i=!0;break}r[_]=0}}}(e,n)},b.BINSEARCH_NONE=new b(0),b.BINSEARCH_UP=new b(1),b.BINSEARCH_DOWN=new b(2),this.trancate_smallspectrums=function(e,t,n,r){var s=a(f.SFBMAX);if((4&e.substep_shaping||t.block_type!=c.SHORT_TYPE)&&!(128&e.substep_shaping)){d.calc_noise(t,n,s,new l,null);for(var o=0;o<576;o++){var _=0;0!=t.l3_enc[o]&&(_=Math.abs(t.xr[o])),r[o]=_}o=0;var u=8;t.block_type==c.SHORT_TYPE&&(u=6);do{var h,m,b,v,g=t.width[u];if(o+=g,!(s[u]>=1||(i.sort(r,o-g,g),BitStream.EQ(r[o-1],0)))){h=(1-s[u])*n[u],m=0,v=0;do{var y;for(b=1;v+b<g&&!BitStream.NEQ(r[v+o-g],r[v+o+b-g]);b++);if(h<(y=r[v+o-g]*r[v+o-g]*b)){0!=v&&(m=r[v+o-g-1]);break}h-=y,v+=b}while(v<g);if(!BitStream.EQ(m,0))do{Math.abs(t.xr[o-g])<=m&&(t.l3_enc[o-g]=0)}while(--g>0)}}while(++u<t.psymax);t.part2_3_length=p.noquant_count_bits(e,t,null)}},this.outer_loop=function(e,r,i,o,h,m){var v=e.internal_flags,g=new u,S=a(576),A=a(f.SFBMAX),M=new l,R=new _,B=9999999,E=!1,k=!1,T=0;if(function(e,t,n,r,i){var a,o=e.CurrentStep[r],l=!1,_=e.OldValue[r],c=b.BINSEARCH_NONE;for(t.global_gain=_,n-=t.part2_length,s(0!=o);;){var u;if(a=p.count_bits(e,i,t,null),1==o||a==n)break;a>n?(c==b.BINSEARCH_DOWN&&(l=!0),l&&(o/=2),c=b.BINSEARCH_UP,u=o):(c==b.BINSEARCH_UP&&(l=!0),l&&(o/=2),c=b.BINSEARCH_DOWN,u=-o),t.global_gain+=u,t.global_gain<0&&(t.global_gain=0,l=!0),t.global_gain>255&&(t.global_gain=255,l=!0)}for(s(t.global_gain>=0),s(t.global_gain<256);a>n&&t.global_gain<255;)t.global_gain++,a=p.count_bits(e,i,t,null);e.CurrentStep[r]=_-t.global_gain>=4?4:2,e.OldValue[r]=t.global_gain,t.part2_3_length=a}(v,r,m,h,o),0==v.noise_shaping)return 100;d.calc_noise(r,i,A,M,R),M.bits=r.part2_3_length,g.assign(r);var I=0;for(t.arraycopy(o,0,S,0,576);!E;){do{var x,P=new l,O=255;if(x=2&v.substep_shaping?20:3,v.sfb21_extra){if(A[g.sfbmax]>1)break;if(g.block_type==c.SHORT_TYPE&&(A[g.sfbmax+1]>1||A[g.sfbmax+2]>1))break}if(!w(e,g,A,o,k))break;0!=g.scalefac_scale&&(O=254);var L=m-g.part2_length;if(L<=0)break;for(;(g.part2_3_length=p.count_bits(v,o,g,R))>L&&g.global_gain<=O;)g.global_gain++;if(g.global_gain>O)break;if(0==M.over_count){for(;(g.part2_3_length=p.count_bits(v,o,g,R))>B&&g.global_gain<=O;)g.global_gain++;if(g.global_gain>O)break}if(d.calc_noise(g,i,A,P,R),P.bits=g.part2_3_length,0!=(y(r.block_type!=c.SHORT_TYPE?e.quant_comp:e.quant_comp_short,M,P,g,A)?1:0))B=r.part2_3_length,M=P,r.assign(g),I=0,t.arraycopy(o,0,S,0,576);else if(0==v.full_outer_loop){if(++I>x&&0==M.over_count)break;if(3==v.noise_shaping_amp&&k&&I>30)break;if(3==v.noise_shaping_amp&&k&&g.global_gain-T>15)break}}while(g.global_gain+g.scalefac_scale<255);3==v.noise_shaping_amp?k?E=!0:(g.assign(r),t.arraycopy(S,0,o,0,576),I=0,T=g.global_gain,k=!0):E=!0}return s(r.global_gain+r.scalefac_scale<=255),e.VBR==n.vbr_rh||e.VBR==n.vbr_mtrh?t.arraycopy(S,0,o,0,576):1&v.substep_shaping&&trancate_smallspectrums(v,r,i,o),M.over_count},this.iteration_finish_one=function(e,t,n){var r=e.l3_side,i=r.tt[t][n];p.best_scalefac_store(e,t,n,r),1==e.use_best_huffman&&p.best_huffman_divide(e,i),h.ResvAdjust(e,i)},this.VBR_encode_granule=function(e,n,r,o,l,_,c){var f,h=e.internal_flags,d=new u,p=a(576),m=c,b=c+1,v=(c+_)/2,g=0,y=h.sfb21_extra;s(m<=LameInternalFlags.MAX_BITS_PER_CHANNEL),i.fill(d.l3_enc,0);do{s(v>=_),s(v<=c),s(_<=c),h.sfb21_extra=!(v>m-42)&&y,outer_loop(e,n,r,o,l,v)<=0?(g=1,b=n.part2_3_length,d.assign(n),t.arraycopy(o,0,p,0,576),f=(c=b-32)-_,v=(c+_)/2):(f=c-(_=v+32),v=(c+_)/2,0!=g&&(g=2,n.assign(d),t.arraycopy(p,0,o,0,576)))}while(f>12);h.sfb21_extra=y,2==g&&t.arraycopy(d.l3_enc,0,n.l3_enc,0,576),s(n.part2_3_length<=m)},this.get_framebits=function(t,n){var r=t.internal_flags;r.bitrate_index=r.VBR_min_bitrate;var i=e.getframebits(t);r.bitrate_index=1,i=e.getframebits(t);for(var a=1;a<=r.VBR_max_bitrate;a++){r.bitrate_index=a;var s=new MeanBits(i);n[a]=h.ResvFrameBegin(t,s),i=s.bits}},this.VBR_old_prepare=function(e,t,n,r,i,a,s,o,l){var _,u=e.internal_flags,f=0,p=1,m=0;u.bitrate_index=u.VBR_max_bitrate;var b=h.ResvFrameBegin(e,new MeanBits(0))/u.mode_gr;get_framebits(e,a);for(var v=0;v<u.mode_gr;v++){var g=d.on_pe(e,t,o[v],b,v,0);u.mode_ext==c.MPG_MD_MS_LR&&(ms_convert(u.l3_side,v),d.reduce_side(o[v],n[v],b,g));for(var y=0;y<u.channels_out;++y){var w=u.l3_side.tt[v][y];w.block_type!=c.SHORT_TYPE?(f=1.28/(1+Math.exp(3.5-t[v][y]/300))-.05,_=u.PSY.mask_adjust-f):(f=2.56/(1+Math.exp(3.5-t[v][y]/300))-.14,_=u.PSY.mask_adjust_short-f),u.masking_lower=Math.pow(10,.1*_),init_outer_loop(u,w),l[v][y]=d.calc_xmin(e,r[v][y],w,i[v][y]),0!=l[v][y]&&(p=0),s[v][y]=126,m+=o[v][y]}}for(v=0;v<u.mode_gr;v++)for(y=0;y<u.channels_out;y++)m>a[u.VBR_max_bitrate]&&(o[v][y]*=a[u.VBR_max_bitrate],o[v][y]/=m),s[v][y]>o[v][y]&&(s[v][y]=o[v][y]);return p},this.bitpressure_strategy=function(e,t,n,r){for(var i=0;i<e.mode_gr;i++)for(var a=0;a<e.channels_out;a++){for(var s=e.l3_side.tt[i][a],o=t[i][a],l=0,_=0;_<s.psy_lmax;_++)o[l++]*=1+.029*_*_/c.SBMAX_l/c.SBMAX_l;if(s.block_type==c.SHORT_TYPE)for(_=s.sfb_smin;_<c.SBMAX_s;_++)o[l++]*=1+.029*_*_/c.SBMAX_s/c.SBMAX_s,o[l++]*=1+.029*_*_/c.SBMAX_s/c.SBMAX_s,o[l++]*=1+.029*_*_/c.SBMAX_s/c.SBMAX_s;r[i][a]=0|Math.max(n[i][a],.9*r[i][a])}},this.VBR_new_prepare=function(e,t,n,r,i,a){var s,o=e.internal_flags,l=1,_=0,u=0;if(e.free_format){o.bitrate_index=0;f=new MeanBits(_);s=h.ResvFrameBegin(e,f),_=f.bits,i[0]=s}else{o.bitrate_index=o.VBR_max_bitrate;var f=new MeanBits(_);h.ResvFrameBegin(e,f),_=f.bits,get_framebits(e,i),s=i[o.VBR_max_bitrate]}for(var p=0;p<o.mode_gr;p++){d.on_pe(e,t,a[p],_,p,0),o.mode_ext==c.MPG_MD_MS_LR&&ms_convert(o.l3_side,p);for(var m=0;m<o.channels_out;++m){var b=o.l3_side.tt[p][m];o.masking_lower=Math.pow(10,.1*o.PSY.mask_adjust),init_outer_loop(o,b),0!=d.calc_xmin(e,n[p][m],b,r[p][m])&&(l=0),u+=a[p][m]}}for(p=0;p<o.mode_gr;p++)for(m=0;m<o.channels_out;m++)u>s&&(a[p][m]*=s,a[p][m]/=u);return l},this.calc_target_bits=function(t,n,r,i,a,s){var o,l,_,u,f=t.internal_flags,p=f.l3_side,m=0;f.bitrate_index=f.VBR_max_bitrate;var b=new MeanBits(m);for(s[0]=h.ResvFrameBegin(t,b),m=b.bits,f.bitrate_index=1,m=e.getframebits(t)-8*f.sideinfo_len,a[0]=m/(f.mode_gr*f.channels_out),m=t.VBR_mean_bitrate_kbps*t.framesize*1e3,1&f.substep_shaping&&(m*=1.09),m/=t.out_samplerate,m-=8*f.sideinfo_len,m/=f.mode_gr*f.channels_out,(o=.93+.07*(11-t.compression_ratio)/5.5)<.9&&(o=.9),o>1&&(o=1),l=0;l<f.mode_gr;l++){var v=0;for(_=0;_<f.channels_out;_++){if(i[l][_]=int(o*m),n[l][_]>700){var g=int((n[l][_]-700)/1.4),y=p.tt[l][_];i[l][_]=int(o*m),y.block_type==c.SHORT_TYPE&&g<m/2&&(g=m/2),g>3*m/2?g=3*m/2:g<0&&(g=0),i[l][_]+=g}i[l][_]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(i[l][_]=LameInternalFlags.MAX_BITS_PER_CHANNEL),v+=i[l][_]}if(v>LameInternalFlags.MAX_BITS_PER_GRANULE)for(_=0;_<f.channels_out;++_)i[l][_]*=LameInternalFlags.MAX_BITS_PER_GRANULE,i[l][_]/=v}if(f.mode_ext==c.MPG_MD_MS_LR)for(l=0;l<f.mode_gr;l++)d.reduce_side(i[l],r[l],m*f.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(u=0,l=0;l<f.mode_gr;l++)for(_=0;_<f.channels_out;_++)i[l][_]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(i[l][_]=LameInternalFlags.MAX_BITS_PER_CHANNEL),u+=i[l][_];if(u>s[0])for(l=0;l<f.mode_gr;l++)for(_=0;_<f.channels_out;_++)i[l][_]*=s[0],i[l][_]/=u}},Kn}function Sr(){if(er)return Jn;er=1;var e=ir(),t=e.System,n=e.VbrMode;e.Float;var r=e.ShortBlock;e.Util;var i=e.Arrays;e.new_array_n;var a=e.new_byte;e.new_double,e.new_float,e.new_float_n,e.new_int,e.new_int_n;var s=e.assert;function o(){var e,l,_;this.setModules=function(t,n,r){e=t,l=n,_=r};var c=o.NUMTOCENTRIES,u=o.MAXFRAMESIZE,f=c+4+4+4+4+4+9+1+1+8+1+1+3+1+1+2+4+2+2,h="Xing",d="Info",p=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function m(e,t){var n=255&e[t+0];return n<<=8,n|=255&e[t+1],n<<=8,n|=255&e[t+2],n<<=8,n|=255&e[t+3]}function b(e,t,n){e[t+0]=255&n>>24,e[t+1]=255&n>>16,e[t+2]=255&n>>8,e[t+3]=255&n}function v(e,t,n){e[t+0]=255&n>>8,e[t+1]=255&n}function g(e,t,n){return 255&(e<<t|n&~(-1<<t))}function y(t,r){var i=t.internal_flags;r[0]=g(r[0],8,255),r[1]=g(r[1],3,7),r[1]=g(r[1],1,t.out_samplerate<16e3?0:1),r[1]=g(r[1],1,t.version),r[1]=g(r[1],2,1),r[1]=g(r[1],1,t.error_protection?0:1),r[2]=g(r[2],4,i.bitrate_index),r[2]=g(r[2],2,i.samplerate_index),r[2]=g(r[2],1,0),r[2]=g(r[2],1,t.extension),r[3]=g(r[3],2,t.mode.ordinal()),r[3]=g(r[3],2,i.mode_ext),r[3]=g(r[3],1,t.copyright),r[3]=g(r[3],1,t.original),r[3]=g(r[3],2,t.emphasis),r[0]=255;var a,s,o=241&r[1];a=1==t.version?128:t.out_samplerate<16e3?32:64,t.VBR==n.vbr_off&&(a=t.brate),s=t.free_format?0:255&16*e.BitrateIndex(a,t.version,t.out_samplerate),1==t.version?(r[1]=255&o|10,o=13&r[2],r[2]=255&(s|o)):(r[1]=255&o|2,o=13&r[2],r[2]=255&(s|o))}function w(e,t){return t=t>>8^p[255&(t^e)]}this.addVbrFrame=function(e){var t=e.internal_flags,n=Tables.bitrate_table[e.version][t.bitrate_index];s(null!=t.VBR_seek_table.bag),function(e,t){if(e.nVbrNumFrames++,e.sum+=t,e.seen++,!(e.seen<e.want)&&(e.pos<e.size&&(e.bag[e.pos]=e.sum,e.pos++,e.seen=0),e.pos==e.size)){for(var n=1;n<e.size;n+=2)e.bag[n/2]=e.bag[n];e.want*=2,e.pos/=2}}(t.VBR_seek_table,n)},this.getVbrTag=function(e){var t=new VBRTagData,n=0;t.flags=0;var r=e[n+1]>>3&1,i=e[n+2]>>2&3,a=e[n+3]>>6&3,s=e[n+2]>>4&15;if(s=Tables.bitrate_table[r][s],e[n+1]>>4==14?t.samprate=Tables.samplerate_table[2][i]:t.samprate=Tables.samplerate_table[r][i],!function(e,t){return new String(e,t,4(),null).equals(h)||new String(e,t,4(),null).equals(d)}(e,n+=0!=r?3!=a?36:21:3!=a?21:13))return null;n+=4,t.hId=r;var o=t.flags=m(e,n);if(n+=4,1&o&&(t.frames=m(e,n),n+=4),2&o&&(t.bytes=m(e,n),n+=4),4&o){if(null!=t.toc)for(var l=0;l<c;l++)t.toc[l]=e[n+l];n+=c}t.vbrScale=-1,8&o&&(t.vbrScale=m(e,n),n+=4),t.headersize=72e3*(r+1)*s/t.samprate;var _=e[(n+=21)+0]<<4;_+=e[n+1]>>4;var u=(15&e[n+1])<<8;return(_<0||_>3e3)&&(_=-1),((u+=255&e[n+2])<0||u>3e3)&&(u=-1),t.encDelay=_,t.encPadding=u,t},this.InitVbrTag=function(e){var t,r=e.internal_flags;t=1==e.version?128:e.out_samplerate<16e3?32:64,e.VBR==n.vbr_off&&(t=e.brate);var i=72e3*(e.version+1)*t/e.out_samplerate,s=r.sideinfo_len+f;if(r.VBR_seek_table.TotalFrameSize=i,i<s||i>u)e.bWriteVbrTag=!1;else{r.VBR_seek_table.nVbrNumFrames=0,r.VBR_seek_table.nBytesWritten=0,r.VBR_seek_table.sum=0,r.VBR_seek_table.seen=0,r.VBR_seek_table.want=1,r.VBR_seek_table.pos=0,null==r.VBR_seek_table.bag&&(r.VBR_seek_table.bag=new int[400],r.VBR_seek_table.size=400);var o=a(u);y(e,o);for(var _=r.VBR_seek_table.TotalFrameSize,c=0;c<_;++c)l.add_dummy_byte(e,255&o[c],1)}},this.updateMusicCRC=function(e,t,n,r){for(var i=0;i<r;++i)e[0]=w(t[n+i],e[0])},this.getLameTagFrame=function(e,s){var o=e.internal_flags;if(!e.bWriteVbrTag)return 0;if(o.Class_ID!=Lame.LAME_ID)return 0;if(o.VBR_seek_table.pos<=0)return 0;if(s.length<o.VBR_seek_table.TotalFrameSize)return o.VBR_seek_table.TotalFrameSize;i.fill(s,0,o.VBR_seek_table.TotalFrameSize,0),y(e,s);var u=a(c);if(e.free_format)for(var f=1;f<c;++f)u[f]=255&255*f/100;else!function(e,t){if(!(e.pos<=0))for(var n=1;n<c;++n){var r=n/c,i=0|Math.floor(r*e.pos);i>e.pos-1&&(i=e.pos-1);var a=0|256*e.bag[i]/e.sum;a>255&&(a=255),t[n]=255&a}}(o.VBR_seek_table,u);var p=o.sideinfo_len;e.error_protection&&(p-=2),e.VBR==n.vbr_off?(s[p++]=255&d.charAt(0),s[p++]=255&d.charAt(1),s[p++]=255&d.charAt(2),s[p++]=255&d.charAt(3)):(s[p++]=255&h.charAt(0),s[p++]=255&h.charAt(1),s[p++]=255&h.charAt(2),s[p++]=255&h.charAt(3)),b(s,p,15),b(s,p+=4,o.VBR_seek_table.nVbrNumFrames),p+=4;var m=o.VBR_seek_table.nBytesWritten+o.VBR_seek_table.TotalFrameSize;b(s,p,0|m),p+=4,t.arraycopy(u,0,s,p,u.length),p+=u.length,e.error_protection&&l.CRC_writeheader(o,s);var g=0;for(f=0;f<p;f++)g=w(s[f],g);return p+=function(e,t,n,i,a){var s,o,l,c,u,f=e.internal_flags,h=0,d=e.encoder_delay,p=e.encoder_padding,m=100-10*e.VBR_q-e.quality,g=_.getLameVeryShortVersion(),y=[1,5,3,2,4,0,3],S=0|(e.lowpassfreq/100+.5>255?255:e.lowpassfreq/100+.5),A=0,M=0,R=e.internal_flags.noise_shaping,B=0,E=0,k=0,T=!!(1&e.exp_nspsytune),I=!!(2&e.exp_nspsytune),x=!1,P=!1,O=e.internal_flags.nogap_total,L=e.internal_flags.nogap_current,N=e.ATHtype;switch(e.VBR){case vbr_abr:u=e.VBR_mean_bitrate_kbps;break;case vbr_off:u=e.brate;break;default:u=e.VBR_min_bitrate_kbps}switch(s=0+(e.VBR.ordinal()<y.length?y[e.VBR.ordinal()]:0),f.findReplayGain&&(f.RadioGain>510&&(f.RadioGain=510),f.RadioGain<-510&&(f.RadioGain=-510),M=8192,M|=3072,f.RadioGain>=0?M|=f.RadioGain:(M|=512,M|=-f.RadioGain)),f.findPeakSample&&(A=Math.abs(0|f.PeakSample/32767*Math.pow(2,23)+.5)),-1!=O&&(L>0&&(P=!0),L<O-1&&(x=!0)),c=N+((T?1:0)<<4)+((I?1:0)<<5)+((x?1:0)<<6)+((P?1:0)<<7),m<0&&(m=0),e.mode){case MONO:B=0;break;case STEREO:B=1;break;case DUAL_CHANNEL:B=2;break;case JOINT_STEREO:B=e.force_ms?4:3;break;case NOT_SET:default:B=7}k=e.in_samplerate<=32e3?0:48e3==e.in_samplerate?2:e.in_samplerate>48e3?3:1,(e.short_blocks==r.short_block_forced||e.short_blocks==r.short_block_dispensed||-1==e.lowpassfreq&&-1==e.highpassfreq||e.scale_left<e.scale_right||e.scale_left>e.scale_right||e.disable_reservoir&&e.brate<320||e.noATH||e.ATHonly||0==N||e.in_samplerate<=32e3)&&(E=1),o=R+(B<<2)+(E<<5)+(k<<6),l=f.nMusicCRC,b(n,i+h,m),h+=4;for(var V=0;V<9;V++)n[i+h+V]=255&g.charAt(V);n[i+(h+=9)]=255&s,n[i+ ++h]=255&S,b(n,i+ ++h,A),v(n,i+(h+=4),M),v(n,i+(h+=2),0),n[i+(h+=2)]=255&c,n[i+ ++h]=u>=255?255:255&u,n[i+ ++h]=255&d>>4,n[i+h+1]=255&(d<<4)+(p>>8),n[i+h+2]=255&p,n[i+(h+=3)]=255&o,h++,n[i+h++]=0,v(n,i+h,e.preset),b(n,i+(h+=2),t),v(n,i+(h+=4),l),h+=2;for(var C=0;C<h;C++)a=w(n[i+C],a);return v(n,i+h,a),h+2}(e,m,s,p,g),o.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(e,t){if(e.internal_flags.VBR_seek_table.pos<=0)return-1;if(t.seek(t.length()),0==t.length())return-1;var n=function(e){e.seek(0);var t=a(10);return e.readFully(t),new String(t,"ISO-8859-1").startsWith("ID3")?0:((127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9])+t.length}(t);t.seek(n);var r=a(u),i=getLameTagFrame(e,r);return i>r.length?-1:(i<1||t.write(r,0,i),0)}}return o.NUMTOCENTRIES=100,o.MAXFRAMESIZE=2880,Jn=o}var Ar=function(){if(tr)return rr;tr=1;var e=ir();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n;var t=e.new_byte;e.new_double,e.new_float,e.new_float_n,e.new_int,e.new_int_n;var n=e.assert,r=gr(),i=yr(),a=hr(),s=mr(),o=wr(),l=br(),_=function(){if(Wn)return Zn;Wn=1;var e=ir().assert;return Zn=function(){var t;this.setModules=function(e){t=e},this.ResvFrameBegin=function(n,r){var i,a=n.internal_flags,s=a.l3_side,o=t.getframebits(n);r.bits=(o-8*a.sideinfo_len)/a.mode_gr;var l=2048*a.mode_gr-8;n.brate>320?i=8*int(1e3*n.brate/(n.out_samplerate/1152)/8+.5):(i=11520,n.strict_ISO&&(i=8*int(32e4/(n.out_samplerate/1152)/8+.5))),a.ResvMax=i-o,a.ResvMax>l&&(a.ResvMax=l),(a.ResvMax<0||n.disable_reservoir)&&(a.ResvMax=0);var _=r.bits*a.mode_gr+Math.min(a.ResvSize,a.ResvMax);return _>i&&(_=i),e(0==a.ResvMax%8),e(a.ResvMax>=0),s.resvDrain_pre=0,null!=a.pinfo&&(a.pinfo.mean_bits=r.bits/2,a.pinfo.resvsize=a.ResvSize),_},this.ResvMaxBits=function(e,t,n,r){var i,a=e.internal_flags,s=a.ResvSize,o=a.ResvMax;0!=r&&(s+=t),1&a.substep_shaping&&(o*=.9),n.bits=t,10*s>9*o?(i=s-9*o/10,n.bits+=i,a.substep_shaping|=128):(i=0,a.substep_shaping&=127,e.disable_reservoir||1&a.substep_shaping||(n.bits-=.1*t));var l=s<6*a.ResvMax/10?s:6*a.ResvMax/10;return(l-=i)<0&&(l=0),l},this.ResvAdjust=function(e,t){e.ResvSize-=t.part2_3_length+t.part2_length},this.ResvFrameEnd=function(t,n){var r,i=t.l3_side;t.ResvSize+=n*t.mode_gr;var a=0;i.resvDrain_post=0,i.resvDrain_pre=0,0!=(r=t.ResvSize%8)&&(a+=r),(r=t.ResvSize-a-t.ResvMax)>0&&(e(0==r%8),e(r>=0),a+=r);var s=Math.min(8*i.main_data_begin,a)/8;i.resvDrain_pre+=8*s,a-=8*s,t.ResvSize-=8*s,i.main_data_begin-=s,i.resvDrain_post+=a,t.ResvSize-=a}}}(),c=lr(),u=vr();sr();var f=Qn?$n:(Qn=1,$n=function(){this.getLameVersion=function(){return"3.98.4"},this.getLameShortVersion=function(){return"3.98.4"},this.getLameVeryShortVersion=function(){return"LAME3.98r"},this.getPsyVersion=function(){return"0.93"},this.getLameUrl=function(){return"http://www.mp3dev.org/"},this.getLameOsBitness=function(){return"32bits"}}),h=Sr();function d(){this.setModules=function(e,t){}}function p(){this.setModules=function(e,t,n){}}function m(){}function b(){this.setModules=function(e,t){}}function v(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function g(e){return e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3)}return v.RIFF=g("RIFF"),v.WAVE=g("WAVE"),v.fmt_=g("fmt "),v.data=g("data"),v.readHeader=function(e){var t=new v,n=e.getUint32(0,!1);if(v.RIFF==n&&(e.getUint32(4,!0),v.WAVE==e.getUint32(8,!1)&&v.fmt_==e.getUint32(12,!1))){var r=e.getUint32(16,!0),i=20;switch(r){case 16:case 18:t.channels=e.getUint16(i+2,!0),t.sampleRate=e.getUint32(i+4,!0);break;default:throw"extended fmt chunk not implemented"}i+=r;for(var a=v.data,s=0;a!=n&&(n=e.getUint32(i,!1),s=e.getUint32(i+4,!0),a!=n);)i+=s+8;return t.dataLen=s,t.dataOffset=i+8,t}},rr.Mp3Encoder=function(e,v,g){3!=arguments.length&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),e=1,v=44100,g=128);var y=new r,w=new d,S=new a,A=new u,M=new i,R=new s,B=new o,E=new h,k=new f,T=new b,I=new _,x=new l,P=new p,O=new m;y.setModules(S,A,M,R,B,E,k,T,O),A.setModules(S,O,k,E),T.setModules(A,k),M.setModules(y),B.setModules(A,I,R,x),R.setModules(x,I,y.enc.psy),I.setModules(A),x.setModules(R),E.setModules(y,A,k),w.setModules(P,O),P.setModules(k,T,M);var L=y.lame_init();L.num_channels=e,L.in_samplerate=v,L.brate=g,L.mode=c.STEREO,L.quality=3,L.bWriteVbrTag=!1,L.disable_reservoir=!0,L.write_id3tag_automatic=!1;var N=y.lame_init_params(L);n(0==N);var V=1152,C=0|1.25*V+7200,D=t(C);this.encodeBuffer=function(r,i){1==e&&(i=r),n(r.length==i.length),r.length>V&&(V=r.length,D=t(C=0|1.25*V+7200));var a=y.lame_encode_buffer(L,r,i,r.length,D,0,C);return new Int8Array(D.subarray(0,a))},this.flush=function(){var e=y.lame_encode_flush(L,D,0,C);return new Int8Array(D.subarray(0,e))}},rr.WavHeader=v,rr}(),Mr=s(Ar),Rr=s(lr()),Br=s(gr()),Er=s(vr());let kr=class extends Dt{getMetadata(){return Promise.resolve({format:"mp3",implementationType:"custom",supported:!0})}init(){const e="undefined"!=typeof self?self:window;e.MPEGMode=Rr,e.Lame=Br,e.BitStream=Er}encodeAudio(e,t){return n(this,void 0,void 0,function*(){return(yield this.isWebAudioEncoderAPISupportedForSettings(t))?this.encodeWithWebAudioEncoderAPI(e,t):this.encodeMP3LameJS(e,t)})}encodeMP3LameJS(e,t){const n=new Mr.Mp3Encoder(Math.max(2,t.numChannels),t.sampleRate,t.bitrate),i=[],a=r.convertFloat32Array2Int16(e[0]),s=r.convertFloat32Array2Int16(e[1]),o=1152;for(let e=0;e<a.length;e+=o){const t=a.subarray(e,e+o),r=s.subarray(e,e+o),l=n.encodeBuffer(t,r);l.length>0&&i.push(l)}const l=n.flush();return l.length>0&&i.push(l),r.mergeBuffers(i).buffer}};e([(e,t,n)=>{try{p(e.constructor,D,H,(r=t,e=>{if(void 0!==e.lifecycle.postConstructMethodName)throw new X(q.injectionDecoratorConflict,"Unexpected duplicated postConstruct decorator");return e.lifecycle.postConstructMethodName=r,e}))}catch(n){Q(e,t,void 0,n)}var r},t("design:type",Function),t("design:paramtypes",[]),t("design:returntype",void 0)],kr.prototype,"init",null),kr=e([ne()],kr);var Tr=kr;const Ir="audio/wav",xr="audio/mp3";let Pr,Or,Lr,Nr=0,Vr=[];const Cr=function(){const e=new Ot({defaultScope:"Singleton"});return e.bind(i.AudioEncoderManager).to(Ct),e.bind(i.AudioEncoders).to(nr),e.bind(i.AudioEncoders).to(Tr),e}().get(i.AudioEncoderManager),Dr=()=>{for(let e=0;e<Or;e++)Vr[e]=[]},Hr=()=>{const e=[];for(let t=0;t<Or;t++)e.push(r.mergeBuffers(Vr[t]));return e},jr=(e,t)=>n(void 0,void 0,void 0,function*(){const n=yield Cr.encodeAudio(Hr(),{audioLength:Nr,bitrate:Lr,format:e,numChannels:Or,sampleRate:Pr}),r=new Blob([n],{type:t});self.postMessage({command:"exportMP3",data:r})});self.onmessage=function(e){switch(e.data.command){case"init":t=e.data.config,Pr=t.sampleRate,Or=t.numChannels,Lr=t.bitrate||128,Dr();break;case"record":(e=>{for(let t=0;t<Or;t++)Vr[t].push(e[t]);Nr+=e[0].length})(e.data.buffer);break;case"exportWAV":jr("wav",Ir);break;case"exportMP3":jr("mp3",xr);break;case"getBuffer":(()=>{const e=Hr();self.postMessage({command:"getBuffer",data:e})})();break;case"clear":Nr=0,Vr=[],Dr()}var t};
