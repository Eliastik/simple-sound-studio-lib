{"version":3,"file":"SimpleSoundStudioLibrary.js","sources":["../../node_modules/reflect-metadata/Reflect.js","../../node_modules/inversify/es/constants/metadata_keys.js","../../node_modules/inversify/es/constants/literal_types.js","../../node_modules/inversify/es/utils/id.js","../../node_modules/inversify/es/bindings/binding.js","../../node_modules/inversify/es/constants/error_msgs.js","../../node_modules/inversify/es/planning/metadata_reader.js","../../node_modules/inversify/es/bindings/binding_count.js","../../node_modules/inversify/es/utils/exceptions.js","../../node_modules/inversify/es/utils/serialization.js","../../node_modules/inversify/es/planning/context.js","../../node_modules/inversify/es/planning/metadata.js","../../node_modules/inversify/es/planning/plan.js","../../node_modules/inversify/es/annotation/lazy_service_identifier.js","../../node_modules/inversify/es/planning/queryable_string.js","../../node_modules/inversify/es/planning/target.js","../../node_modules/inversify/es/planning/reflection_utils.js","../../node_modules/inversify/es/planning/request.js","../../node_modules/inversify/es/planning/planner.js","../../node_modules/inversify/es/utils/async.js","../../node_modules/inversify/es/scope/scope.js","../../node_modules/inversify/es/utils/factory_type.js","../../node_modules/inversify/es/utils/binding_utils.js","../../node_modules/inversify/es/resolution/instantiation.js","../../node_modules/inversify/es/resolution/resolver.js","../../node_modules/inversify/es/syntax/constraint_helpers.js","../../node_modules/inversify/es/syntax/binding_when_syntax.js","../../node_modules/inversify/es/syntax/binding_on_syntax.js","../../node_modules/inversify/es/syntax/binding_when_on_syntax.js","../../node_modules/inversify/es/syntax/binding_in_syntax.js","../../node_modules/inversify/es/syntax/binding_in_when_on_syntax.js","../../node_modules/inversify/es/syntax/binding_to_syntax.js","../../node_modules/inversify/es/container/container_snapshot.js","../../node_modules/inversify/es/container/lookup.js","../../node_modules/inversify/es/utils/clonable.js","../../node_modules/inversify/es/container/module_activation_store.js","../../node_modules/inversify/es/container/container.js","../../node_modules/inversify/es/annotation/decorator_utils.js","../../node_modules/inversify/es/utils/js.js","../../node_modules/inversify/es/annotation/injectable.js","../../node_modules/inversify/es/annotation/inject_base.js","../../node_modules/inversify/es/annotation/inject.js","../../node_modules/inversify/es/annotation/multi_inject.js","../../lib/inversify.types.ts","../../node_modules/tslib/tslib.es6.js","../../lib/model/EventTypeEnum.ts","../../lib/model/Constants.ts","../../lib/utils/EventEmitter.ts","../../lib/audioEditor/AudioContextManager.ts","../../lib/filters/interfaces/AbstractAudioElement.ts","../../lib/utils/Functions.ts","../../lib/audioEditor/AudioEditor.ts","../../lib/audioEditor/AudioProcessor.ts","../../lib/audioEditor/BufferManager.ts","../../lib/audioEditor/FilterManager.ts","../../lib/audioEditor/RendererManager.ts","../../lib/recorder/getRecorderWorker.ts","../../lib/recorder/Recorder.ts","../../lib/audioEditor/SaveBufferManager.ts","../../lib/bufferPlayer/BufferPlayer.ts","../../lib/services/BufferFetcherService.ts","../../lib/services/BufferDecoderService.ts","../../lib/filters/interfaces/AbstractAudioRenderer.ts","../../lib/filters/interfaces/AbstractAudioFilter.ts","../../lib/workletPolyfill/AudioParamPolyfill.ts","../../lib/workletPolyfill/WorkletScriptProcessorNodeAdapter.ts","../../lib/workletPolyfill/RegisterProcessorPolyfill.ts","../../lib/workletPolyfill/SimpleAudioWorkletProcessor.ts","../../lib/workletPolyfill/AudioWorkletProcessorPolyfill.ts","../../lib/filters/interfaces/AbstractAudioFilterWorklet.ts","../../lib/filters/worklets/BitCrusher.worklet.ts","../../lib/utils/DelayBuffer.ts","../../lib/filters/worklets/Limiter.worklet.ts","../../node_modules/soundtouchjs/dist/soundtouch.js","../../lib/filters/worklets/SoundtouchWrapperFilterWorkletNode.ts","../../lib/utils/Vocoder.ts","../../lib/filters/worklets/Passthrough.worklet.ts","../../lib/utils/TimerSaveTime.ts","../../lib/voiceRecorder/VoiceRecorder.ts","../../lib/inversify.config.ts","../../lib/filters/SountouchWrapperFilter.ts","../../lib/filters/ReturnAudioRenderer.ts","../../lib/filters/BassBoosterFilter.ts","../../lib/filters/BitCrusherFilter.ts","../../lib/filters/EchoFilter.ts","../../lib/filters/HighPassFilter.ts","../../lib/filters/LimiterFilter.ts","../../lib/filters/LowPassFilter.ts","../../lib/filters/ReverbFilter.ts","../../lib/filters/TelephonizerFilter.ts","../../lib/filters/VocoderFilter.ts","../../lib/filters/PassThroughFilter.ts","../../lib/services/GenericConfigService.ts","../../lib/utils/SoundStudioFactory.ts"],"sourcesContent":["/*! *****************************************************************************\nCopyright (C) Microsoft. All rights reserved.\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\nthis file except in compliance with the License. You may obtain a copy of the\nLicense at http://www.apache.org/licenses/LICENSE-2.0\n\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\nMERCHANTABLITY OR NON-INFRINGEMENT.\n\nSee the Apache Version 2.0 License for specific language governing permissions\nand limitations under the License.\n***************************************************************************** */\nvar Reflect;\n(function (Reflect) {\n    // Metadata Proposal\n    // https://rbuckton.github.io/reflect-metadata/\n    (function (factory) {\n        var root = typeof globalThis === \"object\" ? globalThis :\n            typeof global === \"object\" ? global :\n                typeof self === \"object\" ? self :\n                    typeof this === \"object\" ? this :\n                        sloppyModeThis();\n        var exporter = makeExporter(Reflect);\n        if (typeof root.Reflect !== \"undefined\") {\n            exporter = makeExporter(root.Reflect, exporter);\n        }\n        factory(exporter, root);\n        if (typeof root.Reflect === \"undefined\") {\n            root.Reflect = Reflect;\n        }\n        function makeExporter(target, previous) {\n            return function (key, value) {\n                Object.defineProperty(target, key, { configurable: true, writable: true, value: value });\n                if (previous)\n                    previous(key, value);\n            };\n        }\n        function functionThis() {\n            try {\n                return Function(\"return this;\")();\n            }\n            catch (_) { }\n        }\n        function indirectEvalThis() {\n            try {\n                return (void 0, eval)(\"(function() { return this; })()\");\n            }\n            catch (_) { }\n        }\n        function sloppyModeThis() {\n            return functionThis() || indirectEvalThis();\n        }\n    })(function (exporter, root) {\n        var hasOwn = Object.prototype.hasOwnProperty;\n        // feature test for Symbol support\n        var supportsSymbol = typeof Symbol === \"function\";\n        var toPrimitiveSymbol = supportsSymbol && typeof Symbol.toPrimitive !== \"undefined\" ? Symbol.toPrimitive : \"@@toPrimitive\";\n        var iteratorSymbol = supportsSymbol && typeof Symbol.iterator !== \"undefined\" ? Symbol.iterator : \"@@iterator\";\n        var supportsCreate = typeof Object.create === \"function\"; // feature test for Object.create support\n        var supportsProto = { __proto__: [] } instanceof Array; // feature test for __proto__ support\n        var downLevel = !supportsCreate && !supportsProto;\n        var HashMap = {\n            // create an object in dictionary mode (a.k.a. \"slow\" mode in v8)\n            create: supportsCreate\n                ? function () { return MakeDictionary(Object.create(null)); }\n                : supportsProto\n                    ? function () { return MakeDictionary({ __proto__: null }); }\n                    : function () { return MakeDictionary({}); },\n            has: downLevel\n                ? function (map, key) { return hasOwn.call(map, key); }\n                : function (map, key) { return key in map; },\n            get: downLevel\n                ? function (map, key) { return hasOwn.call(map, key) ? map[key] : undefined; }\n                : function (map, key) { return map[key]; },\n        };\n        // Load global or shim versions of Map, Set, and WeakMap\n        var functionPrototype = Object.getPrototypeOf(Function);\n        var _Map = typeof Map === \"function\" && typeof Map.prototype.entries === \"function\" ? Map : CreateMapPolyfill();\n        var _Set = typeof Set === \"function\" && typeof Set.prototype.entries === \"function\" ? Set : CreateSetPolyfill();\n        var _WeakMap = typeof WeakMap === \"function\" ? WeakMap : CreateWeakMapPolyfill();\n        var registrySymbol = supportsSymbol ? Symbol.for(\"@reflect-metadata:registry\") : undefined;\n        var metadataRegistry = GetOrCreateMetadataRegistry();\n        var metadataProvider = CreateMetadataProvider(metadataRegistry);\n        /**\n         * Applies a set of decorators to a property of a target object.\n         * @param decorators An array of decorators.\n         * @param target The target object.\n         * @param propertyKey (Optional) The property key to decorate.\n         * @param attributes (Optional) The property descriptor for the target key.\n         * @remarks Decorators are applied in reverse order.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     Example = Reflect.decorate(decoratorsArray, Example);\n         *\n         *     // property (on constructor)\n         *     Reflect.decorate(decoratorsArray, Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     Reflect.decorate(decoratorsArray, Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     Object.defineProperty(Example, \"staticMethod\",\n         *         Reflect.decorate(decoratorsArray, Example, \"staticMethod\",\n         *             Object.getOwnPropertyDescriptor(Example, \"staticMethod\")));\n         *\n         *     // method (on prototype)\n         *     Object.defineProperty(Example.prototype, \"method\",\n         *         Reflect.decorate(decoratorsArray, Example.prototype, \"method\",\n         *             Object.getOwnPropertyDescriptor(Example.prototype, \"method\")));\n         *\n         */\n        function decorate(decorators, target, propertyKey, attributes) {\n            if (!IsUndefined(propertyKey)) {\n                if (!IsArray(decorators))\n                    throw new TypeError();\n                if (!IsObject(target))\n                    throw new TypeError();\n                if (!IsObject(attributes) && !IsUndefined(attributes) && !IsNull(attributes))\n                    throw new TypeError();\n                if (IsNull(attributes))\n                    attributes = undefined;\n                propertyKey = ToPropertyKey(propertyKey);\n                return DecorateProperty(decorators, target, propertyKey, attributes);\n            }\n            else {\n                if (!IsArray(decorators))\n                    throw new TypeError();\n                if (!IsConstructor(target))\n                    throw new TypeError();\n                return DecorateConstructor(decorators, target);\n            }\n        }\n        exporter(\"decorate\", decorate);\n        // 4.1.2 Reflect.metadata(metadataKey, metadataValue)\n        // https://rbuckton.github.io/reflect-metadata/#reflect.metadata\n        /**\n         * A default metadata decorator factory that can be used on a class, class member, or parameter.\n         * @param metadataKey The key for the metadata entry.\n         * @param metadataValue The value for the metadata entry.\n         * @returns A decorator function.\n         * @remarks\n         * If `metadataKey` is already defined for the target and target key, the\n         * metadataValue for that key will be overwritten.\n         * @example\n         *\n         *     // constructor\n         *     @Reflect.metadata(key, value)\n         *     class Example {\n         *     }\n         *\n         *     // property (on constructor, TypeScript only)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         static staticProperty;\n         *     }\n         *\n         *     // property (on prototype, TypeScript only)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         property;\n         *     }\n         *\n         *     // method (on constructor)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         static staticMethod() { }\n         *     }\n         *\n         *     // method (on prototype)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         method() { }\n         *     }\n         *\n         */\n        function metadata(metadataKey, metadataValue) {\n            function decorator(target, propertyKey) {\n                if (!IsObject(target))\n                    throw new TypeError();\n                if (!IsUndefined(propertyKey) && !IsPropertyKey(propertyKey))\n                    throw new TypeError();\n                OrdinaryDefineOwnMetadata(metadataKey, metadataValue, target, propertyKey);\n            }\n            return decorator;\n        }\n        exporter(\"metadata\", metadata);\n        /**\n         * Define a unique metadata entry on the target.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param metadataValue A value that contains attached metadata.\n         * @param target The target object on which to define metadata.\n         * @param propertyKey (Optional) The property key for the target.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example);\n         *\n         *     // property (on constructor)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example.prototype, \"method\");\n         *\n         *     // decorator factory as metadata-producing annotation.\n         *     function MyAnnotation(options): Decorator {\n         *         return (target, key?) => Reflect.defineMetadata(\"custom:annotation\", options, target, key);\n         *     }\n         *\n         */\n        function defineMetadata(metadataKey, metadataValue, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryDefineOwnMetadata(metadataKey, metadataValue, target, propertyKey);\n        }\n        exporter(\"defineMetadata\", defineMetadata);\n        /**\n         * Gets a value indicating whether the target object or its prototype chain has the provided metadata key defined.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns `true` if the metadata key was defined on the target object or its prototype chain; otherwise, `false`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function hasMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryHasMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"hasMetadata\", hasMetadata);\n        /**\n         * Gets a value indicating whether the target object has the provided metadata key defined.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns `true` if the metadata key was defined on the target object; otherwise, `false`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function hasOwnMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryHasOwnMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"hasOwnMetadata\", hasOwnMetadata);\n        /**\n         * Gets the metadata value for the provided metadata key on the target object or its prototype chain.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns The metadata value for the metadata key if found; otherwise, `undefined`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function getMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryGetMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"getMetadata\", getMetadata);\n        /**\n         * Gets the metadata value for the provided metadata key on the target object.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns The metadata value for the metadata key if found; otherwise, `undefined`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function getOwnMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryGetOwnMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"getOwnMetadata\", getOwnMetadata);\n        /**\n         * Gets the metadata keys defined on the target object or its prototype chain.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns An array of unique metadata keys.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getMetadataKeys(Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getMetadataKeys(Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getMetadataKeys(Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getMetadataKeys(Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getMetadataKeys(Example.prototype, \"method\");\n         *\n         */\n        function getMetadataKeys(target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryMetadataKeys(target, propertyKey);\n        }\n        exporter(\"getMetadataKeys\", getMetadataKeys);\n        /**\n         * Gets the unique metadata keys defined on the target object.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns An array of unique metadata keys.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getOwnMetadataKeys(Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getOwnMetadataKeys(Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getOwnMetadataKeys(Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getOwnMetadataKeys(Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getOwnMetadataKeys(Example.prototype, \"method\");\n         *\n         */\n        function getOwnMetadataKeys(target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryOwnMetadataKeys(target, propertyKey);\n        }\n        exporter(\"getOwnMetadataKeys\", getOwnMetadataKeys);\n        /**\n         * Deletes the metadata entry from the target object with the provided key.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns `true` if the metadata entry was found and deleted; otherwise, false.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function deleteMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            var provider = GetMetadataProvider(target, propertyKey, /*Create*/ false);\n            if (IsUndefined(provider))\n                return false;\n            return provider.OrdinaryDeleteMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"deleteMetadata\", deleteMetadata);\n        function DecorateConstructor(decorators, target) {\n            for (var i = decorators.length - 1; i >= 0; --i) {\n                var decorator = decorators[i];\n                var decorated = decorator(target);\n                if (!IsUndefined(decorated) && !IsNull(decorated)) {\n                    if (!IsConstructor(decorated))\n                        throw new TypeError();\n                    target = decorated;\n                }\n            }\n            return target;\n        }\n        function DecorateProperty(decorators, target, propertyKey, descriptor) {\n            for (var i = decorators.length - 1; i >= 0; --i) {\n                var decorator = decorators[i];\n                var decorated = decorator(target, propertyKey, descriptor);\n                if (!IsUndefined(decorated) && !IsNull(decorated)) {\n                    if (!IsObject(decorated))\n                        throw new TypeError();\n                    descriptor = decorated;\n                }\n            }\n            return descriptor;\n        }\n        // 3.1.1.1 OrdinaryHasMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryhasmetadata\n        function OrdinaryHasMetadata(MetadataKey, O, P) {\n            var hasOwn = OrdinaryHasOwnMetadata(MetadataKey, O, P);\n            if (hasOwn)\n                return true;\n            var parent = OrdinaryGetPrototypeOf(O);\n            if (!IsNull(parent))\n                return OrdinaryHasMetadata(MetadataKey, parent, P);\n            return false;\n        }\n        // 3.1.2.1 OrdinaryHasOwnMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryhasownmetadata\n        function OrdinaryHasOwnMetadata(MetadataKey, O, P) {\n            var provider = GetMetadataProvider(O, P, /*Create*/ false);\n            if (IsUndefined(provider))\n                return false;\n            return ToBoolean(provider.OrdinaryHasOwnMetadata(MetadataKey, O, P));\n        }\n        // 3.1.3.1 OrdinaryGetMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarygetmetadata\n        function OrdinaryGetMetadata(MetadataKey, O, P) {\n            var hasOwn = OrdinaryHasOwnMetadata(MetadataKey, O, P);\n            if (hasOwn)\n                return OrdinaryGetOwnMetadata(MetadataKey, O, P);\n            var parent = OrdinaryGetPrototypeOf(O);\n            if (!IsNull(parent))\n                return OrdinaryGetMetadata(MetadataKey, parent, P);\n            return undefined;\n        }\n        // 3.1.4.1 OrdinaryGetOwnMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarygetownmetadata\n        function OrdinaryGetOwnMetadata(MetadataKey, O, P) {\n            var provider = GetMetadataProvider(O, P, /*Create*/ false);\n            if (IsUndefined(provider))\n                return;\n            return provider.OrdinaryGetOwnMetadata(MetadataKey, O, P);\n        }\n        // 3.1.5.1 OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarydefineownmetadata\n        function OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P) {\n            var provider = GetMetadataProvider(O, P, /*Create*/ true);\n            provider.OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P);\n        }\n        // 3.1.6.1 OrdinaryMetadataKeys(O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarymetadatakeys\n        function OrdinaryMetadataKeys(O, P) {\n            var ownKeys = OrdinaryOwnMetadataKeys(O, P);\n            var parent = OrdinaryGetPrototypeOf(O);\n            if (parent === null)\n                return ownKeys;\n            var parentKeys = OrdinaryMetadataKeys(parent, P);\n            if (parentKeys.length <= 0)\n                return ownKeys;\n            if (ownKeys.length <= 0)\n                return parentKeys;\n            var set = new _Set();\n            var keys = [];\n            for (var _i = 0, ownKeys_1 = ownKeys; _i < ownKeys_1.length; _i++) {\n                var key = ownKeys_1[_i];\n                var hasKey = set.has(key);\n                if (!hasKey) {\n                    set.add(key);\n                    keys.push(key);\n                }\n            }\n            for (var _a = 0, parentKeys_1 = parentKeys; _a < parentKeys_1.length; _a++) {\n                var key = parentKeys_1[_a];\n                var hasKey = set.has(key);\n                if (!hasKey) {\n                    set.add(key);\n                    keys.push(key);\n                }\n            }\n            return keys;\n        }\n        // 3.1.7.1 OrdinaryOwnMetadataKeys(O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryownmetadatakeys\n        function OrdinaryOwnMetadataKeys(O, P) {\n            var provider = GetMetadataProvider(O, P, /*create*/ false);\n            if (!provider) {\n                return [];\n            }\n            return provider.OrdinaryOwnMetadataKeys(O, P);\n        }\n        // 6 ECMAScript Data Types and Values\n        // https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values\n        function Type(x) {\n            if (x === null)\n                return 1 /* Null */;\n            switch (typeof x) {\n                case \"undefined\": return 0 /* Undefined */;\n                case \"boolean\": return 2 /* Boolean */;\n                case \"string\": return 3 /* String */;\n                case \"symbol\": return 4 /* Symbol */;\n                case \"number\": return 5 /* Number */;\n                case \"object\": return x === null ? 1 /* Null */ : 6 /* Object */;\n                default: return 6 /* Object */;\n            }\n        }\n        // 6.1.1 The Undefined Type\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-undefined-type\n        function IsUndefined(x) {\n            return x === undefined;\n        }\n        // 6.1.2 The Null Type\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-null-type\n        function IsNull(x) {\n            return x === null;\n        }\n        // 6.1.5 The Symbol Type\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-symbol-type\n        function IsSymbol(x) {\n            return typeof x === \"symbol\";\n        }\n        // 6.1.7 The Object Type\n        // https://tc39.github.io/ecma262/#sec-object-type\n        function IsObject(x) {\n            return typeof x === \"object\" ? x !== null : typeof x === \"function\";\n        }\n        // 7.1 Type Conversion\n        // https://tc39.github.io/ecma262/#sec-type-conversion\n        // 7.1.1 ToPrimitive(input [, PreferredType])\n        // https://tc39.github.io/ecma262/#sec-toprimitive\n        function ToPrimitive(input, PreferredType) {\n            switch (Type(input)) {\n                case 0 /* Undefined */: return input;\n                case 1 /* Null */: return input;\n                case 2 /* Boolean */: return input;\n                case 3 /* String */: return input;\n                case 4 /* Symbol */: return input;\n                case 5 /* Number */: return input;\n            }\n            var hint = PreferredType === 3 /* String */ ? \"string\" : PreferredType === 5 /* Number */ ? \"number\" : \"default\";\n            var exoticToPrim = GetMethod(input, toPrimitiveSymbol);\n            if (exoticToPrim !== undefined) {\n                var result = exoticToPrim.call(input, hint);\n                if (IsObject(result))\n                    throw new TypeError();\n                return result;\n            }\n            return OrdinaryToPrimitive(input, hint === \"default\" ? \"number\" : hint);\n        }\n        // 7.1.1.1 OrdinaryToPrimitive(O, hint)\n        // https://tc39.github.io/ecma262/#sec-ordinarytoprimitive\n        function OrdinaryToPrimitive(O, hint) {\n            if (hint === \"string\") {\n                var toString_1 = O.toString;\n                if (IsCallable(toString_1)) {\n                    var result = toString_1.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n                var valueOf = O.valueOf;\n                if (IsCallable(valueOf)) {\n                    var result = valueOf.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n            }\n            else {\n                var valueOf = O.valueOf;\n                if (IsCallable(valueOf)) {\n                    var result = valueOf.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n                var toString_2 = O.toString;\n                if (IsCallable(toString_2)) {\n                    var result = toString_2.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n            }\n            throw new TypeError();\n        }\n        // 7.1.2 ToBoolean(argument)\n        // https://tc39.github.io/ecma262/2016/#sec-toboolean\n        function ToBoolean(argument) {\n            return !!argument;\n        }\n        // 7.1.12 ToString(argument)\n        // https://tc39.github.io/ecma262/#sec-tostring\n        function ToString(argument) {\n            return \"\" + argument;\n        }\n        // 7.1.14 ToPropertyKey(argument)\n        // https://tc39.github.io/ecma262/#sec-topropertykey\n        function ToPropertyKey(argument) {\n            var key = ToPrimitive(argument, 3 /* String */);\n            if (IsSymbol(key))\n                return key;\n            return ToString(key);\n        }\n        // 7.2 Testing and Comparison Operations\n        // https://tc39.github.io/ecma262/#sec-testing-and-comparison-operations\n        // 7.2.2 IsArray(argument)\n        // https://tc39.github.io/ecma262/#sec-isarray\n        function IsArray(argument) {\n            return Array.isArray\n                ? Array.isArray(argument)\n                : argument instanceof Object\n                    ? argument instanceof Array\n                    : Object.prototype.toString.call(argument) === \"[object Array]\";\n        }\n        // 7.2.3 IsCallable(argument)\n        // https://tc39.github.io/ecma262/#sec-iscallable\n        function IsCallable(argument) {\n            // NOTE: This is an approximation as we cannot check for [[Call]] internal method.\n            return typeof argument === \"function\";\n        }\n        // 7.2.4 IsConstructor(argument)\n        // https://tc39.github.io/ecma262/#sec-isconstructor\n        function IsConstructor(argument) {\n            // NOTE: This is an approximation as we cannot check for [[Construct]] internal method.\n            return typeof argument === \"function\";\n        }\n        // 7.2.7 IsPropertyKey(argument)\n        // https://tc39.github.io/ecma262/#sec-ispropertykey\n        function IsPropertyKey(argument) {\n            switch (Type(argument)) {\n                case 3 /* String */: return true;\n                case 4 /* Symbol */: return true;\n                default: return false;\n            }\n        }\n        function SameValueZero(x, y) {\n            return x === y || x !== x && y !== y;\n        }\n        // 7.3 Operations on Objects\n        // https://tc39.github.io/ecma262/#sec-operations-on-objects\n        // 7.3.9 GetMethod(V, P)\n        // https://tc39.github.io/ecma262/#sec-getmethod\n        function GetMethod(V, P) {\n            var func = V[P];\n            if (func === undefined || func === null)\n                return undefined;\n            if (!IsCallable(func))\n                throw new TypeError();\n            return func;\n        }\n        // 7.4 Operations on Iterator Objects\n        // https://tc39.github.io/ecma262/#sec-operations-on-iterator-objects\n        function GetIterator(obj) {\n            var method = GetMethod(obj, iteratorSymbol);\n            if (!IsCallable(method))\n                throw new TypeError(); // from Call\n            var iterator = method.call(obj);\n            if (!IsObject(iterator))\n                throw new TypeError();\n            return iterator;\n        }\n        // 7.4.4 IteratorValue(iterResult)\n        // https://tc39.github.io/ecma262/2016/#sec-iteratorvalue\n        function IteratorValue(iterResult) {\n            return iterResult.value;\n        }\n        // 7.4.5 IteratorStep(iterator)\n        // https://tc39.github.io/ecma262/#sec-iteratorstep\n        function IteratorStep(iterator) {\n            var result = iterator.next();\n            return result.done ? false : result;\n        }\n        // 7.4.6 IteratorClose(iterator, completion)\n        // https://tc39.github.io/ecma262/#sec-iteratorclose\n        function IteratorClose(iterator) {\n            var f = iterator[\"return\"];\n            if (f)\n                f.call(iterator);\n        }\n        // 9.1 Ordinary Object Internal Methods and Internal Slots\n        // https://tc39.github.io/ecma262/#sec-ordinary-object-internal-methods-and-internal-slots\n        // 9.1.1.1 OrdinaryGetPrototypeOf(O)\n        // https://tc39.github.io/ecma262/#sec-ordinarygetprototypeof\n        function OrdinaryGetPrototypeOf(O) {\n            var proto = Object.getPrototypeOf(O);\n            if (typeof O !== \"function\" || O === functionPrototype)\n                return proto;\n            // TypeScript doesn't set __proto__ in ES5, as it's non-standard.\n            // Try to determine the superclass constructor. Compatible implementations\n            // must either set __proto__ on a subclass constructor to the superclass constructor,\n            // or ensure each class has a valid `constructor` property on its prototype that\n            // points back to the constructor.\n            // If this is not the same as Function.[[Prototype]], then this is definately inherited.\n            // This is the case when in ES6 or when using __proto__ in a compatible browser.\n            if (proto !== functionPrototype)\n                return proto;\n            // If the super prototype is Object.prototype, null, or undefined, then we cannot determine the heritage.\n            var prototype = O.prototype;\n            var prototypeProto = prototype && Object.getPrototypeOf(prototype);\n            if (prototypeProto == null || prototypeProto === Object.prototype)\n                return proto;\n            // If the constructor was not a function, then we cannot determine the heritage.\n            var constructor = prototypeProto.constructor;\n            if (typeof constructor !== \"function\")\n                return proto;\n            // If we have some kind of self-reference, then we cannot determine the heritage.\n            if (constructor === O)\n                return proto;\n            // we have a pretty good guess at the heritage.\n            return constructor;\n        }\n        // Global metadata registry\n        // - Allows `import \"reflect-metadata\"` and `import \"reflect-metadata/no-conflict\"` to interoperate.\n        // - Uses isolated metadata if `Reflect` is frozen before the registry can be installed.\n        /**\n         * Creates a registry used to allow multiple `reflect-metadata` providers.\n         */\n        function CreateMetadataRegistry() {\n            var fallback;\n            if (!IsUndefined(registrySymbol) &&\n                typeof root.Reflect !== \"undefined\" &&\n                !(registrySymbol in root.Reflect) &&\n                typeof root.Reflect.defineMetadata === \"function\") {\n                // interoperate with older version of `reflect-metadata` that did not support a registry.\n                fallback = CreateFallbackProvider(root.Reflect);\n            }\n            var first;\n            var second;\n            var rest;\n            var targetProviderMap = new _WeakMap();\n            var registry = {\n                registerProvider: registerProvider,\n                getProvider: getProvider,\n                setProvider: setProvider,\n            };\n            return registry;\n            function registerProvider(provider) {\n                if (!Object.isExtensible(registry)) {\n                    throw new Error(\"Cannot add provider to a frozen registry.\");\n                }\n                switch (true) {\n                    case fallback === provider: break;\n                    case IsUndefined(first):\n                        first = provider;\n                        break;\n                    case first === provider: break;\n                    case IsUndefined(second):\n                        second = provider;\n                        break;\n                    case second === provider: break;\n                    default:\n                        if (rest === undefined)\n                            rest = new _Set();\n                        rest.add(provider);\n                        break;\n                }\n            }\n            function getProviderNoCache(O, P) {\n                if (!IsUndefined(first)) {\n                    if (first.isProviderFor(O, P))\n                        return first;\n                    if (!IsUndefined(second)) {\n                        if (second.isProviderFor(O, P))\n                            return first;\n                        if (!IsUndefined(rest)) {\n                            var iterator = GetIterator(rest);\n                            while (true) {\n                                var next = IteratorStep(iterator);\n                                if (!next) {\n                                    return undefined;\n                                }\n                                var provider = IteratorValue(next);\n                                if (provider.isProviderFor(O, P)) {\n                                    IteratorClose(iterator);\n                                    return provider;\n                                }\n                            }\n                        }\n                    }\n                }\n                if (!IsUndefined(fallback) && fallback.isProviderFor(O, P)) {\n                    return fallback;\n                }\n                return undefined;\n            }\n            function getProvider(O, P) {\n                var providerMap = targetProviderMap.get(O);\n                var provider;\n                if (!IsUndefined(providerMap)) {\n                    provider = providerMap.get(P);\n                }\n                if (!IsUndefined(provider)) {\n                    return provider;\n                }\n                provider = getProviderNoCache(O, P);\n                if (!IsUndefined(provider)) {\n                    if (IsUndefined(providerMap)) {\n                        providerMap = new _Map();\n                        targetProviderMap.set(O, providerMap);\n                    }\n                    providerMap.set(P, provider);\n                }\n                return provider;\n            }\n            function hasProvider(provider) {\n                if (IsUndefined(provider))\n                    throw new TypeError();\n                return first === provider || second === provider || !IsUndefined(rest) && rest.has(provider);\n            }\n            function setProvider(O, P, provider) {\n                if (!hasProvider(provider)) {\n                    throw new Error(\"Metadata provider not registered.\");\n                }\n                var existingProvider = getProvider(O, P);\n                if (existingProvider !== provider) {\n                    if (!IsUndefined(existingProvider)) {\n                        return false;\n                    }\n                    var providerMap = targetProviderMap.get(O);\n                    if (IsUndefined(providerMap)) {\n                        providerMap = new _Map();\n                        targetProviderMap.set(O, providerMap);\n                    }\n                    providerMap.set(P, provider);\n                }\n                return true;\n            }\n        }\n        /**\n         * Gets or creates the shared registry of metadata providers.\n         */\n        function GetOrCreateMetadataRegistry() {\n            var metadataRegistry;\n            if (!IsUndefined(registrySymbol) && IsObject(root.Reflect) && Object.isExtensible(root.Reflect)) {\n                metadataRegistry = root.Reflect[registrySymbol];\n            }\n            if (IsUndefined(metadataRegistry)) {\n                metadataRegistry = CreateMetadataRegistry();\n            }\n            if (!IsUndefined(registrySymbol) && IsObject(root.Reflect) && Object.isExtensible(root.Reflect)) {\n                Object.defineProperty(root.Reflect, registrySymbol, {\n                    enumerable: false,\n                    configurable: false,\n                    writable: false,\n                    value: metadataRegistry\n                });\n            }\n            return metadataRegistry;\n        }\n        function CreateMetadataProvider(registry) {\n            // [[Metadata]] internal slot\n            // https://rbuckton.github.io/reflect-metadata/#ordinary-object-internal-methods-and-internal-slots\n            var metadata = new _WeakMap();\n            var provider = {\n                isProviderFor: function (O, P) {\n                    var targetMetadata = metadata.get(O);\n                    if (IsUndefined(targetMetadata))\n                        return false;\n                    return targetMetadata.has(P);\n                },\n                OrdinaryDefineOwnMetadata: OrdinaryDefineOwnMetadata,\n                OrdinaryHasOwnMetadata: OrdinaryHasOwnMetadata,\n                OrdinaryGetOwnMetadata: OrdinaryGetOwnMetadata,\n                OrdinaryOwnMetadataKeys: OrdinaryOwnMetadataKeys,\n                OrdinaryDeleteMetadata: OrdinaryDeleteMetadata,\n            };\n            metadataRegistry.registerProvider(provider);\n            return provider;\n            function GetOrCreateMetadataMap(O, P, Create) {\n                var targetMetadata = metadata.get(O);\n                var createdTargetMetadata = false;\n                if (IsUndefined(targetMetadata)) {\n                    if (!Create)\n                        return undefined;\n                    targetMetadata = new _Map();\n                    metadata.set(O, targetMetadata);\n                    createdTargetMetadata = true;\n                }\n                var metadataMap = targetMetadata.get(P);\n                if (IsUndefined(metadataMap)) {\n                    if (!Create)\n                        return undefined;\n                    metadataMap = new _Map();\n                    targetMetadata.set(P, metadataMap);\n                    if (!registry.setProvider(O, P, provider)) {\n                        targetMetadata.delete(P);\n                        if (createdTargetMetadata) {\n                            metadata.delete(O);\n                        }\n                        throw new Error(\"Wrong provider for target.\");\n                    }\n                }\n                return metadataMap;\n            }\n            // 3.1.2.1 OrdinaryHasOwnMetadata(MetadataKey, O, P)\n            // https://rbuckton.github.io/reflect-metadata/#ordinaryhasownmetadata\n            function OrdinaryHasOwnMetadata(MetadataKey, O, P) {\n                var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n                if (IsUndefined(metadataMap))\n                    return false;\n                return ToBoolean(metadataMap.has(MetadataKey));\n            }\n            // 3.1.4.1 OrdinaryGetOwnMetadata(MetadataKey, O, P)\n            // https://rbuckton.github.io/reflect-metadata/#ordinarygetownmetadata\n            function OrdinaryGetOwnMetadata(MetadataKey, O, P) {\n                var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n                if (IsUndefined(metadataMap))\n                    return undefined;\n                return metadataMap.get(MetadataKey);\n            }\n            // 3.1.5.1 OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P)\n            // https://rbuckton.github.io/reflect-metadata/#ordinarydefineownmetadata\n            function OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P) {\n                var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ true);\n                metadataMap.set(MetadataKey, MetadataValue);\n            }\n            // 3.1.7.1 OrdinaryOwnMetadataKeys(O, P)\n            // https://rbuckton.github.io/reflect-metadata/#ordinaryownmetadatakeys\n            function OrdinaryOwnMetadataKeys(O, P) {\n                var keys = [];\n                var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n                if (IsUndefined(metadataMap))\n                    return keys;\n                var keysObj = metadataMap.keys();\n                var iterator = GetIterator(keysObj);\n                var k = 0;\n                while (true) {\n                    var next = IteratorStep(iterator);\n                    if (!next) {\n                        keys.length = k;\n                        return keys;\n                    }\n                    var nextValue = IteratorValue(next);\n                    try {\n                        keys[k] = nextValue;\n                    }\n                    catch (e) {\n                        try {\n                            IteratorClose(iterator);\n                        }\n                        finally {\n                            throw e;\n                        }\n                    }\n                    k++;\n                }\n            }\n            function OrdinaryDeleteMetadata(MetadataKey, O, P) {\n                var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n                if (IsUndefined(metadataMap))\n                    return false;\n                if (!metadataMap.delete(MetadataKey))\n                    return false;\n                if (metadataMap.size === 0) {\n                    var targetMetadata = metadata.get(O);\n                    if (!IsUndefined(targetMetadata)) {\n                        targetMetadata.delete(P);\n                        if (targetMetadata.size === 0) {\n                            metadata.delete(targetMetadata);\n                        }\n                    }\n                }\n                return true;\n            }\n        }\n        function CreateFallbackProvider(reflect) {\n            var defineMetadata = reflect.defineMetadata, hasOwnMetadata = reflect.hasOwnMetadata, getOwnMetadata = reflect.getOwnMetadata, getOwnMetadataKeys = reflect.getOwnMetadataKeys, deleteMetadata = reflect.deleteMetadata;\n            var metadataOwner = new _WeakMap();\n            var provider = {\n                isProviderFor: function (O, P) {\n                    var metadataPropertySet = metadataOwner.get(O);\n                    if (!IsUndefined(metadataPropertySet) && metadataPropertySet.has(P)) {\n                        return true;\n                    }\n                    if (getOwnMetadataKeys(O, P).length) {\n                        if (IsUndefined(metadataPropertySet)) {\n                            metadataPropertySet = new _Set();\n                            metadataOwner.set(O, metadataPropertySet);\n                        }\n                        metadataPropertySet.add(P);\n                        return true;\n                    }\n                    return false;\n                },\n                OrdinaryDefineOwnMetadata: defineMetadata,\n                OrdinaryHasOwnMetadata: hasOwnMetadata,\n                OrdinaryGetOwnMetadata: getOwnMetadata,\n                OrdinaryOwnMetadataKeys: getOwnMetadataKeys,\n                OrdinaryDeleteMetadata: deleteMetadata,\n            };\n            return provider;\n        }\n        /**\n         * Gets the metadata provider for an object. If the object has no metadata provider and this is for a create operation,\n         * then this module's metadata provider is assigned to the object.\n         */\n        function GetMetadataProvider(O, P, Create) {\n            var registeredProvider = metadataRegistry.getProvider(O, P);\n            if (!IsUndefined(registeredProvider)) {\n                return registeredProvider;\n            }\n            if (Create) {\n                if (metadataRegistry.setProvider(O, P, metadataProvider)) {\n                    return metadataProvider;\n                }\n                throw new Error(\"Illegal state.\");\n            }\n            return undefined;\n        }\n        // naive Map shim\n        function CreateMapPolyfill() {\n            var cacheSentinel = {};\n            var arraySentinel = [];\n            var MapIterator = /** @class */ (function () {\n                function MapIterator(keys, values, selector) {\n                    this._index = 0;\n                    this._keys = keys;\n                    this._values = values;\n                    this._selector = selector;\n                }\n                MapIterator.prototype[\"@@iterator\"] = function () { return this; };\n                MapIterator.prototype[iteratorSymbol] = function () { return this; };\n                MapIterator.prototype.next = function () {\n                    var index = this._index;\n                    if (index >= 0 && index < this._keys.length) {\n                        var result = this._selector(this._keys[index], this._values[index]);\n                        if (index + 1 >= this._keys.length) {\n                            this._index = -1;\n                            this._keys = arraySentinel;\n                            this._values = arraySentinel;\n                        }\n                        else {\n                            this._index++;\n                        }\n                        return { value: result, done: false };\n                    }\n                    return { value: undefined, done: true };\n                };\n                MapIterator.prototype.throw = function (error) {\n                    if (this._index >= 0) {\n                        this._index = -1;\n                        this._keys = arraySentinel;\n                        this._values = arraySentinel;\n                    }\n                    throw error;\n                };\n                MapIterator.prototype.return = function (value) {\n                    if (this._index >= 0) {\n                        this._index = -1;\n                        this._keys = arraySentinel;\n                        this._values = arraySentinel;\n                    }\n                    return { value: value, done: true };\n                };\n                return MapIterator;\n            }());\n            var Map = /** @class */ (function () {\n                function Map() {\n                    this._keys = [];\n                    this._values = [];\n                    this._cacheKey = cacheSentinel;\n                    this._cacheIndex = -2;\n                }\n                Object.defineProperty(Map.prototype, \"size\", {\n                    get: function () { return this._keys.length; },\n                    enumerable: true,\n                    configurable: true\n                });\n                Map.prototype.has = function (key) { return this._find(key, /*insert*/ false) >= 0; };\n                Map.prototype.get = function (key) {\n                    var index = this._find(key, /*insert*/ false);\n                    return index >= 0 ? this._values[index] : undefined;\n                };\n                Map.prototype.set = function (key, value) {\n                    var index = this._find(key, /*insert*/ true);\n                    this._values[index] = value;\n                    return this;\n                };\n                Map.prototype.delete = function (key) {\n                    var index = this._find(key, /*insert*/ false);\n                    if (index >= 0) {\n                        var size = this._keys.length;\n                        for (var i = index + 1; i < size; i++) {\n                            this._keys[i - 1] = this._keys[i];\n                            this._values[i - 1] = this._values[i];\n                        }\n                        this._keys.length--;\n                        this._values.length--;\n                        if (SameValueZero(key, this._cacheKey)) {\n                            this._cacheKey = cacheSentinel;\n                            this._cacheIndex = -2;\n                        }\n                        return true;\n                    }\n                    return false;\n                };\n                Map.prototype.clear = function () {\n                    this._keys.length = 0;\n                    this._values.length = 0;\n                    this._cacheKey = cacheSentinel;\n                    this._cacheIndex = -2;\n                };\n                Map.prototype.keys = function () { return new MapIterator(this._keys, this._values, getKey); };\n                Map.prototype.values = function () { return new MapIterator(this._keys, this._values, getValue); };\n                Map.prototype.entries = function () { return new MapIterator(this._keys, this._values, getEntry); };\n                Map.prototype[\"@@iterator\"] = function () { return this.entries(); };\n                Map.prototype[iteratorSymbol] = function () { return this.entries(); };\n                Map.prototype._find = function (key, insert) {\n                    if (!SameValueZero(this._cacheKey, key)) {\n                        this._cacheIndex = -1;\n                        for (var i = 0; i < this._keys.length; i++) {\n                            if (SameValueZero(this._keys[i], key)) {\n                                this._cacheIndex = i;\n                                break;\n                            }\n                        }\n                    }\n                    if (this._cacheIndex < 0 && insert) {\n                        this._cacheIndex = this._keys.length;\n                        this._keys.push(key);\n                        this._values.push(undefined);\n                    }\n                    return this._cacheIndex;\n                };\n                return Map;\n            }());\n            return Map;\n            function getKey(key, _) {\n                return key;\n            }\n            function getValue(_, value) {\n                return value;\n            }\n            function getEntry(key, value) {\n                return [key, value];\n            }\n        }\n        // naive Set shim\n        function CreateSetPolyfill() {\n            var Set = /** @class */ (function () {\n                function Set() {\n                    this._map = new _Map();\n                }\n                Object.defineProperty(Set.prototype, \"size\", {\n                    get: function () { return this._map.size; },\n                    enumerable: true,\n                    configurable: true\n                });\n                Set.prototype.has = function (value) { return this._map.has(value); };\n                Set.prototype.add = function (value) { return this._map.set(value, value), this; };\n                Set.prototype.delete = function (value) { return this._map.delete(value); };\n                Set.prototype.clear = function () { this._map.clear(); };\n                Set.prototype.keys = function () { return this._map.keys(); };\n                Set.prototype.values = function () { return this._map.keys(); };\n                Set.prototype.entries = function () { return this._map.entries(); };\n                Set.prototype[\"@@iterator\"] = function () { return this.keys(); };\n                Set.prototype[iteratorSymbol] = function () { return this.keys(); };\n                return Set;\n            }());\n            return Set;\n        }\n        // naive WeakMap shim\n        function CreateWeakMapPolyfill() {\n            var UUID_SIZE = 16;\n            var keys = HashMap.create();\n            var rootKey = CreateUniqueKey();\n            return /** @class */ (function () {\n                function WeakMap() {\n                    this._key = CreateUniqueKey();\n                }\n                WeakMap.prototype.has = function (target) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\n                    return table !== undefined ? HashMap.has(table, this._key) : false;\n                };\n                WeakMap.prototype.get = function (target) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\n                    return table !== undefined ? HashMap.get(table, this._key) : undefined;\n                };\n                WeakMap.prototype.set = function (target, value) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ true);\n                    table[this._key] = value;\n                    return this;\n                };\n                WeakMap.prototype.delete = function (target) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\n                    return table !== undefined ? delete table[this._key] : false;\n                };\n                WeakMap.prototype.clear = function () {\n                    // NOTE: not a real clear, just makes the previous data unreachable\n                    this._key = CreateUniqueKey();\n                };\n                return WeakMap;\n            }());\n            function CreateUniqueKey() {\n                var key;\n                do\n                    key = \"@@WeakMap@@\" + CreateUUID();\n                while (HashMap.has(keys, key));\n                keys[key] = true;\n                return key;\n            }\n            function GetOrCreateWeakMapTable(target, create) {\n                if (!hasOwn.call(target, rootKey)) {\n                    if (!create)\n                        return undefined;\n                    Object.defineProperty(target, rootKey, { value: HashMap.create() });\n                }\n                return target[rootKey];\n            }\n            function FillRandomBytes(buffer, size) {\n                for (var i = 0; i < size; ++i)\n                    buffer[i] = Math.random() * 0xff | 0;\n                return buffer;\n            }\n            function GenRandomBytes(size) {\n                if (typeof Uint8Array === \"function\") {\n                    var array = new Uint8Array(size);\n                    if (typeof crypto !== \"undefined\") {\n                        crypto.getRandomValues(array);\n                    }\n                    else if (typeof msCrypto !== \"undefined\") {\n                        msCrypto.getRandomValues(array);\n                    }\n                    else {\n                        FillRandomBytes(array, size);\n                    }\n                    return array;\n                }\n                return FillRandomBytes(new Array(size), size);\n            }\n            function CreateUUID() {\n                var data = GenRandomBytes(UUID_SIZE);\n                // mark as random - RFC 4122 § 4.4\n                data[6] = data[6] & 0x4f | 0x40;\n                data[8] = data[8] & 0xbf | 0x80;\n                var result = \"\";\n                for (var offset = 0; offset < UUID_SIZE; ++offset) {\n                    var byte = data[offset];\n                    if (offset === 4 || offset === 6 || offset === 8)\n                        result += \"-\";\n                    if (byte < 16)\n                        result += \"0\";\n                    result += byte.toString(16).toLowerCase();\n                }\n                return result;\n            }\n        }\n        // uses a heuristic used by v8 and chakra to force an object into dictionary mode.\n        function MakeDictionary(obj) {\n            obj.__ = undefined;\n            delete obj.__;\n            return obj;\n        }\n    });\n})(Reflect || (Reflect = {}));\n","export var NAMED_TAG = 'named';\r\nexport var NAME_TAG = 'name';\r\nexport var UNMANAGED_TAG = 'unmanaged';\r\nexport var OPTIONAL_TAG = 'optional';\r\nexport var INJECT_TAG = 'inject';\r\nexport var MULTI_INJECT_TAG = 'multi_inject';\r\nexport var TAGGED = 'inversify:tagged';\r\nexport var TAGGED_PROP = 'inversify:tagged_props';\r\nexport var PARAM_TYPES = 'inversify:paramtypes';\r\nexport var DESIGN_PARAM_TYPES = 'design:paramtypes';\r\nexport var POST_CONSTRUCT = 'post_construct';\r\nexport var PRE_DESTROY = 'pre_destroy';\r\nfunction getNonCustomTagKeys() {\r\n    return [\r\n        INJECT_TAG,\r\n        MULTI_INJECT_TAG,\r\n        NAME_TAG,\r\n        UNMANAGED_TAG,\r\n        NAMED_TAG,\r\n        OPTIONAL_TAG,\r\n    ];\r\n}\r\nexport var NON_CUSTOM_TAG_KEYS = getNonCustomTagKeys();\r\n","var BindingScopeEnum = {\r\n    Request: 'Request',\r\n    Singleton: 'Singleton',\r\n    Transient: 'Transient'\r\n};\r\nvar BindingTypeEnum = {\r\n    ConstantValue: 'ConstantValue',\r\n    Constructor: 'Constructor',\r\n    DynamicValue: 'DynamicValue',\r\n    Factory: 'Factory',\r\n    Function: 'Function',\r\n    Instance: 'Instance',\r\n    Invalid: 'Invalid',\r\n    Provider: 'Provider'\r\n};\r\nvar TargetTypeEnum = {\r\n    ClassProperty: 'ClassProperty',\r\n    ConstructorArgument: 'ConstructorArgument',\r\n    Variable: 'Variable'\r\n};\r\nexport { BindingScopeEnum, BindingTypeEnum, TargetTypeEnum };\r\n","var idCounter = 0;\r\nfunction id() {\r\n    return idCounter++;\r\n}\r\nexport { id };\r\n","import { BindingScopeEnum, BindingTypeEnum } from '../constants/literal_types';\r\nimport { id } from '../utils/id';\r\nvar Binding = (function () {\r\n    function Binding(serviceIdentifier, scope) {\r\n        this.id = id();\r\n        this.activated = false;\r\n        this.serviceIdentifier = serviceIdentifier;\r\n        this.scope = scope;\r\n        this.type = BindingTypeEnum.Invalid;\r\n        this.constraint = function (request) { return true; };\r\n        this.implementationType = null;\r\n        this.cache = null;\r\n        this.factory = null;\r\n        this.provider = null;\r\n        this.onActivation = null;\r\n        this.onDeactivation = null;\r\n        this.dynamicValue = null;\r\n    }\r\n    Binding.prototype.clone = function () {\r\n        var clone = new Binding(this.serviceIdentifier, this.scope);\r\n        clone.activated = (clone.scope === BindingScopeEnum.Singleton) ? this.activated : false;\r\n        clone.implementationType = this.implementationType;\r\n        clone.dynamicValue = this.dynamicValue;\r\n        clone.scope = this.scope;\r\n        clone.type = this.type;\r\n        clone.factory = this.factory;\r\n        clone.provider = this.provider;\r\n        clone.constraint = this.constraint;\r\n        clone.onActivation = this.onActivation;\r\n        clone.onDeactivation = this.onDeactivation;\r\n        clone.cache = this.cache;\r\n        return clone;\r\n    };\r\n    return Binding;\r\n}());\r\nexport { Binding };\r\n","export var DUPLICATED_INJECTABLE_DECORATOR = 'Cannot apply @injectable decorator multiple times.';\r\nexport var DUPLICATED_METADATA = 'Metadata key was used more than once in a parameter:';\r\nexport var NULL_ARGUMENT = 'NULL argument';\r\nexport var KEY_NOT_FOUND = 'Key Not Found';\r\nexport var AMBIGUOUS_MATCH = 'Ambiguous match found for serviceIdentifier:';\r\nexport var CANNOT_UNBIND = 'Could not unbind serviceIdentifier:';\r\nexport var NOT_REGISTERED = 'No matching bindings found for serviceIdentifier:';\r\nexport var MISSING_INJECTABLE_ANNOTATION = 'Missing required @injectable annotation in:';\r\nexport var MISSING_INJECT_ANNOTATION = 'Missing required @inject or @multiInject annotation in:';\r\nexport var UNDEFINED_INJECT_ANNOTATION = function (name) {\r\n    return \"@inject called with undefined this could mean that the class \" + name + \" has \" +\r\n        'a circular dependency problem. You can use a LazyServiceIdentifier to  ' +\r\n        'overcome this limitation.';\r\n};\r\nexport var CIRCULAR_DEPENDENCY = 'Circular dependency found:';\r\nexport var NOT_IMPLEMENTED = 'Sorry, this feature is not fully implemented yet.';\r\nexport var INVALID_BINDING_TYPE = 'Invalid binding type:';\r\nexport var NO_MORE_SNAPSHOTS_AVAILABLE = 'No snapshot available to restore.';\r\nexport var INVALID_MIDDLEWARE_RETURN = 'Invalid return type in middleware. Middleware must return!';\r\nexport var INVALID_FUNCTION_BINDING = 'Value provided to function binding must be a function!';\r\nexport var LAZY_IN_SYNC = function (key) { return \"You are attempting to construct '\" + key + \"' in a synchronous way\\n but it has asynchronous dependencies.\"; };\r\nexport var INVALID_TO_SELF_VALUE = 'The toSelf function can only be applied when a constructor is ' +\r\n    'used as service identifier';\r\nexport var INVALID_DECORATOR_OPERATION = 'The @inject @multiInject @tagged and @named decorators ' +\r\n    'must be applied to the parameters of a class constructor or a class property.';\r\nexport var ARGUMENTS_LENGTH_MISMATCH = function () {\r\n    var values = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        values[_i] = arguments[_i];\r\n    }\r\n    return 'The number of constructor arguments in the derived class ' +\r\n        (values[0] + \" must be >= than the number of constructor arguments of its base class.\");\r\n};\r\nexport var CONTAINER_OPTIONS_MUST_BE_AN_OBJECT = 'Invalid Container constructor argument. Container options ' +\r\n    'must be an object.';\r\nexport var CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE = 'Invalid Container option. Default scope must ' +\r\n    'be a string (\"singleton\" or \"transient\").';\r\nexport var CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE = 'Invalid Container option. Auto bind injectable must ' +\r\n    'be a boolean';\r\nexport var CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK = 'Invalid Container option. Skip base check must ' +\r\n    'be a boolean';\r\nexport var MULTIPLE_PRE_DESTROY_METHODS = 'Cannot apply @preDestroy decorator multiple times in the same class';\r\nexport var MULTIPLE_POST_CONSTRUCT_METHODS = 'Cannot apply @postConstruct decorator multiple times in the same class';\r\nexport var ASYNC_UNBIND_REQUIRED = 'Attempting to unbind dependency with asynchronous destruction (@preDestroy or onDeactivation)';\r\nexport var POST_CONSTRUCT_ERROR = function (clazz, errorMessage) { return \"@postConstruct error in class \" + clazz + \": \" + errorMessage; };\r\nexport var PRE_DESTROY_ERROR = function (clazz, errorMessage) { return \"@preDestroy error in class \" + clazz + \": \" + errorMessage; };\r\nexport var ON_DEACTIVATION_ERROR = function (clazz, errorMessage) { return \"onDeactivation() error in class \" + clazz + \": \" + errorMessage; };\r\nexport var CIRCULAR_DEPENDENCY_IN_FACTORY = function (factoryType, serviceIdentifier) {\r\n    return \"It looks like there is a circular dependency in one of the '\" + factoryType + \"' bindings. Please investigate bindings with \" +\r\n        (\"service identifier '\" + serviceIdentifier + \"'.\");\r\n};\r\nexport var STACK_OVERFLOW = 'Maximum call stack size exceeded';\r\n","import * as METADATA_KEY from '../constants/metadata_keys';\r\nvar MetadataReader = (function () {\r\n    function MetadataReader() {\r\n    }\r\n    MetadataReader.prototype.getConstructorMetadata = function (constructorFunc) {\r\n        var compilerGeneratedMetadata = Reflect.getMetadata(METADATA_KEY.PARAM_TYPES, constructorFunc);\r\n        var userGeneratedMetadata = Reflect.getMetadata(METADATA_KEY.TAGGED, constructorFunc);\r\n        return {\r\n            compilerGeneratedMetadata: compilerGeneratedMetadata,\r\n            userGeneratedMetadata: userGeneratedMetadata || {}\r\n        };\r\n    };\r\n    MetadataReader.prototype.getPropertiesMetadata = function (constructorFunc) {\r\n        var userGeneratedMetadata = Reflect.getMetadata(METADATA_KEY.TAGGED_PROP, constructorFunc) || [];\r\n        return userGeneratedMetadata;\r\n    };\r\n    return MetadataReader;\r\n}());\r\nexport { MetadataReader };\r\n","export var BindingCount = {\r\n    MultipleBindingsAvailable: 2,\r\n    NoBindingsAvailable: 0,\r\n    OnlyOneBindingAvailable: 1\r\n};\r\n","import * as ERROR_MSGS from '../constants/error_msgs';\r\nexport function isStackOverflowExeption(error) {\r\n    return (error instanceof RangeError ||\r\n        error.message === ERROR_MSGS.STACK_OVERFLOW);\r\n}\r\nexport var tryAndThrowErrorIfStackOverflow = function (fn, errorCallback) {\r\n    try {\r\n        return fn();\r\n    }\r\n    catch (error) {\r\n        if (isStackOverflowExeption(error)) {\r\n            error = errorCallback();\r\n        }\r\n        throw error;\r\n    }\r\n};\r\n","import * as ERROR_MSGS from '../constants/error_msgs';\r\nfunction getServiceIdentifierAsString(serviceIdentifier) {\r\n    if (typeof serviceIdentifier === 'function') {\r\n        var _serviceIdentifier = serviceIdentifier;\r\n        return _serviceIdentifier.name;\r\n    }\r\n    else if (typeof serviceIdentifier === 'symbol') {\r\n        return serviceIdentifier.toString();\r\n    }\r\n    else {\r\n        var _serviceIdentifier = serviceIdentifier;\r\n        return _serviceIdentifier;\r\n    }\r\n}\r\nfunction listRegisteredBindingsForServiceIdentifier(container, serviceIdentifier, getBindings) {\r\n    var registeredBindingsList = '';\r\n    var registeredBindings = getBindings(container, serviceIdentifier);\r\n    if (registeredBindings.length !== 0) {\r\n        registeredBindingsList = '\\nRegistered bindings:';\r\n        registeredBindings.forEach(function (binding) {\r\n            var name = 'Object';\r\n            if (binding.implementationType !== null) {\r\n                name = getFunctionName(binding.implementationType);\r\n            }\r\n            registeredBindingsList = registeredBindingsList + \"\\n \" + name;\r\n            if (binding.constraint.metaData) {\r\n                registeredBindingsList = registeredBindingsList + \" - \" + binding.constraint.metaData;\r\n            }\r\n        });\r\n    }\r\n    return registeredBindingsList;\r\n}\r\nfunction alreadyDependencyChain(request, serviceIdentifier) {\r\n    if (request.parentRequest === null) {\r\n        return false;\r\n    }\r\n    else if (request.parentRequest.serviceIdentifier === serviceIdentifier) {\r\n        return true;\r\n    }\r\n    else {\r\n        return alreadyDependencyChain(request.parentRequest, serviceIdentifier);\r\n    }\r\n}\r\nfunction dependencyChainToString(request) {\r\n    function _createStringArr(req, result) {\r\n        if (result === void 0) { result = []; }\r\n        var serviceIdentifier = getServiceIdentifierAsString(req.serviceIdentifier);\r\n        result.push(serviceIdentifier);\r\n        if (req.parentRequest !== null) {\r\n            return _createStringArr(req.parentRequest, result);\r\n        }\r\n        return result;\r\n    }\r\n    var stringArr = _createStringArr(request);\r\n    return stringArr.reverse().join(' --> ');\r\n}\r\nfunction circularDependencyToException(request) {\r\n    request.childRequests.forEach(function (childRequest) {\r\n        if (alreadyDependencyChain(childRequest, childRequest.serviceIdentifier)) {\r\n            var services = dependencyChainToString(childRequest);\r\n            throw new Error(ERROR_MSGS.CIRCULAR_DEPENDENCY + \" \" + services);\r\n        }\r\n        else {\r\n            circularDependencyToException(childRequest);\r\n        }\r\n    });\r\n}\r\nfunction listMetadataForTarget(serviceIdentifierString, target) {\r\n    if (target.isTagged() || target.isNamed()) {\r\n        var m_1 = '';\r\n        var namedTag = target.getNamedTag();\r\n        var otherTags = target.getCustomTags();\r\n        if (namedTag !== null) {\r\n            m_1 += namedTag.toString() + '\\n';\r\n        }\r\n        if (otherTags !== null) {\r\n            otherTags.forEach(function (tag) {\r\n                m_1 += tag.toString() + '\\n';\r\n            });\r\n        }\r\n        return \" \" + serviceIdentifierString + \"\\n \" + serviceIdentifierString + \" - \" + m_1;\r\n    }\r\n    else {\r\n        return \" \" + serviceIdentifierString;\r\n    }\r\n}\r\nfunction getFunctionName(func) {\r\n    if (func.name) {\r\n        return func.name;\r\n    }\r\n    else {\r\n        var name_1 = func.toString();\r\n        var match = name_1.match(/^function\\s*([^\\s(]+)/);\r\n        return match ? match[1] : \"Anonymous function: \" + name_1;\r\n    }\r\n}\r\nfunction getSymbolDescription(symbol) {\r\n    return symbol.toString().slice(7, -1);\r\n}\r\nexport { getFunctionName, getServiceIdentifierAsString, listRegisteredBindingsForServiceIdentifier, listMetadataForTarget, circularDependencyToException, getSymbolDescription };\r\n","import { id } from '../utils/id';\r\nvar Context = (function () {\r\n    function Context(container) {\r\n        this.id = id();\r\n        this.container = container;\r\n    }\r\n    Context.prototype.addPlan = function (plan) {\r\n        this.plan = plan;\r\n    };\r\n    Context.prototype.setCurrentRequest = function (currentRequest) {\r\n        this.currentRequest = currentRequest;\r\n    };\r\n    return Context;\r\n}());\r\nexport { Context };\r\n","import * as METADATA_KEY from '../constants/metadata_keys';\r\nvar Metadata = (function () {\r\n    function Metadata(key, value) {\r\n        this.key = key;\r\n        this.value = value;\r\n    }\r\n    Metadata.prototype.toString = function () {\r\n        if (this.key === METADATA_KEY.NAMED_TAG) {\r\n            return \"named: \" + String(this.value).toString() + \" \";\r\n        }\r\n        else {\r\n            return \"tagged: { key:\" + this.key.toString() + \", value: \" + String(this.value) + \" }\";\r\n        }\r\n    };\r\n    return Metadata;\r\n}());\r\nexport { Metadata };\r\n","var Plan = (function () {\r\n    function Plan(parentContext, rootRequest) {\r\n        this.parentContext = parentContext;\r\n        this.rootRequest = rootRequest;\r\n    }\r\n    return Plan;\r\n}());\r\nexport { Plan };\r\n","var LazyServiceIdentifier = (function () {\r\n    function LazyServiceIdentifier(cb) {\r\n        this._cb = cb;\r\n    }\r\n    LazyServiceIdentifier.prototype.unwrap = function () {\r\n        return this._cb();\r\n    };\r\n    return LazyServiceIdentifier;\r\n}());\r\nexport { LazyServiceIdentifier };\r\n","var QueryableString = (function () {\r\n    function QueryableString(str) {\r\n        this.str = str;\r\n    }\r\n    QueryableString.prototype.startsWith = function (searchString) {\r\n        return this.str.indexOf(searchString) === 0;\r\n    };\r\n    QueryableString.prototype.endsWith = function (searchString) {\r\n        var reverseString = '';\r\n        var reverseSearchString = searchString.split('').reverse().join('');\r\n        reverseString = this.str.split('').reverse().join('');\r\n        return this.startsWith.call({ str: reverseString }, reverseSearchString);\r\n    };\r\n    QueryableString.prototype.contains = function (searchString) {\r\n        return (this.str.indexOf(searchString) !== -1);\r\n    };\r\n    QueryableString.prototype.equals = function (compareString) {\r\n        return this.str === compareString;\r\n    };\r\n    QueryableString.prototype.value = function () {\r\n        return this.str;\r\n    };\r\n    return QueryableString;\r\n}());\r\nexport { QueryableString };\r\n","import * as METADATA_KEY from '../constants/metadata_keys';\r\nimport { id } from '../utils/id';\r\nimport { getSymbolDescription } from '../utils/serialization';\r\nimport { Metadata } from './metadata';\r\nimport { QueryableString } from './queryable_string';\r\nvar Target = (function () {\r\n    function Target(type, identifier, serviceIdentifier, namedOrTagged) {\r\n        this.id = id();\r\n        this.type = type;\r\n        this.serviceIdentifier = serviceIdentifier;\r\n        var queryableName = typeof identifier === 'symbol' ? getSymbolDescription(identifier) : identifier;\r\n        this.name = new QueryableString(queryableName || '');\r\n        this.identifier = identifier;\r\n        this.metadata = new Array();\r\n        var metadataItem = null;\r\n        if (typeof namedOrTagged === 'string') {\r\n            metadataItem = new Metadata(METADATA_KEY.NAMED_TAG, namedOrTagged);\r\n        }\r\n        else if (namedOrTagged instanceof Metadata) {\r\n            metadataItem = namedOrTagged;\r\n        }\r\n        if (metadataItem !== null) {\r\n            this.metadata.push(metadataItem);\r\n        }\r\n    }\r\n    Target.prototype.hasTag = function (key) {\r\n        for (var _i = 0, _a = this.metadata; _i < _a.length; _i++) {\r\n            var m = _a[_i];\r\n            if (m.key === key) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n    Target.prototype.isArray = function () {\r\n        return this.hasTag(METADATA_KEY.MULTI_INJECT_TAG);\r\n    };\r\n    Target.prototype.matchesArray = function (name) {\r\n        return this.matchesTag(METADATA_KEY.MULTI_INJECT_TAG)(name);\r\n    };\r\n    Target.prototype.isNamed = function () {\r\n        return this.hasTag(METADATA_KEY.NAMED_TAG);\r\n    };\r\n    Target.prototype.isTagged = function () {\r\n        return this.metadata.some(function (metadata) { return METADATA_KEY.NON_CUSTOM_TAG_KEYS.every(function (key) { return metadata.key !== key; }); });\r\n    };\r\n    Target.prototype.isOptional = function () {\r\n        return this.matchesTag(METADATA_KEY.OPTIONAL_TAG)(true);\r\n    };\r\n    Target.prototype.getNamedTag = function () {\r\n        if (this.isNamed()) {\r\n            return this.metadata.filter(function (m) { return m.key === METADATA_KEY.NAMED_TAG; })[0];\r\n        }\r\n        return null;\r\n    };\r\n    Target.prototype.getCustomTags = function () {\r\n        if (this.isTagged()) {\r\n            return this.metadata.filter(function (metadata) { return METADATA_KEY.NON_CUSTOM_TAG_KEYS.every(function (key) { return metadata.key !== key; }); });\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    };\r\n    Target.prototype.matchesNamedTag = function (name) {\r\n        return this.matchesTag(METADATA_KEY.NAMED_TAG)(name);\r\n    };\r\n    Target.prototype.matchesTag = function (key) {\r\n        var _this = this;\r\n        return function (value) {\r\n            for (var _i = 0, _a = _this.metadata; _i < _a.length; _i++) {\r\n                var m = _a[_i];\r\n                if (m.key === key && m.value === value) {\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        };\r\n    };\r\n    return Target;\r\n}());\r\nexport { Target };\r\n","var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n};\r\nimport { LazyServiceIdentifier } from '../annotation/lazy_service_identifier';\r\nimport * as ERROR_MSGS from '../constants/error_msgs';\r\nimport { TargetTypeEnum } from '../constants/literal_types';\r\nimport * as METADATA_KEY from '../constants/metadata_keys';\r\nimport { getFunctionName } from '../utils/serialization';\r\nimport { Target } from './target';\r\nfunction getDependencies(metadataReader, func) {\r\n    var constructorName = getFunctionName(func);\r\n    return getTargets(metadataReader, constructorName, func, false);\r\n}\r\nfunction getTargets(metadataReader, constructorName, func, isBaseClass) {\r\n    var metadata = metadataReader.getConstructorMetadata(func);\r\n    var serviceIdentifiers = metadata.compilerGeneratedMetadata;\r\n    if (serviceIdentifiers === undefined) {\r\n        var msg = ERROR_MSGS.MISSING_INJECTABLE_ANNOTATION + \" \" + constructorName + \".\";\r\n        throw new Error(msg);\r\n    }\r\n    var constructorArgsMetadata = metadata.userGeneratedMetadata;\r\n    var keys = Object.keys(constructorArgsMetadata);\r\n    var hasUserDeclaredUnknownInjections = (func.length === 0 && keys.length > 0);\r\n    var hasOptionalParameters = keys.length > func.length;\r\n    var iterations = (hasUserDeclaredUnknownInjections || hasOptionalParameters) ? keys.length : func.length;\r\n    var constructorTargets = getConstructorArgsAsTargets(isBaseClass, constructorName, serviceIdentifiers, constructorArgsMetadata, iterations);\r\n    var propertyTargets = getClassPropsAsTargets(metadataReader, func, constructorName);\r\n    var targets = __spreadArray(__spreadArray([], constructorTargets, true), propertyTargets, true);\r\n    return targets;\r\n}\r\nfunction getConstructorArgsAsTarget(index, isBaseClass, constructorName, serviceIdentifiers, constructorArgsMetadata) {\r\n    var targetMetadata = constructorArgsMetadata[index.toString()] || [];\r\n    var metadata = formatTargetMetadata(targetMetadata);\r\n    var isManaged = metadata.unmanaged !== true;\r\n    var serviceIdentifier = serviceIdentifiers[index];\r\n    var injectIdentifier = metadata.inject || metadata.multiInject;\r\n    serviceIdentifier = (injectIdentifier ? injectIdentifier : serviceIdentifier);\r\n    if (serviceIdentifier instanceof LazyServiceIdentifier) {\r\n        serviceIdentifier = serviceIdentifier.unwrap();\r\n    }\r\n    if (isManaged) {\r\n        var isObject = serviceIdentifier === Object;\r\n        var isFunction = serviceIdentifier === Function;\r\n        var isUndefined = serviceIdentifier === undefined;\r\n        var isUnknownType = isObject || isFunction || isUndefined;\r\n        if (!isBaseClass && isUnknownType) {\r\n            var msg = ERROR_MSGS.MISSING_INJECT_ANNOTATION + \" argument \" + index + \" in class \" + constructorName + \".\";\r\n            throw new Error(msg);\r\n        }\r\n        var target = new Target(TargetTypeEnum.ConstructorArgument, metadata.targetName, serviceIdentifier);\r\n        target.metadata = targetMetadata;\r\n        return target;\r\n    }\r\n    return null;\r\n}\r\nfunction getConstructorArgsAsTargets(isBaseClass, constructorName, serviceIdentifiers, constructorArgsMetadata, iterations) {\r\n    var targets = [];\r\n    for (var i = 0; i < iterations; i++) {\r\n        var index = i;\r\n        var target = getConstructorArgsAsTarget(index, isBaseClass, constructorName, serviceIdentifiers, constructorArgsMetadata);\r\n        if (target !== null) {\r\n            targets.push(target);\r\n        }\r\n    }\r\n    return targets;\r\n}\r\nfunction _getServiceIdentifierForProperty(inject, multiInject, propertyName, className) {\r\n    var serviceIdentifier = (inject || multiInject);\r\n    if (serviceIdentifier === undefined) {\r\n        var msg = ERROR_MSGS.MISSING_INJECTABLE_ANNOTATION + \" for property \" + String(propertyName) + \" in class \" + className + \".\";\r\n        throw new Error(msg);\r\n    }\r\n    return serviceIdentifier;\r\n}\r\nfunction getClassPropsAsTargets(metadataReader, constructorFunc, constructorName) {\r\n    var classPropsMetadata = metadataReader.getPropertiesMetadata(constructorFunc);\r\n    var targets = [];\r\n    var symbolKeys = Object.getOwnPropertySymbols(classPropsMetadata);\r\n    var stringKeys = Object.keys(classPropsMetadata);\r\n    var keys = stringKeys.concat(symbolKeys);\r\n    for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\r\n        var key = keys_1[_i];\r\n        var targetMetadata = classPropsMetadata[key];\r\n        var metadata = formatTargetMetadata(targetMetadata);\r\n        var identifier = metadata.targetName || key;\r\n        var serviceIdentifier = _getServiceIdentifierForProperty(metadata.inject, metadata.multiInject, key, constructorName);\r\n        var target = new Target(TargetTypeEnum.ClassProperty, identifier, serviceIdentifier);\r\n        target.metadata = targetMetadata;\r\n        targets.push(target);\r\n    }\r\n    var baseConstructor = Object.getPrototypeOf(constructorFunc.prototype).constructor;\r\n    if (baseConstructor !== Object) {\r\n        var baseTargets = getClassPropsAsTargets(metadataReader, baseConstructor, constructorName);\r\n        targets = __spreadArray(__spreadArray([], targets, true), baseTargets, true);\r\n    }\r\n    return targets;\r\n}\r\nfunction getBaseClassDependencyCount(metadataReader, func) {\r\n    var baseConstructor = Object.getPrototypeOf(func.prototype).constructor;\r\n    if (baseConstructor !== Object) {\r\n        var baseConstructorName = getFunctionName(baseConstructor);\r\n        var targets = getTargets(metadataReader, baseConstructorName, baseConstructor, true);\r\n        var metadata = targets.map(function (t) { return t.metadata.filter(function (m) { return m.key === METADATA_KEY.UNMANAGED_TAG; }); });\r\n        var unmanagedCount = [].concat.apply([], metadata).length;\r\n        var dependencyCount = targets.length - unmanagedCount;\r\n        if (dependencyCount > 0) {\r\n            return dependencyCount;\r\n        }\r\n        else {\r\n            return getBaseClassDependencyCount(metadataReader, baseConstructor);\r\n        }\r\n    }\r\n    else {\r\n        return 0;\r\n    }\r\n}\r\nfunction formatTargetMetadata(targetMetadata) {\r\n    var targetMetadataMap = {};\r\n    targetMetadata.forEach(function (m) {\r\n        targetMetadataMap[m.key.toString()] = m.value;\r\n    });\r\n    return {\r\n        inject: targetMetadataMap[METADATA_KEY.INJECT_TAG],\r\n        multiInject: targetMetadataMap[METADATA_KEY.MULTI_INJECT_TAG],\r\n        targetName: targetMetadataMap[METADATA_KEY.NAME_TAG],\r\n        unmanaged: targetMetadataMap[METADATA_KEY.UNMANAGED_TAG]\r\n    };\r\n}\r\nexport { getDependencies, getBaseClassDependencyCount, getFunctionName };\r\n","import { id } from '../utils/id';\r\nvar Request = (function () {\r\n    function Request(serviceIdentifier, parentContext, parentRequest, bindings, target) {\r\n        this.id = id();\r\n        this.serviceIdentifier = serviceIdentifier;\r\n        this.parentContext = parentContext;\r\n        this.parentRequest = parentRequest;\r\n        this.target = target;\r\n        this.childRequests = [];\r\n        this.bindings = (Array.isArray(bindings) ? bindings : [bindings]);\r\n        this.requestScope = parentRequest === null\r\n            ? new Map()\r\n            : null;\r\n    }\r\n    Request.prototype.addChildRequest = function (serviceIdentifier, bindings, target) {\r\n        var child = new Request(serviceIdentifier, this.parentContext, this, bindings, target);\r\n        this.childRequests.push(child);\r\n        return child;\r\n    };\r\n    return Request;\r\n}());\r\nexport { Request };\r\n","import { BindingCount } from '../bindings/binding_count';\r\nimport * as ERROR_MSGS from '../constants/error_msgs';\r\nimport { BindingTypeEnum, TargetTypeEnum } from '../constants/literal_types';\r\nimport * as METADATA_KEY from '../constants/metadata_keys';\r\nimport { isStackOverflowExeption } from '../utils/exceptions';\r\nimport { circularDependencyToException, getServiceIdentifierAsString, listMetadataForTarget, listRegisteredBindingsForServiceIdentifier } from '../utils/serialization';\r\nimport { Context } from './context';\r\nimport { Metadata } from './metadata';\r\nimport { Plan } from './plan';\r\nimport { getBaseClassDependencyCount, getDependencies, getFunctionName } from './reflection_utils';\r\nimport { Request } from './request';\r\nimport { Target } from './target';\r\nfunction getBindingDictionary(cntnr) {\r\n    return cntnr._bindingDictionary;\r\n}\r\nfunction _createTarget(isMultiInject, targetType, serviceIdentifier, name, key, value) {\r\n    var metadataKey = isMultiInject ? METADATA_KEY.MULTI_INJECT_TAG : METADATA_KEY.INJECT_TAG;\r\n    var injectMetadata = new Metadata(metadataKey, serviceIdentifier);\r\n    var target = new Target(targetType, name, serviceIdentifier, injectMetadata);\r\n    if (key !== undefined) {\r\n        var tagMetadata = new Metadata(key, value);\r\n        target.metadata.push(tagMetadata);\r\n    }\r\n    return target;\r\n}\r\nfunction _getActiveBindings(metadataReader, avoidConstraints, context, parentRequest, target) {\r\n    var bindings = getBindings(context.container, target.serviceIdentifier);\r\n    var activeBindings = [];\r\n    if (bindings.length === BindingCount.NoBindingsAvailable &&\r\n        context.container.options.autoBindInjectable &&\r\n        typeof target.serviceIdentifier === 'function' &&\r\n        metadataReader.getConstructorMetadata(target.serviceIdentifier).compilerGeneratedMetadata) {\r\n        context.container.bind(target.serviceIdentifier).toSelf();\r\n        bindings = getBindings(context.container, target.serviceIdentifier);\r\n    }\r\n    if (!avoidConstraints) {\r\n        activeBindings = bindings.filter(function (binding) {\r\n            var request = new Request(binding.serviceIdentifier, context, parentRequest, binding, target);\r\n            return binding.constraint(request);\r\n        });\r\n    }\r\n    else {\r\n        activeBindings = bindings;\r\n    }\r\n    _validateActiveBindingCount(target.serviceIdentifier, activeBindings, target, context.container);\r\n    return activeBindings;\r\n}\r\nfunction _validateActiveBindingCount(serviceIdentifier, bindings, target, container) {\r\n    switch (bindings.length) {\r\n        case BindingCount.NoBindingsAvailable:\r\n            if (target.isOptional()) {\r\n                return bindings;\r\n            }\r\n            else {\r\n                var serviceIdentifierString = getServiceIdentifierAsString(serviceIdentifier);\r\n                var msg = ERROR_MSGS.NOT_REGISTERED;\r\n                msg += listMetadataForTarget(serviceIdentifierString, target);\r\n                msg += listRegisteredBindingsForServiceIdentifier(container, serviceIdentifierString, getBindings);\r\n                throw new Error(msg);\r\n            }\r\n        case BindingCount.OnlyOneBindingAvailable:\r\n            return bindings;\r\n        case BindingCount.MultipleBindingsAvailable:\r\n        default:\r\n            if (!target.isArray()) {\r\n                var serviceIdentifierString = getServiceIdentifierAsString(serviceIdentifier);\r\n                var msg = ERROR_MSGS.AMBIGUOUS_MATCH + \" \" + serviceIdentifierString;\r\n                msg += listRegisteredBindingsForServiceIdentifier(container, serviceIdentifierString, getBindings);\r\n                throw new Error(msg);\r\n            }\r\n            else {\r\n                return bindings;\r\n            }\r\n    }\r\n}\r\nfunction _createSubRequests(metadataReader, avoidConstraints, serviceIdentifier, context, parentRequest, target) {\r\n    var activeBindings;\r\n    var childRequest;\r\n    if (parentRequest === null) {\r\n        activeBindings = _getActiveBindings(metadataReader, avoidConstraints, context, null, target);\r\n        childRequest = new Request(serviceIdentifier, context, null, activeBindings, target);\r\n        var thePlan = new Plan(context, childRequest);\r\n        context.addPlan(thePlan);\r\n    }\r\n    else {\r\n        activeBindings = _getActiveBindings(metadataReader, avoidConstraints, context, parentRequest, target);\r\n        childRequest = parentRequest.addChildRequest(target.serviceIdentifier, activeBindings, target);\r\n    }\r\n    activeBindings.forEach(function (binding) {\r\n        var subChildRequest = null;\r\n        if (target.isArray()) {\r\n            subChildRequest = childRequest.addChildRequest(binding.serviceIdentifier, binding, target);\r\n        }\r\n        else {\r\n            if (binding.cache) {\r\n                return;\r\n            }\r\n            subChildRequest = childRequest;\r\n        }\r\n        if (binding.type === BindingTypeEnum.Instance && binding.implementationType !== null) {\r\n            var dependencies = getDependencies(metadataReader, binding.implementationType);\r\n            if (!context.container.options.skipBaseClassChecks) {\r\n                var baseClassDependencyCount = getBaseClassDependencyCount(metadataReader, binding.implementationType);\r\n                if (dependencies.length < baseClassDependencyCount) {\r\n                    var error = ERROR_MSGS.ARGUMENTS_LENGTH_MISMATCH(getFunctionName(binding.implementationType));\r\n                    throw new Error(error);\r\n                }\r\n            }\r\n            dependencies.forEach(function (dependency) {\r\n                _createSubRequests(metadataReader, false, dependency.serviceIdentifier, context, subChildRequest, dependency);\r\n            });\r\n        }\r\n    });\r\n}\r\nfunction getBindings(container, serviceIdentifier) {\r\n    var bindings = [];\r\n    var bindingDictionary = getBindingDictionary(container);\r\n    if (bindingDictionary.hasKey(serviceIdentifier)) {\r\n        bindings = bindingDictionary.get(serviceIdentifier);\r\n    }\r\n    else if (container.parent !== null) {\r\n        bindings = getBindings(container.parent, serviceIdentifier);\r\n    }\r\n    return bindings;\r\n}\r\nfunction plan(metadataReader, container, isMultiInject, targetType, serviceIdentifier, key, value, avoidConstraints) {\r\n    if (avoidConstraints === void 0) { avoidConstraints = false; }\r\n    var context = new Context(container);\r\n    var target = _createTarget(isMultiInject, targetType, serviceIdentifier, '', key, value);\r\n    try {\r\n        _createSubRequests(metadataReader, avoidConstraints, serviceIdentifier, context, null, target);\r\n        return context;\r\n    }\r\n    catch (error) {\r\n        if (isStackOverflowExeption(error)) {\r\n            circularDependencyToException(context.plan.rootRequest);\r\n        }\r\n        throw error;\r\n    }\r\n}\r\nfunction createMockRequest(container, serviceIdentifier, key, value) {\r\n    var target = new Target(TargetTypeEnum.Variable, '', serviceIdentifier, new Metadata(key, value));\r\n    var context = new Context(container);\r\n    var request = new Request(serviceIdentifier, context, null, [], target);\r\n    return request;\r\n}\r\nexport { plan, createMockRequest, getBindingDictionary };\r\n","function isPromise(object) {\r\n    var isObjectOrFunction = (typeof object === 'object' && object !== null) || typeof object === 'function';\r\n    return isObjectOrFunction && typeof object.then === \"function\";\r\n}\r\nfunction isPromiseOrContainsPromise(object) {\r\n    if (isPromise(object)) {\r\n        return true;\r\n    }\r\n    return Array.isArray(object) && object.some(isPromise);\r\n}\r\nexport { isPromise, isPromiseOrContainsPromise };\r\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { BindingScopeEnum } from '../constants/literal_types';\r\nimport { isPromise } from '../utils/async';\r\nexport var tryGetFromScope = function (requestScope, binding) {\r\n    if ((binding.scope === BindingScopeEnum.Singleton) && binding.activated) {\r\n        return binding.cache;\r\n    }\r\n    if (binding.scope === BindingScopeEnum.Request &&\r\n        requestScope.has(binding.id)) {\r\n        return requestScope.get(binding.id);\r\n    }\r\n    return null;\r\n};\r\nexport var saveToScope = function (requestScope, binding, result) {\r\n    if (binding.scope === BindingScopeEnum.Singleton) {\r\n        _saveToSingletonScope(binding, result);\r\n    }\r\n    if (binding.scope === BindingScopeEnum.Request) {\r\n        _saveToRequestScope(requestScope, binding, result);\r\n    }\r\n};\r\nvar _saveToRequestScope = function (requestScope, binding, result) {\r\n    if (!requestScope.has(binding.id)) {\r\n        requestScope.set(binding.id, result);\r\n    }\r\n};\r\nvar _saveToSingletonScope = function (binding, result) {\r\n    binding.cache = result;\r\n    binding.activated = true;\r\n    if (isPromise(result)) {\r\n        void _saveAsyncResultToSingletonScope(binding, result);\r\n    }\r\n};\r\nvar _saveAsyncResultToSingletonScope = function (binding, asyncResult) { return __awaiter(void 0, void 0, void 0, function () {\r\n    var result, ex_1;\r\n    return __generator(this, function (_a) {\r\n        switch (_a.label) {\r\n            case 0:\r\n                _a.trys.push([0, 2, , 3]);\r\n                return [4, asyncResult];\r\n            case 1:\r\n                result = _a.sent();\r\n                binding.cache = result;\r\n                return [3, 3];\r\n            case 2:\r\n                ex_1 = _a.sent();\r\n                binding.cache = null;\r\n                binding.activated = false;\r\n                throw ex_1;\r\n            case 3: return [2];\r\n        }\r\n    });\r\n}); };\r\n","export var FactoryType;\r\n(function (FactoryType) {\r\n    FactoryType[\"DynamicValue\"] = \"toDynamicValue\";\r\n    FactoryType[\"Factory\"] = \"toFactory\";\r\n    FactoryType[\"Provider\"] = \"toProvider\";\r\n})(FactoryType || (FactoryType = {}));\r\n","import { getServiceIdentifierAsString } from '../utils/serialization';\r\nimport * as ERROR_MSGS from '../constants/error_msgs';\r\nimport { BindingTypeEnum } from '../constants/literal_types';\r\nimport { FactoryType } from './factory_type';\r\nexport var multiBindToService = function (container) {\r\n    return function (service) {\r\n        return function () {\r\n            var types = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                types[_i] = arguments[_i];\r\n            }\r\n            return types.forEach(function (t) { return container.bind(t).toService(service); });\r\n        };\r\n    };\r\n};\r\nexport var ensureFullyBound = function (binding) {\r\n    var boundValue = null;\r\n    switch (binding.type) {\r\n        case BindingTypeEnum.ConstantValue:\r\n        case BindingTypeEnum.Function:\r\n            boundValue = binding.cache;\r\n            break;\r\n        case BindingTypeEnum.Constructor:\r\n        case BindingTypeEnum.Instance:\r\n            boundValue = binding.implementationType;\r\n            break;\r\n        case BindingTypeEnum.DynamicValue:\r\n            boundValue = binding.dynamicValue;\r\n            break;\r\n        case BindingTypeEnum.Provider:\r\n            boundValue = binding.provider;\r\n            break;\r\n        case BindingTypeEnum.Factory:\r\n            boundValue = binding.factory;\r\n            break;\r\n    }\r\n    if (boundValue === null) {\r\n        var serviceIdentifierAsString = getServiceIdentifierAsString(binding.serviceIdentifier);\r\n        throw new Error(ERROR_MSGS.INVALID_BINDING_TYPE + \" \" + serviceIdentifierAsString);\r\n    }\r\n};\r\nexport var getFactoryDetails = function (binding) {\r\n    switch (binding.type) {\r\n        case BindingTypeEnum.Factory:\r\n            return { factory: binding.factory, factoryType: FactoryType.Factory };\r\n        case BindingTypeEnum.Provider:\r\n            return { factory: binding.provider, factoryType: FactoryType.Provider };\r\n        case BindingTypeEnum.DynamicValue:\r\n            return { factory: binding.dynamicValue, factoryType: FactoryType.DynamicValue };\r\n        default:\r\n            throw new Error(\"Unexpected factory type \" + binding.type);\r\n    }\r\n};\r\n","var __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n};\r\nimport { ON_DEACTIVATION_ERROR, POST_CONSTRUCT_ERROR, PRE_DESTROY_ERROR } from '../constants/error_msgs';\r\nimport { BindingScopeEnum, TargetTypeEnum } from '../constants/literal_types';\r\nimport * as METADATA_KEY from '../constants/metadata_keys';\r\nimport { isPromise, isPromiseOrContainsPromise } from '../utils/async';\r\nfunction _resolveRequests(childRequests, resolveRequest) {\r\n    return childRequests.reduce(function (resolvedRequests, childRequest) {\r\n        var injection = resolveRequest(childRequest);\r\n        var targetType = childRequest.target.type;\r\n        if (targetType === TargetTypeEnum.ConstructorArgument) {\r\n            resolvedRequests.constructorInjections.push(injection);\r\n        }\r\n        else {\r\n            resolvedRequests.propertyRequests.push(childRequest);\r\n            resolvedRequests.propertyInjections.push(injection);\r\n        }\r\n        if (!resolvedRequests.isAsync) {\r\n            resolvedRequests.isAsync = isPromiseOrContainsPromise(injection);\r\n        }\r\n        return resolvedRequests;\r\n    }, { constructorInjections: [], propertyInjections: [], propertyRequests: [], isAsync: false });\r\n}\r\nfunction _createInstance(constr, childRequests, resolveRequest) {\r\n    var result;\r\n    if (childRequests.length > 0) {\r\n        var resolved = _resolveRequests(childRequests, resolveRequest);\r\n        var createInstanceWithInjectionsArg = __assign(__assign({}, resolved), { constr: constr });\r\n        if (resolved.isAsync) {\r\n            result = createInstanceWithInjectionsAsync(createInstanceWithInjectionsArg);\r\n        }\r\n        else {\r\n            result = createInstanceWithInjections(createInstanceWithInjectionsArg);\r\n        }\r\n    }\r\n    else {\r\n        result = new constr();\r\n    }\r\n    return result;\r\n}\r\nfunction createInstanceWithInjections(args) {\r\n    var _a;\r\n    var instance = new ((_a = args.constr).bind.apply(_a, __spreadArray([void 0], args.constructorInjections, false)))();\r\n    args.propertyRequests.forEach(function (r, index) {\r\n        var property = r.target.identifier;\r\n        var injection = args.propertyInjections[index];\r\n        if (!r.target.isOptional() || injection !== undefined) {\r\n            instance[property] = injection;\r\n        }\r\n    });\r\n    return instance;\r\n}\r\nfunction createInstanceWithInjectionsAsync(args) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var constructorInjections, propertyInjections;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4, possiblyWaitInjections(args.constructorInjections)];\r\n                case 1:\r\n                    constructorInjections = _a.sent();\r\n                    return [4, possiblyWaitInjections(args.propertyInjections)];\r\n                case 2:\r\n                    propertyInjections = _a.sent();\r\n                    return [2, createInstanceWithInjections(__assign(__assign({}, args), { constructorInjections: constructorInjections, propertyInjections: propertyInjections }))];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction possiblyWaitInjections(possiblePromiseinjections) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var injections, _i, possiblePromiseinjections_1, injection;\r\n        return __generator(this, function (_a) {\r\n            injections = [];\r\n            for (_i = 0, possiblePromiseinjections_1 = possiblePromiseinjections; _i < possiblePromiseinjections_1.length; _i++) {\r\n                injection = possiblePromiseinjections_1[_i];\r\n                if (Array.isArray(injection)) {\r\n                    injections.push(Promise.all(injection));\r\n                }\r\n                else {\r\n                    injections.push(injection);\r\n                }\r\n            }\r\n            return [2, Promise.all(injections)];\r\n        });\r\n    });\r\n}\r\nfunction _getInstanceAfterPostConstruct(constr, result) {\r\n    var postConstructResult = _postConstruct(constr, result);\r\n    if (isPromise(postConstructResult)) {\r\n        return postConstructResult.then(function () { return result; });\r\n    }\r\n    else {\r\n        return result;\r\n    }\r\n}\r\nfunction _postConstruct(constr, instance) {\r\n    var _a, _b;\r\n    if (Reflect.hasMetadata(METADATA_KEY.POST_CONSTRUCT, constr)) {\r\n        var data = Reflect.getMetadata(METADATA_KEY.POST_CONSTRUCT, constr);\r\n        try {\r\n            return (_b = (_a = instance)[data.value]) === null || _b === void 0 ? void 0 : _b.call(_a);\r\n        }\r\n        catch (e) {\r\n            if (e instanceof Error) {\r\n                throw new Error(POST_CONSTRUCT_ERROR(constr.name, e.message));\r\n            }\r\n        }\r\n    }\r\n}\r\nfunction _validateInstanceResolution(binding, constr) {\r\n    if (binding.scope !== BindingScopeEnum.Singleton) {\r\n        _throwIfHandlingDeactivation(binding, constr);\r\n    }\r\n}\r\nfunction _throwIfHandlingDeactivation(binding, constr) {\r\n    var scopeErrorMessage = \"Class cannot be instantiated in \" + (binding.scope === BindingScopeEnum.Request ?\r\n        'request' :\r\n        'transient') + \" scope.\";\r\n    if (typeof binding.onDeactivation === 'function') {\r\n        throw new Error(ON_DEACTIVATION_ERROR(constr.name, scopeErrorMessage));\r\n    }\r\n    if (Reflect.hasMetadata(METADATA_KEY.PRE_DESTROY, constr)) {\r\n        throw new Error(PRE_DESTROY_ERROR(constr.name, scopeErrorMessage));\r\n    }\r\n}\r\nfunction resolveInstance(binding, constr, childRequests, resolveRequest) {\r\n    _validateInstanceResolution(binding, constr);\r\n    var result = _createInstance(constr, childRequests, resolveRequest);\r\n    if (isPromise(result)) {\r\n        return result.then(function (resolvedResult) { return _getInstanceAfterPostConstruct(constr, resolvedResult); });\r\n    }\r\n    else {\r\n        return _getInstanceAfterPostConstruct(constr, result);\r\n    }\r\n}\r\nexport { resolveInstance };\r\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport * as ERROR_MSGS from '../constants/error_msgs';\r\nimport { BindingTypeEnum } from '../constants/literal_types';\r\nimport { getBindingDictionary } from '../planning/planner';\r\nimport { saveToScope, tryGetFromScope } from '../scope/scope';\r\nimport { isPromise } from '../utils/async';\r\nimport { getFactoryDetails, ensureFullyBound } from '../utils/binding_utils';\r\nimport { tryAndThrowErrorIfStackOverflow } from '../utils/exceptions';\r\nimport { resolveInstance } from './instantiation';\r\nvar _resolveRequest = function (requestScope) {\r\n    return function (request) {\r\n        request.parentContext.setCurrentRequest(request);\r\n        var bindings = request.bindings;\r\n        var childRequests = request.childRequests;\r\n        var targetIsAnArray = request.target && request.target.isArray();\r\n        var targetParentIsNotAnArray = !request.parentRequest ||\r\n            !request.parentRequest.target ||\r\n            !request.target ||\r\n            !request.parentRequest.target.matchesArray(request.target.serviceIdentifier);\r\n        if (targetIsAnArray && targetParentIsNotAnArray) {\r\n            return childRequests.map(function (childRequest) {\r\n                var _f = _resolveRequest(requestScope);\r\n                return _f(childRequest);\r\n            });\r\n        }\r\n        else {\r\n            if (request.target.isOptional() && bindings.length === 0) {\r\n                return undefined;\r\n            }\r\n            var binding = bindings[0];\r\n            return _resolveBinding(requestScope, request, binding);\r\n        }\r\n    };\r\n};\r\nvar _resolveFactoryFromBinding = function (binding, context) {\r\n    var factoryDetails = getFactoryDetails(binding);\r\n    return tryAndThrowErrorIfStackOverflow(function () { return factoryDetails.factory.bind(binding)(context); }, function () { return new Error(ERROR_MSGS.CIRCULAR_DEPENDENCY_IN_FACTORY(factoryDetails.factoryType, context.currentRequest.serviceIdentifier.toString())); });\r\n};\r\nvar _getResolvedFromBinding = function (requestScope, request, binding) {\r\n    var result;\r\n    var childRequests = request.childRequests;\r\n    ensureFullyBound(binding);\r\n    switch (binding.type) {\r\n        case BindingTypeEnum.ConstantValue:\r\n        case BindingTypeEnum.Function:\r\n            result = binding.cache;\r\n            break;\r\n        case BindingTypeEnum.Constructor:\r\n            result = binding.implementationType;\r\n            break;\r\n        case BindingTypeEnum.Instance:\r\n            result = resolveInstance(binding, binding.implementationType, childRequests, _resolveRequest(requestScope));\r\n            break;\r\n        default:\r\n            result = _resolveFactoryFromBinding(binding, request.parentContext);\r\n    }\r\n    return result;\r\n};\r\nvar _resolveInScope = function (requestScope, binding, resolveFromBinding) {\r\n    var result = tryGetFromScope(requestScope, binding);\r\n    if (result !== null) {\r\n        return result;\r\n    }\r\n    result = resolveFromBinding();\r\n    saveToScope(requestScope, binding, result);\r\n    return result;\r\n};\r\nvar _resolveBinding = function (requestScope, request, binding) {\r\n    return _resolveInScope(requestScope, binding, function () {\r\n        var result = _getResolvedFromBinding(requestScope, request, binding);\r\n        if (isPromise(result)) {\r\n            result = result.then(function (resolved) { return _onActivation(request, binding, resolved); });\r\n        }\r\n        else {\r\n            result = _onActivation(request, binding, result);\r\n        }\r\n        return result;\r\n    });\r\n};\r\nfunction _onActivation(request, binding, resolved) {\r\n    var result = _bindingActivation(request.parentContext, binding, resolved);\r\n    var containersIterator = _getContainersIterator(request.parentContext.container);\r\n    var container;\r\n    var containersIteratorResult = containersIterator.next();\r\n    do {\r\n        container = containersIteratorResult.value;\r\n        var context_1 = request.parentContext;\r\n        var serviceIdentifier = request.serviceIdentifier;\r\n        var activationsIterator = _getContainerActivationsForService(container, serviceIdentifier);\r\n        if (isPromise(result)) {\r\n            result = _activateContainerAsync(activationsIterator, context_1, result);\r\n        }\r\n        else {\r\n            result = _activateContainer(activationsIterator, context_1, result);\r\n        }\r\n        containersIteratorResult = containersIterator.next();\r\n    } while (containersIteratorResult.done !== true && !getBindingDictionary(container).hasKey(request.serviceIdentifier));\r\n    return result;\r\n}\r\nvar _bindingActivation = function (context, binding, previousResult) {\r\n    var result;\r\n    if (typeof binding.onActivation === 'function') {\r\n        result = binding.onActivation(context, previousResult);\r\n    }\r\n    else {\r\n        result = previousResult;\r\n    }\r\n    return result;\r\n};\r\nvar _activateContainer = function (activationsIterator, context, result) {\r\n    var activation = activationsIterator.next();\r\n    while (!activation.done) {\r\n        result = activation.value(context, result);\r\n        if (isPromise(result)) {\r\n            return _activateContainerAsync(activationsIterator, context, result);\r\n        }\r\n        activation = activationsIterator.next();\r\n    }\r\n    return result;\r\n};\r\nvar _activateContainerAsync = function (activationsIterator, context, resultPromise) { return __awaiter(void 0, void 0, void 0, function () {\r\n    var result, activation;\r\n    return __generator(this, function (_a) {\r\n        switch (_a.label) {\r\n            case 0: return [4, resultPromise];\r\n            case 1:\r\n                result = _a.sent();\r\n                activation = activationsIterator.next();\r\n                _a.label = 2;\r\n            case 2:\r\n                if (!!activation.done) return [3, 4];\r\n                return [4, activation.value(context, result)];\r\n            case 3:\r\n                result = _a.sent();\r\n                activation = activationsIterator.next();\r\n                return [3, 2];\r\n            case 4: return [2, result];\r\n        }\r\n    });\r\n}); };\r\nvar _getContainerActivationsForService = function (container, serviceIdentifier) {\r\n    var activations = container._activations;\r\n    return activations.hasKey(serviceIdentifier) ? activations.get(serviceIdentifier).values() : [].values();\r\n};\r\nvar _getContainersIterator = function (container) {\r\n    var containersStack = [container];\r\n    var parent = container.parent;\r\n    while (parent !== null) {\r\n        containersStack.push(parent);\r\n        parent = parent.parent;\r\n    }\r\n    var getNextContainer = function () {\r\n        var nextContainer = containersStack.pop();\r\n        if (nextContainer !== undefined) {\r\n            return { done: false, value: nextContainer };\r\n        }\r\n        else {\r\n            return { done: true, value: undefined };\r\n        }\r\n    };\r\n    var containersIterator = {\r\n        next: getNextContainer,\r\n    };\r\n    return containersIterator;\r\n};\r\nfunction resolve(context) {\r\n    var _f = _resolveRequest(context.plan.rootRequest.requestScope);\r\n    return _f(context.plan.rootRequest);\r\n}\r\nexport { resolve };\r\n","import * as METADATA_KEY from '../constants/metadata_keys';\r\nimport { Metadata } from '../planning/metadata';\r\nvar traverseAncerstors = function (request, constraint) {\r\n    var parent = request.parentRequest;\r\n    if (parent !== null) {\r\n        return constraint(parent) ? true : traverseAncerstors(parent, constraint);\r\n    }\r\n    else {\r\n        return false;\r\n    }\r\n};\r\nvar taggedConstraint = function (key) { return function (value) {\r\n    var constraint = function (request) {\r\n        return request !== null && request.target !== null && request.target.matchesTag(key)(value);\r\n    };\r\n    constraint.metaData = new Metadata(key, value);\r\n    return constraint;\r\n}; };\r\nvar namedConstraint = taggedConstraint(METADATA_KEY.NAMED_TAG);\r\nvar typeConstraint = function (type) { return function (request) {\r\n    var binding = null;\r\n    if (request !== null) {\r\n        binding = request.bindings[0];\r\n        if (typeof type === 'string') {\r\n            var serviceIdentifier = binding.serviceIdentifier;\r\n            return serviceIdentifier === type;\r\n        }\r\n        else {\r\n            var constructor = request.bindings[0].implementationType;\r\n            return type === constructor;\r\n        }\r\n    }\r\n    return false;\r\n}; };\r\nexport { traverseAncerstors, taggedConstraint, namedConstraint, typeConstraint };\r\n","import { BindingOnSyntax } from './binding_on_syntax';\r\nimport { namedConstraint, taggedConstraint, traverseAncerstors, typeConstraint } from './constraint_helpers';\r\nvar BindingWhenSyntax = (function () {\r\n    function BindingWhenSyntax(binding) {\r\n        this._binding = binding;\r\n    }\r\n    BindingWhenSyntax.prototype.when = function (constraint) {\r\n        this._binding.constraint = constraint;\r\n        return new BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenTargetNamed = function (name) {\r\n        this._binding.constraint = namedConstraint(name);\r\n        return new BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenTargetIsDefault = function () {\r\n        this._binding.constraint = function (request) {\r\n            if (request === null) {\r\n                return false;\r\n            }\r\n            var targetIsDefault = (request.target !== null) &&\r\n                (!request.target.isNamed()) &&\r\n                (!request.target.isTagged());\r\n            return targetIsDefault;\r\n        };\r\n        return new BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenTargetTagged = function (tag, value) {\r\n        this._binding.constraint = taggedConstraint(tag)(value);\r\n        return new BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenInjectedInto = function (parent) {\r\n        this._binding.constraint = function (request) {\r\n            return request !== null && typeConstraint(parent)(request.parentRequest);\r\n        };\r\n        return new BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenParentNamed = function (name) {\r\n        this._binding.constraint = function (request) {\r\n            return request !== null && namedConstraint(name)(request.parentRequest);\r\n        };\r\n        return new BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenParentTagged = function (tag, value) {\r\n        this._binding.constraint = function (request) {\r\n            return request !== null && taggedConstraint(tag)(value)(request.parentRequest);\r\n        };\r\n        return new BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenAnyAncestorIs = function (ancestor) {\r\n        this._binding.constraint = function (request) {\r\n            return request !== null && traverseAncerstors(request, typeConstraint(ancestor));\r\n        };\r\n        return new BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenNoAncestorIs = function (ancestor) {\r\n        this._binding.constraint = function (request) {\r\n            return request !== null && !traverseAncerstors(request, typeConstraint(ancestor));\r\n        };\r\n        return new BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenAnyAncestorNamed = function (name) {\r\n        this._binding.constraint = function (request) {\r\n            return request !== null && traverseAncerstors(request, namedConstraint(name));\r\n        };\r\n        return new BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenNoAncestorNamed = function (name) {\r\n        this._binding.constraint = function (request) {\r\n            return request !== null && !traverseAncerstors(request, namedConstraint(name));\r\n        };\r\n        return new BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenAnyAncestorTagged = function (tag, value) {\r\n        this._binding.constraint = function (request) {\r\n            return request !== null && traverseAncerstors(request, taggedConstraint(tag)(value));\r\n        };\r\n        return new BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenNoAncestorTagged = function (tag, value) {\r\n        this._binding.constraint = function (request) {\r\n            return request !== null && !traverseAncerstors(request, taggedConstraint(tag)(value));\r\n        };\r\n        return new BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenAnyAncestorMatches = function (constraint) {\r\n        this._binding.constraint = function (request) {\r\n            return request !== null && traverseAncerstors(request, constraint);\r\n        };\r\n        return new BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenNoAncestorMatches = function (constraint) {\r\n        this._binding.constraint = function (request) {\r\n            return request !== null && !traverseAncerstors(request, constraint);\r\n        };\r\n        return new BindingOnSyntax(this._binding);\r\n    };\r\n    return BindingWhenSyntax;\r\n}());\r\nexport { BindingWhenSyntax };\r\n","import { BindingWhenSyntax } from './binding_when_syntax';\r\nvar BindingOnSyntax = (function () {\r\n    function BindingOnSyntax(binding) {\r\n        this._binding = binding;\r\n    }\r\n    BindingOnSyntax.prototype.onActivation = function (handler) {\r\n        this._binding.onActivation = handler;\r\n        return new BindingWhenSyntax(this._binding);\r\n    };\r\n    BindingOnSyntax.prototype.onDeactivation = function (handler) {\r\n        this._binding.onDeactivation = handler;\r\n        return new BindingWhenSyntax(this._binding);\r\n    };\r\n    return BindingOnSyntax;\r\n}());\r\nexport { BindingOnSyntax };\r\n","import { BindingOnSyntax } from './binding_on_syntax';\r\nimport { BindingWhenSyntax } from './binding_when_syntax';\r\nvar BindingWhenOnSyntax = (function () {\r\n    function BindingWhenOnSyntax(binding) {\r\n        this._binding = binding;\r\n        this._bindingWhenSyntax = new BindingWhenSyntax(this._binding);\r\n        this._bindingOnSyntax = new BindingOnSyntax(this._binding);\r\n    }\r\n    BindingWhenOnSyntax.prototype.when = function (constraint) {\r\n        return this._bindingWhenSyntax.when(constraint);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenTargetNamed = function (name) {\r\n        return this._bindingWhenSyntax.whenTargetNamed(name);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenTargetIsDefault = function () {\r\n        return this._bindingWhenSyntax.whenTargetIsDefault();\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenTargetTagged = function (tag, value) {\r\n        return this._bindingWhenSyntax.whenTargetTagged(tag, value);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenInjectedInto = function (parent) {\r\n        return this._bindingWhenSyntax.whenInjectedInto(parent);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenParentNamed = function (name) {\r\n        return this._bindingWhenSyntax.whenParentNamed(name);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenParentTagged = function (tag, value) {\r\n        return this._bindingWhenSyntax.whenParentTagged(tag, value);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenAnyAncestorIs = function (ancestor) {\r\n        return this._bindingWhenSyntax.whenAnyAncestorIs(ancestor);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenNoAncestorIs = function (ancestor) {\r\n        return this._bindingWhenSyntax.whenNoAncestorIs(ancestor);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenAnyAncestorNamed = function (name) {\r\n        return this._bindingWhenSyntax.whenAnyAncestorNamed(name);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenAnyAncestorTagged = function (tag, value) {\r\n        return this._bindingWhenSyntax.whenAnyAncestorTagged(tag, value);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenNoAncestorNamed = function (name) {\r\n        return this._bindingWhenSyntax.whenNoAncestorNamed(name);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenNoAncestorTagged = function (tag, value) {\r\n        return this._bindingWhenSyntax.whenNoAncestorTagged(tag, value);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenAnyAncestorMatches = function (constraint) {\r\n        return this._bindingWhenSyntax.whenAnyAncestorMatches(constraint);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenNoAncestorMatches = function (constraint) {\r\n        return this._bindingWhenSyntax.whenNoAncestorMatches(constraint);\r\n    };\r\n    BindingWhenOnSyntax.prototype.onActivation = function (handler) {\r\n        return this._bindingOnSyntax.onActivation(handler);\r\n    };\r\n    BindingWhenOnSyntax.prototype.onDeactivation = function (handler) {\r\n        return this._bindingOnSyntax.onDeactivation(handler);\r\n    };\r\n    return BindingWhenOnSyntax;\r\n}());\r\nexport { BindingWhenOnSyntax };\r\n","import { BindingScopeEnum } from '../constants/literal_types';\r\nimport { BindingWhenOnSyntax } from './binding_when_on_syntax';\r\nvar BindingInSyntax = (function () {\r\n    function BindingInSyntax(binding) {\r\n        this._binding = binding;\r\n    }\r\n    BindingInSyntax.prototype.inRequestScope = function () {\r\n        this._binding.scope = BindingScopeEnum.Request;\r\n        return new BindingWhenOnSyntax(this._binding);\r\n    };\r\n    BindingInSyntax.prototype.inSingletonScope = function () {\r\n        this._binding.scope = BindingScopeEnum.Singleton;\r\n        return new BindingWhenOnSyntax(this._binding);\r\n    };\r\n    BindingInSyntax.prototype.inTransientScope = function () {\r\n        this._binding.scope = BindingScopeEnum.Transient;\r\n        return new BindingWhenOnSyntax(this._binding);\r\n    };\r\n    return BindingInSyntax;\r\n}());\r\nexport { BindingInSyntax };\r\n","import { BindingInSyntax } from './binding_in_syntax';\r\nimport { BindingOnSyntax } from './binding_on_syntax';\r\nimport { BindingWhenSyntax } from './binding_when_syntax';\r\nvar BindingInWhenOnSyntax = (function () {\r\n    function BindingInWhenOnSyntax(binding) {\r\n        this._binding = binding;\r\n        this._bindingWhenSyntax = new BindingWhenSyntax(this._binding);\r\n        this._bindingOnSyntax = new BindingOnSyntax(this._binding);\r\n        this._bindingInSyntax = new BindingInSyntax(binding);\r\n    }\r\n    BindingInWhenOnSyntax.prototype.inRequestScope = function () {\r\n        return this._bindingInSyntax.inRequestScope();\r\n    };\r\n    BindingInWhenOnSyntax.prototype.inSingletonScope = function () {\r\n        return this._bindingInSyntax.inSingletonScope();\r\n    };\r\n    BindingInWhenOnSyntax.prototype.inTransientScope = function () {\r\n        return this._bindingInSyntax.inTransientScope();\r\n    };\r\n    BindingInWhenOnSyntax.prototype.when = function (constraint) {\r\n        return this._bindingWhenSyntax.when(constraint);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenTargetNamed = function (name) {\r\n        return this._bindingWhenSyntax.whenTargetNamed(name);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenTargetIsDefault = function () {\r\n        return this._bindingWhenSyntax.whenTargetIsDefault();\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenTargetTagged = function (tag, value) {\r\n        return this._bindingWhenSyntax.whenTargetTagged(tag, value);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenInjectedInto = function (parent) {\r\n        return this._bindingWhenSyntax.whenInjectedInto(parent);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenParentNamed = function (name) {\r\n        return this._bindingWhenSyntax.whenParentNamed(name);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenParentTagged = function (tag, value) {\r\n        return this._bindingWhenSyntax.whenParentTagged(tag, value);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenAnyAncestorIs = function (ancestor) {\r\n        return this._bindingWhenSyntax.whenAnyAncestorIs(ancestor);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenNoAncestorIs = function (ancestor) {\r\n        return this._bindingWhenSyntax.whenNoAncestorIs(ancestor);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenAnyAncestorNamed = function (name) {\r\n        return this._bindingWhenSyntax.whenAnyAncestorNamed(name);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenAnyAncestorTagged = function (tag, value) {\r\n        return this._bindingWhenSyntax.whenAnyAncestorTagged(tag, value);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenNoAncestorNamed = function (name) {\r\n        return this._bindingWhenSyntax.whenNoAncestorNamed(name);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenNoAncestorTagged = function (tag, value) {\r\n        return this._bindingWhenSyntax.whenNoAncestorTagged(tag, value);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenAnyAncestorMatches = function (constraint) {\r\n        return this._bindingWhenSyntax.whenAnyAncestorMatches(constraint);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenNoAncestorMatches = function (constraint) {\r\n        return this._bindingWhenSyntax.whenNoAncestorMatches(constraint);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.onActivation = function (handler) {\r\n        return this._bindingOnSyntax.onActivation(handler);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.onDeactivation = function (handler) {\r\n        return this._bindingOnSyntax.onDeactivation(handler);\r\n    };\r\n    return BindingInWhenOnSyntax;\r\n}());\r\nexport { BindingInWhenOnSyntax };\r\n","import * as ERROR_MSGS from \"../constants/error_msgs\";\r\nimport { BindingScopeEnum, BindingTypeEnum } from \"../constants/literal_types\";\r\nimport { BindingInWhenOnSyntax } from \"./binding_in_when_on_syntax\";\r\nimport { BindingWhenOnSyntax } from \"./binding_when_on_syntax\";\r\nvar BindingToSyntax = (function () {\r\n    function BindingToSyntax(binding) {\r\n        this._binding = binding;\r\n    }\r\n    BindingToSyntax.prototype.to = function (constructor) {\r\n        this._binding.type = BindingTypeEnum.Instance;\r\n        this._binding.implementationType = constructor;\r\n        return new BindingInWhenOnSyntax(this._binding);\r\n    };\r\n    BindingToSyntax.prototype.toSelf = function () {\r\n        if (typeof this._binding.serviceIdentifier !== \"function\") {\r\n            throw new Error(\"\" + ERROR_MSGS.INVALID_TO_SELF_VALUE);\r\n        }\r\n        var self = this._binding.serviceIdentifier;\r\n        return this.to(self);\r\n    };\r\n    BindingToSyntax.prototype.toConstantValue = function (value) {\r\n        this._binding.type = BindingTypeEnum.ConstantValue;\r\n        this._binding.cache = value;\r\n        this._binding.dynamicValue = null;\r\n        this._binding.implementationType = null;\r\n        this._binding.scope = BindingScopeEnum.Singleton;\r\n        return new BindingWhenOnSyntax(this._binding);\r\n    };\r\n    BindingToSyntax.prototype.toDynamicValue = function (func) {\r\n        this._binding.type = BindingTypeEnum.DynamicValue;\r\n        this._binding.cache = null;\r\n        this._binding.dynamicValue = func;\r\n        this._binding.implementationType = null;\r\n        return new BindingInWhenOnSyntax(this._binding);\r\n    };\r\n    BindingToSyntax.prototype.toConstructor = function (constructor) {\r\n        this._binding.type = BindingTypeEnum.Constructor;\r\n        this._binding.implementationType = constructor;\r\n        this._binding.scope = BindingScopeEnum.Singleton;\r\n        return new BindingWhenOnSyntax(this._binding);\r\n    };\r\n    BindingToSyntax.prototype.toFactory = function (factory) {\r\n        this._binding.type = BindingTypeEnum.Factory;\r\n        this._binding.factory = factory;\r\n        this._binding.scope = BindingScopeEnum.Singleton;\r\n        return new BindingWhenOnSyntax(this._binding);\r\n    };\r\n    BindingToSyntax.prototype.toFunction = function (func) {\r\n        if (typeof func !== \"function\") {\r\n            throw new Error(ERROR_MSGS.INVALID_FUNCTION_BINDING);\r\n        }\r\n        var bindingWhenOnSyntax = this.toConstantValue(func);\r\n        this._binding.type = BindingTypeEnum.Function;\r\n        this._binding.scope = BindingScopeEnum.Singleton;\r\n        return bindingWhenOnSyntax;\r\n    };\r\n    BindingToSyntax.prototype.toAutoFactory = function (serviceIdentifier) {\r\n        this._binding.type = BindingTypeEnum.Factory;\r\n        this._binding.factory = function (context) {\r\n            var autofactory = function () { return context.container.get(serviceIdentifier); };\r\n            return autofactory;\r\n        };\r\n        this._binding.scope = BindingScopeEnum.Singleton;\r\n        return new BindingWhenOnSyntax(this._binding);\r\n    };\r\n    BindingToSyntax.prototype.toAutoNamedFactory = function (serviceIdentifier) {\r\n        this._binding.type = BindingTypeEnum.Factory;\r\n        this._binding.factory = function (context) {\r\n            return function (named) { return context.container.getNamed(serviceIdentifier, named); };\r\n        };\r\n        return new BindingWhenOnSyntax(this._binding);\r\n    };\r\n    BindingToSyntax.prototype.toProvider = function (provider) {\r\n        this._binding.type = BindingTypeEnum.Provider;\r\n        this._binding.provider = provider;\r\n        this._binding.scope = BindingScopeEnum.Singleton;\r\n        return new BindingWhenOnSyntax(this._binding);\r\n    };\r\n    BindingToSyntax.prototype.toService = function (service) {\r\n        this.toDynamicValue(function (context) { return context.container.get(service); });\r\n    };\r\n    return BindingToSyntax;\r\n}());\r\nexport { BindingToSyntax };\r\n","var ContainerSnapshot = (function () {\r\n    function ContainerSnapshot() {\r\n    }\r\n    ContainerSnapshot.of = function (bindings, middleware, activations, deactivations, moduleActivationStore) {\r\n        var snapshot = new ContainerSnapshot();\r\n        snapshot.bindings = bindings;\r\n        snapshot.middleware = middleware;\r\n        snapshot.deactivations = deactivations;\r\n        snapshot.activations = activations;\r\n        snapshot.moduleActivationStore = moduleActivationStore;\r\n        return snapshot;\r\n    };\r\n    return ContainerSnapshot;\r\n}());\r\nexport { ContainerSnapshot };\r\n","import * as ERROR_MSGS from '../constants/error_msgs';\r\nimport { isClonable } from '../utils/clonable';\r\nvar Lookup = (function () {\r\n    function Lookup() {\r\n        this._map = new Map();\r\n    }\r\n    Lookup.prototype.getMap = function () {\r\n        return this._map;\r\n    };\r\n    Lookup.prototype.add = function (serviceIdentifier, value) {\r\n        if (serviceIdentifier === null || serviceIdentifier === undefined) {\r\n            throw new Error(ERROR_MSGS.NULL_ARGUMENT);\r\n        }\r\n        if (value === null || value === undefined) {\r\n            throw new Error(ERROR_MSGS.NULL_ARGUMENT);\r\n        }\r\n        var entry = this._map.get(serviceIdentifier);\r\n        if (entry !== undefined) {\r\n            entry.push(value);\r\n        }\r\n        else {\r\n            this._map.set(serviceIdentifier, [value]);\r\n        }\r\n    };\r\n    Lookup.prototype.get = function (serviceIdentifier) {\r\n        if (serviceIdentifier === null || serviceIdentifier === undefined) {\r\n            throw new Error(ERROR_MSGS.NULL_ARGUMENT);\r\n        }\r\n        var entry = this._map.get(serviceIdentifier);\r\n        if (entry !== undefined) {\r\n            return entry;\r\n        }\r\n        else {\r\n            throw new Error(ERROR_MSGS.KEY_NOT_FOUND);\r\n        }\r\n    };\r\n    Lookup.prototype.remove = function (serviceIdentifier) {\r\n        if (serviceIdentifier === null || serviceIdentifier === undefined) {\r\n            throw new Error(ERROR_MSGS.NULL_ARGUMENT);\r\n        }\r\n        if (!this._map.delete(serviceIdentifier)) {\r\n            throw new Error(ERROR_MSGS.KEY_NOT_FOUND);\r\n        }\r\n    };\r\n    Lookup.prototype.removeIntersection = function (lookup) {\r\n        var _this = this;\r\n        this.traverse(function (serviceIdentifier, value) {\r\n            var lookupActivations = lookup.hasKey(serviceIdentifier) ? lookup.get(serviceIdentifier) : undefined;\r\n            if (lookupActivations !== undefined) {\r\n                var filteredValues = value.filter(function (lookupValue) {\r\n                    return !lookupActivations.some(function (moduleActivation) { return lookupValue === moduleActivation; });\r\n                });\r\n                _this._setValue(serviceIdentifier, filteredValues);\r\n            }\r\n        });\r\n    };\r\n    Lookup.prototype.removeByCondition = function (condition) {\r\n        var _this = this;\r\n        var removals = [];\r\n        this._map.forEach(function (entries, key) {\r\n            var updatedEntries = [];\r\n            for (var _i = 0, entries_1 = entries; _i < entries_1.length; _i++) {\r\n                var entry = entries_1[_i];\r\n                var remove = condition(entry);\r\n                if (remove) {\r\n                    removals.push(entry);\r\n                }\r\n                else {\r\n                    updatedEntries.push(entry);\r\n                }\r\n            }\r\n            _this._setValue(key, updatedEntries);\r\n        });\r\n        return removals;\r\n    };\r\n    Lookup.prototype.hasKey = function (serviceIdentifier) {\r\n        if (serviceIdentifier === null || serviceIdentifier === undefined) {\r\n            throw new Error(ERROR_MSGS.NULL_ARGUMENT);\r\n        }\r\n        return this._map.has(serviceIdentifier);\r\n    };\r\n    Lookup.prototype.clone = function () {\r\n        var copy = new Lookup();\r\n        this._map.forEach(function (value, key) {\r\n            value.forEach(function (b) { return copy.add(key, isClonable(b) ? b.clone() : b); });\r\n        });\r\n        return copy;\r\n    };\r\n    Lookup.prototype.traverse = function (func) {\r\n        this._map.forEach(function (value, key) {\r\n            func(key, value);\r\n        });\r\n    };\r\n    Lookup.prototype._setValue = function (serviceIdentifier, value) {\r\n        if (value.length > 0) {\r\n            this._map.set(serviceIdentifier, value);\r\n        }\r\n        else {\r\n            this._map.delete(serviceIdentifier);\r\n        }\r\n    };\r\n    return Lookup;\r\n}());\r\nexport { Lookup };\r\n","function isClonable(obj) {\r\n    return (typeof obj === 'object')\r\n        && (obj !== null)\r\n        && ('clone' in obj)\r\n        && typeof obj.clone === 'function';\r\n}\r\nexport { isClonable };\r\n","import { Lookup } from './lookup';\r\nvar ModuleActivationStore = (function () {\r\n    function ModuleActivationStore() {\r\n        this._map = new Map();\r\n    }\r\n    ModuleActivationStore.prototype.remove = function (moduleId) {\r\n        if (this._map.has(moduleId)) {\r\n            var handlers = this._map.get(moduleId);\r\n            this._map.delete(moduleId);\r\n            return handlers;\r\n        }\r\n        return this._getEmptyHandlersStore();\r\n    };\r\n    ModuleActivationStore.prototype.addDeactivation = function (moduleId, serviceIdentifier, onDeactivation) {\r\n        this._getModuleActivationHandlers(moduleId)\r\n            .onDeactivations.add(serviceIdentifier, onDeactivation);\r\n    };\r\n    ModuleActivationStore.prototype.addActivation = function (moduleId, serviceIdentifier, onActivation) {\r\n        this._getModuleActivationHandlers(moduleId)\r\n            .onActivations.add(serviceIdentifier, onActivation);\r\n    };\r\n    ModuleActivationStore.prototype.clone = function () {\r\n        var clone = new ModuleActivationStore();\r\n        this._map.forEach(function (handlersStore, moduleId) {\r\n            clone._map.set(moduleId, {\r\n                onActivations: handlersStore.onActivations.clone(),\r\n                onDeactivations: handlersStore.onDeactivations.clone(),\r\n            });\r\n        });\r\n        return clone;\r\n    };\r\n    ModuleActivationStore.prototype._getModuleActivationHandlers = function (moduleId) {\r\n        var moduleActivationHandlers = this._map.get(moduleId);\r\n        if (moduleActivationHandlers === undefined) {\r\n            moduleActivationHandlers = this._getEmptyHandlersStore();\r\n            this._map.set(moduleId, moduleActivationHandlers);\r\n        }\r\n        return moduleActivationHandlers;\r\n    };\r\n    ModuleActivationStore.prototype._getEmptyHandlersStore = function () {\r\n        var handlersStore = {\r\n            onActivations: new Lookup(),\r\n            onDeactivations: new Lookup()\r\n        };\r\n        return handlersStore;\r\n    };\r\n    return ModuleActivationStore;\r\n}());\r\nexport { ModuleActivationStore };\r\n","var __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n};\r\nimport { Binding } from '../bindings/binding';\r\nimport * as ERROR_MSGS from '../constants/error_msgs';\r\nimport { BindingScopeEnum, TargetTypeEnum } from '../constants/literal_types';\r\nimport * as METADATA_KEY from '../constants/metadata_keys';\r\nimport { MetadataReader } from '../planning/metadata_reader';\r\nimport { createMockRequest, getBindingDictionary, plan } from '../planning/planner';\r\nimport { resolve } from '../resolution/resolver';\r\nimport { BindingToSyntax } from '../syntax/binding_to_syntax';\r\nimport { isPromise, isPromiseOrContainsPromise } from '../utils/async';\r\nimport { id } from '../utils/id';\r\nimport { getServiceIdentifierAsString } from '../utils/serialization';\r\nimport { ContainerSnapshot } from './container_snapshot';\r\nimport { Lookup } from './lookup';\r\nimport { ModuleActivationStore } from './module_activation_store';\r\nvar Container = (function () {\r\n    function Container(containerOptions) {\r\n        var options = containerOptions || {};\r\n        if (typeof options !== 'object') {\r\n            throw new Error(\"\" + ERROR_MSGS.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);\r\n        }\r\n        if (options.defaultScope === undefined) {\r\n            options.defaultScope = BindingScopeEnum.Transient;\r\n        }\r\n        else if (options.defaultScope !== BindingScopeEnum.Singleton &&\r\n            options.defaultScope !== BindingScopeEnum.Transient &&\r\n            options.defaultScope !== BindingScopeEnum.Request) {\r\n            throw new Error(\"\" + ERROR_MSGS.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);\r\n        }\r\n        if (options.autoBindInjectable === undefined) {\r\n            options.autoBindInjectable = false;\r\n        }\r\n        else if (typeof options.autoBindInjectable !== 'boolean') {\r\n            throw new Error(\"\" + ERROR_MSGS.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);\r\n        }\r\n        if (options.skipBaseClassChecks === undefined) {\r\n            options.skipBaseClassChecks = false;\r\n        }\r\n        else if (typeof options.skipBaseClassChecks !== 'boolean') {\r\n            throw new Error(\"\" + ERROR_MSGS.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);\r\n        }\r\n        this.options = {\r\n            autoBindInjectable: options.autoBindInjectable,\r\n            defaultScope: options.defaultScope,\r\n            skipBaseClassChecks: options.skipBaseClassChecks\r\n        };\r\n        this.id = id();\r\n        this._bindingDictionary = new Lookup();\r\n        this._snapshots = [];\r\n        this._middleware = null;\r\n        this._activations = new Lookup();\r\n        this._deactivations = new Lookup();\r\n        this.parent = null;\r\n        this._metadataReader = new MetadataReader();\r\n        this._moduleActivationStore = new ModuleActivationStore();\r\n    }\r\n    Container.merge = function (container1, container2) {\r\n        var containers = [];\r\n        for (var _i = 2; _i < arguments.length; _i++) {\r\n            containers[_i - 2] = arguments[_i];\r\n        }\r\n        var container = new Container();\r\n        var targetContainers = __spreadArray([container1, container2], containers, true).map(function (targetContainer) { return getBindingDictionary(targetContainer); });\r\n        var bindingDictionary = getBindingDictionary(container);\r\n        function copyDictionary(origin, destination) {\r\n            origin.traverse(function (_key, value) {\r\n                value.forEach(function (binding) {\r\n                    destination.add(binding.serviceIdentifier, binding.clone());\r\n                });\r\n            });\r\n        }\r\n        targetContainers.forEach(function (targetBindingDictionary) {\r\n            copyDictionary(targetBindingDictionary, bindingDictionary);\r\n        });\r\n        return container;\r\n    };\r\n    Container.prototype.load = function () {\r\n        var modules = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            modules[_i] = arguments[_i];\r\n        }\r\n        var getHelpers = this._getContainerModuleHelpersFactory();\r\n        for (var _a = 0, modules_1 = modules; _a < modules_1.length; _a++) {\r\n            var currentModule = modules_1[_a];\r\n            var containerModuleHelpers = getHelpers(currentModule.id);\r\n            currentModule.registry(containerModuleHelpers.bindFunction, containerModuleHelpers.unbindFunction, containerModuleHelpers.isboundFunction, containerModuleHelpers.rebindFunction, containerModuleHelpers.unbindAsyncFunction, containerModuleHelpers.onActivationFunction, containerModuleHelpers.onDeactivationFunction);\r\n        }\r\n    };\r\n    Container.prototype.loadAsync = function () {\r\n        var modules = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            modules[_i] = arguments[_i];\r\n        }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var getHelpers, _a, modules_2, currentModule, containerModuleHelpers;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        getHelpers = this._getContainerModuleHelpersFactory();\r\n                        _a = 0, modules_2 = modules;\r\n                        _b.label = 1;\r\n                    case 1:\r\n                        if (!(_a < modules_2.length)) return [3, 4];\r\n                        currentModule = modules_2[_a];\r\n                        containerModuleHelpers = getHelpers(currentModule.id);\r\n                        return [4, currentModule.registry(containerModuleHelpers.bindFunction, containerModuleHelpers.unbindFunction, containerModuleHelpers.isboundFunction, containerModuleHelpers.rebindFunction, containerModuleHelpers.unbindAsyncFunction, containerModuleHelpers.onActivationFunction, containerModuleHelpers.onDeactivationFunction)];\r\n                    case 2:\r\n                        _b.sent();\r\n                        _b.label = 3;\r\n                    case 3:\r\n                        _a++;\r\n                        return [3, 1];\r\n                    case 4: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Container.prototype.unload = function () {\r\n        var _this = this;\r\n        var modules = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            modules[_i] = arguments[_i];\r\n        }\r\n        modules.forEach(function (module) {\r\n            var deactivations = _this._removeModuleBindings(module.id);\r\n            _this._deactivateSingletons(deactivations);\r\n            _this._removeModuleHandlers(module.id);\r\n        });\r\n    };\r\n    Container.prototype.unloadAsync = function () {\r\n        var modules = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            modules[_i] = arguments[_i];\r\n        }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, modules_3, module_1, deactivations;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        _a = 0, modules_3 = modules;\r\n                        _b.label = 1;\r\n                    case 1:\r\n                        if (!(_a < modules_3.length)) return [3, 4];\r\n                        module_1 = modules_3[_a];\r\n                        deactivations = this._removeModuleBindings(module_1.id);\r\n                        return [4, this._deactivateSingletonsAsync(deactivations)];\r\n                    case 2:\r\n                        _b.sent();\r\n                        this._removeModuleHandlers(module_1.id);\r\n                        _b.label = 3;\r\n                    case 3:\r\n                        _a++;\r\n                        return [3, 1];\r\n                    case 4: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Container.prototype.bind = function (serviceIdentifier) {\r\n        var scope = this.options.defaultScope || BindingScopeEnum.Transient;\r\n        var binding = new Binding(serviceIdentifier, scope);\r\n        this._bindingDictionary.add(serviceIdentifier, binding);\r\n        return new BindingToSyntax(binding);\r\n    };\r\n    Container.prototype.rebind = function (serviceIdentifier) {\r\n        this.unbind(serviceIdentifier);\r\n        return this.bind(serviceIdentifier);\r\n    };\r\n    Container.prototype.rebindAsync = function (serviceIdentifier) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.unbindAsync(serviceIdentifier)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this.bind(serviceIdentifier)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Container.prototype.unbind = function (serviceIdentifier) {\r\n        if (this._bindingDictionary.hasKey(serviceIdentifier)) {\r\n            var bindings = this._bindingDictionary.get(serviceIdentifier);\r\n            this._deactivateSingletons(bindings);\r\n        }\r\n        this._removeServiceFromDictionary(serviceIdentifier);\r\n    };\r\n    Container.prototype.unbindAsync = function (serviceIdentifier) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var bindings;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!this._bindingDictionary.hasKey(serviceIdentifier)) return [3, 2];\r\n                        bindings = this._bindingDictionary.get(serviceIdentifier);\r\n                        return [4, this._deactivateSingletonsAsync(bindings)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        this._removeServiceFromDictionary(serviceIdentifier);\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Container.prototype.unbindAll = function () {\r\n        var _this = this;\r\n        this._bindingDictionary.traverse(function (_key, value) {\r\n            _this._deactivateSingletons(value);\r\n        });\r\n        this._bindingDictionary = new Lookup();\r\n    };\r\n    Container.prototype.unbindAllAsync = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var promises;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        promises = [];\r\n                        this._bindingDictionary.traverse(function (_key, value) {\r\n                            promises.push(_this._deactivateSingletonsAsync(value));\r\n                        });\r\n                        return [4, Promise.all(promises)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        this._bindingDictionary = new Lookup();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Container.prototype.onActivation = function (serviceIdentifier, onActivation) {\r\n        this._activations.add(serviceIdentifier, onActivation);\r\n    };\r\n    Container.prototype.onDeactivation = function (serviceIdentifier, onDeactivation) {\r\n        this._deactivations.add(serviceIdentifier, onDeactivation);\r\n    };\r\n    Container.prototype.isBound = function (serviceIdentifier) {\r\n        var bound = this._bindingDictionary.hasKey(serviceIdentifier);\r\n        if (!bound && this.parent) {\r\n            bound = this.parent.isBound(serviceIdentifier);\r\n        }\r\n        return bound;\r\n    };\r\n    Container.prototype.isCurrentBound = function (serviceIdentifier) {\r\n        return this._bindingDictionary.hasKey(serviceIdentifier);\r\n    };\r\n    Container.prototype.isBoundNamed = function (serviceIdentifier, named) {\r\n        return this.isBoundTagged(serviceIdentifier, METADATA_KEY.NAMED_TAG, named);\r\n    };\r\n    Container.prototype.isBoundTagged = function (serviceIdentifier, key, value) {\r\n        var bound = false;\r\n        if (this._bindingDictionary.hasKey(serviceIdentifier)) {\r\n            var bindings = this._bindingDictionary.get(serviceIdentifier);\r\n            var request_1 = createMockRequest(this, serviceIdentifier, key, value);\r\n            bound = bindings.some(function (b) { return b.constraint(request_1); });\r\n        }\r\n        if (!bound && this.parent) {\r\n            bound = this.parent.isBoundTagged(serviceIdentifier, key, value);\r\n        }\r\n        return bound;\r\n    };\r\n    Container.prototype.snapshot = function () {\r\n        this._snapshots.push(ContainerSnapshot.of(this._bindingDictionary.clone(), this._middleware, this._activations.clone(), this._deactivations.clone(), this._moduleActivationStore.clone()));\r\n    };\r\n    Container.prototype.restore = function () {\r\n        var snapshot = this._snapshots.pop();\r\n        if (snapshot === undefined) {\r\n            throw new Error(ERROR_MSGS.NO_MORE_SNAPSHOTS_AVAILABLE);\r\n        }\r\n        this._bindingDictionary = snapshot.bindings;\r\n        this._activations = snapshot.activations;\r\n        this._deactivations = snapshot.deactivations;\r\n        this._middleware = snapshot.middleware;\r\n        this._moduleActivationStore = snapshot.moduleActivationStore;\r\n    };\r\n    Container.prototype.createChild = function (containerOptions) {\r\n        var child = new Container(containerOptions || this.options);\r\n        child.parent = this;\r\n        return child;\r\n    };\r\n    Container.prototype.applyMiddleware = function () {\r\n        var middlewares = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            middlewares[_i] = arguments[_i];\r\n        }\r\n        var initial = (this._middleware) ? this._middleware : this._planAndResolve();\r\n        this._middleware = middlewares.reduce(function (prev, curr) { return curr(prev); }, initial);\r\n    };\r\n    Container.prototype.applyCustomMetadataReader = function (metadataReader) {\r\n        this._metadataReader = metadataReader;\r\n    };\r\n    Container.prototype.get = function (serviceIdentifier) {\r\n        var getArgs = this._getNotAllArgs(serviceIdentifier, false);\r\n        return this._getButThrowIfAsync(getArgs);\r\n    };\r\n    Container.prototype.getAsync = function (serviceIdentifier) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var getArgs;\r\n            return __generator(this, function (_a) {\r\n                getArgs = this._getNotAllArgs(serviceIdentifier, false);\r\n                return [2, this._get(getArgs)];\r\n            });\r\n        });\r\n    };\r\n    Container.prototype.getTagged = function (serviceIdentifier, key, value) {\r\n        var getArgs = this._getNotAllArgs(serviceIdentifier, false, key, value);\r\n        return this._getButThrowIfAsync(getArgs);\r\n    };\r\n    Container.prototype.getTaggedAsync = function (serviceIdentifier, key, value) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var getArgs;\r\n            return __generator(this, function (_a) {\r\n                getArgs = this._getNotAllArgs(serviceIdentifier, false, key, value);\r\n                return [2, this._get(getArgs)];\r\n            });\r\n        });\r\n    };\r\n    Container.prototype.getNamed = function (serviceIdentifier, named) {\r\n        return this.getTagged(serviceIdentifier, METADATA_KEY.NAMED_TAG, named);\r\n    };\r\n    Container.prototype.getNamedAsync = function (serviceIdentifier, named) {\r\n        return this.getTaggedAsync(serviceIdentifier, METADATA_KEY.NAMED_TAG, named);\r\n    };\r\n    Container.prototype.getAll = function (serviceIdentifier) {\r\n        var getArgs = this._getAllArgs(serviceIdentifier);\r\n        return this._getButThrowIfAsync(getArgs);\r\n    };\r\n    Container.prototype.getAllAsync = function (serviceIdentifier) {\r\n        var getArgs = this._getAllArgs(serviceIdentifier);\r\n        return this._getAll(getArgs);\r\n    };\r\n    Container.prototype.getAllTagged = function (serviceIdentifier, key, value) {\r\n        var getArgs = this._getNotAllArgs(serviceIdentifier, true, key, value);\r\n        return this._getButThrowIfAsync(getArgs);\r\n    };\r\n    Container.prototype.getAllTaggedAsync = function (serviceIdentifier, key, value) {\r\n        var getArgs = this._getNotAllArgs(serviceIdentifier, true, key, value);\r\n        return this._getAll(getArgs);\r\n    };\r\n    Container.prototype.getAllNamed = function (serviceIdentifier, named) {\r\n        return this.getAllTagged(serviceIdentifier, METADATA_KEY.NAMED_TAG, named);\r\n    };\r\n    Container.prototype.getAllNamedAsync = function (serviceIdentifier, named) {\r\n        return this.getAllTaggedAsync(serviceIdentifier, METADATA_KEY.NAMED_TAG, named);\r\n    };\r\n    Container.prototype.resolve = function (constructorFunction) {\r\n        var isBound = this.isBound(constructorFunction);\r\n        if (!isBound) {\r\n            this.bind(constructorFunction).toSelf();\r\n        }\r\n        var resolved = this.get(constructorFunction);\r\n        if (!isBound) {\r\n            this.unbind(constructorFunction);\r\n        }\r\n        return resolved;\r\n    };\r\n    Container.prototype._preDestroy = function (constructor, instance) {\r\n        var _a, _b;\r\n        if (Reflect.hasMetadata(METADATA_KEY.PRE_DESTROY, constructor)) {\r\n            var data = Reflect.getMetadata(METADATA_KEY.PRE_DESTROY, constructor);\r\n            return (_b = (_a = instance)[data.value]) === null || _b === void 0 ? void 0 : _b.call(_a);\r\n        }\r\n    };\r\n    Container.prototype._removeModuleHandlers = function (moduleId) {\r\n        var moduleActivationsHandlers = this._moduleActivationStore.remove(moduleId);\r\n        this._activations.removeIntersection(moduleActivationsHandlers.onActivations);\r\n        this._deactivations.removeIntersection(moduleActivationsHandlers.onDeactivations);\r\n    };\r\n    Container.prototype._removeModuleBindings = function (moduleId) {\r\n        return this._bindingDictionary.removeByCondition(function (binding) { return binding.moduleId === moduleId; });\r\n    };\r\n    Container.prototype._deactivate = function (binding, instance) {\r\n        var _this = this;\r\n        var constructor = Object.getPrototypeOf(instance).constructor;\r\n        try {\r\n            if (this._deactivations.hasKey(binding.serviceIdentifier)) {\r\n                var result = this._deactivateContainer(instance, this._deactivations.get(binding.serviceIdentifier).values());\r\n                if (isPromise(result)) {\r\n                    return this._handleDeactivationError(result.then(function () { return _this._propagateContainerDeactivationThenBindingAndPreDestroyAsync(binding, instance, constructor); }), constructor);\r\n                }\r\n            }\r\n            var propagateDeactivationResult = this._propagateContainerDeactivationThenBindingAndPreDestroy(binding, instance, constructor);\r\n            if (isPromise(propagateDeactivationResult)) {\r\n                return this._handleDeactivationError(propagateDeactivationResult, constructor);\r\n            }\r\n        }\r\n        catch (ex) {\r\n            if (ex instanceof Error) {\r\n                throw new Error(ERROR_MSGS.ON_DEACTIVATION_ERROR(constructor.name, ex.message));\r\n            }\r\n        }\r\n    };\r\n    Container.prototype._handleDeactivationError = function (asyncResult, constructor) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var ex_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 2, , 3]);\r\n                        return [4, asyncResult];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [3, 3];\r\n                    case 2:\r\n                        ex_1 = _a.sent();\r\n                        if (ex_1 instanceof Error) {\r\n                            throw new Error(ERROR_MSGS.ON_DEACTIVATION_ERROR(constructor.name, ex_1.message));\r\n                        }\r\n                        return [3, 3];\r\n                    case 3: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Container.prototype._deactivateContainer = function (instance, deactivationsIterator) {\r\n        var _this = this;\r\n        var deactivation = deactivationsIterator.next();\r\n        while (deactivation.value) {\r\n            var result = deactivation.value(instance);\r\n            if (isPromise(result)) {\r\n                return result.then(function () {\r\n                    return _this._deactivateContainerAsync(instance, deactivationsIterator);\r\n                });\r\n            }\r\n            deactivation = deactivationsIterator.next();\r\n        }\r\n    };\r\n    Container.prototype._deactivateContainerAsync = function (instance, deactivationsIterator) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var deactivation;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        deactivation = deactivationsIterator.next();\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        if (!deactivation.value) return [3, 3];\r\n                        return [4, deactivation.value(instance)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        deactivation = deactivationsIterator.next();\r\n                        return [3, 1];\r\n                    case 3: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Container.prototype._getContainerModuleHelpersFactory = function () {\r\n        var _this = this;\r\n        var setModuleId = function (bindingToSyntax, moduleId) {\r\n            bindingToSyntax._binding.moduleId = moduleId;\r\n        };\r\n        var getBindFunction = function (moduleId) {\r\n            return function (serviceIdentifier) {\r\n                var bindingToSyntax = _this.bind(serviceIdentifier);\r\n                setModuleId(bindingToSyntax, moduleId);\r\n                return bindingToSyntax;\r\n            };\r\n        };\r\n        var getUnbindFunction = function () {\r\n            return function (serviceIdentifier) {\r\n                return _this.unbind(serviceIdentifier);\r\n            };\r\n        };\r\n        var getUnbindAsyncFunction = function () {\r\n            return function (serviceIdentifier) {\r\n                return _this.unbindAsync(serviceIdentifier);\r\n            };\r\n        };\r\n        var getIsboundFunction = function () {\r\n            return function (serviceIdentifier) {\r\n                return _this.isBound(serviceIdentifier);\r\n            };\r\n        };\r\n        var getRebindFunction = function (moduleId) {\r\n            return function (serviceIdentifier) {\r\n                var bindingToSyntax = _this.rebind(serviceIdentifier);\r\n                setModuleId(bindingToSyntax, moduleId);\r\n                return bindingToSyntax;\r\n            };\r\n        };\r\n        var getOnActivationFunction = function (moduleId) {\r\n            return function (serviceIdentifier, onActivation) {\r\n                _this._moduleActivationStore.addActivation(moduleId, serviceIdentifier, onActivation);\r\n                _this.onActivation(serviceIdentifier, onActivation);\r\n            };\r\n        };\r\n        var getOnDeactivationFunction = function (moduleId) {\r\n            return function (serviceIdentifier, onDeactivation) {\r\n                _this._moduleActivationStore.addDeactivation(moduleId, serviceIdentifier, onDeactivation);\r\n                _this.onDeactivation(serviceIdentifier, onDeactivation);\r\n            };\r\n        };\r\n        return function (mId) { return ({\r\n            bindFunction: getBindFunction(mId),\r\n            isboundFunction: getIsboundFunction(),\r\n            onActivationFunction: getOnActivationFunction(mId),\r\n            onDeactivationFunction: getOnDeactivationFunction(mId),\r\n            rebindFunction: getRebindFunction(mId),\r\n            unbindFunction: getUnbindFunction(),\r\n            unbindAsyncFunction: getUnbindAsyncFunction()\r\n        }); };\r\n    };\r\n    Container.prototype._getAll = function (getArgs) {\r\n        return Promise.all(this._get(getArgs));\r\n    };\r\n    Container.prototype._get = function (getArgs) {\r\n        var planAndResolveArgs = __assign(__assign({}, getArgs), { contextInterceptor: function (context) { return context; }, targetType: TargetTypeEnum.Variable });\r\n        if (this._middleware) {\r\n            var middlewareResult = this._middleware(planAndResolveArgs);\r\n            if (middlewareResult === undefined || middlewareResult === null) {\r\n                throw new Error(ERROR_MSGS.INVALID_MIDDLEWARE_RETURN);\r\n            }\r\n            return middlewareResult;\r\n        }\r\n        return this._planAndResolve()(planAndResolveArgs);\r\n    };\r\n    Container.prototype._getButThrowIfAsync = function (getArgs) {\r\n        var result = this._get(getArgs);\r\n        if (isPromiseOrContainsPromise(result)) {\r\n            throw new Error(ERROR_MSGS.LAZY_IN_SYNC(getArgs.serviceIdentifier));\r\n        }\r\n        return result;\r\n    };\r\n    Container.prototype._getAllArgs = function (serviceIdentifier) {\r\n        var getAllArgs = {\r\n            avoidConstraints: true,\r\n            isMultiInject: true,\r\n            serviceIdentifier: serviceIdentifier,\r\n        };\r\n        return getAllArgs;\r\n    };\r\n    Container.prototype._getNotAllArgs = function (serviceIdentifier, isMultiInject, key, value) {\r\n        var getNotAllArgs = {\r\n            avoidConstraints: false,\r\n            isMultiInject: isMultiInject,\r\n            serviceIdentifier: serviceIdentifier,\r\n            key: key,\r\n            value: value,\r\n        };\r\n        return getNotAllArgs;\r\n    };\r\n    Container.prototype._planAndResolve = function () {\r\n        var _this = this;\r\n        return function (args) {\r\n            var context = plan(_this._metadataReader, _this, args.isMultiInject, args.targetType, args.serviceIdentifier, args.key, args.value, args.avoidConstraints);\r\n            context = args.contextInterceptor(context);\r\n            var result = resolve(context);\r\n            return result;\r\n        };\r\n    };\r\n    Container.prototype._deactivateIfSingleton = function (binding) {\r\n        var _this = this;\r\n        if (!binding.activated) {\r\n            return;\r\n        }\r\n        if (isPromise(binding.cache)) {\r\n            return binding.cache.then(function (resolved) { return _this._deactivate(binding, resolved); });\r\n        }\r\n        return this._deactivate(binding, binding.cache);\r\n    };\r\n    Container.prototype._deactivateSingletons = function (bindings) {\r\n        for (var _i = 0, bindings_1 = bindings; _i < bindings_1.length; _i++) {\r\n            var binding = bindings_1[_i];\r\n            var result = this._deactivateIfSingleton(binding);\r\n            if (isPromise(result)) {\r\n                throw new Error(ERROR_MSGS.ASYNC_UNBIND_REQUIRED);\r\n            }\r\n        }\r\n    };\r\n    Container.prototype._deactivateSingletonsAsync = function (bindings) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, Promise.all(bindings.map(function (b) { return _this._deactivateIfSingleton(b); }))];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Container.prototype._propagateContainerDeactivationThenBindingAndPreDestroy = function (binding, instance, constructor) {\r\n        if (this.parent) {\r\n            return this._deactivate.bind(this.parent)(binding, instance);\r\n        }\r\n        else {\r\n            return this._bindingDeactivationAndPreDestroy(binding, instance, constructor);\r\n        }\r\n    };\r\n    Container.prototype._propagateContainerDeactivationThenBindingAndPreDestroyAsync = function (binding, instance, constructor) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!this.parent) return [3, 2];\r\n                        return [4, this._deactivate.bind(this.parent)(binding, instance)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [3, 4];\r\n                    case 2: return [4, this._bindingDeactivationAndPreDestroyAsync(binding, instance, constructor)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        _a.label = 4;\r\n                    case 4: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Container.prototype._removeServiceFromDictionary = function (serviceIdentifier) {\r\n        try {\r\n            this._bindingDictionary.remove(serviceIdentifier);\r\n        }\r\n        catch (e) {\r\n            throw new Error(ERROR_MSGS.CANNOT_UNBIND + \" \" + getServiceIdentifierAsString(serviceIdentifier));\r\n        }\r\n    };\r\n    Container.prototype._bindingDeactivationAndPreDestroy = function (binding, instance, constructor) {\r\n        var _this = this;\r\n        if (typeof binding.onDeactivation === 'function') {\r\n            var result = binding.onDeactivation(instance);\r\n            if (isPromise(result)) {\r\n                return result.then(function () { return _this._preDestroy(constructor, instance); });\r\n            }\r\n        }\r\n        return this._preDestroy(constructor, instance);\r\n    };\r\n    Container.prototype._bindingDeactivationAndPreDestroyAsync = function (binding, instance, constructor) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!(typeof binding.onDeactivation === 'function')) return [3, 2];\r\n                        return [4, binding.onDeactivation(instance)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2: return [4, this._preDestroy(constructor, instance)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return Container;\r\n}());\r\nexport { Container };\r\n","import * as ERROR_MSGS from '../constants/error_msgs';\r\nimport * as METADATA_KEY from '../constants/metadata_keys';\r\nimport { getFirstArrayDuplicate } from '../utils/js';\r\nfunction targetIsConstructorFunction(target) {\r\n    return target.prototype !== undefined;\r\n}\r\nfunction _throwIfMethodParameter(parameterName) {\r\n    if (parameterName !== undefined) {\r\n        throw new Error(ERROR_MSGS.INVALID_DECORATOR_OPERATION);\r\n    }\r\n}\r\nfunction tagParameter(annotationTarget, parameterName, parameterIndex, metadata) {\r\n    _throwIfMethodParameter(parameterName);\r\n    _tagParameterOrProperty(METADATA_KEY.TAGGED, annotationTarget, parameterIndex.toString(), metadata);\r\n}\r\nfunction tagProperty(annotationTarget, propertyName, metadata) {\r\n    if (targetIsConstructorFunction(annotationTarget)) {\r\n        throw new Error(ERROR_MSGS.INVALID_DECORATOR_OPERATION);\r\n    }\r\n    _tagParameterOrProperty(METADATA_KEY.TAGGED_PROP, annotationTarget.constructor, propertyName, metadata);\r\n}\r\nfunction _ensureNoMetadataKeyDuplicates(metadata) {\r\n    var metadatas = [];\r\n    if (Array.isArray(metadata)) {\r\n        metadatas = metadata;\r\n        var duplicate = getFirstArrayDuplicate(metadatas.map(function (md) { return md.key; }));\r\n        if (duplicate !== undefined) {\r\n            throw new Error(ERROR_MSGS.DUPLICATED_METADATA + \" \" + duplicate.toString());\r\n        }\r\n    }\r\n    else {\r\n        metadatas = [metadata];\r\n    }\r\n    return metadatas;\r\n}\r\nfunction _tagParameterOrProperty(metadataKey, annotationTarget, key, metadata) {\r\n    var metadatas = _ensureNoMetadataKeyDuplicates(metadata);\r\n    var paramsOrPropertiesMetadata = {};\r\n    if (Reflect.hasOwnMetadata(metadataKey, annotationTarget)) {\r\n        paramsOrPropertiesMetadata = Reflect.getMetadata(metadataKey, annotationTarget);\r\n    }\r\n    var paramOrPropertyMetadata = paramsOrPropertiesMetadata[key];\r\n    if (paramOrPropertyMetadata === undefined) {\r\n        paramOrPropertyMetadata = [];\r\n    }\r\n    else {\r\n        var _loop_1 = function (m) {\r\n            if (metadatas.some(function (md) { return md.key === m.key; })) {\r\n                throw new Error(ERROR_MSGS.DUPLICATED_METADATA + \" \" + m.key.toString());\r\n            }\r\n        };\r\n        for (var _i = 0, paramOrPropertyMetadata_1 = paramOrPropertyMetadata; _i < paramOrPropertyMetadata_1.length; _i++) {\r\n            var m = paramOrPropertyMetadata_1[_i];\r\n            _loop_1(m);\r\n        }\r\n    }\r\n    paramOrPropertyMetadata.push.apply(paramOrPropertyMetadata, metadatas);\r\n    paramsOrPropertiesMetadata[key] = paramOrPropertyMetadata;\r\n    Reflect.defineMetadata(metadataKey, paramsOrPropertiesMetadata, annotationTarget);\r\n}\r\nfunction createTaggedDecorator(metadata) {\r\n    return function (target, targetKey, indexOrPropertyDescriptor) {\r\n        if (typeof indexOrPropertyDescriptor === 'number') {\r\n            tagParameter(target, targetKey, indexOrPropertyDescriptor, metadata);\r\n        }\r\n        else {\r\n            tagProperty(target, targetKey, metadata);\r\n        }\r\n    };\r\n}\r\nfunction _decorate(decorators, target) {\r\n    Reflect.decorate(decorators, target);\r\n}\r\nfunction _param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); };\r\n}\r\nfunction decorate(decorator, target, parameterIndexOrProperty) {\r\n    if (typeof parameterIndexOrProperty === 'number') {\r\n        _decorate([_param(parameterIndexOrProperty, decorator)], target);\r\n    }\r\n    else if (typeof parameterIndexOrProperty === 'string') {\r\n        Reflect.decorate([decorator], target, parameterIndexOrProperty);\r\n    }\r\n    else {\r\n        _decorate([decorator], target);\r\n    }\r\n}\r\nexport { decorate, tagParameter, tagProperty, createTaggedDecorator };\r\n","export function getFirstArrayDuplicate(array) {\r\n    var seenValues = new Set();\r\n    for (var _i = 0, array_1 = array; _i < array_1.length; _i++) {\r\n        var entry = array_1[_i];\r\n        if (seenValues.has(entry)) {\r\n            return entry;\r\n        }\r\n        else {\r\n            seenValues.add(entry);\r\n        }\r\n    }\r\n    return undefined;\r\n}\r\n","import * as ERRORS_MSGS from '../constants/error_msgs';\r\nimport * as METADATA_KEY from '../constants/metadata_keys';\r\nfunction injectable() {\r\n    return function (target) {\r\n        if (Reflect.hasOwnMetadata(METADATA_KEY.PARAM_TYPES, target)) {\r\n            throw new Error(ERRORS_MSGS.DUPLICATED_INJECTABLE_DECORATOR);\r\n        }\r\n        var types = Reflect.getMetadata(METADATA_KEY.DESIGN_PARAM_TYPES, target) || [];\r\n        Reflect.defineMetadata(METADATA_KEY.PARAM_TYPES, types, target);\r\n        return target;\r\n    };\r\n}\r\nexport { injectable };\r\n","import { UNDEFINED_INJECT_ANNOTATION } from '../constants/error_msgs';\r\nimport { Metadata } from '../planning/metadata';\r\nimport { createTaggedDecorator } from './decorator_utils';\r\nexport function injectBase(metadataKey) {\r\n    return function (serviceIdentifier) {\r\n        return function (target, targetKey, indexOrPropertyDescriptor) {\r\n            if (serviceIdentifier === undefined) {\r\n                var className = typeof target === 'function' ? target.name : target.constructor.name;\r\n                throw new Error(UNDEFINED_INJECT_ANNOTATION(className));\r\n            }\r\n            return createTaggedDecorator(new Metadata(metadataKey, serviceIdentifier))(target, targetKey, indexOrPropertyDescriptor);\r\n        };\r\n    };\r\n}\r\n","import * as METADATA_KEY from '../constants/metadata_keys';\r\nimport { injectBase } from './inject_base';\r\nvar inject = injectBase(METADATA_KEY.INJECT_TAG);\r\nexport { inject };\r\n","import * as METADATA_KEY from '../constants/metadata_keys';\r\nimport { injectBase } from './inject_base';\r\nvar multiInject = injectBase(METADATA_KEY.MULTI_INJECT_TAG);\r\nexport { multiInject };\r\n","const TYPES = {\n    AudioContextManager: Symbol.for(\"AudioContextManager\"),\n    AudioEditor: Symbol.for(\"AudioEditor\"),\n    AudioProcessor: Symbol.for(\"AudioProcessor\"),\n    BufferManager: Symbol.for(\"BufferManager\"),\n    FilterManager: Symbol.for(\"FilterManager\"),\n    RendererManager: Symbol.for(\"RendererManager\"),\n    SaveBufferManager: Symbol.for(\"SaveBufferManager\"),\n    ConfigService: Symbol.for(\"ConfigService\"),\n    EventEmitter: Symbol.for(\"EventEmitter\"),\n    BufferPlayer: Symbol.for(\"BufferPlayer\"),\n    BufferDecoderService: Symbol.for(\"BufferDecoderService\"),\n    BufferFetcherService: Symbol.for(\"BufferFetcherService\"),\n    AudioBuffersToFetch: Symbol.for(\"AudioBuffersToFetch\"),\n    Renderers: Symbol.for(\"Renderers\"),\n    Filters: Symbol.for(\"Filters\"),\n    EntryPointFilter: Symbol.for(\"EntryPointFilter\"),\n    VoiceRecorder: Symbol.for(\"VoiceRecorder\")\n};\n\nexport { TYPES };\n","/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\r\n    function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\r\n    var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\r\n    var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\r\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\r\n    var _, done = false;\r\n    for (var i = decorators.length - 1; i >= 0; i--) {\r\n        var context = {};\r\n        for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\r\n        for (var p in contextIn.access) context.access[p] = contextIn.access[p];\r\n        context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\r\n        var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\r\n        if (kind === \"accessor\") {\r\n            if (result === void 0) continue;\r\n            if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\r\n            if (_ = accept(result.get)) descriptor.get = _;\r\n            if (_ = accept(result.set)) descriptor.set = _;\r\n            if (_ = accept(result.init)) initializers.unshift(_);\r\n        }\r\n        else if (_ = accept(result)) {\r\n            if (kind === \"field\") initializers.unshift(_);\r\n            else descriptor[key] = _;\r\n        }\r\n    }\r\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\r\n    done = true;\r\n};\r\n\r\nexport function __runInitializers(thisArg, initializers, value) {\r\n    var useValue = arguments.length > 2;\r\n    for (var i = 0; i < initializers.length; i++) {\r\n        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\r\n    }\r\n    return useValue ? value : void 0;\r\n};\r\n\r\nexport function __propKey(x) {\r\n    return typeof x === \"symbol\" ? x : \"\".concat(x);\r\n};\r\n\r\nexport function __setFunctionName(f, name, prefix) {\r\n    if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\r\n    return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\r\n};\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\r\n    function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n\r\nexport function __addDisposableResource(env, value, async) {\r\n    if (value !== null && value !== void 0) {\r\n        if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\r\n        var dispose, inner;\r\n        if (async) {\r\n            if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\r\n            dispose = value[Symbol.asyncDispose];\r\n        }\r\n        if (dispose === void 0) {\r\n            if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\r\n            dispose = value[Symbol.dispose];\r\n            if (async) inner = dispose;\r\n        }\r\n        if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\r\n        if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\r\n        env.stack.push({ value: value, dispose: dispose, async: async });\r\n    }\r\n    else if (async) {\r\n        env.stack.push({ async: true });\r\n    }\r\n    return value;\r\n\r\n}\r\n\r\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\r\n\r\nexport function __disposeResources(env) {\r\n    function fail(e) {\r\n        env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\r\n        env.hasError = true;\r\n    }\r\n    function next() {\r\n        while (env.stack.length) {\r\n            var rec = env.stack.pop();\r\n            try {\r\n                var result = rec.dispose && rec.dispose.call(rec.value);\r\n                if (rec.async) return Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\r\n            }\r\n            catch (e) {\r\n                fail(e);\r\n            }\r\n        }\r\n        if (env.hasError) throw env.error;\r\n    }\r\n    return next();\r\n}\r\n\r\nexport default {\r\n    __extends: __extends,\r\n    __assign: __assign,\r\n    __rest: __rest,\r\n    __decorate: __decorate,\r\n    __param: __param,\r\n    __metadata: __metadata,\r\n    __awaiter: __awaiter,\r\n    __generator: __generator,\r\n    __createBinding: __createBinding,\r\n    __exportStar: __exportStar,\r\n    __values: __values,\r\n    __read: __read,\r\n    __spread: __spread,\r\n    __spreadArrays: __spreadArrays,\r\n    __spreadArray: __spreadArray,\r\n    __await: __await,\r\n    __asyncGenerator: __asyncGenerator,\r\n    __asyncDelegator: __asyncDelegator,\r\n    __asyncValues: __asyncValues,\r\n    __makeTemplateObject: __makeTemplateObject,\r\n    __importStar: __importStar,\r\n    __importDefault: __importDefault,\r\n    __classPrivateFieldGet: __classPrivateFieldGet,\r\n    __classPrivateFieldSet: __classPrivateFieldSet,\r\n    __classPrivateFieldIn: __classPrivateFieldIn,\r\n    __addDisposableResource: __addDisposableResource,\r\n    __disposeResources: __disposeResources,\r\n};\r\n","export enum EventType {\n    LOADING_BUFFERS = \"loadingBuffers\",\n    LOADING_BUFFERS_ERROR = \"loadingBuffersError\",\n    FETCHING_BUFFERS = \"fetchingBuffers\",\n    FETCHING_BUFFERS_ERROR = \"fetchingBuffersError\",\n    FINISHED_FETCHING_BUFFERS = \"finishedFetchingBuffers\",\n    LOADED_BUFFERS = \"loadedBuffers\",\n    COMPATIBILITY_MODE_AUTO_ENABLED = \"compatibilityModeAutoEnabled\",\n    RENDERING_AUDIO_PROBLEM_DETECTED = \"renderingAudioProblemDetected\",\n    AUDIO_RENDERING_FINISHED = \"audioRenderingFinished\",\n    OFFLINE_AUDIO_RENDERING_FINISHED = \"offlineAudioRenderingFinished\",\n    PLAYING_STOPPED = \"playingStopped\",\n    PLAYING_STARTED = \"playingStarted\",\n    PLAYING_FINISHED = \"playingFinished\",\n    PLAYING_UPDATE = \"playingUpdate\",\n    RECORDER_INIT = \"recorderInit\",\n    RECORDER_SUCCESS = \"recorderSuccess\",\n    RECORDER_ERROR = \"recorderError\",\n    RECORDER_UPDATE_CONSTRAINTS = \"recorderUpdateConstraints\",\n    RECORDER_RECORDING = \"recorderRecording\",\n    RECORDER_STOPPED = \"recorderStopped\",\n    RECORDER_PAUSED = \"recorderPaused\",\n    RECORDER_RESETED = \"recorderReseted\",\n    RECORDER_COUNT_UPDATE = \"recorderCountUpdate\",\n    SAMPLE_RATE_CHANGED = \"sampleRateChanged\",\n    DECODING_AUDIO_FILE = \"decodingAudioFile\",\n    DECODED_AUDIO_FILE = \"decodedAudioFile\",\n    ERROR_DECODING_AUDIO_FILE = \"errorDecodingAudioFile\",\n    RECORDER_NOT_FOUND_ERROR = \"recorderNotFoundError\",\n    RECORDER_UNKNOWN_ERROR = \"recorderUnknownError\",\n    UPDATE_AUDIO_TREATMENT_PERCENT = \"updateAudioTreatmentPercent\",\n    UPDATE_REMAINING_TIME_ESTIMATED = \"updateRemainingTimeEstimated\",\n    CANCELLED_AND_LOADED_INITIAL_AUDIO = \"cancelledAndLoadedInitialAudio\",\n    CANCELLING_AUDIO_PROCESSING = \"cancellingAudioProcessing\"\n};\n","const Constants = {\n    AUDIO_EDITOR: \"audioEditor\",\n    VOICE_RECORDER: \"voiceRecorder\",\n    BUFFER_PLAYER: \"bufferPlayer\",\n    AUDIO_CONTEXT_MANAGER: \"audioContextManager\",\n    AUDIO_PROCESSOR: \"audioProcessor\",\n    BUFFER_MANAGER: \"bufferManager\",\n    FILTER_MANAGER: \"filterManager\",\n    RENDERER_MANAGER: \"rendererManager\",\n    SAVE_BUFFER_MANAGER: \"saveBufferManager\",\n    EXPORT_WAV_COMMAND: \"exportWAV\",\n    EXPORT_MP3_COMMAND: \"exportMP3\",\n    AUDIO_WAV: \"audio/wav\",\n    AUDIO_MP3: \"audio/mp3\",\n    RECORD_COMMAND: \"record\",\n    INIT_COMMAND: \"init\",\n    FILTERS_NAMES: {\n        REVERB: \"reverb\",\n        ECHO: \"echo\",\n        BASS_BOOST: \"bassboost\",\n        BITCRUSHER: \"bitcrusher\",\n        HIGH_PASS: \"highpass\",\n        LIMITER: \"limiter\",\n        LOW_PASS: \"lowpass\",\n        PASSTHROUGH: \"passthroughfilter\",\n        RETURN_AUDIO: \"returnAudio\",\n        SOUNDTOUCH: \"soundtouch\",\n        TELEPHONIZER: \"telephonizer\",\n        VOCODER: \"vocoder\"\n    },\n    WORKLET_PATHS: {\n        BITCRUSHER: \"BitCrusher.worklet.js\",\n        LIMITER: \"Limiter.worklet.js\",\n        SOUNDTOUCH: \"Soundtouch.worklet.js\",\n        RECORDER_WORKLET: \"RecorderWorklet.js\",\n        PASSTHROUGH: \"Passthrough.worklet.js\"\n    },\n    WORKLET_NAMES: {\n        BITCRUSHER: \"bitcrusher-processor\",\n        LIMITER: \"limiter-processor\",\n        SOUNDTOUCH: \"soundtouch-worklet\",\n        RECORDER_WORKLET: \"recorder-worklet\",\n        PASSTHROUGH: \"passthrough\"\n    },\n    PREFERENCES_KEYS: {\n        COMPATIBILITY_MODE_ENABLED: \"compatibility-mode-enabled\",\n        COMPATIBILITY_MODE_CHECKED: \"compatibility-mode-checked\",\n        ENABLE_AUDIO_WORKLET: \"enable-audio-worklet\",\n        ENABLE_SOUNDTOUCH_AUDIO_WORKLET: \"enable-soundtouch-audio-worklet\",\n        BUFFER_SIZE: \"buffer-size\",\n        SAMPLE_RATE: \"sample-rate\",\n        DISABLE_INITIAL_RENDERING: \"disable-initial-rendering\",\n        BITRATE_MP3: \"bitrate-mp3\"\n    },\n    // Enable or disable the use of Audio Worklet version of Soundtouch\n    // If disabled, the ScriptProcessorNode version is used\n    ENABLE_SOUNDTOUCH_AUDIO_WORKLET: true,\n    ENABLE_AUDIO_WORKLET: true,\n    ENABLE_RECORDER_AUDIO_WORKLET: true,\n    SOUNDTOUCH_PITCH_SHIFTER_BUFFER_SIZE: 16384,\n    DEFAULT_REVERB_ENVIRONMENT: {\n        name: \"Medium Damping Cave E002 M2S\",\n        url: \"impulse_response.wav\",\n        size: 1350278,\n        addDuration: 4,\n        link: \"http://www.cksde.com/p_6_250.htm\"\n    },\n    VOCODER_MODULATOR: \"modulator.mp3\",\n    DEFAULT_BUFFER_SIZE: 0,\n    VALID_BUFFER_SIZE: [0, 256, 512, 1024, 2048, 4096, 8192, 16384],\n    VALID_MP3_BITRATES: [32, 64, 96, 128, 160, 256, 320],\n    DEFAULT_SAMPLE_RATE: 0, // 0 = AUTO\n    VALID_SAMPLE_RATES: [0, 8000, 11025, 16000, 22050, 32000, 44100, 48000, 88200, 96000, 176400, 192000],\n    // Interval used by the treatment percent counter. The event will be dispatched each ms defined here\n    TREATMENT_TIME_COUNTING_THROTTLE_INTERVAL: 100,\n    // Smoothing factor for the time couting estimation (between 0 and 1)\n    TREATMENT_TIME_COUNTING_SMOOTHING_FACTOR: 0.9,\n    // Disable initial rendering (when opening audio file or buffer)\n    DISABLE_INITIAL_RENDERING: true,\n    // Default save format\n    DEFAULT_SAVE_FORMAT: \"wav\",\n    // Default bitrate for the MP3 encoder\n    DEFAULT_MP3_BITRATE: 320\n};\n\nexport default Constants;\n","import { injectable } from \"inversify\";\nimport AudioEditorEvents from \"../model/AudioEditorEvent\";\nimport { EventEmitterCallback } from \"../model/EventEmitterCallback\";\nimport EventEmitterInterface from \"./interfaces/EventEmitterInterface\";\n\n@injectable()\nexport default class EventEmitter implements EventEmitterInterface {\n    listeners: AudioEditorEvents = {};\n    \n    constructor() {\n        this.listeners = {};\n    }\n\n    on(event: string, callback: EventEmitterCallback) {\n        if (!this.listeners[event]) {\n            this.listeners[event] = [];\n        }\n        this.listeners[event].push(callback);\n    }\n\n    emit(event: string, data?: string | number | AudioBuffer) {\n        if (this.listeners[event]) {\n            this.listeners[event].forEach(callback => {\n                callback(data);\n            });\n        }\n    }\n\n    off(event: string, callback: EventEmitterCallback) {\n        if (this.listeners[event]) {\n            this.listeners[event] = this.listeners[event].filter(cb => cb !== callback);\n        }\n    }\n}\n","import { inject, injectable } from \"inversify\";\nimport { EventType } from \"@/model/EventTypeEnum\";\nimport Constants from \"@/model/Constants\";\nimport EventEmitter from \"@/utils/EventEmitter\";\nimport AudioContextManagerInterface from \"./interfaces/AudioContextManagerInterface\";\nimport { ConfigService } from \"@/services/interfaces/ConfigService\";\nimport EventEmitterInterface from \"@/utils/interfaces/EventEmitterInterface\";\nimport { TYPES } from \"@/inversify.types\";\n\n@injectable()\nexport default class AudioContextManager implements AudioContextManagerInterface {\n\n    /** The current event emitter */\n    private eventEmitter: EventEmitterInterface | undefined;\n\n    /** The config service */\n    private configService: ConfigService | null;\n\n    /** The current audio context */\n    private _currentContext: AudioContext | null | undefined;\n\n    /** The old audio context */\n    private oldAudioContext: AudioContext | null | undefined;\n\n    /** The previous sample rate setting */\n    private previousSampleRate = Constants.DEFAULT_SAMPLE_RATE;\n\n    constructor(\n        @inject(TYPES.EventEmitter) eventEmitter: EventEmitterInterface | null,\n        @inject(TYPES.ConfigService) configService: ConfigService | null) {\n        this.eventEmitter = eventEmitter || new EventEmitter();\n        this.configService = configService;\n\n        this.setup();\n    }\n\n    private setup() {\n        if (this.configService) {\n            this.previousSampleRate = this.configService.getSampleRate();\n\n            if (this.eventEmitter) {\n                this.eventEmitter.emit(EventType.SAMPLE_RATE_CHANGED, this.previousSampleRate);\n            }\n        }\n\n        if (!this.currentContext) {\n            this.createNewContext(this.previousSampleRate);\n        }\n    }\n\n    createNewContextIfNeeded(principalBuffer?: AudioBuffer | null) {\n        const isCompatibilityModeEnabled = this.configService && this.configService.isCompatibilityModeEnabled();\n\n        if (isCompatibilityModeEnabled && principalBuffer) {\n            // If compatibility mode is enabled, we use the sample rate of the input audio buffer\n            if (this.currentSampleRate != principalBuffer.sampleRate) {\n                this.createNewContext(principalBuffer.sampleRate);\n                return true;\n            }\n        } else {\n            // Otherwise we change the context if the sample rate has changed\n            let currentSampleRate = Constants.DEFAULT_SAMPLE_RATE;\n\n            if (this.configService) {\n                currentSampleRate = this.configService.getSampleRate();\n            }\n\n            // If sample rate setting has changed, create a new audio context\n            if (currentSampleRate != this.previousSampleRate) {\n                this.createNewContext(currentSampleRate);\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    /** \n     * Stop previous audio context and create a new one\n     * @param sampleRate New sample rate\n     */\n    createNewContext(sampleRate: number) {\n        if (this._currentContext) {\n            this.oldAudioContext = this._currentContext;\n            this.destroyOldContext();\n        }\n\n        const options: AudioContextOptions = {\n            latencyHint: \"interactive\"\n        };\n\n        if (sampleRate != 0) {\n            options.sampleRate = sampleRate;\n        }\n\n        this._currentContext = new AudioContext(options);\n\n        if (this.eventEmitter) {\n            this.eventEmitter.emit(EventType.SAMPLE_RATE_CHANGED, this.currentSampleRate);\n        }\n\n        this.previousSampleRate = sampleRate;\n    }\n\n    /**\n     * Destroy previous AudioContext\n     */\n    private destroyOldContext() {\n        if (this.oldAudioContext) {\n            this.oldAudioContext.close();\n            this.oldAudioContext = null;\n        }\n    }\n\n    get currentSampleRate(): number {\n        if (this.currentContext) {\n            return this.currentContext.sampleRate;\n        }\n\n        return 0;\n    }\n\n    get currentContext() {\n        return this._currentContext;\n    }\n}\n","import { inject, injectable } from \"inversify\";\nimport type { ConfigService } from \"../../services/interfaces/ConfigService\";\nimport { TYPES } from \"@/inversify.types\";\nimport type BufferFetcherServiceInterface from \"@/services/interfaces/BufferFetcherServiceInterface\";\nimport type BufferDecoderServiceInterface from \"@/services/interfaces/BufferDecoderServiceInterface\";\nimport type EventEmitterInterface from \"@/utils/interfaces/EventEmitterInterface\";\n\n@injectable()\nexport default abstract class AbstractAudioElement {\n\n    /** Is this element enabled? */\n    private enabled = false;\n\n    /** Is this element enabled by default? */\n    private defaultEnabled = false;\n\n    @inject(TYPES.BufferFetcherService)\n    protected bufferFetcherService: BufferFetcherServiceInterface | null = null;\n\n    @inject(TYPES.BufferDecoderService)\n    protected bufferDecoderService: BufferDecoderServiceInterface | null = null;\n\n    @inject(TYPES.ConfigService)\n    protected configService: ConfigService | null = null;\n\n    @inject(TYPES.EventEmitter)\n    protected eventEmitter: EventEmitterInterface | null = null;\n\n    /** Returns the order in which the filter/renderer needs to be applied */\n    abstract get order(): number;\n\n    /** Returns the id of this filter/renderer */\n    abstract get id(): string;\n\n    /** Is this filter/renderer enabled? */\n    isEnabled(): boolean {\n        return this.enabled;\n    }\n\n    /** Is this filter/renderer enabled by default? */\n    isDefaultEnabled(): boolean {\n        return this.defaultEnabled;\n    }\n\n    /** Set to true if this filter/renderer needs to be enabled by default */\n    setDefaultEnabled(state: boolean) {\n        this.defaultEnabled = state;\n\n        if (state) {\n            this.enable();\n        } else {\n            this.disable();\n        }\n    }\n\n    setEnabled(state: boolean) {\n        this.enabled = state;\n    }\n\n    /** Enable this filter/renderer */\n    enable() {\n        this.setEnabled(true);\n    }\n\n    /** Disable this filter/renderer */\n    disable() {\n        this.setEnabled(false);\n    }\n\n    /** Toggle to enabled/disabled this filter */\n    toggle() {\n        this.setEnabled(!this.isEnabled());\n    }\n\n    injectDependencies(bufferFetcherService: BufferFetcherServiceInterface | null, bufferDecoderService: BufferDecoderServiceInterface | null, configService: ConfigService | null, eventEmitter: EventEmitterInterface | null) {\n        if (bufferFetcherService) {\n            this.bufferFetcherService = bufferFetcherService;\n        }\n\n        if (bufferDecoderService) {\n            this.bufferDecoderService = bufferDecoderService;\n        }\n\n        if (configService) {\n            this.configService = configService;\n        }\n\n        if (eventEmitter) {\n            this.eventEmitter = eventEmitter;\n        }\n    }\n}\n","import { FilterSettingValue } from \"../model/filtersSettings/FilterSettings\";\nimport { EventType } from \"@/model/EventTypeEnum\";\nimport FilterManagerInterface from \"@/audioEditor/interfaces/FilterManagerInterface\";\nimport EventEmitterInterface from \"./interfaces/EventEmitterInterface\";\n\nconst utilFunctions = {\n    calcAudioDuration: (audio: AudioBuffer, speed: number) => {\n        if (audio) {\n            let duration = audio.duration + 1;\n\n            if (speed) {\n                duration = duration / speed;\n            }\n\n            return duration;\n        }\n\n        return 0;\n    },\n    loadAudioBuffer: async (context: AudioContext, file: File) => {\n        const arrayBuffer = await utilFunctions.readAsArrayBufferPromisified(file);\n        const audioBuffer = await context.decodeAudioData(arrayBuffer);\n        return utilFunctions.decodeBuffer(context, audioBuffer);\n    },\n    readAsArrayBufferPromisified: (file: File): Promise<ArrayBuffer> => {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n\n            reader.onload = ev => {\n                const result = ev?.target?.result;\n\n                if (result instanceof ArrayBuffer) {\n                    resolve(result);\n                } else {\n                    reject();\n                }\n            };\n\n            if (file) {\n                reader.readAsArrayBuffer(file); // Read the file\n            }\n        });\n    },\n    decodeBuffer: (context: AudioContext, buffer: AudioBuffer) => {\n        if (buffer.numberOfChannels == 1) { // convert to stereo buffer\n            context.resume();\n\n            const duration = buffer.duration;\n            const sampleRate = context.sampleRate;\n\n            const newBuffer = context.createBuffer(2, sampleRate * duration + sampleRate * 2, sampleRate);\n\n            // Original buffer data\n            const sourceChannelData = buffer.getChannelData(0);\n\n            // Destination buffers\n            const channel0Data = newBuffer.getChannelData(0);\n            const channel1Data = newBuffer.getChannelData(1);\n\n            for (let i = 0; i < sourceChannelData.length; i++) {\n                channel0Data[i] = sourceChannelData[i];\n                channel1Data[i] = sourceChannelData[i];\n            }\n\n            return newBuffer;\n        }\n\n        return buffer;\n    },\n    convertAudioBufferToFloat32Array: (buffer: AudioBuffer) => {\n        const array: Float32Array[] = [];\n\n        for (let channel = 0; channel < buffer.numberOfChannels; channel++) {\n            array.push(buffer.getChannelData(channel));\n        }\n\n        return array;\n    },\n    convertAudioParamToFloat32Array: (param: AudioParam, length: number) => {\n        const array = new Float32Array(length);\n\n        for (let i = 0; i < length; i++) {\n            array.set([param.value], i);\n        }\n\n        return array;\n    },\n    sumAudioBufferChannel(buffer: AudioBuffer, channel: number) {\n        return buffer.getChannelData(channel).reduce((a, b) => a + b, 0);\n    },\n    sumAudioBuffer(buffer: AudioBuffer) {\n        let sum = 0;\n\n        for (let channel = 0; channel < buffer.numberOfChannels; channel++) {\n            sum += this.sumAudioBufferChannel(buffer, channel);\n        }\n\n        return sum;\n    },\n    /**\n    * This method checks if the browser is compatible with audio worklets\n    * @param audioContext \n    */\n    isAudioWorkletCompatible(audioContext: BaseAudioContext) {\n        if (typeof (audioContext) !== \"undefined\" && typeof (audioContext.audioWorklet) !== \"undefined\") {\n            return true;\n        }\n\n        return false;\n    },\n    /**\n     * Check that the setting value is correct\n     * @param value FilterSettingValue\n     */\n    isSettingValueValid(value: FilterSettingValue) {\n        return typeof (value) !== \"undefined\" && !isNaN(Number(value)) && !(typeof (value) === \"string\" && value.trim() === \"\");\n    },\n    /**\n     * Calculate approximative audio duration according to enabled filters and their settings\n     * @param speedAudio Current audio speed\n     * @returns The audio duration\n     */\n    calculateAudioDuration(buffer: AudioBuffer, filterManager: FilterManagerInterface, speedAudio: number): number {\n        if (buffer && filterManager) {\n            const duration = this.calcAudioDuration(buffer, speedAudio);\n            return duration + filterManager.getAddingTime();\n        }\n\n        return 0;\n    },\n    /**\n     * Reset audio rendering progress\n     */\n    resetAudioRenderingProgress(eventEmitter: EventEmitterInterface | null) {\n        if (eventEmitter) {\n            eventEmitter.emit(EventType.UPDATE_AUDIO_TREATMENT_PERCENT, 0);\n            eventEmitter.emit(EventType.UPDATE_REMAINING_TIME_ESTIMATED, -1);\n        }\n    },\n    forceDownload(blob: Blob, filename: string) {\n        const link = window.document.createElement(\"a\");\n        const url = URL.createObjectURL(blob);\n        window.document.body.appendChild(link);\n        link.href = url;\n        link.download = filename || \"output.wav\";\n        link.click();\n        URL.revokeObjectURL(url);\n    }\n};\n\nexport default utilFunctions;\n","import AbstractAudioElement from \"../filters/interfaces/AbstractAudioElement\";\nimport AbstractAudioFilter from \"../filters/interfaces/AbstractAudioFilter\";\nimport AbstractAudioRenderer from \"../filters/interfaces/AbstractAudioRenderer\";\nimport utils from \"../utils/Functions\";\nimport { EventType } from \"../model/EventTypeEnum\";\nimport Constants from \"../model/Constants\";\nimport utilFunctions from \"../utils/Functions\";\nimport { FilterSettings } from \"../model/filtersSettings/FilterSettings\";\nimport { EventEmitterCallback } from \"../model/EventEmitterCallback\";\nimport { FilterState } from \"../model/FilterState\";\nimport SaveBufferOptions from \"../model/SaveBufferOptions\";\nimport { TYPES } from \"../inversify.types\";\nimport { inject, injectable } from \"inversify\";\nimport AudioEditorInterface from \"./interfaces/AudioEditorInterface\";\nimport type FilterManagerInterface from \"./interfaces/FilterManagerInterface\";\nimport type RendererManagerInterface from \"./interfaces/RendererManagerInterface\";\nimport type AudioContextManagerInterface from \"./interfaces/AudioContextManagerInterface\";\nimport type SaveBufferManagerInterface from \"./interfaces/SaveBufferManagerInteface\";\nimport type AudioProcessorInterface from \"./interfaces/AudioProcessorInterface\";\nimport type BufferManagerInterface from \"./interfaces/BufferManagerInterface\";\nimport type BufferPlayerInterface from \"@/bufferPlayer/interfaces/BufferPlayerInterface\";\n\n@injectable()\nexport default class AudioEditor extends AbstractAudioElement implements AudioEditorInterface {\n\n    /** The filter manager */\n    private filterManager: FilterManagerInterface | undefined;\n\n    /** The renderer manager */\n    private rendererManager: RendererManagerInterface | undefined;\n\n    /** The context manager */\n    private contextManager: AudioContextManagerInterface | undefined;\n\n    /** The save buffer manager */\n    private saveBufferManager: SaveBufferManagerInterface | undefined;\n\n    /** The save buffer manager */\n    private audioProcessor: AudioProcessorInterface | undefined;\n\n    /** The save buffer manager */\n    private bufferManager: BufferManagerInterface | undefined;\n\n    /** The audio player */\n    private bufferPlayer: BufferPlayerInterface | undefined;\n\n    /** The audio buffer to be processed */\n    private principalBuffer: AudioBuffer | null = null;\n\n    constructor(\n        @inject(TYPES.FilterManager) filterManager: FilterManagerInterface,\n        @inject(TYPES.RendererManager) rendererManager: RendererManagerInterface,\n        @inject(TYPES.AudioContextManager) contextManager: AudioContextManagerInterface,\n        @inject(TYPES.SaveBufferManager) saveBufferManager: SaveBufferManagerInterface,\n        @inject(TYPES.AudioProcessor) audioProcessor: AudioProcessorInterface,\n        @inject(TYPES.BufferManager) bufferManager: BufferManagerInterface,\n        @inject(TYPES.BufferPlayer) player: BufferPlayerInterface\n    ) {\n        super();\n\n        this.filterManager = filterManager;\n        this.rendererManager = rendererManager;\n        this.contextManager = contextManager;\n        this.saveBufferManager = saveBufferManager;\n        this.audioProcessor = audioProcessor;\n        this.bufferManager = bufferManager;\n        this.bufferPlayer = player;\n\n        this.setup();\n    }\n\n    private setup() {\n        if (this.bufferPlayer) {\n            // Callback called just before starting playing audio, when compatibility mode is enabled\n            this.bufferPlayer.onBeforePlaying(async () => {\n                if (this.bufferPlayer && this.bufferPlayer.compatibilityMode\n                    && this.contextManager && this.contextManager.currentContext && this.audioProcessor) {\n                    await this.audioProcessor.setupOutput(this.principalBuffer, this.contextManager.currentContext);\n                }\n            });\n\n            // Callback called when playing is finished\n            this.bufferPlayer.on(EventType.PLAYING_FINISHED, () => {\n                if (this.bufferPlayer && this.bufferPlayer.loop) {\n                    this.bufferPlayer.start();\n                }\n            });\n        }\n    }\n\n    addFilters(...filters: AbstractAudioFilter[]) {\n        if (this.filterManager) {\n            this.filterManager.addFilters(...filters);\n        }\n    }\n\n    addRenderers(...renderers: AbstractAudioRenderer[]) {\n        if (this.rendererManager) {\n            this.rendererManager.addRenderers(...renderers);\n        }\n    }\n\n    get currentSampleRate(): number {\n        if (this.contextManager) {\n            return this.contextManager.currentSampleRate;\n        }\n\n        return 0;\n    }\n\n    get defaultDeviceSampleRate(): number {\n        const tempContext = new AudioContext();\n        let sampleRate = 0;\n\n        if (tempContext) {\n            sampleRate = tempContext.sampleRate;\n            tempContext.close();\n        }\n\n        return sampleRate;\n    }\n\n    async loadBufferFromFile(file: File) {\n        this.principalBuffer = null;\n\n        if (this.audioProcessor) {\n            await this.audioProcessor.prepareContext(this.principalBuffer);\n        }\n\n        if (this.contextManager && this.contextManager.currentContext && this.bufferDecoderService && this.audioProcessor) {\n            this.principalBuffer = await this.bufferDecoderService.decodeBufferFromFile(file);\n            this.audioProcessor.initialRenderingDone = false;\n\n            if (this.principalBuffer) {\n                this.audioProcessor.sumInputBuffer = utils.sumAudioBuffer(this.principalBuffer);\n            } else {\n                throw new Error(\"Error decoding audio file\");\n            }\n\n            utilFunctions.resetAudioRenderingProgress(this.eventEmitter);\n        } else {\n            throw new Error(\"Audio Context is not ready!\");\n        }\n    }\n\n    loadBuffer(audioBuffer: AudioBuffer) {\n        this.principalBuffer = audioBuffer;\n\n        if (this.audioProcessor) {\n            this.audioProcessor.sumInputBuffer = utils.sumAudioBuffer(this.principalBuffer);\n            this.audioProcessor.initialRenderingDone = false;\n        }\n    }\n\n    getOutputBuffer() {\n        if (this.audioProcessor) {\n            return this.audioProcessor.renderedBuffer;\n        }\n\n        return null;\n    }\n\n    async renderAudio(): Promise<boolean> {\n        if (this.audioProcessor) {\n            return await this.audioProcessor.renderAudio(this.principalBuffer);\n        }\n\n        return false;\n    }\n\n    isAudioWorkletAvailable(): boolean {\n        if (this.contextManager && this.contextManager.currentContext) {\n            return utilFunctions.isAudioWorkletCompatible(this.contextManager.currentContext);\n        }\n\n        return false;\n    }\n\n    /** Filters settings */\n\n    getFiltersState(): FilterState {\n        if (this.filterManager && this.rendererManager) {\n            return {\n                ...this.filterManager.getFiltersState(),\n                ...this.rendererManager.getRenderersState()\n            };\n        }\n\n        return {};\n    }\n\n    getFiltersSettings(): Map<string, FilterSettings> {\n        if (this.filterManager) {\n            return this.filterManager.getFiltersSettings();\n        }\n\n        return new Map();\n    }\n\n    async reconnectNodesIfNeeded() {\n        if (this.contextManager && this.bufferPlayer && this.bufferPlayer.compatibilityMode &&\n            this.contextManager.currentContext && this.principalBuffer &&\n            this.filterManager && this.filterManager.entrypointFilter) {\n            await this.filterManager.connectNodes(this.contextManager.currentContext, this.principalBuffer, true, this.bufferPlayer.compatibilityMode);\n\n            const speedAudio = this.filterManager.entrypointFilter.getSpeed();\n            this.bufferPlayer.speedAudio = speedAudio;\n            this.bufferPlayer.duration = utilFunctions.calculateAudioDuration(this.principalBuffer, this.filterManager, speedAudio) * speedAudio;\n        }\n    }\n\n    toggleFilter(filterId: string) {\n        if (this.rendererManager) {\n            this.rendererManager.toggleRenderer(filterId);\n        }\n\n        if (this.filterManager) {\n            this.filterManager.toggleFilter(filterId);\n            this.reconnectNodesIfNeeded();\n        }\n    }\n\n    async changeFilterSettings(filterId: string, settings: FilterSettings) {\n        if (this.filterManager) {\n            await this.filterManager.changeFilterSettings(filterId, settings);\n            await this.reconnectNodesIfNeeded();\n        }\n    }\n\n    async resetFilterSettings(filterId: string) {\n        if (this.filterManager) {\n            await this.filterManager.resetFilterSettings(filterId);\n            await this.reconnectNodesIfNeeded();\n        }\n    }\n\n    resetAllFiltersState() {\n        if (this.rendererManager) {\n            this.rendererManager.resetAllRenderersState();\n        }\n\n        if (this.filterManager) {\n            this.filterManager.resetAllFiltersState();\n            this.reconnectNodesIfNeeded();\n        }\n    }\n\n    /** Events and exit */\n\n    exit() {\n        if (this.bufferPlayer) {\n            this.bufferPlayer.stop();\n            this.bufferPlayer.reset();\n        }\n\n        this.cancelAudioRendering();\n        this.principalBuffer = null;\n    }\n\n    cancelAudioRendering() {\n        if (this.audioProcessor) {\n            this.audioProcessor.cancelAudioRendering();\n        }\n    }\n\n    on(event: string, callback: EventEmitterCallback) {\n        if (this.eventEmitter) {\n            this.eventEmitter.on(event, callback);\n        }\n    }\n\n    off(event: string, callback: EventEmitterCallback) {\n        if (this.eventEmitter) {\n            this.eventEmitter.off(event, callback);\n        }\n    }\n\n    async saveBuffer(options?: SaveBufferOptions): Promise<boolean> {\n        if (this.saveBufferManager && this.audioProcessor) {\n            return await this.saveBufferManager?.saveBuffer(this.audioProcessor.renderedBuffer, options);\n        }\n\n        return false;\n    }\n\n    set downloadingInitialData(state: boolean) {\n        if (this.bufferManager) {\n            this.bufferManager.downloadingInitialData = state;\n        }\n    }\n\n    get downloadingInitialData(): boolean {\n        if (this.bufferManager) {\n            return this.bufferManager.downloadingInitialData;\n        }\n\n        return false;\n    }\n\n    get order(): number {\n        return -1;\n    }\n\n    get id(): string {\n        return Constants.AUDIO_EDITOR;\n    }\n}\n","import AbstractAudioElement from \"@/filters/interfaces/AbstractAudioElement\";\nimport { EventType } from \"@/model/EventTypeEnum\";\nimport utils from \"../utils/Functions\";\nimport Constants from \"@/model/Constants\";\nimport AudioProcessorInterface from \"./interfaces/AudioProcessorInterface\";\nimport { inject, injectable } from \"inversify\";\nimport type BufferPlayerInterface from \"@/bufferPlayer/interfaces/BufferPlayerInterface\";\nimport type BufferManagerInterface from \"./interfaces/BufferManagerInterface\";\nimport AudioContextManagerInterface from \"./interfaces/AudioContextManagerInterface\";\nimport type RendererManagerInterface from \"./interfaces/RendererManagerInterface\";\nimport type FilterManagerInterface from \"./interfaces/FilterManagerInterface\";\nimport { TYPES } from \"@/inversify.types\";\n\n@injectable()\nexport default class AudioProcessor extends AbstractAudioElement implements AudioProcessorInterface {\n\n    /** The filter manager */\n    private filterManager: FilterManagerInterface | undefined;\n\n    /** The filter manager */\n    private rendererManager: RendererManagerInterface | undefined;\n\n    /** The context manager */\n    private contextManager: AudioContextManagerInterface | undefined;\n\n    /** The audio player */\n    private bufferPlayer: BufferPlayerInterface | undefined;\n\n    /** The save buffer manager */\n    private bufferManager: BufferManagerInterface | undefined;\n\n    /** The current offline context */\n    private currentOfflineContext: OfflineAudioContext | null | undefined;\n\n    /** The resulting audio buffer */\n    private _renderedBuffer: AudioBuffer | null = null;\n\n    /** true if the user wanted to cancel audio rendering */\n    private audioRenderingLastCanceled = false;\n\n    /** true if initial rendering for the current buffer was done */\n    initialRenderingDone = false;\n    /** The sum of all the samples of the input buffer,\n     * used to detect the need to enable the compatibility mode */\n    sumInputBuffer: number = 0;\n\n    constructor(\n        @inject(TYPES.FilterManager) filterManager: FilterManagerInterface | undefined,\n        @inject(TYPES.RendererManager) rendererManager: RendererManagerInterface | undefined,\n        @inject(TYPES.AudioContextManager) contextManager: AudioContextManagerInterface | undefined,\n        @inject(TYPES.BufferPlayer) bufferPlayer: BufferPlayerInterface | undefined,\n        @inject(TYPES.BufferManager) bufferManager: BufferManagerInterface | undefined) {\n        super();\n\n        this.contextManager = contextManager;\n        this.bufferPlayer = bufferPlayer;\n        this.filterManager = filterManager;\n        this.rendererManager = rendererManager;\n        this.bufferManager = bufferManager;\n    }\n\n    async prepareContext(inputBuffer: AudioBuffer | null) {\n        if (this.contextManager) {\n            const changed = this.contextManager.createNewContextIfNeeded(inputBuffer);\n\n            if (changed && this.bufferManager) {\n                await this.bufferManager.resetBufferFetcher();\n            }\n\n            if (this.contextManager.currentContext) {\n                this.contextManager.currentContext.resume();\n            }\n        }\n    }\n\n    async renderAudio(inputBuffer: AudioBuffer | null): Promise<boolean> {\n        await this.prepareContext(inputBuffer);\n\n        if (!this.contextManager || !this.contextManager.currentContext) {\n            throw new Error(\"AudioContext is not yet available\");\n        }\n\n        if (!this.filterManager) {\n            throw new Error(\"Filter manager is not available\");\n        }\n\n        if (!this.rendererManager) {\n            throw new Error(\"Renderer manager is not available\");\n        }\n\n        if (!this.filterManager.entrypointFilter) {\n            throw new Error(\"Entrypoint filter is not available\");\n        }\n\n        if (!inputBuffer) {\n            throw new Error(\"No principal buffer available\");\n        }\n\n        // If initial rendering is disabled and compatibility mode is disabled, we stop here\n        if (!this.initialRenderingDone && this.configService && this.configService.isInitialRenderingDisabled() && !this.configService.isCompatibilityModeEnabled()) {\n            this.loadInitialBuffer(inputBuffer);\n            this.initialRenderingDone = true;\n            return true;\n        }\n\n        // If switching from compatiblity mode to normal mode, we stop the audio player\n        if (this.configService && this.bufferPlayer && !this.configService.isCompatibilityModeEnabled() && this.bufferPlayer.compatibilityMode) {\n            this.bufferPlayer.stop();\n        }\n\n        const speedAudio = this.filterManager.entrypointFilter.getSpeed();\n        const durationAudio = utils.calculateAudioDuration(inputBuffer, this.filterManager, speedAudio);\n        const offlineContext = new OfflineAudioContext(2, this.contextManager.currentContext.sampleRate * durationAudio, this.contextManager.currentContext.sampleRate);\n        const outputContext = this.configService && this.configService.isCompatibilityModeEnabled() ? this.contextManager.currentContext : offlineContext;\n\n        this._renderedBuffer = await this.rendererManager.executeAudioRenderers(inputBuffer, outputContext);\n        this.currentOfflineContext = null;\n        this.audioRenderingLastCanceled = false;\n\n\n        utils.resetAudioRenderingProgress(this.eventEmitter);\n        this.filterManager.setupTotalSamples(durationAudio, this.contextManager.currentContext);\n\n        return await this.setupOutput(inputBuffer, outputContext, durationAudio, offlineContext);\n    }\n\n    private setupPlayerSpeed(bufferPlayer: BufferPlayerInterface) {\n        if (this.filterManager && this.filterManager.entrypointFilter) {\n            const speedAudio = this.filterManager.entrypointFilter.getSpeed();\n            bufferPlayer.speedAudio = speedAudio;\n        }\n    }\n\n    async setupOutput(inputBuffer: AudioBuffer | null, outputContext: BaseAudioContext, durationAudio?: number, offlineContext?: OfflineAudioContext): Promise<boolean> {\n        if (this._renderedBuffer && this.configService && this.eventEmitter && this.bufferPlayer && this.filterManager) {\n            // Initialize worklets then connect the filter nodes\n            await this.filterManager.initializeWorklets(outputContext);\n            await this.filterManager.connectNodes(outputContext, this._renderedBuffer, false, this.configService.isCompatibilityModeEnabled());\n\n            this.setupPlayerSpeed(this.bufferPlayer);\n\n            // Standard mode\n            if (!this.configService.isCompatibilityModeEnabled() && offlineContext && this.filterManager.currentNodes) {\n                this.currentOfflineContext = offlineContext;\n                this.filterManager.currentNodes.output.connect(outputContext.destination);\n\n                const renderedBuffer = await offlineContext.startRendering();\n\n                if (this.contextManager && !this.loadRenderedAudio(inputBuffer, renderedBuffer)) {\n                    return await this.setupOutput(inputBuffer, this.contextManager.currentContext!, durationAudio);\n                }\n\n                if (this.audioRenderingLastCanceled) {\n                    return false;\n                }\n\n                this.eventEmitter.emit(EventType.OFFLINE_AUDIO_RENDERING_FINISHED);\n            } else { // Compatibility mode\n                if (this.filterManager.currentNodes) {\n                    this.bufferPlayer.setCompatibilityMode(this.filterManager.currentNodes.output, durationAudio);\n                    this.initialRenderingDone = true;\n                }\n            }\n\n            this.eventEmitter.emit(EventType.AUDIO_RENDERING_FINISHED);\n\n            return true;\n        }\n\n        return false;\n    }\n\n    /**\n     * Load rendered audio buffer into audio player\n     * @param renderedBuffer Rendered audio buffer - AudioBuffer\n     * @returns false if the rendred audio buffer is invalid, true otherwise\n     */\n    private loadRenderedAudio(inputBuffer: AudioBuffer | null, renderedBuffer: AudioBuffer): boolean {\n        if (this.eventEmitter && this.bufferPlayer) {\n            if (!this.audioRenderingLastCanceled) {\n                const sumRenderedAudio = utils.sumAudioBuffer(renderedBuffer);\n\n                if (sumRenderedAudio == 0 && this.sumInputBuffer !== 0) {\n                    if (this.configService && !this.configService.isCompatibilityModeChecked()) {\n                        this.setCompatibilityModeChecked(true);\n                        this.configService.enableCompatibilityMode();\n                        this.eventEmitter.emit(EventType.COMPATIBILITY_MODE_AUTO_ENABLED);\n\n                        return false;\n                    }\n\n                    this.eventEmitter.emit(EventType.RENDERING_AUDIO_PROBLEM_DETECTED);\n                }\n\n                this._renderedBuffer = renderedBuffer;\n                this.bufferPlayer.loadBuffer(this._renderedBuffer);\n            } else if (!this.initialRenderingDone) {\n                this.loadInitialBuffer(inputBuffer);\n                this.eventEmitter.emit(EventType.CANCELLED_AND_LOADED_INITIAL_AUDIO);\n            }\n\n            this.initialRenderingDone = true;\n        }\n\n        return true;\n    }\n\n    /**\n     * Load the initial audio buffer to the buffer player\n     */\n    private loadInitialBuffer(inputBuffer: AudioBuffer | null) {\n        if (this.bufferPlayer) {\n            this._renderedBuffer = inputBuffer;\n            this.bufferPlayer.loadBuffer(inputBuffer!);\n        }\n    }\n\n    public cancelAudioRendering() {\n        if (this.currentOfflineContext && !this.audioRenderingLastCanceled && this.filterManager) {\n            this.audioRenderingLastCanceled = true;\n            this.filterManager.disconnectOldNodes(false);\n\n            if (this.eventEmitter) {\n                this.eventEmitter.emit(EventType.CANCELLING_AUDIO_PROCESSING);\n            }\n        }\n    }\n\n    /**\n     * Set compatibility/direct audio rendering mode already checked for auto enabling (if an error occurs rendering in offline context)\n     * @param checked boolean\n     */\n    private setCompatibilityModeChecked(checked: boolean) {\n        if (this.configService) {\n            this.configService.setConfig(Constants.PREFERENCES_KEYS.COMPATIBILITY_MODE_CHECKED, \"\" + checked);\n        }\n    }\n\n    get renderedBuffer() {\n        return this._renderedBuffer;\n    }\n\n    get order(): number {\n        return -1;\n    }\n\n    get id(): string {\n        return Constants.AUDIO_PROCESSOR;\n    }\n}\n","import AbstractAudioElement from \"@/filters/interfaces/AbstractAudioElement\";\nimport Constants from \"@/model/Constants\";\nimport { EventType } from \"@/model/EventTypeEnum\";\nimport BufferManagerInterface from \"./interfaces/BufferManagerInterface\";\nimport { inject, injectable } from \"inversify\";\nimport { TYPES } from \"@/inversify.types\";\nimport EventEmitterInterface from \"@/utils/interfaces/EventEmitterInterface\";\nimport type FilterManagerInterface from \"./interfaces/FilterManagerInterface\";\nimport type BufferFetcherServiceInterface from \"@/services/interfaces/BufferFetcherServiceInterface\";\n\n@injectable()\nexport default class BufferManager extends AbstractAudioElement implements BufferManagerInterface {\n\n    /** The filter manager */\n    private filterManager: FilterManagerInterface | undefined;\n\n    /** True if we are downloading initial buffer data */\n    downloadingInitialData = false;\n\n    /** List of audio buffers to fetch */\n    private audioBuffersToFetch: string[] = [];\n\n    constructor(\n        @inject(TYPES.FilterManager) filterManager: FilterManagerInterface,\n        @inject(TYPES.BufferFetcherService) bufferFetcherService: BufferFetcherServiceInterface,\n        @inject(TYPES.EventEmitter) eventEmitter: EventEmitterInterface | null,\n        @inject(TYPES.AudioBuffersToFetch) audioBuffersToFetch: string[]) {\n        super();\n\n        this.bufferFetcherService = bufferFetcherService;\n        this.eventEmitter = eventEmitter;\n        this.filterManager = filterManager;\n        this.filterManager = filterManager;\n        this.audioBuffersToFetch = audioBuffersToFetch;\n\n        this.setup();\n    }\n\n    private setup() {\n        if (this.audioBuffersToFetch.length > 0) {\n            this.fetchBuffers(false);\n        }\n    }\n\n    /**\n     * Fetch default buffers from network\n     * @param refetch true if we need to refetch the buffers\n     */\n    private async fetchBuffers(refetch: boolean) {\n        if (this.downloadingInitialData || !this.bufferFetcherService) {\n            return;\n        }\n\n        this.downloadingInitialData = true;\n\n        if (this.eventEmitter && !refetch) {\n            this.eventEmitter.emit(EventType.LOADING_BUFFERS);\n        }\n\n        try {\n            this.bufferFetcherService.fetchAllBuffers(this.audioBuffersToFetch);\n            this.downloadingInitialData = false;\n\n            if (this.eventEmitter && !refetch) {\n                this.eventEmitter.emit(EventType.LOADED_BUFFERS);\n            }\n        } catch (e) {\n            if (this.eventEmitter && !refetch) {\n                this.eventEmitter.emit(EventType.LOADING_BUFFERS_ERROR);\n            }\n        }\n    }\n\n    async resetBufferFetcher() {\n        if (this.bufferFetcherService) {\n            this.bufferFetcherService.reset();\n\n            await this.fetchBuffers(true);\n\n            if (this.filterManager) {\n                await this.filterManager.resetFilterBuffers();\n            }\n        }\n    }\n\n    get order(): number {\n        return -1;\n    }\n\n    get id(): string {\n        return Constants.BUFFER_MANAGER;\n    }\n}\n","import AbstractAudioElement from \"@/filters/interfaces/AbstractAudioElement\";\nimport AbstractAudioFilter from \"@/filters/interfaces/AbstractAudioFilter\";\nimport AudioFilterEntrypointInterface from \"@/filters/interfaces/AudioFilterEntrypointInterface\";\nimport { AudioFilterNodes } from \"@/model/AudioNodes\";\nimport AbstractAudioFilterWorklet from \"@/filters/interfaces/AbstractAudioFilterWorklet\";\nimport { FilterState } from \"@/model/FilterState\";\nimport { FilterSettings } from \"@/model/filtersSettings/FilterSettings\";\nimport Constants from \"@/model/Constants\";\nimport FilterManagerInterface from \"./interfaces/FilterManagerInterface\";\nimport { inject, injectable, multiInject } from \"inversify\";\nimport { TYPES } from \"@/inversify.types\";\n\n@injectable()\nexport default class FilterManager extends AbstractAudioElement implements FilterManagerInterface {\n\n    /** A list of filters */\n    private filters: AbstractAudioFilter[] = [];\n\n    /** The entrypoint filter */\n    private _entryPointFilter: (AbstractAudioFilter & AudioFilterEntrypointInterface) | null = null;\n\n    /** The current connected nodes */\n    private _currentNodes: AudioFilterNodes | null = null;\n\n    constructor(\n        @multiInject(TYPES.Filters) filters: AbstractAudioFilter[],\n        @inject(TYPES.EntryPointFilter) entryPointFilter: (AbstractAudioFilter & AudioFilterEntrypointInterface) | null\n    ) {\n        super();\n\n        this.filters = filters;\n        this._entryPointFilter = entryPointFilter;\n\n        this.setup();\n    }\n\n    private setup() {\n        for (const filter of this.filters) {\n            filter.initializeDefaultSettings();\n        }\n    }\n\n    addFilters(...filters: AbstractAudioFilter[]) {\n        for (const filter of filters) {\n            filter.initializeDefaultSettings();\n            filter.injectDependencies(this.bufferFetcherService, this.bufferDecoderService, this.configService, this.eventEmitter);\n        }\n\n        this.filters.push(...filters);\n    }\n\n    getFiltersState(): FilterState {\n        const state: FilterState = {};\n\n        this.filters.forEach(filter => {\n            state[filter.id] = filter.isEnabled();\n        });\n\n        return state;\n    }\n\n    getFiltersSettings(): Map<string, FilterSettings> {\n        const settings = new Map<string, FilterSettings>();\n\n        for (const filter of this.filters) {\n            settings.set(filter.id, filter.getSettings());\n        }\n\n        return settings;\n    }\n\n    toggleFilter(filterId: string) {\n        const filter = this.filters.find(f => f.id === filterId);\n\n        if (filter) {\n            filter.toggle();\n        }\n    }\n\n    async changeFilterSettings(filterId: string, settings: FilterSettings) {\n        const filter = this.filters.find(f => f.id === filterId);\n\n        if (filter) {\n            for (const key of Object.keys(settings)) {\n                await filter.setSetting(key, settings[key]);\n            }\n        }\n    }\n\n    async resetFilterSettings(filterId: string) {\n        const filter = this.filters.find(f => f.id === filterId);\n\n        if (filter) {\n            await filter.resetSettings();\n        }\n    }\n\n    resetAllFiltersState() {\n        this.filters.forEach(element => {\n            if (element.isDefaultEnabled()) {\n                element.enable();\n            } else {\n                element.disable();\n            }\n        });\n    }\n\n    async connectNodes(context: BaseAudioContext, buffer: AudioBuffer, keepCurrentInputOutput: boolean, isCompatibilityMode: boolean): Promise<void> {\n        if (!this._entryPointFilter) {\n            return;\n        }\n\n        let entrypointNode: AudioNode | null = null;\n\n        if (keepCurrentInputOutput && this._currentNodes) {\n            entrypointNode = this._currentNodes.input;\n        } else {\n            const entrypointNodes = await this._entryPointFilter.getEntrypointNode(context, buffer, !isCompatibilityMode);\n            entrypointNode = entrypointNodes.input;\n        }\n\n        const intermediateNodes: AudioFilterNodes[] = [];\n        let previousNode: AudioNode | undefined = entrypointNode;\n\n        this.disconnectOldNodes(keepCurrentInputOutput);\n\n        // Sort by filter order, then remove the disabled filter (but always keep the last/output filter)\n        const filters = this.filters\n            .sort((a, b) => a.order - b.order)\n            .filter((filter, index) => filter !== this._entryPointFilter && (filter.isEnabled() || index >= this.filters.length - 1));\n\n        for (const filter of filters) {\n            const node = filter.getNode(context);\n\n            if (previousNode) {\n                previousNode.connect(node.input);\n            }\n\n            previousNode = node.output;\n            intermediateNodes.push(node);\n        }\n\n        if (this._entryPointFilter) {\n            this._entryPointFilter.updateState();\n        }\n\n        this._currentNodes = {\n            input: entrypointNode!,\n            output: previousNode!,\n            intermediateNodes: intermediateNodes\n                .filter(n => n.input != previousNode && n.output != previousNode &&\n                    n.input != entrypointNode && n.output != entrypointNode)\n        };\n    }\n\n    disconnectOldNodes(keepCurrentOutput: boolean) {\n        if (this._currentNodes) {\n            this._currentNodes.input.disconnect();\n\n            if (!keepCurrentOutput) {\n                this._currentNodes.output.disconnect();\n            }\n\n            if (this._currentNodes.intermediateNodes) {\n                for (const intermediate of this._currentNodes.intermediateNodes) {\n                    intermediate.input.disconnect();\n                    intermediate.output.disconnect();\n                }\n            }\n        }\n    }\n\n    async initializeWorklets(context: BaseAudioContext) {\n        for (const filter of this.filters) {\n            if (filter.isWorklet()) {\n                await (filter as AbstractAudioFilterWorklet<object>).initializeWorklet(context);\n            }\n        }\n    }\n\n    getAddingTime() {\n        let duration = 0;\n\n        for (const filter of this.filters) {\n            if (filter.isEnabled()) {\n                duration += filter.getAddingTime();\n            }\n        }\n\n        return duration;\n    }\n\n    setupTotalSamples(durationAudio: number, currentContext: AudioContext | null) {\n        if (currentContext) {\n            const totalSamples = durationAudio * currentContext.sampleRate;\n\n            for (const filter of this.filters) {\n                filter.totalSamples = totalSamples;\n            }\n        }\n    }\n\n    async resetFilterBuffers() {\n        for (const filter of this.filters) {\n            await filter.bufferFetcherReseted();\n        }\n    }\n\n    get entrypointFilter() {\n        return this._entryPointFilter;\n    }\n\n    get currentNodes() {\n        return this._currentNodes;\n    }\n\n    get order(): number {\n        return -1;\n    }\n\n    get id(): string {\n        return Constants.FILTER_MANAGER;\n    }\n}\n","import { injectable, multiInject } from \"inversify\";\nimport { TYPES } from \"@/inversify.types\";\nimport AbstractAudioElement from \"@/filters/interfaces/AbstractAudioElement\";\nimport AbstractAudioRenderer from \"@/filters/interfaces/AbstractAudioRenderer\";\nimport { FilterState } from \"@/model/FilterState\";\nimport Constants from \"@/model/Constants\";\nimport RendererManagerInterface from \"./interfaces/RendererManagerInterface\";\n\n@injectable()\nexport default class RendererManager extends AbstractAudioElement implements RendererManagerInterface {\n\n    /** A list of renderers */\n    private renderers: AbstractAudioRenderer[] = [];\n\n    constructor(\n        @multiInject(TYPES.Renderers) renderers: AbstractAudioRenderer[] = []) {\n        super();\n\n        this.renderers = renderers;\n    }\n\n    addRenderers(...renderers: AbstractAudioRenderer[]) {\n        for (const renderer of renderers) {\n            renderer.injectDependencies(this.bufferFetcherService, this.bufferDecoderService, this.configService, this.eventEmitter);\n        }\n\n        this.renderers.push(...renderers);\n    }\n\n    getRenderersState(): FilterState {\n        const state: FilterState = {};\n\n        this.renderers.forEach(renderer => {\n            state[renderer.id] = renderer.isEnabled();\n        });\n\n        return state;\n    }\n\n    toggleRenderer(rendererId: string) {\n        const renderer = this.renderers.find(f => f.id === rendererId);\n\n        if (renderer) {\n            renderer.toggle();\n        }\n    }\n\n    resetAllRenderersState() {\n        this.renderers.forEach(element => {\n            if (element.isDefaultEnabled()) {\n                element.enable();\n            } else {\n                element.disable();\n            }\n        });\n    }\n\n    async executeAudioRenderers(buffer: AudioBuffer, outputContext: AudioContext | OfflineAudioContext) {\n        let currentBuffer = buffer;\n\n        for (const renderer of this.renderers.sort((a, b) => a.order - b.order)) {\n            if (renderer.isEnabled()) {\n                currentBuffer = await renderer.renderAudio(outputContext, currentBuffer);\n            }\n        }\n\n        return currentBuffer;\n    }\n\n    get order(): number {\n        return -1;\n    }\n\n    get id(): string {\n        return Constants.RENDERER_MANAGER;\n    }\n}\n","export default function getRecorderWorker(workerBasePath?: string): Worker {\n    return new Worker((workerBasePath ? workerBasePath : \"\") + \"RecorderWorker.js\");\n};\n","import { injectable } from \"inversify\";\nimport Constants from \"../model/Constants\";\nimport { RecorderCallback, RecorderCallbacks } from \"../model/RecorderCallback\";\nimport type RecorderConfig from \"../model/RecorderConfig\";\nimport RecorderWorkerMessage from \"../model/RecorderWorkerMessage\";\nimport RecorderWorkletMessage from \"../model/RecorderWorkletMessage\";\nimport utilFunctions from \"../utils/Functions\";\nimport getRecorderWorker from \"./getRecorderWorker\";\nimport RecorderInterface from \"./interfaces/RecorderInterface\";\n\n@injectable()\nexport class Recorder implements RecorderInterface {\n\n    // Inline Worker\n    private worker: Worker | null = null;\n    private node: ScriptProcessorNode | AudioWorkletNode | null = null;\n    private context: BaseAudioContext | null = null;\n\n    private config: RecorderConfig = {\n        bufferLen: 4096,\n        sampleRate: 44100,\n        numChannels: 2,\n        mimeType: \"audio/wav\",\n        workletBasePath: \"worklets/\",\n        workerBasePath: \"workers/\",\n        bitrate: Constants.DEFAULT_MP3_BITRATE,\n        callback: () => { }\n    };\n\n    private callbacks: RecorderCallbacks = {\n        getBuffer: [],\n        exportWAV: [],\n        exportMP3: []\n    };\n\n    recording = false;\n\n    constructor(cfg: RecorderConfig) {\n        Object.assign(this.config, cfg);\n    }\n\n    async setup(source: AudioNode) {\n        if (this.node) { // Disconnect previous node\n            if (this.node instanceof AudioWorkletNode) {\n                this.node.port.postMessage(\"stop\");\n            }\n\n            this.node.disconnect();\n        }\n\n        if (source) {\n            this.context = source.context;\n\n            await this.createRecorderNode();\n\n            if (this.node && this.context) {\n                source.connect(this.node);\n                this.node.connect(this.context.destination);    //this should not be necessary\n            }\n        }\n\n        if (this.context && !this.worker) {\n            this.worker = getRecorderWorker(this.config.workerBasePath);\n\n            if (this.worker) {\n                this.worker.postMessage({\n                    command: \"init\",\n                    config: {\n                        sampleRate: this.context.sampleRate,\n                        numChannels: this.config.numChannels,\n                        bitrate: this.config.bitrate\n                    }\n                });\n\n                this.worker.onmessage = (e: RecorderWorkerMessage) => {\n                    let callbacks = null;\n\n                    switch (e.data.command) {\n                    case \"getBuffer\":\n                        callbacks = this.callbacks.getBuffer;\n                        break;\n                    case Constants.EXPORT_WAV_COMMAND:\n                        callbacks = this.callbacks.exportWAV;\n                        break;\n                    case Constants.EXPORT_MP3_COMMAND:\n                        callbacks = this.callbacks.exportMP3;\n                        break;\n                    }\n\n                    if (callbacks) {\n                        const cb = callbacks.pop();\n                        if (typeof cb == \"function\") {\n                            (cb as RecorderCallback<Blob | Float32Array[]>)(e.data.data);\n                        }\n                    }\n                };\n            }\n        }\n    }\n\n\n    private async createRecorderNode() {\n        if (this.context) {\n            if (utilFunctions.isAudioWorkletCompatible(this.context) && Constants.ENABLE_RECORDER_AUDIO_WORKLET) {\n                try {\n                    await this.createRecorderWorklet();\n                } catch(e) {\n                    this.createRecorderScriptProcessorNode();\n                }\n            } else {\n                this.createRecorderScriptProcessorNode();\n            }\n        }\n    }\n\n    private async createRecorderWorklet() {\n        if (this.context) {\n            await this.context.audioWorklet.addModule(this.config.workletBasePath + Constants.WORKLET_PATHS.RECORDER_WORKLET);\n\n            this.node = new AudioWorkletNode(this.context, Constants.WORKLET_NAMES.RECORDER_WORKLET);\n\n            if (this.node && this.node.port) {\n                const numChannelParameter = this.node.parameters.get(\"numChannels\");\n\n                if(numChannelParameter) {\n                    numChannelParameter.value = this.config.numChannels;\n                    numChannelParameter.setValueAtTime(this.config.numChannels, 0);\n                }\n\n                this.node.port.onmessage = (e: MessageEvent<RecorderWorkletMessage>) => {\n                    if (this.worker && e.data.command == \"record\" && e.data.buffer.length > 0) {\n                        this.worker.postMessage({\n                            command: \"record\",\n                            buffer: e.data.buffer\n                        });\n                    }\n                };\n            }\n        }\n    }\n\n    private createRecorderScriptProcessorNode() {\n        if (this.context) {\n            this.node = (this.context.createScriptProcessor).call(this.context,\n                this.config.bufferLen, this.config.numChannels, this.config.numChannels);\n\n            this.node.onaudioprocess = (e) => {\n                if (!this.recording) return;\n\n                const buffer = [];\n                for (let channel = 0; channel < this.config.numChannels; channel++) {\n                    buffer.push(e.inputBuffer.getChannelData(channel));\n                }\n\n                if (this.worker) {\n                    this.worker.postMessage({\n                        command: \"record\",\n                        buffer: buffer\n                    });\n                }\n            };\n        }\n    }\n\n    record() {\n        this.recording = true;\n\n        if (this.node instanceof AudioWorkletNode) {\n            this.node.port.postMessage(\"record\");\n        }\n    }\n\n    stop() {\n        this.recording = false;\n\n        if (this.node instanceof AudioWorkletNode) {\n            this.node.port.postMessage(\"stop\");\n        }\n    }\n\n    clear() {\n        if (this.worker) {\n            this.worker.postMessage({ command: \"clear\" });\n        }\n    }\n\n    kill() {\n        this.clear();\n        this.stop();\n\n        if (this.worker) {\n            this.worker.terminate();\n        }\n    }\n\n    getBuffer(cb: RecorderCallback<Float32Array[]>) {\n        cb = cb || this.config.callback;\n        if (!cb) throw new Error(\"Callback not set\");\n\n        this.callbacks.getBuffer.push(cb);\n\n        if (this.worker) {\n            this.worker.postMessage({ command: \"getBuffer\" });\n        }\n    }\n\n    exportWAV(cb: RecorderCallback<Blob>, mimeType?: string) {\n        mimeType = mimeType || this.config.mimeType;\n        cb = cb || this.config.callback;\n        if (!cb) throw new Error(\"Callback not set\");\n\n        this.callbacks.exportWAV.push(cb);\n\n        if (this.worker) {\n            this.worker.postMessage({\n                command: Constants.EXPORT_WAV_COMMAND,\n                type: mimeType\n            });\n        }\n    }\n\n    exportMP3(cb: RecorderCallback<Blob>, mimeType?: string) {\n        mimeType = mimeType || this.config.mimeType;\n        cb = cb || this.config.callback;\n        if (!cb) throw new Error(\"Callback not set\");\n\n        this.callbacks.exportMP3.push(cb);\n\n        if (this.worker) {\n            this.worker.postMessage({\n                command: Constants.EXPORT_MP3_COMMAND,\n                type: mimeType\n            });\n        }\n    } \n};\n\nexport default Recorder;\n","import { inject, injectable } from \"inversify\";\nimport { TYPES } from \"../inversify.types\";\nimport { Recorder } from \"../recorder/Recorder\";\nimport { EventType } from \"@/model/EventTypeEnum\";\nimport AbstractAudioElement from \"@/filters/interfaces/AbstractAudioElement\";\nimport SaveBufferOptions from \"@/model/SaveBufferOptions\";\nimport Constants from \"@/model/Constants\";\nimport RecorderWorkerMessage from \"../model/RecorderWorkerMessage\";\nimport getRecorderWorker from \"../recorder/getRecorderWorker\";\nimport SaveBufferManagerInterface from \"./interfaces/SaveBufferManagerInteface\";\nimport type BufferPlayerInterface from \"@/bufferPlayer/interfaces/BufferPlayerInterface\";\nimport type FilterManagerInterface from \"./interfaces/FilterManagerInterface\";\nimport AudioContextManagerInterface from \"./interfaces/AudioContextManagerInterface\";\nimport utilFunctions from \"@/utils/Functions\";\n\n@injectable()\nexport default class SaveBufferManager extends AbstractAudioElement implements SaveBufferManagerInterface {\n\n    /** The filter manager */\n    private filterManager: FilterManagerInterface | undefined;\n\n    /** The context manager */\n    private contextManager: AudioContextManagerInterface | undefined;\n\n    /** The audio player */\n    private bufferPlayer: BufferPlayerInterface | undefined;\n\n    /** If we are currently processing and downloading the buffer */\n    private _savingBuffer = false;\n\n    /** Callback used when saving audio */\n    private playingStoppedCallback: (() => void) | null = null;\n\n    constructor(\n        @inject(TYPES.FilterManager) filterManager: FilterManagerInterface,\n        @inject(TYPES.AudioContextManager) contextManager: AudioContextManagerInterface | undefined,\n        @inject(TYPES.BufferPlayer) bufferPlayer: BufferPlayerInterface\n    ) {\n        super();\n\n        this.contextManager = contextManager;\n        this.bufferPlayer = bufferPlayer;\n        this.filterManager = filterManager;\n\n        // Callback called just before starting audio player\n        this.setup();\n    }\n\n    private setup() {\n        if (this.bufferPlayer) {\n            // Callback called when playing is finished\n            this.bufferPlayer.on(EventType.PLAYING_FINISHED, () => {\n                if (this._savingBuffer && this.playingStoppedCallback && this.eventEmitter) {\n                    this.eventEmitter.off(EventType.PLAYING_STOPPED, this.playingStoppedCallback);\n                }\n            });\n        }\n    }\n\n    async saveBuffer(renderedBuffer: AudioBuffer | null, options?: SaveBufferOptions, recorder?: Recorder): Promise<boolean> {\n        if (this._savingBuffer) {\n            throw new Error(\"The buffer is currently saving\");\n        }\n\n        if (!this.bufferPlayer) {\n            throw new Error(\"No buffer player was found\");\n        }\n\n        this._savingBuffer = true;\n\n        let savingResult = false;\n\n        if (!this.bufferPlayer.compatibilityMode) {\n            savingResult = await this.saveBufferDirect(renderedBuffer, options);\n        } else {\n            savingResult = await this.saveBufferCompatibilityMode(options, recorder);\n        }\n\n        this._savingBuffer = false;\n\n        return savingResult;\n    }\n\n    /**\n     * Save the rendered audio to a buffer, when compatibility mode is disabled\n     * @param renderedBuffer The rendered buffer to save\n     * @param options The save options\n     * @returns A promise resolved when the audio buffer is downloaded to the user\n     */\n    private saveBufferDirect(renderedBuffer: AudioBuffer | null, options?: SaveBufferOptions): Promise<boolean> {\n        return new Promise((resolve, reject) => {\n            if (!renderedBuffer || (this.contextManager && !this.contextManager.currentContext)) {\n                return reject(\"No rendered buffer or AudioContext not initialized\");\n            }\n\n            const worker = getRecorderWorker(this.configService?.getWorkerBasePath());\n\n            if (worker) {\n                const buffer: Float32Array[] = [];\n\n                for (let i = 0; i < renderedBuffer.numberOfChannels; i++) {\n                    buffer.push(renderedBuffer.getChannelData(i));\n                }\n\n                worker.onmessage = (e: RecorderWorkerMessage) => {\n                    if (e.data.command == Constants.EXPORT_WAV_COMMAND || e.data.command == Constants.EXPORT_MP3_COMMAND) {\n                        this.downloadAudioBlob(e.data.data, options);\n                    }\n\n                    worker.terminate();\n                    this._savingBuffer = false;\n                    resolve(true);\n                };\n\n                worker.postMessage({\n                    command: Constants.INIT_COMMAND,\n                    config: {\n                        sampleRate: renderedBuffer.sampleRate,\n                        numChannels: 2,\n                        bitrate: options?.bitrate || Constants.DEFAULT_MP3_BITRATE\n                    }\n                });\n\n                worker.postMessage({\n                    command: Constants.RECORD_COMMAND,\n                    buffer\n                });\n\n                worker.postMessage({\n                    command: options?.format === \"mp3\" || Constants.DEFAULT_SAVE_FORMAT === \"mp3\" ? Constants.EXPORT_MP3_COMMAND : Constants.EXPORT_WAV_COMMAND,\n                    type: Constants.AUDIO_WAV\n                });\n            }\n        });\n    }\n\n    /**\n     * Save the rendered audio to a buffer, when compatibility mode is enabled\n     * @param options The save options - see SaveBufferOptions\n     * @returns A promise resolved when the audio buffer is downloaded to the user\n     */\n    private saveBufferCompatibilityMode(options?: SaveBufferOptions, recorder?: Recorder): Promise<boolean> {\n        return new Promise((resolve, reject) => {\n            if (!this.bufferPlayer) {\n                return reject(\"No buffer player found\");\n            }\n\n            this.bufferPlayer.start().then(() => {\n                if (!this.configService) {\n                    return reject(\"No config service found\");\n                }\n\n                if (!this.filterManager) {\n                    return reject(\"No filter manager found\");\n                }\n\n                if (!this.filterManager.currentNodes) {\n                    return reject(\"No current nodes found\");\n                }\n\n                const rec = recorder || new Recorder({\n                    bufferLen: this.configService.getBufferSize(),\n                    sampleRate: this.configService.getSampleRate(),\n                    numChannels: 2,\n                    workletBasePath: this.configService.getWorkletBasePath(),\n                    workerBasePath: this.configService.getWorkerBasePath(),\n                    mimeType: options?.format == \"mp3\" ? Constants.AUDIO_MP3 : Constants.AUDIO_WAV,\n                    bitrate: options?.bitrate || Constants.DEFAULT_MP3_BITRATE\n                });\n\n                rec.setup(this.filterManager.currentNodes.output).then(() => {\n                    rec.record();\n\n                    this.playingStoppedCallback = () => {\n                        rec.kill();\n\n                        this._savingBuffer = false;\n\n                        if (this.eventEmitter) {\n                            this.eventEmitter.off(EventType.PLAYING_FINISHED, finishedCallback);\n\n                            if (this.playingStoppedCallback) {\n                                this.eventEmitter.off(EventType.PLAYING_STOPPED, this.playingStoppedCallback);\n                            }\n                        }\n\n                        resolve(true);\n                    };\n\n                    const finishedCallback = () => {\n                        if (this.playingStoppedCallback && this.eventEmitter) {\n                            this.eventEmitter.off(EventType.PLAYING_STOPPED, this.playingStoppedCallback);\n                        }\n\n                        rec.stop();\n\n                        const downloadBlobCallback = (blob: Blob) => {\n                            this.downloadAudioBlob(blob, options);\n\n                            this._savingBuffer = false;\n\n                            if (this.eventEmitter) {\n                                this.eventEmitter.off(EventType.PLAYING_FINISHED, finishedCallback);\n                            }\n\n                            rec.kill();\n\n                            resolve(true);\n                        };\n\n                        if (options?.format === \"mp3\" || Constants.DEFAULT_SAVE_FORMAT === \"mp3\") {\n                            rec.exportMP3(downloadBlobCallback);\n                        } else {\n                            rec.exportWAV(downloadBlobCallback);\n                        }\n                    };\n\n                    if (this.eventEmitter) {\n                        this.eventEmitter.on(EventType.PLAYING_FINISHED, finishedCallback);\n                        this.eventEmitter.on(EventType.PLAYING_STOPPED, this.playingStoppedCallback);\n                    }\n                });\n            });\n        });\n    }\n\n    /**\n     * Download an audio Blob\n     * @param blob The blob\n     * @param options The save options - see SaveBufferOptions\n     */\n    private downloadAudioBlob(blob: Blob, options?: SaveBufferOptions) {\n        utilFunctions.forceDownload(blob, \"audio-\" + new Date().toISOString() + \".\" + (options?.format || Constants.DEFAULT_SAVE_FORMAT));\n    }\n\n    get savingBuffer() {\n        return this._savingBuffer;\n    }\n\n    get order(): number {\n        return -1;\n    }\n\n    get id(): string {\n        return Constants.SAVE_BUFFER_MANAGER;\n    }\n}\n","/*\n * Copyright (C) 2019-2024 Eliastik (eliastiksofts.com)\n *\n * This file is part of \"Simple Voice Changer\".\n *\n * \"Simple Voice Changer\" is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * \"Simple Voice Changer\" is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with \"Simple Voice Changer\".  If not, see <http://www.gnu.org/licenses/>.\n */\n// The audio buffer player\n// Used to play the audio buffer, with time controls, pause/play, stop and loop\nimport { EventType } from \"../model/EventTypeEnum\";\nimport { EventEmitterCallback } from \"../model/EventEmitterCallback\";\nimport AbstractAudioElement from \"../filters/interfaces/AbstractAudioElement\";\nimport Constants from \"../model/Constants\";\nimport { TYPES } from \"../inversify.types\";\nimport { inject, injectable } from \"inversify\";\nimport BufferPlayerInterface from \"./interfaces/BufferPlayerInterface\";\nimport AudioContextManagerInterface from \"@/audioEditor/interfaces/AudioContextManagerInterface\";\n\n// Also used in compatibility mode (which doesn't use audio buffer) with less functions (no time control)\n@injectable()\nexport default class BufferPlayer extends AbstractAudioElement implements BufferPlayerInterface {\n\n    private _contextManager: AudioContextManagerInterface | undefined | null;\n\n    private buffer: AudioBuffer | null = null;\n    private source: AudioBufferSourceNode | null = null;\n    currentTime = 0;\n    displayTime = 0;\n    duration = 0;\n    private intervals: number[] = [];\n    playing = false;\n    loop = false;\n    speedAudio = 1;\n    private onBeforePlayingCallback: () => void = async () => { };\n\n    compatibilityMode = false;\n    currentNode: AudioNode | null = null;\n\n    constructor(\n        @inject(TYPES.AudioContextManager) contextManager: AudioContextManagerInterface | undefined | null) {\n        super();\n\n        this._contextManager = contextManager;\n    }\n\n    init(direct?: boolean) {\n        this.playing = false;\n\n        if (this._contextManager && this._contextManager.currentContext) {\n            this._contextManager.currentContext.resume();\n\n            if (!this.compatibilityMode && this.buffer) {\n                if (this.source != null && !direct) this.source.disconnect();\n                this.source = this._contextManager.currentContext.createBufferSource();\n                this.source.buffer = this.buffer;\n                this.duration = this.buffer.duration * this.speedAudio;\n                this.source.connect(this._contextManager.currentContext.destination);\n            }\n        }\n\n        this.updateInfos();\n    }\n\n    loadBuffer(buffer: AudioBuffer) {\n        this.compatibilityMode = false;\n        this.reset();\n        this.buffer = buffer;\n        this.init();\n    }\n\n    setCompatibilityMode(currentNode: AudioNode, duration?: number) {\n        this.compatibilityMode = true;\n        this.reset();\n        this.init();\n\n        if (duration != null) {\n            this.duration = duration * this.speedAudio;\n        }\n\n        this.currentNode = currentNode;\n        this.updateInfos();\n    }\n\n    reset(direct?: boolean) {\n        this.clearIntervals();\n\n        this.currentTime = 0;\n        this.displayTime = 0;\n\n        if (!direct) {\n            this.stop();\n        }\n    }\n\n    stop() {\n        this.clearIntervals();\n\n        if (this.source != undefined && this.source != null && this.playing) {\n            this.source.stop(0);\n            this.playing = false;\n        }\n\n        if (this.currentNode) {\n            this.currentNode.disconnect();\n\n            if (this.compatibilityMode) {\n                this.currentTime = 0;\n                this.displayTime = 0;\n            }\n        }\n\n        this.eventEmitter?.emit(EventType.PLAYING_STOPPED);\n        this.updateInfos();\n    }\n\n    /**\n     * Clear old intervals\n     */\n    private clearIntervals() {\n        for (const interval of this.intervals) {\n            clearInterval(interval);\n        }\n\n        this.intervals = [];\n    }\n\n    async start(direct?: boolean) {\n        if (this.source || this.compatibilityMode) {\n            if (!direct) {\n                this.stop();\n            }\n\n            this.init(direct);\n\n            await this.onBeforePlayingCallback();\n\n            this.eventEmitter?.emit(EventType.PLAYING_STARTED);\n\n            if (!this.compatibilityMode) {\n                if (this.source) {\n                    this.source.start(0, direct ? 0 : this.currentTime / this.speedAudio);\n                    this.playing = true;\n                } else {\n                    return;\n                }\n            } else {\n                if (this.currentNode && this._contextManager && this._contextManager.currentContext) {\n                    this.currentNode.connect(this._contextManager.currentContext.destination);\n                } else {\n                    return;\n                }\n            }\n\n            let startTime = performance.now();\n\n            this.intervals.push(window.setInterval(() => {\n                const timeNow = performance.now();\n                const nextTime = timeNow - startTime;\n                startTime = timeNow;\n\n                this.currentTime += (nextTime / 1000) * this.speedAudio;\n                this.displayTime = this.currentTime;\n\n                if (this.currentTime > this.duration) {\n                    if (this.loop) {\n                        if (!this.compatibilityMode) {\n                            this.reset(direct);\n                            this.start();\n                        } else {\n                            this.eventEmitter?.emit(EventType.PLAYING_FINISHED);\n                        }\n                    } else {\n                        this.eventEmitter?.emit(EventType.PLAYING_FINISHED);\n                        this.reset(direct);\n                    }\n                } else {\n                    this.updateInfos();\n                }\n            }, 100));\n        }\n    }\n\n    async playDirect() {\n        if (!this.compatibilityMode) {\n            this.start(true);\n        } else {\n            // Play direct is not possible when compatibility mode is enabled\n            this.start(false);\n        }\n    }\n\n    pause() {\n        this.stop();\n    }\n\n    /** Send an event to update the informations of this player */\n    private updateInfos() {\n        this.eventEmitter?.emit(EventType.PLAYING_UPDATE);\n    }\n\n    setTimePercent(percent: number) {\n        if (!this.compatibilityMode) {\n            this.currentTime = Math.round(this.duration * (percent / 100));\n            this.displayTime = this.currentTime;\n\n            if (this.playing) {\n                this.pause();\n                this.start();\n            } else {\n                this.updateInfos();\n            }\n        }\n    }\n\n    setTime(time: number) {\n        if (!this.compatibilityMode) {\n            this.currentTime = time;\n            this.displayTime = this.currentTime;\n\n            if (this.playing) {\n                this.pause();\n                this.start();\n            } else {\n                this.updateInfos();\n            }\n        }\n    }\n\n    onBeforePlaying(callback: () => void) {\n        this.onBeforePlayingCallback = callback;\n    }\n\n    toggleLoop() {\n        this.loop = !this.loop;\n    }\n\n    on(event: string, callback: EventEmitterCallback) {\n        if (this.eventEmitter) {\n            this.eventEmitter.on(event, callback);\n        }\n    }\n\n    get currentTimeDisplay() {\n        return (\"0\" + Math.trunc(this.displayTime / 60)).slice(-2) + \":\" + (\"0\" + Math.trunc(this.displayTime % 60)).slice(-2);\n    }\n\n    get maxTimeDisplay() {\n        return (\"0\" + Math.trunc(this.duration / 60)).slice(-2) + \":\" + (\"0\" + Math.trunc(this.duration % 60)).slice(-2);\n    }\n\n    get percent() {\n        return (100 - Math.round((this.duration - this.displayTime) / this.duration * 100));\n    }\n\n    get remainingTimeDisplay() {\n        return (\"0\" + Math.trunc((this.duration - this.displayTime) / 60)).slice(-2) + \":\" + (\"0\" + Math.trunc((this.duration - this.displayTime) % 60)).slice(-2);\n    }\n\n    get order(): number {\n        return -1;\n    }\n\n    get id(): string {\n        return Constants.BUFFER_PLAYER;\n    }\n}\n","import { EventType } from \"../model/EventTypeEnum\";\nimport type { ConfigService } from \"./interfaces/ConfigService\";\nimport utilFunctions from \"../utils/Functions\";\nimport EventEmitter from \"../utils/EventEmitter\";\nimport BufferFetcherServiceInterface from \"./interfaces/BufferFetcherServiceInterface\";\nimport { inject, injectable } from \"inversify\";\nimport type EventEmitterInterface from \"@/utils/interfaces/EventEmitterInterface\";\nimport type AudioContextManagerInterface from \"@/audioEditor/interfaces/AudioContextManagerInterface\";\nimport { TYPES } from \"@/inversify.types\";\n\n@injectable()\nexport default class BufferFetcherService implements BufferFetcherServiceInterface {\n\n    private contextManager: AudioContextManagerInterface;\n    private buffers: Map<string, AudioBuffer> = new Map<string, AudioBuffer>();\n    private bufferErrors: string[] = [];\n    private eventEmitter: EventEmitterInterface | null;\n    private configService: ConfigService | null = null;\n\n    constructor(\n        @inject(TYPES.AudioContextManager) contextManager: AudioContextManagerInterface,\n        @inject(TYPES.ConfigService) configService: ConfigService,\n        @inject(TYPES.EventEmitter) eventEmitter?: EventEmitterInterface) {\n        this.contextManager = contextManager;\n        this.eventEmitter = eventEmitter || new EventEmitter();\n        this.configService = configService;\n    }\n\n    async fetchBuffer(bufferURI: string, force?: boolean) {\n        const realBufferURI = (this.configService ? this.configService.getSoundBasePath() : \"\") + bufferURI;\n\n        if(this.buffers.get(this.getKeyFromLocation(realBufferURI)) != null && !force) {\n            return;\n        }\n\n        this.eventEmitter?.emit(EventType.FETCHING_BUFFERS, realBufferURI);\n\n        try {\n            const response = await fetch(realBufferURI);\n\n            if(!response.ok) {\n                this.bufferErrors.push(realBufferURI);\n                this.eventEmitter?.emit(EventType.FETCHING_BUFFERS_ERROR, realBufferURI);\n                throw EventType.FETCHING_BUFFERS_ERROR;\n            } else {\n                const arrayBuffer = await response.arrayBuffer();\n\n                if (this.contextManager && this.contextManager.currentContext) {\n                    const buffer = await this.contextManager.currentContext.decodeAudioData(arrayBuffer);\n                    this.buffers.set(this.getKeyFromLocation(realBufferURI), utilFunctions.decodeBuffer(this.contextManager.currentContext, buffer));\n                }\n            }\n    \n            this.eventEmitter?.emit(EventType.FINISHED_FETCHING_BUFFERS, realBufferURI);\n        } catch(e) {\n            this.bufferErrors.push(realBufferURI);\n            this.eventEmitter?.emit(EventType.FETCHING_BUFFERS_ERROR, realBufferURI);\n            throw EventType.FETCHING_BUFFERS_ERROR;\n        }\n    }\n\n    async fetchAllBuffers(bufferURIs: string[]) {\n        for(const uri of bufferURIs) {\n            await this.fetchBuffer(uri);\n        }\n    }\n\n    getAudioBuffer(filename: string): AudioBuffer | undefined {\n        return this.buffers.get(this.getKeyFromLocation(filename));\n    }\n\n    async getOrFetchAudioBuffer(filename: string): Promise<AudioBuffer | undefined> {\n        if(this.getAudioBuffer(filename) == null) {\n            await this.fetchBuffer(filename);\n        }\n\n        return this.getAudioBuffer(filename);\n    }\n\n    getDownloadedBuffersList(): string[] {\n        return Array.from(this.buffers.keys());\n    }\n\n    private getKeyFromLocation(location: string) {\n        return location.substring(location.lastIndexOf(\"/\") + 1);\n    }\n\n    reset() {\n        this.buffers.clear();\n    }\n}\n","import type AudioContextManagerInterface from \"@/audioEditor/interfaces/AudioContextManagerInterface\";\nimport { EventType } from \"../model/EventTypeEnum\";\nimport EventEmitter from \"../utils/EventEmitter\";\nimport utilFunctions from \"../utils/Functions\";\nimport BufferDecoderServiceInterface from \"./interfaces/BufferDecoderServiceInterface\";\nimport { inject, injectable } from \"inversify\";\nimport type EventEmitterInterface from \"@/utils/interfaces/EventEmitterInterface\";\nimport { TYPES } from \"@/inversify.types\";\n\n@injectable()\nexport default class BufferDecoderService implements BufferDecoderServiceInterface {\n\n    private contextManager: AudioContextManagerInterface;\n    private eventEmitter: EventEmitterInterface | null;\n\n    constructor(\n        @inject(TYPES.AudioContextManager) contextManager: AudioContextManagerInterface,\n        @inject(TYPES.EventEmitter) eventEmitter?: EventEmitterInterface) {\n        this.contextManager = contextManager;\n        this.eventEmitter = eventEmitter || new EventEmitter();\n    }\n\n    async decodeBufferFromFile(file: File): Promise<AudioBuffer | null> {\n        if (this.eventEmitter) {\n            this.eventEmitter.emit(EventType.DECODING_AUDIO_FILE);\n        }\n\n        try {\n            if (this.contextManager && this.contextManager.currentContext) {\n                const buffer = await utilFunctions.loadAudioBuffer(this.contextManager.currentContext, file);\n    \n                if (this.eventEmitter) {\n                    this.eventEmitter.emit(EventType.DECODED_AUDIO_FILE);\n                }\n    \n                return buffer;\n            }\n        } catch (e) {\n            console.error(e);\n\n            if (this.eventEmitter) {\n                this.eventEmitter.emit(EventType.DECODED_AUDIO_FILE);\n                this.eventEmitter.emit(EventType.ERROR_DECODING_AUDIO_FILE);\n            }\n        }\n\n        return null;\n    }\n}\n","import AbstractAudioElement from \"./AbstractAudioElement\";\n\nexport default abstract class AbstractAudioRenderer extends AbstractAudioElement {\n\n    /** Render an AudioBuffer based on another input AudioBuffer */\n    abstract renderAudio(context: BaseAudioContext, buffer: AudioBuffer): Promise<AudioBuffer>;\n}\n","import AbstractAudioElement from \"./AbstractAudioElement\";\nimport { AudioFilterNodes } from \"../../model/AudioNodes\";\nimport { FilterSettingValue, FilterSettings } from \"../../model/filtersSettings/FilterSettings\";\n\nexport default abstract class AbstractAudioFilter extends AbstractAudioElement {\n\n    /** The default settings */\n    private defaultSettings: FilterSettings | null = null;\n\n    /** Total sample of the input audio buffer */\n    protected _totalSamples = 0;\n\n    /** Return a input and output AudioNode of the filter */\n    abstract getNode(context: BaseAudioContext): AudioFilterNodes;\n\n    /** Return an object with current settings of this filter */\n    abstract getSettings(): FilterSettings;\n\n    /** Set a filter setting */\n    abstract setSetting(settingId: string, value: FilterSettingValue): Promise<void>;\n\n    /** Get the amount of time this filter add to the audio */\n    getAddingTime(): number {\n        return 0;\n    }\n\n    /** Store the default settings */\n    public initializeDefaultSettings() {\n        this.defaultSettings = this.getSettings();\n    }\n\n    /** Returns the default settings of this filter */\n    public getDefaultSettings() {\n        return this.defaultSettings;\n    }\n\n    /** Reset the default settings of this filter */\n    public async resetSettings() {\n        if (this.defaultSettings) {\n            for (const key in this.defaultSettings) {\n                if (this.defaultSettings && typeof (this.defaultSettings[key]) !== \"undefined\") {\n                    await this.setSetting(key, this.defaultSettings[key]);\n                }\n            }\n        }\n    }\n\n    /** Return if the current filter use an audio worklet */\n    public isWorklet() {\n        return false;\n    }\n\n    /**\n     * Called when the buffer fetcher was reseted\n     * @returns boolean\n    */\n    public async bufferFetcherReseted(): Promise<boolean> {\n        return false;\n    }\n\n    set totalSamples(value: number) {\n        this._totalSamples = value;\n    }\n}\n","/* eslint-disable @typescript-eslint/no-unused-vars */\n/**\n * This class is a polyfill for the standard web AudioParam class used by worklets\n */\nexport default class AudioParamPolyfill implements AudioParam {\n    private _value: number = 0;\n    private _minValue: number = 0;\n    private _maxValue: number = Number.MAX_SAFE_INTEGER;\n    private _defaultValue: number = 0;\n    private context: BaseAudioContext | null = null;\n    automationRate: AutomationRate = \"a-rate\";\n\n    constructor(context: BaseAudioContext, defaultValue?: number) {\n        this._defaultValue = defaultValue !== undefined ? defaultValue : 0;\n        this._value = this._defaultValue;\n        this.context = context;\n    }\n\n    get value(): number {\n        return this._value;\n    }\n\n    set value(newValue: number) {\n        this._value = Math.max(this._minValue, Math.min(this._maxValue, newValue));\n    }\n\n    get minValue(): number {\n        return this._minValue;\n    }\n\n    get maxValue(): number {\n        return this._maxValue;\n    }\n\n    get defaultValue(): number {\n        return this._defaultValue;\n    }\n\n    setValueAtTime(value: number, startTime: number): AudioParam {\n        console.warn(\"setValueAtTime used with AudioParamPolyfill, is not fully compatible with standard AudioParam\");\n        this.value = value;\n        return new AudioParamPolyfill(this.context!, value);\n    }\n\n    linearRampToValueAtTime(value: number, endTime: number): AudioParam {\n        console.warn(\"linearRampToValueAtTime used with AudioParamPolyfill, is not fully compatible with standard AudioParam\");\n        this.value = value;\n        return new AudioParamPolyfill(this.context!, value);\n    }\n\n    exponentialRampToValueAtTime(value: number, endTime: number): AudioParam {\n        console.warn(\"exponentialRampToValueAtTime used with AudioParamPolyfill, is not fully compatible with standard AudioParam\");\n        this.value = value;\n        return new AudioParamPolyfill(this.context!, value);\n    }\n\n    cancelAndHoldAtTime(cancelTime: number): AudioParam {\n        throw new Error(\"Method not implemented.\");\n    }\n\n    cancelScheduledValues(cancelTime: number): AudioParam {\n        throw new Error(\"Method not implemented.\");\n    }\n\n    setTargetAtTime(target: number, startTime: number, timeConstant: number): AudioParam {\n        throw new Error(\"Method not implemented.\");\n    }\n\n    setValueCurveAtTime(values: unknown, startTime: unknown, duration: unknown): AudioParam {\n        throw new Error(\"Method not implemented.\");\n    }\n}\n","import SimpleAudioWorkletProcessor from \"./SimpleAudioWorkletProcessor\";\nimport AudioParamPolyfill from \"./AudioParamPolyfill\";\nimport Functions from \"../utils/Functions\";\n\n/**\n * This class convert an audio worklet processor node to a script processor node\n * automagically. Highly experimental, and might not work with some WorkletProcessor\n */\nexport default class WorkletScriptProcessorNodeAdapter {\n\n    private workletProcessor: SimpleAudioWorkletProcessor;\n    private _parameters = new Map<string, AudioParamPolyfill>();\n    private _port: MessagePort | null = null;\n    private _scriptProcessorNode: ScriptProcessorNode | null;\n    private currentContext: BaseAudioContext | null = null;\n\n    constructor(context: BaseAudioContext, node: SimpleAudioWorkletProcessor, bufferSize?: number) {\n        this.workletProcessor = node;\n        this.currentContext = context;\n\n        // Create a ScriptProcessorNode with the same number of input and output channels\n        this._scriptProcessorNode = context.createScriptProcessor(\n            bufferSize,\n            2,\n            2\n        );\n\n        this.setupPort();\n        this.setupProcessor();\n        this.setupWorkletScope(context);\n    }\n\n    private setupPort(): void {\n        const messageChannel = new MessageChannel();\n\n        messageChannel.port1.onmessage = (ev) => {\n            if(this.workletProcessor && this.workletProcessor.port2) {\n                this.workletProcessor.port2.postMessage(ev.data);\n            }\n        };\n\n        if(this.workletProcessor && this.workletProcessor.port2) {\n            this.workletProcessor.port2.onmessage = (ev) => {\n                messageChannel.port1.postMessage(ev.data);\n            };\n        }\n\n        this._port = messageChannel.port2;\n    }\n\n    private setupProcessor() {\n        if(!this._scriptProcessorNode) {\n            return;\n        }\n\n        this._scriptProcessorNode.onaudioprocess = (ev: AudioProcessingEvent) => {\n            if(this.workletProcessor) {\n                const inputArray = [Functions.convertAudioBufferToFloat32Array(ev.inputBuffer)];\n                const ouputArray = [Functions.convertAudioBufferToFloat32Array(ev.outputBuffer)];\n\n                const records: [string, Float32Array][] = [];\n\n                for (const [key, value] of this._parameters.entries()) {\n                    records.push([key, Functions.convertAudioParamToFloat32Array(value, 1)]);\n                }\n\n                const recordsMap: Record<string, Float32Array> = Object.fromEntries(records);\n                \n                this.workletProcessor.process(inputArray, ouputArray, recordsMap);\n            }\n        };\n\n        const descriptors = this.workletProcessor.defaultParameterDescriptors;\n\n        if(descriptors) {\n            descriptors.forEach(descriptor => {\n                if(this.currentContext) {\n                    this._parameters.set(descriptor.name, new AudioParamPolyfill(this.currentContext, descriptor.defaultValue));\n                }\n            });\n        }\n    }\n\n    private setupWorkletScope(context: BaseAudioContext) {\n        if(typeof(window) !== \"undefined\") {\n            window.sampleRate = context.sampleRate;\n        }\n    }\n\n    get port() {\n        return this._port;\n    }\n\n    get parameters(): AudioParamMap {\n        return this._parameters;\n    }\n\n    get node() {\n        return this._scriptProcessorNode;\n    }\n\n    get context() {\n        return this._scriptProcessorNode?.context;\n    }\n}\n","import SimpleAudioWorkletProcessor from \"./SimpleAudioWorkletProcessor\";\n\n/**\n * Polyfill for registerProcessor method used in AudioWorklets\n */\nexport default class RegisterProcessorPolyfill {\n\n    private static processorsMap = new Map<string, typeof SimpleAudioWorkletProcessor>();\n\n    static registerProcessor(processorName: string, processorClass: typeof SimpleAudioWorkletProcessor) {\n        RegisterProcessorPolyfill.processorsMap.set(processorName, processorClass);\n    }\n\n    static getProcessor(processorName: string): SimpleAudioWorkletProcessor | null {\n        const processor = RegisterProcessorPolyfill.processorsMap.get(processorName);\n\n        if(processor) {\n            return new processor();\n        }\n\n        return null;\n    }\n};\n","/**\n * This class is the standard AudioWorkletProcessor interface\n */\nexport interface AudioWorkletProcessorInterface {\n\n    process(inputs: Float32Array[][], outputs: Float32Array[][], parameters: Record<string, Float32Array>): boolean;\n    get parameters(): AudioParamMap;\n    get parameterDescriptors(): AudioParamMap;\n    messageProcessor?: (event: MessageEvent) => void;\n}\n\ntype ParameterDescriptors = {\n    name: string;\n    defaultValue: number;\n}[];\n\n/**\n * This class is a polyfill for the AudioWorkletProcessor interface\n */\nexport default class SimpleAudioWorkletProcessor implements AudioWorkletProcessorInterface {\n    private messageChannel: MessageChannel | null = null;\n    messageProcessor?: ((event: MessageEvent) => void) | undefined;\n\n    constructor() {\n        this.messageChannel = new MessageChannel();\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    process(inputs: Float32Array[][], outputs: Float32Array[][], parameters: Record<string, Float32Array>): boolean {\n        return true;\n    }\n\n    get port(): MessagePort | null {\n        return this.messageChannel && this.messageChannel.port1;\n    }\n\n    get port2(): MessagePort | null {\n        return this.messageChannel && this.messageChannel.port2;\n    }\n\n    get parameters(): AudioParamMap {\n        throw new Error(\"Method not implemented.\");\n    }\n\n    get parameterDescriptors(): AudioParamMap {\n        throw new Error(\"Method not implemented.\");\n    }\n\n    get defaultParameterDescriptors(): ParameterDescriptors {\n        return [];\n    }\n};\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport RegisterProcessorPolyfill from \"./RegisterProcessorPolyfill\";\nimport SimpleAudioWorkletProcessor from \"./SimpleAudioWorkletProcessor\";\n\nif(typeof(window) !== \"undefined\" && !(\"AudioWorkletProcessor\" in window)) {\n    (window as any).AudioWorkletProcessor = SimpleAudioWorkletProcessor;\n    (window as any).registerProcessor = RegisterProcessorPolyfill.registerProcessor;\n}\n\nif(typeof(global) !== \"undefined\" && !(\"AudioWorkletProcessor\" in global)) {\n    (global as any).AudioWorkletProcessor = SimpleAudioWorkletProcessor;\n    (global as any).registerProcessor = RegisterProcessorPolyfill.registerProcessor;\n}\n","import WorkletScriptProcessorNodeAdapter from \"../../workletPolyfill/WorkletScriptProcessorNodeAdapter\";\nimport AbstractAudioFilter from \"./AbstractAudioFilter\";\nimport Constants from \"../../model/Constants\";\nimport \"../../workletPolyfill/AudioWorkletProcessorPolyfill\";\nimport RegisterProcessorPolyfill from \"../../workletPolyfill/RegisterProcessorPolyfill\";\nimport utilFunctions from \"../../utils/Functions\";\n\nexport default abstract class AbstractAudioFilterWorklet<T> extends AbstractAudioFilter {\n\n    protected currentWorkletNode: AudioWorkletNode | WorkletScriptProcessorNodeAdapter | null = null;\n\n    protected fallbackToScriptProcessor = false;\n\n    protected keepCurrentNodeIfPossible = false;\n\n    /**\n     * Return the worklet name (as registered with method registerProcessor)\n     */\n    abstract get workletName(): string;\n\n    /**\n     * Return the path to worklet file\n     */\n    abstract get workletPath(): string;\n\n    /**\n     * Receive event from the worklet\n     */\n    abstract receiveEvent(message: MessageEvent<T>): void;\n\n    /**\n     * Initialize the audio worklet by loading the module\n     * @param audioContext The audio context\n     */\n    async initializeWorklet(audioContext: BaseAudioContext): Promise<void> {\n        this.stop();\n\n        if (!utilFunctions.isAudioWorkletCompatible(audioContext)) {\n            console.error(\"Audio Worklets not supported on this browser. Fallback to ScriptProcessor\");\n            this.fallbackToScriptProcessor = true;\n            return;\n        }\n\n        const workletPath = (this.configService ? this.configService.getWorkletBasePath() : \"\") + this.workletPath;\n\n        await audioContext.audioWorklet.addModule(workletPath)\n            .catch(e => {\n                console.error(`Error when loading Worklet (${workletPath}) for filter ${this.id}. Fallback to ScriptProcessor. Exception:`, e);\n                this.fallbackToScriptProcessor = true;\n            });\n    }\n\n    /**\n     * This method checks if audio worklet are enabled\n     * @param audioContext \n     */\n    protected isAudioWorkletEnabled() {\n        if (this.configService) {\n            return this.configService.isAudioWorkletEnabled();\n        }\n\n        return Constants.ENABLE_AUDIO_WORKLET;\n    }\n\n    /**\n     * Initialize the AudioWorkletNode or fallback to ScriptProcessorNode\n     * @param context The audio context\n     * @param workletName The worklet name\n     */\n    private initializeNode(context: BaseAudioContext, workletName: string) {\n        if (this.isAudioWorkletEnabled() && !this.fallbackToScriptProcessor) {\n            // Standard Audio Worklet\n            this.currentWorkletNode = new AudioWorkletNode(context, workletName);\n        } else {\n            // Fallback to ScriptProcessorNode (polyfill)\n            const processor = RegisterProcessorPolyfill.getProcessor(workletName);\n\n            if (processor) {\n                this.currentWorkletNode = new WorkletScriptProcessorNodeAdapter(context, processor, this.configService!.getBufferSize());\n            } else {\n                throw new Error(`No processor registered with name ${workletName} for filter ${this.id} to use the fallback/polyfill for AudioWorklet. Make sure you have created the class.`);\n            }\n        }\n\n        if (this.currentWorkletNode && this.currentWorkletNode.port) {\n            this.currentWorkletNode.port.onmessage = message => this.receiveEvent(message);\n        }\n    }\n\n    /**\n     * Apply current settings to the audio worklet node.\n     * Uses the getSettings method to extract the settings.\n     */\n    protected applyCurrentSettingsToWorklet() {\n        if (this.currentWorkletNode && this.currentWorkletNode.parameters) {\n            const currentSettings = this.getSettings();\n\n            for (const settingKey of Object.keys(currentSettings)) {\n                const settingFromWorklet = this.currentWorkletNode.parameters.get(settingKey);\n\n                if (settingFromWorklet) {\n                    settingFromWorklet.value = currentSettings[settingKey] as number;\n                    settingFromWorklet.setValueAtTime(currentSettings[settingKey] as number, 0);\n                }\n            }\n        }\n    }\n\n    /** Default implementation for GetNode - AbstractAudioFilterWorklet */\n    getNode(context: BaseAudioContext) {\n        if (!this.keepCurrentNodeIfPossible || !this.currentWorkletNode\n            || this.currentWorkletNode.context != context) {\n            this.stop();\n            this.initializeNode(context, this.workletName);\n        }\n\n        this.applyCurrentSettingsToWorklet();\n        this.setEnabled(this.isEnabled());\n\n        if (this.currentWorkletNode) {\n            if (this.currentWorkletNode instanceof WorkletScriptProcessorNodeAdapter) {\n                return {\n                    input: this.currentWorkletNode.node!,\n                    output: this.currentWorkletNode.node!,\n                };\n            } else {\n                return {\n                    input: this.currentWorkletNode,\n                    output: this.currentWorkletNode,\n                };\n            }\n        }\n\n        throw new Error(\"Worklet node has not yet been created\");\n    }\n\n    /**\n     * Stop the current worklet node. The worklet need to respond to \"stop\" events.\n     */\n    stop() {\n        if (this.currentWorkletNode && this.currentWorkletNode.port) {\n            this.currentWorkletNode.port.postMessage(\"stop\");\n            this.currentWorkletNode.port.onmessage = null;\n        }\n\n        this.currentWorkletNode = null;\n    }\n\n    /**\n     * Pass the current disabled/enabled state to the worklet.\n     * The worklet need to respond to \"enable\"/\"disable\" events.\n     * @param state The current disabled/enabled state\n     */\n    setEnabled(state: boolean): void {\n        if (this.currentWorkletNode && this.currentWorkletNode.port) {\n            this.currentWorkletNode.port.postMessage(state ? \"enable\" : \"disable\");\n        }\n\n        super.setEnabled(state);\n    }\n\n    public isWorklet(): boolean {\n        return true;\n    }\n}\n","import Constants from \"../../model/Constants\";\n\nclass BitCrusherProcessor extends AudioWorkletProcessor {\n    private stopped = false;\n    private phaser: number[] | null = null;\n    private last: number[] | null = null;\n\n    constructor() {\n        super();\n        this.port.onmessage = (event) => {\n            if (event.data == \"stop\") {\n                this.stop();\n            }\n        };\n    }\n\n    static get parameterDescriptors() {\n        return [\n            { name: \"bits\", defaultValue: 16 },\n            { name: \"normFreq\", defaultValue: 0.9 },\n        ];\n    }\n\n    get defaultParameterDescriptors() {\n        return BitCrusherProcessor.parameterDescriptors;\n    }\n\n    process(inputs: Float32Array[][], outputs: Float32Array[][], parameters: Record<string, Float32Array>): boolean {\n        if (this.stopped) return false;\n\n        const input = inputs[0];\n        const output = outputs[0];\n\n        const step = 2 * Math.pow(1 / 2, parameters.bits[0]);\n        const currentNormFreq = (1 - parameters.normFreq[0]) / (sampleRate / 48000);\n\n        if (this.last == null) {\n            this.last = new Array(input.length).fill(0);\n        }\n\n        if (this.phaser == null) {\n            this.phaser = new Array(input.length).fill(0);\n        }\n\n        if (input && input[0]) {\n            const blockSize = input[0].length;\n\n            for (let channel = 0; channel < input.length; channel++) {\n                const inp = input[channel];\n                const out = output[channel];\n\n                if (inp && out) {\n                    for (let i = 0; i < blockSize; i++) {\n                        this.phaser[channel] += currentNormFreq;\n\n                        if (this.phaser[channel] >= 1.0) {\n                            this.phaser[channel] -= 1.0;\n                            this.last[channel] = step * Math.floor((inp[i] * (1 / step)) + 0.5);\n                        }\n\n                        out[i] = this.last[channel];\n                    }\n                }\n            }\n        }\n\n        return true;\n    }\n\n    stop() {\n        this.stopped = true;\n        this.phaser = null;\n        this.last = null;\n    }\n}\n\nregisterProcessor(Constants.WORKLET_NAMES.BITCRUSHER, BitCrusherProcessor);\n","export default class DelayBuffer {\n    private _array: Float32Array = new Float32Array();\n    private n: number = 0;\n    private length: number = 0;\n    private readPointer: number = 0;\n    private writePointer: number = 0;\n\n    constructor(n: number) {\n        this.n = Math.floor(n);\n        this.init();\n    }\n\n    init() {\n        this._array = new Float32Array(2 * this.n);\n        this.length = this._array.length;\n        this.readPointer = 0;\n        this.writePointer = this.n - 1;\n        this._array.fill(0);\n    }\n\n    read() {\n        const value = this._array[this.readPointer % this.length];\n        this.readPointer = (this.readPointer + 1) % this.length;\n        return value;\n    }\n\n    push(v: number) {\n        this._array[this.writePointer % this.length] = v;\n        this.writePointer = (this.writePointer + 1) % this.length;\n    }\n\n    reset() {\n        this.init();\n    }\n\n    clear() {\n        this._array = new Float32Array();\n        this.length = 0;\n        this.readPointer = 0;\n        this.writePointer = 0;\n    }\n\n    sum() {\n        return this._array.reduce((a, b) => a + b, 0);\n    }\n}\n","/*\n * Copyright (C) 2019-2023 Eliastik (eliastiksofts.com)\n *\n * This file is part of \"Simple Voice Changer\".\n *\n * \"Simple Voice Changer\" is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * \"Simple Voice Changer\" is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with \"Simple Voice Changer\".  If not, see <http://www.gnu.org/licenses/>.\n */\n// Source: https://webaudiotech.com/2016/01/21/should-your-web-audio-app-have-a-limiter/ (https://web.archive.org/web/20220519100003/https://webaudiotech.com/2016/01/21/should-your-web-audio-app-have-a-limiter/)\n// Original code: https://webaudiotech.com/sites/limiter_comparison/limiter.js\n// Additions by Eliastik (eliastiksofts.com): Stereo and multi-channel support, code simplified in one object class (Limiter), converted into AudioWorklet\nimport Constants from \"../../model/Constants\";\nimport DelayBuffer from \"../../utils/DelayBuffer\";\n\nclass LimiterProcessor extends AudioWorkletProcessor {\n    private delayBuffer: DelayBuffer[] = [];\n    private envelopeSample = 0;\n    private stopped = false;\n    private disabled = false;\n\n    constructor() {\n        super();\n        this.port.onmessage = (event) => {\n            if (event.data == \"reset\") {\n                this.reset();\n            } else if (event.data == \"stop\") {\n                this.stop();\n            } else if (event.data == \"disable\") {\n                this.disabled = true;\n            } else if (event.data == \"enable\") {\n                this.disabled = false;\n            }\n        };\n    }\n\n    static get parameterDescriptors() {\n        return [\n            { name: \"preGain\", defaultValue: 0 },\n            { name: \"postGain\", defaultValue: 0 },\n            { name: \"attackTime\", defaultValue: 0 },\n            { name: \"releaseTime\", defaultValue: 3 },\n            { name: \"threshold\", defaultValue: -0.05 },\n            { name: \"lookAheadTime\", defaultValue: 0 }\n        ];\n    }\n\n    get defaultParameterDescriptors() {\n        return LimiterProcessor.parameterDescriptors;\n    }\n\n    getEnvelope(data: Float32Array, attackTime: number, releaseTime: number, sampleRate: number) {\n        const attackGain = Math.exp(-1 / (sampleRate * attackTime));\n        const releaseGain = Math.exp(-1 / (sampleRate * releaseTime));\n\n        const envelope = new Float32Array(data.length);\n\n        for (let i = 0; i < data.length; i++) {\n            const envIn = Math.abs(data[i]);\n\n            if (this.envelopeSample < envIn) {\n                this.envelopeSample = envIn + attackGain * (this.envelopeSample - envIn);\n            } else {\n                this.envelopeSample = envIn + releaseGain * (this.envelopeSample - envIn);\n            }\n\n            envelope[i] = this.envelopeSample;\n        }\n\n        return envelope;\n    }\n\n    getMaxEnvelope(envelope: Float32Array[], channels: number, index: number) {\n        let max = envelope[0][index];\n\n        for (let channel = 0; channel < channels; channel++) {\n            if (envelope[channel][index] > max) {\n                max = envelope[channel][index];\n            }\n        }\n\n        return max;\n    }\n\n    ampToDB(value: number) {\n        return 20 * Math.log10(value);\n    }\n\n    dBToAmp(db: number) {\n        return Math.pow(10, db / 20);\n    }\n\n    process(inputs: Float32Array[][], outputs: Float32Array[][], parameters: Record<string, Float32Array>): boolean {\n        if (this.stopped) return false;\n\n        const inputBuffer = inputs[0];\n        const outputBuffer = outputs[0];\n        const envelopeData = [];\n\n        // transform db to amplitude value\n        const postGainAmp = this.dBToAmp(parameters.postGain[0]);\n        const preGainAmp = this.dBToAmp(parameters.preGain[0]);\n\n        // apply pre gain to signal\n        // compute the envelope for each channel\n        for (let channel = 0; channel < outputBuffer.length; channel++) {\n            const inp = inputBuffer[channel];\n            const out = outputBuffer[channel];\n\n            // create a delay buffer\n            if (this.delayBuffer[channel] == null) {\n                this.delayBuffer[channel] = new DelayBuffer(parameters.lookAheadTime[0] * sampleRate);\n            }\n\n            // apply pre gain to signal\n            if (inp && out) {\n                for (let k = 0; k < inp.length; ++k) {\n                    if (!this.disabled) {\n                        out[k] = preGainAmp * inp[k];\n                    } else {\n                        out[k] = inp[k];\n                    }\n                }\n            }\n\n            // compute the envelope\n            if (!this.disabled && out) {\n                envelopeData[channel] = this.getEnvelope(out, parameters.attackTime[0], parameters.releaseTime[0], sampleRate);\n            }\n        }\n\n        for (let channel = 0; channel < outputBuffer.length; channel++) {\n            const inp = inputBuffer[channel];\n            const out = outputBuffer[channel];\n\n            if (parameters.lookAheadTime[0] > 0 && out) {\n                // write signal into buffer and read delayed signal\n                for (let i = 0; i < out.length; i++) {\n                    this.delayBuffer[channel].push(out[i]);\n                    out[i] = this.delayBuffer[channel].read();\n                }\n            }\n\n            // If disabled we don't apply the limitation to the audio\n            if (this.disabled) {\n                continue;\n            }\n\n            // limiter mode: slope is 1\n            const slope = 1;\n\n            if (inp && out) {\n                for (let i = 0; i < inp.length; i++) {\n                    let gainDB = slope * (parameters.threshold[0] - this.ampToDB(this.getMaxEnvelope(envelopeData, outputBuffer.length, i))); // max gain\n\n                    // is gain below zero?\n                    gainDB = Math.min(0, gainDB);\n                    const gain = this.dBToAmp(gainDB);\n                    out[i] *= (gain * postGainAmp);\n                }\n            }\n        }\n\n        return true;\n    }\n\n    reset() {\n        for (let i = 0; i < this.delayBuffer.length; i++) {\n            if (this.delayBuffer[i] != null) {\n                this.delayBuffer[i].reset();\n            }\n        }\n\n        this.envelopeSample = 0;\n    }\n\n    stop() {\n        for (let i = 0; i < this.delayBuffer.length; i++) {\n            if (this.delayBuffer[i] != null) {\n                this.delayBuffer[i].clear();\n            }\n        }\n\n        this.delayBuffer = [];\n        this.envelopeSample = 0;\n        this.stopped = true;\n    }\n}\n\nregisterProcessor(Constants.WORKLET_NAMES.LIMITER, LimiterProcessor);\n","/*\n * SoundTouch JS v0.1.30 audio processing library\n * Copyright (c) Olli Parviainen\n * Copyright (c) Ryan Berdeen\n * Copyright (c) Jakub Fiala\n * Copyright (c) Steve 'Cutter' Blades\n *\n * This library is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 2.1 of the License, or (at your option) any later version.\n *\n * This library is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this library; if not, write to the Free Software\n * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n */\n\nclass FifoSampleBuffer {\n  constructor() {\n    this._vector = new Float32Array();\n    this._position = 0;\n    this._frameCount = 0;\n  }\n  get vector() {\n    return this._vector;\n  }\n  get position() {\n    return this._position;\n  }\n  get startIndex() {\n    return this._position * 2;\n  }\n  get frameCount() {\n    return this._frameCount;\n  }\n  get endIndex() {\n    return (this._position + this._frameCount) * 2;\n  }\n  clear() {\n    this.receive(this._frameCount);\n    this.rewind();\n  }\n  put(numFrames) {\n    this._frameCount += numFrames;\n  }\n  putSamples(samples, position, numFrames = 0) {\n    position = position || 0;\n    const sourceOffset = position * 2;\n    if (!(numFrames >= 0)) {\n      numFrames = (samples.length - sourceOffset) / 2;\n    }\n    const numSamples = numFrames * 2;\n    this.ensureCapacity(numFrames + this._frameCount);\n    const destOffset = this.endIndex;\n    this.vector.set(samples.subarray(sourceOffset, sourceOffset + numSamples), destOffset);\n    this._frameCount += numFrames;\n  }\n  putBuffer(buffer, position, numFrames = 0) {\n    position = position || 0;\n    if (!(numFrames >= 0)) {\n      numFrames = buffer.frameCount - position;\n    }\n    this.putSamples(buffer.vector, buffer.position + position, numFrames);\n  }\n  receive(numFrames) {\n    if (!(numFrames >= 0) || numFrames > this._frameCount) {\n      numFrames = this.frameCount;\n    }\n    this._frameCount -= numFrames;\n    this._position += numFrames;\n  }\n  receiveSamples(output, numFrames = 0) {\n    const numSamples = numFrames * 2;\n    const sourceOffset = this.startIndex;\n    output.set(this._vector.subarray(sourceOffset, sourceOffset + numSamples));\n    this.receive(numFrames);\n  }\n  extract(output, position = 0, numFrames = 0) {\n    const sourceOffset = this.startIndex + position * 2;\n    const numSamples = numFrames * 2;\n    output.set(this._vector.subarray(sourceOffset, sourceOffset + numSamples));\n  }\n  ensureCapacity(numFrames = 0) {\n    const minLength = parseInt(numFrames * 2);\n    if (this._vector.length < minLength) {\n      const newVector = new Float32Array(minLength);\n      newVector.set(this._vector.subarray(this.startIndex, this.endIndex));\n      this._vector = newVector;\n      this._position = 0;\n    } else {\n      this.rewind();\n    }\n  }\n  ensureAdditionalCapacity(numFrames = 0) {\n    this.ensureCapacity(this._frameCount + numFrames);\n  }\n  rewind() {\n    if (this._position > 0) {\n      this._vector.set(this._vector.subarray(this.startIndex, this.endIndex));\n      this._position = 0;\n    }\n  }\n}\n\nclass AbstractFifoSamplePipe {\n  constructor(createBuffers) {\n    if (createBuffers) {\n      this._inputBuffer = new FifoSampleBuffer();\n      this._outputBuffer = new FifoSampleBuffer();\n    } else {\n      this._inputBuffer = this._outputBuffer = null;\n    }\n  }\n  get inputBuffer() {\n    return this._inputBuffer;\n  }\n  set inputBuffer(inputBuffer) {\n    this._inputBuffer = inputBuffer;\n  }\n  get outputBuffer() {\n    return this._outputBuffer;\n  }\n  set outputBuffer(outputBuffer) {\n    this._outputBuffer = outputBuffer;\n  }\n  clear() {\n    this._inputBuffer.clear();\n    this._outputBuffer.clear();\n  }\n}\n\nclass RateTransposer extends AbstractFifoSamplePipe {\n  constructor(createBuffers) {\n    super(createBuffers);\n    this.reset();\n    this._rate = 1;\n  }\n  set rate(rate) {\n    this._rate = rate;\n  }\n  reset() {\n    this.slopeCount = 0;\n    this.prevSampleL = 0;\n    this.prevSampleR = 0;\n  }\n  clone() {\n    const result = new RateTransposer();\n    result.rate = this._rate;\n    return result;\n  }\n  process() {\n    const numFrames = this._inputBuffer.frameCount;\n    this._outputBuffer.ensureAdditionalCapacity(numFrames / this._rate + 1);\n    const numFramesOutput = this.transpose(numFrames);\n    this._inputBuffer.receive();\n    this._outputBuffer.put(numFramesOutput);\n  }\n  transpose(numFrames = 0) {\n    if (numFrames === 0) {\n      return 0;\n    }\n    const src = this._inputBuffer.vector;\n    const srcOffset = this._inputBuffer.startIndex;\n    const dest = this._outputBuffer.vector;\n    const destOffset = this._outputBuffer.endIndex;\n    let used = 0;\n    let i = 0;\n    while (this.slopeCount < 1.0) {\n      dest[destOffset + 2 * i] = (1.0 - this.slopeCount) * this.prevSampleL + this.slopeCount * src[srcOffset];\n      dest[destOffset + 2 * i + 1] = (1.0 - this.slopeCount) * this.prevSampleR + this.slopeCount * src[srcOffset + 1];\n      i = i + 1;\n      this.slopeCount += this._rate;\n    }\n    this.slopeCount -= 1.0;\n    if (numFrames !== 1) {\n      out: while (true) {\n        while (this.slopeCount > 1.0) {\n          this.slopeCount -= 1.0;\n          used = used + 1;\n          if (used >= numFrames - 1) {\n            break out;\n          }\n        }\n        const srcIndex = srcOffset + 2 * used;\n        dest[destOffset + 2 * i] = (1.0 - this.slopeCount) * src[srcIndex] + this.slopeCount * src[srcIndex + 2];\n        dest[destOffset + 2 * i + 1] = (1.0 - this.slopeCount) * src[srcIndex + 1] + this.slopeCount * src[srcIndex + 3];\n        i = i + 1;\n        this.slopeCount += this._rate;\n      }\n    }\n    this.prevSampleL = src[srcOffset + 2 * numFrames - 2];\n    this.prevSampleR = src[srcOffset + 2 * numFrames - 1];\n    return i;\n  }\n}\n\nclass FilterSupport {\n  constructor(pipe) {\n    this._pipe = pipe;\n  }\n  get pipe() {\n    return this._pipe;\n  }\n  get inputBuffer() {\n    return this._pipe.inputBuffer;\n  }\n  get outputBuffer() {\n    return this._pipe.outputBuffer;\n  }\n  fillInputBuffer() {\n    throw new Error('fillInputBuffer() not overridden');\n  }\n  fillOutputBuffer(numFrames = 0) {\n    while (this.outputBuffer.frameCount < numFrames) {\n      const numInputFrames = 8192 * 2 - this.inputBuffer.frameCount;\n      this.fillInputBuffer(numInputFrames);\n      if (this.inputBuffer.frameCount < 8192 * 2) {\n        break;\n      }\n      this._pipe.process();\n    }\n  }\n  clear() {\n    this._pipe.clear();\n  }\n}\n\nconst noop = function () {\n  return;\n};\n\nclass SimpleFilter extends FilterSupport {\n  constructor(sourceSound, pipe, callback = noop) {\n    super(pipe);\n    this.callback = callback;\n    this.sourceSound = sourceSound;\n    this.historyBufferSize = 22050;\n    this._sourcePosition = 0;\n    this.outputBufferPosition = 0;\n    this._position = 0;\n  }\n  get position() {\n    return this._position;\n  }\n  set position(position) {\n    if (position > this._position) {\n      throw new RangeError('New position may not be greater than current position');\n    }\n    const newOutputBufferPosition = this.outputBufferPosition - (this._position - position);\n    if (newOutputBufferPosition < 0) {\n      throw new RangeError('New position falls outside of history buffer');\n    }\n    this.outputBufferPosition = newOutputBufferPosition;\n    this._position = position;\n  }\n  get sourcePosition() {\n    return this._sourcePosition;\n  }\n  set sourcePosition(sourcePosition) {\n    this.clear();\n    this._sourcePosition = sourcePosition;\n  }\n  onEnd() {\n    this.callback();\n  }\n  fillInputBuffer(numFrames = 0) {\n    const samples = new Float32Array(numFrames * 2);\n    const numFramesExtracted = this.sourceSound.extract(samples, numFrames, this._sourcePosition);\n    this._sourcePosition += numFramesExtracted;\n    this.inputBuffer.putSamples(samples, 0, numFramesExtracted);\n  }\n  extract(target, numFrames = 0) {\n    this.fillOutputBuffer(this.outputBufferPosition + numFrames);\n    const numFramesExtracted = Math.min(numFrames, this.outputBuffer.frameCount - this.outputBufferPosition);\n    this.outputBuffer.extract(target, this.outputBufferPosition, numFramesExtracted);\n    const currentFrames = this.outputBufferPosition + numFramesExtracted;\n    this.outputBufferPosition = Math.min(this.historyBufferSize, currentFrames);\n    this.outputBuffer.receive(Math.max(currentFrames - this.historyBufferSize, 0));\n    this._position += numFramesExtracted;\n    return numFramesExtracted;\n  }\n  handleSampleData(event) {\n    this.extract(event.data, 4096);\n  }\n  clear() {\n    super.clear();\n    this.outputBufferPosition = 0;\n  }\n}\n\nconst USE_AUTO_SEQUENCE_LEN = 0;\nconst DEFAULT_SEQUENCE_MS = USE_AUTO_SEQUENCE_LEN;\nconst USE_AUTO_SEEKWINDOW_LEN = 0;\nconst DEFAULT_SEEKWINDOW_MS = USE_AUTO_SEEKWINDOW_LEN;\nconst DEFAULT_OVERLAP_MS = 8;\nconst _SCAN_OFFSETS = [[124, 186, 248, 310, 372, 434, 496, 558, 620, 682, 744, 806, 868, 930, 992, 1054, 1116, 1178, 1240, 1302, 1364, 1426, 1488, 0], [-100, -75, -50, -25, 25, 50, 75, 100, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [-20, -15, -10, -5, 5, 10, 15, 20, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [-4, -3, -2, -1, 1, 2, 3, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]];\nconst AUTOSEQ_TEMPO_LOW = 0.5;\nconst AUTOSEQ_TEMPO_TOP = 2.0;\nconst AUTOSEQ_AT_MIN = 125.0;\nconst AUTOSEQ_AT_MAX = 50.0;\nconst AUTOSEQ_K = (AUTOSEQ_AT_MAX - AUTOSEQ_AT_MIN) / (AUTOSEQ_TEMPO_TOP - AUTOSEQ_TEMPO_LOW);\nconst AUTOSEQ_C = AUTOSEQ_AT_MIN - AUTOSEQ_K * AUTOSEQ_TEMPO_LOW;\nconst AUTOSEEK_AT_MIN = 25.0;\nconst AUTOSEEK_AT_MAX = 15.0;\nconst AUTOSEEK_K = (AUTOSEEK_AT_MAX - AUTOSEEK_AT_MIN) / (AUTOSEQ_TEMPO_TOP - AUTOSEQ_TEMPO_LOW);\nconst AUTOSEEK_C = AUTOSEEK_AT_MIN - AUTOSEEK_K * AUTOSEQ_TEMPO_LOW;\nclass Stretch extends AbstractFifoSamplePipe {\n  constructor(createBuffers) {\n    super(createBuffers);\n    this._quickSeek = true;\n    this.midBufferDirty = false;\n    this.midBuffer = null;\n    this.overlapLength = 0;\n    this.autoSeqSetting = true;\n    this.autoSeekSetting = true;\n    this._tempo = 1;\n    this.setParameters(44100, DEFAULT_SEQUENCE_MS, DEFAULT_SEEKWINDOW_MS, DEFAULT_OVERLAP_MS);\n  }\n  clear() {\n    super.clear();\n    this.clearMidBuffer();\n  }\n  clearMidBuffer() {\n    if (this.midBufferDirty) {\n      this.midBufferDirty = false;\n      this.midBuffer = null;\n    }\n  }\n  setParameters(sampleRate, sequenceMs, seekWindowMs, overlapMs) {\n    if (sampleRate > 0) {\n      this.sampleRate = sampleRate;\n    }\n    if (overlapMs > 0) {\n      this.overlapMs = overlapMs;\n    }\n    if (sequenceMs > 0) {\n      this.sequenceMs = sequenceMs;\n      this.autoSeqSetting = false;\n    } else {\n      this.autoSeqSetting = true;\n    }\n    if (seekWindowMs > 0) {\n      this.seekWindowMs = seekWindowMs;\n      this.autoSeekSetting = false;\n    } else {\n      this.autoSeekSetting = true;\n    }\n    this.calculateSequenceParameters();\n    this.calculateOverlapLength(this.overlapMs);\n    this.tempo = this._tempo;\n  }\n  set tempo(newTempo) {\n    let intskip;\n    this._tempo = newTempo;\n    this.calculateSequenceParameters();\n    this.nominalSkip = this._tempo * (this.seekWindowLength - this.overlapLength);\n    this.skipFract = 0;\n    intskip = Math.floor(this.nominalSkip + 0.5);\n    this.sampleReq = Math.max(intskip + this.overlapLength, this.seekWindowLength) + this.seekLength;\n  }\n  get tempo() {\n    return this._tempo;\n  }\n  get inputChunkSize() {\n    return this.sampleReq;\n  }\n  get outputChunkSize() {\n    return this.overlapLength + Math.max(0, this.seekWindowLength - 2 * this.overlapLength);\n  }\n  calculateOverlapLength(overlapInMsec = 0) {\n    let newOvl;\n    newOvl = this.sampleRate * overlapInMsec / 1000;\n    newOvl = newOvl < 16 ? 16 : newOvl;\n    newOvl -= newOvl % 8;\n    this.overlapLength = newOvl;\n    this.refMidBuffer = new Float32Array(this.overlapLength * 2);\n    this.midBuffer = new Float32Array(this.overlapLength * 2);\n  }\n  checkLimits(x, mi, ma) {\n    return x < mi ? mi : x > ma ? ma : x;\n  }\n  calculateSequenceParameters() {\n    let seq;\n    let seek;\n    if (this.autoSeqSetting) {\n      seq = AUTOSEQ_C + AUTOSEQ_K * this._tempo;\n      seq = this.checkLimits(seq, AUTOSEQ_AT_MAX, AUTOSEQ_AT_MIN);\n      this.sequenceMs = Math.floor(seq + 0.5);\n    }\n    if (this.autoSeekSetting) {\n      seek = AUTOSEEK_C + AUTOSEEK_K * this._tempo;\n      seek = this.checkLimits(seek, AUTOSEEK_AT_MAX, AUTOSEEK_AT_MIN);\n      this.seekWindowMs = Math.floor(seek + 0.5);\n    }\n    this.seekWindowLength = Math.floor(this.sampleRate * this.sequenceMs / 1000);\n    this.seekLength = Math.floor(this.sampleRate * this.seekWindowMs / 1000);\n  }\n  set quickSeek(enable) {\n    this._quickSeek = enable;\n  }\n  clone() {\n    const result = new Stretch();\n    result.tempo = this._tempo;\n    result.setParameters(this.sampleRate, this.sequenceMs, this.seekWindowMs, this.overlapMs);\n    return result;\n  }\n  seekBestOverlapPosition() {\n    return this._quickSeek ? this.seekBestOverlapPositionStereoQuick() : this.seekBestOverlapPositionStereo();\n  }\n  seekBestOverlapPositionStereo() {\n    let bestOffset;\n    let bestCorrelation;\n    let correlation;\n    let i = 0;\n    this.preCalculateCorrelationReferenceStereo();\n    bestOffset = 0;\n    bestCorrelation = Number.MIN_VALUE;\n    for (; i < this.seekLength; i = i + 1) {\n      correlation = this.calculateCrossCorrelationStereo(2 * i, this.refMidBuffer);\n      if (correlation > bestCorrelation) {\n        bestCorrelation = correlation;\n        bestOffset = i;\n      }\n    }\n    return bestOffset;\n  }\n  seekBestOverlapPositionStereoQuick() {\n    let bestOffset;\n    let bestCorrelation;\n    let correlation;\n    let scanCount = 0;\n    let correlationOffset;\n    let tempOffset;\n    this.preCalculateCorrelationReferenceStereo();\n    bestCorrelation = Number.MIN_VALUE;\n    bestOffset = 0;\n    correlationOffset = 0;\n    tempOffset = 0;\n    for (; scanCount < 4; scanCount = scanCount + 1) {\n      let j = 0;\n      while (_SCAN_OFFSETS[scanCount][j]) {\n        tempOffset = correlationOffset + _SCAN_OFFSETS[scanCount][j];\n        if (tempOffset >= this.seekLength) {\n          break;\n        }\n        correlation = this.calculateCrossCorrelationStereo(2 * tempOffset, this.refMidBuffer);\n        if (correlation > bestCorrelation) {\n          bestCorrelation = correlation;\n          bestOffset = tempOffset;\n        }\n        j = j + 1;\n      }\n      correlationOffset = bestOffset;\n    }\n    return bestOffset;\n  }\n  preCalculateCorrelationReferenceStereo() {\n    let i = 0;\n    let context;\n    let temp;\n    for (; i < this.overlapLength; i = i + 1) {\n      temp = i * (this.overlapLength - i);\n      context = i * 2;\n      this.refMidBuffer[context] = this.midBuffer[context] * temp;\n      this.refMidBuffer[context + 1] = this.midBuffer[context + 1] * temp;\n    }\n  }\n  calculateCrossCorrelationStereo(mixingPosition, compare) {\n    const mixing = this._inputBuffer.vector;\n    mixingPosition += this._inputBuffer.startIndex;\n    let correlation = 0;\n    let i = 2;\n    const calcLength = 2 * this.overlapLength;\n    let mixingOffset;\n    for (; i < calcLength; i = i + 2) {\n      mixingOffset = i + mixingPosition;\n      correlation += mixing[mixingOffset] * compare[i] + mixing[mixingOffset + 1] * compare[i + 1];\n    }\n    return correlation;\n  }\n  overlap(overlapPosition) {\n    this.overlapStereo(2 * overlapPosition);\n  }\n  overlapStereo(inputPosition) {\n    const input = this._inputBuffer.vector;\n    inputPosition += this._inputBuffer.startIndex;\n    const output = this._outputBuffer.vector;\n    const outputPosition = this._outputBuffer.endIndex;\n    let i = 0;\n    let context;\n    let tempFrame;\n    const frameScale = 1 / this.overlapLength;\n    let fi;\n    let inputOffset;\n    let outputOffset;\n    for (; i < this.overlapLength; i = i + 1) {\n      tempFrame = (this.overlapLength - i) * frameScale;\n      fi = i * frameScale;\n      context = 2 * i;\n      inputOffset = context + inputPosition;\n      outputOffset = context + outputPosition;\n      output[outputOffset + 0] = input[inputOffset + 0] * fi + this.midBuffer[context + 0] * tempFrame;\n      output[outputOffset + 1] = input[inputOffset + 1] * fi + this.midBuffer[context + 1] * tempFrame;\n    }\n  }\n  process() {\n    let offset;\n    let temp;\n    let overlapSkip;\n    if (this.midBuffer === null) {\n      if (this._inputBuffer.frameCount < this.overlapLength) {\n        return;\n      }\n      this.midBuffer = new Float32Array(this.overlapLength * 2);\n      this._inputBuffer.receiveSamples(this.midBuffer, this.overlapLength);\n    }\n    while (this._inputBuffer.frameCount >= this.sampleReq) {\n      offset = this.seekBestOverlapPosition();\n      this._outputBuffer.ensureAdditionalCapacity(this.overlapLength);\n      this.overlap(Math.floor(offset));\n      this._outputBuffer.put(this.overlapLength);\n      temp = this.seekWindowLength - 2 * this.overlapLength;\n      if (temp > 0) {\n        this._outputBuffer.putBuffer(this._inputBuffer, offset + this.overlapLength, temp);\n      }\n      const start = this._inputBuffer.startIndex + 2 * (offset + this.seekWindowLength - this.overlapLength);\n      this.midBuffer.set(this._inputBuffer.vector.subarray(start, start + 2 * this.overlapLength));\n      this.skipFract += this.nominalSkip;\n      overlapSkip = Math.floor(this.skipFract);\n      this.skipFract -= overlapSkip;\n      this._inputBuffer.receive(overlapSkip);\n    }\n  }\n}\n\nconst testFloatEqual = function (a, b) {\n  return (a > b ? a - b : b - a) > 1e-10;\n};\n\nclass SoundTouch {\n  constructor() {\n    this.transposer = new RateTransposer(false);\n    this.stretch = new Stretch(false);\n    this._inputBuffer = new FifoSampleBuffer();\n    this._intermediateBuffer = new FifoSampleBuffer();\n    this._outputBuffer = new FifoSampleBuffer();\n    this._rate = 0;\n    this._tempo = 0;\n    this.virtualPitch = 1.0;\n    this.virtualRate = 1.0;\n    this.virtualTempo = 1.0;\n    this.calculateEffectiveRateAndTempo();\n  }\n  clear() {\n    this.transposer.clear();\n    this.stretch.clear();\n  }\n  clone() {\n    const result = new SoundTouch();\n    result.rate = this.rate;\n    result.tempo = this.tempo;\n    return result;\n  }\n  get rate() {\n    return this._rate;\n  }\n  set rate(rate) {\n    this.virtualRate = rate;\n    this.calculateEffectiveRateAndTempo();\n  }\n  set rateChange(rateChange) {\n    this._rate = 1.0 + 0.01 * rateChange;\n  }\n  get tempo() {\n    return this._tempo;\n  }\n  set tempo(tempo) {\n    this.virtualTempo = tempo;\n    this.calculateEffectiveRateAndTempo();\n  }\n  set tempoChange(tempoChange) {\n    this.tempo = 1.0 + 0.01 * tempoChange;\n  }\n  set pitch(pitch) {\n    this.virtualPitch = pitch;\n    this.calculateEffectiveRateAndTempo();\n  }\n  set pitchOctaves(pitchOctaves) {\n    this.pitch = Math.exp(0.69314718056 * pitchOctaves);\n    this.calculateEffectiveRateAndTempo();\n  }\n  set pitchSemitones(pitchSemitones) {\n    this.pitchOctaves = pitchSemitones / 12.0;\n  }\n  get inputBuffer() {\n    return this._inputBuffer;\n  }\n  get outputBuffer() {\n    return this._outputBuffer;\n  }\n  calculateEffectiveRateAndTempo() {\n    const previousTempo = this._tempo;\n    const previousRate = this._rate;\n    this._tempo = this.virtualTempo / this.virtualPitch;\n    this._rate = this.virtualRate * this.virtualPitch;\n    if (testFloatEqual(this._tempo, previousTempo)) {\n      this.stretch.tempo = this._tempo;\n    }\n    if (testFloatEqual(this._rate, previousRate)) {\n      this.transposer.rate = this._rate;\n    }\n    if (this._rate > 1.0) {\n      if (this._outputBuffer != this.transposer.outputBuffer) {\n        this.stretch.inputBuffer = this._inputBuffer;\n        this.stretch.outputBuffer = this._intermediateBuffer;\n        this.transposer.inputBuffer = this._intermediateBuffer;\n        this.transposer.outputBuffer = this._outputBuffer;\n      }\n    } else {\n      if (this._outputBuffer != this.stretch.outputBuffer) {\n        this.transposer.inputBuffer = this._inputBuffer;\n        this.transposer.outputBuffer = this._intermediateBuffer;\n        this.stretch.inputBuffer = this._intermediateBuffer;\n        this.stretch.outputBuffer = this._outputBuffer;\n      }\n    }\n  }\n  process() {\n    if (this._rate > 1.0) {\n      this.stretch.process();\n      this.transposer.process();\n    } else {\n      this.transposer.process();\n      this.stretch.process();\n    }\n  }\n}\n\nclass WebAudioBufferSource {\n  constructor(buffer) {\n    this.buffer = buffer;\n    this._position = 0;\n  }\n  get dualChannel() {\n    return this.buffer.numberOfChannels > 1;\n  }\n  get position() {\n    return this._position;\n  }\n  set position(value) {\n    this._position = value;\n  }\n  extract(target, numFrames = 0, position = 0) {\n    this.position = position;\n    let left = this.buffer.getChannelData(0);\n    let right = this.dualChannel ? this.buffer.getChannelData(1) : this.buffer.getChannelData(0);\n    let i = 0;\n    for (; i < numFrames; i++) {\n      target[i * 2] = left[i + position];\n      target[i * 2 + 1] = right[i + position];\n    }\n    return Math.min(numFrames, left.length - position);\n  }\n}\n\nconst getWebAudioNode = function (context, filter, sourcePositionCallback = noop, bufferSize = 4096) {\n  const node = context.createScriptProcessor(bufferSize, 2, 2);\n  const samples = new Float32Array(bufferSize * 2);\n  node.onaudioprocess = event => {\n    let left = event.outputBuffer.getChannelData(0);\n    let right = event.outputBuffer.getChannelData(1);\n    let framesExtracted = filter.extract(samples, bufferSize);\n    sourcePositionCallback(filter.sourcePosition);\n    if (framesExtracted === 0) {\n      filter.onEnd();\n    }\n    let i = 0;\n    for (; i < framesExtracted; i++) {\n      left[i] = samples[i * 2];\n      right[i] = samples[i * 2 + 1];\n    }\n  };\n  return node;\n};\n\nconst pad = function (n, width, z) {\n  z = z || '0';\n  n = n + '';\n  return n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;\n};\nconst minsSecs = function (secs) {\n  const mins = Math.floor(secs / 60);\n  const seconds = secs - mins * 60;\n  return `${mins}:${pad(parseInt(seconds), 2)}`;\n};\n\nconst onUpdate = function (sourcePosition) {\n  const currentTimePlayed = this.timePlayed;\n  const sampleRate = this.sampleRate;\n  this.sourcePosition = sourcePosition;\n  this.timePlayed = sourcePosition / sampleRate;\n  if (currentTimePlayed !== this.timePlayed) {\n    const timePlayed = new CustomEvent('play', {\n      detail: {\n        timePlayed: this.timePlayed,\n        formattedTimePlayed: this.formattedTimePlayed,\n        percentagePlayed: this.percentagePlayed\n      }\n    });\n    this._node.dispatchEvent(timePlayed);\n  }\n};\nclass PitchShifter {\n  constructor(context, buffer, bufferSize, onEnd = noop) {\n    this._soundtouch = new SoundTouch();\n    const source = new WebAudioBufferSource(buffer);\n    this.timePlayed = 0;\n    this.sourcePosition = 0;\n    this._filter = new SimpleFilter(source, this._soundtouch, onEnd);\n    this._node = getWebAudioNode(context, this._filter, sourcePostion => onUpdate.call(this, sourcePostion), bufferSize);\n    this.tempo = 1;\n    this.rate = 1;\n    this.duration = buffer.duration;\n    this.sampleRate = context.sampleRate;\n    this.listeners = [];\n  }\n  get formattedDuration() {\n    return minsSecs(this.duration);\n  }\n  get formattedTimePlayed() {\n    return minsSecs(this.timePlayed);\n  }\n  get percentagePlayed() {\n    return 100 * this._filter.sourcePosition / (this.duration * this.sampleRate);\n  }\n  set percentagePlayed(perc) {\n    this._filter.sourcePosition = parseInt(perc * this.duration * this.sampleRate);\n    this.sourcePosition = this._filter.sourcePosition;\n    this.timePlayed = this.sourcePosition / this.sampleRate;\n  }\n  get node() {\n    return this._node;\n  }\n  set pitch(pitch) {\n    this._soundtouch.pitch = pitch;\n  }\n  set pitchSemitones(semitone) {\n    this._soundtouch.pitchSemitones = semitone;\n  }\n  set rate(rate) {\n    this._soundtouch.rate = rate;\n  }\n  set tempo(tempo) {\n    this._soundtouch.tempo = tempo;\n  }\n  connect(toNode) {\n    this._node.connect(toNode);\n  }\n  disconnect() {\n    this._node.disconnect();\n  }\n  on(eventName, cb) {\n    this.listeners.push({\n      name: eventName,\n      cb: cb\n    });\n    this._node.addEventListener(eventName, event => cb(event.detail));\n  }\n  off(eventName = null) {\n    let listeners = this.listeners;\n    if (eventName) {\n      listeners = listeners.filter(e => e.name === eventName);\n    }\n    listeners.forEach(e => {\n      this._node.removeEventListener(e.name, event => e.cb(event.detail));\n    });\n  }\n}\n\nexport { AbstractFifoSamplePipe, PitchShifter, RateTransposer, SimpleFilter, SoundTouch, Stretch, WebAudioBufferSource, getWebAudioNode };\n//# sourceMappingURL=soundtouch.js.map\n","import SoundtouchWorkletMessage from \"../../model/SoundtouchWorkletMessage\";\nimport { SoundtouchWorkletOptionsWrapper } from \"../../model/SoundtouchWorkletOptionsWrapper\";\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nlet soundtouchWrapperFilterWorkletNodeClass: any;\n\nif(typeof(window) !== \"undefined\" && typeof(window.AudioWorkletNode) !== \"undefined\") {\n    soundtouchWrapperFilterWorkletNodeClass = class SoundtouchWrapperFilterWorkletNode extends AudioWorkletNode {\n\n        name: string = \"\";\n        private running = false;\n        private _tempo = 1;\n        private _pitch = 1;\n\n        constructor(context: BaseAudioContext, workletName: string, options: SoundtouchWorkletOptionsWrapper) {\n            super(context, workletName, options);\n            this.name = this.constructor.name;\n            this.running = true;\n            this.updateInterval = options.processorOptions.updateInterval;\n        }\n\n        async setup(tempo: number, pitch: number): Promise<void> {\n            return new Promise(resolve => {\n                if(this.port) {\n                    this.port.onmessage = (ev: MessageEvent<SoundtouchWorkletMessage>) => {\n                        if(ev && ev.data && ev.data.status === \"OK\" && ev.data.args[0] === \"setup\") {\n                            this.port.onmessage = this.messageProcessor.bind(this);\n                            resolve();\n                        }\n                    };\n    \n                    this.port.postMessage({ command: \"setup\", args: [tempo, pitch] });\n\n                    this._tempo = tempo;\n                    this._pitch = pitch;\n                }\n            });\n        }\n\n        set updateInterval(value: number) {\n            this.port.postMessage({ command: \"updateInterval\", args: [value] });\n        }\n\n        get node() {\n            return this;\n        }\n\n        set tempo(value: number) {\n            this.port.postMessage({ command: \"setTempo\", args: [value] });\n        }\n\n        set pitch(value: number) {\n            this.port.postMessage({ command: \"setPitch\", args: [value] });\n        }\n\n        get tempo(): number {\n            this.port.postMessage({ command: \"getTempo\", args: [] });\n            return this._tempo;\n        }\n\n        get pitch(): number {\n            this.port.postMessage({ command: \"getPitch\", args: [] });\n            return this._pitch;\n        }\n\n        async stop() {\n            if (!this.running) return;\n\n            this.port.postMessage({ command: \"stop\", args: [] });\n            this.disconnect();\n\n            this.running = false;\n        }\n\n        messageProcessor(e: MessageEvent<SoundtouchWorkletMessage>) {\n            if (e.data.command) {\n                const { command } = e.data;\n                \n                switch (command) {\n                case \"End\":\n                    this.stop();\n                    break;\n                default:\n                    break;\n                }\n\n                if (e.data.status) {\n                    const value = e.data.args[1];\n\n                    switch (e.data.args[0]) {\n                    case \"getTempo\":\n                        this._tempo = value as number;\n                        break;\n                    case \"getPitch\":\n                        this._pitch = value as number;\n                        break;\n                    default:\n                        break;\n                    }\n                    return;\n                }\n            }\n        }\n    };\n}\n\nexport default soundtouchWrapperFilterWorkletNodeClass;\n","/*\n * Copyright (c) 2012 The Chromium Authors. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are\n * met:\n *\n *    * Redistributions of source code must retain the above copyright\n * notice, this list of conditions and the following disclaimer.\n *    * Redistributions in binary form must reproduce the above\n * copyright notice, this list of conditions and the following disclaimer\n * in the documentation and/or other materials provided with the\n * distribution.\n *    * Neither the name of Google Inc. nor the names of its\n * contributors may be used to endorse or promote products derived from\n * this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n/*\n * Copyright (C) 2023 Eliastik (eliastiksofts.com)\n *\n * This file is part of \"Simple Voice Changer\".\n *\n * \"Simple Voice Changer\" is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * \"Simple Voice Changer\" is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with \"Simple Voice Changer\".  If not, see <http://www.gnu.org/licenses/>.\n */\ninterface VocoderBand {\n    frequency: number;\n}\n\nexport default class Vocoder {\n\n    private FILTER_QUALITY = 6;  // The Q value for the carrier and modulator filters\n    private FOURIER_SIZE = 4096;\n    private WAVETABLEBOOST = 40.0;\n    private SAWTOOTHBOOST = 0.40;\n    private oscillatorType = 4;   // CUSTOM\n    private oscillatorDetuneValue = 0;\n\n    private audioContext: BaseAudioContext | null = null;\n    private modulatorBuffer: AudioBuffer | undefined;\n    private carrierBuffer: AudioBuffer | null = null;\n    private modulatorNode: AudioBufferSourceNode | null = null;\n    private vocoding = false;\n\n    // These are \"placeholder\" gain nodes - because the modulator and carrier will get swapped in\n    // as they are loaded, it's easier to connect these nodes to all the bands, and the \"real\"\n    // modulator & carrier AudioBufferSourceNodes connect to these.\n    private modulatorInput: GainNode | null = null;\n    private carrierInput: GainNode | null = null;\n\n    private modulatorGain: GainNode | null = null;\n    private modulatorGainValue = 1.0;\n\n    // noise node added to the carrier signal\n    private noiseBuffer: AudioBuffer | null = null;\n    private noiseNode: AudioBufferSourceNode | null = null;\n    private noiseGain: GainNode | null = null;\n    private noiseGainValue = 0.2;\n\n    // Carrier sample gain\n    private carrierSampleNode: AudioBufferSourceNode | null = null;\n    private carrierSampleGain: GainNode | null = null;\n    private carrierSampleGainValue = 0.0;\n\n    // Carrier Synth oscillator stuff\n    private oscillatorNode: OscillatorNode | null = null;\n    private oscillatorGain: GainNode | null = null;\n    private oscillatorGainValue = 1.0;\n    private wavetable: PeriodicWave | null = null;\n    private wavetableSignalGain: GainNode | null = null;\n\n    // These are the arrays of nodes - the \"columns\" across the frequency band \"rows\"\n    private modFilterBands: BiquadFilterNode[] | null = null;    // tuned bandpass filters\n    private modFilterPostGains: GainNode[] | null = null;  // post-filter gains.\n    private heterodynes: GainNode[] | null = null;   // gain nodes used to multiply bandpass X sine\n    private powers: number[] | null = null;      // gain nodes used to multiply prev out by itself\n    private lpFilters: BiquadFilterNode[] | null = null;   // tuned LP filters to remove doubled copy of product\n    private lpFilterPostGains: GainNode[] | null = null;   // gain nodes for tuning input to waveshapers\n    private carrierBands: BiquadFilterNode[] | null = null;  // tuned bandpass filters, same as modFilterBands but in carrier chain\n    private carrierFilterPostGains: GainNode[] | null = null;  // post-bandpass gain adjustment\n    private carrierBandGains: GainNode[] | null = null;  // these are the \"control gains\" driven by the lpFilters\n\n    private vocoderBands: VocoderBand[] | null = null;\n    private numVocoderBands: number = 0;\n\n    private hpFilterGain: GainNode | null = null;\n    private outputGain: GainNode | null = null;\n\n    // Initialization function for the page.\n    constructor(ctx: BaseAudioContext, carrierB: AudioBuffer, modulatorB?: AudioBuffer) {\n        this.audioContext = ctx;\n        this.carrierBuffer = carrierB;\n        this.modulatorBuffer = modulatorB;\n    }\n\n    init() {\n        this.generateVocoderBands(55, 7040, 28);\n        // Set up the vocoder chains\n        this.setupVocoderGraph();\n        this.vocode();\n    }\n\n    getNodes() {\n        return {\n            modulatorNode: this.modulatorNode,\n            modulatorGain: this.modulatorGain,\n            synthLevel: this.oscillatorGain,\n            noiseNode: this.noiseGain,\n            oscillatorNode: this.oscillatorNode,\n            hpFilterGain: this.hpFilterGain,\n            outputGain: this.outputGain\n        };\n    }\n\n    private shutOffCarrier() {\n        if (this.oscillatorNode && this.noiseNode && this.carrierSampleNode) {\n            this.oscillatorNode.stop(0);\n            this.oscillatorNode = null;\n            this.noiseNode.stop(0);\n            this.noiseNode = null;\n            this.carrierSampleNode.stop(0);\n            this.carrierSampleNode = null;\n        }\n    }\n\n    selectSawtooth() {\n        if (this.wavetableSignalGain)\n            this.wavetableSignalGain.gain.value = this.SAWTOOTHBOOST;\n        if (this.oscillatorNode)\n            this.oscillatorNode.type = \"sawtooth\";\n    }\n\n    selectWavetable() {\n        if (this.wavetableSignalGain)\n            this.wavetableSignalGain.gain.value = this.WAVETABLEBOOST;\n        if (this.oscillatorNode && this.wavetable)\n            this.oscillatorNode.setPeriodicWave(this.wavetable);\n        if (this.wavetableSignalGain)\n            this.wavetableSignalGain.gain.value = this.WAVETABLEBOOST;\n    }\n\n    updateModGain(value: number) {\n        this.modulatorGainValue = value;\n        if (this.modulatorGain)\n            this.modulatorGain.gain.value = value;\n    }\n\n    // sample-based carrier\n    updateSampleLevel(value: number) {\n        this.carrierSampleGainValue = value;\n        if (this.carrierSampleGain)\n            this.carrierSampleGain.gain.value = value;\n    }\n\n    // noise in carrier\n    updateSynthLevel(value: number) {\n        this.oscillatorGainValue = value;\n        if (this.oscillatorGain)\n            this.oscillatorGain.gain.value = value;\n    }\n\n    // noise in carrier\n    updateNoiseLevel(value: number) {\n        this.noiseGainValue = value;\n        if (this.noiseGain)\n            this.noiseGain.gain.value = value;\n    }\n\n    updateDetuneValue(value: number) {\n        this.oscillatorDetuneValue = value;\n        if (this.oscillatorNode)\n            this.oscillatorNode.detune.value = value;\n    }\n\n    // this will algorithmically re-calculate vocoder bands, distributing evenly\n    // from startFreq to endFreq, splitting evenly (logarhythmically) into a given numBands.\n    // The function places this info into the global vocoderBands and numVocoderBands letiables.\n    private generateVocoderBands(startFreq: number, endFreq: number, numBands: number) {\n        // Remember: 1200 cents in octave, 100 cents per semitone\n\n        const totalRangeInCents = 1200 * Math.log(endFreq / startFreq) / Math.LN2;\n        const centsPerBand = totalRangeInCents / numBands;\n        const scale = Math.pow(2, centsPerBand / 1200);  // This is the scaling for successive bands\n\n        this.vocoderBands = [];\n        let currentFreq = startFreq;\n\n        for (let i = 0; i < numBands; i++) {\n            this.vocoderBands[i] = { frequency: currentFreq };\n            //console.log( \"Band \" + i + \" centered at \" + currentFreq + \"Hz\" );\n            currentFreq = currentFreq * scale;\n        }\n\n        this.numVocoderBands = numBands;\n    }\n\n    private loadNoiseBuffer() {  // create a 5-second buffer of noise\n        if (!this.audioContext) return;\n\n        const lengthInSamples = 5 * this.audioContext.sampleRate;\n        this.noiseBuffer = this.audioContext.createBuffer(1, lengthInSamples, this.audioContext.sampleRate);\n        const bufferData = this.noiseBuffer.getChannelData(0);\n\n        for (let i = 0; i < lengthInSamples; ++i) {\n            bufferData[i] = (2 * Math.random() - 1);  // -1 to +1\n        }\n    }\n\n    private initBandpassFilters() {\n        if (!this.audioContext) return;\n\n        // When this function is called, the carrierNode and modulatorAnalyser\n        // may not already be created.  Create placeholder nodes for them.\n        this.modulatorInput = this.audioContext.createGain();\n        this.carrierInput = this.audioContext.createGain();\n\n        if (this.modFilterBands == null)\n            this.modFilterBands = [];\n\n        if (this.modFilterPostGains == null)\n            this.modFilterPostGains = [];\n\n        if (this.heterodynes == null)\n            this.heterodynes = [];\n\n        if (this.powers == null)\n            this.powers = [];\n\n        if (this.lpFilters == null)\n            this.lpFilters = [];\n\n        if (this.lpFilterPostGains == null)\n            this.lpFilterPostGains = [];\n\n        if (this.carrierBands == null)\n            this.carrierBands = [];\n\n        if (this.carrierFilterPostGains == null)\n            this.carrierFilterPostGains = [];\n\n        if (this.carrierBandGains == null)\n            this.carrierBandGains = [];\n\n        const waveShaperCurve = new Float32Array(65536);\n        // Populate with a \"curve\" that does an abs()\n        const n = 65536;\n        const n2 = n / 2;\n        let x;\n\n        for (let i = 0; i < n2; ++i) {\n            x = i / n2;\n\n            waveShaperCurve[n2 + i] = x;\n            waveShaperCurve[n2 - i - 1] = x;\n        }\n\n        // Set up a high-pass filter to add back in the fricatives, etc.\n        // (this isn't used by default in the \"production\" version, as I hid the slider)\n        const hpFilter = this.audioContext.createBiquadFilter();\n        hpFilter.type = \"highpass\";\n        hpFilter.frequency.value = 8000; // or use vocoderBands[numVocoderBands-1].frequency;\n        hpFilter.Q.value = 1; //  no peaking\n        this.modulatorInput.connect(hpFilter);\n\n        this.hpFilterGain = this.audioContext.createGain();\n        this.hpFilterGain.gain.value = 0.0;\n\n        hpFilter.connect(this.hpFilterGain);\n\n        if(this.modulatorBuffer) {\n            this.hpFilterGain.connect(this.audioContext.destination);\n        }\n\n        //clear the arrays\n        this.modFilterBands.length = 0;\n        this.modFilterPostGains.length = 0;\n        this.heterodynes.length = 0;\n        this.powers.length = 0;\n        this.lpFilters.length = 0;\n        this.lpFilterPostGains.length = 0;\n        this.carrierBands.length = 0;\n        this.carrierFilterPostGains.length = 0;\n        this.carrierBandGains.length = 0;\n\n        this.outputGain = this.audioContext.createGain();\n\n        if(this.modulatorBuffer) {\n            this.outputGain.connect(this.audioContext.destination);\n        }\n\n        const rectifierCurve = new Float32Array(65536);\n        for (let i = -32768; i < 32768; i++)\n            rectifierCurve[i + 32768] = ((i > 0) ? i : -i) / 32768;\n\n        for (let i = 0; i < this.numVocoderBands; i++) {\n            // CREATE THE MODULATOR CHAIN\n            // create the bandpass filter in the modulator chain\n            const modulatorFilter = this.audioContext.createBiquadFilter();\n            modulatorFilter.type = \"bandpass\";  // Bandpass filter\n            if (this.vocoderBands)\n                modulatorFilter.frequency.value = this.vocoderBands[i].frequency;\n            modulatorFilter.Q.value = this.FILTER_QUALITY; //  initial quality\n            this.modulatorInput.connect(modulatorFilter);\n            this.modFilterBands.push(modulatorFilter);\n\n            // Now, create a second bandpass filter tuned to the same frequency -\n            // this turns our second-order filter into a 4th-order filter,\n            // which has a steeper rolloff/octave\n            const secondModulatorFilter = this.audioContext.createBiquadFilter();\n            secondModulatorFilter.type = \"bandpass\";  // Bandpass filter\n            if (this.vocoderBands)\n                secondModulatorFilter.frequency.value = this.vocoderBands[i].frequency;\n            secondModulatorFilter.Q.value = this.FILTER_QUALITY; //  initial quality\n            //modulatorFilter.chainedFilter = secondModulatorFilter;\n            modulatorFilter.connect(secondModulatorFilter);\n\n            // create a post-filtering gain to bump the levels up.\n            const modulatorFilterPostGain = this.audioContext.createGain();\n            modulatorFilterPostGain.gain.value = 6;\n            secondModulatorFilter.connect(modulatorFilterPostGain);\n            this.modFilterPostGains.push(modulatorFilterPostGain);\n\n            // Create the sine oscillator for the heterodyne\n            const heterodyneOscillator = this.audioContext.createOscillator();\n            if (this.vocoderBands)\n                heterodyneOscillator.frequency.value = this.vocoderBands[i].frequency;\n\n            heterodyneOscillator.start(0);\n\n            // Create the node to multiply the sine by the modulator\n            const heterodyne = this.audioContext.createGain();\n            modulatorFilterPostGain.connect(heterodyne);\n            heterodyne.gain.value = 0.0;  // audio-rate inputs are summed with initial intrinsic value\n            heterodyneOscillator.connect(heterodyne.gain);\n\n            const heterodynePostGain = this.audioContext.createGain();\n            heterodynePostGain.gain.value = 2.0;    // GUESS:  boost\n            heterodyne.connect(heterodynePostGain);\n            this.heterodynes.push(heterodynePostGain);\n\n\n            // Create the rectifier node\n            const rectifier = this.audioContext.createWaveShaper();\n            rectifier.curve = rectifierCurve;\n            heterodynePostGain.connect(rectifier);\n\n            // Create the lowpass filter to mask off the difference (near zero)\n            const lpFilter = this.audioContext.createBiquadFilter();\n            lpFilter.type = \"lowpass\";  // Lowpass filter\n            lpFilter.frequency.value = 5.0; // Guesstimate!  Mask off 20Hz and above.\n            lpFilter.Q.value = 1; // don't need a peak\n            this.lpFilters.push(lpFilter);\n            rectifier.connect(lpFilter);\n\n            const lpFilterPostGain = this.audioContext.createGain();\n            lpFilterPostGain.gain.value = 1.0;\n            lpFilter.connect(lpFilterPostGain);\n            this.lpFilterPostGains.push(lpFilterPostGain);\n\n            const waveshaper = this.audioContext.createWaveShaper();\n            waveshaper.curve = waveShaperCurve;\n            lpFilterPostGain.connect(waveshaper);\n\n\n            // Create the bandpass filter in the carrier chain\n            const carrierFilter = this.audioContext.createBiquadFilter();\n            carrierFilter.type = \"bandpass\";\n            if (this.vocoderBands)\n                carrierFilter.frequency.value = this.vocoderBands[i].frequency;\n            carrierFilter.Q.value = this.FILTER_QUALITY;\n            this.carrierBands.push(carrierFilter);\n            this.carrierInput.connect(carrierFilter);\n\n            // We want our carrier filters to be 4th-order filter too.\n            const secondCarrierFilter = this.audioContext.createBiquadFilter();\n            secondCarrierFilter.type = \"bandpass\";  // Bandpass filter\n            if (this.vocoderBands)\n                secondCarrierFilter.frequency.value = this.vocoderBands[i].frequency;\n            secondCarrierFilter.Q.value = this.FILTER_QUALITY; //  initial quality\n            //carrierFilter.chainedFilter = secondCarrierFilter;\n            carrierFilter.connect(secondCarrierFilter);\n\n            const carrierFilterPostGain = this.audioContext.createGain();\n            carrierFilterPostGain.gain.value = 10.0;\n            secondCarrierFilter.connect(carrierFilterPostGain);\n            this.carrierFilterPostGains.push(carrierFilterPostGain);\n\n            // Create the carrier band gain node\n            const bandGain = this.audioContext.createGain();\n            this.carrierBandGains.push(bandGain);\n            carrierFilterPostGain.connect(bandGain);\n            bandGain.gain.value = 0.0;  // audio-rate inputs are summed with initial intrinsic value\n            waveshaper.connect(bandGain.gain);  // connect the lp controller\n\n            bandGain.connect(this.outputGain);\n        }\n\n\n        // Now set up our wavetable stuff.\n        const real = new Float32Array(this.FOURIER_SIZE);\n        const imag = new Float32Array(this.FOURIER_SIZE);\n        real[0] = 0.0;\n        imag[0] = 0.0;\n        for (let i = 1; i < this.FOURIER_SIZE; i++) {\n            real[i] = 1.0;\n            imag[i] = 1.0;\n        }\n\n        this.wavetable = this.audioContext.createPeriodicWave(real, imag);\n        this.loadNoiseBuffer();\n    }\n\n    private setupVocoderGraph() {\n        this.initBandpassFilters();\n    }\n\n    private createCarriersAndPlay(output: GainNode | null) {\n        if(!this.audioContext || !output) return;\n\n        this.carrierSampleNode = this.audioContext.createBufferSource();\n        this.carrierSampleNode.buffer = this.carrierBuffer;\n        this.carrierSampleNode.loop = true;\n\n        this.carrierSampleGain = this.audioContext.createGain();\n        this.carrierSampleGain.gain.value = this.carrierSampleGainValue;\n        this.carrierSampleNode.connect(this.carrierSampleGain);\n        this.carrierSampleGain.connect(output);\n\n        // The wavetable signal needs a boost.\n        this.wavetableSignalGain = this.audioContext.createGain();\n\n        this.oscillatorNode = this.audioContext.createOscillator();\n        if (this.oscillatorType == 4 && this.wavetable) { // wavetable\n            this.oscillatorNode.setPeriodicWave(this.wavetable);\n            this.wavetableSignalGain.gain.value = this.WAVETABLEBOOST;\n        } else {\n            //oscillatorNode.type = oscillatorType;\n            this.wavetableSignalGain.gain.value = this.SAWTOOTHBOOST;\n        }\n        this.oscillatorNode.frequency.value = 110;\n        this.oscillatorNode.detune.value = this.oscillatorDetuneValue;\n        this.oscillatorNode.connect(this.wavetableSignalGain);\n\n        this.oscillatorGain = this.audioContext.createGain();\n        this.oscillatorGain.gain.value = this.oscillatorGainValue;\n\n        this.wavetableSignalGain.connect(this.oscillatorGain);\n        this.oscillatorGain.connect(output);\n\n        this.noiseNode = this.audioContext.createBufferSource();\n        this.noiseNode.buffer = this.noiseBuffer;\n        this.noiseNode.loop = true;\n        this.noiseGain = this.audioContext.createGain();\n        this.noiseGain.gain.value = this.noiseGainValue;\n        this.noiseNode.connect(this.noiseGain);\n\n        this.noiseGain.connect(output);\n        this.oscillatorNode.start(0);\n        this.noiseNode.start(0);\n        this.carrierSampleNode.start(0);\n\n    }\n\n    private vocode() {\n        if(!this.audioContext) return;\n\n        if (this.vocoding) {\n            if (this.modulatorNode) {\n                this.modulatorNode.stop(0);\n            }\n            this.shutOffCarrier();\n            this.vocoding = false;\n            return;\n        }\n\n        this.createCarriersAndPlay(this.carrierInput);\n\n        this.vocoding = true;\n\n        this.modulatorGain = this.audioContext.createGain();\n        this.modulatorGain.gain.value = this.modulatorGainValue;\n\n        if(this.modulatorBuffer) {\n            this.modulatorNode = this.audioContext.createBufferSource();\n            this.modulatorNode.buffer = this.modulatorBuffer;\n            this.modulatorNode.connect(this.modulatorGain);\n            this.modulatorNode.start(0);\n        }\n\n        if (this.modulatorInput)\n            this.modulatorGain.connect(this.modulatorInput);\n    }\n}\n","import Constants from \"../../model/Constants\";\n\nclass PassthroughWorkletProcessor extends AudioWorkletProcessor {\n\n    stopped = false;\n    samplesCount = 0;\n\n    constructor() {\n        super();\n        this.port.onmessage = (event) => {\n            if (event.data == \"stop\") {\n                this.stop();\n            }\n        };\n    }\n\n    static get parameterDescriptors() {\n        return [];\n    }\n\n    get defaultParameterDescriptors() {\n        return PassthroughWorkletProcessor.parameterDescriptors;\n    }\n\n    process(inputs: Float32Array[][], outputs: Float32Array[][]): boolean {\n        if (this.stopped) return false;\n\n        const input = inputs[0];\n        const output = outputs[0];\n\n        if (input && input[0]) {\n            this.samplesCount += input[0].length;\n        }\n\n        if (output) {\n            for(let channel = 0; channel < output.length; channel++) {\n                const inp = input[channel];\n                const out = output[channel];\n\n                if (inp) {\n                    for (let sample = 0; sample < inp.length; sample++) {\n                        out[sample] = inp[sample];\n                    }\n                }\n            }\n\n            this.port.postMessage({ command: \"update\", samplesCount: this.samplesCount });\n        }\n\n        return true;\n    }\n\n    stop() {\n        this.stopped = true;\n    }\n}\n\nregisterProcessor(Constants.WORKLET_NAMES.PASSTHROUGH, PassthroughWorkletProcessor);\n","/*\n * Copyright (C) 2019-2023 Eliastik (eliastiksofts.com)\n *\n * This file is part of \"Simple Voice Changer\".\n *\n * \"Simple Voice Changer\" is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * \"Simple Voice Changer\" is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with \"Simple Voice Changer\".  If not, see <http://www.gnu.org/licenses/>.\n */\nexport default class TimerSaveTime {\n    seconds = 0;\n    initialSeconds = 0;\n    interval: number | null = null;\n    incr = 1;\n\n    private countCallback: () => void = () => {};\n\n    constructor(seconds: number, incr: number) {\n        this.seconds = seconds;\n        this.initialSeconds = seconds;\n        this.interval;\n        this.incr = incr;\n    }\n\n    start() {\n        this.interval = window.setInterval(() => this.count(), 1000);\n    }\n\n    stop() {\n        clearInterval(this.interval!);\n    }\n\n    count() {\n        this.seconds += this.incr;\n\n        if(this.seconds <= 0) {\n            this.stop();\n        }\n\n        if(this.countCallback) {\n            this.countCallback();\n        }\n    }\n\n    onCount(callback: () => void) {\n        this.countCallback = callback;\n    }\n}","\n/*\n * Copyright (C) 2019-2023 Eliastik (eliastiksofts.com)\n *\n * This file is part of \"Simple Voice Changer\".\n *\n * \"Simple Voice Changer\" is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * \"Simple Voice Changer\" is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with \"Simple Voice Changer\".  If not, see <http://www.gnu.org/licenses/>.\n */\n// The Voice Recorder class\n// Used to record a sound (voice, etc.) with the user microphone\n// Offer control with play/pause and audio feedback\nimport { inject, injectable } from \"inversify\";\nimport TimerSaveTime from \"../utils/TimerSaveTime\";\nimport { EventType } from \"../model/EventTypeEnum\";\nimport AudioConstraintWrapper from \"../model/AudioConstraintWrapper\";\nimport { RecorderSettings } from \"../model/RecorderSettings\";\nimport type { ConfigService } from \"../services/interfaces/ConfigService\";\nimport AbstractAudioElement from \"../filters/interfaces/AbstractAudioElement\";\nimport Constants from \"../model/Constants\";\nimport { EventEmitterCallback } from \"../model/EventEmitterCallback\";\nimport { AudioConstraint } from \"../model/AudioConstraint\";\nimport Recorder from \"../recorder/Recorder\";\nimport VoiceRecorderInterface from \"./interfaces/VoiceRecorderInterface\";\nimport { TYPES } from \"@/inversify.types\";\nimport AudioContextManagerInterface from \"@/audioEditor/interfaces/AudioContextManagerInterface\";\n\n@injectable()\nexport default class VoiceRecorder extends AbstractAudioElement implements VoiceRecorderInterface {\n\n    private contextManager: AudioContextManagerInterface | null | undefined;\n\n    private recorder: Recorder | null = null;\n\n    private input: MediaStreamAudioSourceNode | null = null;\n\n    private stream: MediaStream | null = null;\n\n    private alreadyInit = false;\n\n    private timer: TimerSaveTime | null = null;\n\n    private enableAudioFeedback = false;\n\n    private recording = false;\n\n    private deviceList: MediaDeviceInfo[] = [];\n\n    private constraints: AudioConstraintWrapper = {\n        audio: {\n            noiseSuppression: true,\n            echoCancellation: true,\n            autoGainControl: true,\n            sampleRate: { ideal: 44100 }\n        }\n    };\n\n    private sampleRateConfigNotSupported = false;\n\n    constructor(\n        @inject(TYPES.AudioContextManager) contextManager: AudioContextManagerInterface | null,\n        @inject(TYPES.ConfigService) configService: ConfigService) {\n        super();\n\n        this.contextManager = contextManager;\n        this.configService = configService;\n    }\n\n    async init() {\n        if (!this.isRecordingAvailable()) {\n            return;\n        }\n\n        // Specific case: Firefox doesn't support changing sample-rate for MediaDevice API\n        // In this case we disable sample-rate config feature for this VoiceRecorder\n        this.sampleRateConfigNotSupported = !navigator.mediaDevices.getSupportedConstraints().sampleRate;\n\n        if (this.contextManager) {\n            if (this.sampleRateConfigNotSupported) {\n                this.contextManager.createNewContext(0);\n            } else {\n                this.contextManager.createNewContextIfNeeded();\n            }\n        }\n\n        this.eventEmitter?.emit(EventType.RECORDER_INIT);\n\n        try {\n            const stream = await navigator.mediaDevices.getUserMedia(this.constraints);\n\n            if (this.contextManager && this.contextManager.currentContext) {\n                this.contextManager.currentContext.resume();\n            }\n\n            await this.setup(stream, false, false);\n\n            this.alreadyInit = true;\n            this.timer = new TimerSaveTime(0, 1);\n\n            this.timer.onCount(() => {\n                this.eventEmitter?.emit(EventType.RECORDER_COUNT_UPDATE);\n            });\n\n            this.successCallback();\n        } catch (e) {\n            console.error(e);\n\n            const exception = e as DOMException;\n\n            if (exception) {\n                switch (exception.name) {\n                case \"SecurityError\":\n                case \"NotAllowedError\":\n                    this.errorCallback();\n                    break;\n                case \"NotFoundError\":\n                    this.notFoundErrorCallback();\n                    break;\n                    // Disable sample rate configuration\n                case \"NotSupportedError\":\n                    if (!this.sampleRateConfigNotSupported) {\n                        this.sampleRateConfigNotSupported = true;\n                        this.init();\n                    }\n                    break;\n                default:\n                    this.unknownErrorCallback();\n                    break;\n                }\n            }\n        }\n\n        navigator.mediaDevices.ondevicechange = () => this.updateInputList();\n    }\n\n    private successCallback() {\n        this.eventEmitter?.emit(EventType.RECORDER_SUCCESS);\n    }\n\n    private errorCallback() {\n        this.eventEmitter?.emit(EventType.RECORDER_ERROR);\n    }\n\n    private notFoundErrorCallback() {\n        this.eventEmitter?.emit(EventType.RECORDER_NOT_FOUND_ERROR);\n    }\n\n    private unknownErrorCallback() {\n        this.eventEmitter?.emit(EventType.RECORDER_UNKNOWN_ERROR);\n    }\n\n    audioFeedback(enable: boolean) {\n        if (this.contextManager && this.contextManager.currentContext) {\n            if (enable) {\n                this.input && this.input.connect(this.contextManager.currentContext.destination);\n                this.enableAudioFeedback = true;\n            } else {\n                this.input && this.input.connect(this.contextManager.currentContext.destination) && this.input.disconnect(this.contextManager.currentContext.destination);\n                this.enableAudioFeedback = false;\n            }\n\n            this.eventEmitter?.emit(EventType.RECORDER_UPDATE_CONSTRAINTS);\n        }\n    }\n\n    /**\n     * Get current constraints/settings\n     * @returns MediaTrackSettings\n     */\n    private getConstraints() {\n        if (this.stream) {\n            const tracks = this.stream.getTracks();\n\n            if (tracks && tracks.length > 0) {\n                return tracks[0].getSettings();\n            }\n        }\n\n        return null;\n    }\n\n    /**\n     * Update the current constraints\n     */\n    private updateConstraints() {\n        const constraints = this.getConstraints();\n\n        if (constraints) {\n            this.constraints.audio = Object.assign(this.constraints.audio, constraints);\n            this.eventEmitter?.emit(EventType.RECORDER_UPDATE_CONSTRAINTS);\n        }\n    }\n\n    /**\n     * Reset the current constraints\n     * @param newConstraint AudioConstraintWrapper\n     */\n    private async resetConstraints(newConstraint?: AudioConstraintWrapper) {\n        if (this.stream) {\n            const precAudioFeedback = this.enableAudioFeedback;\n            const precRecording = this.recording;\n            const tracks = this.stream.getTracks();\n\n            if (newConstraint) {\n                this.updateConstraints();\n                this.constraints.audio = Object.assign(this.constraints.audio, newConstraint.audio);\n            }\n\n            if (tracks && tracks.length > 0) {\n                try {\n                    await tracks[0].applyConstraints(this.constraints.audio);\n\n                    const newConstraints = this.getConstraints();\n                    const newConstraintName = newConstraint ? Object.keys(newConstraint.audio)[0] : \"\";\n\n                    this.audioFeedback(false);\n                    this.pause();\n\n                    if (!newConstraint ||\n                        (newConstraints && (newConstraints as AudioConstraint)[newConstraintName] != newConstraint.audio[newConstraintName])) {\n                        this.stopStream();\n\n                        const stream = await navigator.mediaDevices.getUserMedia(this.constraints);\n\n                        await this.setup(stream, precRecording, precAudioFeedback);\n                    } else {\n                        await this.setup(null, precRecording, precAudioFeedback);\n                    }\n                } catch (e) {\n                    this.errorCallback();\n                }\n            }\n        }\n    }\n\n    /**\n     * Setup this voice recorder\n     * @param stream MediaStream\n     * @param precRecording Was recording?\n     * @param precAudioFeedback Has audio feedback?\n     */\n    private async setup(stream: MediaStream | null, precRecording: boolean, precAudioFeedback: boolean) {\n        if (stream && this.contextManager && this.contextManager.currentContext) {\n            this.input = this.contextManager.currentContext.createMediaStreamSource(stream);\n            this.stream = stream;\n        }\n\n        if (this.recorder && this.input) {\n            await this.recorder.setup(this.input);\n\n            if (precRecording) {\n                await this.record();\n            }\n        }\n\n        this.audioFeedback(precAudioFeedback);\n        this.updateConstraints();\n        await this.updateInputList();\n    }\n\n    setNoiseSuppression(enable: boolean) {\n        this.resetConstraints({\n            audio: {\n                noiseSuppression: enable\n            }\n        });\n    }\n\n    setAutoGain(enable: boolean) {\n        this.resetConstraints({\n            audio: {\n                autoGainControl: enable\n            }\n        });\n    }\n\n    setEchoCancellation(enable: boolean) {\n        this.resetConstraints({\n            audio: {\n                echoCancellation: enable\n            }\n        });\n    }\n\n    /**\n     * Update current audio input list\n     */\n    private async updateInputList() {\n        if (this.deviceList) {\n            const devices = await navigator.mediaDevices.enumerateDevices();\n            this.deviceList = [];\n\n            devices.forEach(device => {\n                if (device.kind == \"audioinput\") {\n                    this.deviceList.push(device);\n                }\n            });\n        }\n    }\n\n    changeInput(deviceId: string, groupId: string | undefined) {\n        if (groupId) {\n            this.constraints.audio.deviceId = deviceId;\n            this.constraints.audio.groupId = groupId;\n            this.resetConstraints();\n        }\n    }\n\n    async record() {\n        if (this.alreadyInit && this.configService && this.input) {\n            if (!this.recorder) {\n                this.recorder = new Recorder({\n                    bufferLen: this.configService.getBufferSize(),\n                    sampleRate: this.configService.getSampleRate(),\n                    numChannels: 2,\n                    workletBasePath: this.configService.getWorkletBasePath(),\n                    workerBasePath: this.configService.getWorkerBasePath(),\n                    mimeType: \"audio/wav\"\n                });\n\n                await this.recorder.setup(this.input);\n            }\n\n            if (this.recorder) {\n                this.recorder.record();\n            }\n\n            this.timer && this.timer.start();\n            this.recording = true;\n\n            if (this.eventEmitter) {\n                this.eventEmitter.emit(EventType.RECORDER_RECORDING);\n            }\n        }\n    }\n\n    async stop() {\n        if (this.alreadyInit && this.recorder) {\n            this.recorder.stop();\n            this.timer && this.timer.stop();\n            this.recording = false;\n\n            this.recorder.getBuffer((buffer: Float32Array[]) => {\n                if (this.contextManager && this.contextManager.currentContext) {\n                    this.contextManager.currentContext.resume();\n\n                    const newBuffer = this.contextManager.currentContext.createBuffer(2, buffer[0].length, this.contextManager.currentContext.sampleRate);\n                    newBuffer.getChannelData(0).set(buffer[0]);\n                    newBuffer.getChannelData(1).set(buffer[1]);\n\n                    this.eventEmitter?.emit(EventType.RECORDER_STOPPED, newBuffer);\n                    this.reset();\n                }\n            });\n        }\n    }\n\n    pause() {\n        if (this.alreadyInit) {\n            this.recorder && this.recorder.stop();\n            this.timer && this.timer.stop();\n            this.recording = false;\n            this.eventEmitter?.emit(EventType.RECORDER_PAUSED);\n        }\n    }\n\n    /**\n     * Stop stream\n     */\n    private stopStream() {\n        if (this.stream) {\n            const tracks = this.stream.getTracks();\n\n            for (let i = 0, l = tracks.length; i < l; i++) {\n                tracks[i].stop();\n            }\n        }\n    }\n\n    reset() {\n        this.recorder && this.recorder.kill();\n        this.timer && this.timer.stop();\n        this.audioFeedback(false);\n\n        this.stopStream();\n\n        this.input = null;\n        this.recorder = null;\n        this.stream = null;\n        this.alreadyInit = false;\n        this.timer = null;\n\n        this.eventEmitter?.emit(EventType.RECORDER_RESETED);\n    }\n\n    get currentTimeDisplay() {\n        return this.timer?.seconds ? (\"0\" + Math.trunc(this.timer?.seconds / 60)).slice(-2) + \":\" + (\"0\" + Math.trunc(this.timer?.seconds % 60)).slice(-2) : \"00:00\";\n    }\n\n    get currentTime() {\n        return this.timer ? this.timer.seconds : 0;\n    }\n\n    getSettings(): RecorderSettings {\n        return {\n            deviceList: this.deviceList,\n            audioFeedback: this.enableAudioFeedback,\n            constraints: this.constraints.audio\n        };\n    }\n\n    on(event: string, callback: EventEmitterCallback) {\n        this.eventEmitter?.on(event, callback);\n    }\n\n    isRecordingAvailable() {\n        return typeof (navigator.mediaDevices) !== \"undefined\" && typeof (navigator.mediaDevices.getUserMedia) !== \"undefined\";\n    }\n\n    get order(): number {\n        return -1;\n    }\n\n    get id(): string {\n        return Constants.VOICE_RECORDER;\n    }\n}\n","import \"reflect-metadata\";\nimport { Container } from \"inversify\";\nimport { TYPES } from \"./inversify.types\";\nimport AudioContextManagerInterface from \"./audioEditor/interfaces/AudioContextManagerInterface\";\nimport AudioContextManager from \"./audioEditor/AudioContextManager\";\nimport AudioEditorInterface from \"./audioEditor/interfaces/AudioEditorInterface\";\nimport AudioProcessorInterface from \"./audioEditor/interfaces/AudioProcessorInterface\";\nimport BufferManagerInterface from \"./audioEditor/interfaces/BufferManagerInterface\";\nimport FilterManagerInterface from \"./audioEditor/interfaces/FilterManagerInterface\";\nimport RendererManagerInterface from \"./audioEditor/interfaces/RendererManagerInterface\";\nimport SaveBufferManagerInterface from \"./audioEditor/interfaces/SaveBufferManagerInteface\";\nimport AudioEditor from \"./audioEditor/AudioEditor\";\nimport AudioProcessor from \"./audioEditor/AudioProcessor\";\nimport BufferManager from \"./audioEditor/BufferManager\";\nimport FilterManager from \"./audioEditor/FilterManager\";\nimport RendererManager from \"./audioEditor/RendererManager\";\nimport SaveBufferManager from \"./audioEditor/SaveBufferManager\";\nimport EventEmitterInterface from \"./utils/interfaces/EventEmitterInterface\";\nimport EventEmitter from \"./utils/EventEmitter\";\nimport BufferPlayerInterface from \"./bufferPlayer/interfaces/BufferPlayerInterface\";\nimport BufferPlayer from \"./bufferPlayer/BufferPlayer\";\nimport BufferFetcherServiceInterface from \"./services/interfaces/BufferFetcherServiceInterface\";\nimport BufferDecoderServiceInterface from \"./services/interfaces/BufferDecoderServiceInterface\";\nimport BufferFetcherService from \"./services/BufferFetcherService\";\nimport BufferDecoderService from \"./services/BufferDecoderService\";\nimport AbstractAudioRenderer from \"./filters/interfaces/AbstractAudioRenderer\";\nimport ReturnAudioRenderer from \"./filters/ReturnAudioRenderer\";\nimport BassBoosterFilter from \"./filters/BassBoosterFilter\";\nimport BitCrusherFilter from \"./filters/BitCrusherFilter\";\nimport EchoFilter from \"./filters/EchoFilter\";\nimport HighPassFilter from \"./filters/HighPassFilter\";\nimport LimiterFilter from \"./filters/LimiterFilter\";\nimport LowPassFilter from \"./filters/LowPassFilter\";\nimport ReverbFilter from \"./filters/ReverbFilter\";\nimport SoundtouchWrapperFilter from \"./filters/SountouchWrapperFilter\";\nimport TelephonizerFilter from \"./filters/TelephonizerFilter\";\nimport VocoderFilter from \"./filters/VocoderFilter\";\nimport PassThroughFilter from \"./filters/PassThroughFilter\";\nimport AbstractAudioFilter from \"./filters/interfaces/AbstractAudioFilter\";\nimport AudioFilterEntrypointInterface from \"./filters/interfaces/AudioFilterEntrypointInterface\";\nimport VoiceRecorderInterface from \"./voiceRecorder/interfaces/VoiceRecorderInterface\";\nimport VoiceRecorder from \"./voiceRecorder/VoiceRecorder\";\n\nconst audioEditorContainer = new Container({ defaultScope: \"Singleton\" });\n\n// Entrypoint filter\naudioEditorContainer.bind<AudioFilterEntrypointInterface>(TYPES.EntryPointFilter).to(SoundtouchWrapperFilter);\n\n// Renderers\naudioEditorContainer.bind<AbstractAudioRenderer>(TYPES.Renderers).to(ReturnAudioRenderer);\n\n// Filters\naudioEditorContainer.bind<AbstractAudioFilter>(TYPES.Filters).toDynamicValue(() => audioEditorContainer.get<AbstractAudioFilter>(TYPES.EntryPointFilter));\naudioEditorContainer.bind<AbstractAudioFilter>(TYPES.Filters).to(BassBoosterFilter);\naudioEditorContainer.bind<AbstractAudioFilter>(TYPES.Filters).to(BitCrusherFilter);\naudioEditorContainer.bind<AbstractAudioFilter>(TYPES.Filters).to(EchoFilter);\naudioEditorContainer.bind<AbstractAudioFilter>(TYPES.Filters).to(HighPassFilter);\naudioEditorContainer.bind<AbstractAudioFilter>(TYPES.Filters).to(LimiterFilter);\naudioEditorContainer.bind<AbstractAudioFilter>(TYPES.Filters).to(LowPassFilter);\naudioEditorContainer.bind<AbstractAudioFilter>(TYPES.Filters).to(ReverbFilter);\naudioEditorContainer.bind<AbstractAudioFilter>(TYPES.Filters).to(TelephonizerFilter);\naudioEditorContainer.bind<AbstractAudioFilter>(TYPES.Filters).to(VocoderFilter);\naudioEditorContainer.bind<AbstractAudioFilter>(TYPES.Filters).to(PassThroughFilter);\n\n// Services\naudioEditorContainer.bind<EventEmitterInterface>(TYPES.EventEmitter).to(EventEmitter);\naudioEditorContainer.bind<AudioContextManagerInterface>(TYPES.AudioContextManager).to(AudioContextManager);\naudioEditorContainer.bind<AudioEditorInterface>(TYPES.AudioEditor).to(AudioEditor);\naudioEditorContainer.bind<AudioProcessorInterface>(TYPES.AudioProcessor).to(AudioProcessor);\naudioEditorContainer.bind<BufferManagerInterface>(TYPES.BufferManager).to(BufferManager);\naudioEditorContainer.bind<FilterManagerInterface>(TYPES.FilterManager).to(FilterManager);\naudioEditorContainer.bind<RendererManagerInterface>(TYPES.RendererManager).to(RendererManager);\naudioEditorContainer.bind<SaveBufferManagerInterface>(TYPES.SaveBufferManager).to(SaveBufferManager);\naudioEditorContainer.bind<BufferPlayerInterface>(TYPES.BufferPlayer).to(BufferPlayer);\naudioEditorContainer.bind<BufferFetcherServiceInterface>(TYPES.BufferFetcherService).to(BufferFetcherService);\naudioEditorContainer.bind<BufferDecoderServiceInterface>(TYPES.BufferDecoderService).to(BufferDecoderService);\naudioEditorContainer.bind<VoiceRecorderInterface>(TYPES.VoiceRecorder).to(VoiceRecorder);\n\nexport { audioEditorContainer };\n","// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n//@ts-ignore\nimport { PitchShifter } from \"soundtouchjs\";\nimport Constants from \"../model/Constants\";\nimport AbstractAudioFilterWorklet from \"./interfaces/AbstractAudioFilterWorklet\";\nimport AudioFilterEntrypointInterface from \"./interfaces/AudioFilterEntrypointInterface\";\nimport { AudioFilterNodes } from \"../model/AudioNodes\";\nimport utils from \"../utils/Functions\";\nimport SoundtouchWrapperFilterWorkletNode from \"./worklets/SoundtouchWrapperFilterWorkletNode\";\nimport SimpleAudioWorkletProcessor from \"../workletPolyfill/SimpleAudioWorkletProcessor\";\nimport SoundtouchSettings from \"../model/filtersSettings/SoundtouchSettings\";\nimport { FilterSettingValue } from \"../model/filtersSettings/FilterSettings\";\nimport utilFunctions from \"../utils/Functions\";\n\nexport default class SoundtouchWrapperFilter extends AbstractAudioFilterWorklet<void> implements AudioFilterEntrypointInterface {\n\n    private speedAudio = 1;\n    private frequencyAudio = 1;\n    private currentSpeedAudio = 1;\n    private currentPitchShifterWorklet: typeof SoundtouchWrapperFilterWorkletNode;\n    private currentPitchShifter: PitchShifter;\n    private isOfflineMode = false;\n\n    constructor() {\n        super();\n        this.setDefaultEnabled(true);\n    }\n\n    async initializeWorklet(): Promise<void> {\n        // Do nothing\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    receiveEvent(message: MessageEvent<void>): void {\n        // Do nothing\n    }\n\n    get workletPath(): string {\n        return Constants.WORKLET_PATHS.SOUNDTOUCH;\n    }\n\n    constructAudioWorkletProcessor(): SimpleAudioWorkletProcessor {\n        throw new Error(\"Method not implemented.\");\n    }\n\n    get workletName(): string {\n        return Constants.WORKLET_NAMES.SOUNDTOUCH;\n    }\n\n    async getEntrypointNode(context: BaseAudioContext, buffer: AudioBuffer, offline: boolean): Promise<AudioFilterNodes> {\n        this.isOfflineMode = offline;\n\n        this.cleanUpOldNodes();\n\n        // In offline (compatibility) mode\n        if (offline) {\n            // If the settings are untouched, we don't use Soundtouch\n            if (!this.isEnabled() || (this.speedAudio == 1 && this.frequencyAudio == 1)) {\n                // Just return an audio buffer source node\n                const bufferSource = context.createBufferSource();\n                bufferSource.buffer = buffer;\n                bufferSource.start();\n\n                return {\n                    input: bufferSource,\n                    output: bufferSource\n                };\n            } else {\n                // If audio worklet is enabled for soundtouch, and if the speed of audio is untouched\n                // Soundtouch Audio Worklet don't support speed editing yet\n                if (this.isAudioWorkletEnabled() && utils.isAudioWorkletCompatible(context) && this.speedAudio == 1) {\n                    return this.renderWithWorklet(buffer, context);\n                } else {\n                    return this.renderWithScriptProcessorNode(buffer, context);\n                }\n            }\n        }\n\n        // Not in offline mode: get classic soundtouch script processor node\n        this.currentPitchShifter = this.getSoundtouchScriptProcessorNode(buffer, context);\n        this.updateState();\n\n        return {\n            input: this.currentPitchShifter,\n            output: this.currentPitchShifter\n        };\n    }\n\n    /** Cleanup old nodes (worklets, pitch shifter) */\n    private cleanUpOldNodes() {\n        // Stop current worklet\n        if (this.currentPitchShifterWorklet) {\n            this.currentPitchShifterWorklet.stop();\n            this.currentPitchShifterWorklet.disconnect();\n        }\n\n        if (this.currentPitchShifter) {\n            this.currentPitchShifter.disconnect();\n            this.currentPitchShifter._filter = null;\n        }\n    }\n\n    private getSoundtouchScriptProcessorNode(buffer: AudioBuffer, context: BaseAudioContext): AudioNode {\n        return new PitchShifter(context, buffer, Constants.SOUNDTOUCH_PITCH_SHIFTER_BUFFER_SIZE);\n    }\n\n    /**\n     * Use script processor node (deprecated) to render the audio buffer with Soundtouch, according to the current settings.\n     * Not working on Firefox\n     * @param buffer Audio buffer\n     * @param context Audio context\n     * @returns A promise resolving to audio nodes with the rendered audio as a buffer source\n     */\n    private async renderWithScriptProcessorNode(buffer: AudioBuffer, context: BaseAudioContext): Promise<AudioFilterNodes> {\n        const durationAudio = utils.calcAudioDuration(buffer, this.speedAudio);\n        const offlineContext = new OfflineAudioContext(2, context.sampleRate * durationAudio, context.sampleRate);\n\n        this.currentPitchShifter = this.getSoundtouchScriptProcessorNode(buffer, offlineContext);\n        this.updateState();\n\n        this.currentPitchShifter.connect(offlineContext.destination);\n\n        const renderedBuffer = await offlineContext.startRendering();\n\n        const bufferSourceRendered = context.createBufferSource();\n        bufferSourceRendered.buffer = renderedBuffer;\n        bufferSourceRendered.start();\n\n        this.cleanUpOldNodes();\n\n        return {\n            input: bufferSourceRendered,\n            output: bufferSourceRendered\n        };\n    }\n\n    /**\n     * EXPERIMENTAL - Use audio worklet to render the audio buffer with Soundtouch, according to the current settings.\n     * Working in Firefox and Chrome\n     * @param buffer Audio buffer\n     * @param context Audio context\n     * @returns A promise resolving to audio nodes with the rendered audio as a buffer source\n     */\n    private async renderWithWorklet(buffer: AudioBuffer, context: BaseAudioContext): Promise<AudioFilterNodes> {\n        const durationAudio = utils.calcAudioDuration(buffer, this.speedAudio);\n\n        try {\n            // Setup worklet JS module\n            await context.audioWorklet.addModule((this.configService ? this.configService.getWorkletBasePath() : \"\") + Constants.WORKLET_PATHS.SOUNDTOUCH);\n\n            // Setup an audio buffer source from the audio buffer\n            const bufferSource = context.createBufferSource();\n            bufferSource.buffer = buffer;\n            bufferSource.start();\n\n            // Create the worklet node\n            this.currentPitchShifterWorklet = new SoundtouchWrapperFilterWorkletNode(context, \"soundtouch-worklet\", {\n                processorOptions: {\n                    bypass: false,\n                    recording: false,\n                    nInputFrames: this.approximateNInputFrames(durationAudio, context),\n                    updateInterval: 10.0,\n                    sampleRate: buffer.sampleRate\n                },\n            });\n\n            // Connect the node for correct rendering\n            bufferSource.connect(this.currentPitchShifterWorklet.node);\n\n            // Setup pitch/speed of Soundtouch\n            if (this.isEnabled()) {\n                await this.currentPitchShifterWorklet.setup(this.speedAudio, this.frequencyAudio);\n            } else {\n                await this.currentPitchShifterWorklet.setup(1, 1);\n            }\n\n            return {\n                input: this.currentPitchShifterWorklet,\n                output: this.currentPitchShifterWorklet\n            };\n        } catch (e) {\n            // Fallback to script processor node\n            console.error(e);\n            return this.renderWithScriptProcessorNode(buffer, context);\n        }\n    }\n\n    private approximateNInputFrames(durationAudio: number, context: BaseAudioContext) {\n        // {frequencyAudio, multiplicator}: {{0.1, 10}, {0.2, 5}, {0.3, 3.33}, {0.4, 2.5}, {0.5, 2}, {0.6, 1.67}, {0.7, 1.43}, {0.8, 1.25}, {0.9, 1.11}, {1, 1}}\n        return durationAudio * context.sampleRate * (Math.round(14 * Math.exp(-4 * this.frequencyAudio)) + 1);\n    }\n\n    get order(): number {\n        return 2;\n    }\n\n    get id(): string {\n        return Constants.FILTERS_NAMES.SOUNDTOUCH;\n    }\n\n    getSettings(): SoundtouchSettings {\n        return {\n            speedAudio: this.speedAudio,\n            frequencyAudio: this.frequencyAudio\n        };\n    }\n\n    protected isAudioWorkletEnabled() {\n        if (this.configService) {\n            return this.configService.isSoundtouchAudioWorkletEnabled();\n        }\n\n        return Constants.ENABLE_SOUNDTOUCH_AUDIO_WORKLET;\n    }\n\n    private getCurrentPitchShifter() {\n        if (this.isOfflineMode) {\n            // If the settings are untouched, we don't use Soundtouch\n            if (this.speedAudio == 1 && this.frequencyAudio == 1) {\n                return null;\n            } else {\n                if (this.isAudioWorkletEnabled() && this.currentPitchShifterWorklet && this.speedAudio == 1) {\n                    return this.currentPitchShifterWorklet;\n                } else {\n                    return this.currentPitchShifter;\n                }\n            }\n        }\n\n        return this.currentPitchShifter;\n    }\n\n    updateState(): void {\n        const pitchShifter = this.getCurrentPitchShifter();\n\n        if (!this.isEnabled()) {\n            if (pitchShifter) {\n                pitchShifter.pitch = 1;\n                pitchShifter.tempo = 1;\n            }\n\n            this.currentSpeedAudio = 1;\n        } else {\n            if (pitchShifter) {\n                pitchShifter.pitch = this.frequencyAudio;\n                pitchShifter.tempo = this.speedAudio;\n            }\n\n            this.currentSpeedAudio = this.speedAudio;\n        }\n    }\n\n    async setSetting(settingId: string, value: FilterSettingValue) {\n        if (!utilFunctions.isSettingValueValid(value)) {\n            return;\n        }\n\n        const valueFloat = parseFloat(value as string);\n\n        switch (settingId) {\n        case \"speedAudio\":\n            this.speedAudio = valueFloat;\n            break;\n        case \"frequencyAudio\":\n            this.frequencyAudio = valueFloat;\n            break;\n        default:\n            break;\n        }\n\n        this.updateState();\n    }\n\n    setEnabled(state: boolean): void {\n        super.setEnabled(state);\n        this.updateState();\n    }\n\n    getSpeed(): number {\n        return this.currentSpeedAudio;\n    }\n}\n","import AbstractAudioRenderer from \"./interfaces/AbstractAudioRenderer\";\nimport Constants from \"../model/Constants\";\n\nexport default class ReturnAudioRenderer extends AbstractAudioRenderer {\n\n    renderAudio(context: BaseAudioContext, buffer: AudioBuffer): Promise<AudioBuffer> {\n        return new Promise(resolve => {\n            const numChannels = buffer.numberOfChannels;\n            const totalFrames = context.sampleRate * buffer.duration + context.sampleRate * 2;\n            const bufferReturned = context.createBuffer(numChannels, totalFrames, context.sampleRate);\n\n            for (let channel = 0; channel < numChannels; channel++) {\n                const nowBuffering = bufferReturned.getChannelData(channel);\n                const sourceChannelData = buffer.getChannelData(channel);\n\n                for (let i = 0; i < totalFrames; i++) {\n                    if (i < sourceChannelData.length) {\n                        nowBuffering[i] = sourceChannelData[sourceChannelData.length - 1 - i];\n                    } else {\n                        nowBuffering[i] = 0;\n                    }\n                }\n            }\n\n            resolve(bufferReturned);\n        });\n    }\n\n    get order(): number {\n        return 0;\n    }\n\n    get id(): string {\n        return Constants.FILTERS_NAMES.RETURN_AUDIO;\n    }\n}\n","import AbstractAudioFilter from \"./interfaces/AbstractAudioFilter\";\nimport Constants from \"../model/Constants\";\nimport BassBoosterSettings from \"../model/filtersSettings/BassBoosterSettings\";\nimport { FilterSettingValue } from \"../model/filtersSettings/FilterSettings\";\nimport utilFunctions from \"../utils/Functions\";\n\nexport default class BassBoosterFilter extends AbstractAudioFilter {\n    private frequencyBooster = 200;\n    private frequencyReduce = 200;\n    private dbBooster = 15;\n    private dbReduce = -2;\n\n    getNode(context: BaseAudioContext) {\n        const bassBoostFilter = context.createBiquadFilter();\n        bassBoostFilter.type = \"lowshelf\";\n        bassBoostFilter.frequency.value = this.frequencyBooster;\n        bassBoostFilter.gain.value = this.dbBooster;\n\n        const bassBoostFilterHighFreq = context.createBiquadFilter();\n        bassBoostFilterHighFreq.type = \"highshelf\";\n        bassBoostFilterHighFreq.frequency.value = this.frequencyReduce;\n        bassBoostFilterHighFreq.gain.value = this.dbReduce;\n        bassBoostFilterHighFreq.connect(bassBoostFilter);\n\n        return {\n            input: bassBoostFilterHighFreq,\n            output: bassBoostFilter\n        };\n    }\n    \n    get order(): number {\n        return 3;\n    }\n\n    get id(): string {\n        return Constants.FILTERS_NAMES.BASS_BOOST;\n    }\n\n    getSettings(): BassBoosterSettings {\n        return {\n            frequencyBooster: this.frequencyBooster,\n            frequencyReduce: this.frequencyReduce,\n            dbBooster: this.dbBooster,\n            dbReduce: this.dbReduce,\n        };\n    }\n\n    async setSetting(settingId: string, value: FilterSettingValue) {\n        if(!utilFunctions.isSettingValueValid(value)) {\n            return;\n        }\n\n        switch(settingId) {\n        case \"frequencyBooster\":\n            this.frequencyBooster = parseInt(value as string);\n            break;\n        case \"frequencyReduce\":\n            this.frequencyReduce = parseInt(value as string);\n            break;\n        case \"dbBooster\":\n            this.dbBooster = parseInt(value as string);\n            break;\n        case \"dbReduce\":\n            this.dbReduce = parseInt(value as string);\n            break;\n        }\n    }\n}\n","import AbstractAudioFilterWorklet from \"./interfaces/AbstractAudioFilterWorklet\";\nimport Constants from \"../model/Constants\";\nimport BitCrusherSettings from \"../model/filtersSettings/BitCrusherSettings\";\nimport { FilterSettingValue } from \"../model/filtersSettings/FilterSettings\";\nimport \"./worklets/BitCrusher.worklet\";\nimport utilFunctions from \"../utils/Functions\";\n\nexport default class BitCrusherFilter extends AbstractAudioFilterWorklet<void> {\n    private bits = 16;\n    private normFreq = 0.9;\n    \n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    receiveEvent(message: MessageEvent<void>): void {\n        // Do nothing\n    }\n\n    get workletPath(): string {\n        return Constants.WORKLET_PATHS.BITCRUSHER;\n    }\n    \n    get workletName(): string {\n        return Constants.WORKLET_NAMES.BITCRUSHER;\n    }\n\n    get order(): number {\n        return 6;\n    }\n\n    get id(): string {\n        return Constants.FILTERS_NAMES.BITCRUSHER;\n    }\n\n    getSettings(): BitCrusherSettings {\n        return {\n            bits: this.bits,\n            normFreq: this.normFreq,\n        };\n    }\n\n    async setSetting(settingId: string, value: FilterSettingValue) {\n        if(!utilFunctions.isSettingValueValid(value)) {\n            return;\n        }\n\n        switch (settingId) {\n        case \"bits\":\n            this.bits = parseInt(value as string);\n            break;\n        case \"normFreq\":\n            this.normFreq = parseFloat(value as string);\n            break;\n        }\n\n        this.applyCurrentSettingsToWorklet();\n    }\n}\n","import AbstractAudioFilter from \"./interfaces/AbstractAudioFilter\";\nimport Constants from \"../model/Constants\";\nimport EchoSettings from \"../model/filtersSettings/EchoSettings\";\nimport { FilterSettingValue } from \"../model/filtersSettings/FilterSettings\";\nimport utilFunctions from \"../utils/Functions\";\n\nexport default class EchoFilter extends AbstractAudioFilter {\n    private delay = 0.2;\n    private gain = 0.75;\n\n    getNode(context: BaseAudioContext) {\n        const delayNode = context.createDelay(179);\n        delayNode.delayTime.value = this.delay;\n\n        const gainNode = context.createGain();\n        gainNode.gain.value = this.gain;\n\n        gainNode.connect(delayNode);\n        delayNode.connect(gainNode);\n\n        return {\n            input: gainNode,\n            output: delayNode\n        };\n    }\n    \n    get order(): number {\n        return 7;\n    }\n\n    get id(): string {\n        return Constants.FILTERS_NAMES.ECHO;\n    }\n\n    getAddingTime() {\n        return 5;\n    }\n\n    getSettings(): EchoSettings {\n        return {\n            delay: this.delay,\n            gain: this.gain\n        };\n    }\n\n    async setSetting(settingId: string, value: FilterSettingValue) {\n        if(!utilFunctions.isSettingValueValid(value)) {\n            return;\n        }\n        \n        switch(settingId) {\n        case \"delay\":\n            this.delay = parseFloat(value as string);\n            break;\n        case \"gain\":\n            this.gain = parseFloat(value as string);\n            break;\n        }\n    }\n}\n","import AbstractAudioFilter from \"./interfaces/AbstractAudioFilter\";\nimport Constants from \"../model/Constants\";\nimport HighPassSettings from \"../model/filtersSettings/HighPassSettings\";\nimport { FilterSettingValue } from \"../model/filtersSettings/FilterSettings\";\nimport utilFunctions from \"../utils/Functions\";\n\nexport default class HighPassFilter extends AbstractAudioFilter {\n    private highFrequency = 3500;\n\n    getNode(context: BaseAudioContext) {\n        const highPassFilter = context.createBiquadFilter();\n        highPassFilter.type = \"highpass\";\n        highPassFilter.frequency.value = this.highFrequency;\n\n        return {\n            input: highPassFilter,\n            output: highPassFilter\n        };\n    }\n    \n    get order(): number {\n        return 4;\n    }\n\n    get id(): string {\n        return Constants.FILTERS_NAMES.HIGH_PASS;\n    }\n\n    getSettings(): HighPassSettings {\n        return {\n            highFrequency: this.highFrequency\n        };\n    }\n\n    async setSetting(settingId: string, value: FilterSettingValue) {\n        if(!utilFunctions.isSettingValueValid(value)) {\n            return;\n        }\n        \n        switch(settingId) {\n        case \"highFrequency\":\n            this.highFrequency = parseInt(value as string);\n            break;\n        }\n    }\n}\n","import AbstractAudioFilterWorklet from \"./interfaces/AbstractAudioFilterWorklet\";\nimport Constants from \"../model/Constants\";\nimport LimiterSettings from \"../model/filtersSettings/LimiterSettings\";\nimport { FilterSettingValue } from \"../model/filtersSettings/FilterSettings\";\nimport \"./worklets/Limiter.worklet\";\nimport utilFunctions from \"../utils/Functions\";\n\nexport default class LimiterFilter extends AbstractAudioFilterWorklet<void> {\n    private preGain = 0; // dB\n    private postGain = 0; // dB\n    private attackTime = 0; // s\n    private releaseTime = 3; // s\n    private threshold = -0.05; // dB\n    private lookAheadTime = 0.1; // s\n\n    constructor() {\n        super();\n        this.keepCurrentNodeIfPossible = true;\n        this.setDefaultEnabled(true);\n    }\n    \n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    receiveEvent(message: MessageEvent<void>): void {\n        // Do nothing\n    }\n\n    get workletPath(): string {\n        return Constants.WORKLET_PATHS.LIMITER;\n    }\n    \n    get workletName(): string {\n        return Constants.WORKLET_NAMES.LIMITER;\n    }\n\n    get order(): number {\n        return 11;\n    }\n\n    get id(): string {\n        return Constants.FILTERS_NAMES.LIMITER;\n    }\n\n    getAddingTime() {\n        return this.lookAheadTime;\n    }\n\n    getSettings(): LimiterSettings {\n        return {\n            preGain: this.preGain,\n            postGain: this.postGain,\n            attackTime: this.attackTime,\n            releaseTime: this.releaseTime,\n            threshold: this.threshold,\n            lookAheadTime: this.lookAheadTime\n        };\n    }\n\n    async setSetting(settingId: string, value: FilterSettingValue) {\n        if(!utilFunctions.isSettingValueValid(value)) {\n            return;\n        }\n        \n        switch (settingId) {\n        case \"preGain\":\n            this.preGain = parseFloat(value as string);\n            break;\n        case \"postGain\":\n            this.postGain = parseFloat(value as string);\n            break;\n        case \"attackTime\":\n            this.attackTime = parseFloat(value as string);\n            break;\n        case \"releaseTime\":\n            this.releaseTime = parseFloat(value as string);\n            break;\n        case \"threshold\":\n            this.threshold = parseFloat(value as string);\n            break;\n        case \"lookAheadTime\":\n            this.lookAheadTime = parseFloat(value as string);\n            break;\n        }\n\n        this.applyCurrentSettingsToWorklet();\n    }\n}\n","import AbstractAudioFilter from \"./interfaces/AbstractAudioFilter\";\nimport Constants from \"../model/Constants\";\nimport LowPassSettings from \"../model/filtersSettings/LowPassSettings\";\nimport { FilterSettingValue } from \"../model/filtersSettings/FilterSettings\";\nimport utilFunctions from \"../utils/Functions\";\n\nexport default class LowPassFilter extends AbstractAudioFilter {\n    private lowFrequency = 3500;\n    \n    getNode(context: BaseAudioContext) {\n        const lowPassFilter = context.createBiquadFilter();\n        lowPassFilter.type = \"lowpass\";\n        lowPassFilter.frequency.value = this.lowFrequency;\n\n        return {\n            input: lowPassFilter,\n            output: lowPassFilter\n        };\n    }\n    \n    get order(): number {\n        return 5;\n    }\n\n    get id(): string {\n        return Constants.FILTERS_NAMES.LOW_PASS;\n    }\n\n    getSettings(): LowPassSettings {\n        return {\n            lowFrequency: this.lowFrequency\n        };\n    }\n\n    async setSetting(settingId: string, value: FilterSettingValue) {\n        if(!utilFunctions.isSettingValueValid(value)) {\n            return;\n        }\n        \n        switch (settingId) {\n        case \"lowFrequency\":\n            this.lowFrequency = parseInt(value as string);\n            break;\n        }\n    }\n}\n","import AbstractAudioFilter from \"./interfaces/AbstractAudioFilter\";\nimport Constants from \"../model/Constants\";\nimport { ReverbEnvironment } from \"../model/ReverbEnvironment\";\nimport ReverbSettings from \"../model/filtersSettings/ReverbSettings\";\nimport GenericSettingValue from \"../model/filtersSettings/GenericSettingValue\";\nimport { FilterSettingValue } from \"../model/filtersSettings/FilterSettings\";\nimport utilFunctions from \"@/utils/Functions\";\n\nexport default class ReverbFilter extends AbstractAudioFilter {\n\n    private reverbEnvironment: ReverbEnvironment = Constants.DEFAULT_REVERB_ENVIRONMENT;\n    private reverbCustomEnvironmentAddTime = 5;\n    private customEnvironment: AudioBuffer | null = null;\n\n    getNode(context: BaseAudioContext) {\n        const convolver = context.createConvolver();\n\n        if (!this.reverbEnvironment || (this.reverbEnvironment.url == \"custom\" && !this.customEnvironment)) {\n            // Fallback to default environment otherwise\n            this.reverbEnvironment = Constants.DEFAULT_REVERB_ENVIRONMENT;\n        }\n\n        const buffer = this.getReverbBuffer(context);\n\n        if (buffer) {\n            convolver.buffer = buffer;\n        }\n\n        return {\n            input: convolver,\n            output: convolver\n        };\n    }\n\n    private getReverbBuffer(context: BaseAudioContext): AudioBuffer | undefined {\n        if (this.reverbEnvironment.url == \"custom\" && this.customEnvironment) {\n            if (this.customEnvironment.sampleRate === context.sampleRate) {\n                return this.customEnvironment;\n            } else {\n                this.reverbEnvironment = Constants.DEFAULT_REVERB_ENVIRONMENT;\n            }\n        } else if (this.bufferFetcherService) {\n            return this.bufferFetcherService.getAudioBuffer(this.reverbEnvironment.url);\n        }\n\n        return;\n    }\n\n    get order(): number {\n        return 9;\n    }\n\n    get id(): string {\n        return Constants.FILTERS_NAMES.REVERB;\n    }\n\n    getAddingTime() {\n        const settings = this.getSettings();\n\n        if (settings && settings.reverbEnvironment) {\n            if (settings.reverbEnvironment.value != \"custom\") {\n                if (settings.reverbEnvironment.additionalData) {\n                    return settings.reverbEnvironment.additionalData.addDuration as number;\n                }\n            } else {\n                return this.reverbCustomEnvironmentAddTime;\n            }\n        }\n\n        return 0;\n    }\n\n    getSettings(): ReverbSettings {\n        if (!this.reverbEnvironment) {\n            return {\n                reverbCustomEnvironmentAddTime: this.reverbCustomEnvironmentAddTime\n            };\n        }\n\n        return {\n            reverbEnvironment: {\n                name: this.reverbEnvironment.name,\n                value: this.reverbEnvironment.url,\n                additionalData: {\n                    size: this.reverbEnvironment.size,\n                    link: this.reverbEnvironment.link,\n                    addDuration: this.reverbEnvironment.addDuration\n                }\n            },\n            downloadedBuffers: this.bufferFetcherService?.getDownloadedBuffersList(),\n            hasCustomEnvironment: this.customEnvironment ? true : false,\n            reverbCustomEnvironmentAddTime: this.reverbCustomEnvironmentAddTime\n        };\n    }\n\n    async setSetting(settingId: string, value: FilterSettingValue) {\n        if (settingId == \"reverbEnvironment\") {\n            const reverbEnvironment = value as GenericSettingValue;\n\n            if (reverbEnvironment) {\n                const url = reverbEnvironment.value;\n\n                try {\n                    if (url != \"custom\") {\n                        await this.bufferFetcherService?.fetchBuffer(url);\n                    }\n\n                    if (reverbEnvironment.additionalData) {\n                        this.reverbEnvironment = {\n                            name: reverbEnvironment.name,\n                            url,\n                            size: reverbEnvironment.additionalData.size as number,\n                            addDuration: reverbEnvironment.additionalData.addDuration as number,\n                            link: reverbEnvironment.additionalData.link as string\n                        };\n                    } else {\n                        this.reverbEnvironment = {\n                            name: reverbEnvironment.name,\n                            url,\n                            size: 0,\n                            addDuration: 0,\n                            link: \"\"\n                        };\n                    }\n                } catch (e) { /* empty */ }\n            }\n        } else if (settingId == \"reverbCustomEnvironmentAddTime\") {\n            if (utilFunctions.isSettingValueValid(value)) {\n                this.reverbCustomEnvironmentAddTime = parseInt(value as string);\n            }\n        } else if (settingId == \"reverbCustomEnvironmentFile\") {\n            if (this.bufferDecoderService && value) {\n                this.customEnvironment = await this.bufferDecoderService.decodeBufferFromFile(value as File);\n\n                if (!this.customEnvironment) {\n                    // Fallback to default environment\n                    this.reverbEnvironment = Constants.DEFAULT_REVERB_ENVIRONMENT;\n                }\n            }\n        }\n    }\n    \n    async bufferFetcherReseted() {\n        const reverbSettings = this.getSettings();\n    \n        if (reverbSettings) {\n            const reverbUrl = (reverbSettings as ReverbSettings).reverbEnvironment?.value;\n    \n            if (reverbUrl && reverbUrl !== \"custom\" && this.bufferFetcherService) {\n                await this.bufferFetcherService.fetchBuffer(reverbUrl);\n                return true;\n            }\n        }\n\n        return false;\n    }\n}\n","import AbstractAudioFilter from \"./interfaces/AbstractAudioFilter\";\nimport Constants from \"../model/Constants\";\nimport { FilterSettingValue } from \"../model/filtersSettings/FilterSettings\";\n\nexport default class BitCrusherFilter extends AbstractAudioFilter {\n\n    getNode(context: BaseAudioContext) {\n        const lpf1 = context.createBiquadFilter();\n        lpf1.type = \"lowpass\";\n        lpf1.frequency.value = 2000.0;\n        const lpf2 = context.createBiquadFilter();\n        lpf2.type = \"lowpass\";\n        lpf2.frequency.value = 2000.0;\n        const hpf1 = context.createBiquadFilter();\n        hpf1.type = \"highpass\";\n        hpf1.frequency.value = 500.0;\n        const hpf2 = context.createBiquadFilter();\n        hpf2.type = \"highpass\";\n        hpf2.frequency.value = 500.0;\n        lpf1.connect(lpf2);\n        lpf2.connect(hpf1);\n        hpf1.connect(hpf2);\n    \n        return {\n            input: lpf1,\n            output: hpf2\n        };\n    }\n    \n    get order(): number {\n        return 7;\n    }\n\n    get id(): string {\n        return Constants.FILTERS_NAMES.TELEPHONIZER;\n    }\n\n    getSettings() {\n        return {};\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    async setSetting(settingId: string, value: FilterSettingValue) { }\n}\n","import AbstractAudioFilter from \"./interfaces/AbstractAudioFilter\";\nimport { AudioFilterNodes } from \"../model/AudioNodes\";\nimport Constants from \"../model/Constants\";\nimport Vocoder from \"../utils/Vocoder\";\nimport VocoderSettings from \"../model/filtersSettings/VocoderSettings\";\nimport utilFunctions from \"../utils/Functions\";\nimport { FilterSettingValue } from \"../model/filtersSettings/FilterSettings\";\n\nexport default class VocoderFilter extends AbstractAudioFilter {\n\n    private currentVocoder: Vocoder | null = null;\n    private modulatorGainValue = 1.0;\n    private carrierSampleGainValue = 0;\n    private oscillatorGainValue = 1.0;\n    private noiseGainValue = 0.2;\n    private oscillatorDetuneValue = 0;\n\n    getNode(context: BaseAudioContext): AudioFilterNodes {\n        const modulatorBuffer = this.bufferFetcherService?.getAudioBuffer(Constants.VOCODER_MODULATOR);\n\n        this.currentVocoder = new Vocoder(context, modulatorBuffer!);\n        this.currentVocoder.init();\n        this.applyCurrentSettingsToVocoder();\n\n        const { modulatorGain, outputGain } = this.currentVocoder.getNodes();\n\n        return {\n            input: modulatorGain!,\n            output: outputGain!\n        };\n    }\n\n    getSettings(): VocoderSettings {\n        return {\n            modulatorGainValue: this.modulatorGainValue,\n            carrierSampleGainValue: this.carrierSampleGainValue,\n            oscillatorGainValue: this.oscillatorGainValue,\n            noiseGainValue: this.noiseGainValue,\n            oscillatorDetuneValue: this.oscillatorDetuneValue\n        };\n    }\n\n    async setSetting(settingId: string, value: FilterSettingValue) {\n        if(!utilFunctions.isSettingValueValid(value)) {\n            return;\n        }\n        \n        switch (settingId) {\n        case \"modulatorGainValue\":\n            this.modulatorGainValue = parseFloat(value as string);\n            break;\n        case \"carrierSampleGainValue\":\n            this.carrierSampleGainValue = parseFloat(value as string);\n            break;\n        case \"oscillatorGainValue\":\n            this.oscillatorGainValue = parseFloat(value as string);\n            break;\n        case \"noiseGainValue\":\n            this.noiseGainValue = parseFloat(value as string);\n            break;\n        case \"oscillatorDetuneValue\":\n            this.oscillatorDetuneValue = parseFloat(value as string);\n            break;\n        }\n\n        this.applyCurrentSettingsToVocoder();\n    }\n\n    private applyCurrentSettingsToVocoder() {\n        if(this.currentVocoder) {\n            this.currentVocoder.updateModGain(this.modulatorGainValue);\n            this.currentVocoder.updateSampleLevel(this.carrierSampleGainValue);\n            this.currentVocoder.updateSynthLevel(this.oscillatorGainValue);\n            this.currentVocoder.updateNoiseLevel(this.noiseGainValue);\n            this.currentVocoder.updateDetuneValue(this.oscillatorDetuneValue);\n        }\n    }\n    \n    get order(): number {\n        return 1;\n    }\n\n    get id(): string {\n        return Constants.FILTERS_NAMES.VOCODER;\n    }\n}\n","import AbstractAudioFilterWorklet from \"./interfaces/AbstractAudioFilterWorklet\";\nimport Constants from \"../model/Constants\";\nimport \"./worklets/Passthrough.worklet\";\nimport { FilterSettingValue } from \"../model/filtersSettings/FilterSettings\";\nimport PassThroughWorkletEvent from \"@/model/PassThroughWorkletEvent\";\nimport { EventType } from \"@/model/EventTypeEnum\";\n\nexport default class PassThroughFilter extends AbstractAudioFilterWorklet<PassThroughWorkletEvent> {\n\n    private currentTime = 0;\n    private lastSampleCount = 0;\n    private samplePerSecond = 0;\n    private currentTimeSamplesPerSecond = 0;\n\n    receiveEvent(message: MessageEvent<PassThroughWorkletEvent>): void {\n        const currentTime = performance.now();\n        const samplesProcessed = message.data.samplesCount;\n\n        if (message.data.command === \"update\") {\n            this.calculatePercentageProcessed(currentTime, samplesProcessed);\n        }\n\n        this.calculateRemainingTimeProcessing(currentTime, samplesProcessed);\n    }\n\n    /**\n     * Calculate percentage processed\n     * @param currentTime Current time (ms)\n     * @param samplesProcessed Samples count processed\n     */\n    private calculatePercentageProcessed(currentTime: number, samplesProcessed: number) {\n        if (this.currentTime === 0) {\n            this.currentTime = currentTime;\n        }\n\n        const timeDifference = currentTime - this.currentTime;\n        const percentageProcessed = (samplesProcessed / this._totalSamples);\n\n        if (this.eventEmitter && timeDifference >= Constants.TREATMENT_TIME_COUNTING_THROTTLE_INTERVAL) {\n            this.eventEmitter.emit(EventType.UPDATE_AUDIO_TREATMENT_PERCENT, percentageProcessed * 100);\n            this.currentTime = currentTime;\n        }\n    }\n\n    /**\n     * Calculate remaining time to process the audio\n     * @param currentTime Current time (ms)\n     * @param samplesProcessed Samples count processed\n     */\n    private calculateRemainingTimeProcessing(currentTime: number, samplesProcessed: number) {\n        if (this.currentTimeSamplesPerSecond === 0) {\n            this.currentTimeSamplesPerSecond = currentTime;\n        }\n\n        const timeDifferenceSamplePerSecond = currentTime - this.currentTimeSamplesPerSecond;\n        const remainingSamples = this._totalSamples - samplesProcessed;\n\n        if (this.eventEmitter && remainingSamples <= 0) {\n            this.eventEmitter.emit(EventType.UPDATE_REMAINING_TIME_ESTIMATED, 0);\n            return;\n        }\n\n        if (this.eventEmitter && timeDifferenceSamplePerSecond >= 1000) {\n            this.calculateSmoothedSamplePerSecond(timeDifferenceSamplePerSecond, samplesProcessed);\n\n            const remainingTimeSeconds = remainingSamples / this.samplePerSecond;\n\n            this.currentTimeSamplesPerSecond = currentTime;\n            this.lastSampleCount = samplesProcessed;\n\n            if (isNaN(remainingTimeSeconds) || !isFinite(remainingTimeSeconds)) {\n                this.eventEmitter.emit(EventType.UPDATE_REMAINING_TIME_ESTIMATED, -1);\n            } else {\n                this.eventEmitter.emit(EventType.UPDATE_REMAINING_TIME_ESTIMATED, remainingTimeSeconds);\n            }\n        }\n    }\n\n    /**\n     * Calculate smoothed samples per second\n     * @param timeDifferenceSamplePerSecond Time difference \n     * @param samplesProcessed Samples count processed\n     * @returns Smoothed samples per second\n     */\n    private calculateSmoothedSamplePerSecond(timeDifferenceSamplePerSecond: number, samplesProcessed: number): void {\n        if (timeDifferenceSamplePerSecond > 0) {\n            const currentSampleRate = (samplesProcessed - this.lastSampleCount) / (timeDifferenceSamplePerSecond / 1000);\n            this.samplePerSecond = (Constants.TREATMENT_TIME_COUNTING_SMOOTHING_FACTOR * currentSampleRate) + ((1 - Constants.TREATMENT_TIME_COUNTING_SMOOTHING_FACTOR) * this.samplePerSecond);\n        }\n    }\n\n    get workletName(): string {\n        return Constants.WORKLET_NAMES.PASSTHROUGH;\n    }\n\n    get workletPath(): string {\n        return Constants.WORKLET_PATHS.PASSTHROUGH;\n    }\n\n    get order(): number {\n        return 10;\n    }\n\n    get id(): string {\n        return Constants.FILTERS_NAMES.PASSTHROUGH;\n    }\n\n    set totalSamples(value: number) {\n        super.totalSamples = value;\n        this.currentTime = 0;\n        this.currentTimeSamplesPerSecond = 0;\n        this.samplePerSecond = 0;\n        this.lastSampleCount = 0;\n    }\n\n    getSettings() {\n        return {};\n    }\n\n    isEnabled(): boolean {\n        return true;\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    async setSetting(settingId: string, value: FilterSettingValue) { }\n}\n","import { injectable } from \"inversify\";\nimport Constants from \"../model/Constants\";\nimport { ConfigService } from \"./interfaces/ConfigService\";\n\n/**\n * Default implementation for a ConfigService, using a built-in map.\n * The configuration is not stored in localstorage in this case.\n */\n@injectable()\nexport default class GenericConfigService implements ConfigService {\n\n    private mapConfig = new Map<string, string>();\n\n    getConfig(key: string): string | undefined | null {\n        return this.mapConfig.get(key);\n    }\n\n    setConfig(key: string, value: string): void {\n        this.mapConfig.set(key, value);\n    }\n\n    isCompatibilityModeEnabled(): boolean {\n        return this.getConfig(Constants.PREFERENCES_KEYS.COMPATIBILITY_MODE_ENABLED) == \"true\";\n    }\n\n    isCompatibilityModeChecked(): boolean {\n        return this.getConfig(Constants.PREFERENCES_KEYS.COMPATIBILITY_MODE_CHECKED) == \"true\";\n    }\n\n    isAudioWorkletEnabled(): boolean {\n        const setting = this.getConfig(Constants.PREFERENCES_KEYS.ENABLE_AUDIO_WORKLET);\n\n        if(setting != null) {\n            return setting == \"true\";\n        }\n\n        return Constants.ENABLE_AUDIO_WORKLET;\n    }\n\n    isSoundtouchAudioWorkletEnabled(): boolean {\n        const setting = this.getConfig(Constants.PREFERENCES_KEYS.ENABLE_SOUNDTOUCH_AUDIO_WORKLET);\n\n        if(setting != null) {\n            return setting == \"true\";\n        }\n\n        return Constants.ENABLE_SOUNDTOUCH_AUDIO_WORKLET;\n    }\n\n    getBufferSize(): number {\n        const setting = this.getConfig(Constants.PREFERENCES_KEYS.BUFFER_SIZE);\n\n        if(setting != null) {\n            return parseInt(setting);\n        }\n\n        return Constants.DEFAULT_BUFFER_SIZE;\n    }\n\n    getSampleRate(): number {\n        const setting = this.getConfig(Constants.PREFERENCES_KEYS.SAMPLE_RATE);\n\n        if(setting != null) {\n            return parseInt(setting);\n        }\n\n        return Constants.DEFAULT_SAMPLE_RATE;\n    }\n\n    getBitrateMP3(): number {\n        const setting = this.getConfig(Constants.PREFERENCES_KEYS.BITRATE_MP3);\n\n        if(setting != null) {\n            return parseInt(setting);\n        }\n\n        return Constants.DEFAULT_MP3_BITRATE;\n    }\n\n    enableCompatibilityMode() {\n        this.setConfig(Constants.PREFERENCES_KEYS.COMPATIBILITY_MODE_ENABLED, \"true\");\n    }\n\n    disableCompatibilityMode() {\n        this.setConfig(Constants.PREFERENCES_KEYS.COMPATIBILITY_MODE_ENABLED, \"false\");\n    }\n\n    getWorkletBasePath(): string {\n        return \"\";\n    }\n\n    getWorkerBasePath(): string {\n        return \"\";\n    }\n\n    getSoundBasePath(): string {\n        return \"\";\n    }\n\n    isInitialRenderingDisabled(): boolean {\n        const setting = this.getConfig(Constants.PREFERENCES_KEYS.DISABLE_INITIAL_RENDERING);\n\n        if(setting != null) {\n            return setting == \"true\";\n        }\n\n        return Constants.DISABLE_INITIAL_RENDERING;\n    }\n};\n","import { TYPES } from \"@/inversify.types\";\nimport AudioEditorInterface from \"@/audioEditor/interfaces/AudioEditorInterface\";\nimport { audioEditorContainer } from \"@/inversify.config\";\nimport { ConfigService } from \"@/services/interfaces/ConfigService\";\nimport EventEmitterInterface from \"./interfaces/EventEmitterInterface\";\nimport BufferPlayerInterface from \"@/bufferPlayer/interfaces/BufferPlayerInterface\";\nimport GenericConfigService from \"@/services/GenericConfigService\";\nimport VoiceRecorderInterface from \"@/voiceRecorder/interfaces/VoiceRecorderInterface\";\n\nexport default class SoundStudioFactory {\n\n    private static ready = false;\n\n    static createAudioEditor(configService?: ConfigService, buffersToFetch?: string[]): AudioEditorInterface {\n        if (!SoundStudioFactory.ready) {\n            if (configService) {\n                audioEditorContainer.bind<ConfigService>(TYPES.ConfigService).toDynamicValue(() => configService);\n            } else {\n                audioEditorContainer.bind<ConfigService>(TYPES.ConfigService).to(GenericConfigService);\n                console.warn(\"No ConfigService provided. Using default generic implementation.\");\n            }\n    \n            audioEditorContainer.bind<string[]>(TYPES.AudioBuffersToFetch).toConstantValue(buffersToFetch || []);\n            SoundStudioFactory.ready = true;\n        }\n\n        return audioEditorContainer.get<AudioEditorInterface>(TYPES.AudioEditor);\n    }\n\n    static createVoiceRecorder(): VoiceRecorderInterface {\n        return audioEditorContainer.get<VoiceRecorderInterface>(TYPES.VoiceRecorder);\n    }\n\n    static getAudioEditorInstance(): AudioEditorInterface | null {\n        return audioEditorContainer.get<AudioEditorInterface>(TYPES.AudioEditor);\n    }\n\n    static getAudioPlayerInstance(): BufferPlayerInterface | null {\n        return audioEditorContainer.get<BufferPlayerInterface>(TYPES.BufferPlayer);\n    }\n\n    static getAudioRecorderInstance(): VoiceRecorderInterface | null {\n        return audioEditorContainer.get<VoiceRecorderInterface>(TYPES.VoiceRecorder);\n    }\n\n    static getEventEmitterInstance(): EventEmitterInterface | null {\n        return audioEditorContainer.get<EventEmitterInterface>(TYPES.EventEmitter);\n    }\n\n    static getConfigServiceInstance(): ConfigService | undefined {\n        return audioEditorContainer.get<ConfigService>(TYPES.ConfigService);\n    }\n}\n"],"names":["Reflect","root","globalThis","global","self","this","Function","_","functionThis","eval","indirectEvalThis","exporter","makeExporter","target","previous","key","value","Object","defineProperty","configurable","writable","hasOwn","prototype","hasOwnProperty","supportsSymbol","Symbol","toPrimitiveSymbol","toPrimitive","iteratorSymbol","iterator","supportsCreate","create","supportsProto","__proto__","Array","downLevel","HashMap","MakeDictionary","has","map","call","get","undefined","functionPrototype","getPrototypeOf","_Map","Map","entries","CreateMapPolyfill","_Set","Set","CreateSetPolyfill","_WeakMap","WeakMap","CreateWeakMapPolyfill","registrySymbol","for","metadataRegistry","GetOrCreateMetadataRegistry","metadataProvider","CreateMetadataProvider","decorate","decorators","propertyKey","attributes","IsUndefined","IsArray","TypeError","IsConstructor","DecorateConstructor","IsObject","IsNull","DecorateProperty","ToPropertyKey","metadata","metadataKey","metadataValue","decorator","IsPropertyKey","OrdinaryDefineOwnMetadata","defineMetadata","hasMetadata","OrdinaryHasMetadata","hasOwnMetadata","OrdinaryHasOwnMetadata","getMetadata","OrdinaryGetMetadata","getOwnMetadata","OrdinaryGetOwnMetadata","getMetadataKeys","OrdinaryMetadataKeys","getOwnMetadataKeys","OrdinaryOwnMetadataKeys","deleteMetadata","provider","GetMetadataProvider","OrdinaryDeleteMetadata","i","length","decorated","descriptor","MetadataKey","O","P","parent","OrdinaryGetPrototypeOf","ToBoolean","MetadataValue","ownKeys","parentKeys","set","keys","_i","ownKeys_1","add","push","_a","parentKeys_1","Type","x","IsSymbol","ToPrimitive","input","PreferredType","hint","exoticToPrim","GetMethod","result","OrdinaryToPrimitive","valueOf","toString_1","toString","IsCallable","argument","ToString","isArray","SameValueZero","y","V","func","GetIterator","obj","method","IteratorValue","iterResult","IteratorStep","next","done","IteratorClose","f","proto","prototypeProto","constructor","CreateMetadataRegistry","fallback","first","second","rest","CreateFallbackProvider","targetProviderMap","registry","registerProvider","getProvider","setProvider","isExtensible","Error","getProviderNoCache","isProviderFor","providerMap","hasProvider","existingProvider","enumerable","targetMetadata","GetOrCreateMetadataMap","Create","createdTargetMetadata","metadataMap","delete","k","nextValue","e","size","reflect","metadataOwner","metadataPropertySet","registeredProvider","cacheSentinel","arraySentinel","MapIterator","values","selector","_index","_keys","_values","_selector","index","throw","error","return","_cacheKey","_cacheIndex","_find","clear","getKey","getValue","getEntry","insert","_map","UUID_SIZE","rootKey","CreateUniqueKey","_key","table","GetOrCreateWeakMapTable","CreateUUID","FillRandomBytes","buffer","Math","random","GenRandomBytes","Uint8Array","array","crypto","getRandomValues","msCrypto","data","offset","byte","toLowerCase","__","factory","NAMED_TAG","NAME_TAG","UNMANAGED_TAG","OPTIONAL_TAG","INJECT_TAG","MULTI_INJECT_TAG","TAGGED","TAGGED_PROP","PARAM_TYPES","POST_CONSTRUCT","PRE_DESTROY","NON_CUSTOM_TAG_KEYS","BindingScopeEnum","Request","Singleton","Transient","BindingTypeEnum","ConstantValue","Constructor","DynamicValue","Factory","Instance","Invalid","Provider","TargetTypeEnum","ClassProperty","ConstructorArgument","Variable","idCounter","id","Binding","serviceIdentifier","scope","activated","type","constraint","request","implementationType","cache","onActivation","onDeactivation","dynamicValue","clone","DUPLICATED_METADATA","NULL_ARGUMENT","KEY_NOT_FOUND","AMBIGUOUS_MATCH","NOT_REGISTERED","MISSING_INJECTABLE_ANNOTATION","MISSING_INJECT_ANNOTATION","CIRCULAR_DEPENDENCY","INVALID_DECORATOR_OPERATION","ARGUMENTS_LENGTH_MISMATCH","arguments","POST_CONSTRUCT_ERROR","clazz","errorMessage","PRE_DESTROY_ERROR","ON_DEACTIVATION_ERROR","STACK_OVERFLOW","MetadataReader","getConstructorMetadata","constructorFunc","compilerGeneratedMetadata","METADATA_KEY.PARAM_TYPES","userGeneratedMetadata","METADATA_KEY.TAGGED","getPropertiesMetadata","METADATA_KEY.TAGGED_PROP","BindingCount","MultipleBindingsAvailable","NoBindingsAvailable","OnlyOneBindingAvailable","isStackOverflowExeption","RangeError","message","ERROR_MSGS.STACK_OVERFLOW","getServiceIdentifierAsString","name","listRegisteredBindingsForServiceIdentifier","container","getBindings","registeredBindingsList","registeredBindings","forEach","binding","getFunctionName","metaData","alreadyDependencyChain","parentRequest","circularDependencyToException","childRequests","childRequest","services","stringArr","_createStringArr","req","reverse","join","dependencyChainToString","ERROR_MSGS.CIRCULAR_DEPENDENCY","name_1","match","Context","addPlan","plan","setCurrentRequest","currentRequest","Metadata","METADATA_KEY.NAMED_TAG","String","Plan","parentContext","rootRequest","LazyServiceIdentifier","cb","_cb","unwrap","QueryableString","str","startsWith","searchString","indexOf","endsWith","reverseString","reverseSearchString","split","contains","equals","compareString","Target","identifier","namedOrTagged","queryableName","slice","metadataItem","hasTag","METADATA_KEY.MULTI_INJECT_TAG","matchesArray","matchesTag","isNamed","isTagged","some","METADATA_KEY.NON_CUSTOM_TAG_KEYS","every","isOptional","METADATA_KEY.OPTIONAL_TAG","getNamedTag","filter","m","getCustomTags","matchesNamedTag","_this","__spreadArray","to","from","pack","ar","l","concat","getTargets","metadataReader","constructorName","isBaseClass","serviceIdentifiers","ERROR_MSGS.MISSING_INJECTABLE_ANNOTATION","constructorArgsMetadata","hasUserDeclaredUnknownInjections","hasOptionalParameters","constructorTargets","iterations","targets","getConstructorArgsAsTarget","getConstructorArgsAsTargets","propertyTargets","getClassPropsAsTargets","formatTargetMetadata","isManaged","unmanaged","injectIdentifier","inject","multiInject","ERROR_MSGS.MISSING_INJECT_ANNOTATION","targetName","_getServiceIdentifierForProperty","propertyName","className","msg","classPropsMetadata","symbolKeys","getOwnPropertySymbols","keys_1","baseConstructor","baseTargets","getBaseClassDependencyCount","t","METADATA_KEY.UNMANAGED_TAG","unmanagedCount","apply","dependencyCount","targetMetadataMap","METADATA_KEY.INJECT_TAG","METADATA_KEY.NAME_TAG","bindings","requestScope","addChildRequest","child","getBindingDictionary","cntnr","_bindingDictionary","_getActiveBindings","avoidConstraints","context","activeBindings","options","autoBindInjectable","bind","toSelf","serviceIdentifierString","ERROR_MSGS.NOT_REGISTERED","m_1","namedTag","otherTags","tag","listMetadataForTarget","ERROR_MSGS.AMBIGUOUS_MATCH","_validateActiveBindingCount","_createSubRequests","thePlan","subChildRequest","dependencies","getDependencies","skipBaseClassChecks","baseClassDependencyCount","ERROR_MSGS.ARGUMENTS_LENGTH_MISMATCH","dependency","bindingDictionary","hasKey","isMultiInject","targetType","injectMetadata","tagMetadata","_createTarget","isPromise","object","then","isPromiseOrContainsPromise","FactoryType","__awaiter","thisArg","_arguments","generator","Promise","resolve","reject","fulfilled","step","rejected","__generator","body","g","label","sent","trys","ops","verb","n","v","op","pop","_saveToRequestScope","_saveToSingletonScope","_saveAsyncResultToSingletonScope","asyncResult","ex_1","__assign","assign","s","p","_createInstance","constr","resolveRequest","resolved","reduce","resolvedRequests","injection","constructorInjections","propertyRequests","propertyInjections","isAsync","_resolveRequests","createInstanceWithInjectionsArg","args","possiblyWaitInjections","createInstanceWithInjections","createInstanceWithInjectionsAsync","instance","r","property","possiblePromiseinjections","injections","possiblePromiseinjections_1","all","_getInstanceAfterPostConstruct","postConstructResult","_b","METADATA_KEY.POST_CONSTRUCT","_postConstruct","_validateInstanceResolution","scopeErrorMessage","METADATA_KEY.PRE_DESTROY","_throwIfHandlingDeactivation","_resolveRequest","targetIsAnArray","targetParentIsNotAnArray","_f","_resolveBinding","_resolveFactoryFromBinding","factoryDetails","factoryType","getFactoryDetails","fn","errorCallback","tryAndThrowErrorIfStackOverflow","_getResolvedFromBinding","boundValue","serviceIdentifierAsString","ERROR_MSGS.INVALID_BINDING_TYPE","ensureFullyBound","resolvedResult","resolveInstance","_resolveInScope","resolveFromBinding","tryGetFromScope","saveToScope","_onActivation","_bindingActivation","containersIterator","_getContainersIterator","containersIteratorResult","context_1","activationsIterator","_getContainerActivationsForService","_activateContainerAsync","_activateContainer","previousResult","activation","resultPromise","activations","_activations","containersStack","nextContainer","traverseAncerstors","taggedConstraint","namedConstraint","typeConstraint","BindingWhenSyntax","_binding","when","BindingOnSyntax","whenTargetNamed","whenTargetIsDefault","whenTargetTagged","whenInjectedInto","whenParentNamed","whenParentTagged","whenAnyAncestorIs","ancestor","whenNoAncestorIs","whenAnyAncestorNamed","whenNoAncestorNamed","whenAnyAncestorTagged","whenNoAncestorTagged","whenAnyAncestorMatches","whenNoAncestorMatches","handler","BindingWhenOnSyntax","_bindingWhenSyntax","_bindingOnSyntax","BindingInSyntax","inRequestScope","inSingletonScope","inTransientScope","BindingInWhenOnSyntax","_bindingInSyntax","BindingToSyntax","toConstantValue","toDynamicValue","toConstructor","toFactory","toFunction","bindingWhenOnSyntax","toAutoFactory","toAutoNamedFactory","named","getNamed","toProvider","toService","service","ContainerSnapshot","of","middleware","deactivations","moduleActivationStore","snapshot","Lookup","getMap","ERROR_MSGS.NULL_ARGUMENT","entry","ERROR_MSGS.KEY_NOT_FOUND","remove","removeIntersection","lookup","traverse","lookupActivations","filteredValues","lookupValue","moduleActivation","_setValue","removeByCondition","condition","removals","updatedEntries","entries_1","copy","b","ModuleActivationStore","moduleId","handlers","_getEmptyHandlersStore","addDeactivation","_getModuleActivationHandlers","onDeactivations","addActivation","onActivations","handlersStore","moduleActivationHandlers","Container","containerOptions","defaultScope","_snapshots","_middleware","_deactivations","_metadataReader","_moduleActivationStore","merge","container1","container2","containers","targetContainers","targetContainer","targetBindingDictionary","destination","load","modules","getHelpers","_getContainerModuleHelpersFactory","modules_1","currentModule","containerModuleHelpers","bindFunction","unbindFunction","isboundFunction","rebindFunction","unbindAsyncFunction","onActivationFunction","onDeactivationFunction","loadAsync","modules_2","unload","module","_removeModuleBindings","_deactivateSingletons","_removeModuleHandlers","unloadAsync","modules_3","module_1","_deactivateSingletonsAsync","rebind","unbind","rebindAsync","unbindAsync","_removeServiceFromDictionary","unbindAll","unbindAllAsync","promises","isBound","bound","isCurrentBound","isBoundNamed","isBoundTagged","request_1","createMockRequest","restore","createChild","applyMiddleware","middlewares","initial","_planAndResolve","prev","curr","applyCustomMetadataReader","getArgs","_getNotAllArgs","_getButThrowIfAsync","getAsync","_get","getTagged","getTaggedAsync","getNamedAsync","getAll","_getAllArgs","getAllAsync","_getAll","getAllTagged","getAllTaggedAsync","getAllNamed","getAllNamedAsync","constructorFunction","_preDestroy","moduleActivationsHandlers","_deactivate","_deactivateContainer","_handleDeactivationError","_propagateContainerDeactivationThenBindingAndPreDestroyAsync","propagateDeactivationResult","_propagateContainerDeactivationThenBindingAndPreDestroy","ex","ERROR_MSGS.ON_DEACTIVATION_ERROR","deactivationsIterator","deactivation","_deactivateContainerAsync","setModuleId","bindingToSyntax","getRebindFunction","getOnActivationFunction","getOnDeactivationFunction","mId","planAndResolveArgs","contextInterceptor","middlewareResult","_deactivateIfSingleton","bindings_1","_bindingDeactivationAndPreDestroy","_bindingDeactivationAndPreDestroyAsync","ERROR_MSGS.CANNOT_UNBIND","tagParameter","annotationTarget","parameterName","parameterIndex","ERROR_MSGS.INVALID_DECORATOR_OPERATION","_throwIfMethodParameter","_tagParameterOrProperty","_ensureNoMetadataKeyDuplicates","metadatas","duplicate","seenValues","array_1","getFirstArrayDuplicate","md","ERROR_MSGS.DUPLICATED_METADATA","paramsOrPropertiesMetadata","paramOrPropertyMetadata","_loop_1","paramOrPropertyMetadata_1","createTaggedDecorator","targetKey","indexOrPropertyDescriptor","tagProperty","injectable","types","injectBase","TYPES","AudioContextManager","AudioEditor","AudioProcessor","BufferManager","FilterManager","RendererManager","SaveBufferManager","ConfigService","EventEmitter","BufferPlayer","BufferDecoderService","BufferFetcherService","AudioBuffersToFetch","Renderers","Filters","EntryPointFilter","VoiceRecorder","__decorate","desc","d","c","getOwnPropertyDescriptor","__param","paramIndex","__metadata","EventType","SuppressedError","Constants","AUDIO_EDITOR","VOICE_RECORDER","BUFFER_PLAYER","AUDIO_CONTEXT_MANAGER","AUDIO_PROCESSOR","BUFFER_MANAGER","FILTER_MANAGER","RENDERER_MANAGER","SAVE_BUFFER_MANAGER","EXPORT_WAV_COMMAND","EXPORT_MP3_COMMAND","AUDIO_WAV","AUDIO_MP3","RECORD_COMMAND","INIT_COMMAND","FILTERS_NAMES","REVERB","ECHO","BASS_BOOST","BITCRUSHER","HIGH_PASS","LIMITER","LOW_PASS","PASSTHROUGH","RETURN_AUDIO","SOUNDTOUCH","TELEPHONIZER","VOCODER","WORKLET_PATHS","RECORDER_WORKLET","WORKLET_NAMES","PREFERENCES_KEYS","COMPATIBILITY_MODE_ENABLED","COMPATIBILITY_MODE_CHECKED","ENABLE_AUDIO_WORKLET","ENABLE_SOUNDTOUCH_AUDIO_WORKLET","BUFFER_SIZE","SAMPLE_RATE","DISABLE_INITIAL_RENDERING","BITRATE_MP3","ENABLE_RECORDER_AUDIO_WORKLET","SOUNDTOUCH_PITCH_SHIFTER_BUFFER_SIZE","DEFAULT_REVERB_ENVIRONMENT","url","addDuration","link","VOCODER_MODULATOR","DEFAULT_BUFFER_SIZE","VALID_BUFFER_SIZE","VALID_MP3_BITRATES","DEFAULT_SAMPLE_RATE","VALID_SAMPLE_RATES","TREATMENT_TIME_COUNTING_THROTTLE_INTERVAL","TREATMENT_TIME_COUNTING_SMOOTHING_FACTOR","DEFAULT_SAVE_FORMAT","DEFAULT_MP3_BITRATE","listeners","on","event","callback","emit","off","eventEmitter","configService","previousSampleRate","setup","getSampleRate","SAMPLE_RATE_CHANGED","currentContext","createNewContext","createNewContextIfNeeded","principalBuffer","isCompatibilityModeEnabled","currentSampleRate","sampleRate","_currentContext","oldAudioContext","destroyOldContext","latencyHint","AudioContext","close","AbstractAudioElement","enabled","defaultEnabled","bufferFetcherService","bufferDecoderService","isEnabled","isDefaultEnabled","setDefaultEnabled","state","enable","disable","setEnabled","toggle","injectDependencies","utilFunctions","calcAudioDuration","audio","speed","duration","loadAudioBuffer","file","arrayBuffer","readAsArrayBufferPromisified","audioBuffer","decodeAudioData","decodeBuffer","reader","FileReader","onload","ev","ArrayBuffer","readAsArrayBuffer","numberOfChannels","resume","newBuffer","createBuffer","sourceChannelData","getChannelData","channel0Data","channel1Data","convertAudioBufferToFloat32Array","channel","convertAudioParamToFloat32Array","param","Float32Array","sumAudioBufferChannel","a","sumAudioBuffer","sum","isAudioWorkletCompatible","audioContext","isSettingValueValid","isNaN","Number","trim","calculateAudioDuration","filterManager","speedAudio","getAddingTime","resetAudioRenderingProgress","UPDATE_AUDIO_TREATMENT_PERCENT","UPDATE_REMAINING_TIME_ESTIMATED","forceDownload","blob","filename","window","document","createElement","URL","createObjectURL","appendChild","href","download","click","revokeObjectURL","rendererManager","contextManager","saveBufferManager","audioProcessor","bufferManager","player","super","bufferPlayer","onBeforePlaying","compatibilityMode","setupOutput","PLAYING_FINISHED","loop","start","addFilters","filters","addRenderers","renderers","defaultDeviceSampleRate","tempContext","loadBufferFromFile","prepareContext","decodeBufferFromFile","initialRenderingDone","sumInputBuffer","utils","loadBuffer","getOutputBuffer","renderedBuffer","renderAudio","isAudioWorkletAvailable","getFiltersState","getRenderersState","getFiltersSettings","reconnectNodesIfNeeded","entrypointFilter","connectNodes","getSpeed","toggleFilter","filterId","toggleRenderer","changeFilterSettings","settings","resetFilterSettings","resetAllFiltersState","resetAllRenderersState","exit","stop","reset","cancelAudioRendering","saveBuffer","downloadingInitialData","order","_renderedBuffer","audioRenderingLastCanceled","inputBuffer","resetBufferFetcher","isInitialRenderingDisabled","loadInitialBuffer","durationAudio","offlineContext","OfflineAudioContext","outputContext","executeAudioRenderers","currentOfflineContext","setupTotalSamples","setupPlayerSpeed","initializeWorklets","currentNodes","output","connect","startRendering","loadRenderedAudio","OFFLINE_AUDIO_RENDERING_FINISHED","setCompatibilityMode","AUDIO_RENDERING_FINISHED","CANCELLED_AND_LOADED_INITIAL_AUDIO","isCompatibilityModeChecked","setCompatibilityModeChecked","enableCompatibilityMode","COMPATIBILITY_MODE_AUTO_ENABLED","RENDERING_AUDIO_PROBLEM_DETECTED","disconnectOldNodes","CANCELLING_AUDIO_PROCESSING","checked","setConfig","audioBuffersToFetch","fetchBuffers","refetch","LOADING_BUFFERS","fetchAllBuffers","LOADED_BUFFERS","LOADING_BUFFERS_ERROR","resetFilterBuffers","entryPointFilter","_entryPointFilter","_currentNodes","initializeDefaultSettings","getSettings","find","setSetting","resetSettings","element","keepCurrentInputOutput","isCompatibilityMode","entrypointNode","entrypointNodes","getEntrypointNode","intermediateNodes","previousNode","sort","node","getNode","updateState","keepCurrentOutput","disconnect","intermediate","isWorklet","initializeWorklet","totalSamples","bufferFetcherReseted","renderer","rendererId","currentBuffer","getRecorderWorker","workerBasePath","Worker","Recorder","cfg","worker","config","bufferLen","numChannels","mimeType","workletBasePath","bitrate","callbacks","getBuffer","exportWAV","exportMP3","recording","source","AudioWorkletNode","port","postMessage","createRecorderNode","command","onmessage","createRecorderWorklet","createRecorderScriptProcessorNode","audioWorklet","addModule","numChannelParameter","parameters","setValueAtTime","onaudioprocess","record","kill","terminate","Recorder$1","_savingBuffer","playingStoppedCallback","PLAYING_STOPPED","recorder","savingResult","saveBufferCompatibilityMode","saveBufferDirect","getWorkerBasePath","downloadAudioBlob","format","rec","getBufferSize","getWorkletBasePath","finishedCallback","downloadBlobCallback","Date","toISOString","savingBuffer","currentTime","displayTime","intervals","playing","onBeforePlayingCallback","currentNode","_contextManager","init","direct","createBufferSource","updateInfos","clearIntervals","interval","clearInterval","PLAYING_STARTED","startTime","performance","now","setInterval","timeNow","nextTime","playDirect","pause","PLAYING_UPDATE","setTimePercent","percent","round","setTime","time","toggleLoop","currentTimeDisplay","trunc","maxTimeDisplay","remainingTimeDisplay","buffers","bufferErrors","fetchBuffer","bufferURI","force","realBufferURI","getSoundBasePath","getKeyFromLocation","FETCHING_BUFFERS","response","fetch","ok","FETCHING_BUFFERS_ERROR","_c","FINISHED_FETCHING_BUFFERS","_d","bufferURIs","uri","getAudioBuffer","getOrFetchAudioBuffer","getDownloadedBuffersList","location","substring","lastIndexOf","DECODING_AUDIO_FILE","DECODED_AUDIO_FILE","console","ERROR_DECODING_AUDIO_FILE","AbstractAudioRenderer","AbstractAudioFilter","defaultSettings","_totalSamples","getDefaultSettings","AudioParamPolyfill","defaultValue","_value","_minValue","_maxValue","MAX_SAFE_INTEGER","_defaultValue","automationRate","newValue","max","min","minValue","maxValue","warn","linearRampToValueAtTime","endTime","exponentialRampToValueAtTime","cancelAndHoldAtTime","cancelTime","cancelScheduledValues","setTargetAtTime","timeConstant","setValueCurveAtTime","WorkletScriptProcessorNodeAdapter","bufferSize","_parameters","_port","workletProcessor","_scriptProcessorNode","createScriptProcessor","setupPort","setupProcessor","setupWorkletScope","messageChannel","MessageChannel","port1","port2","inputArray","Functions","ouputArray","outputBuffer","records","recordsMap","fromEntries","process","descriptors","defaultParameterDescriptors","RegisterProcessorPolyfill","registerProcessor","processorName","processorClass","processorsMap","getProcessor","processor","SimpleAudioWorkletProcessor","inputs","outputs","parameterDescriptors","AudioWorkletProcessor","AbstractAudioFilterWorklet","currentWorkletNode","fallbackToScriptProcessor","keepCurrentNodeIfPossible","workletPath","catch","isAudioWorkletEnabled","initializeNode","workletName","receiveEvent","applyCurrentSettingsToWorklet","currentSettings","settingKey","settingFromWorklet","BitCrusherProcessor","stopped","phaser","last","pow","bits","currentNormFreq","normFreq","fill","blockSize","inp","out","floor","DelayBuffer","_array","readPointer","writePointer","read","LimiterProcessor","delayBuffer","envelopeSample","disabled","getEnvelope","attackTime","releaseTime","attackGain","exp","releaseGain","envelope","envIn","abs","getMaxEnvelope","channels","ampToDB","log10","dBToAmp","db","envelopeData","postGainAmp","postGain","preGainAmp","preGain","lookAheadTime","slope","gainDB","threshold","gain","FifoSampleBuffer","_vector","_position","_frameCount","vector","position","startIndex","frameCount","endIndex","receive","rewind","put","numFrames","putSamples","samples","sourceOffset","numSamples","ensureCapacity","destOffset","subarray","putBuffer","receiveSamples","extract","minLength","parseInt","newVector","ensureAdditionalCapacity","AbstractFifoSamplePipe","createBuffers","_inputBuffer","_outputBuffer","RateTransposer","_rate","rate","slopeCount","prevSampleL","prevSampleR","numFramesOutput","transpose","src","srcOffset","dest","used","srcIndex","FilterSupport","pipe","_pipe","fillInputBuffer","fillOutputBuffer","numInputFrames","noop","SimpleFilter","sourceSound","historyBufferSize","_sourcePosition","outputBufferPosition","newOutputBufferPosition","sourcePosition","onEnd","numFramesExtracted","currentFrames","handleSampleData","_SCAN_OFFSETS","AUTOSEEK_K","Stretch","_quickSeek","midBufferDirty","midBuffer","overlapLength","autoSeqSetting","autoSeekSetting","_tempo","setParameters","clearMidBuffer","sequenceMs","seekWindowMs","overlapMs","calculateSequenceParameters","calculateOverlapLength","tempo","newTempo","intskip","nominalSkip","seekWindowLength","skipFract","sampleReq","seekLength","inputChunkSize","outputChunkSize","overlapInMsec","newOvl","refMidBuffer","checkLimits","mi","ma","seq","seek","AUTOSEQ_AT_MIN","AUTOSEEK_AT_MIN","quickSeek","seekBestOverlapPosition","seekBestOverlapPositionStereoQuick","seekBestOverlapPositionStereo","bestOffset","bestCorrelation","correlation","preCalculateCorrelationReferenceStereo","MIN_VALUE","calculateCrossCorrelationStereo","correlationOffset","tempOffset","scanCount","j","temp","mixingPosition","compare","mixing","calcLength","mixingOffset","overlap","overlapPosition","overlapStereo","inputPosition","outputPosition","tempFrame","frameScale","fi","inputOffset","outputOffset","overlapSkip","testFloatEqual","SoundTouch","transposer","stretch","_intermediateBuffer","virtualPitch","virtualRate","virtualTempo","calculateEffectiveRateAndTempo","rateChange","tempoChange","pitch","pitchOctaves","pitchSemitones","previousTempo","previousRate","WebAudioBufferSource","dualChannel","left","right","minsSecs","secs","mins","width","z","onUpdate","currentTimePlayed","timePlayed","CustomEvent","detail","formattedTimePlayed","percentagePlayed","_node","dispatchEvent","PitchShifter","_soundtouch","_filter","sourcePositionCallback","framesExtracted","getWebAudioNode","sourcePostion","formattedDuration","perc","semitone","toNode","eventName","addEventListener","removeEventListener","soundtouchWrapperFilterWorkletNodeClass","running","_pitch","updateInterval","processorOptions","status","messageProcessor","SoundtouchWrapperFilterWorkletNode","Vocoder","ctx","carrierB","modulatorB","FILTER_QUALITY","FOURIER_SIZE","WAVETABLEBOOST","SAWTOOTHBOOST","oscillatorType","oscillatorDetuneValue","carrierBuffer","modulatorNode","vocoding","modulatorInput","carrierInput","modulatorGain","modulatorGainValue","noiseBuffer","noiseNode","noiseGain","noiseGainValue","carrierSampleNode","carrierSampleGain","carrierSampleGainValue","oscillatorNode","oscillatorGain","oscillatorGainValue","wavetable","wavetableSignalGain","modFilterBands","modFilterPostGains","heterodynes","powers","lpFilters","lpFilterPostGains","carrierBands","carrierFilterPostGains","carrierBandGains","vocoderBands","numVocoderBands","hpFilterGain","outputGain","modulatorBuffer","generateVocoderBands","setupVocoderGraph","vocode","getNodes","synthLevel","shutOffCarrier","selectSawtooth","selectWavetable","setPeriodicWave","updateModGain","updateSampleLevel","updateSynthLevel","updateNoiseLevel","updateDetuneValue","detune","startFreq","endFreq","numBands","centsPerBand","log","LN2","scale","currentFreq","frequency","loadNoiseBuffer","lengthInSamples","bufferData","initBandpassFilters","createGain","waveShaperCurve","n2","hpFilter","createBiquadFilter","Q","rectifierCurve","modulatorFilter","secondModulatorFilter","modulatorFilterPostGain","heterodyneOscillator","createOscillator","heterodyne","heterodynePostGain","rectifier","createWaveShaper","curve","lpFilter","lpFilterPostGain","waveshaper","carrierFilter","secondCarrierFilter","carrierFilterPostGain","bandGain","real","imag","createPeriodicWave","createCarriersAndPlay","PassthroughWorkletProcessor","samplesCount","sample","TimerSaveTime","seconds","incr","initialSeconds","countCallback","count","onCount","stream","alreadyInit","timer","enableAudioFeedback","deviceList","constraints","noiseSuppression","echoCancellation","autoGainControl","ideal","sampleRateConfigNotSupported","isRecordingAvailable","navigator","mediaDevices","getSupportedConstraints","RECORDER_INIT","getUserMedia","RECORDER_COUNT_UPDATE","successCallback","notFoundErrorCallback","unknownErrorCallback","ondevicechange","updateInputList","RECORDER_SUCCESS","RECORDER_ERROR","RECORDER_NOT_FOUND_ERROR","RECORDER_UNKNOWN_ERROR","audioFeedback","RECORDER_UPDATE_CONSTRAINTS","getConstraints","tracks","getTracks","updateConstraints","resetConstraints","newConstraint","precAudioFeedback","precRecording","applyConstraints","newConstraints","newConstraintName","stopStream","createMediaStreamSource","setNoiseSuppression","setAutoGain","setEchoCancellation","devices","enumerateDevices","device","kind","changeInput","deviceId","groupId","RECORDER_RECORDING","RECORDER_STOPPED","RECORDER_PAUSED","RECORDER_RESETED","audioEditorContainer","frequencyAudio","currentSpeedAudio","isOfflineMode","constructAudioWorkletProcessor","offline","cleanUpOldNodes","bufferSource","renderWithWorklet","renderWithScriptProcessorNode","currentPitchShifter","getSoundtouchScriptProcessorNode","currentPitchShifterWorklet","bufferSourceRendered","bypass","nInputFrames","approximateNInputFrames","isSoundtouchAudioWorkletEnabled","getCurrentPitchShifter","pitchShifter","settingId","valueFloat","parseFloat","totalFrames","bufferReturned","nowBuffering","frequencyBooster","frequencyReduce","dbBooster","dbReduce","bassBoostFilter","bassBoostFilterHighFreq","delay","delayNode","createDelay","delayTime","gainNode","highFrequency","highPassFilter","lowFrequency","lowPassFilter","reverbEnvironment","reverbCustomEnvironmentAddTime","customEnvironment","convolver","createConvolver","getReverbBuffer","additionalData","downloadedBuffers","hasCustomEnvironment","reverbSettings","reverbUrl","lpf1","lpf2","hpf1","hpf2","currentVocoder","applyCurrentSettingsToVocoder","lastSampleCount","samplePerSecond","currentTimeSamplesPerSecond","samplesProcessed","calculatePercentageProcessed","calculateRemainingTimeProcessing","timeDifference","percentageProcessed","timeDifferenceSamplePerSecond","remainingSamples","calculateSmoothedSamplePerSecond","remainingTimeSeconds","isFinite","GenericConfigService","mapConfig","getConfig","setting","getBitrateMP3","disableCompatibilityMode","SoundStudioFactory","createAudioEditor","buffersToFetch","ready","createVoiceRecorder","getAudioEditorInstance","getAudioPlayerInstance","getAudioRecorderInstance","getEventEmitterInstance","getConfigServiceInstance"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,44,73]}