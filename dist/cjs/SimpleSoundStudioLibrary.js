"use strict";function e(e,t,r,i){var n,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(s<3?n(a):s>3?n(t,r,a):n(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a}function t(e,t){return function(r,i){t(r,i,e)}}function r(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function i(e,t,r,i){return new(r||(r=Promise))((function(n,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function s(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var a,o={};
/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0
THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.
See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function l(e){return("object"==typeof e&&null!==e||"function"==typeof e)&&"function"==typeof e.then}function u(e){switch(typeof e){case"string":case"symbol":return e.toString();case"function":return e.name;default:throw new Error(`Unexpected ${typeof e} service id type`)}}!function(){return a||(a=1,function(e){!function(){var t="object"==typeof globalThis?globalThis:"object"==typeof n?n:"object"==typeof self?self:"object"==typeof this?this:function(){try{return Function("return this;")()}catch(e){}}()||function(){try{return(0,eval)("(function() { return this; })()")}catch(e){}}(),r=i(e);function i(e,t){return function(r,i){Object.defineProperty(e,r,{configurable:!0,writable:!0,value:i}),t&&t(r,i)}}void 0!==t.Reflect&&(r=i(t.Reflect,r)),function(e,t){var r=Object.prototype.hasOwnProperty,i="function"==typeof Symbol,n=i&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",s=i&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",a="function"==typeof Object.create,o={__proto__:[]}instanceof Array,l=!a&&!o,u={create:a?function(){return he(Object.create(null))}:o?function(){return he({__proto__:null})}:function(){return he({})},has:l?function(e,t){return r.call(e,t)}:function(e,t){return t in e},get:l?function(e,t){return r.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},c=Object.getPrototypeOf(Function),h="function"==typeof Map&&"function"==typeof Map.prototype.entries?Map:le(),f="function"==typeof Set&&"function"==typeof Set.prototype.entries?Set:ue(),d="function"==typeof WeakMap?WeakMap:ce(),_=i?Symbol.for("@reflect-metadata:registry"):void 0,p=ne(),m=se(p);function v(e,t,r,i){if(F(r)){if(!Y(e))throw new TypeError;if(!K(t))throw new TypeError;return B(e,t)}if(!Y(e))throw new TypeError;if(!G(t))throw new TypeError;if(!G(i)&&!F(i)&&!L(i))throw new TypeError;return L(i)&&(i=void 0),T(e,t,r=W(r),i)}function g(e,t){function r(r,i){if(!G(r))throw new TypeError;if(!F(i)&&!z(i))throw new TypeError;N(e,t,r,i)}return r}function b(e,t,r,i){if(!G(r))throw new TypeError;return F(i)||(i=W(i)),N(e,t,r,i)}function E(e,t,r){if(!G(t))throw new TypeError;return F(r)||(r=W(r)),I(e,t,r)}function S(e,t,r){if(!G(t))throw new TypeError;return F(r)||(r=W(r)),P(e,t,r)}function y(e,t,r){if(!G(t))throw new TypeError;return F(r)||(r=W(r)),x(e,t,r)}function A(e,t,r){if(!G(t))throw new TypeError;return F(r)||(r=W(r)),k(e,t,r)}function w(e,t){if(!G(e))throw new TypeError;return F(t)||(t=W(t)),C(e,t)}function R(e,t){if(!G(e))throw new TypeError;return F(t)||(t=W(t)),O(e,t)}function M(e,t,r){if(!G(t))throw new TypeError;if(F(r)||(r=W(r)),!G(t))throw new TypeError;F(r)||(r=W(r));var i=oe(t,r,!1);return!F(i)&&i.OrdinaryDeleteMetadata(e,t,r)}function B(e,t){for(var r=e.length-1;r>=0;--r){var i=(0,e[r])(t);if(!F(i)&&!L(i)){if(!K(i))throw new TypeError;t=i}}return t}function T(e,t,r,i){for(var n=e.length-1;n>=0;--n){var s=(0,e[n])(t,r,i);if(!F(s)&&!L(s)){if(!G(s))throw new TypeError;i=s}}return i}function I(e,t,r){if(P(e,t,r))return!0;var i=re(t);return!L(i)&&I(e,i,r)}function P(e,t,r){var i=oe(t,r,!1);return!F(i)&&j(i.OrdinaryHasOwnMetadata(e,t,r))}function x(e,t,r){if(P(e,t,r))return k(e,t,r);var i=re(t);return L(i)?void 0:x(e,i,r)}function k(e,t,r){var i=oe(t,r,!1);if(!F(i))return i.OrdinaryGetOwnMetadata(e,t,r)}function N(e,t,r,i){oe(r,i,!0).OrdinaryDefineOwnMetadata(e,t,r,i)}function C(e,t){var r=O(e,t),i=re(e);if(null===i)return r;var n=C(i,t);if(n.length<=0)return r;if(r.length<=0)return n;for(var s=new f,a=[],o=0,l=r;o<l.length;o++){var u=l[o];s.has(u)||(s.add(u),a.push(u))}for(var c=0,h=n;c<h.length;c++){u=h[c];s.has(u)||(s.add(u),a.push(u))}return a}function O(e,t){var r=oe(e,t,!1);return r?r.OrdinaryOwnMetadataKeys(e,t):[]}function D(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function F(e){return void 0===e}function L(e){return null===e}function V(e){return"symbol"==typeof e}function G(e){return"object"==typeof e?null!==e:"function"==typeof e}function U(e,t){switch(D(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var r="string",i=Q(e,n);if(void 0!==i){var s=i.call(e,r);if(G(s))throw new TypeError;return s}return H(e)}function H(e,t){var r,i,n=e.toString;if(X(n)&&!G(i=n.call(e)))return i;if(X(r=e.valueOf)&&!G(i=r.call(e)))return i;throw new TypeError}function j(e){return!!e}function q(e){return""+e}function W(e){var t=U(e);return V(t)?t:q(t)}function Y(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function X(e){return"function"==typeof e}function K(e){return"function"==typeof e}function z(e){switch(D(e)){case 3:case 4:return!0;default:return!1}}function Z(e,t){return e===t||e!=e&&t!=t}function Q(e,t){var r=e[t];if(null!=r){if(!X(r))throw new TypeError;return r}}function $(e){var t=Q(e,s);if(!X(t))throw new TypeError;var r=t.call(e);if(!G(r))throw new TypeError;return r}function J(e){return e.value}function ee(e){var t=e.next();return!t.done&&t}function te(e){var t=e.return;t&&t.call(e)}function re(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===c)return t;if(t!==c)return t;var r=e.prototype,i=r&&Object.getPrototypeOf(r);if(null==i||i===Object.prototype)return t;var n=i.constructor;return"function"!=typeof n||n===e?t:n}function ie(){var e,r,i,n;F(_)||void 0===t.Reflect||_ in t.Reflect||"function"!=typeof t.Reflect.defineMetadata||(e=ae(t.Reflect));var s=new d,a={registerProvider:o,getProvider:u,setProvider:p};return a;function o(t){if(!Object.isExtensible(a))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===t:break;case F(r):r=t;break;case r===t:break;case F(i):i=t;break;case i===t:break;default:void 0===n&&(n=new f),n.add(t)}}function l(t,s){if(!F(r)){if(r.isProviderFor(t,s))return r;if(!F(i)){if(i.isProviderFor(t,s))return r;if(!F(n))for(var a=$(n);;){var o=ee(a);if(!o)return;var l=J(o);if(l.isProviderFor(t,s))return te(a),l}}}if(!F(e)&&e.isProviderFor(t,s))return e}function u(e,t){var r,i=s.get(e);return F(i)||(r=i.get(t)),F(r)?(F(r=l(e,t))||(F(i)&&(i=new h,s.set(e,i)),i.set(t,r)),r):r}function c(e){if(F(e))throw new TypeError;return r===e||i===e||!F(n)&&n.has(e)}function p(e,t,r){if(!c(r))throw new Error("Metadata provider not registered.");var i=u(e,t);if(i!==r){if(!F(i))return!1;var n=s.get(e);F(n)&&(n=new h,s.set(e,n)),n.set(t,r)}return!0}}function ne(){var e;return!F(_)&&G(t.Reflect)&&Object.isExtensible(t.Reflect)&&(e=t.Reflect[_]),F(e)&&(e=ie()),!F(_)&&G(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,_,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}function se(e){var t=new d,r={isProviderFor:function(e,r){var i=t.get(e);return!F(i)&&i.has(r)},OrdinaryDefineOwnMetadata:a,OrdinaryHasOwnMetadata:n,OrdinaryGetOwnMetadata:s,OrdinaryOwnMetadataKeys:o,OrdinaryDeleteMetadata:l};return p.registerProvider(r),r;function i(i,n,s){var a=t.get(i),o=!1;if(F(a)){if(!s)return;a=new h,t.set(i,a),o=!0}var l=a.get(n);if(F(l)){if(!s)return;if(l=new h,a.set(n,l),!e.setProvider(i,n,r))throw a.delete(n),o&&t.delete(i),new Error("Wrong provider for target.")}return l}function n(e,t,r){var n=i(t,r,!1);return!F(n)&&j(n.has(e))}function s(e,t,r){var n=i(t,r,!1);if(!F(n))return n.get(e)}function a(e,t,r,n){i(r,n,!0).set(e,t)}function o(e,t){var r=[],n=i(e,t,!1);if(F(n))return r;for(var s=$(n.keys()),a=0;;){var o=ee(s);if(!o)return r.length=a,r;var l=J(o);try{r[a]=l}catch(e){try{te(s)}finally{throw e}}a++}}function l(e,r,n){var s=i(r,n,!1);if(F(s))return!1;if(!s.delete(e))return!1;if(0===s.size){var a=t.get(r);F(a)||(a.delete(n),0===a.size&&t.delete(a))}return!0}}function ae(e){var t=e.defineMetadata,r=e.hasOwnMetadata,i=e.getOwnMetadata,n=e.getOwnMetadataKeys,s=e.deleteMetadata,a=new d,o={isProviderFor:function(e,t){var r=a.get(e);return!(F(r)||!r.has(t))||!!n(e,t).length&&(F(r)&&(r=new f,a.set(e,r)),r.add(t),!0)},OrdinaryDefineOwnMetadata:t,OrdinaryHasOwnMetadata:r,OrdinaryGetOwnMetadata:i,OrdinaryOwnMetadataKeys:n,OrdinaryDeleteMetadata:s};return o}function oe(e,t,r){var i=p.getProvider(e,t);if(!F(i))return i;if(r){if(p.setProvider(e,t,m))return m;throw new Error("Illegal state.")}}function le(){var e={},t=[],r=function(){function e(e,t,r){this._index=0,this._keys=e,this._values=t,this._selector=r}return e.prototype["@@iterator"]=function(){return this},e.prototype[s]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var r=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:r,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var r=this._find(e,!0);return this._values[r]=t,this},t.prototype.delete=function(t){var r=this._find(t,!1);if(r>=0){for(var i=this._keys.length,n=r+1;n<i;n++)this._keys[n-1]=this._keys[n],this._values[n-1]=this._values[n];return this._keys.length--,this._values.length--,Z(t,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new r(this._keys,this._values,i)},t.prototype.values=function(){return new r(this._keys,this._values,n)},t.prototype.entries=function(){return new r(this._keys,this._values,a)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[s]=function(){return this.entries()},t.prototype._find=function(e,t){if(!Z(this._cacheKey,e)){this._cacheIndex=-1;for(var r=0;r<this._keys.length;r++)if(Z(this._keys[r],e)){this._cacheIndex=r;break}}return this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function i(e,t){return e}function n(e,t){return t}function a(e,t){return[e,t]}}function ue(){return function(){function e(){this._map=new h}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.keys()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[s]=function(){return this.keys()},e}()}function ce(){var e=16,t=u.create(),i=n();return function(){function e(){this._key=n()}return e.prototype.has=function(e){var t=s(e,!1);return void 0!==t&&u.has(t,this._key)},e.prototype.get=function(e){var t=s(e,!1);return void 0!==t?u.get(t,this._key):void 0},e.prototype.set=function(e,t){return s(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=s(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=n()},e}();function n(){var e;do{e="@@WeakMap@@"+l()}while(u.has(t,e));return t[e]=!0,e}function s(e,t){if(!r.call(e,i)){if(!t)return;Object.defineProperty(e,i,{value:u.create()})}return e[i]}function a(e,t){for(var r=0;r<t;++r)e[r]=255*Math.random()|0;return e}function o(e){if("function"==typeof Uint8Array){var t=new Uint8Array(e);return"undefined"!=typeof crypto?crypto.getRandomValues(t):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(t):a(t,e),t}return a(new Array(e),e)}function l(){var t=o(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var r="",i=0;i<e;++i){var n=t[i];4!==i&&6!==i&&8!==i||(r+="-"),n<16&&(r+="0"),r+=n.toString(16).toLowerCase()}return r}}function he(e){return e.__=void 0,delete e.__,e}e("decorate",v),e("metadata",g),e("defineMetadata",b),e("hasMetadata",E),e("hasOwnMetadata",S),e("getMetadata",y),e("getOwnMetadata",A),e("getMetadataKeys",w),e("getOwnMetadataKeys",R),e("deleteMetadata",M)}(r,t),void 0===t.Reflect&&(t.Reflect=e)}()}(e||(e={}))),o;var e}();const c=Symbol.for("@inversifyjs/common/islazyServiceIdentifier");class h{[c];#e;constructor(e){this.#e=e,this[c]=!0}static is(e){return"object"==typeof e&&null!==e&&!0===e[c]}unwrap(){return this.#e()}}function f(e,t){return Reflect.getOwnMetadata(t,e)}function d(e,t,r){Reflect.defineMetadata(t,r,e)}function _(e,t,r,i){const n=i(f(e,t)??r());Reflect.defineMetadata(t,n,e)}const p="@inversifyjs/container/bindingId";function m(){const e=f(Object,p)??0;return e===Number.MAX_SAFE_INTEGER?d(Object,p,Number.MIN_SAFE_INTEGER):_(Object,p,(()=>e),(e=>e+1)),e}const v="Request",g="Singleton",b="Transient",E="ConstantValue",S="DynamicValue",y="Factory",A="Instance",w="Provider",R="ResolvedValue",M="ServiceRedirection";function*B(...e){for(const t of e)yield*t}class T{#e;#t;#r;constructor(e){this.#e=new Map,this.#t={};for(const t of Reflect.ownKeys(e))this.#t[t]=new Map;this.#r=e}add(e,t){this.#i(e).push(t);for(const r of Reflect.ownKeys(t))this.#n(r,t[r]).push(e)}clone(){const e=Reflect.ownKeys(this.#r),t=new T(this.#r);this.#s(this.#e,t.#e);for(const r of e)this.#s(this.#t[r],t.#t[r]);return t}get(e,t){return this.#t[e].get(t)}getAllKeys(e){return this.#t[e].keys()}removeByRelation(e,t){const r=this.get(e,t);if(void 0===r)return;const i=new Set(r);for(const r of i){const i=this.#e.get(r);if(void 0===i)throw new Error("Expecting model relation, none found");for(const n of i)n[e]===t&&this.#a(r,n);this.#e.delete(r)}}#i(e){let t=this.#e.get(e);return void 0===t&&(t=[],this.#e.set(e,t)),t}#n(e,t){let r=this.#t[e].get(t);return void 0===r&&(r=[],this.#t[e].set(t,r)),r}#s(e,t){for(const[r,i]of e)t.set(r,[...i])}#a(e,t){for(const r of Reflect.ownKeys(t))this.#o(e,r,t[r])}#o(e,t,r){const i=this.#t[t].get(r);if(void 0!==i){const n=i.indexOf(e);-1!==n&&i.splice(n,1),0===i.length&&this.#t[t].delete(r)}}}var I,P,x;!function(e){e.moduleId="moduleId",e.serviceId="serviceId"}(I||(I={}));class k{#l;#u;constructor(e,t){this.#l=t??new T({moduleId:{isOptional:!0},serviceId:{isOptional:!1}}),this.#u=e}static build(e){return new k(e)}add(e,t){this.#l.add(e,t)}clone(){return new k(this.#u,this.#l.clone())}get(e){const t=[],r=this.#l.get(I.serviceId,e);void 0!==r&&t.push(r);const i=this.#u?.get(e);if(void 0!==i&&t.push(i),0!==t.length)return B(...t)}removeAllByModuleId(e){this.#l.removeByRelation(I.moduleId,e)}removeAllByServiceId(e){this.#l.removeByRelation(I.serviceId,e)}}!function(e){e.id="id",e.moduleId="moduleId",e.serviceId="serviceId"}(P||(P={}));class N{#c;#u;constructor(e,t){this.#c=t??new T({id:{isOptional:!1},moduleId:{isOptional:!0},serviceId:{isOptional:!1}}),this.#u=e}static build(e){return new N(e)}clone(){return new N(this.#u,this.#c.clone())}get(e){return this.getNonParentBindings(e)??this.#u?.get(e)}getById(e){return this.#c.get(P.id,e)??this.#u?.getById(e)}getByModuleId(e){return this.#c.get(P.moduleId,e)??this.#u?.getByModuleId(e)}getNonParentBindings(e){return this.#c.get(P.serviceId,e)}getNonParentBoundServices(){return this.#c.getAllKeys(P.serviceId)}removeById(e){this.#c.removeByRelation(P.id,e)}removeAllByModuleId(e){this.#c.removeByRelation(P.moduleId,e)}removeAllByServiceId(e){this.#c.removeByRelation(P.serviceId,e)}set(e){const t={[P.id]:e.id,[P.serviceId]:e.serviceIdentifier};void 0!==e.moduleId&&(t[P.moduleId]=e.moduleId),this.#c.add(e,t)}}!function(e){e.moduleId="moduleId",e.serviceId="serviceId"}(x||(x={}));class C{#h;#u;constructor(e,t){this.#h=t??new T({moduleId:{isOptional:!0},serviceId:{isOptional:!1}}),this.#u=e}static build(e){return new C(e)}add(e,t){this.#h.add(e,t)}clone(){return new C(this.#u,this.#h.clone())}get(e){const t=[],r=this.#h.get(x.serviceId,e);void 0!==r&&t.push(r);const i=this.#u?.get(e);if(void 0!==i&&t.push(i),0!==t.length)return B(...t)}removeAllByModuleId(e){this.#h.removeByRelation(x.moduleId,e)}removeAllByServiceId(e){this.#h.removeByRelation(x.serviceId,e)}}const O="@inversifyjs/core/classMetadataReflectKey";function D(){return{constructorArguments:[],lifecycle:{postConstructMethodName:void 0,preDestroyMethodName:void 0},properties:new Map,scope:void 0}}const F="@inversifyjs/core/pendingClassMetadataCountReflectKey",L=Symbol.for("@inversifyjs/core/InversifyCoreError");let V=class e extends Error{[L];kind;constructor(e,t,r){super(t,r),this[L]=!0,this.kind=e}static is(e){return"object"==typeof e&&null!==e&&!0===e[L]}static isErrorOfKind(t,r){return e.is(t)&&t.kind===r}};var G,U,H;function j(e){const t=f(e,O)??D();if(!function(e){const t=f(e,F);return void 0!==t&&0!==t}(e))return function(e,t){const r=[];if(t.length<e.length)throw new V(G.missingInjectionDecorator,`Found unexpected missing metadata on type "${e.name}". "${e.name}" constructor requires at least ${e.length.toString()} arguments, found ${t.length.toString()} instead.\nAre you using @inject, @multiInject or @unmanaged decorators in every non optional constructor argument?\n\nIf you're using typescript and want to rely on auto injection, set "emitDecoratorMetadata" compiler option to true`);for(let e=0;e<t.length;++e)void 0===t[e]&&r.push(e);if(r.length>0)throw new V(G.missingInjectionDecorator,`Found unexpected missing metadata on type "${e.name}" at constructor indexes "${r.join('", "')}".\n\nAre you using @inject, @multiInject or @unmanaged decorators at those indexes?\n\nIf you're using typescript and want to rely on auto injection, set "emitDecoratorMetadata" compiler option to true`)}(e,t.constructorArguments),t;!function(e,t){const r=[];for(let i=0;i<t.constructorArguments.length;++i){const n=t.constructorArguments[i];void 0!==n&&n.kind!==U.unknown||r.push(`  - Missing or incomplete metadata for type "${e.name}" at constructor argument with index ${i.toString()}.\nEvery constructor parameter must be decorated either with @inject, @multiInject or @unmanaged decorator.`)}for(const[i,n]of t.properties)n.kind===U.unknown&&r.push(`  - Missing or incomplete metadata for type "${e.name}" at property "${i.toString()}".\nThis property must be decorated either with @inject or @multiInject decorator.`);if(0===r.length)throw new V(G.unknown,`Unexpected class metadata for type "${e.name}" with uncompletion traces.\nThis might be caused by one of the following reasons:\n\n1. A third party library is targeting inversify reflection metadata.\n2. A bug is causing the issue. Consider submiting an issue to fix it.`);throw new V(G.missingInjectionDecorator,`Invalid class metadata at type ${e.name}:\n\n${r.join("\n\n")}`)}(e,t)}function q(){return 0}function W(e){return t=>{void 0!==t&&t.kind===U.unknown&&_(e,F,q,(e=>e-1))}}!function(e){e[e.injectionDecoratorConflict=0]="injectionDecoratorConflict",e[e.missingInjectionDecorator=1]="missingInjectionDecorator",e[e.planning=2]="planning",e[e.resolution=3]="resolution",e[e.unknown=4]="unknown"}(G||(G={})),function(e){e[e.unknown=32]="unknown"}(U||(U={})),function(e){e[e.multipleInjection=0]="multipleInjection",e[e.singleInjection=1]="singleInjection",e[e.unmanaged=2]="unmanaged"}(H||(H={}));const Y=function(e,t){return(...r)=>i=>{if(void 0===i)return e(...r);if(i.kind===H.unmanaged)throw new V(G.injectionDecoratorConflict,"Unexpected injection found. Multiple @inject, @multiInject or @unmanaged decorators found");return t(i,...r)}}((function(e,t){return{kind:e,name:void 0,optional:!1,tags:new Map,value:t}}),(function(e,t,r){return function(e){if(e.kind!==U.unknown&&!0!==e.isFromTypescriptParamType)throw new V(G.injectionDecoratorConflict,"Unexpected injection found. Multiple @inject, @multiInject or @unmanaged decorators found")}(e),{...e,kind:t,value:r}}));function X(e,t){return r=>{const i=r.properties.get(t);return r.properties.set(t,e(i)),r}}var K;function z(e,t,r,i){if(V.isErrorOfKind(i,G.injectionDecoratorConflict)){const n=function(e,t,r){if(void 0===r){if(void 0===t)throw new V(G.unknown,"Unexpected undefined property and index values");return{kind:K.property,property:t,targetClass:e.constructor}}return"number"==typeof r?{index:r,kind:K.parameter,targetClass:e}:{kind:K.method,method:t,targetClass:e}}(e,t,r);throw new V(G.injectionDecoratorConflict,`Unexpected injection error.\n\nCause:\n\n${i.message}\n\nDetails\n\n${function(e){switch(e.kind){case K.method:return`[class: "${e.targetClass.name}", method: "${e.method.toString()}"]`;case K.parameter:return`[class: "${e.targetClass.name}", index: "${e.index.toString()}"]`;case K.property:return`[class: "${e.targetClass.name}", property: "${e.property.toString()}"]`}}(n)}`,{cause:i})}throw i}function Z(e,t){return(r,i,n)=>{try{void 0===n?function(e,t){const r=Q(e,t);return(e,t)=>{_(e.constructor,O,D,X(r(e),t))}}(e,t)(r,i):"number"==typeof n?function(e,t){const r=Q(e,t);return(e,t,i)=>{if(!function(e,t){return"function"==typeof e&&void 0===t}(e,t))throw new V(G.injectionDecoratorConflict,`Found an @inject decorator in a non constructor parameter.\nFound @inject decorator at method "${t?.toString()??""}" at class "${e.constructor.name}"`);_(e,O,D,function(e,t){return r=>{const i=r.constructorArguments[t];return r.constructorArguments[t]=e(i),r}}(r(e),i))}}(e,t)(r,i,n):function(e,t){const r=Q(e,t);return(e,t,i)=>{if(!function(e){return void 0!==e.set}(i))throw new V(G.injectionDecoratorConflict,`Found an @inject decorator in a non setter property method.\nFound @inject decorator at method "${t.toString()}" at class "${e.constructor.name}"`);_(e.constructor,O,D,X(r(e),t))}}(e,t)(r,i,n)}catch(e){z(r,i,n,e)}}}function Q(e,t){return r=>{const i=t(r);return t=>(i(t),e(t))}}function $(e){return Z(Y(H.singleInjection,e),W)}!function(e){e[e.method=0]="method",e[e.parameter=1]="parameter",e[e.property=2]="property"}(K||(K={}));const J="@inversifyjs/core/classIsInjectableFlagReflectKey",ee=[Array,BigInt,Boolean,Function,Number,Object,String];function te(e){return e=>{!function(e){if(void 0!==f(e,J))throw new V(G.injectionDecoratorConflict,`Cannot apply @injectable decorator multiple times at class "${e.name}"`);d(e,J,!0)}(e),function(e){const t=f(e,"design:paramtypes");void 0!==t&&_(e,O,D,function(e){return t=>(e.forEach(((e,r)=>{var i;void 0!==t.constructorArguments[r]||(i=e,ee.includes(i))||(t.constructorArguments[r]=function(e){return{isFromTypescriptParamType:!0,kind:H.singleInjection,name:void 0,optional:!1,tags:new Map,value:e}}(e))})),t)}(t))}(e)}}function re(e,t,r){let i;return e.extendConstructorArguments??1?(i=[...t.constructorArguments],r.constructorArguments.map(((e,t)=>{i[t]=e}))):i=r.constructorArguments,i}function ie(e,t,r){let i;return i=e.extendProperties??1?new Map(B(t.properties,r.properties)):r.properties,i}function ne(e){return t=>{const r=function(e){const t=Object.getPrototypeOf(e.prototype),r=t?.constructor;return r}(t);if(void 0===r)throw new V(G.injectionDecoratorConflict,`Expected base type for type "${t.name}", none found.`);!function(e){return t=>{const r=j(e.type);_(t,O,D,function(e,t){return r=>({constructorArguments:re(e,t,r),lifecycle:r.lifecycle,properties:ie(e,t,r),scope:r.scope})}(e,r))}}({...e,type:r})(t)}}function se(e){return Z(Y(H.multipleInjection,e),W)}function ae(){return(e,t,r)=>{try{_(e.constructor,O,D,(i=t,e=>{if(void 0!==e.lifecycle.postConstructMethodName)throw new V(G.injectionDecoratorConflict,"Unexpected duplicated postConstruct decorator");return e.lifecycle.postConstructMethodName=i,e}))}catch(r){z(e,t,void 0,r)}var i}}var oe,le;!function(e){e[e.multipleInjection=0]="multipleInjection",e[e.singleInjection=1]="singleInjection"}(oe||(oe={}));class ue{#f;constructor(e){this.#f=e}get name(){return this.#f.elem.name}get serviceIdentifier(){return this.#f.elem.serviceIdentifier}get tags(){return this.#f.elem.tags}getAncestor(){if(void 0!==this.#f.previous)return new ue(this.#f.previous)}}class ce{last;constructor(e){this.last=e}concat(e){return new ce({elem:e,previous:this.last})}[Symbol.iterator](){let e=this.last;return{next:()=>{if(void 0===e)return{done:!0,value:void 0};const t=e.elem;return e=e.previous,{done:!1,value:t}}}}}function he(e,t,r){const i=r?.customServiceIdentifier??t.serviceIdentifier,n=[...e.getBindings(i)??[]].filter((e=>e.isSatisfiedBy(t)));if(0===n.length&&void 0!==e.autobindOptions&&"function"==typeof i){const t=function(e,t){const r=j(t).scope??e.scope;return{cache:{isRight:!1,value:void 0},id:m(),implementationType:t,isSatisfiedBy:()=>!0,moduleId:void 0,onActivation:void 0,onDeactivation:void 0,scope:r,serviceIdentifier:t,type:A}}(e.autobindOptions,i);e.setBinding(t),n.push(t)}return n}function fe(e){return void 0!==e.redirections}function de(e,t,r,i){let n,s;fe(r)?(n=r.binding.targetServiceIdentifier,s=r.binding.serviceIdentifier):(n=r.serviceIdentifier,s=r.parent?.binding.serviceIdentifier),Array.isArray(e)?function(e,t,r,i,n){if(0!==e.length){const t=`Ambiguous bindings found for service: "${u(r)}".\n\nRegistered bindings:\n\n${e.map((e=>function(e){switch(e.type){case A:return`[ type: "${e.type}", serviceIdentifier: "${u(e.serviceIdentifier)}", scope: "${e.scope}", implementationType: "${e.implementationType.name}" ]`;case M:return`[ type: "${e.type}", serviceIdentifier: "${u(e.serviceIdentifier)}", redirection: "${u(e.targetServiceIdentifier)}" ]`;default:return`[ type: "${e.type}", serviceIdentifier: "${u(e.serviceIdentifier)}", scope: "${e.scope}" ]`}}(e.binding))).join("\n")}\n\nTrying to resolve bindings for "${pe(r,i)}".\n\n${me(n)}`;throw new V(G.planning,t)}t||_e(r,i,n)}(e,t,n,s,i):function(e,t,r,i,n){void 0!==e||t||_e(r,i,n)}(e,t,n,s,i)}function _e(e,t,r){const i=`No bindings found for service: "${u(e)}".\n\nTrying to resolve bindings for "${pe(e,t)}".\n\n${me(r)}`;throw new V(G.planning,i)}function pe(e,t){return void 0===t?`${u(e)} (Root service)`:u(t)}function me(e){const t=0===e.tags.size?"":`\n- tags:\n  - ${[...e.tags.keys()].map((e=>e.toString())).join("\n  - ")}`;return`Binding constraints:\n- service identifier: ${u(e.serviceIdentifier)}\n- name: ${e.name?.toString()??"-"}${t}`}function ve(e,t,r){if(1!==e.redirections.length)de(e.redirections,t,e,r);else{const[i]=e.redirections;fe(i)&&ve(i,t,r)}}function ge(e,t,r){if(Array.isArray(e.bindings)&&1===e.bindings.length){const[i]=e.bindings;fe(i)&&ve(i,t,r)}else de(e.bindings,t,e,r)}function be(e){try{const t=new Map;void 0!==e.rootConstraints.tag&&t.set(e.rootConstraints.tag.key,e.rootConstraints.tag.value);const r=new ce({elem:{name:e.rootConstraints.name,serviceIdentifier:e.rootConstraints.serviceIdentifier,tags:t},previous:void 0}),i=new ue(r.last),n=he(e,i),s=[],a={bindings:s,parent:void 0,serviceIdentifier:e.rootConstraints.serviceIdentifier};if(s.push(...we(e,r,n,a)),!e.rootConstraints.isMultiple){ge(a,e.rootConstraints.isOptional??!1,i);const[t]=s;a.bindings=t}return{tree:{root:a}}}catch(t){!function(e,t){if(function(e){return e instanceof Error&&(e instanceof RangeError&&/stack space|call stack|too much recursion/i.test(e.message)||"InternalError"===e.name&&/too much recursion/.test(e.message))}(t)){const r=function(e){const t=[...e];return 0===t.length?"(No dependency trace)":t.map(u).join(" -> ")}(function(e){const t=new Set;for(const r of e.servicesBranch){if(t.has(r))return[...t,r];t.add(r)}return[...t]}(e));throw new V(G.planning,`Circular dependency found: ${r}`,{cause:t})}throw t}(e,t)}}function Ee(e,t,r,i){const n={binding:t,classMetadata:e.getClassMetadata(t.implementationType),constructorParams:[],parent:i,propertyParams:new Map};return Me({autobindOptions:e.autobindOptions,getBindings:e.getBindings,getClassMetadata:e.getClassMetadata,node:n,servicesBranch:e.servicesBranch,setBinding:e.setBinding},r)}function Se(e,t,r){if(r.kind===H.unmanaged)return;const i=h.is(r.value)?r.value.unwrap():r.value,n=t.concat({name:r.name,serviceIdentifier:i,tags:r.tags}),s=new ue(n.last),a=he(e,s),o=[],l={bindings:o,parent:e.node,serviceIdentifier:i};if(o.push(...we(e,n,a,l)),r.kind===H.singleInjection){ge(l,r.optional,s);const[e]=o;l.bindings=e}return l}function ye(e,t,r){const i=h.is(r.value)?r.value.unwrap():r.value,n=t.concat({name:r.name,serviceIdentifier:i,tags:r.tags}),s=new ue(n.last),a=he(e,s),o=[],l={bindings:o,parent:e.node,serviceIdentifier:i};if(o.push(...we(e,n,a,l)),r.kind===oe.singleInjection){ge(l,r.optional,s);const[e]=o;l.bindings=e}return l}function Ae(e,t,r,i){const n={binding:t,params:[],parent:i};return Me({autobindOptions:e.autobindOptions,getBindings:e.getBindings,getClassMetadata:e.getClassMetadata,node:n,servicesBranch:e.servicesBranch,setBinding:e.setBinding},r)}function we(e,t,r,i){const n=fe(i)?i.binding.targetServiceIdentifier:i.serviceIdentifier;e.servicesBranch.push(n);const s=[];for(const n of r)switch(n.type){case A:s.push(Ee(e,n,t,i));break;case R:s.push(Ae(e,n,t,i));break;case M:{const r=Re(e,t,n,i);s.push(r);break}default:s.push({binding:n,parent:i})}return e.servicesBranch.pop(),s}function Re(e,t,r,i){const n={binding:r,parent:i,redirections:[]},s=he(e,new ue(t.last),{customServiceIdentifier:r.targetServiceIdentifier});return n.redirections.push(...we(e,t,s,n)),n}function Me(e,t){return e.node.binding.type===A?function(e,t,r){const i=t.classMetadata;for(const[n,s]of i.constructorArguments.entries())t.constructorParams[n]=Se(e,r,s);for(const[n,s]of i.properties){const i=Se(e,r,s);void 0!==i&&t.propertyParams.set(n,i)}return e.node}(e,e.node,t):function(e,t,r){const i=t.binding.metadata;for(const[n,s]of i.arguments.entries())t.params[n]=ye(e,r,s);return e.node}(e,e.node,t)}!function(e){e[e.singleMandatory=0]="singleMandatory",e[e.singleOptional=1]="singleOptional",e[e.multipleMandatory=2]="multipleMandatory",e[e.multipleOptional=3]="multipleOptional",e[e.length=4]="length"}(le||(le={}));class Be{#d;#_;#p;#m;#v;constructor(){this.#d=this.#g(),this.#_=this.#g(),this.#m=this.#g(),this.#p=this.#g(),this.#v=[]}clearCache(){for(const e of this.#b())e.clear();for(const e of this.#v)e.clearCache()}get(e){return void 0===e.name?void 0===e.tag?this.#E(this.#d,e).get(e.serviceIdentifier):this.#E(this.#p,e).get(e.serviceIdentifier)?.get(e.tag.key)?.get(e.tag.value):void 0===e.tag?this.#E(this.#_,e).get(e.serviceIdentifier)?.get(e.name):this.#E(this.#m,e).get(e.serviceIdentifier)?.get(e.name)?.get(e.tag.key)?.get(e.tag.value)}set(e,t){void 0===e.name?void 0===e.tag?this.#E(this.#d,e).set(e.serviceIdentifier,t):this.#S(this.#S(this.#E(this.#p,e),e.serviceIdentifier),e.tag.key).set(e.tag.value,t):void 0===e.tag?this.#S(this.#E(this.#_,e),e.serviceIdentifier).set(e.name,t):this.#S(this.#S(this.#S(this.#E(this.#m,e),e.serviceIdentifier),e.name),e.tag.key).set(e.tag.value,t)}subscribe(e){this.#v.push(e)}#g(){const e=new Array(le.length);for(let t=0;t<e.length;++t)e[t]=new Map;return e}#S(e,t){let r=e.get(t);return void 0===r&&(r=new Map,e.set(t,r)),r}#E(e,t){return e[this.#y(t)]}#b(){return[...this.#d,...this.#_,...this.#m,...this.#p]}#y(e){return e.isMultiple?!0===e.optional?le.multipleOptional:le.multipleMandatory:!0===e.optional?le.singleOptional:le.singleMandatory}}function Te(e,t){return l(t)?(e.cache={isRight:!0,value:t},t.then((t=>Ie(e,t)))):Ie(e,t)}function Ie(e,t){return e.cache={isRight:!0,value:t},t}async function Pe(e,t,r){let i=await t,n=r.next();for(;!0!==n.done;)i=await n.value(e.context,i),n=r.next();return i}function xe(e,t,r){let i=r;if(void 0!==t.onActivation){const r=t.onActivation;i=l(i)?i.then((t=>r(e.context,t))):r(e.context,i)}return function(e,t,r){const i=e.getActivations(t);return void 0===i?r:l(r)?Pe(e,r,i[Symbol.iterator]()):function(e,t,r){let i=t,n=r.next();for(;!0!==n.done;){const t=n.value(e.context,i);if(l(t))return Pe(e,t,r);i=t,n=r.next()}return i}(e,r,i[Symbol.iterator]())}(e,t.serviceIdentifier,i)}function ke(e){return(t,r)=>r.cache.isRight?r.cache.value:Te(r,xe(t,r,e(t,r)))}const Ne=ke((function(e,t){return t.value}));function Ce(e){return e}function Oe(e,t){return(r,i)=>{const n=e(i);switch(n.scope){case g:return n.cache.isRight?n.cache.value:Te(n,xe(r,n,t(r,i)));case v:{if(r.requestScopeCache.has(n.id))return r.requestScopeCache.get(n.id);const e=xe(r,n,t(r,i));return r.requestScopeCache.set(n.id,e),e}case b:return xe(r,n,t(r,i))}}}const De=Oe(Ce,(function(e,t){return t.value(e.context)})),Fe=ke((function(e,t){return t.factory(e.context)}));function Le(e,t,r){const i=function(e,t,r){if(void 0!==r){if(!(r in e))throw new V(G.resolution,`Expecting a "${r.toString()}" property when resolving "${t.implementationType.name}" class @postConstruct decorated method, none found.`);if("function"!=typeof e[r])throw new V(G.resolution,`Expecting a "${r.toString()}" method when resolving "${t.implementationType.name}" class @postConstruct decorated method, a non function property was found instead.`);{let i;try{i=e[r]()}catch(e){throw new V(G.resolution,`Unexpected error found when calling "${r.toString()}" @postConstruct decorated method on class "${t.implementationType.name}"`,{cause:e})}if(l(i))return async function(e,t,r){try{await r}catch(r){throw new V(G.resolution,`Unexpected error found when calling "${t.toString()}" @postConstruct decorated method on class "${e.implementationType.name}"`,{cause:r})}}(t,r,i)}}}(e,t,r);return l(i)?i.then((()=>e)):e}function Ve(e){return(t,r,i)=>{const n=new i.binding.implementationType(...t),s=e(r,n,i);return l(s)?s.then((()=>Le(n,i.binding,i.classMetadata.lifecycle.postConstructMethodName))):Le(n,i.binding,i.classMetadata.lifecycle.postConstructMethodName)}}const Ge=ke((function(e,t){return t.provider(e.context)}));function Ue(e){return e.binding}function He(e){return e.binding}const je=(ze=Qe,(e,t,r)=>{const i=[];for(const[n,s]of r.propertyParams){const a=r.classMetadata.properties.get(n);if(void 0===a)throw new V(G.resolution,`Expecting metadata at property "${n.toString()}", none found`);a.kind!==H.unmanaged&&void 0!==s.bindings&&(t[n]=ze(e,s),l(t[n])&&i.push((async()=>{t[n]=await t[n]})()))}if(i.length>0)return Promise.all(i).then((()=>{}))}),qe=function(e){return function t(r,i){const n=[];for(const s of i.redirections)fe(s)?n.push(...t(r,s)):n.push(e(r,s));return n}}(Ze),We=function(e,t,r){return(i,n)=>{const s=e(i,n);return l(s)?t(s,i,n):r(s,i,n)}}(function(e){return(t,r)=>{const i=[];for(const n of r.constructorParams)void 0===n?i.push(void 0):i.push(e(t,n));return i.some(l)?Promise.all(i):i}}(Qe),function(e){return async(t,r,i)=>{const n=await t;return e(n,r,i)}}(Ve(je)),Ve(je)),Ye=function(e){return(t,r)=>{const i=e(t,r);return l(i)?i.then((e=>r.binding.factory(...e))):r.binding.factory(...i)}}(function(e){return(t,r)=>{const i=[];for(const n of r.params)i.push(e(t,n));return i.some(l)?Promise.all(i):i}}(Qe)),Xe=Oe(Ue,We),Ke=Oe(He,Ye);var ze;function Ze(e,t){switch(t.binding.type){case E:return Ne(e,t.binding);case S:return De(e,t.binding);case y:return Fe(e,t.binding);case A:return Xe(e,t);case w:return Ge(e,t.binding);case R:return Ke(e,t)}}function Qe(e,t){if(void 0!==t.bindings)return Array.isArray(t.bindings)?function(e,t){const r=[];for(const i of t)fe(i)?r.push(...qe(e,i)):r.push(Ze(e,i));return r.some(l)?Promise.all(r):r}(e,t.bindings):function(e,t){if(fe(t)){const r=qe(e,t);if(1===r.length)return r[0];throw new V(G.resolution,"Unexpected multiple resolved values on single injection")}return Ze(e,t)}(e,t.bindings)}function $e(e){return void 0!==e.scope}function Je(e,t){if(void 0!==e.lifecycle.preDestroyMethodName&&"function"==typeof t[e.lifecycle.preDestroyMethodName])return t[e.lifecycle.preDestroyMethodName]()}function et(e,t,r){const i=e.getDeactivations(t);if(void 0!==i)return l(r)?tt(r,i[Symbol.iterator]()):function(e,t){let r=t.next();for(;!0!==r.done;){if(l(r.value(e)))return tt(e,t);r=t.next()}}(r,i[Symbol.iterator]())}async function tt(e,t){const r=await e;let i=t.next();for(;!0!==i.done;)await i.value(r),i=t.next()}function rt(e,t){const r=function(e,t){if(t.type===A){const r=e.getClassMetadata(t.implementationType),i=t.cache.value;return l(i)?i.then((e=>Je(r,e))):Je(r,i)}}(e,t);return void 0===r?it(e,t):r.then((()=>it(e,t)))}function it(e,t){const r=t.cache;return l(r.value)?r.value.then((r=>nt(e,t,r))):nt(e,t,r.value)}function nt(e,t,r){let i;return void 0!==t.onDeactivation&&(i=(0,t.onDeactivation)(r)),void 0===i?et(e,t.serviceIdentifier,r):i.then((()=>et(e,t.serviceIdentifier,r)))}function st(e,t){if(void 0===t)return;const r=function(e){const t=[];for(const r of e)$e(r)&&r.scope===g&&r.cache.isRight&&t.push(r);return t}(t),i=[];for(const t of r){const r=rt(e,t);void 0!==r&&i.push(r)}return i.length>0?Promise.all(i).then((()=>{})):void 0}function at(e,t){const r=e.getBindings(t);return st(e,r)}const ot=Symbol.for("@inversifyjs/container/bindingIdentifier");function lt(e){return"object"==typeof e&&null!==e&&!0===e[ot]}class ut{static always=e=>!0}function ct(e){return{[ot]:!0,id:e.id}}function ht(e){return t=>{for(let r=t.getAncestor();void 0!==r;r=r.getAncestor())if(e(r))return!0;return!1}}function ft(e){return t=>t.name===e}function dt(e){return t=>t.serviceIdentifier===e}function _t(e,t){return r=>r.tags.has(e)&&r.tags.get(e)===t}function pt(e){return void 0===e.name&&0===e.tags.size}function mt(e){const t=ht(e);return e=>!t(e)}function vt(e){return t=>{const r=t.getAncestor();return void 0===r||!e(r)}}function gt(e){return t=>{const r=t.getAncestor();return void 0!==r&&e(r)}}class bt{#r;constructor(e){this.#r=e}getIdentifier(){return ct(this.#r)}inRequestScope(){return this.#r.scope=v,new At(this.#r)}inSingletonScope(){return this.#r.scope=g,new At(this.#r)}inTransientScope(){return this.#r.scope=b,new At(this.#r)}}class Et{#t;#o;#s;#a;constructor(e,t,r,i){this.#t=e,this.#o=t,this.#s=r,this.#a=i}to(e){const t=j(e),r={cache:{isRight:!1,value:void 0},id:m(),implementationType:e,isSatisfiedBy:ut.always,moduleId:this.#o,onActivation:void 0,onDeactivation:void 0,scope:t.scope??this.#s,serviceIdentifier:this.#a,type:A};return this.#t(r),new wt(r)}toSelf(){if("function"!=typeof this.#a)throw new Error('"toSelf" function can only be applied when a newable function is used as service identifier');return this.to(this.#a)}toConstantValue(e){const t={cache:{isRight:!1,value:void 0},id:m(),isSatisfiedBy:ut.always,moduleId:this.#o,onActivation:void 0,onDeactivation:void 0,scope:g,serviceIdentifier:this.#a,type:E,value:e};return this.#t(t),new At(t)}toDynamicValue(e){const t={cache:{isRight:!1,value:void 0},id:m(),isSatisfiedBy:ut.always,moduleId:this.#o,onActivation:void 0,onDeactivation:void 0,scope:this.#s,serviceIdentifier:this.#a,type:S,value:e};return this.#t(t),new wt(t)}toResolvedValue(e,t){const r={cache:{isRight:!1,value:void 0},factory:e,id:m(),isSatisfiedBy:ut.always,metadata:this.#n(t),moduleId:this.#o,onActivation:void 0,onDeactivation:void 0,scope:this.#s,serviceIdentifier:this.#a,type:R};return this.#t(r),new wt(r)}toFactory(e){const t={cache:{isRight:!1,value:void 0},factory:e,id:m(),isSatisfiedBy:ut.always,moduleId:this.#o,onActivation:void 0,onDeactivation:void 0,scope:g,serviceIdentifier:this.#a,type:y};return this.#t(t),new At(t)}toProvider(e){const t={cache:{isRight:!1,value:void 0},id:m(),isSatisfiedBy:ut.always,moduleId:this.#o,onActivation:void 0,onDeactivation:void 0,provider:e,scope:g,serviceIdentifier:this.#a,type:w};return this.#t(t),new At(t)}toService(e){const t={id:m(),isSatisfiedBy:ut.always,moduleId:this.#o,serviceIdentifier:this.#a,targetServiceIdentifier:e,type:M};this.#t(t)}#n(e){return{arguments:(e??[]).map((e=>function(e){return"object"==typeof e&&!h.is(e)}(e)?{kind:!0===e.isMultiple?oe.multipleInjection:oe.singleInjection,name:e.name,optional:e.optional??!1,tags:new Map((e.tags??[]).map((e=>[e.key,e.value]))),value:e.serviceIdentifier}:{kind:oe.singleInjection,name:void 0,optional:!1,tags:new Map,value:e}))}}}class St{#r;constructor(e){this.#r=e}getIdentifier(){return ct(this.#r)}onActivation(e){return this.#r.onActivation=e,new yt(this.#r)}onDeactivation(e){return this.#r.onDeactivation=e,new yt(this.#r)}}class yt{#r;constructor(e){this.#r=e}getIdentifier(){return ct(this.#r)}when(e){return this.#r.isSatisfiedBy=e,new St(this.#r)}whenAnyAncestor(e){return this.when(ht(e))}whenAnyAncestorIs(e){return this.when(ht(dt(e)))}whenAnyAncestorNamed(e){return this.when(function(e){return ht(ft(e))}(e))}whenAnyAncestorTagged(e,t){return this.when(function(e,t){return ht(_t(e,t))}(e,t))}whenDefault(){return this.when(pt)}whenNamed(e){return this.when(ft(e))}whenNoParent(e){return this.when(vt(e))}whenNoParentIs(e){return this.when(vt(dt(e)))}whenNoParentNamed(e){return this.when(function(e){return vt(ft(e))}(e))}whenNoParentTagged(e,t){return this.when(function(e,t){return vt(_t(e,t))}(e,t))}whenParent(e){return this.when(gt(e))}whenParentIs(e){return this.when(gt(dt(e)))}whenParentNamed(e){return this.when(function(e){return gt(ft(e))}(e))}whenParentTagged(e,t){return this.when(function(e,t){return gt(_t(e,t))}(e,t))}whenTagged(e,t){return this.when(_t(e,t))}whenNoAncestor(e){return this.when(mt(e))}whenNoAncestorIs(e){return this.when(mt(dt(e)))}whenNoAncestorNamed(e){return this.when(function(e){return mt(ft(e))}(e))}whenNoAncestorTagged(e,t){return this.when(function(e,t){return mt(_t(e,t))}(e,t))}}class At extends yt{#c;constructor(e){super(e),this.#c=new St(e)}onActivation(e){return this.#c.onActivation(e)}onDeactivation(e){return this.#c.onDeactivation(e)}}class wt extends At{#l;constructor(e){super(e),this.#l=new bt(e)}inRequestScope(){return this.#l.inRequestScope()}inSingletonScope(){return this.#l.inSingletonScope()}inTransientScope(){return this.#l.inTransientScope()}}const Rt=Symbol.for("@inversifyjs/container/InversifyContainerError");class Mt extends Error{[Rt];kind;constructor(e,t,r){super(t,r),this[Rt]=!0,this.kind=e}static is(e){return"object"==typeof e&&null!==e&&!0===e[Rt]}static isErrorOfKind(e,t){return Mt.is(e)&&e.kind===t}}var Bt,Tt;(Tt=Bt||(Bt={}))[Tt.invalidOperation=0]="invalidOperation";const It=b;class Pt{#h;#u;#m;#v;#_;#y;#d;#A;#f;#g;#p;constructor(e){this.#m=this.#S(),this.#_=e=>this.#h.get(e),this.#A=new Be,this.#f=this.#E(),void 0===e?.parent?(this.#h=k.build(void 0),this.#u=N.build(void 0),this.#v=C.build(void 0)):(this.#h=k.build(e.parent.#h),this.#u=N.build(e.parent.#u),this.#v=C.build(e.parent.#v),e.parent.#A.subscribe(this.#A)),this.#y=this.#u.get.bind(this.#u),this.#g=this.#w.bind(this),this.#d={autobind:e?.autobind??!1,defaultScope:e?.defaultScope??It},this.#p=[]}bind(e){return new Et((e=>{this.#w(e)}),void 0,this.#d.defaultScope,e)}get(e,t){const r=this.#R(!1,e,t),i=this.#M(r);if(l(i))throw new Mt(Bt.invalidOperation,`Unexpected asyncronous service when resolving service "${u(e)}"`);return i}getAll(e,t){const r=this.#R(!0,e,t),i=this.#M(r);if(l(i))throw new Mt(Bt.invalidOperation,`Unexpected asyncronous service when resolving service "${u(e)}"`);return i}async getAllAsync(e,t){const r=this.#R(!0,e,t);return this.#M(r)}async getAsync(e,t){const r=this.#R(!1,e,t);return this.#M(r)}isBound(e,t){const r=this.#u.get(e);return this.#B(e,r,t)}isCurrentBound(e,t){const r=this.#u.getNonParentBindings(e);return this.#B(e,r,t)}async load(...e){await Promise.all(this.#e(...e))}loadSync(...e){const t=this.#e(...e);for(const e of t)if(void 0!==e)throw new Mt(Bt.invalidOperation,"Unexpected asyncronous module load. Consider using Container.load() instead.")}onActivation(e,t){this.#h.add(t,{serviceId:e})}onDeactivation(e,t){this.#v.add(t,{serviceId:e})}restore(){const e=this.#p.pop();if(void 0===e)throw new Mt(Bt.invalidOperation,"No snapshot available to restore");this.#h=e.activationService,this.#u=e.bindingService,this.#v=e.deactivationService,this.#T()}async rebind(e){return await this.unbind(e),this.bind(e)}rebindSync(e){return this.unbindSync(e),this.bind(e)}snapshot(){this.#p.push({activationService:this.#h.clone(),bindingService:this.#u.clone(),deactivationService:this.#v.clone()})}async unbind(e){await this.#b(e)}async unbindAll(){const e=[...this.#u.getNonParentBoundServices()];await Promise.all(e.map((async e=>at(this.#m,e))));for(const t of e)this.#h.removeAllByServiceId(t),this.#u.removeAllByServiceId(t),this.#v.removeAllByServiceId(t);this.#A.clearCache()}unbindSync(e){void 0!==this.#b(e)&&this.#I(e)}async unload(...e){await Promise.all(this.#P(...e)),this.#x(e)}unloadSync(...e){const t=this.#P(...e);for(const e of t)if(void 0!==e)throw new Mt(Bt.invalidOperation,"Unexpected asyncronous module unload. Consider using Container.unload() instead.");this.#x(e)}#k(e){return{bind:t=>new Et((e=>{this.#w(e)}),e,this.#d.defaultScope,t),isBound:this.isBound.bind(this),onActivation:(t,r)=>{this.#h.add(r,{moduleId:e,serviceId:t})},onDeactivation:(t,r)=>{this.#v.add(r,{moduleId:e,serviceId:t})},rebind:this.rebind.bind(this),rebindSync:this.rebindSync.bind(this),unbind:this.unbind.bind(this),unbindSync:this.unbindSync.bind(this)}}#S(){return{getBindings:e=>this.#u.get(e),getBindingsFromModule:e=>this.#u.getByModuleId(e),getClassMetadata:j,getDeactivations:e=>this.#v.get(e)}}#N(e,t,r){return{isMultiple:e,name:r?.name,optional:r?.optional,serviceIdentifier:t,tag:r?.tag}}#C(e,t,r){const i={autobindOptions:r?.autobind??this.#d.autobind?{scope:this.#d.defaultScope}:void 0,getBindings:this.#y,getClassMetadata:j,rootConstraints:{isMultiple:t,serviceIdentifier:e},servicesBranch:[],setBinding:this.#g};return this.#O(i,r),i}#R(e,t,r){const i=this.#N(e,t,r),n=this.#A.get(i);if(void 0!==n)return n;const s=be(this.#C(t,e,r));return this.#A.set(i,s),s}#E(){return{get:this.get.bind(this),getAll:this.getAll.bind(this),getAllAsync:this.getAllAsync.bind(this),getAsync:this.getAsync.bind(this)}}#M(e){return function(e){return Qe(e,e.planResult.tree.root)}({context:this.#f,getActivations:this.#_,planResult:e,requestScopeCache:new Map})}#O(e,t){void 0!==t&&(void 0!==t.name&&(e.rootConstraints.name=t.name),!0===t.optional&&(e.rootConstraints.isOptional=!0),void 0!==t.tag&&(e.rootConstraints.tag={key:t.tag.key,value:t.tag.value}))}#B(e,t,r){if(void 0===t)return!1;const i={getAncestor:()=>{},name:r?.name,serviceIdentifier:e,tags:new Map};void 0!==r?.tag&&i.tags.set(r.tag.key,r.tag.value);for(const e of t)if(e.isSatisfiedBy(i))return!0;return!1}#e(...e){return e.map((e=>e.load(this.#k(e.id))))}#P(...e){return e.map((e=>function(e,t){const r=e.getBindingsFromModule(t);return st(e,r)}(this.#m,e.id)))}#T(){this.#A.clearCache(),this.#_=e=>this.#h.get(e),this.#y=this.#u.get.bind(this.#u),this.#f=this.#E(),this.#g=this.#w.bind(this)}#w(e){this.#u.set(e),this.#A.clearCache()}#I(e){let t;if(lt(e)){const i=this.#u.getById(e.id),n=(r=i,function(e){if(void 0===e)return;const t=e.next();return!0!==t.done?t.value:void 0}(r?.[Symbol.iterator]()))?.serviceIdentifier;t=void 0===n?"Unexpected asyncronous deactivation when unbinding binding identifier. Consider using Container.unbind() instead.":`Unexpected asyncronous deactivation when unbinding "${u(n)}" binding. Consider using Container.unbind() instead.`}else t=`Unexpected asyncronous deactivation when unbinding "${u(e)}" service. Consider using Container.unbind() instead.`;var r;throw new Mt(Bt.invalidOperation,t)}#b(e){return lt(e)?this.#D(e):this.#F(e)}#D(e){const t=this.#u.getById(e.id),r=st(this.#m,t);if(void 0!==r)return r.then((()=>{this.#L(e)}));this.#L(e)}#L(e){this.#u.removeById(e.id),this.#A.clearCache()}#x(e){for(const t of e)this.#h.removeAllByModuleId(t.id),this.#u.removeAllByModuleId(t.id),this.#v.removeAllByModuleId(t.id);this.#A.clearCache()}#F(e){const t=at(this.#m,e);if(void 0!==t)return t.then((()=>{this.#V(e)}));this.#V(e)}#V(e){this.#h.removeAllByServiceId(e),this.#u.removeAllByServiceId(e),this.#v.removeAllByServiceId(e),this.#A.clearCache()}}const xt={AudioContextManager:Symbol.for("AudioContextManager"),AudioEditor:Symbol.for("AudioEditor"),AudioProcessor:Symbol.for("AudioProcessor"),BufferManager:Symbol.for("BufferManager"),FilterManager:Symbol.for("FilterManager"),RendererManager:Symbol.for("RendererManager"),SaveBufferManager:Symbol.for("SaveBufferManager"),ConfigService:Symbol.for("ConfigService"),EventEmitter:Symbol.for("EventEmitter"),BufferPlayer:Symbol.for("BufferPlayer"),BufferDecoderService:Symbol.for("BufferDecoderService"),BufferFetcherService:Symbol.for("BufferFetcherService"),AudioBuffersToFetch:Symbol.for("AudioBuffersToFetch"),Renderers:Symbol.for("Renderers"),Filters:Symbol.for("Filters"),BaseAudioEncoder:Symbol.for("BaseAudioEncoder"),AudioEncoders:Symbol.for("AudioEncoders"),EntryPointFilter:Symbol.for("EntryPointFilter"),VoiceRecorder:Symbol.for("VoiceRecorder")};let kt=class{constructor(){this.bufferFetcherService=null,this.bufferDecoderService=null,this.configService=null,this.eventEmitter=null,this.contextManager=null}injectDependencies(e,t,r,i,n){e&&(this.bufferFetcherService=e),t&&(this.bufferDecoderService=t),r&&(this.configService=r),i&&(this.eventEmitter=i),n&&(this.contextManager=n)}};e([$(xt.BufferFetcherService),r("design:type",Object)],kt.prototype,"bufferFetcherService",void 0),e([$(xt.BufferDecoderService),r("design:type",Object)],kt.prototype,"bufferDecoderService",void 0),e([$(xt.ConfigService),r("design:type",Object)],kt.prototype,"configService",void 0),e([$(xt.EventEmitter),r("design:type",Object)],kt.prototype,"eventEmitter",void 0),e([$(xt.AudioContextManager),r("design:type",Object)],kt.prototype,"contextManager",void 0),kt=e([te()],kt);var Nt=kt;const Ct={calcAudioDuration:(e,t)=>{if(e){let r=e.duration+1;return null!=t&&(r/=t),r}return 0},loadAudioBuffer:(e,t)=>i(void 0,void 0,void 0,(function*(){const r=yield Ct.readAsArrayBufferPromisified(t),i=yield e.decodeAudioData(r);return Ct.decodeBuffer(e,i)})),readAsArrayBufferPromisified:e=>new Promise(((t,r)=>{const i=new FileReader;i.onload=e=>{var i;const n=null===(i=null==e?void 0:e.target)||void 0===i?void 0:i.result;n instanceof ArrayBuffer?t(n):r()},e&&i.readAsArrayBuffer(e)})),decodeBuffer:(e,t)=>{if(1==t.numberOfChannels){e.resume();const{duration:r}=t,{sampleRate:i}=e,n=e.createBuffer(2,i*r+2*i,i),s=t.getChannelData(0),a=n.getChannelData(0),o=n.getChannelData(1);for(let e=0;e<s.length;e++)a[e]=s[e],o[e]=s[e];return n}return t},convertAudioBufferToFloat32Array:e=>{const t=[];for(let r=0;r<e.numberOfChannels;r++)t.push(e.getChannelData(r));return t},convertAudioParamToFloat32Array:(e,t)=>{const r=new Float32Array(t);for(let i=0;i<t;i++)r.set([e.value],i);return r},sumAudioBufferChannel:(e,t)=>e.getChannelData(t).reduce(((e,t)=>e+t),0),sumAudioBuffer(e){let t=0;for(let r=0;r<e.numberOfChannels;r++)t+=this.sumAudioBufferChannel(e,r);return t},isAudioWorkletCompatible:e=>void 0!==e&&void 0!==e.audioWorklet,isSettingValueValid:e=>!(void 0===e||isNaN(Number(e))||"string"==typeof e&&""===e.trim()),calculateAudioDuration(e,t,r){if(e&&t){const i=this.calcAudioDuration(e,r),n=t.getAddingTime();return n?i+n:i}return 0},forceDownload(e,t){const r=window.document.createElement("a"),i=URL.createObjectURL(e);window.document.body.appendChild(r),r.href=i,r.download=t||"output.wav",r.click(),URL.revokeObjectURL(i),window.document.body.removeChild(r)},clearAudioBuffer(e){if(e)for(let t=0;t<e.numberOfChannels;t++){const r=e.getChannelData(t);for(let e=0;e<r.length;e++)r[e]=0}},floatTo16BitPCM(e,t,r){for(let i=0;i<r.length;i++,t+=2){const n=this.clampFloatValue(r[i]);e.setInt16(t,n<0?32768*n:32767*n,!0)}},convertFloatArray2Int16(e){const t=new Int16Array(e.length);for(let r=0,i=e.length;r<i;r++){const i=this.clampFloatValue(e[r]);t[r]=Math.round(32767*i)}return t},clampFloatValue:e=>Math.max(-1,Math.min(1,e)),writeStringToDataView(e,t,r){for(let i=0;i<r.length;i++)e.setUint8(t+i,r.charCodeAt(i))},interleaveBuffers(e,t){const r=e.length+t.length,i=new Float32Array(r);let n=0,s=0;for(;n<r;)i[n++]=e[s],i[n++]=t[s],s++;return i},mergeBuffers(e,t){const r=new Float32Array(t);let i=0;for(let t=0;t<e.length;t++)e[t]?(r.set(e[t],i),i+=e[t].length):console.warn("mergeBuffers: undefined buffer has been detected");return r}};var Ot;exports.EventType=void 0,(Ot=exports.EventType||(exports.EventType={})).LOADING_BUFFERS="loadingBuffers",Ot.LOADING_BUFFERS_ERROR="loadingBuffersError",Ot.FETCHING_BUFFERS="fetchingBuffers",Ot.FETCHING_BUFFERS_ERROR="fetchingBuffersError",Ot.FINISHED_FETCHING_BUFFERS="finishedFetchingBuffers",Ot.LOADED_BUFFERS="loadedBuffers",Ot.COMPATIBILITY_MODE_AUTO_ENABLED="compatibilityModeAutoEnabled",Ot.STARTED_RENDERING_AUDIO="renderingAudio",Ot.RENDERING_AUDIO_PROBLEM_DETECTED="renderingAudioProblemDetected",Ot.AUDIO_RENDERING_FINISHED="audioRenderingFinished",Ot.AUDIO_RENDERING_EXCEPTION_THROWN="audioRenderingExceptionThrown",Ot.OFFLINE_AUDIO_RENDERING_FINISHED="offlineAudioRenderingFinished",Ot.PLAYING_STOPPED="playingStopped",Ot.PLAYING_STARTED="playingStarted",Ot.PLAYING_FINISHED="playingFinished",Ot.PLAYING_UPDATE="playingUpdate",Ot.RECORDER_INIT="recorderInit",Ot.RECORDER_SUCCESS="recorderSuccess",Ot.RECORDER_ERROR="recorderError",Ot.RECORDER_UPDATE_CONSTRAINTS="recorderUpdateConstraints",Ot.RECORDER_RECORDING="recorderRecording",Ot.RECORDER_STOPPED="recorderStopped",Ot.RECORDER_PAUSED="recorderPaused",Ot.RECORDER_RESETED="recorderReseted",Ot.RECORDER_COUNT_UPDATE="recorderCountUpdate",Ot.SAMPLE_RATE_CHANGED="sampleRateChanged",Ot.DECODING_AUDIO_FILE="decodingAudioFile",Ot.DECODED_AUDIO_FILE="decodedAudioFile",Ot.ERROR_DECODING_AUDIO_FILE="errorDecodingAudioFile",Ot.RECORDER_NOT_FOUND_ERROR="recorderNotFoundError",Ot.RECORDER_UNKNOWN_ERROR="recorderUnknownError",Ot.UPDATE_AUDIO_TREATMENT_PERCENT="updateAudioTreatmentPercent",Ot.UPDATE_REMAINING_TIME_ESTIMATED="updateRemainingTimeEstimated",Ot.CANCELLED_AND_LOADED_INITIAL_AUDIO="cancelledAndLoadedInitialAudio",Ot.CANCELLING_AUDIO_PROCESSING="cancellingAudioProcessing",Ot.PLAYING_FINISHED_LOOP_ALL="playingFinishedLoopAll",Ot.LOADED_AUDIO_FILE_FROM_LIST="loadedAudioFileFromList",Ot.AUDIO_SPEED_UPDATED="audioSpeedUpdated",Ot.AUDIO_DURATION_UPDATED="audioDurationUpdated",Ot.FALLBACK_WORKLET_TO_SCRIPT_PROCESSOR="fallbackWorkletToScriptProcessor",Ot.WORKLET_SUCCESSFULLY_LOADED="workletSuccessfullyLoaded";let Dt=class extends Nt{constructor(e,t,r,i,n,s,a){super(),this.principalBuffer=null,this.fileList=null,this.fileListCurrIndex=0,this.loadingAudio=!1,this.renderingAudio=!1,this.filterManager=e,this.rendererManager=t,this.contextManager=r,this.saveBufferManager=i,this.audioProcessor=n,this.bufferManager=s,this.bufferPlayer=a}setup(){this.eventEmitter?(this.eventEmitter.on(exports.EventType.PLAYING_STARTED,(()=>i(this,void 0,void 0,(function*(){this.bufferPlayer&&this.bufferPlayer.compatibilityMode&&this.contextManager&&this.contextManager.currentContext&&this.audioProcessor&&(yield this.audioProcessor.setupOutput(this.principalBuffer,this.contextManager.currentContext))})))),this.eventEmitter.on(exports.EventType.PLAYING_FINISHED,(()=>{this.bufferPlayer&&this.bufferPlayer.loop&&this.bufferPlayer.start()})),this.eventEmitter.on(exports.EventType.PLAYING_FINISHED_LOOP_ALL,(()=>i(this,void 0,void 0,(function*(){this.bufferPlayer&&this.bufferPlayer.loopAll&&!this.renderingAudio&&!this.loadingAudio&&(yield this.loadNextAudio(!0),this.bufferPlayer.start())}))))):console.error("Event Emitter is not available!")}addFilters(...e){this.filterManager&&this.filterManager.addFilters(...e)}addRenderers(...e){this.rendererManager&&this.rendererManager.addRenderers(...e)}get currentSampleRate(){return this.contextManager?this.contextManager.currentSampleRate:0}get defaultDeviceSampleRate(){const e=new AudioContext,{sampleRate:t}=e;return e&&e.close(),t}loadBufferFromFile(e){return i(this,void 0,void 0,(function*(){if(this.loadingAudio=!0,this.audioProcessor&&(yield this.audioProcessor.prepareContext(this.principalBuffer)),!(this.contextManager&&this.contextManager.currentContext&&this.bufferDecoderService&&this.audioProcessor))throw this.loadingAudio=!1,new Error("Audio Context is not ready!");if(this.clearPrincipalBuffer(),this.principalBuffer=yield this.bufferDecoderService.decodeBufferFromFile(e),this.audioProcessor.initialRenderingDone=!1,!this.principalBuffer)throw this.loadingAudio=!1,new Error("Error decoding audio file");this.audioProcessor.sumInputBuffer=Ct.sumAudioBuffer(this.principalBuffer),this.audioProcessor.resetAudioRenderingProgress(),this.bufferPlayer&&this.bufferPlayer.loopAll&&this.totalFileList<=1&&this.bufferPlayer.toggleLoop(),this.loadingAudio=!1}))}loadFileList(e){return i(this,void 0,void 0,(function*(){this.fileList=e,yield this.loadBufferFromFileListIndex(0)}))}loadBufferFromFileListIndex(e){return i(this,void 0,void 0,(function*(){if(this.fileList){this.fileListCurrIndex=e;const t=this.fileList.item(this.fileListCurrIndex);this.eventEmitter&&this.eventEmitter.emit(exports.EventType.LOADED_AUDIO_FILE_FROM_LIST,e),t&&(yield this.loadBufferFromFile(t))}}))}loadPreviousAudio(e){return i(this,void 0,void 0,(function*(){const t=this.currentIndexFileList,r=this.totalFileList,i=t-1;i!=t&&(i<0?yield this.loadBufferFromFileListIndex(r-1):yield this.loadBufferFromFileListIndex(i),yield this.renderAudio(e))}))}loadNextAudio(e){return i(this,void 0,void 0,(function*(){const t=this.currentIndexFileList,r=this.totalFileList,i=t+1;i!=t&&(i>=r?yield this.loadBufferFromFileListIndex(0):yield this.loadBufferFromFileListIndex(i),yield this.renderAudio(e))}))}getCurrentFileList(){if(this.fileList){const e=new Map;for(let t=0;t<this.fileList.length;t++){const r=this.fileList.item(t);r&&e.set(r.name,this.currentIndexFileList===t)}return e}return new Map}get currentIndexFileList(){return this.fileListCurrIndex}get totalFileList(){return this.fileList?this.fileList.length:0}loadBuffer(e){this.principalBuffer=e,this.audioProcessor&&(this.audioProcessor.sumInputBuffer=Ct.sumAudioBuffer(this.principalBuffer),this.audioProcessor.initialRenderingDone=!1)}getOutputBuffer(){return this.audioProcessor?this.audioProcessor.renderedBuffer:null}renderAudio(e){return i(this,void 0,void 0,(function*(){if(this.audioProcessor)try{this.renderingAudio=!0,this.eventEmitter&&this.eventEmitter.emit(exports.EventType.STARTED_RENDERING_AUDIO);const t=yield this.audioProcessor.renderAudio(this.principalBuffer,e);return this.eventEmitter&&this.eventEmitter.emit(exports.EventType.AUDIO_RENDERING_FINISHED),this.renderingAudio=!1,t}catch(e){this.eventEmitter&&(this.eventEmitter.emit(exports.EventType.AUDIO_RENDERING_FINISHED),this.eventEmitter.emit(exports.EventType.AUDIO_RENDERING_EXCEPTION_THROWN,e)),this.renderingAudio=!1}return!1}))}isAudioWorkletAvailable(){return!(!this.contextManager||!this.contextManager.currentContext)&&Ct.isAudioWorkletCompatible(this.contextManager.currentContext)}getFiltersState(){return this.filterManager&&this.rendererManager?Object.assign(Object.assign({},this.filterManager.getFiltersState()),this.rendererManager.getRenderersState()):{}}getFiltersSettings(){return this.filterManager?this.filterManager.getFiltersSettings():new Map}reconnectNodesIfNeeded(){return i(this,void 0,void 0,(function*(){if(this.contextManager&&this.bufferPlayer&&this.bufferPlayer.compatibilityMode&&this.contextManager.currentContext&&this.principalBuffer&&this.filterManager&&this.filterManager.entrypointFilter&&(yield this.filterManager.connectNodes(this.contextManager.currentContext,this.principalBuffer,!0,this.bufferPlayer.compatibilityMode),this.audioProcessor)){const e=this.filterManager.entrypointFilter.getSpeed(),t=Ct.calculateAudioDuration(this.principalBuffer,this.filterManager,e);this.audioProcessor.updateAudioSpeedAndDuration(t)}}))}enableFilter(e){this.rendererManager&&this.rendererManager.enableRenderer(e),this.filterManager&&(this.filterManager.enableFilter(e),this.reconnectNodesIfNeeded())}disableFilter(e){this.rendererManager&&this.rendererManager.disableRenderer(e),this.filterManager&&(this.filterManager.disableFilter(e),this.reconnectNodesIfNeeded())}toggleFilter(e){this.rendererManager&&this.rendererManager.toggleRenderer(e),this.filterManager&&(this.filterManager.toggleFilter(e),this.reconnectNodesIfNeeded())}changeFilterSettings(e,t){return i(this,void 0,void 0,(function*(){this.filterManager&&(yield this.filterManager.changeFilterSettings(e,t),yield this.reconnectNodesIfNeeded())}))}resetFilterSettings(e){return i(this,void 0,void 0,(function*(){this.filterManager&&(yield this.filterManager.resetFilterSettings(e),yield this.reconnectNodesIfNeeded())}))}resetAllFiltersState(){this.rendererManager&&this.rendererManager.resetAllRenderersState(),this.filterManager&&(this.filterManager.resetAllFiltersState(),this.reconnectNodesIfNeeded())}exit(){this.bufferPlayer&&(this.bufferPlayer.stop(),this.bufferPlayer.reset()),this.cancelAudioRendering(),this.clearBuffers(),this.fileList=null,this.fileListCurrIndex=0}clearBuffers(){this.clearPrincipalBuffer(),this.clearRenderedBuffer()}clearPrincipalBuffer(){Ct.clearAudioBuffer(this.principalBuffer),this.principalBuffer=null}clearRenderedBuffer(){this.audioProcessor&&this.audioProcessor.clearRenderedBuffer()}cancelAudioRendering(){this.audioProcessor&&this.audioProcessor.cancelAudioRendering()}on(e,t){this.eventEmitter&&this.eventEmitter.on(e,t)}off(e,t){this.eventEmitter&&this.eventEmitter.off(e,t)}saveBuffer(e){var t;return this.saveBufferManager&&this.audioProcessor?null===(t=this.saveBufferManager)||void 0===t?void 0:t.saveBuffer(this.audioProcessor.renderedBuffer,e):Promise.resolve(!1)}set downloadingInitialData(e){this.bufferManager&&(this.bufferManager.downloadingInitialData=e)}get downloadingInitialData(){return!!this.bufferManager&&this.bufferManager.downloadingInitialData}};e([ae(),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",void 0)],Dt.prototype,"setup",null),Dt=e([te(),ne(),t(0,$(xt.FilterManager)),t(1,$(xt.RendererManager)),t(2,$(xt.AudioContextManager)),t(3,$(xt.SaveBufferManager)),t(4,$(xt.AudioProcessor)),t(5,$(xt.BufferManager)),t(6,$(xt.BufferPlayer)),r("design:paramtypes",[Object,Object,Object,Object,Object,Object,Object])],Dt);var Ft=Dt;let Lt=class extends Nt{constructor(){super(...arguments),this.buffer=null,this.source=null,this.gainNode=null,this.intervals=[],this._volume=1,this._duration=0,this.currentTime=0,this.displayTime=0,this.playing=!1,this.loop=!1,this.loopAll=!1,this.speedAudio=1,this.compatibilityMode=!1,this.currentNode=null}setup(){this.eventEmitter?(this.eventEmitter.on(exports.EventType.AUDIO_SPEED_UPDATED,(e=>{e&&(this.speedAudio=e)})),this.eventEmitter.on(exports.EventType.AUDIO_DURATION_UPDATED,(e=>{e&&(this.duration=e)}))):console.error("Event Emitter is not available!")}init(e){this.playing=!1,this.contextManager&&this.contextManager.currentContext&&(this.contextManager.currentContext.resume(),!this.compatibilityMode&&this.buffer&&(null==this.source||e||(this.source.buffer=null,this.source.disconnect()),this.createGainNode(e),this.duration=this.buffer.duration,this.source&&this.gainNode&&(this.source.connect(this.gainNode),this.gainNode.connect(this.contextManager.currentContext.destination)))),this.updateInfos()}createGainNode(e){this.contextManager&&this.contextManager.currentContext&&(e||(this.gainNode&&this.gainNode.disconnect(),this.source&&this.source.disconnect()),this.source=this.contextManager.currentContext.createBufferSource(),this.source.buffer=this.buffer,this.gainNode=this.contextManager.currentContext.createGain(),this.setGainNodeValue())}loadBuffer(e){this.compatibilityMode=!1,this.reset(),this.buffer=e,this.init()}setCompatibilityMode(e,t){this.compatibilityMode=!0,this.reset(),this.init(),null!=t&&(this.duration=t*this.speedAudio),this.currentNode=e,this.updateInfos()}reset(e){this.clearIntervals(),this.currentTime=0,this.displayTime=0,e||this.stop()}stop(){var e;this.clearIntervals(),null!=this.source&&null!=this.source&&this.playing&&(this.source.stop(0),this.playing=!1),this.currentNode&&(this.currentNode.disconnect(),this.compatibilityMode&&(this.currentTime=0,this.displayTime=0)),null===(e=this.eventEmitter)||void 0===e||e.emit(exports.EventType.PLAYING_STOPPED),this.updateInfos()}clearIntervals(){for(const e of this.intervals)clearInterval(e);this.intervals=[]}start(e){return i(this,void 0,void 0,(function*(){var t;if(this.source||this.compatibilityMode){if(e||this.stop(),this.init(e),yield null===(t=this.eventEmitter)||void 0===t?void 0:t.emit(exports.EventType.PLAYING_STARTED),this.compatibilityMode){if(!(this.currentNode&&this.contextManager&&this.contextManager.currentContext))return Promise.resolve();this.createGainNode(e),this.gainNode?(this.currentNode.connect(this.gainNode),this.gainNode.connect(this.contextManager.currentContext.destination)):this.currentNode.connect(this.contextManager.currentContext.destination)}else{if(!this.source)return Promise.resolve();this.source.start(0,e?0:this.currentTime/this.speedAudio),this.playing=!0}let r=performance.now();this.intervals.push(window.setInterval((()=>{var t,i,n;const s=performance.now(),a=s-r;r=s,this.currentTime+=a/1e3*this.speedAudio,this.displayTime=this.currentTime,this.currentTime>this.duration?this.loop?this.compatibilityMode?null===(t=this.eventEmitter)||void 0===t||t.emit(exports.EventType.PLAYING_FINISHED):(this.reset(e),this.start()):(null===(i=this.eventEmitter)||void 0===i||i.emit(exports.EventType.PLAYING_FINISHED),this.reset(e),this.loopAll&&(null===(n=this.eventEmitter)||void 0===n||n.emit(exports.EventType.PLAYING_FINISHED_LOOP_ALL))):this.updateInfos()}),100))}return Promise.resolve()}))}playDirect(){return i(this,void 0,void 0,(function*(){this.compatibilityMode?yield this.start(!1):yield this.start(!0)}))}pause(){this.stop()}updateInfos(){var e;null===(e=this.eventEmitter)||void 0===e||e.emit(exports.EventType.PLAYING_UPDATE)}setTimePercent(e){this.compatibilityMode||(this.currentTime=Math.round(this.duration*(e/100)),this.displayTime=this.currentTime,this.playing?(this.pause(),this.start()):this.updateInfos())}setTime(e){this.compatibilityMode||(this.currentTime=e,this.displayTime=this.currentTime,this.playing?(this.pause(),this.start()):this.updateInfos())}set volume(e){this._volume=e,this.setGainNodeValue()}setGainNodeValue(){this.gainNode&&(this.gainNode.gain.value=Math.pow(this._volume,2))}get volume(){return this._volume}get duration(){return this._duration}set duration(e){this._duration=e*(this.speedAudio||1)}onBeforePlaying(e){this.eventEmitter&&this.eventEmitter.on(exports.EventType.PLAYING_STARTED,e)}toggleLoop(){this.loopAll=!1,this.loop=!this.loop}toggleLoopAll(){this.loop=!1,this.loopAll=!this.loopAll}on(e,t){this.eventEmitter&&this.eventEmitter.on(e,t)}get currentTimeDisplay(){return("0"+Math.trunc(this.displayTime/60)).slice(-2)+":"+("0"+Math.trunc(this.displayTime%60)).slice(-2)}get maxTimeDisplay(){return("0"+Math.trunc(this.duration/60)).slice(-2)+":"+("0"+Math.trunc(this.duration%60)).slice(-2)}get percent(){return 100-Math.round((this.duration-this.displayTime)/this.duration*100)}get remainingTimeDisplay(){return("0"+Math.trunc((this.duration-this.displayTime)/60)).slice(-2)+":"+("0"+Math.trunc((this.duration-this.displayTime)%60)).slice(-2)}};e([ae(),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",void 0)],Lt.prototype,"setup",null),Lt=e([te(),ne()],Lt);var Vt=Lt;class Gt{constructor(e,t){this.seconds=0,this.initialSeconds=0,this.interval=null,this.incr=1,this.countCallback=()=>{},this.seconds=e,this.initialSeconds=e,this.incr=t}start(){this.interval=window.setInterval((()=>this.count()),1e3)}stop(){clearInterval(this.interval)}count(){this.seconds+=this.incr,this.seconds<=0&&this.stop(),this.countCallback&&this.countCallback()}onCount(e){this.countCallback=e}}const Ut={REVERB:"reverb",ECHO:"echo",BASS_BOOST:"bassboost",BITCRUSHER:"bitcrusher",HIGH_PASS:"highpass",LIMITER:"limiter",LOW_PASS:"lowpass",RENDERING_PROGRESS_CALCULATION:"renderingProgressCalculationFilter",RETURN_AUDIO:"returnAudio",SOUNDTOUCH:"soundtouch",TELEPHONIZER:"telephonizer",VOCODER:"vocoder"},Ht={AUDIO_EDITOR:"audioEditor",VOICE_RECORDER:"voiceRecorder",BUFFER_PLAYER:"bufferPlayer",AUDIO_CONTEXT_MANAGER:"audioContextManager",AUDIO_PROCESSOR:"audioProcessor",BUFFER_MANAGER:"bufferManager",FILTER_MANAGER:"filterManager",RENDERER_MANAGER:"rendererManager",SAVE_BUFFER_MANAGER:"saveBufferManager",EXPORT_WAV_COMMAND:"exportWAV",EXPORT_MP3_COMMAND:"exportMP3",AUDIO_WAV:"audio/wav",AUDIO_MP3:"audio/mp3",RECORD_COMMAND:"record",INIT_COMMAND:"init",FILTERS_NAMES:Ut,WORKLET_PATHS:{BITCRUSHER:"BitCrusher.worklet.js",LIMITER:"Limiter.worklet.js",SOUNDTOUCH:"Soundtouch.worklet.js",RECORDER_WORKLET:"RecorderWorklet.js",RENDERING_PROGRESS_CALCULATION:"RenderingProgressCalculation.worklet.js"},WORKLET_NAMES:{BITCRUSHER:"bitcrusher-processor",LIMITER:"limiter-processor",SOUNDTOUCH:"soundtouch-processor",RECORDER_WORKLET:"recorder-worklet",RENDERING_PROGRESS_CALCULATION:"rendering-progress-calculation-worklet"},PREFERENCES_KEYS:{COMPATIBILITY_MODE_ENABLED:"compatibility-mode-enabled",COMPATIBILITY_MODE_CHECKED:"compatibility-mode-checked",ENABLE_AUDIO_WORKLET:"enable-audio-worklet",ENABLE_SOUNDTOUCH_AUDIO_WORKLET:"enable-soundtouch-audio-worklet",BUFFER_SIZE:"buffer-size",SAMPLE_RATE:"sample-rate",DISABLE_INITIAL_RENDERING:"disable-initial-rendering",BITRATE_MP3:"bitrate-mp3"},ENABLE_SOUNDTOUCH_AUDIO_WORKLET:!0,ENABLE_AUDIO_WORKLET:!0,ENABLE_RECORDER_AUDIO_WORKLET:!0,SOUNDTOUCH_PITCH_SHIFTER_BUFFER_SIZE:16384,SOUNDTOUCH_DEFAULT_SPEED:1,SOUNDTOUCH_DEFAULT_FREQUENCY:1,SOUNDTOUCH_DEFAULT_PITCH_SEMITONES:0,DEFAULT_REVERB_ENVIRONMENT:{name:"Medium Damping Cave E002 M2S",url:"impulse_response.wav",size:1350278,addDuration:4,link:"http://www.cksde.com/p_6_250.htm"},VOCODER_MODULATOR:"modulator.mp3",DEFAULT_BUFFER_SIZE:0,VALID_BUFFER_SIZE:[0,256,512,1024,2048,4096,8192,16384],VALID_MP3_BITRATES:[32,64,96,128,160,256,320],DEFAULT_SAMPLE_RATE:0,VALID_SAMPLE_RATES:[0,8e3,11025,16e3,22050,32e3,44100,48e3,88200,96e3,176400,192e3],TREATMENT_TIME_COUNTING_THROTTLE_INTERVAL:100,TREATMENT_TIME_COUNTING_SMOOTHING_FACTOR:.9,DISABLE_INITIAL_RENDERING:!1,DEFAULT_SAVE_FORMAT:"wav",DEFAULT_MP3_BITRATE:320};function jt(e){return new Worker((e||"")+"RecorderWorker.js")}let qt=class{constructor(e){this.worker=null,this.node=null,this.context=null,this.config={bufferLen:4096,sampleRate:44100,numChannels:2,mimeType:"audio/wav",workletBasePath:"worklets/",workerBasePath:"workers/",bitrate:Ht.DEFAULT_MP3_BITRATE,callback:()=>{}},this.callbacks={getBuffer:[],exportWAV:[],exportMP3:[]},this.recording=!1,Object.assign(this.config,e)}setup(e){return i(this,void 0,void 0,(function*(){this.node&&(this.node instanceof AudioWorkletNode&&this.node.port.postMessage("stop"),this.node.disconnect()),e&&(this.context=e.context,yield this.createRecorderNode(),this.node&&this.context&&(e.connect(this.node),this.node.connect(this.context.destination))),this.context&&!this.worker&&(this.worker=jt(this.config.workerBasePath),this.worker&&(this.worker.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:this.config.numChannels,bitrate:this.config.bitrate}}),this.worker.onmessage=e=>{let t=null;switch(e.data.command){case"getBuffer":t=this.callbacks.getBuffer;break;case Ht.EXPORT_WAV_COMMAND:t=this.callbacks.exportWAV;break;case Ht.EXPORT_MP3_COMMAND:t=this.callbacks.exportMP3}if(t){const r=t.pop();"function"==typeof r&&r(e.data.data)}}))}))}createRecorderNode(){return i(this,void 0,void 0,(function*(){if(this.context)if(Ct.isAudioWorkletCompatible(this.context)&&Ht.ENABLE_RECORDER_AUDIO_WORKLET)try{yield this.createRecorderWorklet()}catch(e){console.error(e),this.createRecorderScriptProcessorNode()}else this.createRecorderScriptProcessorNode()}))}createRecorderWorklet(){return i(this,void 0,void 0,(function*(){if(this.context&&(yield this.context.audioWorklet.addModule(this.config.workletBasePath+Ht.WORKLET_PATHS.RECORDER_WORKLET),this.node=new AudioWorkletNode(this.context,Ht.WORKLET_NAMES.RECORDER_WORKLET),this.node&&this.node.port)){const e=this.node.parameters.get("numChannels");e&&(e.value=this.config.numChannels,e.setValueAtTime(this.config.numChannels,0)),this.node.port.onmessage=e=>{this.worker&&"record"==e.data.command&&e.data.buffer.length>0&&this.worker.postMessage({command:"record",buffer:e.data.buffer})}}}))}createRecorderScriptProcessorNode(){this.context&&(this.node=this.context.createScriptProcessor.call(this.context,this.config.bufferLen,this.config.numChannels,this.config.numChannels),this.node.onaudioprocess=e=>{if(!this.recording)return;const t=[];for(let r=0;r<this.config.numChannels;r++)t.push(e.inputBuffer.getChannelData(r));this.worker&&this.worker.postMessage({command:"record",buffer:t})})}record(){this.recording=!0,this.node instanceof AudioWorkletNode&&this.node.port.postMessage("record")}stop(){this.recording=!1,this.node instanceof AudioWorkletNode&&this.node.port.postMessage("stop")}clear(){this.worker&&this.worker.postMessage({command:"clear"})}kill(){this.clear(),this.stop(),this.worker&&this.worker.terminate()}getBuffer(e){if(!(e=e||this.config.callback))throw new Error("Callback not set");this.callbacks.getBuffer.push(e),this.worker&&this.worker.postMessage({command:"getBuffer"})}exportWAV(e,t){if(t=t||this.config.mimeType,!(e=e||this.config.callback))throw new Error("Callback not set");this.callbacks.exportWAV.push(e),this.worker&&this.worker.postMessage({command:Ht.EXPORT_WAV_COMMAND,type:t})}exportMP3(e,t){if(t=t||this.config.mimeType,!(e=e||this.config.callback))throw new Error("Callback not set");this.callbacks.exportMP3.push(e),this.worker&&this.worker.postMessage({command:Ht.EXPORT_MP3_COMMAND,type:t})}};qt=e([te(),r("design:paramtypes",[Object])],qt);var Wt=qt;let Yt=class extends Nt{constructor(e,t){super(),this.recorder=null,this.input=null,this.stream=null,this.alreadyInit=!1,this.timer=null,this.enableAudioFeedback=!1,this.recording=!1,this.deviceList=[],this.constraints={audio:{noiseSuppression:!0,echoCancellation:!0,autoGainControl:!0,sampleRate:{ideal:44100}}},this.sampleRateConfigNotSupported=!1,this.contextManager=e,this.configService=t}init(){return i(this,void 0,void 0,(function*(){var e;if(this.isRecordingAvailable()){this.sampleRateConfigNotSupported=!navigator.mediaDevices.getSupportedConstraints().sampleRate,this.contextManager&&(this.sampleRateConfigNotSupported?this.contextManager.createNewContext(0):this.contextManager.createNewContextIfNeeded()),null===(e=this.eventEmitter)||void 0===e||e.emit(exports.EventType.RECORDER_INIT);try{const e=yield navigator.mediaDevices.getUserMedia(this.constraints);this.contextManager&&this.contextManager.currentContext&&this.contextManager.currentContext.resume(),yield this.setup(e,!1,!1),this.alreadyInit=!0,this.timer=new Gt(0,1),this.timer.onCount((()=>{var e;null===(e=this.eventEmitter)||void 0===e||e.emit(exports.EventType.RECORDER_COUNT_UPDATE)})),this.successCallback()}catch(e){console.error(e);if(e)switch(e.name){case"SecurityError":case"NotAllowedError":this.errorCallback();break;case"NotFoundError":this.notFoundErrorCallback();break;case"NotSupportedError":this.sampleRateConfigNotSupported||(this.sampleRateConfigNotSupported=!0,this.init());break;default:this.unknownErrorCallback()}}navigator.mediaDevices.ondevicechange=()=>this.updateInputList()}}))}successCallback(){var e;null===(e=this.eventEmitter)||void 0===e||e.emit(exports.EventType.RECORDER_SUCCESS)}errorCallback(){var e;null===(e=this.eventEmitter)||void 0===e||e.emit(exports.EventType.RECORDER_ERROR)}notFoundErrorCallback(){var e;null===(e=this.eventEmitter)||void 0===e||e.emit(exports.EventType.RECORDER_NOT_FOUND_ERROR)}unknownErrorCallback(){var e;null===(e=this.eventEmitter)||void 0===e||e.emit(exports.EventType.RECORDER_UNKNOWN_ERROR)}audioFeedback(e){var t;this.contextManager&&this.contextManager.currentContext&&(e?(this.input&&this.input.connect(this.contextManager.currentContext.destination),this.enableAudioFeedback=!0):(this.input&&(this.input.connect(this.contextManager.currentContext.destination),this.input.disconnect(this.contextManager.currentContext.destination)),this.enableAudioFeedback=!1),null===(t=this.eventEmitter)||void 0===t||t.emit(exports.EventType.RECORDER_UPDATE_CONSTRAINTS))}getConstraints(){if(this.stream){const e=this.stream.getTracks();if(e&&e.length>0)return e[0].getSettings()}return null}updateConstraints(){var e;const t=this.getConstraints();t&&(this.constraints.audio=Object.assign(this.constraints.audio,t),null===(e=this.eventEmitter)||void 0===e||e.emit(exports.EventType.RECORDER_UPDATE_CONSTRAINTS))}resetConstraints(e){return i(this,void 0,void 0,(function*(){if(this.stream){const t=this.enableAudioFeedback,r=this.recording,i=this.stream.getTracks();if(e&&(this.updateConstraints(),this.constraints.audio=Object.assign(this.constraints.audio,e.audio)),i&&i.length>0)try{yield i[0].applyConstraints(this.constraints.audio);const n=this.getConstraints(),s=e?Object.keys(e.audio)[0]:"";if(this.audioFeedback(!1),this.pause(),!e||n&&n[s]!=e.audio[s]){this.stopStream();const e=yield navigator.mediaDevices.getUserMedia(this.constraints);yield this.setup(e,r,t)}else yield this.setup(null,r,t)}catch(e){console.error(e),this.errorCallback()}}}))}setup(e,t,r){return i(this,void 0,void 0,(function*(){e&&this.contextManager&&this.contextManager.currentContext&&(this.input=this.contextManager.currentContext.createMediaStreamSource(e),this.stream=e),this.recorder&&this.input&&(yield this.recorder.setup(this.input),t&&(yield this.record())),this.audioFeedback(r),this.updateConstraints(),yield this.updateInputList()}))}setNoiseSuppression(e){this.resetConstraints({audio:{noiseSuppression:e}})}setAutoGain(e){this.resetConstraints({audio:{autoGainControl:e}})}setEchoCancellation(e){this.resetConstraints({audio:{echoCancellation:e}})}updateInputList(){return i(this,void 0,void 0,(function*(){if(this.deviceList){const e=yield navigator.mediaDevices.enumerateDevices();this.deviceList=[],e.forEach((e=>{"audioinput"==e.kind&&this.deviceList.push(e)}))}}))}changeInput(e,t){t&&(this.constraints.audio.deviceId=e,this.constraints.audio.groupId=t,this.resetConstraints())}record(){return i(this,void 0,void 0,(function*(){this.alreadyInit&&this.configService&&this.input&&(this.recorder||(this.recorder=new Wt({bufferLen:this.configService.getBufferSize(),sampleRate:this.configService.getSampleRate(),numChannels:2,workletBasePath:this.configService.getWorkletBasePath(),workerBasePath:this.configService.getWorkerBasePath(),mimeType:"audio/wav"}),yield this.recorder.setup(this.input)),this.recorder&&this.recorder.record(),this.timer&&this.timer.start(),this.recording=!0,this.eventEmitter&&this.eventEmitter.emit(exports.EventType.RECORDER_RECORDING))}))}stop(){this.alreadyInit&&this.recorder&&(this.recorder.stop(),this.timer&&this.timer.stop(),this.recording=!1,this.recorder.getBuffer((e=>{var t;if(this.contextManager&&this.contextManager.currentContext){this.contextManager.currentContext.resume();const r=this.contextManager.currentContext.createBuffer(2,e[0].length,this.contextManager.currentContext.sampleRate);r.getChannelData(0).set(e[0]),r.getChannelData(1).set(e[1]),null===(t=this.eventEmitter)||void 0===t||t.emit(exports.EventType.RECORDER_STOPPED,r),this.reset()}})))}pause(){var e;this.alreadyInit&&(this.recorder&&this.recorder.stop(),this.timer&&this.timer.stop(),this.recording=!1,null===(e=this.eventEmitter)||void 0===e||e.emit(exports.EventType.RECORDER_PAUSED))}stopStream(){if(this.stream){const e=this.stream.getTracks();for(let t=0,r=e.length;t<r;t++)e[t].stop()}}reset(){var e;this.recorder&&this.recorder.kill(),this.timer&&this.timer.stop(),this.audioFeedback(!1),this.stopStream(),this.input=null,this.recorder=null,this.stream=null,this.alreadyInit=!1,this.timer=null,null===(e=this.eventEmitter)||void 0===e||e.emit(exports.EventType.RECORDER_RESETED)}get currentTimeDisplay(){var e,t,r;return(null===(e=this.timer)||void 0===e?void 0:e.seconds)?("0"+Math.trunc((null===(t=this.timer)||void 0===t?void 0:t.seconds)/60)).slice(-2)+":"+("0"+Math.trunc((null===(r=this.timer)||void 0===r?void 0:r.seconds)%60)).slice(-2):"00:00"}get currentTime(){return this.timer?this.timer.seconds:0}getSettings(){return{deviceList:this.deviceList,audioFeedback:this.enableAudioFeedback,constraints:this.constraints.audio}}on(e,t){var r;null===(r=this.eventEmitter)||void 0===r||r.on(e,t)}isRecordingAvailable(){return void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia}};Yt=e([te(),ne(),t(0,$(xt.AudioContextManager)),t(1,$(xt.ConfigService)),r("design:paramtypes",[Object,Object])],Yt);var Xt=Yt;let Kt=class extends Nt{constructor(){super(...arguments),this.enabled=!1,this.defaultEnabled=!1}isEnabled(){return this.enabled}isDefaultEnabled(){return this.defaultEnabled}setDefaultEnabled(e){this.defaultEnabled=e,e?this.enable():this.disable()}setEnabled(e){this.enabled=e}enable(){this.setEnabled(!0)}disable(){this.setEnabled(!1)}toggle(){this.setEnabled(!this.isEnabled())}};Kt=e([te()],Kt);var zt=Kt;class Zt extends zt{constructor(){super(...arguments),this.defaultSettings=null,this._totalSamples=0}getAddingTime(){return 0}initializeDefaultSettings(){this.defaultSettings=this.getSettings()}getDefaultSettings(){return this.defaultSettings}resetSettings(){return i(this,void 0,void 0,(function*(){if(this.defaultSettings)for(const e in this.defaultSettings)this.defaultSettings&&void 0!==this.defaultSettings[e]&&(yield this.setSetting(e,this.defaultSettings[e]))}))}isWorklet(){return!1}bufferFetcherReseted(){return Promise.resolve(!1)}set totalSamples(e){this._totalSamples=e}}class Qt{constructor(e,t){this._value=0,this._minValue=0,this._maxValue=Number.MAX_SAFE_INTEGER,this._defaultValue=0,this.context=null,this.automationRate="a-rate",this._defaultValue=void 0!==t?t:0,this._value=this._defaultValue,this.context=e}get value(){return this._value}set value(e){this._value=Math.max(this._minValue,Math.min(this._maxValue,e))}get minValue(){return this._minValue}get maxValue(){return this._maxValue}get defaultValue(){return this._defaultValue}setValueAtTime(e,t){return console.warn("setValueAtTime used with AudioParamPolyfill, is not fully compatible with standard AudioParam"),this.value=e,new Qt(this.context,e)}linearRampToValueAtTime(e,t){return console.warn("linearRampToValueAtTime used with AudioParamPolyfill, is not fully compatible with standard AudioParam"),this.value=e,new Qt(this.context,e)}exponentialRampToValueAtTime(e,t){return console.warn("exponentialRampToValueAtTime used with AudioParamPolyfill, is not fully compatible with standard AudioParam"),this.value=e,new Qt(this.context,e)}cancelAndHoldAtTime(e){throw new Error("Method not implemented.")}cancelScheduledValues(e){throw new Error("Method not implemented.")}setTargetAtTime(e,t,r){throw new Error("Method not implemented.")}setValueCurveAtTime(e,t,r){throw new Error("Method not implemented.")}}class $t{constructor(e,t,r){this._parameters=new Map,this._port=null,this.currentContext=null,this.workletProcessor=t,this.currentContext=e,this._scriptProcessorNode=e.createScriptProcessor(r,e.destination.channelCount,e.destination.channelCount),this.setupPort(),this.setupProcessor(),this.setupWorkletScope(e)}setupPort(){const e=new MessageChannel;e.port1.onmessage=e=>{this.workletProcessor&&this.workletProcessor.port2&&this.workletProcessor.port2.postMessage(e.data),e&&"stop"===e.data&&this.stop()},this.workletProcessor&&this.workletProcessor.port2&&(this.workletProcessor.port2.onmessage=t=>{e.port1.postMessage(t.data)}),this._port=e.port2}setupProcessor(){if(!this._scriptProcessorNode||!this.workletProcessor)return;this._scriptProcessorNode.onaudioprocess=e=>{if(this.workletProcessor){const t=[Ct.convertAudioBufferToFloat32Array(e.inputBuffer)],r=[Ct.convertAudioBufferToFloat32Array(e.outputBuffer)],i=[];for(const[e,t]of this._parameters.entries())i.push([e,Ct.convertAudioParamToFloat32Array(t,1)]);const n=Object.fromEntries(i);this.workletProcessor.process(t,r,n)}};const e=this.workletProcessor.defaultParameterDescriptors;e&&e.forEach((e=>{this.currentContext&&this._parameters.set(e.name,new Qt(this.currentContext,e.defaultValue))}))}setupWorkletScope(e){"undefined"!=typeof window&&(window.sampleRate=e.sampleRate)}stop(){this._scriptProcessorNode=null,this._port=null,this._parameters=new Map,this.currentContext=null,this.workletProcessor=null}get port(){return this._port}get parameters(){return this._parameters}get node(){return this._scriptProcessorNode}get context(){var e;return null===(e=this._scriptProcessorNode)||void 0===e?void 0:e.context}}class Jt{static registerProcessor(e,t){Jt.processorsMap.set(e,t)}static getProcessor(e){const t=Jt.processorsMap.get(e);return t?new t:null}}Jt.processorsMap=new Map;class er{constructor(){this.messageChannel=null,this.messageChannel=new MessageChannel}process(e,t,r){return!0}get port(){return this.messageChannel&&this.messageChannel.port1}get port2(){return this.messageChannel&&this.messageChannel.port2}get parameters(){throw new Error("Method not implemented.")}get parameterDescriptors(){throw new Error("Method not implemented.")}get defaultParameterDescriptors(){return[]}}"undefined"==typeof window||"AudioWorkletProcessor"in window||(window.AudioWorkletProcessor=er,window.registerProcessor=Jt.registerProcessor),"undefined"==typeof global||"AudioWorkletProcessor"in global||(global.AudioWorkletProcessor=er,global.registerProcessor=Jt.registerProcessor);class tr extends Zt{constructor(){super(...arguments),this.currentWorkletNode=null,this.fallbackToScriptProcessor=!1,this.keepCurrentNodeIfPossible=!1,this.loadedModulesMap=new WeakMap}initializeWorklet(e){return i(this,void 0,void 0,(function*(){if(this.stop(),!Ct.isAudioWorkletCompatible(e))return console.error("Audio Worklets not supported on this browser. Fallback to ScriptProcessor"),void(this.fallbackToScriptProcessor=!0);const t=(this.configService?this.configService.getWorkletBasePath():"")+this.workletPath,r=this.loadedModulesMap.get(e);r&&r.has(t)||(yield e.audioWorklet.addModule(t).then((()=>{const i=null!=r?r:new Set;r||this.loadedModulesMap.set(e,i),i.add(t),this.eventEmitter&&this.eventEmitter.emit(exports.EventType.WORKLET_SUCCESSFULLY_LOADED)})).catch((e=>{console.error(`Error when loading Worklet (${t}) for filter ${this.id}. Fallback to ScriptProcessor. Exception:`,e),this.fallbackToScriptProcessor=!0,this.eventEmitter&&this.eventEmitter.emit(exports.EventType.FALLBACK_WORKLET_TO_SCRIPT_PROCESSOR)})))}))}isAudioWorkletEnabled(){return this.configService?this.configService.isAudioWorkletEnabled():Ht.ENABLE_AUDIO_WORKLET}isAudioWorkletAvailable(){return this.isAudioWorkletEnabled()&&!this.fallbackToScriptProcessor}initializeNode(e,t){if(this.isAudioWorkletAvailable())this.currentWorkletNode=new AudioWorkletNode(e,t);else{const r=Jt.getProcessor(t);if(!r)throw new Error(`No processor registered with name ${t} for filter ${this.id} to use the fallback/polyfill for AudioWorklet. Make sure you have created the class.`);this.currentWorkletNode=new $t(e,r,this.configService.getBufferSize())}this.currentWorkletNode&&this.currentWorkletNode.port&&(this.currentWorkletNode.port.onmessage=e=>this.receiveEvent(e))}applyCurrentSettingsToWorklet(){const e=this.getSettings();for(const t of Object.keys(e))this.setWorkletSetting(t,e[t])}setWorkletSetting(e,t){if(this.currentWorkletNode&&this.currentWorkletNode.parameters){const r=this.currentWorkletNode.parameters.get(e);r&&(r.value=t,r.setValueAtTime(t,0))}}getNode(e){if(this.keepCurrentNodeIfPossible&&this.currentWorkletNode&&this.currentWorkletNode.context==e||(this.stop(),this.initializeNode(e,this.workletName)),this.applyCurrentSettingsToWorklet(),this.setEnabled(this.isEnabled()),this.currentWorkletNode)return this.currentWorkletNode instanceof $t?{input:this.currentWorkletNode.node,output:this.currentWorkletNode.node}:{input:this.currentWorkletNode,output:this.currentWorkletNode};throw new Error("Worklet node has not yet been created")}stop(){this.currentWorkletNode&&this.currentWorkletNode.port&&(this.currentWorkletNode.port.postMessage("stop"),this.currentWorkletNode.port.close(),this.currentWorkletNode.port.onmessage=null),this.currentWorkletNode=null}setEnabled(e){this.currentWorkletNode&&this.currentWorkletNode.port&&this.currentWorkletNode.port.postMessage(e?"enable":"disable"),super.setEnabled(e)}isWorklet(){return!0}}class rr extends zt{}let ir=class{constructor(){this._listeners={},this._listeners={}}on(e,t){this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t)}emit(e,t){return i(this,void 0,void 0,(function*(){if(this._listeners[e])for(const r of this._listeners[e])yield r(t)}))}off(e,t){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter((e=>e!==t)))}get listeners(){return this._listeners}set listeners(e){this._listeners=e}};ir=e([te(),r("design:paramtypes",[])],ir);var nr=ir;let sr=class{constructor(){this.mapConfig=new Map,this.workerBasePath="",this.workletBasePath="",this.soundBasePath=""}getConfig(e){return this.mapConfig.get(e)}setConfig(e,t){this.mapConfig.set(e,t)}isCompatibilityModeEnabled(){return"true"==this.getConfig(Ht.PREFERENCES_KEYS.COMPATIBILITY_MODE_ENABLED)}isCompatibilityModeChecked(){return"true"==this.getConfig(Ht.PREFERENCES_KEYS.COMPATIBILITY_MODE_CHECKED)}isAudioWorkletEnabled(){const e=this.getConfig(Ht.PREFERENCES_KEYS.ENABLE_AUDIO_WORKLET);return null!=e?"true"==e:Ht.ENABLE_AUDIO_WORKLET}isSoundtouchAudioWorkletEnabled(){const e=this.getConfig(Ht.PREFERENCES_KEYS.ENABLE_SOUNDTOUCH_AUDIO_WORKLET);return null!=e?"true"==e:Ht.ENABLE_SOUNDTOUCH_AUDIO_WORKLET}getBufferSize(){const e=this.getConfig(Ht.PREFERENCES_KEYS.BUFFER_SIZE);return null!=e?parseInt(e,10):Ht.DEFAULT_BUFFER_SIZE}getSampleRate(){const e=this.getConfig(Ht.PREFERENCES_KEYS.SAMPLE_RATE);return null!=e?parseInt(e,10):Ht.DEFAULT_SAMPLE_RATE}getBitrateMP3(){const e=this.getConfig(Ht.PREFERENCES_KEYS.BITRATE_MP3);return null!=e?parseInt(e,10):Ht.DEFAULT_MP3_BITRATE}enableCompatibilityMode(){this.setConfig(Ht.PREFERENCES_KEYS.COMPATIBILITY_MODE_ENABLED,"true")}disableCompatibilityMode(){this.setConfig(Ht.PREFERENCES_KEYS.COMPATIBILITY_MODE_ENABLED,"false")}getWorkletBasePath(){return this.workletBasePath}getWorkerBasePath(){return this.workerBasePath}getSoundBasePath(){return this.soundBasePath}setWorkletBasePath(e){this.workletBasePath=e}setWorkerBasePath(e){this.workerBasePath=e}setSoundBasePath(e){this.soundBasePath=e}isInitialRenderingDisabled(){const e=this.getConfig(Ht.PREFERENCES_KEYS.DISABLE_INITIAL_RENDERING);return null!=e?"true"==e:Ht.DISABLE_INITIAL_RENDERING}};sr=e([te()],sr);var ar=sr;let or=class{constructor(e,t){this.previousSampleRate=Ht.DEFAULT_SAMPLE_RATE,this.eventEmitter=e||new nr,this.configService=t}setup(){this.configService&&(this.previousSampleRate=this.configService.getSampleRate(),this.eventEmitter&&this.eventEmitter.emit(exports.EventType.SAMPLE_RATE_CHANGED,this.previousSampleRate)),this.currentContext||this.createNewContext(this.previousSampleRate)}createNewContextIfNeeded(e){if(this.configService&&this.configService.isCompatibilityModeEnabled()&&e){if(this.currentSampleRate!=e.sampleRate)return this.createNewContext(e.sampleRate),!0}else{let e=Ht.DEFAULT_SAMPLE_RATE;if(this.configService&&(e=this.configService.getSampleRate()),e!=this.previousSampleRate)return this.createNewContext(e),!0}return!1}createNewContext(e){this._currentContext&&this._currentContext.close();const t={latencyHint:"interactive"};0!=e&&(t.sampleRate=e),this._currentContext=new AudioContext(t),this.eventEmitter&&this.eventEmitter.emit(exports.EventType.SAMPLE_RATE_CHANGED,this.currentSampleRate),this.previousSampleRate=e}createOfflineAudioContext(e,t,r){const i=document.createElement("iframe");i.style.display="none",document.body.appendChild(i);const n=i.contentWindow;if(!n)throw new Error("Failed to create isolated OfflineAudioContext");const s=new(0,n.OfflineAudioContext)(e,t,r);return s.addEventListener("complete",(()=>{setTimeout((()=>document.body.removeChild(i)))})),s}get currentSampleRate(){return this.currentContext?this.currentContext.sampleRate:0}get currentContext(){return this._currentContext}};e([ae(),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",void 0)],or.prototype,"setup",null),or=e([te(),t(0,$(xt.EventEmitter)),t(1,$(xt.ConfigService)),r("design:paramtypes",[Object,Object])],or);var lr=or;let ur=class extends Nt{constructor(e,t,r,i){super(),this._renderedBuffer=null,this.audioRenderingLastCanceled=!1,this.initialRenderingDone=!1,this.sumInputBuffer=0,this.bufferPlayer=r,this.filterManager=e,this.rendererManager=t,this.bufferManager=i}prepareContext(e){return i(this,void 0,void 0,(function*(){if(this.contextManager){this.contextManager.createNewContextIfNeeded(e)&&this.bufferManager&&(yield this.bufferManager.resetBufferFetcher()),this.contextManager.currentContext&&this.contextManager.currentContext.resume()}}))}updateAudioSpeedAndDuration(e){if(this.eventEmitter){if(this.filterManager&&this.filterManager.entrypointFilter){const e=this.filterManager.entrypointFilter.getSpeed();this.eventEmitter.emit(exports.EventType.AUDIO_SPEED_UPDATED,e)}null!=e&&this.eventEmitter.emit(exports.EventType.AUDIO_DURATION_UPDATED,e)}}resetAudioRenderingProgress(){this.eventEmitter&&(this.eventEmitter.emit(exports.EventType.UPDATE_AUDIO_TREATMENT_PERCENT,0),this.eventEmitter.emit(exports.EventType.UPDATE_REMAINING_TIME_ESTIMATED,-1)),this.filterManager&&this.filterManager.disableFilter(Ht.FILTERS_NAMES.RENDERING_PROGRESS_CALCULATION)}startRenderingProgressCalculation(){this.filterManager&&this.filterManager.enableFilter(Ht.FILTERS_NAMES.RENDERING_PROGRESS_CALCULATION)}renderAudio(e,t){return i(this,void 0,void 0,(function*(){if(yield this.prepareContext(e),!this.contextManager||!this.contextManager.currentContext)throw new Error("AudioContext is not yet available");if(!this.filterManager)throw new Error("Filter manager is not available");if(!this.rendererManager)throw new Error("Renderer manager is not available");if(!this.filterManager.entrypointFilter)throw new Error("Entrypoint filter is not available");if(!e)throw new Error("No principal buffer available");if(this.eventEmitter&&this.eventEmitter.emit(exports.EventType.AUDIO_SPEED_UPDATED,1),!this.initialRenderingDone&&this.configService&&this.configService.isInitialRenderingDisabled()&&!this.configService.isCompatibilityModeEnabled()&&!t)return this.loadInitialBuffer(e),this.initialRenderingDone=!0,!0;this.configService&&this.bufferPlayer&&!this.configService.isCompatibilityModeEnabled()&&this.bufferPlayer.compatibilityMode&&this.bufferPlayer.stop(),this.currentOfflineContext=null,this.audioRenderingLastCanceled=!1;const r=this.filterManager.entrypointFilter.getSpeed(),i=Ct.calculateAudioDuration(e,this.filterManager,r),n=this.configService&&this.configService.isCompatibilityModeEnabled()?this.contextManager.currentContext:this.contextManager.createOfflineAudioContext(2,this.contextManager.currentContext.sampleRate*i,this.contextManager.currentContext.sampleRate);return this._renderedBuffer=yield this.rendererManager.executeAudioRenderers(e,n),this.resetAudioRenderingProgress(),this.filterManager.setupTotalSamples(i,this.contextManager.currentContext),this.setupOutput(e,n,i)}))}setupOutput(e,t,r){return i(this,void 0,void 0,(function*(){if(this._renderedBuffer&&this.configService&&this.eventEmitter&&this.bufferPlayer&&this.filterManager){const i=this.configService.isCompatibilityModeEnabled();if(i||this.startRenderingProgressCalculation(),yield this.filterManager.initializeWorklets(t),yield this.filterManager.connectNodes(t,this._renderedBuffer,!1,this.configService.isCompatibilityModeEnabled()),!i&&this.filterManager.currentNodes){const i=t;this.currentOfflineContext=i,this.filterManager.currentNodes.output.connect(t.destination);const n=yield i.startRendering();if(this.cleanupAfterOfflineRendering(),this.contextManager&&!this.loadRenderedAudio(e,n))return this.setupOutput(e,this.contextManager.currentContext,r);if(this.audioRenderingLastCanceled)return!1;this.eventEmitter.emit(exports.EventType.OFFLINE_AUDIO_RENDERING_FINISHED)}else this.filterManager.currentNodes&&(this.bufferPlayer.setCompatibilityMode(this.filterManager.currentNodes.output),this.updateAudioSpeedAndDuration(r),this.initialRenderingDone=!0);return this.eventEmitter&&this.eventEmitter.emit(exports.EventType.AUDIO_RENDERING_FINISHED),!0}return!1}))}cancelAudioRendering(){this.currentOfflineContext&&!this.audioRenderingLastCanceled&&this.filterManager&&(this.audioRenderingLastCanceled=!0,this.filterManager.disconnectOldNodes(!1),this.eventEmitter&&this.eventEmitter.emit(exports.EventType.CANCELLING_AUDIO_PROCESSING))}cleanupAfterOfflineRendering(){this.filterManager&&(this.filterManager.clearWorklets(),this.filterManager.disconnectOldNodes(!1)),this.currentOfflineContext&&(this.currentOfflineContext.destination.disconnect(),this.currentOfflineContext=null)}loadRenderedAudio(e,t){if(this.eventEmitter&&this.bufferPlayer){if(this.audioRenderingLastCanceled)this.initialRenderingDone||(this.loadInitialBuffer(e),this.eventEmitter.emit(exports.EventType.CANCELLED_AND_LOADED_INITIAL_AUDIO));else{if(0==Ct.sumAudioBuffer(t)&&0!==this.sumInputBuffer){if(this.configService&&!this.configService.isCompatibilityModeChecked())return this.setCompatibilityModeChecked(!0),this.configService.enableCompatibilityMode(),this.eventEmitter.emit(exports.EventType.COMPATIBILITY_MODE_AUTO_ENABLED),console.warn("Compatibility mode has been automatically enabled because a problem has been detected with the web browser."),!1;this.eventEmitter.emit(exports.EventType.RENDERING_AUDIO_PROBLEM_DETECTED)}this._renderedBuffer=t,this.bufferPlayer.loadBuffer(this._renderedBuffer),this.updateAudioSpeedAndDuration(null)}this.initialRenderingDone=!0}return!0}loadInitialBuffer(e){this.bufferPlayer&&(this._renderedBuffer=e,this.bufferPlayer.loadBuffer(e))}clearRenderedBuffer(){Ct.clearAudioBuffer(this._renderedBuffer),this._renderedBuffer=null}setCompatibilityModeChecked(e){this.configService&&this.configService.setConfig(Ht.PREFERENCES_KEYS.COMPATIBILITY_MODE_CHECKED,String(e))}get renderedBuffer(){return this._renderedBuffer}};ur=e([te(),ne(),t(0,$(xt.FilterManager)),t(1,$(xt.RendererManager)),t(2,$(xt.BufferPlayer)),t(3,$(xt.BufferManager)),r("design:paramtypes",[Object,Object,Object,Object])],ur);var cr=ur;let hr=class extends Nt{constructor(e,t,r,i){super(),this.downloadingInitialData=!1,this.audioBuffersToFetch=[],this.bufferFetcherService=t,this.eventEmitter=r,this.filterManager=e,this.filterManager=e,this.audioBuffersToFetch=i}setup(){this.audioBuffersToFetch.length>0&&this.fetchBuffers(!1)}fetchBuffers(e){return i(this,void 0,void 0,(function*(){if(!this.downloadingInitialData&&this.bufferFetcherService){this.downloadingInitialData=!0,this.eventEmitter&&!e&&this.eventEmitter.emit(exports.EventType.LOADING_BUFFERS);try{yield this.bufferFetcherService.fetchAllBuffers(this.audioBuffersToFetch),this.downloadingInitialData=!1,this.eventEmitter&&!e&&this.eventEmitter.emit(exports.EventType.LOADED_BUFFERS)}catch(t){console.error(t),this.eventEmitter&&!e&&this.eventEmitter.emit(exports.EventType.LOADING_BUFFERS_ERROR)}}}))}resetBufferFetcher(){return i(this,void 0,void 0,(function*(){this.bufferFetcherService&&(this.bufferFetcherService.reset(),yield this.fetchBuffers(!0),this.filterManager&&(yield this.filterManager.resetFilterBuffers()))}))}};e([ae(),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",void 0)],hr.prototype,"setup",null),hr=e([te(),ne(),t(0,$(xt.FilterManager)),t(1,$(xt.BufferFetcherService)),t(2,$(xt.EventEmitter)),t(3,$(xt.AudioBuffersToFetch)),r("design:paramtypes",[Object,Object,Object,Array])],hr);var fr=hr;let dr=class extends Nt{constructor(e,t){super(),this.filters=[],this._entryPointFilter=null,this._currentNodes=null,this.filters=e,this._entryPointFilter=t}setup(){this.initializeFilters(this.filters)}addFilters(...e){this.initializeFilters(e),this.filters.push(...e)}initializeFilters(e){for(const t of e)t.initializeDefaultSettings(),t.injectDependencies(this.bufferFetcherService,this.bufferDecoderService,this.configService,this.eventEmitter,this.contextManager)}getFiltersState(){const e={};return this.filters.forEach((t=>{e[t.id]=t.isEnabled()})),e}getFiltersSettings(){const e=new Map;for(const t of this.filters)e.set(t.id,t.getSettings());return e}enableFilter(e){const t=this.filters.find((t=>t.id===e));t&&t.enable()}disableFilter(e){const t=this.filters.find((t=>t.id===e));t&&t.disable()}toggleFilter(e){const t=this.filters.find((t=>t.id===e));t&&t.toggle()}changeFilterSettings(e,t){return i(this,void 0,void 0,(function*(){const r=this.filters.find((t=>t.id===e));if(r)for(const e of Object.keys(t))yield r.setSetting(e,t[e])}))}resetFilterSettings(e){return i(this,void 0,void 0,(function*(){const t=this.filters.find((t=>t.id===e));t&&(yield t.resetSettings())}))}resetAllFiltersState(){this.filters.forEach((e=>{e.isDefaultEnabled()?e.enable():e.disable()}))}connectNodes(e,t,r,n){return i(this,void 0,void 0,(function*(){if(!this._entryPointFilter)return;let i=null;if(r&&this._currentNodes)i=this._currentNodes.input;else{const r=yield this._entryPointFilter.getEntrypointNode(e,t,!n);i=r.input}const s=[];let a=i;this.disconnectOldNodes(r);const o=this.filters.sort(((e,t)=>e.order-t.order)).filter(((e,t)=>e!==this._entryPointFilter&&(e.isEnabled()||t>=this.filters.length-1)));for(const t of o){const r=t.getNode(e);a&&a.connect(r.input),a=r.output,s.push(r)}this._entryPointFilter&&this._entryPointFilter.updateState(),this._currentNodes={input:i,output:a,intermediateNodes:s.filter((e=>e.input!=a&&e.output!=a&&e.input!=i&&e.output!=i))}}))}disconnectOldNodes(e){this._currentNodes&&(this._currentNodes.input.disconnect(),e||this._currentNodes.output.disconnect(),this.disconnecteIntermediateNodes())}disconnecteIntermediateNodes(){if(this._currentNodes&&this._currentNodes.intermediateNodes){for(const e of this._currentNodes.intermediateNodes)e.input.disconnect(),e.output.disconnect();this._currentNodes.intermediateNodes=void 0}}initializeWorklets(e){return i(this,void 0,void 0,(function*(){for(const t of this.filters)t.isWorklet()&&(this.clearWorklets(),yield t.initializeWorklet(e))}))}clearWorklets(){for(const e of this.filters)e.isWorklet()&&e.stop()}getAddingTime(){let e=0;for(const t of this.filters)t.isEnabled()&&(e+=t.getAddingTime());return e}setupTotalSamples(e,t){if(t){const r=e*t.sampleRate;for(const e of this.filters)e.totalSamples=r}}resetFilterBuffers(){return i(this,void 0,void 0,(function*(){for(const e of this.filters)yield e.bufferFetcherReseted()}))}get entrypointFilter(){return this._entryPointFilter}get currentNodes(){return this._currentNodes}};e([ae(),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",void 0)],dr.prototype,"setup",null),dr=e([te(),ne(),t(0,se(xt.Filters)),t(1,$(xt.EntryPointFilter)),r("design:paramtypes",[Array,Object])],dr);var _r=dr;let pr=class extends Nt{constructor(e=[]){super(),this.renderers=[],this.renderers=e}setup(){this.initializeRenderers(this.renderers)}addRenderers(...e){this.initializeRenderers(e),this.renderers.push(...e)}initializeRenderers(e){for(const t of e)t.injectDependencies(this.bufferFetcherService,this.bufferDecoderService,this.configService,this.eventEmitter,this.contextManager)}getRenderersState(){const e={};return this.renderers.forEach((t=>{e[t.id]=t.isEnabled()})),e}enableRenderer(e){const t=this.renderers.find((t=>t.id===e));t&&t.enable()}disableRenderer(e){const t=this.renderers.find((t=>t.id===e));t&&t.disable()}toggleRenderer(e){const t=this.renderers.find((t=>t.id===e));t&&t.toggle()}resetAllRenderersState(){this.renderers.forEach((e=>{e.isDefaultEnabled()?e.enable():e.disable()}))}executeAudioRenderers(e,t){return i(this,void 0,void 0,(function*(){let r=e;for(const e of this.renderers.sort(((e,t)=>e.order-t.order)))e.isEnabled()&&(r=yield e.renderAudio(t,r));return r}))}};e([ae(),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",void 0)],pr.prototype,"setup",null),pr=e([te(),ne(),t(0,se(xt.Renderers)),r("design:paramtypes",[Array])],pr);var mr=pr;let vr=class extends Nt{constructor(e,t){super(),this._savingBuffer=!1,this.playingStoppedCallback=null,this.bufferPlayer=t,this.filterManager=e}setup(){this.eventEmitter&&this.eventEmitter.on(exports.EventType.PLAYING_FINISHED,(()=>{this._savingBuffer&&this.playingStoppedCallback&&this.eventEmitter&&this.eventEmitter.off(exports.EventType.PLAYING_STOPPED,this.playingStoppedCallback)}))}saveBuffer(e,t,r){return i(this,void 0,void 0,(function*(){if(this._savingBuffer)throw new Error("The buffer is currently saving");if(!this.bufferPlayer)throw new Error("No buffer player was found");this._savingBuffer=!0;let i=!1;return i=this.bufferPlayer.compatibilityMode?yield this.saveBufferCompatibilityMode(t,r):yield this.saveBufferDirect(e,t),this._savingBuffer=!1,i}))}saveBufferDirect(e,t){return new Promise(((r,i)=>{var n;if(!e||this.contextManager&&!this.contextManager.currentContext)return void i("No rendered buffer or AudioContext not initialized");const s=jt(null===(n=this.configService)||void 0===n?void 0:n.getWorkerBasePath());if(s){const i=[];for(let t=0;t<e.numberOfChannels;t++)i.push(e.getChannelData(t));s.onmessage=e=>{e.data.command!=Ht.EXPORT_WAV_COMMAND&&e.data.command!=Ht.EXPORT_MP3_COMMAND||this.downloadAudioBlob(e.data.data,t),s.terminate(),this._savingBuffer=!1,r(!0)},s.postMessage({command:Ht.INIT_COMMAND,config:{sampleRate:e.sampleRate,numChannels:2,bitrate:(null==t?void 0:t.bitrate)||Ht.DEFAULT_MP3_BITRATE}}),s.postMessage({command:Ht.RECORD_COMMAND,buffer:i}),s.postMessage({command:"mp3"===(null==t?void 0:t.format)||"mp3"===Ht.DEFAULT_SAVE_FORMAT?Ht.EXPORT_MP3_COMMAND:Ht.EXPORT_WAV_COMMAND,type:Ht.AUDIO_WAV})}}))}saveBufferCompatibilityMode(e,t){return new Promise(((r,i)=>{this.bufferPlayer?this.bufferPlayer.start().then((()=>{if(!this.configService)return i("No config service found");if(!this.filterManager)return i("No filter manager found");if(!this.filterManager.currentNodes)return i("No current nodes found");const n=t||new qt({bufferLen:this.configService.getBufferSize(),sampleRate:this.configService.getSampleRate(),numChannels:2,workletBasePath:this.configService.getWorkletBasePath(),workerBasePath:this.configService.getWorkerBasePath(),mimeType:"mp3"==(null==e?void 0:e.format)?Ht.AUDIO_MP3:Ht.AUDIO_WAV,bitrate:(null==e?void 0:e.bitrate)||Ht.DEFAULT_MP3_BITRATE});n.setup(this.filterManager.currentNodes.output).then((()=>{n.record();const t=()=>{this.playingStoppedCallback&&this.eventEmitter&&this.eventEmitter.off(exports.EventType.PLAYING_STOPPED,this.playingStoppedCallback),n.stop();const i=i=>{this.downloadAudioBlob(i,e),this._savingBuffer=!1,this.eventEmitter&&this.eventEmitter.off(exports.EventType.PLAYING_FINISHED,t),n.kill(),r(!0)};"mp3"===(null==e?void 0:e.format)||"mp3"===Ht.DEFAULT_SAVE_FORMAT?n.exportMP3(i):n.exportWAV(i)};this.playingStoppedCallback=()=>{n.kill(),this._savingBuffer=!1,this.eventEmitter&&(this.eventEmitter.off(exports.EventType.PLAYING_FINISHED,t),this.playingStoppedCallback&&this.eventEmitter.off(exports.EventType.PLAYING_STOPPED,this.playingStoppedCallback)),r(!0)},this.eventEmitter&&(this.eventEmitter.on(exports.EventType.PLAYING_FINISHED,t),this.eventEmitter.on(exports.EventType.PLAYING_STOPPED,this.playingStoppedCallback))}))})):i("No buffer player found")}))}downloadAudioBlob(e,t){Ct.forceDownload(e,"audio-"+(new Date).toISOString()+"."+((null==t?void 0:t.format)||Ht.DEFAULT_SAVE_FORMAT))}get savingBuffer(){return this._savingBuffer}};e([ae(),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",void 0)],vr.prototype,"setup",null),vr=e([te(),ne(),t(0,$(xt.FilterManager)),t(1,$(xt.BufferPlayer)),r("design:paramtypes",[Object,Object])],vr);var gr=vr;let br=class{constructor(e,t,r){this.buffers=new Map,this.bufferErrors=[],this.configService=null,this.contextManager=e,this.eventEmitter=r||new nr,this.configService=t}fetchBuffer(e,t){return i(this,void 0,void 0,(function*(){var r,i,n,s;const a=(this.configService?this.configService.getSoundBasePath():"")+e;if(null==this.buffers.get(this.getKeyFromLocation(a))||t){null===(r=this.eventEmitter)||void 0===r||r.emit(exports.EventType.FETCHING_BUFFERS,a);try{const e=yield fetch(a);if(!e.ok)throw this.bufferErrors.push(a),null===(i=this.eventEmitter)||void 0===i||i.emit(exports.EventType.FETCHING_BUFFERS_ERROR,a),exports.EventType.FETCHING_BUFFERS_ERROR;{const t=yield e.arrayBuffer();if(this.contextManager&&this.contextManager.currentContext){const e=yield this.contextManager.currentContext.decodeAudioData(t);this.buffers.set(this.getKeyFromLocation(a),Ct.decodeBuffer(this.contextManager.currentContext,e))}}null===(n=this.eventEmitter)||void 0===n||n.emit(exports.EventType.FINISHED_FETCHING_BUFFERS,a)}catch(e){throw console.error(e),this.bufferErrors.push(a),null===(s=this.eventEmitter)||void 0===s||s.emit(exports.EventType.FETCHING_BUFFERS_ERROR,a),exports.EventType.FETCHING_BUFFERS_ERROR}}}))}fetchAllBuffers(e){return i(this,void 0,void 0,(function*(){for(const t of e)yield this.fetchBuffer(t)}))}getAudioBuffer(e){return this.buffers.get(this.getKeyFromLocation(e))}getOrFetchAudioBuffer(e){return i(this,void 0,void 0,(function*(){return null==this.getAudioBuffer(e)&&(yield this.fetchBuffer(e)),this.getAudioBuffer(e)}))}getDownloadedBuffersList(){return Array.from(this.buffers.keys())}getKeyFromLocation(e){return e.substring(e.lastIndexOf("/")+1)}reset(){this.buffers.clear()}};br=e([te(),t(0,$(xt.AudioContextManager)),t(1,$(xt.ConfigService)),t(2,$(xt.EventEmitter)),r("design:paramtypes",[Object,Object,Object])],br);var Er=br;let Sr=class{constructor(e,t){this.contextManager=e,this.eventEmitter=t||new nr}decodeBufferFromFile(e){return i(this,void 0,void 0,(function*(){this.eventEmitter&&this.eventEmitter.emit(exports.EventType.DECODING_AUDIO_FILE);try{if(this.contextManager&&this.contextManager.currentContext){const t=yield Ct.loadAudioBuffer(this.contextManager.currentContext,e);return this.eventEmitter&&this.eventEmitter.emit(exports.EventType.DECODED_AUDIO_FILE),t}}catch(e){console.error(e),this.eventEmitter&&(this.eventEmitter.emit(exports.EventType.DECODED_AUDIO_FILE),this.eventEmitter.emit(exports.EventType.ERROR_DECODING_AUDIO_FILE))}return null}))}};Sr=e([te(),t(0,$(xt.AudioContextManager)),t(1,$(xt.EventEmitter)),r("design:paramtypes",[Object,Object])],Sr);var yr=Sr;class Ar extends rr{renderAudio(e,t){const r=t.numberOfChannels,i=e.sampleRate*t.duration+2*e.sampleRate,n=e.createBuffer(r,i,e.sampleRate);for(let e=0;e<r;e++){const r=n.getChannelData(e),s=t.getChannelData(e);for(let e=0;e<i;e++)e<s.length?r[e]=s[s.length-1-e]:r[e]=0}return Promise.resolve(n)}get order(){return 0}get id(){return Ht.FILTERS_NAMES.RETURN_AUDIO}}class wr extends Zt{constructor(){super(...arguments),this.frequencyBooster=200,this.frequencyReduce=200,this.dbBooster=20,this.dbReduce=0}getNode(e){const t=e.createBiquadFilter();t.type="lowshelf",t.frequency.value=this.frequencyBooster,t.gain.value=this.dbBooster;const r=e.createBiquadFilter();return r.type="highshelf",r.frequency.value=this.frequencyReduce,r.gain.value=this.dbReduce,r.connect(t),{input:r,output:t}}get order(){return 3}get id(){return Ht.FILTERS_NAMES.BASS_BOOST}getSettings(){return{frequencyBooster:this.frequencyBooster,frequencyReduce:this.frequencyReduce,dbBooster:this.dbBooster,dbReduce:this.dbReduce}}setSetting(e,t){if(!Ct.isSettingValueValid(t))return Promise.resolve();switch(e){case"frequencyBooster":this.frequencyBooster=parseInt(t,10);break;case"frequencyReduce":this.frequencyReduce=parseInt(t,10);break;case"dbBooster":this.dbBooster=parseInt(t,10);break;case"dbReduce":this.dbReduce=parseInt(t,10)}return Promise.resolve()}}class Rr extends AudioWorkletProcessor{constructor(){super(),this.stopped=!1,this.disabled=!1,this.phaser=null,this.last=null,this.port.onmessage=e=>{switch(e.data){case"stop":this.stop();break;case"disable":this.disabled=!0;break;case"enable":this.disabled=!1}}}static get parameterDescriptors(){return[{name:"bits",defaultValue:16},{name:"normFreq",defaultValue:.9}]}get defaultParameterDescriptors(){return Rr.parameterDescriptors}process(e,t,r){if(this.stopped||this.disabled)return!1;const i=e[0],n=t[0],s=2*Math.pow(.5,r.bits[0]),a=(1-r.normFreq[0])/(sampleRate/48e3);if(null==this.last&&(this.last=new Array(i.length).fill(0)),null==this.phaser&&(this.phaser=new Array(i.length).fill(0)),i&&i[0]){const e=i[0].length;for(let t=0;t<i.length;t++){const r=i[t],o=n[t];if(r&&o)for(let i=0;i<e;i++)this.phaser[t]+=a,this.phaser[t]>=1&&(this.phaser[t]-=1,this.last[t]=s*Math.floor(r[i]*(1/s)+.5)),o[i]=this.last[t]}}return!0}stop(){this.stopped=!0,this.phaser=null,this.last=null}}registerProcessor(Ht.WORKLET_NAMES.BITCRUSHER,Rr);class Mr extends tr{constructor(){super(...arguments),this.bits=16,this.normFreq=.9}receiveEvent(e){}get workletPath(){return Ht.WORKLET_PATHS.BITCRUSHER}get workletName(){return Ht.WORKLET_NAMES.BITCRUSHER}get order(){return 6}get id(){return Ht.FILTERS_NAMES.BITCRUSHER}getSettings(){return{bits:this.bits,normFreq:this.normFreq}}setSetting(e,t){if(!Ct.isSettingValueValid(t))return Promise.resolve();switch(e){case"bits":this.bits=parseInt(t,10);break;case"normFreq":this.normFreq=parseFloat(t)}return this.applyCurrentSettingsToWorklet(),Promise.resolve()}}class Br extends Zt{constructor(){super(...arguments),this.delay=.2,this.gain=.75}getNode(e){const t=e.createDelay(179);t.delayTime.value=this.delay;const r=e.createGain();return r.gain.value=this.gain,r.connect(t),t.connect(r),{input:r,output:t}}get order(){return 7}get id(){return Ht.FILTERS_NAMES.ECHO}getAddingTime(){return 5}getSettings(){return{delay:this.delay,gain:this.gain}}setSetting(e,t){if(!Ct.isSettingValueValid(t))return Promise.resolve();switch(e){case"delay":this.delay=parseFloat(t);break;case"gain":this.gain=parseFloat(t)}return Promise.resolve()}}class Tr extends Zt{constructor(){super(...arguments),this.highFrequency=3500}getNode(e){const t=e.createBiquadFilter();return t.type="highpass",t.frequency.value=this.highFrequency,{input:t,output:t}}get order(){return 4}get id(){return Ht.FILTERS_NAMES.HIGH_PASS}getSettings(){return{highFrequency:this.highFrequency}}setSetting(e,t){if(!Ct.isSettingValueValid(t))return Promise.resolve();if("highFrequency"===e)this.highFrequency=parseInt(t,10);return Promise.resolve()}}class Ir{constructor(e){this._array=new Float32Array,this.n=0,this.length=0,this.readPointer=0,this.writePointer=0,this.n=Math.floor(e),this.init()}init(){this._array=new Float32Array(2*this.n),this.length=this._array.length,this.readPointer=0,this.writePointer=this.n-1,this._array.fill(0)}read(){const e=this._array[this.readPointer%this.length];return this.readPointer=(this.readPointer+1)%this.length,e}push(e){this._array[this.writePointer%this.length]=e,this.writePointer=(this.writePointer+1)%this.length}reset(){this.init()}clear(){this._array=new Float32Array,this.length=0,this.readPointer=0,this.writePointer=0}sum(){return this._array.reduce(((e,t)=>e+t),0)}}class Pr extends AudioWorkletProcessor{constructor(){super(),this.delayBuffer=[],this.envelopeSamples=[],this.stopped=!1,this.disabled=!1,this.port.onmessage=e=>{switch(e.data){case"reset":this.reset();break;case"stop":this.stop();break;case"disable":this.disabled=!0;break;case"enable":this.disabled=!1}}}static get parameterDescriptors(){return[{name:"preGain",defaultValue:0},{name:"postGain",defaultValue:0},{name:"attackTime",defaultValue:0},{name:"releaseTime",defaultValue:3},{name:"threshold",defaultValue:-.05},{name:"lookAheadTime",defaultValue:0}]}get defaultParameterDescriptors(){return Pr.parameterDescriptors}process(e,t,r){if(this.stopped)return!1;const i=e[0],n=t[0],s=this.applyPreGainAndComputeEnvelope(i,n,r);return this.applyLimiter(i,n,r,s),!0}getEnvelope(e,t,r,i,n){const s=Math.exp(-1/(i*t)),a=Math.exp(-1/(i*r)),o=new Float32Array(e.length);null==this.envelopeSamples[n]&&(this.envelopeSamples[n]=0);for(let t=0;t<e.length;t++){const r=Math.abs(e[t]);this.envelopeSamples[n]<r?this.envelopeSamples[n]=r+s*(this.envelopeSamples[n]-r):this.envelopeSamples[n]=r+a*(this.envelopeSamples[n]-r),o[t]=this.envelopeSamples[n]}return o}getMaxEnvelope(e,t,r){let i=e[0][r];for(let n=0;n<t;n++)e[n][r]>i&&(i=e[n][r]);return i}ampToDB(e){return 20*Math.log10(e)}dBToAmp(e){return Math.pow(10,e/20)}applyPreGainAndComputeEnvelope(e,t,r){const i=this.dBToAmp(r.preGain[0]),n=[];for(let s=0;s<t.length;s++){const a=e[s],o=t[s];null==this.delayBuffer[s]&&(this.delayBuffer[s]=new Ir(r.lookAheadTime[0]*sampleRate)),a&&o&&this.applyPreGain(a,o,i),!this.disabled&&o&&(n[s]=this.getEnvelope(o,r.attackTime[0],r.releaseTime[0],sampleRate,s))}return n}applyPreGain(e,t,r){for(let i=0;i<e.length;++i)this.disabled?t[i]=e[i]:t[i]=r*e[i]}applyLimiter(e,t,r,i){const n=this.dBToAmp(r.postGain[0]);for(let s=0;s<t.length;s++){const a=e[s],o=t[s];if(r.lookAheadTime[0]>0&&o&&this.applyLookAheadDelay(o,s),this.disabled)continue;const l=1;if(a&&o)for(let e=0;e<a.length;e++){let s=l*(r.threshold[0]-this.ampToDB(this.getMaxEnvelope(i,t.length,e)));s=Math.min(0,s);const a=this.dBToAmp(s);o[e]*=a*n}}}applyLookAheadDelay(e,t){for(let r=0;r<e.length;r++)this.delayBuffer[t].push(e[r]),e[r]=this.delayBuffer[t].read()}clearBuffers(){for(let e=0;e<this.delayBuffer.length;e++)null!=this.delayBuffer[e]&&this.delayBuffer[e].clear();this.delayBuffer=[],this.envelopeSamples=[]}reset(){this.clearBuffers()}stop(){this.clearBuffers(),this.stopped=!0}}registerProcessor(Ht.WORKLET_NAMES.LIMITER,Pr);class xr extends tr{constructor(){super(),this.preGain=0,this.postGain=0,this.attackTime=0,this.releaseTime=5,this.threshold=0,this.lookAheadTime=.35,this.keepCurrentNodeIfPossible=!0,this.setDefaultEnabled(!0)}receiveEvent(e){}get workletPath(){return Ht.WORKLET_PATHS.LIMITER}get workletName(){return Ht.WORKLET_NAMES.LIMITER}get order(){return 11}get id(){return Ht.FILTERS_NAMES.LIMITER}getAddingTime(){return this.lookAheadTime}getSettings(){return{preGain:this.preGain,postGain:this.postGain,attackTime:this.attackTime,releaseTime:this.releaseTime,threshold:this.threshold,lookAheadTime:this.lookAheadTime}}setSetting(e,t){if(!Ct.isSettingValueValid(t))return Promise.resolve();switch(e){case"preGain":this.preGain=parseFloat(t);break;case"postGain":this.postGain=parseFloat(t);break;case"attackTime":this.attackTime=parseFloat(t);break;case"releaseTime":this.releaseTime=parseFloat(t);break;case"threshold":this.threshold=parseFloat(t);break;case"lookAheadTime":this.lookAheadTime=parseFloat(t)}return this.applyCurrentSettingsToWorklet(),Promise.resolve()}}class kr extends Zt{constructor(){super(...arguments),this.lowFrequency=3500}getNode(e){const t=e.createBiquadFilter();return t.type="lowpass",t.frequency.value=this.lowFrequency,{input:t,output:t}}get order(){return 5}get id(){return Ht.FILTERS_NAMES.LOW_PASS}getSettings(){return{lowFrequency:this.lowFrequency}}setSetting(e,t){if(!Ct.isSettingValueValid(t))return Promise.resolve();if("lowFrequency"===e)this.lowFrequency=parseInt(t,10);return Promise.resolve()}}class Nr extends Zt{constructor(){super(...arguments),this.reverbEnvironment=Ht.DEFAULT_REVERB_ENVIRONMENT,this.reverbCustomEnvironmentAddTime=5,this.customEnvironment=null}getNode(e){const t=e.createConvolver();this.reverbEnvironment&&("custom"!=this.reverbEnvironment.url||this.customEnvironment)||(this.reverbEnvironment=Ht.DEFAULT_REVERB_ENVIRONMENT);const r=this.getReverbBuffer(e);return r&&(t.buffer=r),{input:t,output:t}}getReverbBuffer(e){if("custom"==this.reverbEnvironment.url&&this.customEnvironment){if(this.customEnvironment.sampleRate===e.sampleRate)return this.customEnvironment;this.reverbEnvironment=Ht.DEFAULT_REVERB_ENVIRONMENT}else if(this.bufferFetcherService)return this.bufferFetcherService.getAudioBuffer(this.reverbEnvironment.url)}get order(){return 9}get id(){return Ht.FILTERS_NAMES.REVERB}getAddingTime(){const e=this.getSettings();if(e&&e.reverbEnvironment){if("custom"==e.reverbEnvironment.value)return this.reverbCustomEnvironmentAddTime;if(e.reverbEnvironment.additionalData)return e.reverbEnvironment.additionalData.addDuration}return 0}getSettings(){var e;return this.reverbEnvironment?{reverbEnvironment:{name:this.reverbEnvironment.name,value:this.reverbEnvironment.url,additionalData:{size:this.reverbEnvironment.size,link:this.reverbEnvironment.link,addDuration:this.reverbEnvironment.addDuration}},downloadedBuffers:null===(e=this.bufferFetcherService)||void 0===e?void 0:e.getDownloadedBuffersList(),hasCustomEnvironment:Boolean(this.customEnvironment),reverbCustomEnvironmentAddTime:this.reverbCustomEnvironmentAddTime}:{reverbCustomEnvironmentAddTime:this.reverbCustomEnvironmentAddTime}}setSetting(e,t){return i(this,void 0,void 0,(function*(){var r;if("reverbEnvironment"==e){const e=t;if(e){const t=e.value;try{"custom"!=t&&(yield null===(r=this.bufferFetcherService)||void 0===r?void 0:r.fetchBuffer(t)),e.additionalData?this.reverbEnvironment={name:e.name,url:t,size:e.additionalData.size,addDuration:e.additionalData.addDuration,link:e.additionalData.link}:this.reverbEnvironment={name:e.name,url:t,size:0,addDuration:0,link:""}}catch(e){console.error(e)}}}else"reverbCustomEnvironmentAddTime"==e?Ct.isSettingValueValid(t)&&(this.reverbCustomEnvironmentAddTime=parseInt(t,10)):"reverbCustomEnvironmentFile"==e&&this.bufferDecoderService&&t&&(this.customEnvironment=yield this.bufferDecoderService.decodeBufferFromFile(t),this.customEnvironment||(this.reverbEnvironment=Ht.DEFAULT_REVERB_ENVIRONMENT))}))}bufferFetcherReseted(){return i(this,void 0,void 0,(function*(){var e;const t=this.getSettings();if(t){const r=null===(e=t.reverbEnvironment)||void 0===e?void 0:e.value;if(r&&"custom"!==r&&this.bufferFetcherService)return yield this.bufferFetcherService.fetchBuffer(r),!0}return!1}))}}class Cr{constructor(){this._vector=new Float32Array,this._position=0,this._frameCount=0}get vector(){return this._vector}get position(){return this._position}get startIndex(){return 2*this._position}get frameCount(){return this._frameCount}get endIndex(){return 2*(this._position+this._frameCount)}clear(){this.receive(this._frameCount),this.rewind()}put(e){this._frameCount+=e}putSamples(e,t,r=0){const i=2*(t=t||0);r>=0||(r=(e.length-i)/2);const n=2*r;this.ensureCapacity(r+this._frameCount);const s=this.endIndex;this.vector.set(e.subarray(i,i+n),s),this._frameCount+=r}putBuffer(e,t,r=0){t=t||0,r>=0||(r=e.frameCount-t),this.putSamples(e.vector,e.position+t,r)}receive(e){e>=0&&!(e>this._frameCount)||(e=this.frameCount),this._frameCount-=e,this._position+=e}receiveSamples(e,t=0){const r=2*t,i=this.startIndex;e.set(this._vector.subarray(i,i+r)),this.receive(t)}extract(e,t=0,r=0){const i=this.startIndex+2*t,n=2*r;e.set(this._vector.subarray(i,i+n))}ensureCapacity(e=0){const t=parseInt(2*e);if(this._vector.length<t){const e=new Float32Array(t);e.set(this._vector.subarray(this.startIndex,this.endIndex)),this._vector=e,this._position=0}else this.rewind()}ensureAdditionalCapacity(e=0){this.ensureCapacity(this._frameCount+e)}rewind(){this._position>0&&(this._vector.set(this._vector.subarray(this.startIndex,this.endIndex)),this._position=0)}}class Or{constructor(e){e?(this._inputBuffer=new Cr,this._outputBuffer=new Cr):this._inputBuffer=this._outputBuffer=null}get inputBuffer(){return this._inputBuffer}set inputBuffer(e){this._inputBuffer=e}get outputBuffer(){return this._outputBuffer}set outputBuffer(e){this._outputBuffer=e}clear(){this._inputBuffer.clear(),this._outputBuffer.clear()}}class Dr extends Or{constructor(e){super(e),this.reset(),this._rate=1}set rate(e){this._rate=e}reset(){this.slopeCount=0,this.prevSampleL=0,this.prevSampleR=0}clone(){const e=new Dr;return e.rate=this._rate,e}process(){const e=this._inputBuffer.frameCount;this._outputBuffer.ensureAdditionalCapacity(e/this._rate+1);const t=this.transpose(e);this._inputBuffer.receive(),this._outputBuffer.put(t)}transpose(e=0){if(0===e)return 0;const t=this._inputBuffer.vector,r=this._inputBuffer.startIndex,i=this._outputBuffer.vector,n=this._outputBuffer.endIndex;let s=0,a=0;for(;this.slopeCount<1;)i[n+2*a]=(1-this.slopeCount)*this.prevSampleL+this.slopeCount*t[r],i[n+2*a+1]=(1-this.slopeCount)*this.prevSampleR+this.slopeCount*t[r+1],a+=1,this.slopeCount+=this._rate;if(this.slopeCount-=1,1!==e)e:for(;;){for(;this.slopeCount>1;)if(this.slopeCount-=1,s+=1,s>=e-1)break e;const o=r+2*s;i[n+2*a]=(1-this.slopeCount)*t[o]+this.slopeCount*t[o+2],i[n+2*a+1]=(1-this.slopeCount)*t[o+1]+this.slopeCount*t[o+3],a+=1,this.slopeCount+=this._rate}return this.prevSampleL=t[r+2*e-2],this.prevSampleR=t[r+2*e-1],a}}class Fr{constructor(e){this._pipe=e}get pipe(){return this._pipe}get inputBuffer(){return this._pipe.inputBuffer}get outputBuffer(){return this._pipe.outputBuffer}fillInputBuffer(){throw new Error("fillInputBuffer() not overridden")}fillOutputBuffer(e=0){for(;this.outputBuffer.frameCount<e;){const e=16384-this.inputBuffer.frameCount;if(this.fillInputBuffer(e),this.inputBuffer.frameCount<16384)break;this._pipe.process()}}clear(){this._pipe.clear()}}const Lr=function(){};class Vr extends Fr{constructor(e,t,r=Lr){super(t),this.callback=r,this.sourceSound=e,this.historyBufferSize=22050,this._sourcePosition=0,this.outputBufferPosition=0,this._position=0}get position(){return this._position}set position(e){if(e>this._position)throw new RangeError("New position may not be greater than current position");const t=this.outputBufferPosition-(this._position-e);if(t<0)throw new RangeError("New position falls outside of history buffer");this.outputBufferPosition=t,this._position=e}get sourcePosition(){return this._sourcePosition}set sourcePosition(e){this.clear(),this._sourcePosition=e}onEnd(){this.callback()}fillInputBuffer(e=0){const t=new Float32Array(2*e),r=this.sourceSound.extract(t,e,this._sourcePosition);this._sourcePosition+=r,this.inputBuffer.putSamples(t,0,r)}extract(e,t=0){this.fillOutputBuffer(this.outputBufferPosition+t);const r=Math.min(t,this.outputBuffer.frameCount-this.outputBufferPosition);this.outputBuffer.extract(e,this.outputBufferPosition,r);const i=this.outputBufferPosition+r;return this.outputBufferPosition=Math.min(this.historyBufferSize,i),this.outputBuffer.receive(Math.max(i-this.historyBufferSize,0)),this._position+=r,r}handleSampleData(e){this.extract(e.data,4096)}clear(){super.clear(),this.outputBufferPosition=0}}const Gr=[[124,186,248,310,372,434,496,558,620,682,744,806,868,930,992,1054,1116,1178,1240,1302,1364,1426,1488,0],[-100,-75,-50,-25,25,50,75,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-20,-15,-10,-5,5,10,15,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-4,-3,-2,-1,1,2,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],Ur=-10/3.75;class Hr extends Or{constructor(e){super(e),this._quickSeek=!0,this.midBufferDirty=!1,this.midBuffer=null,this.overlapLength=0,this.autoSeqSetting=!0,this.autoSeekSetting=!0,this._tempo=1,this.setParameters(44100,0,0,8)}clear(){super.clear(),this.clearMidBuffer()}clearMidBuffer(){this.midBufferDirty&&(this.midBufferDirty=!1,this.midBuffer=null)}setParameters(e,t,r,i){e>0&&(this.sampleRate=e),i>0&&(this.overlapMs=i),t>0?(this.sequenceMs=t,this.autoSeqSetting=!1):this.autoSeqSetting=!0,r>0?(this.seekWindowMs=r,this.autoSeekSetting=!1):this.autoSeekSetting=!0,this.calculateSequenceParameters(),this.calculateOverlapLength(this.overlapMs),this.tempo=this._tempo}set tempo(e){let t;this._tempo=e,this.calculateSequenceParameters(),this.nominalSkip=this._tempo*(this.seekWindowLength-this.overlapLength),this.skipFract=0,t=Math.floor(this.nominalSkip+.5),this.sampleReq=Math.max(t+this.overlapLength,this.seekWindowLength)+this.seekLength}get tempo(){return this._tempo}get inputChunkSize(){return this.sampleReq}get outputChunkSize(){return this.overlapLength+Math.max(0,this.seekWindowLength-2*this.overlapLength)}calculateOverlapLength(e=0){let t;t=this.sampleRate*e/1e3,t=t<16?16:t,t-=t%8,this.overlapLength=t,this.refMidBuffer=new Float32Array(2*this.overlapLength),this.midBuffer=new Float32Array(2*this.overlapLength)}checkLimits(e,t,r){return e<t?t:e>r?r:e}calculateSequenceParameters(){let e,t;this.autoSeqSetting&&(e=130+-20*this._tempo,e=this.checkLimits(e,50,125),this.sequenceMs=Math.floor(e+.5)),this.autoSeekSetting&&(t=25.666666666666668+Ur*this._tempo,t=this.checkLimits(t,15,25),this.seekWindowMs=Math.floor(t+.5)),this.seekWindowLength=Math.floor(this.sampleRate*this.sequenceMs/1e3),this.seekLength=Math.floor(this.sampleRate*this.seekWindowMs/1e3)}set quickSeek(e){this._quickSeek=e}clone(){const e=new Hr;return e.tempo=this._tempo,e.setParameters(this.sampleRate,this.sequenceMs,this.seekWindowMs,this.overlapMs),e}seekBestOverlapPosition(){return this._quickSeek?this.seekBestOverlapPositionStereoQuick():this.seekBestOverlapPositionStereo()}seekBestOverlapPositionStereo(){let e,t,r,i=0;for(this.preCalculateCorrelationReferenceStereo(),e=0,t=Number.MIN_VALUE;i<this.seekLength;i+=1)r=this.calculateCrossCorrelationStereo(2*i,this.refMidBuffer),r>t&&(t=r,e=i);return e}seekBestOverlapPositionStereoQuick(){let e,t,r,i,n,s=0;for(this.preCalculateCorrelationReferenceStereo(),t=Number.MIN_VALUE,e=0,i=0,n=0;s<4;s+=1){let a=0;for(;Gr[s][a]&&(n=i+Gr[s][a],!(n>=this.seekLength));)r=this.calculateCrossCorrelationStereo(2*n,this.refMidBuffer),r>t&&(t=r,e=n),a+=1;i=e}return e}preCalculateCorrelationReferenceStereo(){let e,t,r=0;for(;r<this.overlapLength;r+=1)t=r*(this.overlapLength-r),e=2*r,this.refMidBuffer[e]=this.midBuffer[e]*t,this.refMidBuffer[e+1]=this.midBuffer[e+1]*t}calculateCrossCorrelationStereo(e,t){const r=this._inputBuffer.vector;e+=this._inputBuffer.startIndex;let i=0,n=2;const s=2*this.overlapLength;let a;for(;n<s;n+=2)a=n+e,i+=r[a]*t[n]+r[a+1]*t[n+1];return i}overlap(e){this.overlapStereo(2*e)}overlapStereo(e){const t=this._inputBuffer.vector;e+=this._inputBuffer.startIndex;const r=this._outputBuffer.vector,i=this._outputBuffer.endIndex;let n,s,a=0;const o=1/this.overlapLength;let l,u,c;for(;a<this.overlapLength;a+=1)s=(this.overlapLength-a)*o,l=a*o,n=2*a,u=n+e,c=n+i,r[c+0]=t[u+0]*l+this.midBuffer[n+0]*s,r[c+1]=t[u+1]*l+this.midBuffer[n+1]*s}process(){let e,t,r;if(null===this.midBuffer){if(this._inputBuffer.frameCount<this.overlapLength)return;this.midBuffer=new Float32Array(2*this.overlapLength),this._inputBuffer.receiveSamples(this.midBuffer,this.overlapLength)}for(;this._inputBuffer.frameCount>=this.sampleReq;){e=this.seekBestOverlapPosition(),this._outputBuffer.ensureAdditionalCapacity(this.overlapLength),this.overlap(Math.floor(e)),this._outputBuffer.put(this.overlapLength),t=this.seekWindowLength-2*this.overlapLength,t>0&&this._outputBuffer.putBuffer(this._inputBuffer,e+this.overlapLength,t);const i=this._inputBuffer.startIndex+2*(e+this.seekWindowLength-this.overlapLength);this.midBuffer.set(this._inputBuffer.vector.subarray(i,i+2*this.overlapLength)),this.skipFract+=this.nominalSkip,r=Math.floor(this.skipFract),this.skipFract-=r,this._inputBuffer.receive(r)}}}const jr=function(e,t){return(e>t?e-t:t-e)>1e-10};class qr{constructor(){this.transposer=new Dr(!1),this.stretch=new Hr(!1),this._inputBuffer=new Cr,this._intermediateBuffer=new Cr,this._outputBuffer=new Cr,this._rate=0,this._tempo=0,this.virtualPitch=1,this.virtualRate=1,this.virtualTempo=1,this.calculateEffectiveRateAndTempo()}clear(){this.transposer.clear(),this.stretch.clear()}clone(){const e=new qr;return e.rate=this.rate,e.tempo=this.tempo,e}get rate(){return this._rate}set rate(e){this.virtualRate=e,this.calculateEffectiveRateAndTempo()}set rateChange(e){this._rate=1+.01*e}get tempo(){return this._tempo}set tempo(e){this.virtualTempo=e,this.calculateEffectiveRateAndTempo()}set tempoChange(e){this.tempo=1+.01*e}set pitch(e){this.virtualPitch=e,this.calculateEffectiveRateAndTempo()}set pitchOctaves(e){this.pitch=Math.exp(.69314718056*e),this.calculateEffectiveRateAndTempo()}set pitchSemitones(e){this.pitchOctaves=e/12}get inputBuffer(){return this._inputBuffer}get outputBuffer(){return this._outputBuffer}calculateEffectiveRateAndTempo(){const e=this._tempo,t=this._rate;this._tempo=this.virtualTempo/this.virtualPitch,this._rate=this.virtualRate*this.virtualPitch,jr(this._tempo,e)&&(this.stretch.tempo=this._tempo),jr(this._rate,t)&&(this.transposer.rate=this._rate),this._rate>1?this._outputBuffer!=this.transposer.outputBuffer&&(this.stretch.inputBuffer=this._inputBuffer,this.stretch.outputBuffer=this._intermediateBuffer,this.transposer.inputBuffer=this._intermediateBuffer,this.transposer.outputBuffer=this._outputBuffer):this._outputBuffer!=this.stretch.outputBuffer&&(this.transposer.inputBuffer=this._inputBuffer,this.transposer.outputBuffer=this._intermediateBuffer,this.stretch.inputBuffer=this._intermediateBuffer,this.stretch.outputBuffer=this._outputBuffer)}process(){this._rate>1?(this.stretch.process(),this.transposer.process()):(this.transposer.process(),this.stretch.process())}}class Wr{constructor(e){this.buffer=e,this._position=0}get dualChannel(){return this.buffer.numberOfChannels>1}get position(){return this._position}set position(e){this._position=e}extract(e,t=0,r=0){this.position=r;let i=this.buffer.getChannelData(0),n=this.dualChannel?this.buffer.getChannelData(1):this.buffer.getChannelData(0),s=0;for(;s<t;s++)e[2*s]=i[s+r],e[2*s+1]=n[s+r];return Math.min(t,i.length-r)}}const Yr=function(e){const t=Math.floor(e/60);return`${t}:${function(e,t,r){return r=r||"0",(e+="").length>=t?e:new Array(t-e.length+1).join(r)+e}(parseInt(e-60*t),2)}`},Xr=function(e){const t=this.timePlayed,r=this.sampleRate;if(this.sourcePosition=e,this.timePlayed=e/r,t!==this.timePlayed){const e=new CustomEvent("play",{detail:{timePlayed:this.timePlayed,formattedTimePlayed:this.formattedTimePlayed,percentagePlayed:this.percentagePlayed}});this._node.dispatchEvent(e)}};class Kr{constructor(e,t,r,i=Lr){this._soundtouch=new qr;const n=new Wr(t);this.timePlayed=0,this.sourcePosition=0,this._filter=new Vr(n,this._soundtouch,i),this._node=function(e,t,r=Lr,i=4096){const n=e.createScriptProcessor(i,2,2),s=new Float32Array(2*i);return n.onaudioprocess=e=>{let n=e.outputBuffer.getChannelData(0),a=e.outputBuffer.getChannelData(1),o=t.extract(s,i);r(t.sourcePosition),0===o&&t.onEnd();let l=0;for(;l<o;l++)n[l]=s[2*l],a[l]=s[2*l+1]},n}(e,this._filter,(e=>Xr.call(this,e)),r),this.tempo=1,this.rate=1,this.duration=t.duration,this.sampleRate=e.sampleRate,this.listeners=[]}get formattedDuration(){return Yr(this.duration)}get formattedTimePlayed(){return Yr(this.timePlayed)}get percentagePlayed(){return 100*this._filter.sourcePosition/(this.duration*this.sampleRate)}set percentagePlayed(e){this._filter.sourcePosition=parseInt(e*this.duration*this.sampleRate),this.sourcePosition=this._filter.sourcePosition,this.timePlayed=this.sourcePosition/this.sampleRate}get node(){return this._node}set pitch(e){this._soundtouch.pitch=e}set pitchSemitones(e){this._soundtouch.pitchSemitones=e}set rate(e){this._soundtouch.rate=e}set tempo(e){this._soundtouch.tempo=e}connect(e){this._node.connect(e)}disconnect(){this._node.disconnect()}on(e,t){this.listeners.push({name:e,cb:t}),this._node.addEventListener(e,(e=>t(e.detail)))}off(e=null){let t=this.listeners;e&&(t=t.filter((t=>t.name===e))),t.forEach((e=>{this._node.removeEventListener(e.name,(t=>e.cb(t.detail)))}))}}class zr extends tr{constructor(){super(),this.speedAudio=Ht.SOUNDTOUCH_DEFAULT_SPEED,this.frequencyAudio=Ht.SOUNDTOUCH_DEFAULT_FREQUENCY,this.pitchSemitones=Ht.SOUNDTOUCH_DEFAULT_PITCH_SEMITONES,this.currentSpeedAudio=Ht.SOUNDTOUCH_DEFAULT_SPEED,this.currentBufferSource=null,this.isOfflineMode=!1,this.setDefaultEnabled(!0)}receiveEvent(e){}get workletPath(){return Ht.WORKLET_PATHS.SOUNDTOUCH}get workletName(){return Ht.WORKLET_NAMES.SOUNDTOUCH}getEntrypointNode(e,t,r){this.isOfflineMode=r,this.cleanUpOldNodes();const{isWorklet:i,renderWithSoundtouch:n}=this.getCurrentRenderingMode();if(n)return i&&Ct.isAudioWorkletCompatible(e)?this.renderWithWorklet(t,e):r?this.renderWithScriptProcessorNode(t,e):(this.currentPitchShifter=this.getSoundtouchScriptProcessorNode(t,e),this.updateState(),Promise.resolve({input:this.currentPitchShifter,output:this.currentPitchShifter}));const s=this.constructBufferSourceNode(e,t);return Promise.resolve({input:s,output:s})}getSoundtouchScriptProcessorNode(e,t){return new Kr(t,e,Ht.SOUNDTOUCH_PITCH_SHIFTER_BUFFER_SIZE)}constructBufferSourceNode(e,t){const r=e.createBufferSource();return r.buffer=t,r.start(),this.currentBufferSource=r,r}cleanUpOldNodes(){this.currentPitchShifter&&(this.currentPitchShifter.disconnect(),this.currentPitchShifter._filter=null,this.currentPitchShifter=null),this.currentBufferSource&&(this.currentBufferSource.disconnect(),this.currentBufferSource=null)}renderWithScriptProcessorNode(e,t){return i(this,void 0,void 0,(function*(){const r=Ct.calcAudioDuration(e,this.speedAudio);if(this.contextManager){const i=this.contextManager.createOfflineAudioContext(2,t.sampleRate*r,t.sampleRate);this.currentPitchShifter=this.getSoundtouchScriptProcessorNode(e,i),this.updateState(),this.currentPitchShifter.connect(i.destination);const n=yield i.startRendering(),s=this.constructBufferSourceNode(t,n);return this.currentPitchShifter.disconnect(),{input:s,output:s}}throw new Error("AudioContextManager is not available!")}))}renderWithWorklet(e,t){try{const r=this.constructBufferSourceNode(t,e),i=this.getNode(t);return r.connect(i.input),this.updateState(),Promise.resolve({input:i.input,output:i.output})}catch(r){return console.error(r),this.renderWithScriptProcessorNode(e,t)}}get order(){return 2}get id(){return Ht.FILTERS_NAMES.SOUNDTOUCH}getSettings(){return{speedAudio:this.speedAudio,frequencyAudio:this.frequencyAudio,pitchSemitones:this.pitchSemitones}}isAudioWorkletEnabled(){return this.configService?this.configService.isSoundtouchAudioWorkletEnabled():Ht.ENABLE_SOUNDTOUCH_AUDIO_WORKLET}getCurrentRenderingMode(){const e=this.speedAudio==Ht.SOUNDTOUCH_DEFAULT_SPEED&&this.frequencyAudio==Ht.SOUNDTOUCH_DEFAULT_FREQUENCY&&this.pitchSemitones==Ht.SOUNDTOUCH_DEFAULT_PITCH_SEMITONES;return!this.isOfflineMode||this.isEnabled()&&!e?this.isAudioWorkletAvailable()?{isWorklet:!0,renderWithSoundtouch:!0}:{isWorklet:!1,renderWithSoundtouch:!0}:{isWorklet:!1,renderWithSoundtouch:!1}}updateState(){const{isWorklet:e,renderWithSoundtouch:t}=this.getCurrentRenderingMode();this.currentSpeedAudio=1;let r=1,i=1,n=0;t&&(i=this.speedAudio,n=this.pitchSemitones,r=e?this.frequencyAudio*(1/this.speedAudio):this.frequencyAudio,this.currentSpeedAudio=this.speedAudio),e?(this.setWorkletSetting("pitch",r),this.setWorkletSetting("pitchSemitones",n),this.currentBufferSource&&(this.currentBufferSource.playbackRate.value=i)):this.currentPitchShifter&&(this.currentPitchShifter.pitch=r*Math.pow(2,n/12),this.currentPitchShifter.tempo=i)}setSetting(e,t){if(!Ct.isSettingValueValid(t))return Promise.resolve();const r=parseFloat(t);switch(e){case"speedAudio":this.speedAudio=r;break;case"frequencyAudio":this.frequencyAudio=r;break;case"pitchSemitones":this.pitchSemitones=r}return this.updateState(),Promise.resolve()}setEnabled(e){super.setEnabled(e),this.updateState()}getSpeed(){return this.currentSpeedAudio}}class Zr extends Zt{getNode(e){const t=e.createBiquadFilter();t.type="lowpass",t.frequency.value=2e3;const r=e.createBiquadFilter();r.type="lowpass",r.frequency.value=2e3;const i=e.createBiquadFilter();i.type="highpass",i.frequency.value=500;const n=e.createBiquadFilter();return n.type="highpass",n.frequency.value=500,t.connect(r),r.connect(i),i.connect(n),{input:t,output:n}}get order(){return 7}get id(){return Ht.FILTERS_NAMES.TELEPHONIZER}getSettings(){return{}}setSetting(e,t){return i(this,void 0,void 0,(function*(){}))}}class Qr{constructor(e,t,r){this.FILTER_QUALITY=6,this.FOURIER_SIZE=4096,this.WAVETABLEBOOST=40,this.SAWTOOTHBOOST=.4,this.oscillatorType=4,this.oscillatorDetuneValue=0,this.audioContext=null,this.carrierBuffer=null,this.modulatorNode=null,this.vocoding=!1,this.modulatorInput=null,this.carrierInput=null,this.modulatorGain=null,this.modulatorGainValue=1,this.noiseBuffer=null,this.noiseNode=null,this.noiseGain=null,this.noiseGainValue=.2,this.carrierSampleNode=null,this.carrierSampleGain=null,this.carrierSampleGainValue=0,this.oscillatorNode=null,this.oscillatorGain=null,this.oscillatorGainValue=1,this.wavetable=null,this.wavetableSignalGain=null,this.modFilterBands=null,this.modFilterPostGains=null,this.heterodynes=null,this.powers=null,this.lpFilters=null,this.lpFilterPostGains=null,this.carrierBands=null,this.carrierFilterPostGains=null,this.carrierBandGains=null,this.vocoderBands=null,this.numVocoderBands=0,this.hpFilterGain=null,this.outputGain=null,this.audioContext=e,this.carrierBuffer=t,this.modulatorBuffer=r}init(){this.generateVocoderBands(55,7040,28),this.setupVocoderGraph(),this.vocode()}getNodes(){return{modulatorNode:this.modulatorNode,modulatorGain:this.modulatorGain,synthLevel:this.oscillatorGain,noiseNode:this.noiseGain,oscillatorNode:this.oscillatorNode,hpFilterGain:this.hpFilterGain,outputGain:this.outputGain}}shutOffCarrier(){this.oscillatorNode&&this.noiseNode&&this.carrierSampleNode&&(this.oscillatorNode.stop(0),this.oscillatorNode=null,this.noiseNode.stop(0),this.noiseNode=null,this.carrierSampleNode.stop(0),this.carrierSampleNode=null)}selectSawtooth(){this.wavetableSignalGain&&(this.wavetableSignalGain.gain.value=this.SAWTOOTHBOOST),this.oscillatorNode&&(this.oscillatorNode.type="sawtooth")}selectWavetable(){this.wavetableSignalGain&&(this.wavetableSignalGain.gain.value=this.WAVETABLEBOOST),this.oscillatorNode&&this.wavetable&&this.oscillatorNode.setPeriodicWave(this.wavetable),this.wavetableSignalGain&&(this.wavetableSignalGain.gain.value=this.WAVETABLEBOOST)}updateModGain(e){this.modulatorGainValue=e,this.modulatorGain&&(this.modulatorGain.gain.value=e)}updateSampleLevel(e){this.carrierSampleGainValue=e,this.carrierSampleGain&&(this.carrierSampleGain.gain.value=e)}updateSynthLevel(e){this.oscillatorGainValue=e,this.oscillatorGain&&(this.oscillatorGain.gain.value=e)}updateNoiseLevel(e){this.noiseGainValue=e,this.noiseGain&&(this.noiseGain.gain.value=e)}updateDetuneValue(e){this.oscillatorDetuneValue=e,this.oscillatorNode&&(this.oscillatorNode.detune.value=e)}generateVocoderBands(e,t,r){const i=1200*Math.log(t/e)/Math.LN2/r,n=Math.pow(2,i/1200);this.vocoderBands=[];let s=e;for(let e=0;e<r;e++)this.vocoderBands[e]={frequency:s},s*=n;this.numVocoderBands=r}loadNoiseBuffer(){if(!this.audioContext)return;const e=5*this.audioContext.sampleRate;this.noiseBuffer=this.audioContext.createBuffer(1,e,this.audioContext.sampleRate);const t=this.noiseBuffer.getChannelData(0);for(let r=0;r<e;++r)t[r]=2*Math.random()-1}initBandpassFilters(){if(!this.audioContext)return;this.modulatorInput=this.audioContext.createGain(),this.carrierInput=this.audioContext.createGain(),null==this.modFilterBands&&(this.modFilterBands=[]),null==this.modFilterPostGains&&(this.modFilterPostGains=[]),null==this.heterodynes&&(this.heterodynes=[]),null==this.powers&&(this.powers=[]),null==this.lpFilters&&(this.lpFilters=[]),null==this.lpFilterPostGains&&(this.lpFilterPostGains=[]),null==this.carrierBands&&(this.carrierBands=[]),null==this.carrierFilterPostGains&&(this.carrierFilterPostGains=[]),null==this.carrierBandGains&&(this.carrierBandGains=[]);const e=new Float32Array(65536),t=32768;let r;for(let i=0;i<t;++i)r=i/t,e[t+i]=r,e[t-i-1]=r;const i=this.audioContext.createBiquadFilter();i.type="highpass",i.frequency.value=8e3,i.Q.value=1,this.modulatorInput.connect(i),this.hpFilterGain=this.audioContext.createGain(),this.hpFilterGain.gain.value=0,i.connect(this.hpFilterGain),this.modulatorBuffer&&this.hpFilterGain.connect(this.audioContext.destination),this.modFilterBands.length=0,this.modFilterPostGains.length=0,this.heterodynes.length=0,this.powers.length=0,this.lpFilters.length=0,this.lpFilterPostGains.length=0,this.carrierBands.length=0,this.carrierFilterPostGains.length=0,this.carrierBandGains.length=0,this.outputGain=this.audioContext.createGain(),this.modulatorBuffer&&this.outputGain.connect(this.audioContext.destination);const n=new Float32Array(65536);for(let e=-32768;e<32768;e++)n[e+32768]=(e>0?e:-e)/32768;for(let t=0;t<this.numVocoderBands;t++){const r=this.audioContext.createBiquadFilter();r.type="bandpass",this.vocoderBands&&(r.frequency.value=this.vocoderBands[t].frequency),r.Q.value=this.FILTER_QUALITY,this.modulatorInput.connect(r),this.modFilterBands.push(r);const i=this.audioContext.createBiquadFilter();i.type="bandpass",this.vocoderBands&&(i.frequency.value=this.vocoderBands[t].frequency),i.Q.value=this.FILTER_QUALITY,r.connect(i);const s=this.audioContext.createGain();s.gain.value=6,i.connect(s),this.modFilterPostGains.push(s);const a=this.audioContext.createOscillator();this.vocoderBands&&(a.frequency.value=this.vocoderBands[t].frequency),a.start(0);const o=this.audioContext.createGain();s.connect(o),o.gain.value=0,a.connect(o.gain);const l=this.audioContext.createGain();l.gain.value=2,o.connect(l),this.heterodynes.push(l);const u=this.audioContext.createWaveShaper();u.curve=n,l.connect(u);const c=this.audioContext.createBiquadFilter();c.type="lowpass",c.frequency.value=5,c.Q.value=1,this.lpFilters.push(c),u.connect(c);const h=this.audioContext.createGain();h.gain.value=1,c.connect(h),this.lpFilterPostGains.push(h);const f=this.audioContext.createWaveShaper();f.curve=e,h.connect(f);const d=this.audioContext.createBiquadFilter();d.type="bandpass",this.vocoderBands&&(d.frequency.value=this.vocoderBands[t].frequency),d.Q.value=this.FILTER_QUALITY,this.carrierBands.push(d),this.carrierInput.connect(d);const _=this.audioContext.createBiquadFilter();_.type="bandpass",this.vocoderBands&&(_.frequency.value=this.vocoderBands[t].frequency),_.Q.value=this.FILTER_QUALITY,d.connect(_);const p=this.audioContext.createGain();p.gain.value=10,_.connect(p),this.carrierFilterPostGains.push(p);const m=this.audioContext.createGain();this.carrierBandGains.push(m),p.connect(m),m.gain.value=0,f.connect(m.gain),m.connect(this.outputGain)}const s=new Float32Array(this.FOURIER_SIZE),a=new Float32Array(this.FOURIER_SIZE);s[0]=0,a[0]=0;for(let e=1;e<this.FOURIER_SIZE;e++)s[e]=1,a[e]=1;this.wavetable=this.audioContext.createPeriodicWave(s,a),this.loadNoiseBuffer()}setupVocoderGraph(){this.initBandpassFilters()}createCarriersAndPlay(e){this.audioContext&&e&&(this.carrierSampleNode=this.audioContext.createBufferSource(),this.carrierSampleNode.buffer=this.carrierBuffer,this.carrierSampleNode.loop=!0,this.carrierSampleGain=this.audioContext.createGain(),this.carrierSampleGain.gain.value=this.carrierSampleGainValue,this.carrierSampleNode.connect(this.carrierSampleGain),this.carrierSampleGain.connect(e),this.wavetableSignalGain=this.audioContext.createGain(),this.oscillatorNode=this.audioContext.createOscillator(),4==this.oscillatorType&&this.wavetable?(this.oscillatorNode.setPeriodicWave(this.wavetable),this.wavetableSignalGain.gain.value=this.WAVETABLEBOOST):this.wavetableSignalGain.gain.value=this.SAWTOOTHBOOST,this.oscillatorNode.frequency.value=110,this.oscillatorNode.detune.value=this.oscillatorDetuneValue,this.oscillatorNode.connect(this.wavetableSignalGain),this.oscillatorGain=this.audioContext.createGain(),this.oscillatorGain.gain.value=this.oscillatorGainValue,this.wavetableSignalGain.connect(this.oscillatorGain),this.oscillatorGain.connect(e),this.noiseNode=this.audioContext.createBufferSource(),this.noiseNode.buffer=this.noiseBuffer,this.noiseNode.loop=!0,this.noiseGain=this.audioContext.createGain(),this.noiseGain.gain.value=this.noiseGainValue,this.noiseNode.connect(this.noiseGain),this.noiseGain.connect(e),this.oscillatorNode.start(0),this.noiseNode.start(0),this.carrierSampleNode.start(0))}vocode(){if(this.audioContext){if(this.vocoding)return this.modulatorNode&&this.modulatorNode.stop(0),this.shutOffCarrier(),void(this.vocoding=!1);this.createCarriersAndPlay(this.carrierInput),this.vocoding=!0,this.modulatorGain=this.audioContext.createGain(),this.modulatorGain.gain.value=this.modulatorGainValue,this.modulatorBuffer&&(this.modulatorNode=this.audioContext.createBufferSource(),this.modulatorNode.buffer=this.modulatorBuffer,this.modulatorNode.connect(this.modulatorGain),this.modulatorNode.start(0)),this.modulatorInput&&this.modulatorGain.connect(this.modulatorInput)}}}class $r extends Zt{constructor(){super(...arguments),this.currentVocoder=null,this.modulatorGainValue=1,this.carrierSampleGainValue=0,this.oscillatorGainValue=1,this.noiseGainValue=.2,this.oscillatorDetuneValue=0}getNode(e){var t;const r=null===(t=this.bufferFetcherService)||void 0===t?void 0:t.getAudioBuffer(Ht.VOCODER_MODULATOR);this.currentVocoder=new Qr(e,r),this.currentVocoder.init(),this.applyCurrentSettingsToVocoder();const{modulatorGain:i,outputGain:n}=this.currentVocoder.getNodes();return{input:i,output:n}}getSettings(){return{modulatorGainValue:this.modulatorGainValue,carrierSampleGainValue:this.carrierSampleGainValue,oscillatorGainValue:this.oscillatorGainValue,noiseGainValue:this.noiseGainValue,oscillatorDetuneValue:this.oscillatorDetuneValue}}setSetting(e,t){if(!Ct.isSettingValueValid(t))return Promise.resolve();switch(e){case"modulatorGainValue":this.modulatorGainValue=parseFloat(t);break;case"carrierSampleGainValue":this.carrierSampleGainValue=parseFloat(t);break;case"oscillatorGainValue":this.oscillatorGainValue=parseFloat(t);break;case"noiseGainValue":this.noiseGainValue=parseFloat(t);break;case"oscillatorDetuneValue":this.oscillatorDetuneValue=parseFloat(t)}return this.applyCurrentSettingsToVocoder(),Promise.resolve()}applyCurrentSettingsToVocoder(){this.currentVocoder&&(this.currentVocoder.updateModGain(this.modulatorGainValue),this.currentVocoder.updateSampleLevel(this.carrierSampleGainValue),this.currentVocoder.updateSynthLevel(this.oscillatorGainValue),this.currentVocoder.updateNoiseLevel(this.noiseGainValue),this.currentVocoder.updateDetuneValue(this.oscillatorDetuneValue))}get order(){return 1}get id(){return Ht.FILTERS_NAMES.VOCODER}}class Jr extends AudioWorkletProcessor{constructor(){super(),this.stopped=!1,this.disabled=!1,this.samplesCount=0,this.port.onmessage=e=>{switch(e.data){case"stop":this.stop();break;case"disable":this.disabled=!0;break;case"enable":this.disabled=!1}}}static get parameterDescriptors(){return[]}get defaultParameterDescriptors(){return Jr.parameterDescriptors}process(e,t){if(this.stopped||this.disabled)return!1;const r=e[0],i=t[0];if(r&&r[0]&&(this.samplesCount+=r[0].length),i){for(let e=0;e<i.length;e++){const t=r[e],n=i[e];if(t)for(let e=0;e<t.length;e++)n[e]=t[e]}this.port.postMessage({command:"update",samplesCount:this.samplesCount})}return!0}stop(){this.stopped=!0}}registerProcessor(Ht.WORKLET_NAMES.RENDERING_PROGRESS_CALCULATION,Jr);class ei extends tr{constructor(){super(...arguments),this.currentTime=0,this.lastSampleCount=0,this.samplePerSecond=0,this.currentTimeSamplesPerSecond=0}receiveEvent(e){const t=performance.now(),r=e.data.samplesCount;"update"===e.data.command&&this.calculatePercentageProcessed(t,r),this.calculateRemainingTimeProcessing(t,r)}calculatePercentageProcessed(e,t){0===this.currentTime&&(this.currentTime=e);const r=e-this.currentTime,i=t/this._totalSamples*100;this.eventEmitter&&r>=Ht.TREATMENT_TIME_COUNTING_THROTTLE_INTERVAL&&(this.eventEmitter.emit(exports.EventType.UPDATE_AUDIO_TREATMENT_PERCENT,i),this.currentTime=e),i>=100&&this.stop()}calculateRemainingTimeProcessing(e,t){0===this.currentTimeSamplesPerSecond&&(this.currentTimeSamplesPerSecond=e);const r=e-this.currentTimeSamplesPerSecond,i=this._totalSamples-t;if(this.eventEmitter&&i<=0)this.eventEmitter.emit(exports.EventType.UPDATE_REMAINING_TIME_ESTIMATED,0);else if(this.eventEmitter&&r>=1e3){this.calculateSmoothedSamplePerSecond(r,t);const n=i/this.samplePerSecond;this.currentTimeSamplesPerSecond=e,this.lastSampleCount=t,isNaN(n)||!isFinite(n)?this.eventEmitter.emit(exports.EventType.UPDATE_REMAINING_TIME_ESTIMATED,-1):this.eventEmitter.emit(exports.EventType.UPDATE_REMAINING_TIME_ESTIMATED,n)}}calculateSmoothedSamplePerSecond(e,t){if(e>0){const r=(t-this.lastSampleCount)/(e/1e3);this.samplePerSecond=Ht.TREATMENT_TIME_COUNTING_SMOOTHING_FACTOR*r+(1-Ht.TREATMENT_TIME_COUNTING_SMOOTHING_FACTOR)*this.samplePerSecond}}get workletName(){return Ht.WORKLET_NAMES.RENDERING_PROGRESS_CALCULATION}get workletPath(){return Ht.WORKLET_PATHS.RENDERING_PROGRESS_CALCULATION}get order(){return 10}get id(){return Ht.FILTERS_NAMES.RENDERING_PROGRESS_CALCULATION}set totalSamples(e){super.totalSamples=e,this.currentTime=0,this.currentTimeSamplesPerSecond=0,this.samplePerSecond=0,this.lastSampleCount=0}getSettings(){return{}}setSetting(e,t){return i(this,void 0,void 0,(function*(){}))}}class ti{isAudioEncoderAPISupportedForSettings(e){return i(this,void 0,void 0,(function*(){if(!self.AudioEncoder||!AudioEncoder.isConfigSupported)return!1;const t=yield AudioEncoder.isConfigSupported({codec:e.format,sampleRate:e.sampleRate,numberOfChannels:e.numChannels,bitrate:e.audioLength});return Boolean(t.supported)}))}}let ri=class extends ti{getFormat(){return"wav"}encodeAudio(e,t){let r;r=2===t.numChannels?Ct.interleaveBuffers(e[0],e[1]):e[0];const i=new ArrayBuffer(44+2*r.length),n=new DataView(i);return Ct.writeStringToDataView(n,0,"RIFF"),n.setUint32(4,36+2*r.length,!0),Ct.writeStringToDataView(n,8,"WAVE"),Ct.writeStringToDataView(n,12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,t.numChannels,!0),n.setUint32(24,t.sampleRate,!0),n.setUint32(28,4*t.sampleRate,!0),n.setUint16(32,2*t.numChannels,!0),n.setUint16(34,16,!0),Ct.writeStringToDataView(n,36,"data"),n.setUint32(40,2*r.length,!0),Ct.floatTo16BitPCM(n,44,r),Promise.resolve(n.buffer)}};ri=e([te()],ri);var ii,ni,si,ai,oi,li,ui,ci,hi,fi,di,_i,pi,mi,vi,gi,bi,Ei,Si,yi,Ai,wi,Ri,Mi,Bi,Ti,Ii,Pi,xi,ki,Ni,Ci,Oi,Di,Fi,Li,Vi,Gi,Ui,Hi,ji,qi,Wi,Yi,Xi,Ki,zi,Zi,Qi,$i,Ji,en,tn,rn,nn,sn,an,on,ln,un,cn,hn,fn,dn,_n,pn,mn,vn,gn,bn=ri,En={};function Sn(){if(ni)return ii;function e(e){return new Int16Array(e)}function t(e){return new Int32Array(e)}function r(e){return new Float32Array(e)}ni=1;var i={fill:function(e,t,r,i){if(2==arguments.length)for(var n=0;n<e.length;n++)e[n]=arguments[1];else for(n=t;n<r;n++)e[n]=i}},n={arraycopy:function(e,t,r,i,n){for(var s=t+n;t<s;)r[i++]=e[t++]},out:{}};n.out.println=function(e){console.log(e)},n.out.printf=function(){console.log.apply(console,arguments)};var s={};function a(e){this.ordinal=e}s.SQRT2=1.4142135623730951,s.FAST_LOG10=function(e){return Math.log10(e)},s.FAST_LOG10_X=function(e,t){return Math.log10(e)*t},a.short_block_allowed=new a(0),a.short_block_coupled=new a(1),a.short_block_dispensed=new a(2),a.short_block_forced=new a(3);var o={};function l(e){this.ordinal=e}o.MAX_VALUE=34028235e31,l.vbr_off=new l(0),l.vbr_mt=new l(1),l.vbr_rh=new l(2),l.vbr_abr=new l(3),l.vbr_mtrh=new l(4),l.vbr_default=l.vbr_mtrh;return ii={System:n,VbrMode:l,Float:o,ShortBlock:a,Util:s,Arrays:i,new_array_n:function e(t){if(1==t.length)return new Array(t[0]);var r=t[0];t=t.slice(1);for(var i=[],n=0;n<r;n++)i.push(e(t));return i},new_byte:function(e){return new Int8Array(e)},new_double:function(e){return new Float64Array(e)},new_float:r,new_float_n:function e(t){if(1==t.length)return r(t[0]);var i=t[0];t=t.slice(1);for(var n=[],s=0;s<i;s++)n.push(e(t));return n},new_int:t,new_int_n:function e(r){if(1==r.length)return t(r[0]);var i=r[0];r=r.slice(1);for(var n=[],s=0;s<i;s++)n.push(e(r));return n},new_short:e,new_short_n:function t(r){if(1==r.length)return e(r[0]);var i=r[0];r=r.slice(1);for(var n=[],s=0;s<i;s++)n.push(t(r));return n},assert:function(e){}},ii}function yn(){if(li)return oi;li=1;var e=An(),t=Sn(),r=t.System;t.VbrMode,t.Float,t.ShortBlock,t.Util,t.Arrays,t.new_array_n,t.new_byte,t.new_double;var i=t.new_float,n=t.new_float_n;return t.new_int,t.new_int_n,t.assert,oi=function(){this.l=i(e.SBMAX_l),this.s=n([e.SBMAX_s,3]);var t=this;this.assign=function(i){r.arraycopy(i.l,0,t.l,0,e.SBMAX_l);for(var n=0;n<e.SBMAX_s;n++)for(var s=0;s<3;s++)t.s[n][s]=i.s[n][s]}},oi}function An(){if(fi)return hi;fi=1;var e=Sn(),t=e.System,r=e.VbrMode;e.Float,e.ShortBlock,e.Util,e.Arrays;var i=e.new_array_n;e.new_byte,e.new_double;var n=e.new_float,s=e.new_float_n,a=e.new_int;e.new_int_n;var o=e.assert;function l(){var e=function(){if(ai)return si;ai=1;var e=Sn(),t=e.System;e.VbrMode,e.Float,e.ShortBlock;var r=e.Util,i=e.Arrays;e.new_array_n,e.new_byte,e.new_double;var n=e.new_float;e.new_float_n,e.new_int,e.new_int_n,e.assert;var s=An();return si=function(){var e=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*r.SQRT2*.5/2384e-9,.017876148*r.SQRT2*.5/2384e-9,.003134727*r.SQRT2*.5/2384e-9,.002457142*r.SQRT2*.5/2384e-9,971317e-9*r.SQRT2*.5/2384e-9,218868e-9*r.SQRT2*.5/2384e-9,101566e-9*r.SQRT2*.5/2384e-9,13828e-9*r.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],a=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],o=a[s.SHORT_TYPE],l=a[s.SHORT_TYPE],u=a[s.SHORT_TYPE],c=a[s.SHORT_TYPE],h=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function f(t,i,n){for(var s,a,o,l=10,u=i+238-14-286,c=-15;c<0;c++){var h,f,d;h=e[l+-10],f=t[u+-224]*h,d=t[i+224]*h,h=e[l+-9],f+=t[u+-160]*h,d+=t[i+160]*h,h=e[l+-8],f+=t[u+-96]*h,d+=t[i+96]*h,h=e[l+-7],f+=t[u+-32]*h,d+=t[i+32]*h,h=e[l+-6],f+=t[u+32]*h,d+=t[i+-32]*h,h=e[l+-5],f+=t[u+96]*h,d+=t[i+-96]*h,h=e[l+-4],f+=t[u+160]*h,d+=t[i+-160]*h,h=e[l+-3],f+=t[u+224]*h,d+=t[i+-224]*h,h=e[l+-2],f+=t[i+-256]*h,d-=t[u+256]*h,h=e[l+-1],f+=t[i+-192]*h,d-=t[u+192]*h,h=e[l+0],f+=t[i+-128]*h,d-=t[u+128]*h,h=e[l+1],f+=t[i+-64]*h,d-=t[u+64]*h,h=e[l+2],f+=t[i+0]*h,d-=t[u+0]*h,h=e[l+3],f+=t[i+64]*h,d-=t[u+-64]*h,h=e[l+4],f+=t[i+128]*h,d-=t[u+-128]*h,h=e[l+5],f+=t[i+192]*h,h=(d-=t[u+-192]*h)-(f*=e[l+6]),n[30+2*c]=d+f,n[31+2*c]=e[l+7]*h,l+=18,i--,u++}d=t[i+-16]*e[l+-10],f=t[i+-32]*e[l+-2],d+=(t[i+-48]-t[i+16])*e[l+-9],f+=t[i+-96]*e[l+-1],d+=(t[i+-80]+t[i+48])*e[l+-8],f+=t[i+-160]*e[l+0],d+=(t[i+-112]-t[i+80])*e[l+-7],f+=t[i+-224]*e[l+1],d+=(t[i+-144]+t[i+112])*e[l+-6],f-=t[i+32]*e[l+2],d+=(t[i+-176]-t[i+144])*e[l+-5],f-=t[i+96]*e[l+3],d+=(t[i+-208]+t[i+176])*e[l+-4],f-=t[i+160]*e[l+4],d+=(t[i+-240]-t[i+208])*e[l+-3],s=(f-=t[i+224])-d,a=f+d,d=n[14],f=n[15]-d,n[31]=a+d,n[30]=s+f,n[15]=s-f,n[14]=a-d,o=n[28]-n[0],n[0]+=n[28],n[28]=o*e[l+-36+7],o=n[29]-n[1],n[1]+=n[29],n[29]=o*e[l+-36+7],o=n[26]-n[2],n[2]+=n[26],n[26]=o*e[l+-72+7],o=n[27]-n[3],n[3]+=n[27],n[27]=o*e[l+-72+7],o=n[24]-n[4],n[4]+=n[24],n[24]=o*e[l+-108+7],o=n[25]-n[5],n[5]+=n[25],n[25]=o*e[l+-108+7],o=n[22]-n[6],n[6]+=n[22],n[22]=o*r.SQRT2,o=n[23]-n[7],n[7]+=n[23],n[23]=o*r.SQRT2-n[7],n[7]-=n[6],n[22]-=n[7],n[23]-=n[22],o=n[6],n[6]=n[31]-o,n[31]=n[31]+o,o=n[7],n[7]=n[30]-o,n[30]=n[30]+o,o=n[22],n[22]=n[15]-o,n[15]=n[15]+o,o=n[23],n[23]=n[14]-o,n[14]=n[14]+o,o=n[20]-n[8],n[8]+=n[20],n[20]=o*e[l+-180+7],o=n[21]-n[9],n[9]+=n[21],n[21]=o*e[l+-180+7],o=n[18]-n[10],n[10]+=n[18],n[18]=o*e[l+-216+7],o=n[19]-n[11],n[11]+=n[19],n[19]=o*e[l+-216+7],o=n[16]-n[12],n[12]+=n[16],n[16]=o*e[l+-252+7],o=n[17]-n[13],n[13]+=n[17],n[17]=o*e[l+-252+7],o=-n[20]+n[24],n[20]+=n[24],n[24]=o*e[l+-216+7],o=-n[21]+n[25],n[21]+=n[25],n[25]=o*e[l+-216+7],o=n[4]-n[8],n[4]+=n[8],n[8]=o*e[l+-216+7],o=n[5]-n[9],n[5]+=n[9],n[9]=o*e[l+-216+7],o=n[0]-n[12],n[0]+=n[12],n[12]=o*e[l+-72+7],o=n[1]-n[13],n[1]+=n[13],n[13]=o*e[l+-72+7],o=n[16]-n[28],n[16]+=n[28],n[28]=o*e[l+-72+7],o=-n[17]+n[29],n[17]+=n[29],n[29]=o*e[l+-72+7],o=r.SQRT2*(n[2]-n[10]),n[2]+=n[10],n[10]=o,o=r.SQRT2*(n[3]-n[11]),n[3]+=n[11],n[11]=o,o=r.SQRT2*(-n[18]+n[26]),n[18]+=n[26],n[26]=o-n[18],o=r.SQRT2*(-n[19]+n[27]),n[19]+=n[27],n[27]=o-n[19],o=n[2],n[19]-=n[3],n[3]-=o,n[2]=n[31]-o,n[31]+=o,o=n[3],n[11]-=n[19],n[18]-=o,n[3]=n[30]-o,n[30]+=o,o=n[18],n[27]-=n[11],n[19]-=o,n[18]=n[15]-o,n[15]+=o,o=n[19],n[10]-=o,n[19]=n[14]-o,n[14]+=o,o=n[10],n[11]-=o,n[10]=n[23]-o,n[23]+=o,o=n[11],n[26]-=o,n[11]=n[22]-o,n[22]+=o,o=n[26],n[27]-=o,n[26]=n[7]-o,n[7]+=o,o=n[27],n[27]=n[6]-o,n[6]+=o,o=r.SQRT2*(n[0]-n[4]),n[0]+=n[4],n[4]=o,o=r.SQRT2*(n[1]-n[5]),n[1]+=n[5],n[5]=o,o=r.SQRT2*(n[16]-n[20]),n[16]+=n[20],n[20]=o,o=r.SQRT2*(n[17]-n[21]),n[17]+=n[21],n[21]=o,o=-r.SQRT2*(n[8]-n[12]),n[8]+=n[12],n[12]=o-n[8],o=-r.SQRT2*(n[9]-n[13]),n[9]+=n[13],n[13]=o-n[9],o=-r.SQRT2*(n[25]-n[29]),n[25]+=n[29],n[29]=o-n[25],o=-r.SQRT2*(n[24]+n[28]),n[24]-=n[28],n[28]=o-n[24],o=n[24]-n[16],n[24]=o,o=n[20]-o,n[20]=o,o=n[28]-o,n[28]=o,o=n[25]-n[17],n[25]=o,o=n[21]-o,n[21]=o,o=n[29]-o,n[29]=o,o=n[17]-n[1],n[17]=o,o=n[9]-o,n[9]=o,o=n[25]-o,n[25]=o,o=n[5]-o,n[5]=o,o=n[21]-o,n[21]=o,o=n[13]-o,n[13]=o,o=n[29]-o,n[29]=o,o=n[1]-n[0],n[1]=o,o=n[16]-o,n[16]=o,o=n[17]-o,n[17]=o,o=n[8]-o,n[8]=o,o=n[9]-o,n[9]=o,o=n[24]-o,n[24]=o,o=n[25]-o,n[25]=o,o=n[4]-o,n[4]=o,o=n[5]-o,n[5]=o,o=n[20]-o,n[20]=o,o=n[21]-o,n[21]=o,o=n[12]-o,n[12]=o,o=n[13]-o,n[13]=o,o=n[28]-o,n[28]=o,o=n[29]-o,n[29]=o,o=n[0],n[0]+=n[31],n[31]-=o,o=n[1],n[1]+=n[30],n[30]-=o,o=n[16],n[16]+=n[15],n[15]-=o,o=n[17],n[17]+=n[14],n[14]-=o,o=n[8],n[8]+=n[23],n[23]-=o,o=n[9],n[9]+=n[22],n[22]-=o,o=n[24],n[24]+=n[7],n[7]-=o,o=n[25],n[25]+=n[6],n[6]-=o,o=n[4],n[4]+=n[27],n[27]-=o,o=n[5],n[5]+=n[26],n[26]-=o,o=n[20],n[20]+=n[11],n[11]-=o,o=n[21],n[21]+=n[10],n[10]-=o,o=n[12],n[12]+=n[19],n[19]-=o,o=n[13],n[13]+=n[18],n[18]-=o,o=n[28],n[28]+=n[3],n[3]-=o,o=n[29],n[29]+=n[2],n[2]-=o}function d(e,t){for(var r=0;r<3;r++){var i,n,o,l,u,c;n=(l=e[t+6]*a[s.SHORT_TYPE][0]-e[t+15])+(i=e[t+0]*a[s.SHORT_TYPE][2]-e[t+9]),o=l-i,u=(l=e[t+15]*a[s.SHORT_TYPE][0]+e[t+6])+(i=e[t+9]*a[s.SHORT_TYPE][2]+e[t+0]),c=-l+i,i=2069978111953089e-26*(e[t+3]*a[s.SHORT_TYPE][1]-e[t+12]),l=2069978111953089e-26*(e[t+12]*a[s.SHORT_TYPE][1]+e[t+3]),e[t+0]=190752519173728e-25*n+i,e[t+15]=190752519173728e-25*-u+l,o=.8660254037844387*o*1907525191737281e-26,u=.5*u*1907525191737281e-26+l,e[t+3]=o-u,e[t+6]=o+u,n=.5*n*1907525191737281e-26-i,c=.8660254037844387*c*1907525191737281e-26,e[t+9]=n+c,e[t+12]=n-c,t++}}function _(e,t,r){var i,n,s,a,o,u,c,h,f,d,_,p,m,v,g,b,E,S;s=r[17]-r[9],o=r[15]-r[11],u=r[14]-r[12],c=r[0]+r[8],h=r[1]+r[7],f=r[2]+r[6],d=r[3]+r[5],e[t+17]=c+f-d-(h-r[4]),n=(c+f-d)*l[19]+(h-r[4]),i=(s-o-u)*l[18],e[t+5]=i+n,e[t+6]=i-n,a=(r[16]-r[10])*l[18],h=h*l[19]+r[4],i=s*l[12]+a+o*l[13]+u*l[14],n=-c*l[16]+h-f*l[17]+d*l[15],e[t+1]=i+n,e[t+2]=i-n,i=s*l[13]-a-o*l[14]+u*l[12],n=-c*l[17]+h-f*l[15]+d*l[16],e[t+9]=i+n,e[t+10]=i-n,i=s*l[14]-a+o*l[12]-u*l[13],n=c*l[15]-h+f*l[16]-d*l[17],e[t+13]=i+n,e[t+14]=i-n,_=r[8]-r[0],m=r[6]-r[2],v=r[5]-r[3],g=r[17]+r[9],b=r[16]+r[10],E=r[15]+r[11],S=r[14]+r[12],e[t+0]=g+E+S+(b+r[13]),i=(g+E+S)*l[19]-(b+r[13]),n=(_-m+v)*l[18],e[t+11]=i+n,e[t+12]=i-n,p=(r[7]-r[1])*l[18],b=r[13]-b*l[19],i=g*l[15]-b+E*l[16]+S*l[17],n=_*l[14]+p+m*l[12]+v*l[13],e[t+3]=i+n,e[t+4]=i-n,i=-g*l[17]+b-E*l[15]-S*l[16],n=_*l[13]+p-m*l[14]-v*l[12],e[t+7]=i+n,e[t+8]=i-n,i=-g*l[16]+b-E*l[17]-S*l[15],n=_*l[12]-p+m*l[13]-v*l[14],e[t+15]=i+n,e[t+16]=i-n}this.mdct_sub48=function(e,r,l){for(var p=r,m=286,v=0;v<e.channels_out;v++){for(var g=0;g<e.mode_gr;g++){for(var b,E=e.l3_side.tt[g][v],S=E.xr,y=0,A=e.sb_sample[v][1-g],w=0,R=0;R<9;R++)for(f(p,m,A[w]),f(p,m+32,A[w+1]),w+=2,m+=64,b=1;b<32;b+=2)A[w-1][b]*=-1;for(b=0;b<32;b++,y+=18){var M=E.block_type,B=e.sb_sample[v][g],T=e.sb_sample[v][1-g];if(0!=E.mixed_block_flag&&b<2&&(M=0),e.amp_filter[b]<1e-12)i.fill(S,y+0,y+18,0);else{if(e.amp_filter[b]<1)for(R=0;R<18;R++)T[R][h[b]]*=e.amp_filter[b];if(M==s.SHORT_TYPE){for(R=-3;R<0;R++){var I=a[s.SHORT_TYPE][R+3];S[y+3*R+9]=B[9+R][h[b]]*I-B[8-R][h[b]],S[y+3*R+18]=B[14-R][h[b]]*I+B[15+R][h[b]],S[y+3*R+10]=B[15+R][h[b]]*I-B[14-R][h[b]],S[y+3*R+19]=T[2-R][h[b]]*I+T[3+R][h[b]],S[y+3*R+11]=T[3+R][h[b]]*I-T[2-R][h[b]],S[y+3*R+20]=T[8-R][h[b]]*I+T[9+R][h[b]]}d(S,y)}else{var P=n(18);for(R=-9;R<0;R++){var x,k;x=a[M][R+27]*T[R+9][h[b]]+a[M][R+36]*T[8-R][h[b]],k=a[M][R+9]*B[R+9][h[b]]-a[M][R+18]*B[8-R][h[b]],P[R+9]=x-k*o[3+R+9],P[R+18]=x*o[3+R+9]+k}_(S,y,P)}}if(M!=s.SHORT_TYPE&&0!=b)for(R=7;R>=0;--R){var N,C;N=S[y+R]*u[20+R]+S[y+-1-R]*c[28+R],C=S[y+R]*c[28+R]-S[y+-1-R]*u[20+R],S[y+-1-R]=N,S[y+R]=C}}}if(p=l,m=286,1==e.mode_gr)for(var O=0;O<18;O++)t.arraycopy(e.sb_sample[v][1][O],0,e.sb_sample[v][0][O],0,32)}}},si}(),u=function(){if(ci)return ui;ci=1;var e=yn();return ui=function(){this.thm=new e,this.en=new e}}(),c=l.FFTOFFSET,h=l.MPG_MD_MS_LR,f=null;this.psy=null;var d=null,_=null,p=null;this.setModules=function(e,t,r,i){f=e,this.psy=t,d=t,_=i,p=r};var m=new e;this.lame_encode_mp3_frame=function(e,v,g,b,E,S){var y,A=i([2,2]);A[0][0]=new u,A[0][1]=new u,A[1][0]=new u,A[1][1]=new u;var w,R=i([2,2]);R[0][0]=new u,R[0][1]=new u,R[1][0]=new u,R[1][1]=new u;var M,B,T,I=[null,null],P=e.internal_flags,x=s([2,4]),k=[.5,.5],N=[[0,0],[0,0]],C=[[0,0],[0,0]];if(I[0]=v,I[1]=g,0==P.lame_encode_frame_init&&function(e,t){var r,i,s=e.internal_flags;if(0==s.lame_encode_frame_init){var a,u,c=n(2014),h=n(2014);for(s.lame_encode_frame_init=1,a=0,u=0;a<286+576*(1+s.mode_gr);++a)a<576*s.mode_gr?(c[a]=0,2==s.channels_out&&(h[a]=0)):(c[a]=t[0][u],2==s.channels_out&&(h[a]=t[1][u]),++u);for(i=0;i<s.mode_gr;i++)for(r=0;r<s.channels_out;r++)s.l3_side.tt[i][r].block_type=l.SHORT_TYPE;m.mdct_sub48(s,c,h),o(576>=l.FFTOFFSET),o(s.mf_size>=l.BLKSIZE+e.framesize-l.FFTOFFSET),o(s.mf_size>=512+e.framesize-32)}}(e,I),P.padding=0,(P.slot_lag-=P.frac_SpF)<0&&(P.slot_lag+=e.out_samplerate,P.padding=1),0!=P.psymodel){var O=[null,null],D=0,F=a(2);for(T=0;T<P.mode_gr;T++){for(B=0;B<P.channels_out;B++)O[B]=I[B],D=576+576*T-l.FFTOFFSET;if(0!=(e.VBR==r.vbr_mtrh||e.VBR==r.vbr_mt?d.L3psycho_anal_vbr(e,O,D,T,A,R,N[T],C[T],x[T],F):d.L3psycho_anal_ns(e,O,D,T,A,R,N[T],C[T],x[T],F)))return-4;for(e.mode==MPEGMode.JOINT_STEREO&&(k[T]=x[T][2]+x[T][3],k[T]>0&&(k[T]=x[T][3]/k[T])),B=0;B<P.channels_out;B++){var L=P.l3_side.tt[T][B];L.block_type=F[B],L.mixed_block_flag=0}}}else for(T=0;T<P.mode_gr;T++)for(B=0;B<P.channels_out;B++)P.l3_side.tt[T][B].block_type=l.NORM_TYPE,P.l3_side.tt[T][B].mixed_block_flag=0,C[T][B]=N[T][B]=700;if(function(e){var t,r;if(0!=e.ATH.useAdjust)if(r=e.loudness_sq[0][0],t=e.loudness_sq[1][0],2==e.channels_out?(r+=e.loudness_sq[0][1],t+=e.loudness_sq[1][1]):(r+=r,t+=t),2==e.mode_gr&&(r=Math.max(r,t)),r*=.5,(r*=e.ATH.aaSensitivityP)>.03125)e.ATH.adjust>=1?e.ATH.adjust=1:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=1;else{var i=31.98*r+625e-6;e.ATH.adjust>=i?(e.ATH.adjust*=.075*i+.925,e.ATH.adjust<i&&(e.ATH.adjust=i)):e.ATH.adjustLimit>=i?e.ATH.adjust=i:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=i}else e.ATH.adjust=1}(P),m.mdct_sub48(P,I[0],I[1]),P.mode_ext=l.MPG_MD_LR_LR,e.force_ms)P.mode_ext=l.MPG_MD_MS_LR;else if(e.mode==MPEGMode.JOINT_STEREO){var V=0,G=0;for(T=0;T<P.mode_gr;T++)for(B=0;B<P.channels_out;B++)V+=C[T][B],G+=N[T][B];if(V<=1*G){var U=P.l3_side.tt[0],H=P.l3_side.tt[P.mode_gr-1];U[0].block_type==U[1].block_type&&H[0].block_type==H[1].block_type&&(P.mode_ext=l.MPG_MD_MS_LR)}}if(P.mode_ext==h?(w=R,M=C):(w=A,M=N),e.analysis&&null!=P.pinfo)for(T=0;T<P.mode_gr;T++)for(B=0;B<P.channels_out;B++)P.pinfo.ms_ratio[T]=P.ms_ratio[T],P.pinfo.ms_ener_ratio[T]=k[T],P.pinfo.blocktype[T][B]=P.l3_side.tt[T][B].block_type,P.pinfo.pe[T][B]=M[T][B],t.arraycopy(P.l3_side.tt[T][B].xr,0,P.pinfo.xr[T][B],0,576),P.mode_ext==h&&(P.pinfo.ers[T][B]=P.pinfo.ers[T][B+2],t.arraycopy(P.pinfo.energy[T][B+2],0,P.pinfo.energy[T][B],0,P.pinfo.energy[T][B].length));if(e.VBR==r.vbr_off||e.VBR==r.vbr_abr){var j,q;for(j=0;j<18;j++)P.nsPsy.pefirbuf[j]=P.nsPsy.pefirbuf[j+1];for(q=0,T=0;T<P.mode_gr;T++)for(B=0;B<P.channels_out;B++)q+=M[T][B];for(P.nsPsy.pefirbuf[18]=q,q=P.nsPsy.pefirbuf[9],j=0;j<9;j++)q+=(P.nsPsy.pefirbuf[j]+P.nsPsy.pefirbuf[18-j])*l.fircoef[j];for(q=3350*P.mode_gr*P.channels_out/q,T=0;T<P.mode_gr;T++)for(B=0;B<P.channels_out;B++)M[T][B]*=q}if(P.iteration_loop.iteration_loop(e,M,k,w),f.format_bitstream(e),y=f.copy_buffer(P,b,E,S,1),e.bWriteVbrTag&&_.addVbrFrame(e),e.analysis&&null!=P.pinfo){for(B=0;B<P.channels_out;B++){var W;for(W=0;W<c;W++)P.pinfo.pcmdata[B][W]=P.pinfo.pcmdata[B][W+e.framesize];for(W=c;W<1600;W++)P.pinfo.pcmdata[B][W]=I[B][W-c]}p.set_frame_pinfo(e,w)}return function(e){var t,r;for(o(0<=e.bitrate_index&&e.bitrate_index<16),o(0<=e.mode_ext&&e.mode_ext<4),e.bitrate_stereoMode_Hist[e.bitrate_index][4]++,e.bitrate_stereoMode_Hist[15][4]++,2==e.channels_out&&(e.bitrate_stereoMode_Hist[e.bitrate_index][e.mode_ext]++,e.bitrate_stereoMode_Hist[15][e.mode_ext]++),t=0;t<e.mode_gr;++t)for(r=0;r<e.channels_out;++r){var i=0|e.l3_side.tt[t][r].block_type;0!=e.l3_side.tt[t][r].mixed_block_flag&&(i=4),e.bitrate_blockType_Hist[e.bitrate_index][i]++,e.bitrate_blockType_Hist[e.bitrate_index][5]++,e.bitrate_blockType_Hist[15][i]++,e.bitrate_blockType_Hist[15][5]++}}(P),y}}return l.ENCDELAY=576,l.POSTDELAY=1152,l.MDCTDELAY=48,l.FFTOFFSET=224+l.MDCTDELAY,l.DECDELAY=528,l.SBLIMIT=32,l.CBANDS=64,l.SBPSY_l=21,l.SBPSY_s=12,l.SBMAX_l=22,l.SBMAX_s=13,l.PSFB21=6,l.PSFB12=6,l.BLKSIZE=1024,l.HBLKSIZE=l.BLKSIZE/2+1,l.BLKSIZE_s=256,l.HBLKSIZE_s=l.BLKSIZE_s/2+1,l.NORM_TYPE=0,l.START_TYPE=1,l.SHORT_TYPE=2,l.STOP_TYPE=3,l.MPG_MD_LR_LR=0,l.MPG_MD_LR_I=1,l.MPG_MD_MS_LR=2,l.MPG_MD_MS_I=3,l.fircoef=[-.1039435,-.1892065,5*-.0432472,-.155915,3898045e-23,.0467745*5,.50455,.756825,.187098*5],hi=l}function wn(){if(mi)return pi;mi=1;var e=Sn();e.System;var t=e.VbrMode,r=e.Float,i=e.ShortBlock,n=e.Util,s=e.Arrays;e.new_array_n,e.new_byte,e.new_double;var a=e.new_float,o=e.new_float_n,l=e.new_int;e.new_int_n;var u=e.assert,c=function(){if(_i)return di;_i=1;var e=Sn();e.System,e.VbrMode,e.Float,e.ShortBlock;var t=e.Util;e.Arrays,e.new_array_n,e.new_byte,e.new_double;var r=e.new_float;e.new_float_n,e.new_int,e.new_int_n,e.assert;var i=An();return di=function(){var e=r(i.BLKSIZE),n=r(i.BLKSIZE_s/2),s=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function a(e,r,i){var n,a,o,l=0,u=r+(i<<=1);n=4;do{var c,h,f,d,_,p,m;m=n>>1,p=(_=n<<1)+(d=n),n=_<<1,o=(a=r)+m;do{A=e[a+0]-e[a+d],y=e[a+0]+e[a+d],B=e[a+_]-e[a+p],R=e[a+_]+e[a+p],e[a+_]=y-R,e[a+0]=y+R,e[a+p]=A-B,e[a+d]=A+B,A=e[o+0]-e[o+d],y=e[o+0]+e[o+d],B=t.SQRT2*e[o+p],R=t.SQRT2*e[o+_],e[o+_]=y-R,e[o+0]=y+R,e[o+p]=A-B,e[o+d]=A+B,o+=n,a+=n}while(a<u);for(h=s[l+0],c=s[l+1],f=1;f<m;f++){var v,g;v=1-2*c*c,g=2*c*h,a=r+f,o=r+d-f;do{var b,E,S,y,A,w,R,M,B,T;E=g*e[a+d]-v*e[o+d],b=v*e[a+d]+g*e[o+d],A=e[a+0]-b,y=e[a+0]+b,w=e[o+0]-E,S=e[o+0]+E,E=g*e[a+p]-v*e[o+p],b=v*e[a+p]+g*e[o+p],B=e[a+_]-b,R=e[a+_]+b,T=e[o+_]-E,M=e[o+_]+E,E=c*R-h*T,b=h*R+c*T,e[a+_]=y-b,e[a+0]=y+b,e[o+p]=w-E,e[o+d]=w+E,E=h*M-c*B,b=c*M+h*B,e[o+_]=S-b,e[o+0]=S+b,e[a+p]=A-E,e[a+d]=A+E,o+=n,a+=n}while(a<u);h=(v=h)*s[l+0]-c*s[l+1],c=v*s[l+1]+c*s[l+0]}l+=2}while(n<i)}var o=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(e,t,r,s,l){for(var u=0;u<3;u++){var c=i.BLKSIZE_s/2,h=65535&192*(u+1),f=i.BLKSIZE_s/8-1;do{var d,_,p,m,v,g=255&o[f<<2];_=(d=n[g]*s[r][l+g+h])-(v=n[127-g]*s[r][l+g+h+128]),d+=v,m=(p=n[g+64]*s[r][l+g+h+64])-(v=n[63-g]*s[r][l+g+h+192]),p+=v,c-=4,t[u][c+0]=d+p,t[u][c+2]=d-p,t[u][c+1]=_+m,t[u][c+3]=_-m,_=(d=n[g+1]*s[r][l+g+h+1])-(v=n[126-g]*s[r][l+g+h+129]),d+=v,m=(p=n[g+65]*s[r][l+g+h+65])-(v=n[62-g]*s[r][l+g+h+193]),p+=v,t[u][c+i.BLKSIZE_s/2+0]=d+p,t[u][c+i.BLKSIZE_s/2+2]=d-p,t[u][c+i.BLKSIZE_s/2+1]=_+m,t[u][c+i.BLKSIZE_s/2+3]=_-m}while(--f>=0);a(t[u],c,i.BLKSIZE_s/2)}},this.fft_long=function(t,r,n,s,l){var u=i.BLKSIZE/8-1,c=i.BLKSIZE/2;do{var h,f,d,_,p,m=255&o[u];f=(h=e[m]*s[n][l+m])-(p=e[m+512]*s[n][l+m+512]),h+=p,_=(d=e[m+256]*s[n][l+m+256])-(p=e[m+768]*s[n][l+m+768]),d+=p,r[0+(c-=4)]=h+d,r[c+2]=h-d,r[c+1]=f+_,r[c+3]=f-_,f=(h=e[m+1]*s[n][l+m+1])-(p=e[m+513]*s[n][l+m+513]),h+=p,_=(d=e[m+257]*s[n][l+m+257])-(p=e[m+769]*s[n][l+m+769]),d+=p,r[c+i.BLKSIZE/2+0]=h+d,r[c+i.BLKSIZE/2+2]=h-d,r[c+i.BLKSIZE/2+1]=f+_,r[c+i.BLKSIZE/2+3]=f-_}while(--u>=0);a(r,c,i.BLKSIZE/2)},this.init_fft=function(t){for(var r=0;r<i.BLKSIZE;r++)e[r]=.42-.5*Math.cos(2*Math.PI*(r+.5)/i.BLKSIZE)+.08*Math.cos(4*Math.PI*(r+.5)/i.BLKSIZE);for(r=0;r<i.BLKSIZE_s/2;r++)n[r]=.5*(1-Math.cos(2*Math.PI*(r+.5)/i.BLKSIZE_s))}},di}(),h=An();return pi=function(){var e=new c,f=2.302585092994046,d=1/217621504/(h.BLKSIZE/2),_=.3,p=21,m=.2302585093;function v(e,t){for(var r=0,i=0;i<h.BLKSIZE/2;++i)r+=e[i]*t.ATH.eql_w[i];return r*=d}function g(t,r,i,s,a,o,l,u,c,f,d){var _=t.internal_flags;if(c<2)e.fft_long(_,s[a],c,f,d),e.fft_short(_,o[l],c,f,d);else if(2==c){for(var p=h.BLKSIZE-1;p>=0;--p){var m=s[a+0][p],g=s[a+1][p];s[a+0][p]=(m+g)*n.SQRT2*.5,s[a+1][p]=(m-g)*n.SQRT2*.5}for(var b=2;b>=0;--b)for(p=h.BLKSIZE_s-1;p>=0;--p){m=o[l+0][b][p],g=o[l+1][b][p];o[l+0][b][p]=(m+g)*n.SQRT2*.5,o[l+1][b][p]=(m-g)*n.SQRT2*.5}}r[0]=s[a+0][0],r[0]*=r[0];for(p=h.BLKSIZE/2-1;p>=0;--p){var E=s[a+0][h.BLKSIZE/2-p],S=s[a+0][h.BLKSIZE/2+p];r[h.BLKSIZE/2-p]=.5*(E*E+S*S)}for(b=2;b>=0;--b){i[b][0]=o[l+0][b][0],i[b][0]*=i[b][0];for(p=h.BLKSIZE_s/2-1;p>=0;--p){E=o[l+0][b][h.BLKSIZE_s/2-p],S=o[l+0][b][h.BLKSIZE_s/2+p];i[b][h.BLKSIZE_s/2-p]=.5*(E*E+S*S)}}var y=0;for(p=11;p<h.HBLKSIZE;p++)y+=r[p];if(_.tot_ener[c]=y,t.analysis){for(p=0;p<h.HBLKSIZE;p++)_.pinfo.energy[u][c][p]=_.pinfo.energy_save[c][p],_.pinfo.energy_save[c][p]=r[p];_.pinfo.pe[u][c]=_.pe[c]}2==t.athaa_loudapprox&&c<2&&(_.loudness_sq[u][c]=_.loudness_sq_save[c],_.loudness_sq_save[c]=v(r,_))}var b,E,S,y=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749],A=[3.3246*3.3246,3.23837*3.23837,9.9500500969,9.0247369744,8.1854926609,7.0440875649,2.46209*2.46209,2.284*2.284,4.4892710641,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,2.4621061921,2.1508568964,1.37074*1.37074,1.31036*1.31036,1.5691069696,1.4555939904,1.16203*1.16203,1.2715945225,1.09428*1.09428,1.0659*1.0659,1.0779838276,1.0382591025,1],w=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],R=[5.5396212496,2.29259*2.29259,4.9868695969,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,2.2499700001,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.2339655056,1.0779838276];function M(e,t,r,i,s,a){var o;if(t>e){if(!(t<e*E))return e+t;o=t/e}else{if(e>=t*E)return e+t;o=e/t}if(u(e>=0),u(t>=0),e+=t,i+3<=6){if(o>=b)return e;var l=0|n.FAST_LOG10_X(o,16);return e*w[l]}var c,h;l=0|n.FAST_LOG10_X(o,16);return t=s.ATH.cb_l[r]*s.ATH.adjust,u(t>=0),e<S*t?e>t?(c=1,l<=13&&(c=R[l]),h=n.FAST_LOG10_X(e/t,10/15),e*((A[l]-c)*h+c)):l>13?e:e*R[l]:e*A[l]}var B=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1];function T(e,t,r){var i;if(e<0&&(e=0),t<0&&(t=0),e<=0)return t;if(t<=0)return e;if(i=t>e?t/e:e/t,-2<=r&&r<=2){if(i>=b)return e+t;var s=0|n.FAST_LOG10_X(i,16);return(e+t)*B[s]}return i<E?e+t:(e<t&&(e=t),e)}function I(e,t,r,i,n){var s,a,o=0,l=0;for(s=a=0;s<h.SBMAX_s;++a,++s){for(var c=e.bo_s[s],f=e.npart_s,d=c<f?c:f;a<d;)u(t[a]>=0),u(r[a]>=0),o+=t[a],l+=r[a],a++;if(e.en[i].s[s][n]=o,e.thm[i].s[s][n]=l,a>=f){++s;break}u(t[a]>=0),u(r[a]>=0);var _=e.PSY.bo_s_weight[s],p=1-_;o=_*t[a],l=_*r[a],e.en[i].s[s][n]+=o,e.thm[i].s[s][n]+=l,o=p*t[a],l=p*r[a]}for(;s<h.SBMAX_s;++s)e.en[i].s[s][n]=0,e.thm[i].s[s][n]=0}function P(e,t,r,i){var n,s,a=0,o=0;for(n=s=0;n<h.SBMAX_l;++s,++n){for(var l=e.bo_l[n],c=e.npart_l,f=l<c?l:c;s<f;)u(t[s]>=0),u(r[s]>=0),a+=t[s],o+=r[s],s++;if(e.en[i].l[n]=a,e.thm[i].l[n]=o,s>=c){++n;break}u(t[s]>=0),u(r[s]>=0);var d=e.PSY.bo_l_weight[n],_=1-d;a=d*t[s],o=d*r[s],e.en[i].l[n]+=a,e.thm[i].l[n]+=o,a=_*t[s],o=_*r[s]}for(;n<h.SBMAX_l;++n)e.en[i].l[n]=0,e.thm[i].l[n]=0}function x(e,t,r,i,n,s){var a,o,l=e.internal_flags;for(o=a=0;o<l.npart_s;++o){for(var c=0,f=l.numlines_s[o],d=0;d<f;++d,++a){c+=t[s][a]}r[o]=c}for(u(o==l.npart_s),u(129==a),a=o=0;o<l.npart_s;o++){var _=l.s3ind_s[o][0],p=l.s3_ss[a++]*r[_];for(++_;_<=l.s3ind_s[o][1];)p+=l.s3_ss[a]*r[_],++a,++_;var m=2*l.nb_s1[n][o];if(i[o]=Math.min(p,m),l.blocktype_old[1&n]==h.SHORT_TYPE){m=16*l.nb_s2[n][o];var v=i[o];i[o]=Math.min(m,v)}l.nb_s2[n][o]=l.nb_s1[n][o],l.nb_s1[n][o]=p,u(i[o]>=0)}for(;o<=h.CBANDS;++o)r[o]=0,i[o]=0}function k(e,t,r){return r>=1?e:r<=0?t:t>0?Math.pow(e/t,r)*t:0}var N=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function C(e,t){for(var r=309.07,i=0;i<h.SBMAX_s-1;i++)for(var s=0;s<3;s++){var a=e.thm.s[i][s];if(u(i<N.length),a>0){var o=a*t,l=e.en.s[i][s];l>o&&(l>1e10*o?r+=N[i]*(10*f):(u(o>0),r+=N[i]*n.FAST_LOG10(l/o)))}}return r}var O=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function D(e,t){for(var r=281.0575,i=0;i<h.SBMAX_l-1;i++){var s=e.thm.l[i];if(u(i<O.length),s>0){var a=s*t,o=e.en.l[i];o>a&&(o>1e10*a?r+=O[i]*(10*f):(u(a>0),r+=O[i]*n.FAST_LOG10(o/a)))}}return r}function F(e,t,r,i,n){var s,a;for(s=a=0;s<e.npart_l;++s){var o,l=0,c=0;for(o=0;o<e.numlines_l[s];++o,++a){var h=t[a];u(h>=0),l+=h,c<h&&(c=h)}r[s]=l,i[s]=c,n[s]=l*e.rnumlines_l[s],u(e.rnumlines_l[s]>=0),u(l>=0),u(r[s]>=0),u(i[s]>=0),u(n[s]>=0)}}function L(e,t,r,i){var n=y.length-1,s=0,a=r[s]+r[s+1];(u(a>=0),a>0)?((o=t[s])<t[s+1]&&(o=t[s+1]),u(e.numlines_l[s]+e.numlines_l[s+1]-1>0),(l=0|(a=20*(2*o-a)/(a*(e.numlines_l[s]+e.numlines_l[s+1]-1))))>n&&(l=n),i[s]=l):i[s]=0;for(s=1;s<e.npart_l-1;s++){var o,l;if(a=r[s-1]+r[s]+r[s+1],u(a>=0),a>0)(o=t[s-1])<t[s]&&(o=t[s]),o<t[s+1]&&(o=t[s+1]),u(e.numlines_l[s-1]+e.numlines_l[s]+e.numlines_l[s+1]-1>0),(l=0|(a=20*(3*o-a)/(a*(e.numlines_l[s-1]+e.numlines_l[s]+e.numlines_l[s+1]-1))))>n&&(l=n),i[s]=l;else i[s]=0}(u(s>0),u(s==e.npart_l-1),a=r[s-1]+r[s],u(a>=0),a>0)?((o=t[s-1])<t[s]&&(o=t[s]),u(e.numlines_l[s-1]+e.numlines_l[s]-1>0),(l=0|(a=20*(2*o-a)/(a*(e.numlines_l[s-1]+e.numlines_l[s]-1))))>n&&(l=n),i[s]=l):i[s]=0;u(s==e.npart_l-1)}var V=[-1730326e-23,-.01703172,-1349528e-23,.0418072,-673278e-22,-.0876324,-30835e-21,.1863476,-1104424e-22,-.627638];function G(t,r,i,s,a,o,l,u){var c=t.internal_flags;if(s<2)e.fft_long(c,l[u],s,r,i);else if(2==s)for(var f=h.BLKSIZE-1;f>=0;--f){var d=l[u+0][f],_=l[u+1][f];l[u+0][f]=(d+_)*n.SQRT2*.5,l[u+1][f]=(d-_)*n.SQRT2*.5}o[0]=l[u+0][0],o[0]*=o[0];for(f=h.BLKSIZE/2-1;f>=0;--f){var p=l[u+0][h.BLKSIZE/2-f],m=l[u+0][h.BLKSIZE/2+f];o[h.BLKSIZE/2-f]=.5*(p*p+m*m)}var v=0;for(f=11;f<h.HBLKSIZE;f++)v+=o[f];if(c.tot_ener[s]=v,t.analysis){for(f=0;f<h.HBLKSIZE;f++)c.pinfo.energy[a][s][f]=c.pinfo.energy_save[s][f],c.pinfo.energy_save[s][f]=o[f];c.pinfo.pe[a][s]=c.pe[s]}}function U(t,r,i,s,a,o,l,u){var c=t.internal_flags;if(0==a&&s<2&&e.fft_short(c,l[u],s,r,i),2==s)for(var f=h.BLKSIZE_s-1;f>=0;--f){var d=l[u+0][a][f],_=l[u+1][a][f];l[u+0][a][f]=(d+_)*n.SQRT2*.5,l[u+1][a][f]=(d-_)*n.SQRT2*.5}o[a][0]=l[u+0][a][0],o[a][0]*=o[a][0];for(f=h.BLKSIZE_s/2-1;f>=0;--f){var p=l[u+0][a][h.BLKSIZE_s/2-f],m=l[u+0][a][h.BLKSIZE_s/2+f];o[a][h.BLKSIZE_s/2-f]=.5*(p*p+m*m)}}function H(e,t,r,i){var n=e.internal_flags;2==e.athaa_loudapprox&&r<2&&(n.loudness_sq[t][r]=n.loudness_sq_save[r],n.loudness_sq_save[r]=v(i,n))}this.L3psycho_anal_ns=function(e,r,n,c,f,d,m,v,b,E){var S,A,w,R,B,T,N,O,G,U,H=e.internal_flags,j=o([2,h.BLKSIZE]),q=o([2,3,h.BLKSIZE_s]),W=a(h.CBANDS+1),Y=a(h.CBANDS+1),X=a(h.CBANDS+2),K=l(2),z=l(2),Z=o([2,576]),Q=l(h.CBANDS+2),$=l(h.CBANDS+2);for(s.fill($,0),S=H.channels_out,e.mode==MPEGMode.JOINT_STEREO&&(S=4),G=e.VBR==t.vbr_off?0==H.ResvMax?0:H.ResvSize/H.ResvMax*.5:e.VBR==t.vbr_rh||e.VBR==t.vbr_mtrh||e.VBR==t.vbr_mt?.6:1,A=0;A<H.channels_out;A++){var J=r[A],ee=n+576-350-p+192;for(u(10==V.length),R=0;R<576;R++){var te,re;for(te=J[ee+R+10],re=0,B=0;B<9;B+=2)te+=V[B]*(J[ee+R+B]+J[ee+R+p-B]),re+=V[B+1]*(J[ee+R+B+1]+J[ee+R+p-B-1]);Z[A][R]=te+re}f[c][A].en.assign(H.en[A]),f[c][A].thm.assign(H.thm[A]),S>2&&(d[c][A].en.assign(H.en[A+2]),d[c][A].thm.assign(H.thm[A+2]))}for(A=0;A<S;A++){var ie,ne=a(12),se=[0,0,0,0],ae=a(12),oe=1,le=a(h.CBANDS),ue=a(h.CBANDS),ce=[0,0,0,0],he=a(h.HBLKSIZE),fe=o([3,h.HBLKSIZE_s]);for(u(H.npart_s<=h.CBANDS),u(H.npart_l<=h.CBANDS),R=0;R<3;R++)ne[R]=H.nsPsy.last_en_subshort[A][R+6],u(H.nsPsy.last_en_subshort[A][R+4]>0),ae[R]=ne[R]/H.nsPsy.last_en_subshort[A][R+4],se[0]+=ne[R];if(2==A)for(R=0;R<576;R++){var de,_e;de=Z[0][R],_e=Z[1][R],Z[0][R]=de+_e,Z[1][R]=de-_e}var pe=Z[1&A],me=0;for(R=0;R<9;R++){for(var ve=me+64,ge=1;me<ve;me++)ge<Math.abs(pe[me])&&(ge=Math.abs(pe[me]));H.nsPsy.last_en_subshort[A][R]=ne[R+3]=ge,se[1+R/3]+=ge,ge>ne[R+3-2]?(u(ne[R+3-2]>0),ge/=ne[R+3-2]):ne[R+3-2]>10*ge?(u(ge>0),ge=ne[R+3-2]/(10*ge)):ge=0,ae[R+3]=ge}if(e.analysis){var be=ae[0];for(R=1;R<12;R++)be<ae[R]&&(be=ae[R]);H.pinfo.ers[c][A]=H.pinfo.ers_save[A],H.pinfo.ers_save[A]=be}for(ie=3==A?H.nsPsy.attackthre_s:H.nsPsy.attackthre,R=0;R<12;R++)0==ce[R/3]&&ae[R]>ie&&(ce[R/3]=R%3+1);for(R=1;R<4;R++){var Ee;se[R-1]>se[R]?(u(se[R]>0),Ee=se[R-1]/se[R]):(u(se[R-1]>0),Ee=se[R]/se[R-1]),Ee<1.7&&(ce[R]=0,1==R&&(ce[0]=0))}for(0!=ce[0]&&0!=H.nsPsy.lastAttacks[A]&&(ce[0]=0),3!=H.nsPsy.lastAttacks[A]&&ce[0]+ce[1]+ce[2]+ce[3]==0||(oe=0,0!=ce[1]&&0!=ce[0]&&(ce[1]=0),0!=ce[2]&&0!=ce[1]&&(ce[2]=0),0!=ce[3]&&0!=ce[2]&&(ce[3]=0)),A<2?z[A]=oe:0==oe&&(z[0]=z[1]=0),b[A]=H.tot_ener[A],g(e,he,fe,j,1&A,q,1&A,c,A,r,n),F(H,he,W,le,ue),L(H,le,ue,Q),O=0;O<3;O++){var Se,ye;for(x(e,fe,Y,X,A,O),I(H,Y,X,A,O),N=0;N<h.SBMAX_s;N++){if(ye=H.thm[A].s[N][O],ye*=.8,ce[O]>=2||1==ce[O+1]){var Ae=0!=O?O-1:2;ge=k(H.thm[A].s[N][Ae],ye,.6*G);ye=Math.min(ye,ge)}if(1==ce[O]){Ae=0!=O?O-1:2,ge=k(H.thm[A].s[N][Ae],ye,_*G);ye=Math.min(ye,ge)}else if(0!=O&&3==ce[O-1]||0==O&&3==H.nsPsy.lastAttacks[A]){Ae=2!=O?O+1:0,ge=k(H.thm[A].s[N][Ae],ye,_*G);ye=Math.min(ye,ge)}Se=ne[3*O+3]+ne[3*O+4]+ne[3*O+5],6*ne[3*O+5]<Se&&(ye*=.5,6*ne[3*O+4]<Se&&(ye*=.5)),H.thm[A].s[N][O]=ye}}for(H.nsPsy.lastAttacks[A]=ce[2],T=0,w=0;w<H.npart_l;w++){for(var we=H.s3ind[w][0],Re=W[we]*y[Q[we]],Me=H.s3_ll[T++]*Re;++we<=H.s3ind[w][1];)Re=W[we]*y[Q[we]],Me=M(Me,H.s3_ll[T++]*Re,we,we-w,H);Me*=.158489319246111,H.blocktype_old[1&A]==h.SHORT_TYPE?X[w]=Me:X[w]=k(Math.min(Me,Math.min(2*H.nb_1[A][w],16*H.nb_2[A][w])),Me,G),H.nb_2[A][w]=H.nb_1[A][w],H.nb_1[A][w]=Me}for(;w<=h.CBANDS;++w)W[w]=0,X[w]=0;P(H,W,X,A)}(e.mode!=MPEGMode.STEREO&&e.mode!=MPEGMode.JOINT_STEREO||e.interChRatio>0&&function(e,t){var r=e.internal_flags;if(r.channels_out>1){for(var i=0;i<h.SBMAX_l;i++){var n=r.thm[0].l[i],s=r.thm[1].l[i];r.thm[0].l[i]+=s*t,r.thm[1].l[i]+=n*t}for(i=0;i<h.SBMAX_s;i++)for(var a=0;a<3;a++)n=r.thm[0].s[i][a],s=r.thm[1].s[i][a],r.thm[0].s[i][a]+=s*t,r.thm[1].s[i][a]+=n*t}}(e,e.interChRatio),e.mode==MPEGMode.JOINT_STEREO)&&(!function(e){for(var t=0;t<h.SBMAX_l;t++)if(!(e.thm[0].l[t]>1.58*e.thm[1].l[t]||e.thm[1].l[t]>1.58*e.thm[0].l[t])){var r=e.mld_l[t]*e.en[3].l[t],i=Math.max(e.thm[2].l[t],Math.min(e.thm[3].l[t],r));r=e.mld_l[t]*e.en[2].l[t];var n=Math.max(e.thm[3].l[t],Math.min(e.thm[2].l[t],r));e.thm[2].l[t]=i,e.thm[3].l[t]=n}for(t=0;t<h.SBMAX_s;t++)for(var s=0;s<3;s++)e.thm[0].s[t][s]>1.58*e.thm[1].s[t][s]||e.thm[1].s[t][s]>1.58*e.thm[0].s[t][s]||(r=e.mld_s[t]*e.en[3].s[t][s],i=Math.max(e.thm[2].s[t][s],Math.min(e.thm[3].s[t][s],r)),r=e.mld_s[t]*e.en[2].s[t][s],n=Math.max(e.thm[3].s[t][s],Math.min(e.thm[2].s[t][s],r)),e.thm[2].s[t][s]=i,e.thm[3].s[t][s]=n)}(H),U=e.msfix,Math.abs(U)>0&&function(e,t,r){var i=t,n=Math.pow(10,r);t*=2,i*=2;for(var s=0;s<h.SBMAX_l;s++)f=e.ATH.cb_l[e.bm_l[s]]*n,(o=Math.min(Math.max(e.thm[0].l[s],f),Math.max(e.thm[1].l[s],f)))*t<(l=Math.max(e.thm[2].l[s],f))+(c=Math.max(e.thm[3].l[s],f))&&u((l*=d=o*i/(l+c))+(c*=d)>0),e.thm[2].l[s]=Math.min(l,e.thm[2].l[s]),e.thm[3].l[s]=Math.min(c,e.thm[3].l[s]);for(n*=h.BLKSIZE_s/h.BLKSIZE,s=0;s<h.SBMAX_s;s++)for(var a=0;a<3;a++){var o,l,c,f,d;f=e.ATH.cb_s[e.bm_s[s]]*n,(o=Math.min(Math.max(e.thm[0].s[s][a],f),Math.max(e.thm[1].s[s][a],f)))*t<(l=Math.max(e.thm[2].s[s][a],f))+(c=Math.max(e.thm[3].s[s][a],f))&&u((l*=d=o*t/(l+c))+(c*=d)>0),e.thm[2].s[s][a]=Math.min(e.thm[2].s[s][a],l),e.thm[3].s[s][a]=Math.min(e.thm[3].s[s][a],c)}}(H,U,e.ATHlower*H.ATH.adjust));for(function(e,t,r,n){var s=e.internal_flags;e.short_blocks!=i.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var a=0;a<s.channels_out;a++)n[a]=h.NORM_TYPE,e.short_blocks==i.short_block_dispensed&&(t[a]=1),e.short_blocks==i.short_block_forced&&(t[a]=0),0!=t[a]?(u(s.blocktype_old[a]!=h.START_TYPE),s.blocktype_old[a]==h.SHORT_TYPE&&(n[a]=h.STOP_TYPE)):(n[a]=h.SHORT_TYPE,s.blocktype_old[a]==h.NORM_TYPE&&(s.blocktype_old[a]=h.START_TYPE),s.blocktype_old[a]==h.STOP_TYPE&&(s.blocktype_old[a]=h.SHORT_TYPE)),r[a]=s.blocktype_old[a],s.blocktype_old[a]=n[a]}(e,z,E,K),A=0;A<S;A++){var Be,Te,Ie,Pe=0;A>1?(Be=v,Pe=-2,Te=h.NORM_TYPE,E[0]!=h.SHORT_TYPE&&E[1]!=h.SHORT_TYPE||(Te=h.SHORT_TYPE),Ie=d[c][A-2]):(Be=m,Pe=0,Te=E[A],Ie=f[c][A]),Te==h.SHORT_TYPE?Be[Pe+A]=C(Ie,H.masking_lower):Be[Pe+A]=D(Ie,H.masking_lower),e.analysis&&(H.pinfo.pe[c][A]=Be[Pe+A])}return 0};var j=[-1730326e-23,-.01703172,-1349528e-23,.0418072,-673278e-22,-.0876324,-30835e-21,.1863476,-1104424e-22,-.627638];function q(e,t,r){if(0==r)for(var i=0;i<e.npart_s;i++)e.nb_s2[t][i]=e.nb_s1[t][i],e.nb_s1[t][i]=0}function W(e,t){for(var r=0;r<e.npart_l;r++)e.nb_2[t][r]=e.nb_1[t][r],e.nb_1[t][r]=0}function Y(e,t,r,i,n,s){var o,l,c,f=e.internal_flags,d=new float[h.CBANDS],_=a(h.CBANDS),p=new int[h.CBANDS];for(c=l=0;c<f.npart_s;++c){var m=0,v=0,g=f.numlines_s[c];for(o=0;o<g;++o,++l){var b=t[s][l];m+=b,v<b&&(v=b)}r[c]=m,u(m>=0),d[c]=v,u(g>0),_[c]=m/g,u(_[c]>=0)}for(u(c==f.npart_s),u(129==l);c<h.CBANDS;++c)d[c]=0,_[c]=0;for(function(e,t,r,i){var n=y.length-1,s=0,a=r[s]+r[s+1];for(u(a>=0),a>0?((o=t[s])<t[s+1]&&(o=t[s+1]),u(e.numlines_s[s]+e.numlines_s[s+1]-1>0),(l=0|(a=20*(2*o-a)/(a*(e.numlines_s[s]+e.numlines_s[s+1]-1))))>n&&(l=n),i[s]=l):i[s]=0,s=1;s<e.npart_s-1;s++){var o,l;a=r[s-1]+r[s]+r[s+1],u(s+1<e.npart_s),u(a>=0),a>0?((o=t[s-1])<t[s]&&(o=t[s]),o<t[s+1]&&(o=t[s+1]),u(e.numlines_s[s-1]+e.numlines_s[s]+e.numlines_s[s+1]-1>0),(l=0|(a=20*(3*o-a)/(a*(e.numlines_s[s-1]+e.numlines_s[s]+e.numlines_s[s+1]-1))))>n&&(l=n),i[s]=l):i[s]=0}u(s>0),u(s==e.npart_s-1),a=r[s-1]+r[s],u(a>=0),a>0?((o=t[s-1])<t[s]&&(o=t[s]),u(e.numlines_s[s-1]+e.numlines_s[s]-1>0),(l=0|(a=20*(2*o-a)/(a*(e.numlines_s[s-1]+e.numlines_s[s]-1))))>n&&(l=n),i[s]=l):i[s]=0,u(s==e.npart_s-1)}(f,d,_,p),l=c=0;c<f.npart_s;c++){var E,S,A,w,R,M=f.s3ind_s[c][0],B=f.s3ind_s[c][1];for(E=p[M],S=1,w=f.s3_ss[l]*r[M]*y[p[M]],++l,++M;M<=B;)E+=p[M],S+=1,w=T(w,A=f.s3_ss[l]*r[M]*y[p[M]],M-c),++l,++M;w*=R=.5*y[E=(1+2*E)/(2*S)],i[c]=w,f.nb_s2[n][c]=f.nb_s1[n][c],f.nb_s1[n][c]=w,A=d[c],A*=f.minval_s[c],A*=R,i[c]>A&&(i[c]=A),f.masking_lower>1&&(i[c]*=f.masking_lower),i[c]>r[c]&&(i[c]=r[c]),f.masking_lower<1&&(i[c]*=f.masking_lower),u(i[c]>=0)}for(;c<h.CBANDS;++c)r[c]=0,i[c]=0}function X(e,t,r,i,n){var s,o=a(h.CBANDS),c=a(h.CBANDS),f=l(h.CBANDS+2);F(e,t,r,o,c),L(e,o,c,f);var d=0;for(s=0;s<e.npart_l;s++){var p,m,v,g=e.s3ind[s][0],b=e.s3ind[s][1],E=0,S=0;for(E=f[g],S+=1,m=e.s3_ll[d]*r[g]*y[f[g]],++d,++g;g<=b;)E+=f[g],S+=1,m=T(m,p=e.s3_ll[d]*r[g]*y[f[g]],g-s),++d,++g;if(m*=v=.5*y[E=(1+2*E)/(2*S)],e.blocktype_old[1&n]==h.SHORT_TYPE){var A=2*e.nb_1[n][s];i[s]=A>0?Math.min(m,A):Math.min(m,r[s]*_)}else{var w=16*e.nb_2[n][s],R=2*e.nb_1[n][s];w<=0&&(w=m),R<=0&&(R=m),A=e.blocktype_old[1&n]==h.NORM_TYPE?Math.min(R,w):R,i[s]=Math.min(m,A)}e.nb_2[n][s]=e.nb_1[n][s],e.nb_1[n][s]=m,p=o[s],p*=e.minval_l[s],p*=v,i[s]>p&&(i[s]=p),e.masking_lower>1&&(i[s]*=e.masking_lower),i[s]>r[s]&&(i[s]=r[s]),e.masking_lower<1&&(i[s]*=e.masking_lower),u(i[s]>=0)}for(;s<h.CBANDS;++s)r[s]=0,i[s]=0}function K(e,t,r,i,n,s,a){for(var o,l,c=2*s,h=s>0?Math.pow(10,n):1,f=0;f<a;++f){var d=e[2][f],_=e[3][f],p=t[0][f],m=t[1][f],v=t[2][f],g=t[3][f];if(p<=1.58*m&&m<=1.58*p){var b=r[f]*_,E=r[f]*d;l=Math.max(v,Math.min(g,b)),o=Math.max(g,Math.min(v,E))}else l=v,o=g;if(s>0){var S,y,A=i[f]*h;if(S=Math.min(Math.max(p,A),Math.max(m,A)),(y=(v=Math.max(l,A))+(g=Math.max(o,A)))>0&&S*c<y){var w=S*c/y;v*=w,g*=w,u(y>0)}l=Math.min(v,l),o=Math.min(g,o)}l>d&&(l=d),o>_&&(o=_),t[2][f]=l,t[3][f]=o}}function z(e,t){var r;return(r=e>=0?27*-e:e*t)<=-72?0:Math.exp(r*m)}function Z(e){var t,r,i=0;for(i=0;z(i,e)>1e-20;i-=1);for(n=i,s=0;Math.abs(s-n)>1e-12;)z(i=(s+n)/2,e)>0?s=i:n=i;t=n;var n,s;i=0;for(i=0;z(i,e)>1e-20;i+=1);for(n=0,s=i;Math.abs(s-n)>1e-12;)z(i=(s+n)/2,e)>0?n=i:s=i;r=s;var a,o=0,l=1e3;for(a=0;a<=l;++a){o+=z(i=t+a*(r-t)/l,e)}return(l+1)/(o*(r-t))}function Q(e){var t,r,i,n;return t=e,r=(t*=t>=0?3:1.5)>=.5&&t<=2.5?8*((n=t-.5)*n-2*n):0,(i=15.811389+7.5*(t+=.474)-17.5*Math.sqrt(1+t*t))<=-60?0:(t=Math.exp((r+i)*m),t/=.6609193)}function $(e){return e<0&&(e=0),e*=.001,13*Math.atan(.76*e)+3.5*Math.atan(e*e/56.25)}function J(e,t,r,i,n,s,o,c,f,d,_,p){var m,v=a(h.CBANDS+1),g=c/(p>15?1152:384),b=l(h.HBLKSIZE);c/=f;var E=0,S=0;for(m=0;m<h.CBANDS;m++){var y;for(x=$(c*E),v[m]=c*E,y=E;$(c*y)-x<.34&&y<=f/2;y++);for(e[m]=y-E,S=m+1;E<y;)u(E<h.HBLKSIZE),b[E++]=m;if(E>f/2){E=f/2,++m;break}}u(m<h.CBANDS),v[m]=c*E;for(var A=0;A<p;A++){var w,R,M,B,T;M=d[A],B=d[A+1],(w=0|Math.floor(.5+_*(M-.5)))<0&&(w=0),(R=0|Math.floor(.5+_*(B-.5)))>f/2&&(R=f/2),r[A]=(b[w]+b[R])/2,t[A]=b[R];var I=g*B;o[A]=(I-v[t[A]])/(v[t[A]+1]-v[t[A]]),o[A]<0?o[A]=0:o[A]>1&&(o[A]=1),T=$(c*d[A]*_),T=Math.min(T,15.5)/15.5,s[A]=Math.pow(10,1.25*(1-Math.cos(Math.PI*T))-2.5)}E=0;for(var P=0;P<S;P++){var x,k,N=e[P];x=$(c*E),k=$(c*(E+N-1)),i[P]=.5*(x+k),x=$(c*(E-.5)),k=$(c*(E+N-.5)),n[P]=k-x,E+=N}return S}function ee(e,t,r,i,n,s){var l,u=o([h.CBANDS,h.CBANDS]),c=0;if(s)for(var f=0;f<t;f++)for(l=0;l<t;l++){var d=Q(r[f]-r[l])*i[l];u[f][l]=d*n[f]}else for(l=0;l<t;l++){var _=15+Math.min(21/r[l],12),p=Z(_);for(f=0;f<t;f++){d=p*z(r[f]-r[l],_)*i[l];u[f][l]=d*n[f]}}for(f=0;f<t;f++){for(l=0;l<t&&!(u[f][l]>0);l++);for(e[f][0]=l,l=t-1;l>0&&!(u[f][l]>0);l--);e[f][1]=l,c+=e[f][1]-e[f][0]+1}var m=a(c),v=0;for(f=0;f<t;f++)for(l=e[f][0];l<=e[f][1];l++)m[v++]=u[f][l];return m}function te(e){var t=$(e);return t=Math.min(t,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*t))-2.5)}function re(e,t){return e<-.3&&(e=3410),e/=1e3,e=Math.max(.1,e),3.64*Math.pow(e,-.8)-6.8*Math.exp(-.6*Math.pow(e-3.4,2))+6*Math.exp(-.15*Math.pow(e-8.7,2))+.001*(.6+.04*t)*Math.pow(e,4)}this.L3psycho_anal_vbr=function(e,t,r,n,s,c,f,d,_,m){var v=e.internal_flags,g=a(h.HBLKSIZE),b=o([3,h.HBLKSIZE_s]),E=o([2,h.BLKSIZE]),S=o([2,3,h.BLKSIZE_s]),y=o([4,h.CBANDS]),A=o([4,h.CBANDS]),w=o([4,3]),R=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],M=l(2),B=e.mode==MPEGMode.JOINT_STEREO?4:v.channels_out;!function(e,t,r,i,n,s,l,c,h,f){for(var d=o([2,576]),_=e.internal_flags,m=_.channels_out,v=e.mode==MPEGMode.JOINT_STEREO?4:m,g=0;g<m;g++){firbuf=t[g];var b=r+576-350-p+192;u(10==j.length);for(var E=0;E<576;E++){var S,y;S=firbuf[b+E+10],y=0;for(var A=0;A<9;A+=2)S+=j[A]*(firbuf[b+E+A]+firbuf[b+E+p-A]),y+=j[A+1]*(firbuf[b+E+A+1]+firbuf[b+E+p-A-1]);d[g][E]=S+y}n[i][g].en.assign(_.en[g]),n[i][g].thm.assign(_.thm[g]),v>2&&(s[i][g].en.assign(_.en[g+2]),s[i][g].thm.assign(_.thm[g+2]))}for(g=0;g<v;g++){var w=a(12),R=a(12),M=[0,0,0,0],B=d[1&g],T=0,I=3==g?_.nsPsy.attackthre_s:_.nsPsy.attackthre,P=1;if(2==g)for(E=0,A=576;A>0;++E,--A){var x=d[0][E],k=d[1][E];d[0][E]=x+k,d[1][E]=x-k}for(E=0;E<3;E++)R[E]=_.nsPsy.last_en_subshort[g][E+6],u(_.nsPsy.last_en_subshort[g][E+4]>0),w[E]=R[E]/_.nsPsy.last_en_subshort[g][E+4],M[0]+=R[E];for(E=0;E<9;E++){for(var N=T+64,C=1;T<N;T++)C<Math.abs(B[T])&&(C=Math.abs(B[T]));_.nsPsy.last_en_subshort[g][E]=R[E+3]=C,M[1+E/3]+=C,C>R[E+3-2]?(u(R[E+3-2]>0),C/=R[E+3-2]):R[E+3-2]>10*C?(u(C>0),C=R[E+3-2]/(10*C)):C=0,w[E+3]=C}for(E=0;E<3;++E){var O=R[3*E+3]+R[3*E+4]+R[3*E+5],D=1;6*R[3*E+5]<O&&(D*=.5,6*R[3*E+4]<O&&(D*=.5)),c[g][E]=D}if(e.analysis){var F=w[0];for(E=1;E<12;E++)F<w[E]&&(F=w[E]);_.pinfo.ers[i][g]=_.pinfo.ers_save[g],_.pinfo.ers_save[g]=F}for(E=0;E<12;E++)0==h[g][E/3]&&w[E]>I&&(h[g][E/3]=E%3+1);for(E=1;E<4;E++){var L=M[E-1],V=M[E];Math.max(L,V)<4e4&&L<1.7*V&&V<1.7*L&&(1==E&&h[g][0]<=h[g][E]&&(h[g][0]=0),h[g][E]=0)}h[g][0]<=_.nsPsy.lastAttacks[g]&&(h[g][0]=0),3!=_.nsPsy.lastAttacks[g]&&h[g][0]+h[g][1]+h[g][2]+h[g][3]==0||(P=0,0!=h[g][1]&&0!=h[g][0]&&(h[g][1]=0),0!=h[g][2]&&0!=h[g][1]&&(h[g][2]=0),0!=h[g][3]&&0!=h[g][2]&&(h[g][3]=0)),g<2?f[g]=P:0==P&&(f[0]=f[1]=0),l[g]=_.tot_ener[g]}}(e,t,r,n,s,c,_,w,R,M),function(e,t){var r=e.internal_flags;e.short_blocks!=i.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var n=0;n<r.channels_out;n++)e.short_blocks==i.short_block_dispensed&&(t[n]=1),e.short_blocks==i.short_block_forced&&(t[n]=0)}(e,M);for(var T=0;T<B;T++){G(e,t,r,T,n,g,E,N=1&T),H(e,n,T,g),0!=M[N]?X(v,g,y[T],A[T],T):W(v,T)}M[0]+M[1]==2&&e.mode==MPEGMode.JOINT_STEREO&&K(y,A,v.mld_cb_l,v.ATH.cb_l,e.ATHlower*v.ATH.adjust,e.msfix,v.npart_l);for(T=0;T<B;T++){0!=M[N=1&T]&&P(v,y[T],A[T],T)}for(var x=0;x<3;x++){for(T=0;T<B;++T){0!=M[N=1&T]?q(v,T,x):(U(e,t,r,T,x,b,S,N),Y(e,b,y[T],A[T],T,x))}M[0]+M[1]==0&&e.mode==MPEGMode.JOINT_STEREO&&K(y,A,v.mld_cb_s,v.ATH.cb_s,e.ATHlower*v.ATH.adjust,e.msfix,v.npart_s);for(T=0;T<B;++T){0==M[N=1&T]&&I(v,y[T],A[T],T,x)}}for(T=0;T<B;T++){var N;if(0==M[N=1&T])for(var O=0;O<h.SBMAX_s;O++){var F=a(3);for(x=0;x<3;x++){var L=v.thm[T].s[O][x];if(L*=.8,R[T][x]>=2||1==R[T][x+1]){var V=0!=x?x-1:2,z=k(v.thm[T].s[O][V],L,.36);L=Math.min(L,z)}else if(1==R[T][x]){V=0!=x?x-1:2,z=k(v.thm[T].s[O][V],L,.18);L=Math.min(L,z)}else if(0!=x&&3==R[T][x-1]||0==x&&3==v.nsPsy.lastAttacks[T]){V=2!=x?x+1:0,z=k(v.thm[T].s[O][V],L,.18);L=Math.min(L,z)}L*=w[T][x],F[x]=L}for(x=0;x<3;x++)v.thm[T].s[O][x]=F[x]}}for(T=0;T<B;T++)v.nsPsy.lastAttacks[T]=R[T][2];!function(e,t,r){for(var i=e.internal_flags,n=0;n<i.channels_out;n++){var s=h.NORM_TYPE;0!=t[n]?(u(i.blocktype_old[n]!=h.START_TYPE),i.blocktype_old[n]==h.SHORT_TYPE&&(s=h.STOP_TYPE)):(s=h.SHORT_TYPE,i.blocktype_old[n]==h.NORM_TYPE&&(i.blocktype_old[n]=h.START_TYPE),i.blocktype_old[n]==h.STOP_TYPE&&(i.blocktype_old[n]=h.SHORT_TYPE)),r[n]=i.blocktype_old[n],i.blocktype_old[n]=s}}(e,M,m);for(T=0;T<B;T++){var Z,Q,$,J;T>1?(Z=d,Q=-2,$=h.NORM_TYPE,m[0]!=h.SHORT_TYPE&&m[1]!=h.SHORT_TYPE||($=h.SHORT_TYPE),J=c[n][T-2]):(Z=f,Q=0,$=m[T],J=s[n][T]),$==h.SHORT_TYPE?Z[Q+T]=C(J,v.masking_lower):Z[Q+T]=D(J,v.masking_lower),e.analysis&&(v.pinfo.pe[n][T]=Z[Q+T])}return 0},this.psymodel_init=function(i){var n,s=i.internal_flags,o=!0,l=13,c=24,d=0,_=0,p=-8.25,m=-4.5,v=a(h.CBANDS),g=a(h.CBANDS),y=a(h.CBANDS),A=i.out_samplerate;switch(i.experimentalZ){default:case 0:o=!0;break;case 1:o=i.VBR!=t.vbr_mtrh&&i.VBR!=t.vbr_mt;break;case 2:o=!1;break;case 3:l=8,d=-1.75,_=-.0125,p=-8.25,m=-2.25}for(s.ms_ener_ratio_old=.25,s.blocktype_old[0]=s.blocktype_old[1]=h.NORM_TYPE,n=0;n<4;++n){for(var w=0;w<h.CBANDS;++w)s.nb_1[n][w]=1e20,s.nb_2[n][w]=1e20,s.nb_s1[n][w]=s.nb_s2[n][w]=1;for(var R=0;R<h.SBMAX_l;R++)s.en[n].l[R]=1e20,s.thm[n].l[R]=1e20;for(w=0;w<3;++w){for(R=0;R<h.SBMAX_s;R++)s.en[n].s[R][w]=1e20,s.thm[n].s[R][w]=1e20;s.nsPsy.lastAttacks[n]=0}for(w=0;w<9;w++)s.nsPsy.last_en_subshort[n][w]=10}for(s.loudness_sq_save[0]=s.loudness_sq_save[1]=0,s.npart_l=J(s.numlines_l,s.bo_l,s.bm_l,v,g,s.mld_l,s.PSY.bo_l_weight,A,h.BLKSIZE,s.scalefac_band.l,h.BLKSIZE/1152,h.SBMAX_l),u(s.npart_l<h.CBANDS),n=0;n<s.npart_l;n++){var M=d;v[n]>=l&&(M=_*(v[n]-l)/(c-l)+d*(c-v[n])/(c-l)),y[n]=Math.pow(10,M/10),s.numlines_l[n]>0?s.rnumlines_l[n]=1/s.numlines_l[n]:s.rnumlines_l[n]=0}s.s3_ll=ee(s.s3ind,s.npart_l,v,g,y,o);var B;w=0;for(n=0;n<s.npart_l;n++){P=r.MAX_VALUE;for(var T=0;T<s.numlines_l[n];T++,w++){var I=A*w/(1e3*h.BLKSIZE);x=this.ATHformula(1e3*I,i)-20,x=Math.pow(10,.1*x),P>(x*=s.numlines_l[n])&&(P=x)}s.ATH.cb_l[n]=P,(P=20*v[n]/10-20)>6&&(P=100),P<-15&&(P=-15),P-=8,s.minval_l[n]=Math.pow(10,P/10)*s.numlines_l[n]}for(s.npart_s=J(s.numlines_s,s.bo_s,s.bm_s,v,g,s.mld_s,s.PSY.bo_s_weight,A,h.BLKSIZE_s,s.scalefac_band.s,h.BLKSIZE_s/384,h.SBMAX_s),u(s.npart_s<h.CBANDS),w=0,n=0;n<s.npart_s;n++){var P;M=p;v[n]>=l&&(M=m*(v[n]-l)/(c-l)+p*(c-v[n])/(c-l)),y[n]=Math.pow(10,M/10),P=r.MAX_VALUE;for(T=0;T<s.numlines_s[n];T++,w++){var x;I=A*w/(1e3*h.BLKSIZE_s);x=this.ATHformula(1e3*I,i)-20,x=Math.pow(10,.1*x),P>(x*=s.numlines_s[n])&&(P=x)}s.ATH.cb_s[n]=P,P=7*v[n]/12-7,v[n]>12&&(P*=1+3.1*Math.log(1+P)),v[n]<12&&(P*=1+2.3*Math.log(1-P)),P<-15&&(P=-15),P-=8,s.minval_s[n]=Math.pow(10,P/10)*s.numlines_s[n]}s.s3_ss=ee(s.s3ind_s,s.npart_s,v,g,y,o),b=Math.pow(10,9/16),E=Math.pow(10,1.5),S=Math.pow(10,1.5),e.init_fft(s),s.decay=Math.exp(-1*f/(.01*A/192)),B=3.5,2&i.exp_nspsytune&&(B=1),Math.abs(i.msfix)>0&&(B=i.msfix),i.msfix=B;for(var k=0;k<s.npart_l;k++)s.s3ind[k][1]>s.npart_l-1&&(s.s3ind[k][1]=s.npart_l-1);var N=576*s.mode_gr/A;if(s.ATH.decay=Math.pow(10,-1.2*N),s.ATH.adjust=.01,s.ATH.adjustLimit=1,u(s.bo_l[h.SBMAX_l-1]<=s.npart_l),u(s.bo_s[h.SBMAX_s-1]<=s.npart_s),-1!=i.ATHtype){var C=i.out_samplerate/h.BLKSIZE,O=0;for(I=0,n=0;n<h.BLKSIZE/2;++n)I+=C,s.ATH.eql_w[n]=1/Math.pow(10,this.ATHformula(I,i)/10),O+=s.ATH.eql_w[n];for(O=1/O,n=h.BLKSIZE/2;--n>=0;)s.ATH.eql_w[n]*=O}for(k=w=0;k<s.npart_s;++k)for(n=0;n<s.numlines_s[k];++n)++w;u(129==w);for(k=w=0;k<s.npart_l;++k)for(n=0;n<s.numlines_l[k];++n)++w;for(u(513==w),w=0,n=0;n<s.npart_l;n++){I=A*(w+s.numlines_l[n]/2)/(1*h.BLKSIZE);s.mld_cb_l[n]=te(I),w+=s.numlines_l[n]}for(;n<h.CBANDS;++n)s.mld_cb_l[n]=1;for(w=0,n=0;n<s.npart_s;n++){I=A*(w+s.numlines_s[n]/2)/(1*h.BLKSIZE_s);s.mld_cb_s[n]=te(I),w+=s.numlines_s[n]}for(;n<h.CBANDS;++n)s.mld_cb_s[n]=1;return 0},this.ATHformula=function(e,t){var r;switch(t.ATHtype){case 0:r=re(e,9);break;case 1:r=re(e,-1);break;case 2:default:r=re(e,0);break;case 3:r=re(e,1)+6;break;case 4:r=re(e,t.ATHcurve)}return r}},pi}function Rn(){if(gi)return vi;function e(e){var t=e;this.ordinal=function(){return t}}return gi=1,e.STEREO=new e(0),e.JOINT_STEREO=new e(1),e.DUAL_CHANNEL=new e(2),e.MONO=new e(3),e.NOT_SET=new e(4),vi=e}function Mn(){if(yi)return Si;yi=1;var e=An(),t={};return t.SFBMAX=3*e.SBMAX_s,Si=t}function Bn(){if(wi)return Ai;wi=1;var e=Sn();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double;var t=e.new_float;e.new_float_n;var r=e.new_int;e.new_int_n,e.assert;var i=Mn();return Ai=function(){this.xr=t(576),this.l3_enc=r(576),this.scalefac=r(i.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=r(3),this.subblock_gain=r(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=r(i.SFBMAX),this.window=r(i.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=r(4),this.max_nonzero_coeff=0;var e=this;function n(e){return new Int32Array(e)}this.assign=function(t){var r;e.xr=(r=t.xr,new Float32Array(r)),e.l3_enc=n(t.l3_enc),e.scalefac=n(t.scalefac),e.xrpow_max=t.xrpow_max,e.part2_3_length=t.part2_3_length,e.big_values=t.big_values,e.count1=t.count1,e.global_gain=t.global_gain,e.scalefac_compress=t.scalefac_compress,e.block_type=t.block_type,e.mixed_block_flag=t.mixed_block_flag,e.table_select=n(t.table_select),e.subblock_gain=n(t.subblock_gain),e.region0_count=t.region0_count,e.region1_count=t.region1_count,e.preflag=t.preflag,e.scalefac_scale=t.scalefac_scale,e.count1table_select=t.count1table_select,e.part2_length=t.part2_length,e.sfb_lmax=t.sfb_lmax,e.sfb_smin=t.sfb_smin,e.psy_lmax=t.psy_lmax,e.sfbmax=t.sfbmax,e.psymax=t.psymax,e.sfbdivide=t.sfbdivide,e.width=n(t.width),e.window=n(t.window),e.count1bits=t.count1bits,e.sfb_partition_table=t.sfb_partition_table.slice(0),e.slen=n(t.slen),e.max_nonzero_coeff=t.max_nonzero_coeff}}}function Tn(){if(Ti)return Bi;Ti=1;var e=Sn(),t=e.System;e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double,e.new_float,e.new_float_n;var r=e.new_int;e.new_int_n,e.assert;var i=An();return Bi=function(e,n,s,a){this.l=r(1+i.SBMAX_l),this.s=r(1+i.SBMAX_s),this.psfb21=r(1+i.PSFB21),this.psfb12=r(1+i.PSFB12);var o=this.l,l=this.s;4==arguments.length&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],t.arraycopy(this.arrL,0,o,0,Math.min(this.arrL.length,this.l.length)),t.arraycopy(this.arrS,0,l,0,Math.min(this.arrS.length,this.s.length)),t.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),t.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))},Bi}function In(){if(Ci)return Ni;Ci=1;var e=Sn();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n;var t=e.new_byte,r=e.new_double,i=e.new_float,n=e.new_float_n,s=e.new_int,a=e.new_int_n;e.assert;var o=function(){if(Mi)return Ri;Mi=1;var e=Sn();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double,e.new_float,e.new_float_n;var t=e.new_int;e.new_int_n,e.assert;var r=Bn();return Ri=function(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[t(4),t(4)];for(var e=0;e<2;e++)for(var i=0;i<2;i++)this.tt[e][i]=new r}}(),l=Tn(),u=function(){if(Pi)return Ii;Pi=1;var e=Sn();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double;var t=e.new_float,r=e.new_float_n,i=e.new_int;e.new_int_n,e.assert;var n=An();return Ii=function(){this.last_en_subshort=r([4,9]),this.lastAttacks=i(4),this.pefirbuf=t(19),this.longfact=t(n.SBMAX_l),this.shortfact=t(n.SBMAX_s),this.attackthre=0,this.attackthre_s=0}}(),c=ki?xi:(ki=1,xi=function(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}),h=yn(),f=An(),d=Mn();function _(){function e(){this.write_timing=0,this.ptr=0,this.buf=t(40)}this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=n([2,_.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new o,this.ms_ratio=i(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=s(2),this.CurrentStep=s(2),this.masking_lower=0,this.bv_scf=s(576),this.pseudohalf=s(d.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*_.BPC+1),this.itime=r(2),this.sideinfo_len=0,this.sb_sample=n([2,2,18,f.SBLIMIT]),this.amp_filter=i(32),this.header=new Array(_.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new l,this.minval_l=i(f.CBANDS),this.minval_s=i(f.CBANDS),this.nb_1=n([4,f.CBANDS]),this.nb_2=n([4,f.CBANDS]),this.nb_s1=n([4,f.CBANDS]),this.nb_s2=n([4,f.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=i(4),this.loudness_sq=n([2,2]),this.loudness_sq_save=i(2),this.mld_l=i(f.SBMAX_l),this.mld_s=i(f.SBMAX_s),this.bm_l=s(f.SBMAX_l),this.bo_l=s(f.SBMAX_l),this.bm_s=s(f.SBMAX_s),this.bo_s=s(f.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=a([f.CBANDS,2]),this.s3ind_s=a([f.CBANDS,2]),this.numlines_s=s(f.CBANDS),this.numlines_l=s(f.CBANDS),this.rnumlines_l=i(f.CBANDS),this.mld_cb_l=i(f.CBANDS),this.mld_cb_s=i(f.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=i(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=s(2),this.nsPsy=new u,this.VBR_seek_table=new c,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=a([16,5]),this.bitrate_blockType_Hist=a([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var p=0;p<this.en.length;p++)this.en[p]=new h;for(p=0;p<this.thm.length;p++)this.thm[p]=new h;for(p=0;p<this.header.length;p++)this.header[p]=new e}return _.MFSIZE=3456+f.ENCDELAY-f.MDCTDELAY,_.MAX_HEADER_BUF=256,_.MAX_BITS_PER_CHANNEL=4095,_.MAX_BITS_PER_GRANULE=7680,_.BPC=320,Ni=_}function Pn(){if(Li)return Fi;Li=1;var e=Sn(),t=e.System;e.VbrMode,e.Float,e.ShortBlock,e.Util;var r=e.Arrays;function i(){i.YULE_ORDER;i.MAX_SAMP_FREQ;var e=i.RMS_WINDOW_TIME_NUMERATOR,n=i.RMS_WINDOW_TIME_DENOMINATOR;i.MAX_SAMPLES_PER_WINDOW;var s=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],a=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function o(e,t,r,i,n,s){for(;0!=n--;)r[i]=1e-10+e[t+0]*s[0]-r[i-1]*s[1]+e[t-1]*s[2]-r[i-2]*s[3]+e[t-2]*s[4]-r[i-3]*s[5]+e[t-3]*s[6]-r[i-4]*s[7]+e[t-4]*s[8]-r[i-5]*s[9]+e[t-5]*s[10]-r[i-6]*s[11]+e[t-6]*s[12]-r[i-7]*s[13]+e[t-7]*s[14]-r[i-8]*s[15]+e[t-8]*s[16]-r[i-9]*s[17]+e[t-9]*s[18]-r[i-10]*s[19]+e[t-10]*s[20],++i,++t}function l(e,t,r,i,n,s){for(;0!=n--;)r[i]=e[t+0]*s[0]-r[i-1]*s[1]+e[t-1]*s[2]-r[i-2]*s[3]+e[t-2]*s[4],++i,++t}function u(e){return e*e}this.InitGainAnalysis=function(t,i){return function(t,i){for(var s=0;s<MAX_ORDER;s++)t.linprebuf[s]=t.lstepbuf[s]=t.loutbuf[s]=t.rinprebuf[s]=t.rstepbuf[s]=t.routbuf[s]=0;switch(0|i){case 48e3:t.reqindex=0;break;case 44100:t.reqindex=1;break;case 32e3:t.reqindex=2;break;case 24e3:t.reqindex=3;break;case 22050:t.reqindex=4;break;case 16e3:t.reqindex=5;break;case 12e3:t.reqindex=6;break;case 11025:t.reqindex=7;break;case 8e3:t.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return t.sampleWindow=0|(i*e+n-1)/n,t.lsum=0,t.rsum=0,t.totsamp=0,r.ill(t.A,0),INIT_GAIN_ANALYSIS_OK}(t,i)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(t.linpre=MAX_ORDER,t.rinpre=MAX_ORDER,t.lstep=MAX_ORDER,t.rstep=MAX_ORDER,t.lout=MAX_ORDER,t.rout=MAX_ORDER,r.fill(t.B,0),INIT_GAIN_ANALYSIS_OK)},this.AnalyzeSamples=function(e,r,n,c,h,f,d){var _,p,m,v,g,b,E;if(0==f)return GAIN_ANALYSIS_OK;switch(E=0,g=f,d){case 1:c=r,h=n;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(f<MAX_ORDER?(t.arraycopy(r,n,e.linprebuf,MAX_ORDER,f),t.arraycopy(c,h,e.rinprebuf,MAX_ORDER,f)):(t.arraycopy(r,n,e.linprebuf,MAX_ORDER,MAX_ORDER),t.arraycopy(c,h,e.rinprebuf,MAX_ORDER,MAX_ORDER));g>0;){b=g>e.sampleWindow-e.totsamp?e.sampleWindow-e.totsamp:g,E<MAX_ORDER?(_=e.linpre+E,p=e.linprebuf,m=e.rinpre+E,v=e.rinprebuf,b>MAX_ORDER-E&&(b=MAX_ORDER-E)):(_=n+E,p=r,m=h+E,v=c),o(p,_,e.lstepbuf,e.lstep+e.totsamp,b,s[e.reqindex]),o(v,m,e.rstepbuf,e.rstep+e.totsamp,b,s[e.reqindex]),l(e.lstepbuf,e.lstep+e.totsamp,e.loutbuf,e.lout+e.totsamp,b,a[e.reqindex]),l(e.rstepbuf,e.rstep+e.totsamp,e.routbuf,e.rout+e.totsamp,b,a[e.reqindex]),_=e.lout+e.totsamp,p=e.loutbuf,m=e.rout+e.totsamp,v=e.routbuf;for(var S=b%8;0!=S--;)e.lsum+=u(p[_++]),e.rsum+=u(v[m++]);for(S=b/8;0!=S--;)e.lsum+=u(p[_+0])+u(p[_+1])+u(p[_+2])+u(p[_+3])+u(p[_+4])+u(p[_+5])+u(p[_+6])+u(p[_+7]),_+=8,e.rsum+=u(v[m+0])+u(v[m+1])+u(v[m+2])+u(v[m+3])+u(v[m+4])+u(v[m+5])+u(v[m+6])+u(v[m+7]),m+=8;if(g-=b,E+=b,e.totsamp+=b,e.totsamp==e.sampleWindow){var y=10*i.STEPS_per_dB*Math.log10((e.lsum+e.rsum)/e.totsamp*.5+1e-37),A=y<=0?0:0|y;A>=e.A.length&&(A=e.A.length-1),e.A[A]++,e.lsum=e.rsum=0,t.arraycopy(e.loutbuf,e.totsamp,e.loutbuf,0,MAX_ORDER),t.arraycopy(e.routbuf,e.totsamp,e.routbuf,0,MAX_ORDER),t.arraycopy(e.lstepbuf,e.totsamp,e.lstepbuf,0,MAX_ORDER),t.arraycopy(e.rstepbuf,e.totsamp,e.rstepbuf,0,MAX_ORDER),e.totsamp=0}if(e.totsamp>e.sampleWindow)return GAIN_ANALYSIS_ERROR}return f<MAX_ORDER?(t.arraycopy(e.linprebuf,f,e.linprebuf,0,MAX_ORDER-f),t.arraycopy(e.rinprebuf,f,e.rinprebuf,0,MAX_ORDER-f),t.arraycopy(r,n,e.linprebuf,MAX_ORDER-f,f),t.arraycopy(c,h,e.rinprebuf,MAX_ORDER-f,f)):(t.arraycopy(r,n+f-MAX_ORDER,e.linprebuf,0,MAX_ORDER),t.arraycopy(c,h+f-MAX_ORDER,e.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK},this.GetTitleGain=function(e){for(var t=function(e,t){var r,n=0;for(r=0;r<t;r++)n+=e[r];if(0==n)return GAIN_NOT_ENOUGH_SAMPLES;var s=0|Math.ceil(n*(1-.95));for(r=t;r-- >0&&!((s-=e[r])<=0););return 64.82-r/i.STEPS_per_dB}(e.A,e.A.length),r=0;r<e.A.length;r++)e.B[r]+=e.A[r],e.A[r]=0;for(r=0;r<MAX_ORDER;r++)e.linprebuf[r]=e.lstepbuf[r]=e.loutbuf[r]=e.rinprebuf[r]=e.rstepbuf[r]=e.routbuf[r]=0;return e.totsamp=0,e.lsum=e.rsum=0,t}}return e.new_array_n,e.new_byte,e.new_double,e.new_float,e.new_float_n,e.new_int,e.new_int_n,e.assert,i.STEPS_per_dB=100,i.MAX_dB=120,i.GAIN_NOT_ENOUGH_SAMPLES=-24601,i.GAIN_ANALYSIS_ERROR=0,i.GAIN_ANALYSIS_OK=1,i.INIT_GAIN_ANALYSIS_ERROR=0,i.INIT_GAIN_ANALYSIS_OK=1,i.YULE_ORDER=10,i.MAX_ORDER=i.YULE_ORDER,i.MAX_SAMP_FREQ=48e3,i.RMS_WINDOW_TIME_NUMERATOR=1,i.RMS_WINDOW_TIME_DENOMINATOR=20,i.MAX_SAMPLES_PER_WINDOW=i.MAX_SAMP_FREQ*i.RMS_WINDOW_TIME_NUMERATOR/i.RMS_WINDOW_TIME_DENOMINATOR+1,Fi=i}function xn(){if(Hi)return Ui;return Hi=1,Ui=function(e){this.bits=e}}function kn(){if(Yi)return Wi;function e(e,t,r,i){this.xlen=e,this.linmax=t,this.table=r,this.hlen=i}Yi=1;var t={t1HB:[1,1,1,0],t2HB:[1,2,1,3,1,1,3,2,0],t3HB:[3,2,1,1,1,1,3,2,0],t5HB:[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],t6HB:[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],t7HB:[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],t8HB:[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],t9HB:[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],t10HB:[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],t11HB:[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],t12HB:[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],t13HB:[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],t15HB:[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],t16HB:[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],t24HB:[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],t32HB:[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16],t33HB:[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0],t1l:[1,4,3,5],t2l:[1,4,7,4,5,7,6,7,8],t3l:[2,3,7,4,4,7,6,7,8],t5l:[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],t6l:[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],t7l:[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],t8l:[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],t9l:[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],t10l:[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],t11l:[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],t12l:[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],t13l:[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],t15l:[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],t16_5l:[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],t16l:[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],t24l:[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],t32l:[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10],t33l:[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8]};return t.ht=[new e(0,0,null,null),new e(2,0,t.t1HB,t.t1l),new e(3,0,t.t2HB,t.t2l),new e(3,0,t.t3HB,t.t3l),new e(0,0,null,null),new e(4,0,t.t5HB,t.t5l),new e(4,0,t.t6HB,t.t6l),new e(6,0,t.t7HB,t.t7l),new e(6,0,t.t8HB,t.t8l),new e(6,0,t.t9HB,t.t9l),new e(8,0,t.t10HB,t.t10l),new e(8,0,t.t11HB,t.t11l),new e(8,0,t.t12HB,t.t12l),new e(16,0,t.t13HB,t.t13l),new e(0,0,null,t.t16_5l),new e(16,0,t.t15HB,t.t15l),new e(1,1,t.t16HB,t.t16l),new e(2,3,t.t16HB,t.t16l),new e(3,7,t.t16HB,t.t16l),new e(4,15,t.t16HB,t.t16l),new e(6,63,t.t16HB,t.t16l),new e(8,255,t.t16HB,t.t16l),new e(10,1023,t.t16HB,t.t16l),new e(13,8191,t.t16HB,t.t16l),new e(4,15,t.t24HB,t.t24l),new e(5,31,t.t24HB,t.t24l),new e(6,63,t.t24HB,t.t24l),new e(7,127,t.t24HB,t.t24l),new e(8,255,t.t24HB,t.t24l),new e(9,511,t.t24HB,t.t24l),new e(11,2047,t.t24HB,t.t24l),new e(13,8191,t.t24HB,t.t24l),new e(0,0,t.t32HB,t.t32l),new e(0,0,t.t33HB,t.t33l)],t.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],t.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296],t.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],t.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]],t.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]],t.scfsi_band=[0,6,11,16,21],Wi=t}function Nn(){if(Ki)return Xi;Ki=1;var e=Tn(),t=Sn();t.System;var r=t.VbrMode,i=t.Float;t.ShortBlock;var n=t.Util;t.Arrays,t.new_array_n,t.new_byte,t.new_double;var s=t.new_float;t.new_float_n;var a=t.new_int;t.new_int_n;var o=t.assert,l=An(),u=xn(),c=In();function h(){var t=null,f=null,d=null;function _(e){return o(0<=e+h.Q_MAX2&&e<h.Q_MAX),E[e+h.Q_MAX2]}this.setModules=function(e,r,i){t=e,f=r,d=i},this.IPOW20=function(e){return o(0<=e&&e<h.Q_MAX),S[e]};var p=2220446049250313e-31,m=h.IXMAX_VAL+2,v=h.Q_MAX,g=h.Q_MAX2;h.LARGE_BITS;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var b=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=b,this.sfBandIndex=[new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0,8,16,24,36,52,72,96,124,160,162,164,166,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var E=s(v+g+1),S=s(v),y=s(m),A=s(m);function w(e,t){var r=d.ATHformula(t,e);return r-=100,r=Math.pow(10,r/10+e.ATHlower)}function R(e){this.s=e}this.adj43=A,this.iteration_init=function(e){var r,n=e.internal_flags,s=n.l3_side;if(0==n.iteration_init_init){for(n.iteration_init_init=1,s.main_data_begin=0,function(e){for(var t=e.internal_flags.ATH.l,r=e.internal_flags.ATH.psfb21,n=e.internal_flags.ATH.s,s=e.internal_flags.ATH.psfb12,a=e.internal_flags,o=e.out_samplerate,u=0;u<l.SBMAX_l;u++){var c=a.scalefac_band.l[u],h=a.scalefac_band.l[u+1];t[u]=i.MAX_VALUE;for(var f=c;f<h;f++){var d=w(e,f*o/1152);t[u]=Math.min(t[u],d)}}for(u=0;u<l.PSFB21;u++)for(c=a.scalefac_band.psfb21[u],h=a.scalefac_band.psfb21[u+1],r[u]=i.MAX_VALUE,f=c;f<h;f++)d=w(e,f*o/1152),r[u]=Math.min(r[u],d);for(u=0;u<l.SBMAX_s;u++){for(c=a.scalefac_band.s[u],h=a.scalefac_band.s[u+1],n[u]=i.MAX_VALUE,f=c;f<h;f++)d=w(e,f*o/384),n[u]=Math.min(n[u],d);n[u]*=a.scalefac_band.s[u+1]-a.scalefac_band.s[u]}for(u=0;u<l.PSFB12;u++){for(c=a.scalefac_band.psfb12[u],h=a.scalefac_band.psfb12[u+1],s[u]=i.MAX_VALUE,f=c;f<h;f++)d=w(e,f*o/384),s[u]=Math.min(s[u],d);s[u]*=a.scalefac_band.s[13]-a.scalefac_band.s[12]}if(e.noATH){for(u=0;u<l.SBMAX_l;u++)t[u]=1e-20;for(u=0;u<l.PSFB21;u++)r[u]=1e-20;for(u=0;u<l.SBMAX_s;u++)n[u]=1e-20;for(u=0;u<l.PSFB12;u++)s[u]=1e-20}a.ATH.floor=10*Math.log10(w(e,-1))}(e),y[0]=0,r=1;r<m;r++)y[r]=Math.pow(r,4/3);for(r=0;r<m-1;r++)A[r]=r+1-Math.pow(.5*(y[r]+y[r+1]),.75);for(A[r]=.5,r=0;r<v;r++)S[r]=Math.pow(2,-.1875*(r-210));for(r=0;r<=v+g;r++)E[r]=Math.pow(2,.25*(r-210-g));var a,o,u,c;for(t.huffman_init(n),(r=e.exp_nspsytune>>2&63)>=32&&(r-=64),a=Math.pow(10,r/4/10),(r=e.exp_nspsytune>>8&63)>=32&&(r-=64),o=Math.pow(10,r/4/10),(r=e.exp_nspsytune>>14&63)>=32&&(r-=64),u=Math.pow(10,r/4/10),(r=e.exp_nspsytune>>20&63)>=32&&(r-=64),c=u*Math.pow(10,r/4/10),r=0;r<l.SBMAX_l;r++){h=r<=6?a:r<=13?o:r<=20?u:c,n.nsPsy.longfact[r]=h}for(r=0;r<l.SBMAX_s;r++){var h;h=r<=5?a:r<=10?o:r<=11?u:c,n.nsPsy.shortfact[r]=h}}},this.on_pe=function(e,t,r,i,n,s){var l,h,d=e.internal_flags,_=0,p=a(2),m=new u(_),v=f.ResvMaxBits(e,i,m,s),g=(_=m.bits)+v;for(g>c.MAX_BITS_PER_GRANULE&&(g=c.MAX_BITS_PER_GRANULE),l=0,h=0;h<d.channels_out;++h)r[h]=Math.min(c.MAX_BITS_PER_CHANNEL,_/d.channels_out),p[h]=0|r[h]*t[n][h]/700-r[h],p[h]>3*i/4&&(p[h]=3*i/4),p[h]<0&&(p[h]=0),p[h]+r[h]>c.MAX_BITS_PER_CHANNEL&&(p[h]=Math.max(0,c.MAX_BITS_PER_CHANNEL-r[h])),l+=p[h];if(l>v)for(h=0;h<d.channels_out;++h)p[h]=v*p[h]/l;for(h=0;h<d.channels_out;++h)r[h]+=p[h],v-=p[h];for(l=0,h=0;h<d.channels_out;++h)l+=r[h];if(l>c.MAX_BITS_PER_GRANULE){var b=0;for(h=0;h<d.channels_out;++h)r[h]*=c.MAX_BITS_PER_GRANULE,r[h]/=l,b+=r[h];o(b<=c.MAX_BITS_PER_GRANULE)}return g},this.reduce_side=function(e,t,r,i){o(i<=c.MAX_BITS_PER_GRANULE),o(e[0]+e[1]<=c.MAX_BITS_PER_GRANULE);var n=.33*(.5-t)/.5;n<0&&(n=0),n>.5&&(n=.5);var s=0|.5*n*(e[0]+e[1]);s>c.MAX_BITS_PER_CHANNEL-e[0]&&(s=c.MAX_BITS_PER_CHANNEL-e[0]),s<0&&(s=0),e[1]>=125&&(e[1]-s>125?(e[0]<r&&(e[0]+=s),e[1]-=s):(e[0]+=e[1]-125,e[1]=125)),(s=e[0]+e[1])>i&&(e[0]=i*e[0]/s,e[1]=i*e[1]/s),o(e[0]<=c.MAX_BITS_PER_CHANNEL),o(e[1]<=c.MAX_BITS_PER_CHANNEL),o(e[0]+e[1]<=c.MAX_BITS_PER_GRANULE)},this.athAdjust=function(e,t,r){var i=90.30873362,s=n.FAST_LOG10_X(t,10),a=e*e,o=0;return s-=r,a>1e-20&&(o=1+n.FAST_LOG10_X(a,10/i)),o<0&&(o=0),s*=o,s+=r+i-94.82444863,Math.pow(10,.1*s)},this.calc_xmin=function(e,t,i,n){var s,a=0,o=e.internal_flags,u=0,c=0,h=o.ATH,f=i.xr,d=e.VBR==r.vbr_mtrh?1:0,_=o.masking_lower;for(e.VBR!=r.vbr_mtrh&&e.VBR!=r.vbr_mt||(_=1),s=0;s<i.psy_lmax;s++){A=(y=e.VBR==r.vbr_rh||e.VBR==r.vbr_mtrh?athAdjust(h.adjust,h.l[s],h.floor):h.adjust*h.l[s])/(b=i.width[s]),w=p,T=b>>1,B=0;do{B+=I=f[u]*f[u],w+=I<A?I:A,B+=P=f[++u]*f[u],w+=P<A?P:A,u++}while(--T>0);if(B>y&&c++,s==l.SBPSY_l)w<(M=y*o.nsPsy.longfact[s])&&(w=M);if(0!=d&&(y=w),!e.ATHonly)if((R=t.en.l[s])>0)M=B*t.thm.l[s]*_/R,0!=d&&(M*=o.nsPsy.longfact[s]),y<M&&(y=M);n[a++]=0!=d?y:y*o.nsPsy.longfact[s]}var m=575;if(i.block_type!=l.SHORT_TYPE)for(var v=576;0!=v--&&BitStream.EQ(f[v],0);)m=v;i.max_nonzero_coeff=m;for(var g=i.sfb_smin;s<i.psymax;g++,s+=3){var b,E,S;for(S=e.VBR==r.vbr_rh||e.VBR==r.vbr_mtrh?athAdjust(h.adjust,h.s[g],h.floor):h.adjust*h.s[g],b=i.width[s],E=0;E<3;E++){var y,A,w,R,M,B=0,T=b>>1;A=S/b,w=p;do{var I,P;B+=I=f[u]*f[u],w+=I<A?I:A,B+=P=f[++u]*f[u],w+=P<A?P:A,u++}while(--T>0);if(B>S&&c++,g==l.SBPSY_s)w<(M=S*o.nsPsy.shortfact[g])&&(w=M);if(y=0!=d?w:S,!e.ATHonly&&!e.ATHshort)if((R=t.en.s[g][E])>0)M=B*t.thm.s[g][E]*_/R,0!=d&&(M*=o.nsPsy.shortfact[g]),y<M&&(y=M);n[a++]=0!=d?y:y*o.nsPsy.shortfact[g]}e.useTemporal&&(n[a-3]>n[a-3+1]&&(n[a-3+1]+=(n[a-3]-n[a-3+1])*o.decay),n[a-3+1]>n[a-3+2]&&(n[a-3+2]+=(n[a-3+1]-n[a-3+2])*o.decay))}return c},this.calc_noise_core=function(e,t,r,i){var n=0,a=t.s,o=e.l3_enc;if(a>e.count1)for(;0!=r--;){u=e.xr[a],a++,n+=u*u,u=e.xr[a],a++,n+=u*u}else if(a>e.big_values){var l=s(2);for(l[0]=0,l[1]=i;0!=r--;){u=Math.abs(e.xr[a])-l[o[a]],a++,n+=u*u,u=Math.abs(e.xr[a])-l[o[a]],a++,n+=u*u}}else for(;0!=r--;){var u;u=Math.abs(e.xr[a])-y[o[a]]*i,a++,n+=u*u,u=Math.abs(e.xr[a])-y[o[a]]*i,a++,n+=u*u}return t.s=a,n},this.calc_noise=function(e,t,r,i,s){var a,o,l=0,u=0,c=0,h=0,f=0,d=-20,p=0,m=e.scalefac,v=0;for(i.over_SSD=0,a=0;a<e.psymax;a++){var g,E=e.global_gain-(m[v++]+(0!=e.preflag?b[a]:0)<<e.scalefac_scale+1)-8*e.subblock_gain[e.window[a]],S=0;if(null!=s&&s.step[a]==E)S=s.noise[a],p+=e.width[a],r[l++]=S/t[u++],S=s.noise_log[a];else{var y,A=_(E);if(o=e.width[a]>>1,p+e.width[a]>e.max_nonzero_coeff)o=(y=e.max_nonzero_coeff-p+1)>0?y>>1:0;var w=new R(p);S=this.calc_noise_core(e,w,o,A),p=w.s,null!=s&&(s.step[a]=E,s.noise[a]=S),S=r[l++]=S/t[u++],S=n.FAST_LOG10(Math.max(S,1e-20)),null!=s&&(s.noise_log[a]=S)}if(null!=s&&(s.global_gain=e.global_gain),f+=S,S>0)g=Math.max(0|10*S+.5,1),i.over_SSD+=g*g,c++,h+=S;d=Math.max(d,S)}return i.over_count=c,i.tot_noise=f,i.over_noise=h,i.max_noise=d,c},this.set_pinfo=function(e,t,r,i,n){var a,u,c,h,f,d=e.internal_flags,_=0==t.scalefac_scale?.5:1,p=t.scalefac,m=s(L3Side.SFBMAX),v=s(L3Side.SFBMAX),g=new CalcNoiseResult;calc_xmin(e,r,t,m),calc_noise(t,m,v,g,null);var E=0;for(u=t.sfb_lmax,t.block_type!=l.SHORT_TYPE&&0==t.mixed_block_flag&&(u=22),a=0;a<u;a++){var S=d.scalefac_band.l[a],y=(A=d.scalefac_band.l[a+1])-S;for(h=0;E<A;E++)h+=t.xr[E]*t.xr[E];h/=y,f=1e15,d.pinfo.en[i][n][a]=f*h,d.pinfo.xfsf[i][n][a]=f*m[a]*v[a]/y,r.en.l[a]>0&&!e.ATHonly?h/=r.en.l[a]:h=0,d.pinfo.thr[i][n][a]=f*Math.max(h*r.thm.l[a],d.ATH.l[a]),d.pinfo.LAMEsfb[i][n][a]=0,0!=t.preflag&&a>=11&&(d.pinfo.LAMEsfb[i][n][a]=-_*b[a]),a<l.SBPSY_l&&(o(p[a]>=0),d.pinfo.LAMEsfb[i][n][a]-=_*p[a])}if(t.block_type==l.SHORT_TYPE)for(u=a,a=t.sfb_smin;a<l.SBMAX_s;a++){S=d.scalefac_band.s[a],y=(A=d.scalefac_band.s[a+1])-S;for(var A,w=0;w<3;w++){for(h=0,c=S;c<A;c++)h+=t.xr[E]*t.xr[E],E++;h=Math.max(h/y,1e-20),f=1e15,d.pinfo.en_s[i][n][3*a+w]=f*h,d.pinfo.xfsf_s[i][n][3*a+w]=f*m[u]*v[u]/y,r.en.s[a][w]>0?h/=r.en.s[a][w]:h=0,(e.ATHonly||e.ATHshort)&&(h=0),d.pinfo.thr_s[i][n][3*a+w]=f*Math.max(h*r.thm.s[a][w],d.ATH.s[a]),d.pinfo.LAMEsfb_s[i][n][3*a+w]=-2*t.subblock_gain[w],a<l.SBPSY_s&&(d.pinfo.LAMEsfb_s[i][n][3*a+w]-=_*p[u]),u++}}d.pinfo.LAMEqss[i][n]=t.global_gain,d.pinfo.LAMEmainbits[i][n]=t.part2_3_length+t.part2_length,d.pinfo.LAMEsfbits[i][n]=t.part2_length,d.pinfo.over[i][n]=g.over_count,d.pinfo.max_noise[i][n]=10*g.max_noise,d.pinfo.over_noise[i][n]=10*g.over_noise,d.pinfo.tot_noise[i][n]=10*g.tot_noise,d.pinfo.over_SSD[i][n]=g.over_SSD}}return h.Q_MAX=257,h.Q_MAX2=116,h.LARGE_BITS=1e5,h.IXMAX_VAL=8206,Xi=h}function Cn(){if(Zi)return zi;Zi=1;var e=Sn(),t=e.System;e.VbrMode,e.Float,e.ShortBlock,e.Util;var r=e.Arrays;e.new_array_n,e.new_byte,e.new_double,e.new_float,e.new_float_n;var i=e.new_int;e.new_int_n;var n=e.assert,s=An(),a=kn(),o=Bn(),l=Nn();return zi=function e(){var u=null;function c(e){this.bits=0|e}this.qupvt=null,this.setModules=function(e){this.qupvt=e,u=e};var h=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function f(e,t,r,i,s,a){var o=.5946/t;for(n(e>0),e>>=1;0!=e--;)s[a++]=o>r[i++]?0:1,s[a++]=o>r[i++]?0:1}function d(e,t,r,i,s,a){n(e>0);var o=(e>>=1)%2;for(e>>=1;0!=e--;){var l,c,h,f,d,_,p,m;l=r[i++]*t,c=r[i++]*t,d=0|l,h=r[i++]*t,_=0|c,f=r[i++]*t,p=0|h,l+=u.adj43[d],m=0|f,c+=u.adj43[_],s[a++]=0|l,h+=u.adj43[p],s[a++]=0|c,f+=u.adj43[m],s[a++]=0|h,s[a++]=0|f}0!=o&&(d=0|(l=r[i++]*t),_=0|(c=r[i++]*t),l+=u.adj43[d],c+=u.adj43[_],s[a++]=0|l,s[a++]=0|c)}var _=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function p(e,t,r,i){var n=function(e,t,r){var i=0,n=0;do{var s=e[t++],a=e[t++];i<s&&(i=s),n<a&&(n=a)}while(t<r);return i<n&&(i=n),i}(e,t,r);switch(n){case 0:return n;case 1:return function(e,t,r,i){var n=0,s=a.ht[1].hlen;do{var o=2*e[t+0]+e[t+1];t+=2,n+=s[o]}while(t<r);return i.bits+=n,1}(e,t,r,i);case 2:case 3:return function(e,t,r,i,n){var s,o,l=0,u=a.ht[i].xlen;o=2==i?a.table23:a.table56;do{var c=e[t+0]*u+e[t+1];t+=2,l+=o[c]}while(t<r);return s=65535&l,(l>>=16)>s&&(l=s,i++),n.bits+=l,i}(e,t,r,_[n-1],i);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return function(e,t,r,i,n){var s=0,o=0,l=0,u=a.ht[i].xlen,c=a.ht[i].hlen,h=a.ht[i+1].hlen,f=a.ht[i+2].hlen;do{var d=e[t+0]*u+e[t+1];t+=2,s+=c[d],o+=h[d],l+=f[d]}while(t<r);var _=i;return s>o&&(s=o,_++),s>l&&(s=l,_=i+2),n.bits+=s,_}(e,t,r,_[n-1],i);default:if(n>l.IXMAX_VAL)return i.bits=l.LARGE_BITS,-1;var s,o;for(n-=15,s=24;s<32&&!(a.ht[s].linmax>=n);s++);for(o=s-8;o<24&&!(a.ht[o].linmax>=n);o++);return function(e,t,r,i,n,s){var o,l=65536*a.ht[i].xlen+a.ht[n].xlen,u=0;do{var c=e[t++],h=e[t++];0!=c&&(c>14&&(c=15,u+=l),c*=16),0!=h&&(h>14&&(h=15,u+=l),c+=h),u+=a.largetbl[c]}while(t<r);return o=65535&u,(u>>=16)>o&&(u=o,i=n),s.bits+=u,i}(e,t,r,o,s,i)}}function m(e,t,r,i,n,a,o,l){for(var u=t.big_values,h=2;h<s.SBMAX_l+1;h++){var f=e.scalefac_band.l[h];if(f>=u)break;var d=n[h-2]+t.count1bits;if(r.part2_3_length<=d)break;var _=new c(d),m=p(i,f,u,_);d=_.bits,r.part2_3_length<=d||(r.assign(t),r.part2_3_length=d,r.region0_count=a[h-2],r.region1_count=h-2-a[h-2],r.table_select[0]=o[h-2],r.table_select[1]=l[h-2],r.table_select[2]=m)}}this.noquant_count_bits=function(e,t,r){var i=t.l3_enc,o=Math.min(576,t.max_nonzero_coeff+2>>1<<1);for(null!=r&&(r.sfb_count1=0);o>1&&0==(i[o-1]|i[o-2]);o-=2);t.count1=o;for(var l=0,u=0;o>3;o-=4){var h;if((2147483647&(i[o-1]|i[o-2]|i[o-3]|i[o-4]))>1)break;h=2*(2*(2*i[o-4]+i[o-3])+i[o-2])+i[o-1],l+=a.t32l[h],u+=a.t33l[h]}var f=l;if(t.count1table_select=0,l>u&&(f=u,t.count1table_select=1),t.count1bits=f,t.big_values=o,0==o)return f;if(t.block_type==s.SHORT_TYPE)(l=3*e.scalefac_band.s[3])>t.big_values&&(l=t.big_values),u=t.big_values;else if(t.block_type==s.NORM_TYPE){if(n(o<=576),l=t.region0_count=e.bv_scf[o-2],u=t.region1_count=e.bv_scf[o-1],n(l+u+2<s.SBPSY_l),u=e.scalefac_band.l[l+u+2],l=e.scalefac_band.l[l+1],u<o){var d=new c(f);t.table_select[2]=p(i,u,o,d),f=d.bits}}else t.region0_count=7,t.region1_count=s.SBMAX_l-1-7-1,(l=e.scalefac_band.l[8])>(u=o)&&(l=u);if(l=Math.min(l,o),u=Math.min(u,o),n(l>=0),n(u>=0),0<l){d=new c(f);t.table_select[0]=p(i,0,l,d),f=d.bits}if(l<u){d=new c(f);t.table_select[1]=p(i,l,u,d),f=d.bits}if(2==e.use_best_huffman&&(t.part2_3_length=f,best_huffman_divide(e,t),f=t.part2_3_length),null!=r&&t.block_type==s.NORM_TYPE){for(var _=0;e.scalefac_band.l[_]<t.big_values;)_++;r.sfb_count1=_}return f},this.count_bits=function(e,t,i,a){var o=i.l3_enc,c=l.IXMAX_VAL/u.IPOW20(i.global_gain);if(i.xrpow_max>c)return l.LARGE_BITS;if(function(e,t,i,a,o){var l,c,h,_=0,p=0,m=0,v=0,g=t,b=0,E=g,S=0,y=e,A=0;for(h=null!=o&&a.global_gain==o.global_gain,c=a.block_type==s.SHORT_TYPE?38:21,l=0;l<=c;l++){var w=-1;if((h||a.block_type==s.NORM_TYPE)&&(w=a.global_gain-(a.scalefac[l]+(0!=a.preflag?u.pretab[l]:0)<<a.scalefac_scale+1)-8*a.subblock_gain[a.window[l]]),n(a.width[l]>=0),h&&o.step[l]==w)0!=p&&(d(p,i,y,A,E,S),p=0),0!=m&&(f(m,i,y,A,E,S),m=0);else{var R,M=a.width[l];if(_+a.width[l]>a.max_nonzero_coeff&&(R=a.max_nonzero_coeff-_+1,r.fill(t,a.max_nonzero_coeff,576,0),(M=R)<0&&(M=0),l=c+1),0==p&&0==m&&(E=g,S=b,y=e,A=v),null!=o&&o.sfb_count1>0&&l>=o.sfb_count1&&o.step[l]>0&&w>=o.step[l]?(0!=p&&(d(p,i,y,A,E,S),p=0,E=g,S=b,y=e,A=v),m+=M):(0!=m&&(f(m,i,y,A,E,S),m=0,E=g,S=b,y=e,A=v),p+=M),M<=0){0!=m&&(f(m,i,y,A,E,S),m=0),0!=p&&(d(p,i,y,A,E,S),p=0);break}}l<=c&&(b+=a.width[l],v+=a.width[l],_+=a.width[l])}0!=p&&(d(p,i,y,A,E,S),p=0),0!=m&&(f(m,i,y,A,E,S),m=0)}(t,o,u.IPOW20(i.global_gain),i,a),2&e.substep_shaping)for(var h=0,_=i.global_gain+i.scalefac_scale,p=.634521682242439/u.IPOW20(_),m=0;m<i.sfbmax;m++){var v,g=i.width[m];if(n(g>=0),0==e.pseudohalf[m])h+=g;else for(v=h,h+=g;v<h;++v)o[v]=t[v]>=p?o[v]:0}return this.noquant_count_bits(e,i,a)},this.best_huffman_divide=function(e,t){var r=new o,u=t.l3_enc,h=i(23),f=i(23),d=i(23),_=i(23);if(t.block_type!=s.SHORT_TYPE||1!=e.mode_gr){r.assign(t),t.block_type==s.NORM_TYPE&&(!function(e,t,r,i,n,s,a){for(var o=t.big_values,u=0;u<=22;u++)i[u]=l.LARGE_BITS;for(u=0;u<16;u++){var h=e.scalefac_band.l[u+1];if(h>=o)break;var f=0,d=new c(f),_=p(r,0,h,d);f=d.bits;for(var m=0;m<8;m++){var v=e.scalefac_band.l[u+m+2];if(v>=o)break;var g=f,b=p(r,h,v,d=new c(g));g=d.bits,i[u+m]>g&&(i[u+m]=g,n[u+m]=u,s[u+m]=_,a[u+m]=b)}}}(e,t,u,h,f,d,_),m(e,r,t,u,h,f,d,_));var v=r.big_values;if(!(0==v||(u[v-2]|u[v-1])>1||(v=t.count1+2)>576)){r.assign(t),r.count1=v;var g=0,b=0;for(n(v<=576);v>r.big_values;v-=4){var E=2*(2*(2*u[v-4]+u[v-3])+u[v-2])+u[v-1];g+=a.t32l[E],b+=a.t33l[E]}if(r.big_values=v,r.count1table_select=0,g>b&&(g=b,r.count1table_select=1),r.count1bits=g,r.block_type==s.NORM_TYPE)m(e,r,t,u,h,f,d,_);else{if(r.part2_3_length=g,(g=e.scalefac_band.l[8])>v&&(g=v),g>0){var S=new c(r.part2_3_length);r.table_select[0]=p(u,0,g,S),r.part2_3_length=S.bits}if(v>g){S=new c(r.part2_3_length);r.table_select[1]=p(u,g,v,S),r.part2_3_length=S.bits}t.part2_3_length>r.part2_3_length&&t.assign(r)}}}};var v=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],g=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],b=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],E=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];e.slen1_tab=b,e.slen2_tab=E,this.best_scalefac_store=function(e,t,r,i){var o,l,c,h,f=i.tt[t][r],d=0;for(c=0,o=0;o<f.sfbmax;o++){var _=f.width[o];for(n(_>=0),c+=_,h=-_;h<0&&0==f.l3_enc[h+c];h++);0==h&&(f.scalefac[o]=d=-2)}if(0==f.scalefac_scale&&0==f.preflag){var p=0;for(o=0;o<f.sfbmax;o++)f.scalefac[o]>0&&(p|=f.scalefac[o]);if(!(1&p)&&0!=p){for(o=0;o<f.sfbmax;o++)f.scalefac[o]>0&&(f.scalefac[o]>>=1);f.scalefac_scale=d=1}}if(0==f.preflag&&f.block_type!=s.SHORT_TYPE&&2==e.mode_gr){for(o=11;o<s.SBPSY_l&&!(f.scalefac[o]<u.pretab[o]&&-2!=f.scalefac[o]);o++);if(o==s.SBPSY_l){for(o=11;o<s.SBPSY_l;o++)f.scalefac[o]>0&&(f.scalefac[o]-=u.pretab[o]);f.preflag=d=1}}for(l=0;l<4;l++)i.scfsi[r][l]=0;for(2==e.mode_gr&&1==t&&i.tt[0][r].block_type!=s.SHORT_TYPE&&i.tt[1][r].block_type!=s.SHORT_TYPE&&(!function(e,t){for(var r,i=t.tt[1][e],n=t.tt[0][e],o=0;o<a.scfsi_band.length-1;o++){for(r=a.scfsi_band[o];r<a.scfsi_band[o+1]&&!(n.scalefac[r]!=i.scalefac[r]&&i.scalefac[r]>=0);r++);if(r==a.scfsi_band[o+1]){for(r=a.scfsi_band[o];r<a.scfsi_band[o+1];r++)i.scalefac[r]=-1;t.scfsi[e][o]=1}}var l=0,u=0;for(r=0;r<11;r++)-1!=i.scalefac[r]&&(u++,l<i.scalefac[r]&&(l=i.scalefac[r]));for(var c=0,h=0;r<s.SBPSY_l;r++)-1!=i.scalefac[r]&&(h++,c<i.scalefac[r]&&(c=i.scalefac[r]));for(o=0;o<16;o++)if(l<v[o]&&c<g[o]){var f=b[o]*u+E[o]*h;i.part2_length>f&&(i.part2_length=f,i.scalefac_compress=o)}}(r,i),d=0),o=0;o<f.sfbmax;o++)-2==f.scalefac[o]&&(f.scalefac[o]=0);0!=d&&(2==e.mode_gr?this.scale_bitcount(f):this.scale_bitcount_lsf(e,f))};var S=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],y=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],A=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(e){var t,r,i,a=0,o=0,c=e.scalefac;if(n(function(e,t){for(var r=0;r<t;++r)if(e[r]<0)return!1;return!0}(c,e.sfbmax)),e.block_type==s.SHORT_TYPE)i=S,0!=e.mixed_block_flag&&(i=y);else if(i=A,0==e.preflag){for(r=11;r<s.SBPSY_l&&!(c[r]<u.pretab[r]);r++);if(r==s.SBPSY_l)for(e.preflag=1,r=11;r<s.SBPSY_l;r++)c[r]-=u.pretab[r]}for(r=0;r<e.sfbdivide;r++)a<c[r]&&(a=c[r]);for(;r<e.sfbmax;r++)o<c[r]&&(o=c[r]);for(e.part2_length=l.LARGE_BITS,t=0;t<16;t++)a<v[t]&&o<g[t]&&e.part2_length>i[t]&&(e.part2_length=i[t],e.scalefac_compress=t);return e.part2_length==l.LARGE_BITS};var w=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(e,r){var a,o,l,c,h,f,d,_,p=i(4),m=r.scalefac;for(a=0!=r.preflag?2:0,d=0;d<4;d++)p[d]=0;if(r.block_type==s.SHORT_TYPE){o=1;var v=u.nr_of_sfb_block[a][o];for(_=0,l=0;l<4;l++)for(c=v[l]/3,d=0;d<c;d++,_++)for(h=0;h<3;h++)m[3*_+h]>p[l]&&(p[l]=m[3*_+h])}else{o=0;v=u.nr_of_sfb_block[a][o];for(_=0,l=0;l<4;l++)for(c=v[l],d=0;d<c;d++,_++)m[_]>p[l]&&(p[l]=m[_])}for(f=!1,l=0;l<4;l++)p[l]>w[a][l]&&(f=!0);if(!f){var g,b,E,S;for(r.sfb_partition_table=u.nr_of_sfb_block[a][o],l=0;l<4;l++)r.slen[l]=R[p[l]];switch(g=r.slen[0],b=r.slen[1],E=r.slen[2],S=r.slen[3],a){case 0:r.scalefac_compress=(5*g+b<<4)+(E<<2)+S;break;case 1:r.scalefac_compress=400+(5*g+b<<2)+E;break;case 2:r.scalefac_compress=500+3*g+b;break;default:t.err.printf("intensity stereo not implemented yet\n")}}if(!f)for(n(null!=r.sfb_partition_table),r.part2_length=0,l=0;l<4;l++)r.part2_length+=r.slen[l]*r.sfb_partition_table[l];return f};var R=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(e){for(var t=2;t<=576;t+=2){for(var r,i=0;e.scalefac_band.l[++i]<t;);for(r=h[i][0];e.scalefac_band.l[r+1]>t;)r--;for(r<0&&(r=h[i][0]),e.bv_scf[t-2]=r,r=h[i][1];e.scalefac_band.l[r+e.bv_scf[t-2]+2]>t;)r--;r<0&&(r=h[i][1]),e.bv_scf[t-1]=r}}},zi}function On(){if($i)return Qi;$i=1;var e=Sn(),t=e.System;e.VbrMode,e.Float,e.ShortBlock,e.Util;var r=e.Arrays;e.new_array_n;var i=e.new_byte;e.new_double,e.new_float;var n=e.new_float_n,s=e.new_int;e.new_int_n;var a=e.assert,o=Cn(),l=kn(),u=An(),c=In();function h(){var e=this,h=32,f=null,d=null,_=null,p=null;this.setModules=function(e,t,r,i){f=e,d=t,_=r,p=i};var m=null,v=0,g=0,b=0;function E(e){t.arraycopy(e.header[e.w_ptr].buf,0,m,g,e.sideinfo_len),g+=e.sideinfo_len,v+=8*e.sideinfo_len,e.w_ptr=e.w_ptr+1&c.MAX_HEADER_BUF-1}function S(e,t,r){for(a(r<30);r>0;){var i;0==b&&(b=8,g++,a(g<Lame.LAME_MAXMP3BUFFER),a(e.header[e.w_ptr].write_timing>=v),e.header[e.w_ptr].write_timing==v&&E(e),m[g]=0),i=Math.min(r,b),b-=i,a((r-=i)<h),a(b<h),m[g]|=t>>r<<b,v+=i}}function y(e,t,r){for(a(r<30);r>0;){var i;0==b&&(b=8,g++,a(g<Lame.LAME_MAXMP3BUFFER),m[g]=0),i=Math.min(r,b),b-=i,a((r-=i)<h),a(b<h),m[g]|=t>>r<<b,v+=i}}function A(e,t){var r,i=e.internal_flags;if(a(t>=0),t>=8&&(S(i,76,8),t-=8),t>=8&&(S(i,65,8),t-=8),t>=8&&(S(i,77,8),t-=8),t>=8&&(S(i,69,8),t-=8),t>=32){var n=_.getLameShortVersion();if(t>=32)for(r=0;r<n.length&&t>=8;++r)t-=8,S(i,n.charAt(r),8)}for(;t>=1;t-=1)S(i,i.ancillary_flag,1),i.ancillary_flag^=e.disable_reservoir?0:1;a(0==t)}function w(e,t,r){for(var i=e.header[e.h_ptr].ptr;r>0;){var n=Math.min(r,8-(7&i));a((r-=n)<h),e.header[e.h_ptr].buf[i>>3]|=t>>r<<8-(7&i)-n,i+=n}e.header[e.h_ptr].ptr=i}function R(e,t){e<<=8;for(var r=0;r<8;r++)65536&((t<<=1)^(e<<=1))&&(t^=32773);return t}function M(e,t){var r,i=l.ht[t.count1table_select+32],n=0,s=t.big_values,o=t.big_values;for(a(t.count1table_select<2),r=(t.count1-t.big_values)/4;r>0;--r){var u,c=0,h=0;0!=(u=t.l3_enc[s+0])&&(h+=8,t.xr[o+0]<0&&c++,a(u<=1)),0!=(u=t.l3_enc[s+1])&&(h+=4,c*=2,t.xr[o+1]<0&&c++,a(u<=1)),0!=(u=t.l3_enc[s+2])&&(h+=2,c*=2,t.xr[o+2]<0&&c++,a(u<=1)),0!=(u=t.l3_enc[s+3])&&(h++,c*=2,t.xr[o+3]<0&&c++,a(u<=1)),s+=4,o+=4,S(e,c+i.table[h],i.hlen[h]),n+=i.hlen[h]}return n}function B(e,t,r,i,n){var s=l.ht[t],o=0;if(a(t<32),0==t)return o;for(var u=r;u<i;u+=2){var c=0,f=0,d=s.xlen,_=s.xlen,p=0,m=n.l3_enc[u],v=n.l3_enc[u+1];if(0!=m&&(n.xr[u]<0&&p++,c--),t>15){if(m>14){var g=m-15;a(g<=s.linmax),p|=g<<1,f=d,m=15}if(v>14){var b=v-15;a(b<=s.linmax),p<<=d,p|=b,f+=d,v=15}_=16}0!=v&&(p<<=1,n.xr[u+1]<0&&p++,c--),a((m|v)<16),m=m*_+v,f-=c,c+=s.hlen[m],a(c<=h),a(f<=h),S(e,s.table[m],c),S(e,p,f),o+=c+f}return o}function T(e,t){var r=3*e.scalefac_band.s[3];r>t.big_values&&(r=t.big_values);var i=B(e,t.table_select[0],0,r,t);return i+=B(e,t.table_select[1],r,t.big_values,t)}function I(e,t){var r,i,n,s;r=t.big_values,a(0<=r&&r<=576);var o=t.region0_count+1;return a(0<=o),a(o<e.scalefac_band.l.length),n=e.scalefac_band.l[o],o+=t.region1_count+1,a(0<=o),a(o<e.scalefac_band.l.length),n>r&&(n=r),(s=e.scalefac_band.l[o])>r&&(s=r),i=B(e,t.table_select[0],0,n,t),i+=B(e,t.table_select[1],n,s,t),i+=B(e,t.table_select[2],s,r,t)}function P(){this.total=0}function x(r,i){var n,s,a,o,l,u=r.internal_flags;return l=u.w_ptr,-1==(o=u.h_ptr-1)&&(o=c.MAX_HEADER_BUF-1),n=u.header[o].write_timing-v,i.total=n,n>=0&&(s=1+o-l,o<l&&(s=1+o-l+c.MAX_HEADER_BUF),n-=8*s*u.sideinfo_len),n+=a=e.getframebits(r),i.total+=a,i.total%8!=0?i.total=1+i.total/8:i.total=i.total/8,i.total+=g+1,n<0&&t.err.println("strange error flushing buffer ... \n"),n}this.getframebits=function(e){var t,r=e.internal_flags;return t=0!=r.bitrate_index?l.bitrate_table[e.version][r.bitrate_index]:e.brate,a(8<=t&&t<=640),8*(0|72e3*(e.version+1)*t/e.out_samplerate+r.padding)},this.CRC_writeheader=function(e,t){var r=65535;r=R(255&t[2],r),r=R(255&t[3],r);for(var i=6;i<e.sideinfo_len;i++)r=R(255&t[i],r);t[4]=byte(r>>8),t[5]=byte(255&r)},this.flush_bitstream=function(e){var t,r,i=e.internal_flags,n=i.h_ptr-1;if(-1==n&&(n=c.MAX_HEADER_BUF-1),t=i.l3_side,!((r=x(e,new P))<0)){if(A(e,r),a(i.header[n].write_timing+this.getframebits(e)==v),i.ResvSize=0,t.main_data_begin=0,i.findReplayGain){var s=f.GetTitleGain(i.rgdata);a(NEQ(s,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),i.RadioGain=0|Math.floor(10*s+.5)}i.findPeakSample&&(i.noclipGainChange=0|Math.ceil(20*Math.log10(i.PeakSample/32767)*10),i.noclipGainChange>0&&(EQ(e.scale,1)||EQ(e.scale,0))?i.noclipScale=Math.floor(32767/i.PeakSample*100)/100:i.noclipScale=-1)}},this.add_dummy_byte=function(e,t,r){for(var i,n=e.internal_flags;r-- >0;)for(y(0,t,8),i=0;i<c.MAX_HEADER_BUF;++i)n.header[i].write_timing+=8},this.format_bitstream=function(e){var i,n=e.internal_flags;i=n.l3_side;var s=this.getframebits(e);A(e,i.resvDrain_pre),function(e,i){var n,s,o,l=e.internal_flags;if(n=l.l3_side,l.header[l.h_ptr].ptr=0,r.fill(l.header[l.h_ptr].buf,0,l.sideinfo_len,0),e.out_samplerate<16e3?w(l,4094,12):w(l,4095,12),w(l,e.version,1),w(l,1,2),w(l,e.error_protection?0:1,1),w(l,l.bitrate_index,4),w(l,l.samplerate_index,2),w(l,l.padding,1),w(l,e.extension,1),w(l,e.mode.ordinal(),2),w(l,l.mode_ext,2),w(l,e.copyright,1),w(l,e.original,1),w(l,e.emphasis,2),e.error_protection&&w(l,0,16),1==e.version){for(a(n.main_data_begin>=0),w(l,n.main_data_begin,9),2==l.channels_out?w(l,n.private_bits,3):w(l,n.private_bits,5),o=0;o<l.channels_out;o++){var h;for(h=0;h<4;h++)w(l,n.scfsi[o][h],1)}for(s=0;s<2;s++)for(o=0;o<l.channels_out;o++)w(l,(f=n.tt[s][o]).part2_3_length+f.part2_length,12),w(l,f.big_values/2,9),w(l,f.global_gain,8),w(l,f.scalefac_compress,4),f.block_type!=u.NORM_TYPE?(w(l,1,1),w(l,f.block_type,2),w(l,f.mixed_block_flag,1),14==f.table_select[0]&&(f.table_select[0]=16),w(l,f.table_select[0],5),14==f.table_select[1]&&(f.table_select[1]=16),w(l,f.table_select[1],5),w(l,f.subblock_gain[0],3),w(l,f.subblock_gain[1],3),w(l,f.subblock_gain[2],3)):(w(l,0,1),14==f.table_select[0]&&(f.table_select[0]=16),w(l,f.table_select[0],5),14==f.table_select[1]&&(f.table_select[1]=16),w(l,f.table_select[1],5),14==f.table_select[2]&&(f.table_select[2]=16),w(l,f.table_select[2],5),a(0<=f.region0_count&&f.region0_count<16),a(0<=f.region1_count&&f.region1_count<8),w(l,f.region0_count,4),w(l,f.region1_count,3)),w(l,f.preflag,1),w(l,f.scalefac_scale,1),w(l,f.count1table_select,1)}else for(a(n.main_data_begin>=0),w(l,n.main_data_begin,8),w(l,n.private_bits,l.channels_out),s=0,o=0;o<l.channels_out;o++){var f;w(l,(f=n.tt[s][o]).part2_3_length+f.part2_length,12),w(l,f.big_values/2,9),w(l,f.global_gain,8),w(l,f.scalefac_compress,9),f.block_type!=u.NORM_TYPE?(w(l,1,1),w(l,f.block_type,2),w(l,f.mixed_block_flag,1),14==f.table_select[0]&&(f.table_select[0]=16),w(l,f.table_select[0],5),14==f.table_select[1]&&(f.table_select[1]=16),w(l,f.table_select[1],5),w(l,f.subblock_gain[0],3),w(l,f.subblock_gain[1],3),w(l,f.subblock_gain[2],3)):(w(l,0,1),14==f.table_select[0]&&(f.table_select[0]=16),w(l,f.table_select[0],5),14==f.table_select[1]&&(f.table_select[1]=16),w(l,f.table_select[1],5),14==f.table_select[2]&&(f.table_select[2]=16),w(l,f.table_select[2],5),a(0<=f.region0_count&&f.region0_count<16),a(0<=f.region1_count&&f.region1_count<8),w(l,f.region0_count,4),w(l,f.region1_count,3)),w(l,f.scalefac_scale,1),w(l,f.count1table_select,1)}e.error_protection&&CRC_writeheader(l,l.header[l.h_ptr].buf);var d=l.h_ptr;a(l.header[d].ptr==8*l.sideinfo_len),l.h_ptr=d+1&c.MAX_HEADER_BUF-1,l.header[l.h_ptr].write_timing=l.header[d].write_timing+i,l.h_ptr==l.w_ptr&&t.err.println("Error: MAX_HEADER_BUF too small in bitstream.c \n")}(e,s);var l=8*n.sideinfo_len;if(l+=function(e){var t,r,i,n,s=0,l=e.internal_flags,c=l.l3_side;if(1==e.version)for(t=0;t<2;t++)for(r=0;r<l.channels_out;r++){var h=c.tt[t][r],f=o.slen1_tab[h.scalefac_compress],d=o.slen2_tab[h.scalefac_compress];for(n=0,i=0;i<h.sfbdivide;i++)-1!=h.scalefac[i]&&(S(l,h.scalefac[i],f),n+=f);for(;i<h.sfbmax;i++)-1!=h.scalefac[i]&&(S(l,h.scalefac[i],d),n+=d);a(n==h.part2_length),h.block_type==u.SHORT_TYPE?n+=T(l,h):n+=I(l,h),n+=M(l,h),a(n==h.part2_3_length+h.part2_length),s+=n}else for(t=0,r=0;r<l.channels_out;r++){h=c.tt[t][r];var _,p,m=0;if(a(null!=h.sfb_partition_table),n=0,i=0,p=0,h.block_type==u.SHORT_TYPE){for(;p<4;p++){var v=h.sfb_partition_table[p]/3,g=h.slen[p];for(_=0;_<v;_++,i++)S(l,Math.max(h.scalefac[3*i+0],0),g),S(l,Math.max(h.scalefac[3*i+1],0),g),S(l,Math.max(h.scalefac[3*i+2],0),g),m+=3*g}n+=T(l,h)}else{for(;p<4;p++)for(v=h.sfb_partition_table[p],g=h.slen[p],_=0;_<v;_++,i++)S(l,Math.max(h.scalefac[i],0),g),m+=g;n+=I(l,h)}n+=M(l,h),a(n==h.part2_3_length),a(m==h.part2_length),s+=m+n}return s}(e),A(e,i.resvDrain_post),l+=i.resvDrain_post,i.main_data_begin+=(s-l)/8,x(e,new P)!=n.ResvSize&&t.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),8*i.main_data_begin!=n.ResvSize&&(t.err.printf("bit reservoir error: \nl3_side.main_data_begin: %d \nResvoir size:             %d \nresv drain (post)         %d \nresv drain (pre)          %d \nheader and sideinfo:      %d \ndata bits:                %d \ntotal bits:               %d (remainder: %d) \nbitsperframe:             %d \n",8*i.main_data_begin,n.ResvSize,i.resvDrain_post,i.resvDrain_pre,8*n.sideinfo_len,l-i.resvDrain_post-8*n.sideinfo_len,l,l%8,s),t.err.println("This is a fatal error.  It has several possible causes:"),t.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),t.err.println(" 9%%  Your system is overclocked"),t.err.println(" 1%%  bug in LAME encoding library"),n.ResvSize=8*i.main_data_begin),a(v%8==0),v>1e9){var h;for(h=0;h<c.MAX_HEADER_BUF;++h)n.header[h].write_timing-=v;v=0}return 0},this.copy_buffer=function(e,r,i,o,l){var u=g+1;if(u<=0)return 0;if(0!=o&&u>o)return-1;if(t.arraycopy(m,0,r,i,u),g=-1,b=0,0!=l){var c=s(1);if(c[0]=e.nMusicCRC,p.updateMusicCRC(c,r,i,u),e.nMusicCRC=c[0],u>0&&(e.VBR_seek_table.nBytesWritten+=u),e.decode_on_the_fly)for(var h,_=n([2,1152]),v=u,E=-1;0!=E;)if(E=d.hip_decode1_unclipped(e.hip,r,i,v,_[0],_[1]),v=0,-1==E&&(E=0),E>0){if(a(E<=1152),e.findPeakSample){for(h=0;h<E;h++)_[0][h]>e.PeakSample?e.PeakSample=_[0][h]:-_[0][h]>e.PeakSample&&(e.PeakSample=-_[0][h]);if(e.channels_out>1)for(h=0;h<E;h++)_[1][h]>e.PeakSample?e.PeakSample=_[1][h]:-_[1][h]>e.PeakSample&&(e.PeakSample=-_[1][h])}if(e.findReplayGain&&f.AnalyzeSamples(e.rgdata,_[0],0,_[1],0,E,e.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}return u},this.init_bit_stream_w=function(e){m=i(Lame.LAME_MAXMP3BUFFER),e.h_ptr=e.w_ptr=0,e.header[e.h_ptr].write_timing=0,g=-1,b=0,v=0}}return h.EQ=function(e,t){return Math.abs(e)>Math.abs(t)?Math.abs(e-t)<=1e-6*Math.abs(e):Math.abs(e-t)<=1e-6*Math.abs(t)},h.NEQ=function(e,t){return!h.EQ(e,t)},Qi=h}function Dn(){if(en)return Ji;en=1;var e=Sn(),t=e.System,r=e.VbrMode;e.Float;var i=e.ShortBlock;e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double;var n=e.new_float;e.new_float_n,e.new_int;var s=e.new_int_n,a=e.new_short_n,o=e.assert,l=wn(),u=function(){if(Ei)return bi;Ei=1;var e=Rn();return bi=function(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=e.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}}(),c=In(),h=function(){if(Di)return Oi;Di=1;var e=Sn();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double;var t=e.new_float;e.new_float_n,e.new_int,e.new_int_n,e.assert;var r=An();return Oi=function(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=t(r.SBMAX_l),this.s=t(r.SBMAX_s),this.psfb21=t(r.PSFB21),this.psfb12=t(r.PSFB12),this.cb_l=t(r.CBANDS),this.cb_s=t(r.CBANDS),this.eql_w=t(r.BLKSIZE/2)}}(),f=function(){if(Gi)return Vi;Gi=1;var e=Sn();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double;var t=e.new_float;e.new_float_n;var r=e.new_int;e.new_int_n,e.assert;var i=Pn();return Vi=function(){this.linprebuf=t(2*i.MAX_ORDER),this.linpre=0,this.lstepbuf=t(i.MAX_SAMPLES_PER_WINDOW+i.MAX_ORDER),this.lstep=0,this.loutbuf=t(i.MAX_SAMPLES_PER_WINDOW+i.MAX_ORDER),this.lout=0,this.rinprebuf=t(2*i.MAX_ORDER),this.rinpre=0,this.rstepbuf=t(i.MAX_SAMPLES_PER_WINDOW+i.MAX_ORDER),this.rstep=0,this.routbuf=t(i.MAX_SAMPLES_PER_WINDOW+i.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=r(0|i.STEPS_per_dB*i.MAX_dB),this.B=r(0|i.STEPS_per_dB*i.MAX_dB)}}(),d=function(){if(qi)return ji;qi=1;var e=Sn();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double;var t=e.new_float;e.new_float_n;var r=e.new_int;e.new_int_n;var i=e.assert,n=xn(),s=An(),a=Mn(),o=In();return ji=function(e){var l=e;this.quantize=l,this.iteration_loop=function(e,l,u,c){var h,f=e.internal_flags,d=t(a.SFBMAX),_=t(576),p=r(2),m=0,v=f.l3_side,g=new n(m);this.quantize.rv.ResvFrameBegin(e,g),m=g.bits;for(var b=0;b<f.mode_gr;b++){h=this.quantize.qupvt.on_pe(e,l,p,m,b,b),f.mode_ext==s.MPG_MD_MS_LR&&(this.quantize.ms_convert(f.l3_side,b),this.quantize.qupvt.reduce_side(p,u[b],m,h));for(var E=0;E<f.channels_out;E++){var S,y,A=v.tt[b][E];A.block_type!=s.SHORT_TYPE?(S=0,y=f.PSY.mask_adjust-S):(S=0,y=f.PSY.mask_adjust_short-S),f.masking_lower=Math.pow(10,.1*y),this.quantize.init_outer_loop(f,A),this.quantize.init_xrpow(f,A,_)&&(this.quantize.qupvt.calc_xmin(e,c[b][E],A,d),this.quantize.outer_loop(e,A,d,_,E,p[E])),this.quantize.iteration_finish_one(f,b,E),i(A.part2_3_length<=o.MAX_BITS_PER_CHANNEL),i(A.part2_3_length<=p[E])}}this.quantize.rv.ResvFrameEnd(f,m)}},ji}(),_=On(),p=kn(),m=An();return Ji=function e(){var v,g,b,E,S,y=this;e.V9=410,e.V8=420,e.V7=430,e.V6=440,e.V5=450,e.V4=460,e.V3=470,e.V2=480,e.V1=490,e.V0=500,e.R3MIX=1e3,e.STANDARD=1001,e.EXTREME=1002,e.INSANE=1003,e.STANDARD_FAST=1004,e.EXTREME_FAST=1005,e.MEDIUM=1006,e.MEDIUM_FAST=1007,e.LAME_MAXMP3BUFFER=147456;var A,w,R,M=new l;function B(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=n(m.SBMAX_l),this.bo_s_weight=n(m.SBMAX_s)}function T(){this.lowerlimit=0}function I(e,t){this.lowpass=t}this.enc=new m,this.setModules=function(e,t,r,i,n,s,a,o,l){v=e,g=t,b=r,E=i,S=n,A=s,w=o,R=l,this.enc.setModules(g,M,E,A)};var P=4294479419;function x(e){return e>1?0:e<=0?1:Math.cos(Math.PI/2*e)}function k(e,t){switch(e){case 44100:return t.version=1,0;case 48e3:return t.version=1,1;case 32e3:return t.version=1,2;case 22050:case 11025:return t.version=0,0;case 24e3:case 12e3:return t.version=0,1;case 16e3:case 8e3:return t.version=0,2;default:return t.version=0,-1}}function N(e,t,r){r<16e3&&(t=2);for(var i=p.bitrate_table[t][1],n=2;n<=14;n++)p.bitrate_table[t][n]>0&&Math.abs(p.bitrate_table[t][n]-e)<Math.abs(i-e)&&(i=p.bitrate_table[t][n]);return i}function C(e,t,r){r<16e3&&(t=2);for(var i=0;i<=14;i++)if(p.bitrate_table[t][i]>0&&p.bitrate_table[t][i]==e)return i;return-1}function O(e,t){var r=[new I(8,2e3),new I(16,3700),new I(24,3900),new I(32,5500),new I(40,7e3),new I(48,7500),new I(56,1e4),new I(64,11e3),new I(80,13500),new I(96,15100),new I(112,15600),new I(128,17e3),new I(160,17500),new I(192,18600),new I(224,19400),new I(256,19700),new I(320,20500)],i=y.nearestBitrateFullIndex(t);e.lowerlimit=r[i].lowpass}function D(e){var t=m.BLKSIZE+e.framesize-m.FFTOFFSET;return t=Math.max(t,512+e.framesize-32),o(c.MFSIZE>=t),t}function F(e,t,r,i,n,s){var a=y.enc.lame_encode_mp3_frame(e,t,r,i,n,s);return e.frameNum++,a}function L(){this.n_in=0,this.n_out=0}function V(){this.num_used=0}function G(e,t){return 0!=t?G(t,e%t):e}function U(e,t,r){var i=Math.PI*t;(e/=r)<0&&(e=0),e>1&&(e=1);var n=e-.5,s=.42-.5*Math.cos(2*e*Math.PI)+.08*Math.cos(4*e*Math.PI);return Math.abs(n)<1e-9?i/Math.PI:s*Math.sin(r*i*n)/(Math.PI*r*n)}function H(e,t,r,i,s,a,l,u,h){var f,d,_=e.internal_flags,p=0,m=e.out_samplerate/G(e.out_samplerate,e.in_samplerate);m>c.BPC&&(m=c.BPC);var v=Math.abs(_.resample_ratio-Math.floor(.5+_.resample_ratio))<1e-4?1:0,g=1/_.resample_ratio;g>1&&(g=1);var b=31;0==b%2&&--b;var E=(b+=v)+1;if(0==_.fill_buffer_resample_init){for(_.inbuf_old[0]=n(E),_.inbuf_old[1]=n(E),f=0;f<=2*m;++f)_.blackfilt[f]=n(E);for(_.itime[0]=0,_.itime[1]=0,p=0;p<=2*m;p++){var S=0,y=(p-m)/(2*m);for(f=0;f<=b;f++)S+=_.blackfilt[p][f]=U(f-y,g,b);for(f=0;f<=b;f++)_.blackfilt[p][f]/=S}_.fill_buffer_resample_init=1}var A=_.inbuf_old[h];for(d=0;d<i;d++){var w,R;if(w=d*_.resample_ratio,b+(p=0|Math.floor(w-_.itime[h]))-b/2>=l)break;y=w-_.itime[h]-(p+b%2*.5);o(Math.abs(y)<=.501),R=0|Math.floor(2*y*m+m+.5);var M=0;for(f=0;f<=b;++f){var B=0|f+p-b/2;o(B<l),o(B+E>=0),M+=(B<0?A[E+B]:s[a+B])*_.blackfilt[R][f]}t[r+d]=M}if(u.num_used=Math.min(l,b+p-b/2),_.itime[h]+=u.num_used-d*_.resample_ratio,u.num_used>=E)for(f=0;f<E;f++)A[f]=s[a+u.num_used+f-E];else{var T=E-u.num_used;for(f=0;f<T;++f)A[f]=A[f+u.num_used];for(p=0;f<E;++f,++p)A[f]=s[a+p];o(p==u.num_used)}return d}function j(e,t,r,i,n,s){var a=e.internal_flags;if(a.resample_ratio<.9999||a.resample_ratio>1.0001)for(var o=0;o<a.channels_out;o++){var l=new V;s.n_out=H(e,t[o],a.mf_size,e.framesize,r[o],i,n,l,o),s.n_in=l.num_used}else{s.n_out=Math.min(e.framesize,n),s.n_in=s.n_out;for(var u=0;u<s.n_out;++u)t[0][a.mf_size+u]=r[0][i+u],2==a.channels_out&&(t[1][a.mf_size+u]=r[1][i+u])}}this.lame_init=function(){var e=new u;return function(e){var t;e.class_id=P,t=e.internal_flags=new c,e.mode=MPEGMode.NOT_SET,e.original=1,e.in_samplerate=44100,e.num_channels=2,e.num_samples=-1,e.bWriteVbrTag=!0,e.quality=-1,e.short_blocks=null,t.subblock_gain=-1,e.lowpassfreq=0,e.highpassfreq=0,e.lowpasswidth=-1,e.highpasswidth=-1,e.VBR=r.vbr_off,e.VBR_q=4,e.ATHcurve=-1,e.VBR_mean_bitrate_kbps=128,e.VBR_min_bitrate_kbps=0,e.VBR_max_bitrate_kbps=0,e.VBR_hard_min=0,t.VBR_min_bitrate=1,t.VBR_max_bitrate=13,e.quant_comp=-1,e.quant_comp_short=-1,e.msfix=-1,t.resample_ratio=1,t.OldValue[0]=180,t.OldValue[1]=180,t.CurrentStep[0]=4,t.CurrentStep[1]=4,t.masking_lower=1,t.nsPsy.attackthre=-1,t.nsPsy.attackthre_s=-1,e.scale=-1,e.athaa_type=-1,e.ATHtype=-1,e.athaa_loudapprox=-1,e.athaa_sensitivity=0,e.useTemporal=null,e.interChRatio=-1,t.mf_samples_to_encode=m.ENCDELAY+m.POSTDELAY,e.encoder_padding=0,t.mf_size=m.ENCDELAY-m.MDCTDELAY,e.findReplayGain=!1,e.decode_on_the_fly=!1,t.decode_on_the_fly=!1,t.findReplayGain=!1,t.findPeakSample=!1,t.RadioGain=0,t.AudiophileGain=0,t.noclipGainChange=0,t.noclipScale=-1,e.preset=0,e.write_id3tag_automatic=!0}(e),e.lame_allocated_gfp=1,e},this.nearestBitrateFullIndex=function(e){var t=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],r=0,i=0,n=0,s=0;s=t[16],n=16,i=t[16],r=16;for(var a=0;a<16;a++)if(Math.max(e,t[a+1])!=e){s=t[a+1],n=a+1,i=t[a],r=a;break}return s-e>e-i?r:n},this.lame_init_params=function(e){var n,a,u,c=e.internal_flags;if(c.Class_ID=0,null==c.ATH&&(c.ATH=new h),null==c.PSY&&(c.PSY=new B),null==c.rgdata&&(c.rgdata=new f),c.channels_in=e.num_channels,1==c.channels_in&&(e.mode=MPEGMode.MONO),c.channels_out=e.mode==MPEGMode.MONO?1:2,c.mode_ext=m.MPG_MD_MS_LR,e.mode==MPEGMode.MONO&&(e.force_ms=!1),e.VBR==r.vbr_off&&128!=e.VBR_mean_bitrate_kbps&&0==e.brate&&(e.brate=e.VBR_mean_bitrate_kbps),e.VBR==r.vbr_off||e.VBR==r.vbr_mtrh||e.VBR==r.vbr_mt||(e.free_format=!1),e.VBR==r.vbr_off&&0==e.brate&&_.EQ(e.compression_ratio,0)&&(e.compression_ratio=11.025),e.VBR==r.vbr_off&&e.compression_ratio>0&&(0==e.out_samplerate&&(e.out_samplerate=map2MP3Frequency(int(.97*e.in_samplerate))),e.brate=0|16*e.out_samplerate*c.channels_out/(1e3*e.compression_ratio),c.samplerate_index=k(e.out_samplerate,e),e.free_format||(e.brate=N(e.brate,e.version,e.out_samplerate))),0!=e.out_samplerate&&(e.out_samplerate<16e3?(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,64)):e.out_samplerate<32e3?(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,160)):(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,32),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320))),0==e.lowpassfreq){var y=16e3;switch(e.VBR){case r.vbr_off:O(I=new T,e.brate),y=I.lowerlimit;break;case r.vbr_abr:var I;O(I=new T,e.VBR_mean_bitrate_kbps),y=I.lowerlimit;break;case r.vbr_rh:var D=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=e.VBR_q&&e.VBR_q<=9){var F=D[e.VBR_q],L=D[e.VBR_q+1],V=e.VBR_q_frac;y=linear_int(F,L,V)}else y=19500;break;default:D=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=e.VBR_q&&e.VBR_q<=9){F=D[e.VBR_q],L=D[e.VBR_q+1],V=e.VBR_q_frac;y=linear_int(F,L,V)}else y=19500}e.mode!=MPEGMode.MONO||e.VBR!=r.vbr_off&&e.VBR!=r.vbr_abr||(y*=1.5),e.lowpassfreq=0|y}if(0==e.out_samplerate&&(2*e.lowpassfreq>e.in_samplerate&&(e.lowpassfreq=e.in_samplerate/2),e.out_samplerate=(n=0|e.lowpassfreq,a=e.in_samplerate,u=44100,a>=48e3?u=48e3:a>=44100?u=44100:a>=32e3?u=32e3:a>=24e3?u=24e3:a>=22050?u=22050:a>=16e3?u=16e3:a>=12e3?u=12e3:a>=11025?u=11025:a>=8e3&&(u=8e3),-1==n?u:(n<=15960&&(u=44100),n<=15250&&(u=32e3),n<=11220&&(u=24e3),n<=9970&&(u=22050),n<=7230&&(u=16e3),n<=5420&&(u=12e3),n<=4510&&(u=11025),n<=3970&&(u=8e3),a<u?a>44100?48e3:a>32e3?44100:a>24e3?32e3:a>22050?24e3:a>16e3?22050:a>12e3?16e3:a>11025?12e3:a>8e3?11025:8e3:u))),e.lowpassfreq=Math.min(20500,e.lowpassfreq),e.lowpassfreq=Math.min(e.out_samplerate/2,e.lowpassfreq),e.VBR==r.vbr_off&&(e.compression_ratio=16*e.out_samplerate*c.channels_out/(1e3*e.brate)),e.VBR==r.vbr_abr&&(e.compression_ratio=16*e.out_samplerate*c.channels_out/(1e3*e.VBR_mean_bitrate_kbps)),e.bWriteVbrTag||(e.findReplayGain=!1,e.decode_on_the_fly=!1,c.findPeakSample=!1),c.findReplayGain=e.findReplayGain,c.decode_on_the_fly=e.decode_on_the_fly,c.decode_on_the_fly&&(c.findPeakSample=!0),c.findReplayGain&&v.InitGainAnalysis(c.rgdata,e.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return e.internal_flags=null,-6;switch(c.decode_on_the_fly&&!e.decode_only&&(null!=c.hip&&R.hip_decode_exit(c.hip),c.hip=R.hip_decode_init()),c.mode_gr=e.out_samplerate<=24e3?1:2,e.framesize=576*c.mode_gr,e.encoder_delay=m.ENCDELAY,c.resample_ratio=e.in_samplerate/e.out_samplerate,e.VBR){case r.vbr_mt:case r.vbr_rh:case r.vbr_mtrh:e.compression_ratio=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5][e.VBR_q];break;case r.vbr_abr:e.compression_ratio=16*e.out_samplerate*c.channels_out/(1e3*e.VBR_mean_bitrate_kbps);break;default:e.compression_ratio=16*e.out_samplerate*c.channels_out/(1e3*e.brate)}if(e.mode==MPEGMode.NOT_SET&&(e.mode=MPEGMode.JOINT_STEREO),e.highpassfreq>0?(c.highpass1=2*e.highpassfreq,e.highpasswidth>=0?c.highpass2=2*(e.highpassfreq+e.highpasswidth):c.highpass2=2*e.highpassfreq,c.highpass1/=e.out_samplerate,c.highpass2/=e.out_samplerate):(c.highpass1=0,c.highpass2=0),e.lowpassfreq>0?(c.lowpass2=2*e.lowpassfreq,e.lowpasswidth>=0?(c.lowpass1=2*(e.lowpassfreq-e.lowpasswidth),c.lowpass1<0&&(c.lowpass1=0)):c.lowpass1=2*e.lowpassfreq,c.lowpass1/=e.out_samplerate,c.lowpass2/=e.out_samplerate):(c.lowpass1=0,c.lowpass2=0),function(e){var r=e.internal_flags,i=32,n=-1;if(r.lowpass1>0){for(var s=999,a=0;a<=31;a++)(c=a/31)>=r.lowpass2&&(i=Math.min(i,a)),r.lowpass1<c&&c<r.lowpass2&&(s=Math.min(s,a));r.lowpass1=999==s?(i-.75)/31:(s-.75)/31,r.lowpass2=i/31}if(r.highpass2>0&&r.highpass2<.75/31*.9&&(r.highpass1=0,r.highpass2=0,t.err.println("Warning: highpass filter disabled.  highpass frequency too small\n")),r.highpass2>0){var o=-1;for(a=0;a<=31;a++)(c=a/31)<=r.highpass1&&(n=Math.max(n,a)),r.highpass1<c&&c<r.highpass2&&(o=Math.max(o,a));r.highpass1=n/31,r.highpass2=-1==o?(n+.75)/31:(o+.75)/31}for(a=0;a<32;a++){var l,u,c=a/31;l=r.highpass2>r.highpass1?x((r.highpass2-c)/(r.highpass2-r.highpass1+1e-20)):1,u=r.lowpass2>r.lowpass1?x((c-r.lowpass1)/(r.lowpass2-r.lowpass1+1e-20)):1,r.amp_filter[a]=l*u}}(e),c.samplerate_index=k(e.out_samplerate,e),c.samplerate_index<0)return e.internal_flags=null,-1;if(e.VBR==r.vbr_off){if(e.free_format)c.bitrate_index=0;else if(e.brate=N(e.brate,e.version,e.out_samplerate),c.bitrate_index=C(e.brate,e.version,e.out_samplerate),c.bitrate_index<=0)return e.internal_flags=null,-1}else c.bitrate_index=1;e.analysis&&(e.bWriteVbrTag=!1),null!=c.pinfo&&(e.bWriteVbrTag=!1),g.init_bit_stream_w(c);for(var G,U=c.samplerate_index+3*e.version+6*(e.out_samplerate<16e3?1:0),H=0;H<m.SBMAX_l+1;H++)c.scalefac_band.l[H]=E.sfBandIndex[U].l[H];for(H=0;H<m.PSFB21+1;H++){var j=(c.scalefac_band.l[22]-c.scalefac_band.l[21])/m.PSFB21,q=c.scalefac_band.l[21]+H*j;c.scalefac_band.psfb21[H]=q}c.scalefac_band.psfb21[m.PSFB21]=576;for(H=0;H<m.SBMAX_s+1;H++)c.scalefac_band.s[H]=E.sfBandIndex[U].s[H];for(H=0;H<m.PSFB12+1;H++){j=(c.scalefac_band.s[13]-c.scalefac_band.s[12])/m.PSFB12,q=c.scalefac_band.s[12]+H*j;c.scalefac_band.psfb12[H]=q}for(c.scalefac_band.psfb12[m.PSFB12]=192,1==e.version?c.sideinfo_len=1==c.channels_out?21:36:c.sideinfo_len=1==c.channels_out?13:21,e.error_protection&&(c.sideinfo_len+=2),function(e){var t=e.internal_flags;e.frameNum=0,e.write_id3tag_automatic&&w.id3tag_write_v2(e),t.bitrate_stereoMode_Hist=s([16,5]),t.bitrate_blockType_Hist=s([16,6]),t.PeakSample=0,e.bWriteVbrTag&&A.InitVbrTag(e)}(e),c.Class_ID=P,G=0;G<19;G++)c.nsPsy.pefirbuf[G]=700*c.mode_gr*c.channels_out;switch(-1==e.ATHtype&&(e.ATHtype=4),o(e.VBR_q<=9),o(e.VBR_q>=0),e.VBR){case r.vbr_mt:e.VBR=r.vbr_mtrh;case r.vbr_mtrh:null==e.useTemporal&&(e.useTemporal=!1),b.apply_preset(e,500-10*e.VBR_q,0),e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),e.quality<5&&(e.quality=0),e.quality>5&&(e.quality=5),c.PSY.mask_adjust=e.maskingadjust,c.PSY.mask_adjust_short=e.maskingadjust_short,e.experimentalY?c.sfb21_extra=!1:c.sfb21_extra=e.out_samplerate>44e3,c.iteration_loop=new VBRNewIterationLoop(S);break;case r.vbr_rh:b.apply_preset(e,500-10*e.VBR_q,0),c.PSY.mask_adjust=e.maskingadjust,c.PSY.mask_adjust_short=e.maskingadjust_short,e.experimentalY?c.sfb21_extra=!1:c.sfb21_extra=e.out_samplerate>44e3,e.quality>6&&(e.quality=6),e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),c.iteration_loop=new VBROldIterationLoop(S);break;default:var W;c.sfb21_extra=!1,e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),(W=e.VBR)==r.vbr_off&&(e.VBR_mean_bitrate_kbps=e.brate),b.apply_preset(e,e.VBR_mean_bitrate_kbps,0),e.VBR=W,c.PSY.mask_adjust=e.maskingadjust,c.PSY.mask_adjust_short=e.maskingadjust_short,W==r.vbr_off?c.iteration_loop=new d(S):c.iteration_loop=new ABRIterationLoop(S)}if(o(e.scale>=0),e.VBR!=r.vbr_off){if(c.VBR_min_bitrate=1,c.VBR_max_bitrate=14,e.out_samplerate<16e3&&(c.VBR_max_bitrate=8),0!=e.VBR_min_bitrate_kbps&&(e.VBR_min_bitrate_kbps=N(e.VBR_min_bitrate_kbps,e.version,e.out_samplerate),c.VBR_min_bitrate=C(e.VBR_min_bitrate_kbps,e.version,e.out_samplerate),c.VBR_min_bitrate<0))return-1;if(0!=e.VBR_max_bitrate_kbps&&(e.VBR_max_bitrate_kbps=N(e.VBR_max_bitrate_kbps,e.version,e.out_samplerate),c.VBR_max_bitrate=C(e.VBR_max_bitrate_kbps,e.version,e.out_samplerate),c.VBR_max_bitrate<0))return-1;e.VBR_min_bitrate_kbps=p.bitrate_table[e.version][c.VBR_min_bitrate],e.VBR_max_bitrate_kbps=p.bitrate_table[e.version][c.VBR_max_bitrate],e.VBR_mean_bitrate_kbps=Math.min(p.bitrate_table[e.version][c.VBR_max_bitrate],e.VBR_mean_bitrate_kbps),e.VBR_mean_bitrate_kbps=Math.max(p.bitrate_table[e.version][c.VBR_min_bitrate],e.VBR_mean_bitrate_kbps)}return e.tune&&(c.PSY.mask_adjust+=e.tune_value_a,c.PSY.mask_adjust_short+=e.tune_value_a),function(e){var t=e.internal_flags;switch(e.quality){default:case 9:t.psymodel=0,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 8:e.quality=7;case 7:t.psymodel=1,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 6:case 5:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=0,t.full_outer_loop=0;break;case 4:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 3:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=1,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 2:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=1,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 1:case 0:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=2,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0}}(e),o(e.scale>=0),e.athaa_type<0?c.ATH.useAdjust=3:c.ATH.useAdjust=e.athaa_type,c.ATH.aaSensitivityP=Math.pow(10,e.athaa_sensitivity/-10),null==e.short_blocks&&(e.short_blocks=i.short_block_allowed),e.short_blocks!=i.short_block_allowed||e.mode!=MPEGMode.JOINT_STEREO&&e.mode!=MPEGMode.STEREO||(e.short_blocks=i.short_block_coupled),e.quant_comp<0&&(e.quant_comp=1),e.quant_comp_short<0&&(e.quant_comp_short=0),e.msfix<0&&(e.msfix=0),e.exp_nspsytune=1|e.exp_nspsytune,e.internal_flags.nsPsy.attackthre<0&&(e.internal_flags.nsPsy.attackthre=l.NSATTACKTHRE),e.internal_flags.nsPsy.attackthre_s<0&&(e.internal_flags.nsPsy.attackthre_s=l.NSATTACKTHRE_S),o(e.scale>=0),e.scale<0&&(e.scale=1),e.ATHtype<0&&(e.ATHtype=4),e.ATHcurve<0&&(e.ATHcurve=4),e.athaa_loudapprox<0&&(e.athaa_loudapprox=2),e.interChRatio<0&&(e.interChRatio=0),null==e.useTemporal&&(e.useTemporal=!0),c.slot_lag=c.frac_SpF=0,e.VBR==r.vbr_off&&(c.slot_lag=c.frac_SpF=72e3*(e.version+1)*e.brate%e.out_samplerate|0),E.iteration_init(e),M.psymodel_init(e),o(e.scale>=0),0},this.lame_encode_flush=function(e,t,r,i){var n,s,o,l,u=e.internal_flags,c=a([2,1152]),h=0,f=u.mf_samples_to_encode-m.POSTDELAY,d=D(e);if(u.mf_samples_to_encode<1)return 0;for(n=0,e.in_samplerate!=e.out_samplerate&&(f+=16*e.out_samplerate/e.in_samplerate),(o=e.framesize-f%e.framesize)<576&&(o+=e.framesize),e.encoder_padding=o,l=(f+o)/e.framesize;l>0&&h>=0;){var _=d-u.mf_size,p=e.frameNum;_*=e.in_samplerate,(_/=e.out_samplerate)>1152&&(_=1152),_<1&&(_=1),s=i-n,0==i&&(s=0),r+=h=this.lame_encode_buffer(e,c[0],c[1],_,t,r,s),n+=h,l-=p!=e.frameNum?1:0}if(u.mf_samples_to_encode=0,h<0)return h;if(s=i-n,0==i&&(s=0),g.flush_bitstream(e),(h=g.copy_buffer(u,t,r,s,1))<0)return h;if(r+=h,s=i-(n+=h),0==i&&(s=0),e.write_id3tag_automatic){if(w.id3tag_write_v1(e),(h=g.copy_buffer(u,t,r,s,0))<0)return h;n+=h}return n},this.lame_encode_buffer=function(e,t,r,i,s,a,l){var u=e.internal_flags,h=[null,null];if(u.Class_ID!=P)return-3;if(0==i)return 0;!function(e,t){(null==e.in_buffer_0||e.in_buffer_nsamples<t)&&(e.in_buffer_0=n(t),e.in_buffer_1=n(t),e.in_buffer_nsamples=t)}(u,i),h[0]=u.in_buffer_0,h[1]=u.in_buffer_1;for(var f=0;f<i;f++)h[0][f]=t[f],u.channels_in>1&&(h[1][f]=r[f]);return function(e,t,r,i,n,s,a){var l,u,h,f,d,p=e.internal_flags,b=0,E=[null,null],S=[null,null];if(p.Class_ID!=P)return-3;if(0==i)return 0;if(d=g.copy_buffer(p,n,s,a,0),d<0)return d;if(s+=d,b+=d,S[0]=t,S[1]=r,_.NEQ(e.scale,0)&&_.NEQ(e.scale,1))for(u=0;u<i;++u)S[0][u]*=e.scale,2==p.channels_out&&(S[1][u]*=e.scale);if(_.NEQ(e.scale_left,0)&&_.NEQ(e.scale_left,1))for(u=0;u<i;++u)S[0][u]*=e.scale_left;if(_.NEQ(e.scale_right,0)&&_.NEQ(e.scale_right,1))for(u=0;u<i;++u)S[1][u]*=e.scale_right;if(2==e.num_channels&&1==p.channels_out)for(u=0;u<i;++u)S[0][u]=.5*(S[0][u]+S[1][u]),S[1][u]=0;f=D(e),E[0]=p.mfbuf[0],E[1]=p.mfbuf[1];var y=0;for(;i>0;){var A=[null,null],w=0,R=0;A[0]=S[0],A[1]=S[1];var M=new L;if(j(e,E,A,y,i,M),w=M.n_in,R=M.n_out,p.findReplayGain&&!p.decode_on_the_fly&&v.AnalyzeSamples(p.rgdata,E[0],p.mf_size,E[1],p.mf_size,R,p.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(i-=w,y+=w,p.channels_out,p.mf_size+=R,o(p.mf_size<=c.MFSIZE),p.mf_samples_to_encode<1&&(p.mf_samples_to_encode=m.ENCDELAY+m.POSTDELAY),p.mf_samples_to_encode+=R,p.mf_size>=f){var B=a-b;if(0==a&&(B=0),(l=F(e,E[0],E[1],n,s,B))<0)return l;for(s+=l,b+=l,p.mf_size-=e.framesize,p.mf_samples_to_encode-=e.framesize,h=0;h<p.channels_out;h++)for(u=0;u<p.mf_size;u++)E[h][u]=E[h][u+e.framesize]}}return o(0==i),b}(e,h[0],h[1],i,s,a,l)}},Ji}function Fn(){if(rn)return tn;rn=1;var e=Sn();e.System;var t=e.VbrMode;return e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n,e.new_byte,e.new_double,e.new_float,e.new_float_n,e.new_int,e.new_int_n,e.assert,tn=function(){function e(e,t,r,i,n,s,a,o,l,u,c,h,f,d,_){this.vbr_q=e,this.quant_comp=t,this.quant_comp_s=r,this.expY=i,this.st_lrm=n,this.st_s=s,this.masking_adj=a,this.masking_adj_short=o,this.ath_lower=l,this.ath_curve=u,this.ath_sensitivity=c,this.interch=h,this.safejoint=f,this.sfb21mod=d,this.msfix=_}function r(e,t,r,i,n,s,a,o,l,u,c,h,f,d){this.quant_comp=t,this.quant_comp_s=r,this.safejoint=i,this.nsmsfix=n,this.st_lrm=s,this.st_s=a,this.nsbass=o,this.scale=l,this.masking_adj=u,this.ath_lower=c,this.ath_curve=h,this.interch=f,this.sfscale=d}var i;this.setModules=function(e){i=e};var n=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],s=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function a(e,r,i){var a=e.VBR==t.vbr_rh?n:s,o=e.VBR_q_frac,l=a[r],u=a[r+1],c=l;l.st_lrm=l.st_lrm+o*(u.st_lrm-l.st_lrm),l.st_s=l.st_s+o*(u.st_s-l.st_s),l.masking_adj=l.masking_adj+o*(u.masking_adj-l.masking_adj),l.masking_adj_short=l.masking_adj_short+o*(u.masking_adj_short-l.masking_adj_short),l.ath_lower=l.ath_lower+o*(u.ath_lower-l.ath_lower),l.ath_curve=l.ath_curve+o*(u.ath_curve-l.ath_curve),l.ath_sensitivity=l.ath_sensitivity+o*(u.ath_sensitivity-l.ath_sensitivity),l.interch=l.interch+o*(u.interch-l.interch),l.msfix=l.msfix+o*(u.msfix-l.msfix),function(e,t){var r=0;0>t&&(r=-1,t=0);9<t&&(r=-1,t=9);e.VBR_q=t,e.VBR_q_frac=0}(e,c.vbr_q),0!=i?e.quant_comp=c.quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=c.quant_comp),0!=i?e.quant_comp_short=c.quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=c.quant_comp_s),0!=c.expY&&(e.experimentalY=0!=c.expY),0!=i?e.internal_flags.nsPsy.attackthre=c.st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=c.st_lrm),0!=i?e.internal_flags.nsPsy.attackthre_s=c.st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=c.st_s),0!=i?e.maskingadjust=c.masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=c.masking_adj),0!=i?e.maskingadjust_short=c.masking_adj_short:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=c.masking_adj_short),0!=i?e.ATHlower=-c.ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-c.ath_lower/10),0!=i?e.ATHcurve=c.ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=c.ath_curve),0!=i?e.athaa_sensitivity=c.ath_sensitivity:Math.abs(e.athaa_sensitivity- -1)>0||(e.athaa_sensitivity=c.ath_sensitivity),c.interch>0&&(0!=i?e.interChRatio=c.interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=c.interch)),c.safejoint>0&&(e.exp_nspsytune=e.exp_nspsytune|c.safejoint),c.sfb21mod>0&&(e.exp_nspsytune=e.exp_nspsytune|c.sfb21mod<<20),0!=i?e.msfix=c.msfix:Math.abs(e.msfix- -1)>0||(e.msfix=c.msfix),0==i&&(e.VBR_q=r,e.VBR_q_frac=o)}var o=[new r(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new r(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new r(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new r(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new r(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new r(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new r(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new r(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new r(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new r(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new r(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new r(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new r(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new r(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new r(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new r(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new r(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function l(e,r,n){var s=r,a=i.nearestBitrateFullIndex(r);if(e.VBR=t.vbr_abr,e.VBR_mean_bitrate_kbps=s,e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320),e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.brate=e.VBR_mean_bitrate_kbps,e.VBR_mean_bitrate_kbps>320&&(e.disable_reservoir=!0),o[a].safejoint>0&&(e.exp_nspsytune=2|e.exp_nspsytune),o[a].sfscale>0&&(e.internal_flags.noise_shaping=2),Math.abs(o[a].nsbass)>0){var l=int(4*o[a].nsbass);l<0&&(l+=64),e.exp_nspsytune=e.exp_nspsytune|l<<2}return 0!=n?e.quant_comp=o[a].quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=o[a].quant_comp),0!=n?e.quant_comp_short=o[a].quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=o[a].quant_comp_s),0!=n?e.msfix=o[a].nsmsfix:Math.abs(e.msfix- -1)>0||(e.msfix=o[a].nsmsfix),0!=n?e.internal_flags.nsPsy.attackthre=o[a].st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=o[a].st_lrm),0!=n?e.internal_flags.nsPsy.attackthre_s=o[a].st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=o[a].st_s),0!=n?e.scale=o[a].scale:Math.abs(e.scale- -1)>0||(e.scale=o[a].scale),0!=n?e.maskingadjust=o[a].masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=o[a].masking_adj),o[a].masking_adj>0?0!=n?e.maskingadjust_short=.9*o[a].masking_adj:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=.9*o[a].masking_adj):0!=n?e.maskingadjust_short=1.1*o[a].masking_adj:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=1.1*o[a].masking_adj),0!=n?e.ATHlower=-o[a].ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-o[a].ath_lower/10),0!=n?e.ATHcurve=o[a].ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=o[a].ath_curve),0!=n?e.interChRatio=o[a].interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=o[a].interch),r}this.apply_preset=function(e,r,i){switch(r){case Lame.R3MIX:r=Lame.V3,e.VBR=t.vbr_mtrh;break;case Lame.MEDIUM:r=Lame.V4,e.VBR=t.vbr_rh;break;case Lame.MEDIUM_FAST:r=Lame.V4,e.VBR=t.vbr_mtrh;break;case Lame.STANDARD:r=Lame.V2,e.VBR=t.vbr_rh;break;case Lame.STANDARD_FAST:r=Lame.V2,e.VBR=t.vbr_mtrh;break;case Lame.EXTREME:r=Lame.V0,e.VBR=t.vbr_rh;break;case Lame.EXTREME_FAST:r=Lame.V0,e.VBR=t.vbr_mtrh;break;case Lame.INSANE:return r=320,e.preset=r,l(e,r,i),e.VBR=t.vbr_off,r}switch(e.preset=r,r){case Lame.V9:return a(e,9,i),r;case Lame.V8:return a(e,8,i),r;case Lame.V7:return a(e,7,i),r;case Lame.V6:return a(e,6,i),r;case Lame.V5:return a(e,5,i),r;case Lame.V4:return a(e,4,i),r;case Lame.V3:return a(e,3,i),r;case Lame.V2:return a(e,2,i),r;case Lame.V1:return a(e,1,i),r;case Lame.V0:return a(e,0,i),r}return 8<=r&&r<=320?l(e,r,i):(e.preset=0,r)}},tn}function Ln(){if(hn)return cn;hn=1;var e=Sn(),t=e.System,r=e.VbrMode;e.Float,e.ShortBlock;var i=e.Util,n=e.Arrays;e.new_array_n,e.new_byte,e.new_double;var s=e.new_float;e.new_float_n,e.new_int,e.new_int_n;var a=e.assert,o=sn?nn:(sn=1,nn=function(){this.setModules=function(e,t){}}),l=on?an:(on=1,an=function(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}),u=function(){if(un)return ln;un=1;var e=Sn(),t=e.new_float,r=e.new_int;return e.assert,ln=function(){this.global_gain=0,this.sfb_count1=0,this.step=r(39),this.noise=t(39),this.noise_log=t(39)}}(),c=An(),h=Bn(),f=Mn();return cn=function(){var e,d,_;this.rv=null,this.qupvt=null;var p,m=new o;function v(e){this.ordinal=e}function g(e){for(var t=0;t<e.sfbmax;t++)if(e.scalefac[t]+e.subblock_gain[e.window[t]]==0)return!1;return!0}function b(e,t,r,n,s){var a;switch(e){default:case 9:t.over_count>0?(a=r.over_SSD<=t.over_SSD,r.over_SSD==t.over_SSD&&(a=r.bits<t.bits)):a=r.max_noise<0&&10*r.max_noise+r.bits<=10*t.max_noise+t.bits;break;case 0:a=r.over_count<t.over_count||r.over_count==t.over_count&&r.over_noise<t.over_noise||r.over_count==t.over_count&&BitStream.EQ(r.over_noise,t.over_noise)&&r.tot_noise<t.tot_noise;break;case 8:r.max_noise=function(e,t){for(var r,n=1e-37,s=0;s<t.psymax;s++)n+=(r=e[s],i.FAST_LOG10(.368+.632*r*r*r));return Math.max(1e-20,n)}(s,n);case 1:a=r.max_noise<t.max_noise;break;case 2:a=r.tot_noise<t.tot_noise;break;case 3:a=r.tot_noise<t.tot_noise&&r.max_noise<t.max_noise;break;case 4:a=r.max_noise<=0&&t.max_noise>.2||r.max_noise<=0&&t.max_noise<0&&t.max_noise>r.max_noise-.2&&r.tot_noise<t.tot_noise||r.max_noise<=0&&t.max_noise>0&&t.max_noise>r.max_noise-.2&&r.tot_noise<t.tot_noise+t.over_noise||r.max_noise>0&&t.max_noise>-.05&&t.max_noise>r.max_noise-.1&&r.tot_noise+r.over_noise<t.tot_noise+t.over_noise||r.max_noise>0&&t.max_noise>-.1&&t.max_noise>r.max_noise-.15&&r.tot_noise+r.over_noise+r.over_noise<t.tot_noise+t.over_noise+t.over_noise;break;case 5:a=r.over_noise<t.over_noise||BitStream.EQ(r.over_noise,t.over_noise)&&r.tot_noise<t.tot_noise;break;case 6:a=r.over_noise<t.over_noise||BitStream.EQ(r.over_noise,t.over_noise)&&(r.max_noise<t.max_noise||BitStream.EQ(r.max_noise,t.max_noise)&&r.tot_noise<=t.tot_noise);break;case 7:a=r.over_count<t.over_count||r.over_noise<t.over_noise}return 0==t.over_count&&(a=a&&r.bits<t.bits),a}function E(e,t,r,i,s){var o=e.internal_flags;!function(e,t,r,i,n){var s,a=e.internal_flags;s=0==t.scalefac_scale?1.2968395546510096:1.6817928305074292;for(var o=0,l=0;l<t.sfbmax;l++)o<r[l]&&(o=r[l]);var u=a.noise_shaping_amp;switch(3==u&&(u=n?2:1),u){case 2:break;case 1:o>1?o=Math.pow(o,.5):o*=.95;break;default:o>1?o=1:o*=.95}var c=0;for(l=0;l<t.sfbmax;l++){var h,f=t.width[l];if(c+=f,!(r[l]<o)){if(2&a.substep_shaping&&(a.pseudohalf[l]=0==a.pseudohalf[l]?1:0,0==a.pseudohalf[l]&&2==a.noise_shaping_amp))return;for(t.scalefac[l]++,h=-f;h<0;h++)i[c+h]*=s,i[c+h]>t.xrpow_max&&(t.xrpow_max=i[c+h]);if(2==a.noise_shaping_amp)return}}}(e,t,r,i,s);var l=g(t);return!l&&(!(l=2==o.mode_gr?p.scale_bitcount(t):p.scale_bitcount_lsf(o,t))||(o.noise_shaping>1&&(n.fill(o.pseudohalf,0),0==t.scalefac_scale?(!function(e,t){for(var r=0,i=0;i<e.sfbmax;i++){var n=e.width[i],s=e.scalefac[i];if(0!=e.preflag&&(s+=_.pretab[i]),r+=n,1&s){s++;for(var a=-n;a<0;a++)t[r+a]*=1.2968395546510096,t[r+a]>e.xrpow_max&&(e.xrpow_max=t[r+a])}e.scalefac[i]=s>>1}e.preflag=0,e.scalefac_scale=1}(t,i),l=!1):t.block_type==c.SHORT_TYPE&&o.subblock_gain>0&&(l=function(e,t,r){var i,n=t.scalefac;for(i=0;i<t.sfb_lmax;i++)if(n[i]>=16)return!0;for(var s=0;s<3;s++){var o=0,l=0;for(i=t.sfb_lmax+s;i<t.sfbdivide;i+=3)o<n[i]&&(o=n[i]);for(;i<t.sfbmax;i+=3)l<n[i]&&(l=n[i]);if(!(o<16&&l<8)){if(t.subblock_gain[s]>=7)return!0;t.subblock_gain[s]++;var u=e.scalefac_band.l[t.sfb_lmax];for(i=t.sfb_lmax+s;i<t.sfbmax;i+=3){var c=t.width[i],h=n[i];if(a(h>=0),(h-=4>>t.scalefac_scale)>=0)n[i]=h,u+=3*c;else{n[i]=0;var f=210+(h<<t.scalefac_scale+1);p=_.IPOW20(f),u+=c*(s+1);for(var d=-c;d<0;d++)r[u+d]*=p,r[u+d]>t.xrpow_max&&(t.xrpow_max=r[u+d]);u+=c*(3-s-1)}}var p=_.IPOW20(202);for(u+=t.width[i]*(s+1),d=-t.width[i];d<0;d++)r[u+d]*=p,r[u+d]>t.xrpow_max&&(t.xrpow_max=r[u+d])}}return!1}(o,t,i)||g(t))),l||(l=2==o.mode_gr?p.scale_bitcount(t):p.scale_bitcount_lsf(o,t)),!l))}this.setModules=function(t,r,i,n){e=t,d=r,this.rv=r,_=i,this.qupvt=i,p=n,m.setModules(_,p)},this.ms_convert=function(e,t){for(var r=0;r<576;++r){var n=e.tt[t][0].xr[r],s=e.tt[t][1].xr[r];e.tt[t][0].xr[r]=(n+s)*(.5*i.SQRT2),e.tt[t][1].xr[r]=(n-s)*(.5*i.SQRT2)}},this.init_xrpow=function(e,t,r){var i=0,s=0|t.max_nonzero_coeff;if(a(null!=r),t.xrpow_max=0,a(0<=s&&s<=575),n.fill(r,s,576,0),i=function(e,t,r,i){i=0;for(var n=0;n<=r;++n){var s=Math.abs(e.xr[n]);i+=s,t[n]=Math.sqrt(s*Math.sqrt(s)),t[n]>e.xrpow_max&&(e.xrpow_max=t[n])}return i}(t,r,s,i),i>1e-20){var o=0;2&e.substep_shaping&&(o=1);for(var l=0;l<t.psymax;l++)e.pseudohalf[l]=o;return!0}return n.fill(t.l3_enc,0,576,0),!1},this.init_outer_loop=function(e,r){r.part2_3_length=0,r.big_values=0,r.count1=0,r.global_gain=210,r.scalefac_compress=0,r.table_select[0]=0,r.table_select[1]=0,r.table_select[2]=0,r.subblock_gain[0]=0,r.subblock_gain[1]=0,r.subblock_gain[2]=0,r.subblock_gain[3]=0,r.region0_count=0,r.region1_count=0,r.preflag=0,r.scalefac_scale=0,r.count1table_select=0,r.part2_length=0,r.sfb_lmax=c.SBPSY_l,r.sfb_smin=c.SBPSY_s,r.psy_lmax=e.sfb21_extra?c.SBMAX_l:c.SBPSY_l,r.psymax=r.psy_lmax,r.sfbmax=r.sfb_lmax,r.sfbdivide=11;for(var i=0;i<c.SBMAX_l;i++)r.width[i]=e.scalefac_band.l[i+1]-e.scalefac_band.l[i],r.window[i]=3;if(r.block_type==c.SHORT_TYPE){var a=s(576);r.sfb_smin=0,r.sfb_lmax=0,0!=r.mixed_block_flag&&(r.sfb_smin=3,r.sfb_lmax=2*e.mode_gr+4),r.psymax=r.sfb_lmax+3*((e.sfb21_extra?c.SBMAX_s:c.SBPSY_s)-r.sfb_smin),r.sfbmax=r.sfb_lmax+3*(c.SBPSY_s-r.sfb_smin),r.sfbdivide=r.sfbmax-18,r.psy_lmax=r.sfb_lmax;var o=e.scalefac_band.l[r.sfb_lmax];t.arraycopy(r.xr,0,a,0,576);for(i=r.sfb_smin;i<c.SBMAX_s;i++)for(var l=e.scalefac_band.s[i],u=e.scalefac_band.s[i+1],h=0;h<3;h++)for(var f=l;f<u;f++)r.xr[o++]=a[3*f+h];var d=r.sfb_lmax;for(i=r.sfb_smin;i<c.SBMAX_s;i++)r.width[d]=r.width[d+1]=r.width[d+2]=e.scalefac_band.s[i+1]-e.scalefac_band.s[i],r.window[d]=0,r.window[d+1]=1,r.window[d+2]=2,d+=3}r.count1bits=0,r.sfb_partition_table=_.nr_of_sfb_block[0][0],r.slen[0]=0,r.slen[1]=0,r.slen[2]=0,r.slen[3]=0,r.max_nonzero_coeff=575,n.fill(r.scalefac,0),function(e,t){var r=e.ATH,i=t.xr;if(t.block_type!=c.SHORT_TYPE)for(var n=!1,s=c.PSFB21-1;s>=0&&!n;s--){var a=e.scalefac_band.psfb21[s],o=e.scalefac_band.psfb21[s+1],l=_.athAdjust(r.adjust,r.psfb21[s],r.floor);e.nsPsy.longfact[21]>1e-12&&(l*=e.nsPsy.longfact[21]);for(var u=o-1;u>=a;u--){if(!(Math.abs(i[u])<l)){n=!0;break}i[u]=0}}else for(var h=0;h<3;h++)for(n=!1,s=c.PSFB12-1;s>=0&&!n;s--){o=(a=3*e.scalefac_band.s[12]+(e.scalefac_band.s[13]-e.scalefac_band.s[12])*h+(e.scalefac_band.psfb12[s]-e.scalefac_band.psfb12[0]))+(e.scalefac_band.psfb12[s+1]-e.scalefac_band.psfb12[s]);var f=_.athAdjust(r.adjust,r.psfb12[s],r.floor);for(e.nsPsy.shortfact[12]>1e-12&&(f*=e.nsPsy.shortfact[12]),u=o-1;u>=a;u--){if(!(Math.abs(i[u])<f)){n=!0;break}i[u]=0}}}(e,r)},v.BINSEARCH_NONE=new v(0),v.BINSEARCH_UP=new v(1),v.BINSEARCH_DOWN=new v(2),this.trancate_smallspectrums=function(e,t,r,i){var a=s(f.SFBMAX);if((4&e.substep_shaping||t.block_type!=c.SHORT_TYPE)&&!(128&e.substep_shaping)){_.calc_noise(t,r,a,new l,null);for(var o=0;o<576;o++){var u=0;0!=t.l3_enc[o]&&(u=Math.abs(t.xr[o])),i[o]=u}o=0;var h=8;t.block_type==c.SHORT_TYPE&&(h=6);do{var d,m,v,g,b=t.width[h];if(o+=b,!(a[h]>=1||(n.sort(i,o-b,b),BitStream.EQ(i[o-1],0)))){d=(1-a[h])*r[h],m=0,g=0;do{var E;for(v=1;g+v<b&&!BitStream.NEQ(i[g+o-b],i[g+o+v-b]);v++);if(d<(E=i[g+o-b]*i[g+o-b]*v)){0!=g&&(m=i[g+o-b-1]);break}d-=E,g+=v}while(g<b);if(!BitStream.EQ(m,0))do{Math.abs(t.xr[o-b])<=m&&(t.l3_enc[o-b]=0)}while(--b>0)}}while(++h<t.psymax);t.part2_3_length=p.noquant_count_bits(e,t,null)}},this.outer_loop=function(e,i,n,o,d,m){var g=e.internal_flags,S=new h,y=s(576),A=s(f.SFBMAX),w=new l,R=new u,M=9999999,B=!1,T=!1,I=0;if(function(e,t,r,i,n){var s,o=e.CurrentStep[i],l=!1,u=e.OldValue[i],c=v.BINSEARCH_NONE;for(t.global_gain=u,r-=t.part2_length,a(0!=o);;){var h;if(s=p.count_bits(e,n,t,null),1==o||s==r)break;s>r?(c==v.BINSEARCH_DOWN&&(l=!0),l&&(o/=2),c=v.BINSEARCH_UP,h=o):(c==v.BINSEARCH_UP&&(l=!0),l&&(o/=2),c=v.BINSEARCH_DOWN,h=-o),t.global_gain+=h,t.global_gain<0&&(t.global_gain=0,l=!0),t.global_gain>255&&(t.global_gain=255,l=!0)}for(a(t.global_gain>=0),a(t.global_gain<256);s>r&&t.global_gain<255;)t.global_gain++,s=p.count_bits(e,n,t,null);e.CurrentStep[i]=u-t.global_gain>=4?4:2,e.OldValue[i]=t.global_gain,t.part2_3_length=s}(g,i,m,d,o),0==g.noise_shaping)return 100;_.calc_noise(i,n,A,w,R),w.bits=i.part2_3_length,S.assign(i);var P=0;for(t.arraycopy(o,0,y,0,576);!B;){do{var x,k=new l,N=255;if(x=2&g.substep_shaping?20:3,g.sfb21_extra){if(A[S.sfbmax]>1)break;if(S.block_type==c.SHORT_TYPE&&(A[S.sfbmax+1]>1||A[S.sfbmax+2]>1))break}if(!E(e,S,A,o,T))break;0!=S.scalefac_scale&&(N=254);var C=m-S.part2_length;if(C<=0)break;for(;(S.part2_3_length=p.count_bits(g,o,S,R))>C&&S.global_gain<=N;)S.global_gain++;if(S.global_gain>N)break;if(0==w.over_count){for(;(S.part2_3_length=p.count_bits(g,o,S,R))>M&&S.global_gain<=N;)S.global_gain++;if(S.global_gain>N)break}if(_.calc_noise(S,n,A,k,R),k.bits=S.part2_3_length,0!=(b(i.block_type!=c.SHORT_TYPE?e.quant_comp:e.quant_comp_short,w,k,S,A)?1:0))M=i.part2_3_length,w=k,i.assign(S),P=0,t.arraycopy(o,0,y,0,576);else if(0==g.full_outer_loop){if(++P>x&&0==w.over_count)break;if(3==g.noise_shaping_amp&&T&&P>30)break;if(3==g.noise_shaping_amp&&T&&S.global_gain-I>15)break}}while(S.global_gain+S.scalefac_scale<255);3==g.noise_shaping_amp?T?B=!0:(S.assign(i),t.arraycopy(y,0,o,0,576),P=0,I=S.global_gain,T=!0):B=!0}return a(i.global_gain+i.scalefac_scale<=255),e.VBR==r.vbr_rh||e.VBR==r.vbr_mtrh?t.arraycopy(y,0,o,0,576):1&g.substep_shaping&&trancate_smallspectrums(g,i,n,o),w.over_count},this.iteration_finish_one=function(e,t,r){var i=e.l3_side,n=i.tt[t][r];p.best_scalefac_store(e,t,r,i),1==e.use_best_huffman&&p.best_huffman_divide(e,n),d.ResvAdjust(e,n)},this.VBR_encode_granule=function(e,r,i,o,l,u,c){var f,d=e.internal_flags,_=new h,p=s(576),m=c,v=c+1,g=(c+u)/2,b=0,E=d.sfb21_extra;a(m<=LameInternalFlags.MAX_BITS_PER_CHANNEL),n.fill(_.l3_enc,0);do{a(g>=u),a(g<=c),a(u<=c),d.sfb21_extra=!(g>m-42)&&E,outer_loop(e,r,i,o,l,g)<=0?(b=1,v=r.part2_3_length,_.assign(r),t.arraycopy(o,0,p,0,576),f=(c=v-32)-u,g=(c+u)/2):(f=c-(u=g+32),g=(c+u)/2,0!=b&&(b=2,r.assign(_),t.arraycopy(p,0,o,0,576)))}while(f>12);d.sfb21_extra=E,2==b&&t.arraycopy(_.l3_enc,0,r.l3_enc,0,576),a(r.part2_3_length<=m)},this.get_framebits=function(t,r){var i=t.internal_flags;i.bitrate_index=i.VBR_min_bitrate;var n=e.getframebits(t);i.bitrate_index=1,n=e.getframebits(t);for(var s=1;s<=i.VBR_max_bitrate;s++){i.bitrate_index=s;var a=new MeanBits(n);r[s]=d.ResvFrameBegin(t,a),n=a.bits}},this.VBR_old_prepare=function(e,t,r,i,n,s,a,o,l){var u,h=e.internal_flags,f=0,p=1,m=0;h.bitrate_index=h.VBR_max_bitrate;var v=d.ResvFrameBegin(e,new MeanBits(0))/h.mode_gr;get_framebits(e,s);for(var g=0;g<h.mode_gr;g++){var b=_.on_pe(e,t,o[g],v,g,0);h.mode_ext==c.MPG_MD_MS_LR&&(ms_convert(h.l3_side,g),_.reduce_side(o[g],r[g],v,b));for(var E=0;E<h.channels_out;++E){var S=h.l3_side.tt[g][E];S.block_type!=c.SHORT_TYPE?(f=1.28/(1+Math.exp(3.5-t[g][E]/300))-.05,u=h.PSY.mask_adjust-f):(f=2.56/(1+Math.exp(3.5-t[g][E]/300))-.14,u=h.PSY.mask_adjust_short-f),h.masking_lower=Math.pow(10,.1*u),init_outer_loop(h,S),l[g][E]=_.calc_xmin(e,i[g][E],S,n[g][E]),0!=l[g][E]&&(p=0),a[g][E]=126,m+=o[g][E]}}for(g=0;g<h.mode_gr;g++)for(E=0;E<h.channels_out;E++)m>s[h.VBR_max_bitrate]&&(o[g][E]*=s[h.VBR_max_bitrate],o[g][E]/=m),a[g][E]>o[g][E]&&(a[g][E]=o[g][E]);return p},this.bitpressure_strategy=function(e,t,r,i){for(var n=0;n<e.mode_gr;n++)for(var s=0;s<e.channels_out;s++){for(var a=e.l3_side.tt[n][s],o=t[n][s],l=0,u=0;u<a.psy_lmax;u++)o[l++]*=1+.029*u*u/c.SBMAX_l/c.SBMAX_l;if(a.block_type==c.SHORT_TYPE)for(u=a.sfb_smin;u<c.SBMAX_s;u++)o[l++]*=1+.029*u*u/c.SBMAX_s/c.SBMAX_s,o[l++]*=1+.029*u*u/c.SBMAX_s/c.SBMAX_s,o[l++]*=1+.029*u*u/c.SBMAX_s/c.SBMAX_s;i[n][s]=0|Math.max(r[n][s],.9*i[n][s])}},this.VBR_new_prepare=function(e,t,r,i,n,s){var a,o=e.internal_flags,l=1,u=0,h=0;if(e.free_format){o.bitrate_index=0;f=new MeanBits(u);a=d.ResvFrameBegin(e,f),u=f.bits,n[0]=a}else{o.bitrate_index=o.VBR_max_bitrate;var f=new MeanBits(u);d.ResvFrameBegin(e,f),u=f.bits,get_framebits(e,n),a=n[o.VBR_max_bitrate]}for(var p=0;p<o.mode_gr;p++){_.on_pe(e,t,s[p],u,p,0),o.mode_ext==c.MPG_MD_MS_LR&&ms_convert(o.l3_side,p);for(var m=0;m<o.channels_out;++m){var v=o.l3_side.tt[p][m];o.masking_lower=Math.pow(10,.1*o.PSY.mask_adjust),init_outer_loop(o,v),0!=_.calc_xmin(e,r[p][m],v,i[p][m])&&(l=0),h+=s[p][m]}}for(p=0;p<o.mode_gr;p++)for(m=0;m<o.channels_out;m++)h>a&&(s[p][m]*=a,s[p][m]/=h);return l},this.calc_target_bits=function(t,r,i,n,s,a){var o,l,u,h,f=t.internal_flags,p=f.l3_side,m=0;f.bitrate_index=f.VBR_max_bitrate;var v=new MeanBits(m);for(a[0]=d.ResvFrameBegin(t,v),m=v.bits,f.bitrate_index=1,m=e.getframebits(t)-8*f.sideinfo_len,s[0]=m/(f.mode_gr*f.channels_out),m=t.VBR_mean_bitrate_kbps*t.framesize*1e3,1&f.substep_shaping&&(m*=1.09),m/=t.out_samplerate,m-=8*f.sideinfo_len,m/=f.mode_gr*f.channels_out,(o=.93+.07*(11-t.compression_ratio)/5.5)<.9&&(o=.9),o>1&&(o=1),l=0;l<f.mode_gr;l++){var g=0;for(u=0;u<f.channels_out;u++){if(n[l][u]=int(o*m),r[l][u]>700){var b=int((r[l][u]-700)/1.4),E=p.tt[l][u];n[l][u]=int(o*m),E.block_type==c.SHORT_TYPE&&b<m/2&&(b=m/2),b>3*m/2?b=3*m/2:b<0&&(b=0),n[l][u]+=b}n[l][u]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(n[l][u]=LameInternalFlags.MAX_BITS_PER_CHANNEL),g+=n[l][u]}if(g>LameInternalFlags.MAX_BITS_PER_GRANULE)for(u=0;u<f.channels_out;++u)n[l][u]*=LameInternalFlags.MAX_BITS_PER_GRANULE,n[l][u]/=g}if(f.mode_ext==c.MPG_MD_MS_LR)for(l=0;l<f.mode_gr;l++)_.reduce_side(n[l],i[l],m*f.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(h=0,l=0;l<f.mode_gr;l++)for(u=0;u<f.channels_out;u++)n[l][u]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(n[l][u]=LameInternalFlags.MAX_BITS_PER_CHANNEL),h+=n[l][u];if(h>a[0])for(l=0;l<f.mode_gr;l++)for(u=0;u<f.channels_out;u++)n[l][u]*=a[0],n[l][u]/=h}},cn}function Vn(){if(vn)return mn;vn=1;var e=Sn(),t=e.System,r=e.VbrMode;e.Float;var i=e.ShortBlock;e.Util;var n=e.Arrays;e.new_array_n;var s=e.new_byte;e.new_double,e.new_float,e.new_float_n,e.new_int,e.new_int_n;var a=e.assert;function o(){var e,l,u;this.setModules=function(t,r,i){e=t,l=r,u=i};var c=o.NUMTOCENTRIES,h=o.MAXFRAMESIZE,f=c+4+4+4+4+4+9+1+1+8+1+1+3+1+1+2+4+2+2,d="Xing",_="Info",p=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function m(e,t){var r=255&e[t+0];return r<<=8,r|=255&e[t+1],r<<=8,r|=255&e[t+2],r<<=8,r|=255&e[t+3]}function v(e,t,r){e[t+0]=255&r>>24,e[t+1]=255&r>>16,e[t+2]=255&r>>8,e[t+3]=255&r}function g(e,t,r){e[t+0]=255&r>>8,e[t+1]=255&r}function b(e,t,r){return 255&(e<<t|r&~(-1<<t))}function E(t,i){var n=t.internal_flags;i[0]=b(i[0],8,255),i[1]=b(i[1],3,7),i[1]=b(i[1],1,t.out_samplerate<16e3?0:1),i[1]=b(i[1],1,t.version),i[1]=b(i[1],2,1),i[1]=b(i[1],1,t.error_protection?0:1),i[2]=b(i[2],4,n.bitrate_index),i[2]=b(i[2],2,n.samplerate_index),i[2]=b(i[2],1,0),i[2]=b(i[2],1,t.extension),i[3]=b(i[3],2,t.mode.ordinal()),i[3]=b(i[3],2,n.mode_ext),i[3]=b(i[3],1,t.copyright),i[3]=b(i[3],1,t.original),i[3]=b(i[3],2,t.emphasis),i[0]=255;var s,a,o=241&i[1];s=1==t.version?128:t.out_samplerate<16e3?32:64,t.VBR==r.vbr_off&&(s=t.brate),a=t.free_format?0:255&16*e.BitrateIndex(s,t.version,t.out_samplerate),1==t.version?(i[1]=255&o|10,o=13&i[2],i[2]=255&(a|o)):(i[1]=255&o|2,o=13&i[2],i[2]=255&(a|o))}function S(e,t){return t=t>>8^p[255&(t^e)]}this.addVbrFrame=function(e){var t=e.internal_flags,r=Tables.bitrate_table[e.version][t.bitrate_index];a(null!=t.VBR_seek_table.bag),function(e,t){if(e.nVbrNumFrames++,e.sum+=t,e.seen++,!(e.seen<e.want)&&(e.pos<e.size&&(e.bag[e.pos]=e.sum,e.pos++,e.seen=0),e.pos==e.size)){for(var r=1;r<e.size;r+=2)e.bag[r/2]=e.bag[r];e.want*=2,e.pos/=2}}(t.VBR_seek_table,r)},this.getVbrTag=function(e){var t=new VBRTagData,r=0;t.flags=0;var i=e[r+1]>>3&1,n=e[r+2]>>2&3,s=e[r+3]>>6&3,a=e[r+2]>>4&15;if(a=Tables.bitrate_table[i][a],e[r+1]>>4==14?t.samprate=Tables.samplerate_table[2][n]:t.samprate=Tables.samplerate_table[i][n],!function(e,t){return new String(e,t,4(),null).equals(d)||new String(e,t,4(),null).equals(_)}(e,r+=0!=i?3!=s?36:21:3!=s?21:13))return null;r+=4,t.hId=i;var o=t.flags=m(e,r);if(r+=4,1&o&&(t.frames=m(e,r),r+=4),2&o&&(t.bytes=m(e,r),r+=4),4&o){if(null!=t.toc)for(var l=0;l<c;l++)t.toc[l]=e[r+l];r+=c}t.vbrScale=-1,8&o&&(t.vbrScale=m(e,r),r+=4),t.headersize=72e3*(i+1)*a/t.samprate;var u=e[(r+=21)+0]<<4;u+=e[r+1]>>4;var h=(15&e[r+1])<<8;return(u<0||u>3e3)&&(u=-1),((h+=255&e[r+2])<0||h>3e3)&&(h=-1),t.encDelay=u,t.encPadding=h,t},this.InitVbrTag=function(e){var t,i=e.internal_flags;t=1==e.version?128:e.out_samplerate<16e3?32:64,e.VBR==r.vbr_off&&(t=e.brate);var n=72e3*(e.version+1)*t/e.out_samplerate,a=i.sideinfo_len+f;if(i.VBR_seek_table.TotalFrameSize=n,n<a||n>h)e.bWriteVbrTag=!1;else{i.VBR_seek_table.nVbrNumFrames=0,i.VBR_seek_table.nBytesWritten=0,i.VBR_seek_table.sum=0,i.VBR_seek_table.seen=0,i.VBR_seek_table.want=1,i.VBR_seek_table.pos=0,null==i.VBR_seek_table.bag&&(i.VBR_seek_table.bag=new int[400],i.VBR_seek_table.size=400);var o=s(h);E(e,o);for(var u=i.VBR_seek_table.TotalFrameSize,c=0;c<u;++c)l.add_dummy_byte(e,255&o[c],1)}},this.updateMusicCRC=function(e,t,r,i){for(var n=0;n<i;++n)e[0]=S(t[r+n],e[0])},this.getLameTagFrame=function(e,a){var o=e.internal_flags;if(!e.bWriteVbrTag)return 0;if(o.Class_ID!=Lame.LAME_ID)return 0;if(o.VBR_seek_table.pos<=0)return 0;if(a.length<o.VBR_seek_table.TotalFrameSize)return o.VBR_seek_table.TotalFrameSize;n.fill(a,0,o.VBR_seek_table.TotalFrameSize,0),E(e,a);var h=s(c);if(e.free_format)for(var f=1;f<c;++f)h[f]=255&255*f/100;else!function(e,t){if(!(e.pos<=0))for(var r=1;r<c;++r){var i=r/c,n=0|Math.floor(i*e.pos);n>e.pos-1&&(n=e.pos-1);var s=0|256*e.bag[n]/e.sum;s>255&&(s=255),t[r]=255&s}}(o.VBR_seek_table,h);var p=o.sideinfo_len;e.error_protection&&(p-=2),e.VBR==r.vbr_off?(a[p++]=255&_.charAt(0),a[p++]=255&_.charAt(1),a[p++]=255&_.charAt(2),a[p++]=255&_.charAt(3)):(a[p++]=255&d.charAt(0),a[p++]=255&d.charAt(1),a[p++]=255&d.charAt(2),a[p++]=255&d.charAt(3)),v(a,p,15),v(a,p+=4,o.VBR_seek_table.nVbrNumFrames),p+=4;var m=o.VBR_seek_table.nBytesWritten+o.VBR_seek_table.TotalFrameSize;v(a,p,0|m),p+=4,t.arraycopy(h,0,a,p,h.length),p+=h.length,e.error_protection&&l.CRC_writeheader(o,a);var b=0;for(f=0;f<p;f++)b=S(a[f],b);return p+=function(e,t,r,n,s){var a,o,l,c,h,f=e.internal_flags,d=0,_=e.encoder_delay,p=e.encoder_padding,m=100-10*e.VBR_q-e.quality,b=u.getLameVeryShortVersion(),E=[1,5,3,2,4,0,3],y=0|(e.lowpassfreq/100+.5>255?255:e.lowpassfreq/100+.5),A=0,w=0,R=e.internal_flags.noise_shaping,M=0,B=0,T=0,I=!!(1&e.exp_nspsytune),P=!!(2&e.exp_nspsytune),x=!1,k=!1,N=e.internal_flags.nogap_total,C=e.internal_flags.nogap_current,O=e.ATHtype;switch(e.VBR){case vbr_abr:h=e.VBR_mean_bitrate_kbps;break;case vbr_off:h=e.brate;break;default:h=e.VBR_min_bitrate_kbps}switch(a=0+(e.VBR.ordinal()<E.length?E[e.VBR.ordinal()]:0),f.findReplayGain&&(f.RadioGain>510&&(f.RadioGain=510),f.RadioGain<-510&&(f.RadioGain=-510),w=8192,w|=3072,f.RadioGain>=0?w|=f.RadioGain:(w|=512,w|=-f.RadioGain)),f.findPeakSample&&(A=Math.abs(0|f.PeakSample/32767*Math.pow(2,23)+.5)),-1!=N&&(C>0&&(k=!0),C<N-1&&(x=!0)),c=O+((I?1:0)<<4)+((P?1:0)<<5)+((x?1:0)<<6)+((k?1:0)<<7),m<0&&(m=0),e.mode){case MONO:M=0;break;case STEREO:M=1;break;case DUAL_CHANNEL:M=2;break;case JOINT_STEREO:M=e.force_ms?4:3;break;case NOT_SET:default:M=7}T=e.in_samplerate<=32e3?0:48e3==e.in_samplerate?2:e.in_samplerate>48e3?3:1,(e.short_blocks==i.short_block_forced||e.short_blocks==i.short_block_dispensed||-1==e.lowpassfreq&&-1==e.highpassfreq||e.scale_left<e.scale_right||e.scale_left>e.scale_right||e.disable_reservoir&&e.brate<320||e.noATH||e.ATHonly||0==O||e.in_samplerate<=32e3)&&(B=1),o=R+(M<<2)+(B<<5)+(T<<6),l=f.nMusicCRC,v(r,n+d,m),d+=4;for(var D=0;D<9;D++)r[n+d+D]=255&b.charAt(D);r[n+(d+=9)]=255&a,r[n+ ++d]=255&y,v(r,n+ ++d,A),g(r,n+(d+=4),w),g(r,n+(d+=2),0),r[n+(d+=2)]=255&c,r[n+ ++d]=h>=255?255:255&h,r[n+ ++d]=255&_>>4,r[n+d+1]=255&(_<<4)+(p>>8),r[n+d+2]=255&p,r[n+(d+=3)]=255&o,d++,r[n+d++]=0,g(r,n+d,e.preset),v(r,n+(d+=2),t),g(r,n+(d+=4),l),d+=2;for(var F=0;F<d;F++)s=S(r[n+F],s);return g(r,n+d,s),d+2}(e,m,a,p,b),o.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(e,t){if(e.internal_flags.VBR_seek_table.pos<=0)return-1;if(t.seek(t.length()),0==t.length())return-1;var r=function(e){e.seek(0);var t=s(10);return e.readFully(t),new String(t,"ISO-8859-1").startsWith("ID3")?0:((127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9])+t.length}(t);t.seek(r);var i=s(h),n=getLameTagFrame(e,i);return n>i.length?-1:(n<1||t.write(i,0,n),0)}}return o.NUMTOCENTRIES=100,o.MAXFRAMESIZE=2880,mn=o}var Gn=function(){if(gn)return En;gn=1;var e=Sn();e.System,e.VbrMode,e.Float,e.ShortBlock,e.Util,e.Arrays,e.new_array_n;var t=e.new_byte;e.new_double,e.new_float,e.new_float_n,e.new_int,e.new_int_n;var r=e.assert,i=Dn(),n=Fn(),s=Pn(),a=Nn(),o=Ln(),l=Cn(),u=function(){if(dn)return fn;dn=1;var e=Sn().assert;return fn=function(){var t;this.setModules=function(e){t=e},this.ResvFrameBegin=function(r,i){var n,s=r.internal_flags,a=s.l3_side,o=t.getframebits(r);i.bits=(o-8*s.sideinfo_len)/s.mode_gr;var l=2048*s.mode_gr-8;r.brate>320?n=8*int(1e3*r.brate/(r.out_samplerate/1152)/8+.5):(n=11520,r.strict_ISO&&(n=8*int(32e4/(r.out_samplerate/1152)/8+.5))),s.ResvMax=n-o,s.ResvMax>l&&(s.ResvMax=l),(s.ResvMax<0||r.disable_reservoir)&&(s.ResvMax=0);var u=i.bits*s.mode_gr+Math.min(s.ResvSize,s.ResvMax);return u>n&&(u=n),e(0==s.ResvMax%8),e(s.ResvMax>=0),a.resvDrain_pre=0,null!=s.pinfo&&(s.pinfo.mean_bits=i.bits/2,s.pinfo.resvsize=s.ResvSize),u},this.ResvMaxBits=function(e,t,r,i){var n,s=e.internal_flags,a=s.ResvSize,o=s.ResvMax;0!=i&&(a+=t),1&s.substep_shaping&&(o*=.9),r.bits=t,10*a>9*o?(n=a-9*o/10,r.bits+=n,s.substep_shaping|=128):(n=0,s.substep_shaping&=127,e.disable_reservoir||1&s.substep_shaping||(r.bits-=.1*t));var l=a<6*s.ResvMax/10?a:6*s.ResvMax/10;return(l-=n)<0&&(l=0),l},this.ResvAdjust=function(e,t){e.ResvSize-=t.part2_3_length+t.part2_length},this.ResvFrameEnd=function(t,r){var i,n=t.l3_side;t.ResvSize+=r*t.mode_gr;var s=0;n.resvDrain_post=0,n.resvDrain_pre=0,0!=(i=t.ResvSize%8)&&(s+=i),(i=t.ResvSize-s-t.ResvMax)>0&&(e(0==i%8),e(i>=0),s+=i);var a=Math.min(8*n.main_data_begin,s)/8;n.resvDrain_pre+=8*a,s-=8*a,t.ResvSize-=8*a,n.main_data_begin-=a,n.resvDrain_post+=s,t.ResvSize-=s}}}(),c=Rn(),h=On();An();var f=pn?_n:(pn=1,_n=function(){this.getLameVersion=function(){return"3.98.4"},this.getLameShortVersion=function(){return"3.98.4"},this.getLameVeryShortVersion=function(){return"LAME3.98r"},this.getPsyVersion=function(){return"0.93"},this.getLameUrl=function(){return"http://www.mp3dev.org/"},this.getLameOsBitness=function(){return"32bits"}}),d=Vn();function _(){this.setModules=function(e,t){}}function p(){this.setModules=function(e,t,r){}}function m(){}function v(){this.setModules=function(e,t){}}function g(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function b(e){return e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3)}return g.RIFF=b("RIFF"),g.WAVE=b("WAVE"),g.fmt_=b("fmt "),g.data=b("data"),g.readHeader=function(e){var t=new g,r=e.getUint32(0,!1);if(g.RIFF==r&&(e.getUint32(4,!0),g.WAVE==e.getUint32(8,!1)&&g.fmt_==e.getUint32(12,!1))){var i=e.getUint32(16,!0),n=20;switch(i){case 16:case 18:t.channels=e.getUint16(n+2,!0),t.sampleRate=e.getUint32(n+4,!0);break;default:throw"extended fmt chunk not implemented"}n+=i;for(var s=g.data,a=0;s!=r&&(r=e.getUint32(n,!1),a=e.getUint32(n+4,!0),s!=r);)n+=a+8;return t.dataLen=a,t.dataOffset=n+8,t}},En.Mp3Encoder=function(e,g,b){3!=arguments.length&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),e=1,g=44100,b=128);var E=new i,S=new _,y=new s,A=new h,w=new n,R=new a,M=new o,B=new d,T=new f,I=new v,P=new u,x=new l,k=new p,N=new m;E.setModules(y,A,w,R,M,B,T,I,N),A.setModules(y,N,T,B),I.setModules(A,T),w.setModules(E),M.setModules(A,P,R,x),R.setModules(x,P,E.enc.psy),P.setModules(A),x.setModules(R),B.setModules(E,A,T),S.setModules(k,N),k.setModules(T,I,w);var C=E.lame_init();C.num_channels=e,C.in_samplerate=g,C.brate=b,C.mode=c.STEREO,C.quality=3,C.bWriteVbrTag=!1,C.disable_reservoir=!0,C.write_id3tag_automatic=!1;var O=E.lame_init_params(C);r(0==O);var D=1152,F=0|1.25*D+7200,L=t(F);this.encodeBuffer=function(i,n){1==e&&(n=i),r(i.length==n.length),i.length>D&&(D=i.length,L=t(F=0|1.25*D+7200));var s=E.lame_encode_buffer(C,i,n,i.length,L,0,F);return new Int8Array(L.subarray(0,s))},this.flush=function(){var e=E.lame_encode_flush(C,L,0,F);return new Int8Array(L.subarray(0,e))}},En.WavHeader=g,En}(),Un=s(Gn),Hn=s(Rn()),jn=s(Dn()),qn=s(On());let Wn=class extends ti{getFormat(){return"mp3"}init(){const e="undefined"!=typeof self?self:window;e.MPEGMode=Hn,e.Lame=jn,e.BitStream=qn}encodeAudio(e,t){return i(this,void 0,void 0,(function*(){return(yield this.isAudioEncoderAPISupportedForSettings(t))?this.encodeMP3AudioEncoder(e,t):this.encodeMP3LameJS(e,t)}))}encodeMP3LameJS(e,t){const r=new Un.Mp3Encoder(Math.max(2,t.numChannels),t.sampleRate,t.bitrate),i=[],n=Ct.convertFloatArray2Int16(e[0]),s=Ct.convertFloatArray2Int16(e[1]),a=1152;for(let e=0;e<n.length;e+=a){const t=n.subarray(e,e+a),o=s.subarray(e,e+a),l=r.encodeBuffer(t,o);l.length>0&&i.push(l)}const o=r.flush();o.length>0&&i.push(new Uint8Array(o));const l=i.reduce(((e,t)=>e+t.length),0),u=new Uint8Array(l);let c=0;for(const e of i)u.set(e,c),c+=e.length;return u.buffer}encodeMP3AudioEncoder(e,t){return i(this,void 0,void 0,(function*(){const r=[],i=new AudioEncoder({output:e=>r.push(e),error:e=>console.error(e)});i.configure({codec:"mp3",sampleRate:t.sampleRate,numberOfChannels:t.numChannels,bitrate:t.bitrate});const n=e[0].length;let s;s=2===t.numChannels?Ct.interleaveBuffers(e[0],e[1]):e[0];const a=new AudioData({format:"f32",sampleRate:sampleRate,numberOfFrames:n,numberOfChannels:2,timestamp:0,data:s});i.encode(a),yield i.flush(),i.close();for(const e of r){const t=new Uint8Array(e.byteLength);e.copyTo(t)}const o=r.reduce(((e,t)=>e+t.byteLength),0),l=new Uint8Array(o);let u=0;for(const e of r){const t=new Uint8Array(e.byteLength);e.copyTo(t),l.set(t,u),u+=t.length}return l.buffer}))}};e([ae(),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",void 0)],Wn.prototype,"init",null),Wn=e([te()],Wn);var Yn=Wn;let Xn=class{constructor(e){this.audioEncoders=e}encodeAudio(e,t){for(const r of this.audioEncoders)if(r.getFormat()===t.format)return r.encodeAudio(e,t);throw new Error(`BaseAudioEncoder.encodeAudio: cannot find encoder for ${t.format} format`)}};Xn=e([te(),t(0,se(xt.AudioEncoders)),r("design:paramtypes",[Array])],Xn);var Kn=Xn;class zn{static createNewInstance(e){try{const t=function(){const e=new Pt({defaultScope:"Singleton"});return e.bind(xt.EntryPointFilter).to(zr),e.bind(xt.Renderers).to(Ar),e.bind(xt.Filters).toDynamicValue((()=>e.get(xt.EntryPointFilter))),e.bind(xt.Filters).to(wr),e.bind(xt.Filters).to(Mr),e.bind(xt.Filters).to(Br),e.bind(xt.Filters).to(Tr),e.bind(xt.Filters).to(xr),e.bind(xt.Filters).to(kr),e.bind(xt.Filters).to(Nr),e.bind(xt.Filters).to(Zr),e.bind(xt.Filters).to($r),e.bind(xt.Filters).to(ei),e.bind(xt.EventEmitter).to(nr),e.bind(xt.AudioContextManager).to(lr),e.bind(xt.AudioEditor).to(Ft),e.bind(xt.AudioProcessor).to(cr),e.bind(xt.BufferManager).to(fr),e.bind(xt.FilterManager).to(_r),e.bind(xt.RendererManager).to(mr),e.bind(xt.SaveBufferManager).to(gr),e.bind(xt.BufferPlayer).to(Vt),e.bind(xt.BufferFetcherService).to(Er),e.bind(xt.BufferDecoderService).to(yr),e.bind(xt.VoiceRecorder).to(Xt),e.bind(xt.BaseAudioEncoder).to(Kn),e.bind(xt.AudioEncoders).to(bn),e.bind(xt.AudioEncoders).to(Yn),e}();return e&&e.configService?t.bind(xt.ConfigService).toDynamicValue((()=>e.configService)):(t.bind(xt.ConfigService).to(ar),console.warn("No ConfigService provided. Using default generic implementation.")),t.bind(xt.AudioBuffersToFetch).toConstantValue(e&&e.buffersToFetch||[]),{audioEditor:t.get(xt.AudioEditor),audioPlayer:t.get(xt.BufferPlayer),configService:t.get(xt.ConfigService),eventEmitter:t.get(xt.EventEmitter),voiceRecorder:t.get(xt.VoiceRecorder)}}catch(e){throw console.error("Error when creating new Sound Studio instance\n",e),new Error("Error when creating new Sound Studio instance")}}static createAudioEditor(e,t){if(console.warn("[DEPRECATED] SoundStudioFactory.createAudioEditor is deprecated and will be removed in a future release of simple-sound-studio-lib. Please use SoundStudioFactory.createNewInstance instead, which doesn't work as a singleton."),!zn.ready){const r=zn.createNewInstance({configService:e,buffersToFetch:t});zn.audioEditor=r.audioEditor,zn.audioPlayer=r.audioPlayer,zn.configService=r.configService,zn.eventEmitter=r.eventEmitter,zn.voiceRecorder=r.voiceRecorder,zn.ready=!0}return zn.audioEditor}static createVoiceRecorder(){return console.warn("[DEPRECATED] SoundStudioFactory.createVoiceRecorder is deprecated and will be removed in a future release of simple-sound-studio-lib. Please use SoundStudioFactory.createNewInstance instead, which doesn't work as a singleton."),zn.voiceRecorder}static getAudioEditorInstance(){return console.warn("[DEPRECATED] SoundStudioFactory.getAudioEditorInstance is deprecated and will be removed in a future release of simple-sound-studio-lib. Please use SoundStudioFactory.createNewInstance instead, which doesn't work as a singleton."),zn.audioEditor}static getAudioPlayerInstance(){return console.warn("[DEPRECATED] SoundStudioFactory.getAudioPlayerInstance is deprecated and will be removed in a future release of simple-sound-studio-lib. Please use SoundStudioFactory.createNewInstance instead, which doesn't work as a singleton."),zn.audioPlayer}static getAudioRecorderInstance(){return console.warn("[DEPRECATED] SoundStudioFactory.getAudioRecorderInstance is deprecated and will be removed in a future release of simple-sound-studio-lib. Please use SoundStudioFactory.createNewInstance instead, which doesn't work as a singleton."),zn.voiceRecorder}static getEventEmitterInstance(){return console.warn("[DEPRECATED] SoundStudioFactory.getEventEmitterInstance is deprecated and will be removed in a future release of simple-sound-studio-lib. Please use SoundStudioFactory.createNewInstance instead, which doesn't work as a singleton."),zn.eventEmitter}static getConfigServiceInstance(){return console.warn("[DEPRECATED] SoundStudioFactory.getConfigServiceInstance is deprecated and will be removed in a future release of simple-sound-studio-lib. Please use SoundStudioFactory.createNewInstance instead, which doesn't work as a singleton."),zn.configService}}zn.ready=!1,zn.audioEditor=null,zn.audioPlayer=null,zn.configService=null,zn.eventEmitter=null,zn.voiceRecorder=null,exports.AbstractAudioElement=Nt,exports.AbstractAudioFilter=Zt,exports.AbstractAudioFilterWorklet=tr,exports.AbstractAudioNode=zt,exports.AbstractAudioRenderer=rr,exports.AudioEditor=Ft,exports.BufferPlayer=Vt,exports.Constants=Ht,exports.EventEmitter=nr,exports.FilterNames=Ut,exports.GenericConfigService=ar,exports.SoundStudioFactory=zn,exports.UtilFunctions=Ct,exports.VoiceRecorder=Xt;
//# sourceMappingURL=SimpleSoundStudioLibrary.js.map
