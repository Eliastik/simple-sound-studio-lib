"use strict";function e(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o}function t(e,t){return function(i,r){t(i,r,e)}}function i(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function r(e,t,i,r){return new(i||(i=Promise))(function(n,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(o,a)}u((r=r.apply(e,t||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;var n,s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},o={};function a(e){return("object"==typeof e&&null!==e||"function"==typeof e)&&"function"==typeof e.then}function u(e){switch(typeof e){case"string":case"symbol":return e.toString();case"function":return e.name;default:throw new Error(`Unexpected ${typeof e} service id type`)}}!function(){return n||(n=1,function(e){!function(){var t="object"==typeof globalThis?globalThis:"object"==typeof s?s:"object"==typeof self?self:"object"==typeof this?this:function(){try{return Function("return this;")()}catch(e){}}()||function(){try{return(0,eval)("(function() { return this; })()")}catch(e){}}(),i=r(e);function r(e,t){return function(i,r){Object.defineProperty(e,i,{configurable:!0,writable:!0,value:r}),t&&t(i,r)}}void 0!==t.Reflect&&(i=r(t.Reflect,i)),function(e,t){var i=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,n=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",s=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a={__proto__:[]}instanceof Array,u=!o&&!a,c={create:o?function(){return he(Object.create(null))}:a?function(){return he({__proto__:null})}:function(){return he({})},has:u?function(e,t){return i.call(e,t)}:function(e,t){return t in e},get:u?function(e,t){return i.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},l=Object.getPrototypeOf(Function),h="function"==typeof Map&&"function"==typeof Map.prototype.entries?Map:ue(),d="function"==typeof Set&&"function"==typeof Set.prototype.entries?Set:ce(),f="function"==typeof WeakMap?WeakMap:le(),p=r?Symbol.for("@reflect-metadata:registry"):void 0,v=ne(),g=se(v);function m(e,t,i,r){if(k(i)){if(!K(e))throw new TypeError;if(!Y(t))throw new TypeError;return C(e,t)}if(!K(e))throw new TypeError;if(!G(t))throw new TypeError;if(!G(r)&&!k(r)&&!L(r))throw new TypeError;return L(r)&&(r=void 0),T(e,t,i=H(i),r)}function E(e,t){function i(i,r){if(!G(i))throw new TypeError;if(!k(r)&&!z(r))throw new TypeError;O(e,t,i,r)}return i}function y(e,t,i,r){if(!G(i))throw new TypeError;return k(r)||(r=H(r)),O(e,t,i,r)}function S(e,t,i){if(!G(t))throw new TypeError;return k(i)||(i=H(i)),B(e,t,i)}function b(e,t,i){if(!G(t))throw new TypeError;return k(i)||(i=H(i)),M(e,t,i)}function A(e,t,i){if(!G(t))throw new TypeError;return k(i)||(i=H(i)),P(e,t,i)}function _(e,t,i){if(!G(t))throw new TypeError;return k(i)||(i=H(i)),N(e,t,i)}function R(e,t){if(!G(e))throw new TypeError;return k(t)||(t=H(t)),D(e,t)}function w(e,t){if(!G(e))throw new TypeError;return k(t)||(t=H(t)),F(e,t)}function I(e,t,i){if(!G(t))throw new TypeError;if(k(i)||(i=H(i)),!G(t))throw new TypeError;k(i)||(i=H(i));var r=ae(t,i,!1);return!k(r)&&r.OrdinaryDeleteMetadata(e,t,i)}function C(e,t){for(var i=e.length-1;i>=0;--i){var r=(0,e[i])(t);if(!k(r)&&!L(r)){if(!Y(r))throw new TypeError;t=r}}return t}function T(e,t,i,r){for(var n=e.length-1;n>=0;--n){var s=(0,e[n])(t,i,r);if(!k(s)&&!L(s)){if(!G(s))throw new TypeError;r=s}}return r}function B(e,t,i){if(M(e,t,i))return!0;var r=ie(t);return!L(r)&&B(e,r,i)}function M(e,t,i){var r=ae(t,i,!1);return!k(r)&&j(r.OrdinaryHasOwnMetadata(e,t,i))}function P(e,t,i){if(M(e,t,i))return N(e,t,i);var r=ie(t);return L(r)?void 0:P(e,r,i)}function N(e,t,i){var r=ae(t,i,!1);if(!k(r))return r.OrdinaryGetOwnMetadata(e,t,i)}function O(e,t,i,r){ae(i,r,!0).OrdinaryDefineOwnMetadata(e,t,i,r)}function D(e,t){var i=F(e,t),r=ie(e);if(null===r)return i;var n=D(r,t);if(n.length<=0)return i;if(i.length<=0)return n;for(var s=new d,o=[],a=0,u=i;a<u.length;a++){var c=u[a];s.has(c)||(s.add(c),o.push(c))}for(var l=0,h=n;l<h.length;l++){c=h[l];s.has(c)||(s.add(c),o.push(c))}return o}function F(e,t){var i=ae(e,t,!1);return i?i.OrdinaryOwnMetadataKeys(e,t):[]}function x(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function k(e){return void 0===e}function L(e){return null===e}function U(e){return"symbol"==typeof e}function G(e){return"object"==typeof e?null!==e:"function"==typeof e}function W(e,t){switch(x(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var i="string",r=Q(e,n);if(void 0!==r){var s=r.call(e,i);if(G(s))throw new TypeError;return s}return V(e)}function V(e,t){var i,r,n=e.toString;if($(n)&&!G(r=n.call(e)))return r;if($(i=e.valueOf)&&!G(r=i.call(e)))return r;throw new TypeError}function j(e){return!!e}function q(e){return""+e}function H(e){var t=W(e);return U(t)?t:q(t)}function K(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function $(e){return"function"==typeof e}function Y(e){return"function"==typeof e}function z(e){switch(x(e)){case 3:case 4:return!0;default:return!1}}function X(e,t){return e===t||e!=e&&t!=t}function Q(e,t){var i=e[t];if(null!=i){if(!$(i))throw new TypeError;return i}}function Z(e){var t=Q(e,s);if(!$(t))throw new TypeError;var i=t.call(e);if(!G(i))throw new TypeError;return i}function J(e){return e.value}function ee(e){var t=e.next();return!t.done&&t}function te(e){var t=e.return;t&&t.call(e)}function ie(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===l)return t;if(t!==l)return t;var i=e.prototype,r=i&&Object.getPrototypeOf(i);if(null==r||r===Object.prototype)return t;var n=r.constructor;return"function"!=typeof n||n===e?t:n}function re(){var e,i,r,n;k(p)||void 0===t.Reflect||p in t.Reflect||"function"!=typeof t.Reflect.defineMetadata||(e=oe(t.Reflect));var s=new f,o={registerProvider:a,getProvider:c,setProvider:v};return o;function a(t){if(!Object.isExtensible(o))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===t:break;case k(i):i=t;break;case i===t:break;case k(r):r=t;break;case r===t:break;default:void 0===n&&(n=new d),n.add(t)}}function u(t,s){if(!k(i)){if(i.isProviderFor(t,s))return i;if(!k(r)){if(r.isProviderFor(t,s))return i;if(!k(n))for(var o=Z(n);;){var a=ee(o);if(!a)return;var u=J(a);if(u.isProviderFor(t,s))return te(o),u}}}if(!k(e)&&e.isProviderFor(t,s))return e}function c(e,t){var i,r=s.get(e);return k(r)||(i=r.get(t)),k(i)?(k(i=u(e,t))||(k(r)&&(r=new h,s.set(e,r)),r.set(t,i)),i):i}function l(e){if(k(e))throw new TypeError;return i===e||r===e||!k(n)&&n.has(e)}function v(e,t,i){if(!l(i))throw new Error("Metadata provider not registered.");var r=c(e,t);if(r!==i){if(!k(r))return!1;var n=s.get(e);k(n)&&(n=new h,s.set(e,n)),n.set(t,i)}return!0}}function ne(){var e;return!k(p)&&G(t.Reflect)&&Object.isExtensible(t.Reflect)&&(e=t.Reflect[p]),k(e)&&(e=re()),!k(p)&&G(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,p,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}function se(e){var t=new f,i={isProviderFor:function(e,i){var r=t.get(e);return!k(r)&&r.has(i)},OrdinaryDefineOwnMetadata:o,OrdinaryHasOwnMetadata:n,OrdinaryGetOwnMetadata:s,OrdinaryOwnMetadataKeys:a,OrdinaryDeleteMetadata:u};return v.registerProvider(i),i;function r(r,n,s){var o=t.get(r),a=!1;if(k(o)){if(!s)return;o=new h,t.set(r,o),a=!0}var u=o.get(n);if(k(u)){if(!s)return;if(u=new h,o.set(n,u),!e.setProvider(r,n,i))throw o.delete(n),a&&t.delete(r),new Error("Wrong provider for target.")}return u}function n(e,t,i){var n=r(t,i,!1);return!k(n)&&j(n.has(e))}function s(e,t,i){var n=r(t,i,!1);if(!k(n))return n.get(e)}function o(e,t,i,n){r(i,n,!0).set(e,t)}function a(e,t){var i=[],n=r(e,t,!1);if(k(n))return i;for(var s=Z(n.keys()),o=0;;){var a=ee(s);if(!a)return i.length=o,i;var u=J(a);try{i[o]=u}catch(e){try{te(s)}finally{throw e}}o++}}function u(e,i,n){var s=r(i,n,!1);if(k(s))return!1;if(!s.delete(e))return!1;if(0===s.size){var o=t.get(i);k(o)||(o.delete(n),0===o.size&&t.delete(o))}return!0}}function oe(e){var t=e.defineMetadata,i=e.hasOwnMetadata,r=e.getOwnMetadata,n=e.getOwnMetadataKeys,s=e.deleteMetadata,o=new f,a={isProviderFor:function(e,t){var i=o.get(e);return!(k(i)||!i.has(t))||!!n(e,t).length&&(k(i)&&(i=new d,o.set(e,i)),i.add(t),!0)},OrdinaryDefineOwnMetadata:t,OrdinaryHasOwnMetadata:i,OrdinaryGetOwnMetadata:r,OrdinaryOwnMetadataKeys:n,OrdinaryDeleteMetadata:s};return a}function ae(e,t,i){var r=v.getProvider(e,t);if(!k(r))return r;if(i){if(v.setProvider(e,t,g))return g;throw new Error("Illegal state.")}}function ue(){var e={},t=[],i=function(){function e(e,t,i){this._index=0,this._keys=e,this._values=t,this._selector=i}return e.prototype["@@iterator"]=function(){return this},e.prototype[s]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var i=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:i,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var i=this._find(e,!0);return this._values[i]=t,this},t.prototype.delete=function(t){var i=this._find(t,!1);if(i>=0){for(var r=this._keys.length,n=i+1;n<r;n++)this._keys[n-1]=this._keys[n],this._values[n-1]=this._values[n];return this._keys.length--,this._values.length--,X(t,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new i(this._keys,this._values,r)},t.prototype.values=function(){return new i(this._keys,this._values,n)},t.prototype.entries=function(){return new i(this._keys,this._values,o)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[s]=function(){return this.entries()},t.prototype._find=function(e,t){if(!X(this._cacheKey,e)){this._cacheIndex=-1;for(var i=0;i<this._keys.length;i++)if(X(this._keys[i],e)){this._cacheIndex=i;break}}return this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function n(e,t){return t}function o(e,t){return[e,t]}}function ce(){return function(){function e(){this._map=new h}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.keys()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[s]=function(){return this.keys()},e}()}function le(){var e=16,t=c.create(),r=n();return function(){function e(){this._key=n()}return e.prototype.has=function(e){var t=s(e,!1);return void 0!==t&&c.has(t,this._key)},e.prototype.get=function(e){var t=s(e,!1);return void 0!==t?c.get(t,this._key):void 0},e.prototype.set=function(e,t){return s(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=s(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=n()},e}();function n(){var e;do{e="@@WeakMap@@"+u()}while(c.has(t,e));return t[e]=!0,e}function s(e,t){if(!i.call(e,r)){if(!t)return;Object.defineProperty(e,r,{value:c.create()})}return e[r]}function o(e,t){for(var i=0;i<t;++i)e[i]=255*Math.random()|0;return e}function a(e){if("function"==typeof Uint8Array){var t=new Uint8Array(e);return"undefined"!=typeof crypto?crypto.getRandomValues(t):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(t):o(t,e),t}return o(new Array(e),e)}function u(){var t=a(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var i="",r=0;r<e;++r){var n=t[r];4!==r&&6!==r&&8!==r||(i+="-"),n<16&&(i+="0"),i+=n.toString(16).toLowerCase()}return i}}function he(e){return e.__=void 0,delete e.__,e}e("decorate",m),e("metadata",E),e("defineMetadata",y),e("hasMetadata",S),e("hasOwnMetadata",b),e("getMetadata",A),e("getOwnMetadata",_),e("getMetadataKeys",R),e("getOwnMetadataKeys",w),e("deleteMetadata",I)}(i,t),void 0===t.Reflect&&(t.Reflect=e)}()}(e||(e={}))),o;var e}();const c=Symbol.for("@inversifyjs/common/islazyServiceIdentifier");class l{[c];#e;constructor(e){this.#e=e,this[c]=!0}static is(e){return"object"==typeof e&&null!==e&&!0===e[c]}unwrap(){return this.#e()}}function h(e,t,i){return Reflect.getOwnMetadata(t,e,i)}function d(e,t,i,r){Reflect.defineMetadata(t,i,e,r)}function f(e,t,i,r,n){const s=r(h(e,t,n)??i());Reflect.defineMetadata(t,s,e,n)}const p="@inversifyjs/container/bindingId";function v(){const e=h(Object,p)??0;return e===Number.MAX_SAFE_INTEGER?d(Object,p,Number.MIN_SAFE_INTEGER):f(Object,p,()=>e,e=>e+1),e}const g="Request",m="Singleton",E="Transient",y="ConstantValue",S="DynamicValue",b="Factory",A="Instance",_="Provider",R="ResolvedValue",w="ServiceRedirection";function*I(...e){for(const t of e)yield*t}class C{#e;#t;#i;constructor(e){this.#e=new Map,this.#t={};for(const t of Reflect.ownKeys(e))this.#t[t]=new Map;this.#i=e}add(e,t){this.#r(e).push(t);for(const i of Reflect.ownKeys(t))this.#n(i,t[i]).push(e)}clone(){const e=this.#s(),t=this.#o(),i=Reflect.ownKeys(this.#i),r=this._buildNewInstance(this.#i);this.#a(this.#e,r.#e,e,t);for(const t of i)this.#u(this.#t[t],r.#t[t],e);return r}get(e,t){return this.#t[e].get(t)}getAllKeys(e){return this.#t[e].keys()}removeByRelation(e,t){const i=this.get(e,t);if(void 0===i)return;const r=new Set(i);for(const i of r){const r=this.#e.get(i);if(void 0===r)throw new Error("Expecting model relation, none found");for(const n of r)n[e]===t&&this.#c(i,n);this.#e.delete(i)}}_buildNewInstance(e){return new C(e)}_cloneModel(e){return e}_cloneRelation(e){return e}#s(){const e=new Map;for(const t of this.#e.keys()){const i=this._cloneModel(t);e.set(t,i)}return e}#o(){const e=new Map;for(const t of this.#e.values())for(const i of t){const t=this._cloneRelation(i);e.set(i,t)}return e}#r(e){let t=this.#e.get(e);return void 0===t&&(t=[],this.#e.set(e,t)),t}#n(e,t){let i=this.#t[e].get(t);return void 0===i&&(i=[],this.#t[e].set(t,i)),i}#l(e,t){const i=t.get(e);if(void 0===i)throw new Error("Expecting model to be cloned, none found");return i}#h(e,t){const i=t.get(e);if(void 0===i)throw new Error("Expecting relation to be cloned, none found");return i}#u(e,t,i){for(const[r,n]of e){const e=new Array;for(const t of n)e.push(this.#l(t,i));t.set(r,e)}}#a(e,t,i,r){for(const[n,s]of e){const e=new Array;for(const t of s)e.push(this.#h(t,r));t.set(this.#l(n,i),e)}}#c(e,t){for(const i of Reflect.ownKeys(t))this.#d(e,i,t[i])}#d(e,t,i){const r=this.#t[t].get(i);if(void 0!==r){const n=r.indexOf(e);-1!==n&&r.splice(n,1),0===r.length&&this.#t[t].delete(i)}}}var T,B,M;!function(e){e.moduleId="moduleId",e.serviceId="serviceId"}(T||(T={}));class P{#f;#p;constructor(e,t){this.#f=t??new C({moduleId:{isOptional:!0},serviceId:{isOptional:!1}}),this.#p=e}static build(e){return new P(e)}add(e,t){this.#f.add(e,t)}clone(){return new P(this.#p,this.#f.clone())}get(e){const t=[],i=this.#f.get(T.serviceId,e);void 0!==i&&t.push(i);const r=this.#p?.get(e);if(void 0!==r&&t.push(r),0!==t.length)return I(...t)}removeAllByModuleId(e){this.#f.removeByRelation(T.moduleId,e)}removeAllByServiceId(e){this.#f.removeByRelation(T.serviceId,e)}}function N(e){return e.isRight?{isRight:!0,value:e.value}:e}!function(e){e.id="id",e.moduleId="moduleId",e.serviceId="serviceId"}(B||(B={}));class O extends C{_buildNewInstance(e){return new O(e)}_cloneModel(e){return function(e){switch(e.type){case y:case S:return function(e){return{cache:N(e.cache),id:e.id,isSatisfiedBy:e.isSatisfiedBy,moduleId:e.moduleId,onActivation:e.onActivation,onDeactivation:e.onDeactivation,scope:e.scope,serviceIdentifier:e.serviceIdentifier,type:e.type,value:e.value}}(e);case b:return function(e){return{cache:N(e.cache),factory:e.factory,id:e.id,isSatisfiedBy:e.isSatisfiedBy,moduleId:e.moduleId,onActivation:e.onActivation,onDeactivation:e.onDeactivation,scope:e.scope,serviceIdentifier:e.serviceIdentifier,type:e.type}}(e);case A:return function(e){return{cache:N(e.cache),id:e.id,implementationType:e.implementationType,isSatisfiedBy:e.isSatisfiedBy,moduleId:e.moduleId,onActivation:e.onActivation,onDeactivation:e.onDeactivation,scope:e.scope,serviceIdentifier:e.serviceIdentifier,type:e.type}}(e);case _:return function(e){return{cache:N(e.cache),id:e.id,isSatisfiedBy:e.isSatisfiedBy,moduleId:e.moduleId,onActivation:e.onActivation,onDeactivation:e.onDeactivation,provider:e.provider,scope:e.scope,serviceIdentifier:e.serviceIdentifier,type:e.type}}(e);case R:return function(e){return{cache:N(e.cache),factory:e.factory,id:e.id,isSatisfiedBy:e.isSatisfiedBy,metadata:e.metadata,moduleId:e.moduleId,onActivation:e.onActivation,onDeactivation:e.onDeactivation,scope:e.scope,serviceIdentifier:e.serviceIdentifier,type:e.type}}(e);case w:return function(e){return{id:e.id,isSatisfiedBy:e.isSatisfiedBy,moduleId:e.moduleId,serviceIdentifier:e.serviceIdentifier,targetServiceIdentifier:e.targetServiceIdentifier,type:e.type}}(e)}}(e)}}let D=class e{#v;#p;constructor(e,t){this.#v=t??new O({id:{isOptional:!1},moduleId:{isOptional:!0},serviceId:{isOptional:!1}}),this.#p=e}static build(t){return new e(t)}clone(){return new e(this.#p,this.#v.clone())}get(e){return this.getNonParentBindings(e)??this.#p?.get(e)}*getChained(e){const t=this.getNonParentBindings(e);void 0!==t&&(yield*t),void 0!==this.#p&&(yield*this.#p.getChained(e))}getBoundServices(){const e=new Set(this.#v.getAllKeys(B.serviceId));if(void 0!==this.#p)for(const t of this.#p.getBoundServices())e.add(t);return e}getById(e){return this.#v.get(B.id,e)??this.#p?.getById(e)}getByModuleId(e){return this.#v.get(B.moduleId,e)??this.#p?.getByModuleId(e)}getNonParentBindings(e){return this.#v.get(B.serviceId,e)}getNonParentBoundServices(){return this.#v.getAllKeys(B.serviceId)}removeById(e){this.#v.removeByRelation(B.id,e)}removeAllByModuleId(e){this.#v.removeByRelation(B.moduleId,e)}removeAllByServiceId(e){this.#v.removeByRelation(B.serviceId,e)}set(e){const t={[B.id]:e.id,[B.serviceId]:e.serviceIdentifier};void 0!==e.moduleId&&(t[B.moduleId]=e.moduleId),this.#v.add(e,t)}};!function(e){e.moduleId="moduleId",e.serviceId="serviceId"}(M||(M={}));let F=class e{#g;#p;constructor(e,t){this.#g=t??new C({moduleId:{isOptional:!0},serviceId:{isOptional:!1}}),this.#p=e}static build(t){return new e(t)}add(e,t){this.#g.add(e,t)}clone(){return new e(this.#p,this.#g.clone())}get(e){const t=[],i=this.#g.get(M.serviceId,e);void 0!==i&&t.push(i);const r=this.#p?.get(e);if(void 0!==r&&t.push(r),0!==t.length)return I(...t)}removeAllByModuleId(e){this.#g.removeByRelation(M.moduleId,e)}removeAllByServiceId(e){this.#g.removeByRelation(M.serviceId,e)}};const x="@inversifyjs/core/classMetadataReflectKey";function k(){return{constructorArguments:[],lifecycle:{postConstructMethodName:void 0,preDestroyMethodName:void 0},properties:new Map,scope:void 0}}const L="@inversifyjs/core/pendingClassMetadataCountReflectKey",U=Symbol.for("@inversifyjs/core/InversifyCoreError");let G=class e extends Error{[U];kind;constructor(e,t,i){super(t,i),this[U]=!0,this.kind=e}static is(e){return"object"==typeof e&&null!==e&&!0===e[U]}static isErrorOfKind(t,i){return e.is(t)&&t.kind===i}};var W,V,j;function q(e){const t=h(e,x)??k();if(!function(e){const t=h(e,L);return void 0!==t&&0!==t}(e))return function(e,t){const i=[];if(t.length<e.length)throw new G(W.missingInjectionDecorator,`Found unexpected missing metadata on type "${e.name}". "${e.name}" constructor requires at least ${e.length.toString()} arguments, found ${t.length.toString()} instead.\nAre you using @inject, @multiInject or @unmanaged decorators in every non optional constructor argument?\n\nIf you're using typescript and want to rely on auto injection, set "emitDecoratorMetadata" compiler option to true`);for(let e=0;e<t.length;++e)void 0===t[e]&&i.push(e);if(i.length>0)throw new G(W.missingInjectionDecorator,`Found unexpected missing metadata on type "${e.name}" at constructor indexes "${i.join('", "')}".\n\nAre you using @inject, @multiInject or @unmanaged decorators at those indexes?\n\nIf you're using typescript and want to rely on auto injection, set "emitDecoratorMetadata" compiler option to true`)}(e,t.constructorArguments),t;!function(e,t){const i=[];for(let r=0;r<t.constructorArguments.length;++r){const n=t.constructorArguments[r];void 0!==n&&n.kind!==V.unknown||i.push(`  - Missing or incomplete metadata for type "${e.name}" at constructor argument with index ${r.toString()}.\nEvery constructor parameter must be decorated either with @inject, @multiInject or @unmanaged decorator.`)}for(const[r,n]of t.properties)n.kind===V.unknown&&i.push(`  - Missing or incomplete metadata for type "${e.name}" at property "${r.toString()}".\nThis property must be decorated either with @inject or @multiInject decorator.`);if(0===i.length)throw new G(W.unknown,`Unexpected class metadata for type "${e.name}" with uncompletion traces.\nThis might be caused by one of the following reasons:\n\n1. A third party library is targeting inversify reflection metadata.\n2. A bug is causing the issue. Consider submiting an issue to fix it.`);throw new G(W.missingInjectionDecorator,`Invalid class metadata at type ${e.name}:\n\n${i.join("\n\n")}`)}(e,t)}function H(){return 0}function K(e){return t=>{void 0!==t&&t.kind===V.unknown&&f(e,L,H,e=>e-1)}}!function(e){e[e.injectionDecoratorConflict=0]="injectionDecoratorConflict",e[e.missingInjectionDecorator=1]="missingInjectionDecorator",e[e.planning=2]="planning",e[e.resolution=3]="resolution",e[e.unknown=4]="unknown"}(W||(W={})),function(e){e[e.unknown=32]="unknown"}(V||(V={})),function(e){e[e.multipleInjection=0]="multipleInjection",e[e.singleInjection=1]="singleInjection",e[e.unmanaged=2]="unmanaged"}(j||(j={}));const $=function(e,t){return(...i)=>r=>{if(void 0===r)return e(...i);if(r.kind===j.unmanaged)throw new G(W.injectionDecoratorConflict,"Unexpected injection found. Multiple @inject, @multiInject or @unmanaged decorators found");return t(r,...i)}}(function(e,t,i){return e===j.multipleInjection?{chained:i?.chained??!1,kind:e,name:void 0,optional:!1,tags:new Map,value:t}:{kind:e,name:void 0,optional:!1,tags:new Map,value:t}},function(e,t,i,r){return function(e){if(e.kind!==V.unknown&&!0!==e.isFromTypescriptParamType)throw new G(W.injectionDecoratorConflict,"Unexpected injection found. Multiple @inject, @multiInject or @unmanaged decorators found")}(e),t===j.multipleInjection?{...e,chained:r?.chained??!1,kind:t,value:i}:{...e,kind:t,value:i}});function Y(e,t){return i=>{const r=i.properties.get(t);return i.properties.set(t,e(r)),i}}var z;function X(e,t,i,r){if(G.isErrorOfKind(r,W.injectionDecoratorConflict)){const n=function(e,t,i){if(void 0===i){if(void 0===t)throw new G(W.unknown,"Unexpected undefined property and index values");return{kind:z.property,property:t,targetClass:e.constructor}}return"number"==typeof i?{index:i,kind:z.parameter,targetClass:e}:{kind:z.method,method:t,targetClass:e}}(e,t,i);throw new G(W.injectionDecoratorConflict,`Unexpected injection error.\n\nCause:\n\n${r.message}\n\nDetails\n\n${function(e){switch(e.kind){case z.method:return`[class: "${e.targetClass.name}", method: "${e.method.toString()}"]`;case z.parameter:return`[class: "${e.targetClass.name}", index: "${e.index.toString()}"]`;case z.property:return`[class: "${e.targetClass.name}", property: "${e.property.toString()}"]`}}(n)}`,{cause:r})}throw r}function Q(e,t){return(i,r,n)=>{try{void 0===n?function(e,t){const i=Z(e,t);return(e,t)=>{f(e.constructor,x,k,Y(i(e),t))}}(e,t)(i,r):"number"==typeof n?function(e,t){const i=Z(e,t);return(e,t,r)=>{if(!function(e,t){return"function"==typeof e&&void 0===t}(e,t))throw new G(W.injectionDecoratorConflict,`Found an @inject decorator in a non constructor parameter.\nFound @inject decorator at method "${t?.toString()??""}" at class "${e.constructor.name}"`);f(e,x,k,function(e,t){return i=>{const r=i.constructorArguments[t];return i.constructorArguments[t]=e(r),i}}(i(e),r))}}(e,t)(i,r,n):function(e,t){const i=Z(e,t);return(e,t,r)=>{if(!function(e){return void 0!==e.set}(r))throw new G(W.injectionDecoratorConflict,`Found an @inject decorator in a non setter property method.\nFound @inject decorator at method "${t.toString()}" at class "${e.constructor.name}"`);f(e.constructor,x,k,Y(i(e),t))}}(e,t)(i,r,n)}catch(e){X(i,r,n,e)}}}function Z(e,t){return i=>{const r=t(i);return t=>(r(t),e(t))}}function J(e){return Q($(j.singleInjection,e),K)}!function(e){e[e.method=0]="method",e[e.parameter=1]="parameter",e[e.property=2]="property"}(z||(z={}));const ee="@inversifyjs/core/classIsInjectableFlagReflectKey",te=[Array,BigInt,Boolean,Function,Number,Object,String];function ie(e){return e=>{!function(e){if(void 0!==h(e,ee))throw new G(W.injectionDecoratorConflict,`Cannot apply @injectable decorator multiple times at class "${e.name}"`);d(e,ee,!0)}(e),function(e){const t=h(e,"design:paramtypes");void 0!==t&&f(e,x,k,function(e){return t=>(e.forEach((e,i)=>{var r;void 0!==t.constructorArguments[i]||(r=e,te.includes(r))||(t.constructorArguments[i]=function(e){return{isFromTypescriptParamType:!0,kind:j.singleInjection,name:void 0,optional:!1,tags:new Map,value:e}}(e))}),t)}(t))}(e)}}function re(e,t,i){let r;return e.extendConstructorArguments??1?(r=[...t.constructorArguments],i.constructorArguments.map((e,t)=>{r[t]=e})):r=i.constructorArguments,r}function ne(e,t,i){let r;return r=e.extendProperties??1?new Map(I(t.properties,i.properties)):i.properties,r}function se(e){return t=>{const i=function(e){const t=Object.getPrototypeOf(e.prototype),i=t?.constructor;return i}(t);if(void 0===i)throw new G(W.injectionDecoratorConflict,`Expected base type for type "${t.name}", none found.`);!function(e){return t=>{const i=q(e.type);f(t,x,k,function(e,t){return i=>({constructorArguments:re(e,t,i),lifecycle:i.lifecycle,properties:ne(e,t,i),scope:i.scope})}(e,i))}}({...e,type:i})(t)}}function oe(e,t){return Q($(j.multipleInjection,e,t),K)}function ae(){return(e,t,i)=>{try{f(e.constructor,x,k,(r=t,e=>{if(void 0!==e.lifecycle.postConstructMethodName)throw new G(W.injectionDecoratorConflict,"Unexpected duplicated postConstruct decorator");return e.lifecycle.postConstructMethodName=r,e}))}catch(i){X(e,t,void 0,i)}var r}}var ue,ce;!function(e){e[e.multipleInjection=0]="multipleInjection",e[e.singleInjection=1]="singleInjection"}(ue||(ue={}));class le{#m;constructor(e){this.#m=e}get name(){return this.#m.elem.name}get serviceIdentifier(){return this.#m.elem.serviceIdentifier}get tags(){return this.#m.elem.tags}getAncestor(){if(void 0!==this.#m.previous)return new le(this.#m.previous)}}class he{last;constructor(e){this.last=e}concat(e){return new he({elem:e,previous:this.last})}[Symbol.iterator](){let e=this.last;return{next:()=>{if(void 0===e)return{done:!0,value:void 0};const t=e.elem;return e=e.previous,{done:!1,value:t}}}}}function de(e,t,i){const r=i?.customServiceIdentifier??t.serviceIdentifier,n=(!0===i?.chained?[...e.getBindingsChained(r)]:[...e.getBindings(r)??[]]).filter(e=>e.isSatisfiedBy(t));if(0===n.length&&void 0!==e.autobindOptions&&"function"==typeof r){const t=function(e,t){const i=q(t).scope??e.scope;return{cache:{isRight:!1,value:void 0},id:v(),implementationType:t,isSatisfiedBy:()=>!0,moduleId:void 0,onActivation:void 0,onDeactivation:void 0,scope:i,serviceIdentifier:t,type:A}}(e.autobindOptions,r);e.setBinding(t),n.push(t)}return n}function fe(e){return void 0!==e.redirections}function pe(e,t,i,r){let n,s;fe(i)?(n=i.binding.targetServiceIdentifier,s=i.binding.serviceIdentifier):(n=i.serviceIdentifier,s=i.parent?.binding.serviceIdentifier),Array.isArray(e)?function(e,t,i,r,n){if(0!==e.length){const t=`Ambiguous bindings found for service: "${u(i)}".\n\nRegistered bindings:\n\n${e.map(e=>function(e){switch(e.type){case A:return`[ type: "${e.type}", serviceIdentifier: "${u(e.serviceIdentifier)}", scope: "${e.scope}", implementationType: "${e.implementationType.name}" ]`;case w:return`[ type: "${e.type}", serviceIdentifier: "${u(e.serviceIdentifier)}", redirection: "${u(e.targetServiceIdentifier)}" ]`;default:return`[ type: "${e.type}", serviceIdentifier: "${u(e.serviceIdentifier)}", scope: "${e.scope}" ]`}}(e.binding)).join("\n")}\n\nTrying to resolve bindings for "${ge(i,r)}".\n\n${me(n)}`;throw new G(W.planning,t)}t||ve(i,r,n)}(e,t,n,s,r):function(e,t,i,r,n){void 0!==e||t||ve(i,r,n)}(e,t,n,s,r)}function ve(e,t,i){const r=`No bindings found for service: "${u(e)}".\n\nTrying to resolve bindings for "${ge(e,t)}".\n\n${me(i)}`;throw new G(W.planning,r)}function ge(e,t){return void 0===t?`${u(e)} (Root service)`:u(t)}function me(e){const t=0===e.tags.size?"":`\n- tags:\n  - ${[...e.tags.keys()].map(e=>e.toString()).join("\n  - ")}`;return`Binding constraints:\n- service identifier: ${u(e.serviceIdentifier)}\n- name: ${e.name?.toString()??"-"}${t}`}function Ee(e,t,i){if(1===e.redirections.length){const[r]=e.redirections;return void(fe(r)&&Ee(r,t,i))}pe(e.redirections,t,e,i)}function ye(e,t,i,r){if(Array.isArray(e.bindings)&&1===e.bindings.length){const[r]=e.bindings;return void(fe(r)&&Ee(r,t,i))}pe(e.bindings,t,e,i)}function Se(e){try{const t=new Map;void 0!==e.rootConstraints.tag&&t.set(e.rootConstraints.tag.key,e.rootConstraints.tag.value);const i=new he({elem:{name:e.rootConstraints.name,serviceIdentifier:e.rootConstraints.serviceIdentifier,tags:t},previous:void 0}),r=new le(i.last),n=!!e.rootConstraints.isMultiple&&e.rootConstraints.chained,s=de(e,r,{chained:n}),o=[],a={bindings:o,parent:void 0,serviceIdentifier:e.rootConstraints.serviceIdentifier};if(o.push(...we(e,i,s,a,n)),!e.rootConstraints.isMultiple){ye(a,e.rootConstraints.isOptional??!1,r);const[t]=o;a.bindings=t}return{tree:{root:a}}}catch(t){!function(e,t){if(function(e){return e instanceof Error&&(e instanceof RangeError&&/stack space|call stack|too much recursion/i.test(e.message)||"InternalError"===e.name&&/too much recursion/.test(e.message))}(t)){const i=function(e){const t=[...e];return 0===t.length?"(No dependency trace)":t.map(u).join(" -> ")}(function(e){const t=new Set;for(const i of e.servicesBranch){if(t.has(i))return[...t,i];t.add(i)}return[...t]}(e));throw new G(W.planning,`Circular dependency found: ${i}`,{cause:t})}throw t}(e,t)}}function be(e,t,i,r){const n={binding:t,classMetadata:e.getClassMetadata(t.implementationType),constructorParams:[],parent:r,propertyParams:new Map};return Ce({autobindOptions:e.autobindOptions,getBindings:e.getBindings,getBindingsChained:e.getBindingsChained,getClassMetadata:e.getClassMetadata,node:n,servicesBranch:e.servicesBranch,setBinding:e.setBinding},i)}function Ae(e,t,i){if(i.kind===j.unmanaged)return;const r=l.is(i.value)?i.value.unwrap():i.value,n=t.concat({name:i.name,serviceIdentifier:r,tags:i.tags}),s=new le(n.last),o=i.kind===j.multipleInjection&&i.chained,a=de(e,s,{chained:o}),u=[],c={bindings:u,parent:e.node,serviceIdentifier:r};if(u.push(...we(e,n,a,c,o)),i.kind===j.singleInjection){ye(c,i.optional,s);const[e]=u;c.bindings=e}return c}function _e(e,t,i){const r=l.is(i.value)?i.value.unwrap():i.value,n=t.concat({name:i.name,serviceIdentifier:r,tags:i.tags}),s=new le(n.last),o=i.kind===ue.multipleInjection&&i.chained,a=de(e,s,{chained:o}),u=[],c={bindings:u,parent:e.node,serviceIdentifier:r};if(u.push(...we(e,n,a,c,o)),i.kind===ue.singleInjection){ye(c,i.optional,s);const[e]=u;c.bindings=e}return c}function Re(e,t,i,r){const n={binding:t,params:[],parent:r};return Ce({autobindOptions:e.autobindOptions,getBindings:e.getBindings,getBindingsChained:e.getBindingsChained,getClassMetadata:e.getClassMetadata,node:n,servicesBranch:e.servicesBranch,setBinding:e.setBinding},i)}function we(e,t,i,r,n){const s=fe(r)?r.binding.targetServiceIdentifier:r.serviceIdentifier;e.servicesBranch.push(s);const o=[];for(const s of i)switch(s.type){case A:o.push(be(e,s,t,r));break;case R:o.push(Re(e,s,t,r));break;case w:{const i=Ie(e,t,s,r,n);o.push(i);break}default:o.push({binding:s,parent:r})}return e.servicesBranch.pop(),o}function Ie(e,t,i,r,n){const s={binding:i,parent:r,redirections:[]},o=de(e,new le(t.last),{chained:n,customServiceIdentifier:i.targetServiceIdentifier});return s.redirections.push(...we(e,t,o,s,n)),s}function Ce(e,t){return e.node.binding.type===A?function(e,t,i){const r=t.classMetadata;for(const[n,s]of r.constructorArguments.entries())t.constructorParams[n]=Ae(e,i,s);for(const[n,s]of r.properties){const r=Ae(e,i,s);void 0!==r&&t.propertyParams.set(n,r)}return e.node}(e,e.node,t):function(e,t,i){const r=t.binding.metadata;for(const[n,s]of r.arguments.entries())t.params[n]=_e(e,i,s);return e.node}(e,e.node,t)}class Te{#E;#y;#S;constructor(){this.#E=[],this.#y=8,this.#S=1024}*[Symbol.iterator](){let e=0;for(const t of this.#E){const i=t.deref();void 0===i?++e:yield i}this.#E.length>=this.#y&&this.#b(e)&&this.#A(e)}push(e){const t=new WeakRef(e);if(this.#E.push(t),this.#E.length>=this.#y&&this.#E.length%this.#S===0){let e=0;for(const t of this.#E)void 0===t.deref()&&++e;this.#b(e)&&this.#A(e)}}#A(e){const t=new Array(this.#E.length-e);let i=0;for(const e of this.#E)e.deref()&&(t[i++]=e);this.#E=t}#b(e){return e>=.5*this.#E.length}}!function(e){e[e.singleMandatory=0]="singleMandatory",e[e.singleOptional=1]="singleOptional",e[e.multipleMandatory=2]="multipleMandatory",e[e.multipleOptional=3]="multipleOptional",e[e.length=4]="length"}(ce||(ce={}));class Be{#_;#R;#w;#I;#C;constructor(){this.#_=this.#T(),this.#R=this.#T(),this.#w=this.#T(),this.#I=this.#T(),this.#C=new Te}clearCache(){for(const e of this.#B())e.clear();for(const e of this.#C)e.clearCache()}get(e){return void 0===e.name?void 0===e.tag?this.#M(this.#_,e).get(e.serviceIdentifier):this.#M(this.#I,e).get(e.serviceIdentifier)?.get(e.tag.key)?.get(e.tag.value):void 0===e.tag?this.#M(this.#R,e).get(e.serviceIdentifier)?.get(e.name):this.#M(this.#w,e).get(e.serviceIdentifier)?.get(e.name)?.get(e.tag.key)?.get(e.tag.value)}set(e,t){void 0===e.name?void 0===e.tag?this.#M(this.#_,e).set(e.serviceIdentifier,t):this.#P(this.#P(this.#M(this.#I,e),e.serviceIdentifier),e.tag.key).set(e.tag.value,t):void 0===e.tag?this.#P(this.#M(this.#R,e),e.serviceIdentifier).set(e.name,t):this.#P(this.#P(this.#P(this.#M(this.#w,e),e.serviceIdentifier),e.name),e.tag.key).set(e.tag.value,t)}subscribe(e){this.#C.push(e)}#T(){const e=new Array(ce.length);for(let t=0;t<e.length;++t)e[t]=new Map;return e}#P(e,t){let i=e.get(t);return void 0===i&&(i=new Map,e.set(t,i)),i}#M(e,t){return e[this.#N(t)]}#B(){return[...this.#_,...this.#R,...this.#w,...this.#I]}#N(e){return e.isMultiple?!0===e.optional?ce.multipleOptional:ce.multipleMandatory:!0===e.optional?ce.singleOptional:ce.singleMandatory}}function Me(e,t){return a(t)?(e.cache={isRight:!0,value:t},t.then(t=>Pe(e,t))):Pe(e,t)}function Pe(e,t){return e.cache={isRight:!0,value:t},t}async function Ne(e,t,i){let r=await t,n=i.next();for(;!0!==n.done;)r=await n.value(e.context,r),n=i.next();return r}function Oe(e,t,i){let r=i;if(void 0!==t.onActivation){const i=t.onActivation;r=a(r)?r.then(t=>i(e.context,t)):i(e.context,r)}return function(e,t,i){const r=e.getActivations(t);return void 0===r?i:a(i)?Ne(e,i,r[Symbol.iterator]()):function(e,t,i){let r=t,n=i.next();for(;!0!==n.done;){const t=n.value(e.context,r);if(a(t))return Ne(e,t,i);r=t,n=i.next()}return r}(e,i,r[Symbol.iterator]())}(e,t.serviceIdentifier,r)}function De(e){return(t,i)=>i.cache.isRight?i.cache.value:Me(i,Oe(t,i,e(t,i)))}const Fe=De(function(e,t){return t.value});function xe(e){return e}function ke(e,t){return(i,r)=>{const n=e(r);switch(n.scope){case m:return n.cache.isRight?n.cache.value:Me(n,Oe(i,n,t(i,r)));case g:{if(i.requestScopeCache.has(n.id))return i.requestScopeCache.get(n.id);const e=Oe(i,n,t(i,r));return i.requestScopeCache.set(n.id,e),e}case E:return Oe(i,n,t(i,r))}}}const Le=ke(xe,function(e,t){return t.value(e.context)}),Ue=De(function(e,t){return t.factory(e.context)});function Ge(e,t,i){const r=function(e,t,i){if(void 0!==i){if(!(i in e))throw new G(W.resolution,`Expecting a "${i.toString()}" property when resolving "${t.implementationType.name}" class @postConstruct decorated method, none found.`);if("function"!=typeof e[i])throw new G(W.resolution,`Expecting a "${i.toString()}" method when resolving "${t.implementationType.name}" class @postConstruct decorated method, a non function property was found instead.`);{let r;try{r=e[i]()}catch(e){throw new G(W.resolution,`Unexpected error found when calling "${i.toString()}" @postConstruct decorated method on class "${t.implementationType.name}"`,{cause:e})}if(a(r))return async function(e,t,i){try{await i}catch(i){throw new G(W.resolution,`Unexpected error found when calling "${t.toString()}" @postConstruct decorated method on class "${e.implementationType.name}"`,{cause:i})}}(t,i,r)}}}(e,t,i);return a(r)?r.then(()=>e):e}function We(e){return(t,i,r)=>{const n=new r.binding.implementationType(...t),s=e(i,n,r);return a(s)?s.then(()=>Ge(n,r.binding,r.classMetadata.lifecycle.postConstructMethodName)):Ge(n,r.binding,r.classMetadata.lifecycle.postConstructMethodName)}}const Ve=De(function(e,t){return t.provider(e.context)});function je(e){return e.binding}function qe(e){return e.binding}const He=(Qe=Je,(e,t,i)=>{const r=[];for(const[n,s]of i.propertyParams){const o=i.classMetadata.properties.get(n);if(void 0===o)throw new G(W.resolution,`Expecting metadata at property "${n.toString()}", none found`);o.kind!==j.unmanaged&&void 0!==s.bindings&&(t[n]=Qe(e,s),a(t[n])&&r.push((async()=>{t[n]=await t[n]})()))}if(r.length>0)return Promise.all(r).then(()=>{})}),Ke=function(e){return function t(i,r){const n=[];for(const s of r.redirections)fe(s)?n.push(...t(i,s)):n.push(e(i,s));return n}}(Ze),$e=function(e,t,i){return(r,n)=>{const s=e(r,n);return a(s)?t(s,r,n):i(s,r,n)}}(function(e){return(t,i)=>{const r=[];for(const n of i.constructorParams)void 0===n?r.push(void 0):r.push(e(t,n));return r.some(a)?Promise.all(r):r}}(Je),function(e){return async(t,i,r)=>{const n=await t;return e(n,i,r)}}(We(He)),We(He)),Ye=function(e){return(t,i)=>{const r=e(t,i);return a(r)?r.then(e=>i.binding.factory(...e)):i.binding.factory(...r)}}(function(e){return(t,i)=>{const r=[];for(const n of i.params)r.push(e(t,n));return r.some(a)?Promise.all(r):r}}(Je)),ze=ke(je,$e),Xe=ke(qe,Ye);var Qe;function Ze(e,t){switch(t.binding.type){case y:return Fe(e,t.binding);case S:return Le(e,t.binding);case b:return Ue(e,t.binding);case A:return ze(e,t);case _:return Ve(e,t.binding);case R:return Xe(e,t)}}function Je(e,t){if(void 0!==t.bindings)return Array.isArray(t.bindings)?function(e,t){const i=[];for(const r of t)fe(r)?i.push(...Ke(e,r)):i.push(Ze(e,r));return i.some(a)?Promise.all(i):i}(e,t.bindings):function(e,t){if(fe(t)){const i=Ke(e,t);if(1===i.length)return i[0];throw new G(W.resolution,"Unexpected multiple resolved values on single injection")}return Ze(e,t)}(e,t.bindings)}function et(e){return void 0!==e.scope}function tt(e,t){if(void 0!==e.lifecycle.preDestroyMethodName&&"function"==typeof t[e.lifecycle.preDestroyMethodName])return t[e.lifecycle.preDestroyMethodName]()}function it(e,t,i){const r=e.getDeactivations(t);if(void 0!==r)return a(i)?rt(i,r[Symbol.iterator]()):function(e,t){let i=t.next();for(;!0!==i.done;){if(a(i.value(e)))return rt(e,t);i=t.next()}}(i,r[Symbol.iterator]())}async function rt(e,t){const i=await e;let r=t.next();for(;!0!==r.done;)await r.value(i),r=t.next()}function nt(e,t){const i=function(e,t){if(t.type===A){const i=e.getClassMetadata(t.implementationType),r=t.cache.value;return a(r)?r.then(e=>tt(i,e)):tt(i,r)}}(e,t);return void 0===i?st(e,t):i.then(()=>st(e,t))}function st(e,t){const i=t.cache;return a(i.value)?i.value.then(i=>ot(e,t,i)):ot(e,t,i.value)}function ot(e,t,i){let r;return void 0!==t.onDeactivation&&(r=(0,t.onDeactivation)(i)),void 0===r?it(e,t.serviceIdentifier,i):r.then(()=>it(e,t.serviceIdentifier,i))}function at(e,t){if(void 0===t)return;const i=function(e){const t=[];for(const i of e)et(i)&&i.scope===m&&i.cache.isRight&&t.push(i);return t}(t),r=[];for(const t of i){const i=nt(e,t);void 0!==i&&r.push(i)}return r.length>0?Promise.all(r).then(()=>{}):void 0}function ut(e,t){const i=e.getBindings(t);return at(e,i)}const ct=Symbol.for("@inversifyjs/plugin/isPlugin"),lt=Symbol.for("@inversifyjs/container/bindingIdentifier");function ht(e){return"object"==typeof e&&null!==e&&!0===e[lt]}class dt{static always=e=>!0}function ft(e){return{[lt]:!0,id:e.id}}function pt(e){return t=>{for(let i=t.getAncestor();void 0!==i;i=i.getAncestor())if(e(i))return!0;return!1}}function vt(e){return t=>t.name===e}function gt(e){return t=>t.serviceIdentifier===e}function mt(e,t){return i=>i.tags.has(e)&&i.tags.get(e)===t}function Et(e){return void 0===e.name&&0===e.tags.size}function yt(e){const t=pt(e);return e=>!t(e)}function St(e){return t=>{const i=t.getAncestor();return void 0===i||!e(i)}}function bt(e){return t=>{const i=t.getAncestor();return void 0!==i&&e(i)}}class At{#r;constructor(e){this.#r=e}getIdentifier(){return ft(this.#r)}inRequestScope(){return this.#r.scope=g,new It(this.#r)}inSingletonScope(){return this.#r.scope=m,new It(this.#r)}inTransientScope(){return this.#r.scope=E,new It(this.#r)}}class _t{#t;#s;#o;#a;constructor(e,t,i,r){this.#t=e,this.#s=t,this.#o=i,this.#a=r}to(e){const t=q(e),i={cache:{isRight:!1,value:void 0},id:v(),implementationType:e,isSatisfiedBy:dt.always,moduleId:this.#s,onActivation:void 0,onDeactivation:void 0,scope:t.scope??this.#o,serviceIdentifier:this.#a,type:A};return this.#t(i),new Ct(i)}toSelf(){if("function"!=typeof this.#a)throw new Error('"toSelf" function can only be applied when a newable function is used as service identifier');return this.to(this.#a)}toConstantValue(e){const t={cache:{isRight:!1,value:void 0},id:v(),isSatisfiedBy:dt.always,moduleId:this.#s,onActivation:void 0,onDeactivation:void 0,scope:m,serviceIdentifier:this.#a,type:y,value:e};return this.#t(t),new It(t)}toDynamicValue(e){const t={cache:{isRight:!1,value:void 0},id:v(),isSatisfiedBy:dt.always,moduleId:this.#s,onActivation:void 0,onDeactivation:void 0,scope:this.#o,serviceIdentifier:this.#a,type:S,value:e};return this.#t(t),new Ct(t)}toResolvedValue(e,t){const i={cache:{isRight:!1,value:void 0},factory:e,id:v(),isSatisfiedBy:dt.always,metadata:this.#n(t),moduleId:this.#s,onActivation:void 0,onDeactivation:void 0,scope:this.#o,serviceIdentifier:this.#a,type:R};return this.#t(i),new Ct(i)}toFactory(e){const t={cache:{isRight:!1,value:void 0},factory:e,id:v(),isSatisfiedBy:dt.always,moduleId:this.#s,onActivation:void 0,onDeactivation:void 0,scope:m,serviceIdentifier:this.#a,type:b};return this.#t(t),new It(t)}toProvider(e){const t={cache:{isRight:!1,value:void 0},id:v(),isSatisfiedBy:dt.always,moduleId:this.#s,onActivation:void 0,onDeactivation:void 0,provider:e,scope:m,serviceIdentifier:this.#a,type:_};return this.#t(t),new It(t)}toService(e){const t={id:v(),isSatisfiedBy:dt.always,moduleId:this.#s,serviceIdentifier:this.#a,targetServiceIdentifier:e,type:w};this.#t(t)}#n(e){return{arguments:(e??[]).map(e=>function(e){return"object"==typeof e&&!l.is(e)}(e)?function(e){return!0===e.isMultiple}(e)?{chained:e.chained??!1,kind:ue.multipleInjection,name:e.name,optional:e.optional??!1,tags:new Map((e.tags??[]).map(e=>[e.key,e.value])),value:e.serviceIdentifier}:{kind:ue.singleInjection,name:e.name,optional:e.optional??!1,tags:new Map((e.tags??[]).map(e=>[e.key,e.value])),value:e.serviceIdentifier}:{kind:ue.singleInjection,name:void 0,optional:!1,tags:new Map,value:e})}}}class Rt{#r;constructor(e){this.#r=e}getIdentifier(){return ft(this.#r)}onActivation(e){return this.#r.onActivation=e,new wt(this.#r)}onDeactivation(e){return this.#r.onDeactivation=e,new wt(this.#r)}}class wt{#r;constructor(e){this.#r=e}getIdentifier(){return ft(this.#r)}when(e){return this.#r.isSatisfiedBy=e,new Rt(this.#r)}whenAnyAncestor(e){return this.when(pt(e))}whenAnyAncestorIs(e){return this.when(pt(gt(e)))}whenAnyAncestorNamed(e){return this.when(function(e){return pt(vt(e))}(e))}whenAnyAncestorTagged(e,t){return this.when(function(e,t){return pt(mt(e,t))}(e,t))}whenDefault(){return this.when(Et)}whenNamed(e){return this.when(vt(e))}whenNoParent(e){return this.when(St(e))}whenNoParentIs(e){return this.when(St(gt(e)))}whenNoParentNamed(e){return this.when(function(e){return St(vt(e))}(e))}whenNoParentTagged(e,t){return this.when(function(e,t){return St(mt(e,t))}(e,t))}whenParent(e){return this.when(bt(e))}whenParentIs(e){return this.when(bt(gt(e)))}whenParentNamed(e){return this.when(function(e){return bt(vt(e))}(e))}whenParentTagged(e,t){return this.when(function(e,t){return bt(mt(e,t))}(e,t))}whenTagged(e,t){return this.when(mt(e,t))}whenNoAncestor(e){return this.when(yt(e))}whenNoAncestorIs(e){return this.when(yt(gt(e)))}whenNoAncestorNamed(e){return this.when(function(e){return yt(vt(e))}(e))}whenNoAncestorTagged(e,t){return this.when(function(e,t){return yt(mt(e,t))}(e,t))}}class It extends wt{#u;constructor(e){super(e),this.#u=new Rt(e)}onActivation(e){return this.#u.onActivation(e)}onDeactivation(e){return this.#u.onDeactivation(e)}}class Ct extends It{#c;constructor(e){super(e),this.#c=new At(e)}inRequestScope(){return this.#c.inRequestScope()}inSingletonScope(){return this.#c.inSingletonScope()}inTransientScope(){return this.#c.inTransientScope()}}const Tt=Symbol.for("@inversifyjs/container/InversifyContainerError");class Bt extends Error{[Tt];kind;constructor(e,t,i){super(t,i),this[Tt]=!0,this.kind=e}static is(e){return"object"==typeof e&&null!==e&&!0===e[Tt]}static isErrorOfKind(e,t){return Bt.is(e)&&e.kind===t}}var Mt;!function(e){e[e.invalidOperation=0]="invalidOperation"}(Mt||(Mt={}));class Pt{#h;#o;#l;constructor(e,t,i){this.#h=e,this.#o=t,this.#l=i}bind(e){return new _t(e=>{this.#v(e)},void 0,this.#o,e)}isBound(e,t){const i=this.#l.bindingService.get(e);return this.#m(e,i,t)}isCurrentBound(e,t){const i=this.#l.bindingService.getNonParentBindings(e);return this.#m(e,i,t)}async rebind(e){return await this.unbind(e),this.bind(e)}rebindSync(e){return this.unbindSync(e),this.bind(e)}async unbind(e){await this.#p(e)}async unbindAll(){const e=[...this.#l.bindingService.getNonParentBoundServices()];await Promise.all(e.map(async e=>ut(this.#h,e)));for(const t of e)this.#l.activationService.removeAllByServiceId(t),this.#l.bindingService.removeAllByServiceId(t),this.#l.deactivationService.removeAllByServiceId(t);this.#l.planResultCacheService.clearCache()}unbindSync(e){void 0!==this.#p(e)&&this.#f(e)}#v(e){this.#l.bindingService.set(e),this.#l.planResultCacheService.clearCache()}#f(e){let t;if(ht(e)){const r=this.#l.bindingService.getById(e.id),n=(i=r,function(e){if(void 0===e)return;const t=e.next();return!0!==t.done?t.value:void 0}(i?.[Symbol.iterator]()))?.serviceIdentifier;t=void 0===n?"Unexpected asynchronous deactivation when unbinding binding identifier. Consider using Container.unbind() instead.":`Unexpected asynchronous deactivation when unbinding "${u(n)}" binding. Consider using Container.unbind() instead.`}else t=`Unexpected asynchronous deactivation when unbinding "${u(e)}" service. Consider using Container.unbind() instead.`;var i;throw new Bt(Mt.invalidOperation,t)}#p(e){return ht(e)?this.#A(e):this.#d(e)}#A(e){const t=this.#l.bindingService.getById(e.id),i=at(this.#h,t);if(void 0!==i)return i.then(()=>{this.#R(e)});this.#R(e)}#R(e){this.#l.bindingService.removeById(e.id),this.#l.planResultCacheService.clearCache()}#d(e){const t=ut(this.#h,e);if(void 0!==t)return t.then(()=>{this.#y(e)});this.#y(e)}#y(e){this.#l.activationService.removeAllByServiceId(e),this.#l.bindingService.removeAllByServiceId(e),this.#l.deactivationService.removeAllByServiceId(e),this.#l.planResultCacheService.clearCache()}#m(e,t,i){if(void 0===t)return!1;const r={getAncestor:()=>{},name:i?.name,serviceIdentifier:e,tags:new Map};void 0!==i?.tag&&r.tags.set(i.tag.key,i.tag.value);for(const e of t)if(e.isSatisfiedBy(r))return!0;return!1}}class Nt{#w;#h;#o;#l;constructor(e,t,i,r){this.#w=e,this.#h=t,this.#o=i,this.#l=r}async load(...e){await Promise.all(this.#i(...e))}loadSync(...e){const t=this.#i(...e);for(const e of t)if(void 0!==e)throw new Bt(Mt.invalidOperation,"Unexpected asynchronous module load. Consider using Container.load() instead.")}async unload(...e){await Promise.all(this.#E(...e)),this.#g(e)}unloadSync(...e){const t=this.#E(...e);for(const e of t)if(void 0!==e)throw new Bt(Mt.invalidOperation,"Unexpected asynchronous module unload. Consider using Container.unload() instead.");this.#g(e)}#b(e){return{bind:t=>new _t(e=>{this.#v(e)},e,this.#o,t),isBound:this.#w.isBound.bind(this.#w),onActivation:(t,i)=>{this.#l.activationService.add(i,{moduleId:e,serviceId:t})},onDeactivation:(t,i)=>{this.#l.deactivationService.add(i,{moduleId:e,serviceId:t})},rebind:this.#w.rebind.bind(this.#w),rebindSync:this.#w.rebindSync.bind(this.#w),unbind:this.#w.unbind.bind(this.#w),unbindSync:this.#w.unbindSync.bind(this.#w)}}#g(e){for(const t of e)this.#l.activationService.removeAllByModuleId(t.id),this.#l.bindingService.removeAllByModuleId(t.id),this.#l.deactivationService.removeAllByModuleId(t.id);this.#l.planResultCacheService.clearCache()}#i(...e){return e.map(e=>e.load(this.#b(e.id)))}#v(e){this.#l.bindingService.set(e),this.#l.planResultCacheService.clearCache()}#E(...e){return e.map(e=>function(e,t){const i=e.getBindingsFromModule(t);return at(e,i)}(this.#h,e.id))}}class Ot{#S;#O;#T;#l;constructor(e,t,i){this.#l=t,this.#T=i,this.#S=this.#C(e),this.#O=this.#B()}register(e,t){const i=new t(e,this.#O);if(!0!==i[ct])throw new Bt(Mt.invalidOperation,"Invalid plugin. The plugin must extend the Plugin class");i.load(this.#S)}#C(e){return{define:(t,i)=>{if(Object.prototype.hasOwnProperty.call(e,t))throw new Bt(Mt.invalidOperation,`Container already has a method named "${String(t)}"`);e[t]=i},onPlan:this.#T.onPlan.bind(this.#T)}}#B(){const e=this.#l;return{get activationService(){return e.activationService},get bindingService(){return e.bindingService},get deactivationService(){return e.deactivationService},get planResultCacheService(){return e.planResultCacheService}}}}class Dt{activationService;bindingService;deactivationService;planResultCacheService;#P;constructor(e,t,i,r){this.activationService=e,this.bindingService=t,this.deactivationService=i,this.planResultCacheService=r,this.#P=[]}reset(e,t,i){this.activationService=e,this.bindingService=t,this.deactivationService=i,this.planResultCacheService.clearCache();for(const e of this.#P)e()}onReset(e){this.#P.push(e)}}class Ft{#D;#o;#F;#N;#x;#k;#_;#l;#L;constructor(e,t,i){this.#l=e,this.#k=this.#I(),this.#D=t,this.#o=i,this.#F=e=>this.#l.activationService.get(e),this.#N=this.#l.bindingService.get.bind(this.#l.bindingService),this.#x=this.#l.bindingService.getChained.bind(this.#l.bindingService),this.#_=[],this.#L=this.#v.bind(this),this.#l.onReset(()=>{this.#U()})}get(e,t){const i=this.#G(!1,e,t),r=this.#W(i);if(a(r))throw new Bt(Mt.invalidOperation,`Unexpected asynchronous service when resolving service "${u(e)}"`);return r}getAll(e,t){const i=this.#G(!0,e,t),r=this.#W(i);if(a(r))throw new Bt(Mt.invalidOperation,`Unexpected asynchronous service when resolving service "${u(e)}"`);return r}async getAllAsync(e,t){const i=this.#G(!0,e,t);return this.#W(i)}async getAsync(e,t){const i=this.#G(!1,e,t);return this.#W(i)}onPlan(e){this.#_.push(e)}#U(){this.#N=this.#l.bindingService.get.bind(this.#l.bindingService),this.#L=this.#v.bind(this),this.#k=this.#I()}#V(e,t,i){return{isMultiple:e,name:i?.name,optional:i?.optional,serviceIdentifier:t,tag:i?.tag}}#M(e,t,i){const r={autobindOptions:i?.autobind??this.#D?{scope:this.#o}:void 0,getBindings:this.#N,getBindingsChained:this.#x,getClassMetadata:q,rootConstraints:this.#j(e,t,i),servicesBranch:[],setBinding:this.#L};return this.#q(r,i),r}#j(e,t,i){return t?{chained:i?.chained??!1,isMultiple:t,serviceIdentifier:e}:{isMultiple:t,serviceIdentifier:e}}#G(e,t,i){const r=this.#V(e,t,i),n=this.#l.planResultCacheService.get(r);if(void 0!==n)return n;const s=Se(this.#M(t,e,i));this.#l.planResultCacheService.set(r,s);for(const e of this.#_)e(r,s);return s}#I(){return{get:this.get.bind(this),getAll:this.getAll.bind(this),getAllAsync:this.getAllAsync.bind(this),getAsync:this.getAsync.bind(this)}}#W(e){return function(e){return Je(e,e.planResult.tree.root)}({context:this.#k,getActivations:this.#F,planResult:e,requestScopeCache:new Map})}#q(e,t){void 0!==t&&(void 0!==t.name&&(e.rootConstraints.name=t.name),!0===t.optional&&(e.rootConstraints.isOptional=!0),void 0!==t.tag&&(e.rootConstraints.tag={key:t.tag.key,value:t.tag.value}),e.rootConstraints.isMultiple&&(e.rootConstraints.chained=t?.chained??!1))}#v(e){this.#l.bindingService.set(e),this.#l.planResultCacheService.clearCache()}}class xt{#l;#H;constructor(e){this.#l=e,this.#H=[]}restore(){const e=this.#H.pop();if(void 0===e)throw new Bt(Mt.invalidOperation,"No snapshot available to restore");this.#l.reset(e.activationService,e.bindingService,e.deactivationService)}snapshot(){this.#H.push({activationService:this.#l.activationService.clone(),bindingService:this.#l.bindingService.clone(),deactivationService:this.#l.deactivationService.clone()})}}const kt=E;class Lt{#w;#K;#$;#l;#T;#Y;constructor(e){this.#l=this.#z(e);const t=e?.autobind??!1,i=e?.defaultScope??kt,r={getBindings:(n=this.#l).bindingService.get.bind(n.bindingService),getBindingsFromModule:n.bindingService.getByModuleId.bind(n.bindingService),getClassMetadata:q,getDeactivations:n.deactivationService.get.bind(n.deactivationService)};var n;this.#w=new Pt(r,i,this.#l),this.#K=new Nt(this.#w,r,i,this.#l),this.#T=new Ft(this.#l,t,i),this.#$=new Ot(this,this.#l,this.#T),this.#Y=new xt(this.#l)}bind(e){return this.#w.bind(e)}get(e,t){return this.#T.get(e,t)}getAll(e,t){return this.#T.getAll(e,t)}async getAllAsync(e,t){return this.#T.getAllAsync(e,t)}async getAsync(e,t){return this.#T.getAsync(e,t)}isBound(e,t){return this.#w.isBound(e,t)}isCurrentBound(e,t){return this.#w.isCurrentBound(e,t)}async load(...e){return this.#K.load(...e)}loadSync(...e){this.#K.loadSync(...e)}onActivation(e,t){this.#l.activationService.add(t,{serviceId:e})}onDeactivation(e,t){this.#l.deactivationService.add(t,{serviceId:e})}register(e){this.#$.register(this,e)}restore(){this.#Y.restore()}async rebind(e){return this.#w.rebind(e)}rebindSync(e){return this.#w.rebindSync(e)}snapshot(){this.#Y.snapshot()}async unbind(e){await this.#w.unbind(e)}async unbindAll(){return this.#w.unbindAll()}unbindSync(e){this.#w.unbindSync(e)}async unload(...e){return this.#K.unload(...e)}unloadSync(...e){this.#K.unloadSync(...e)}#z(e){if(void 0===e?.parent)return new Dt(P.build(void 0),D.build(void 0),F.build(void 0),new Be);const t=new Be;return e.parent.#l.planResultCacheService.subscribe(t),new Dt(P.build(e.parent.#l.activationService),D.build(e.parent.#l.bindingService),F.build(e.parent.#l.deactivationService),t)}}const Ut={AudioContextManager:Symbol.for("AudioContextManager"),AudioEditor:Symbol.for("AudioEditor"),AudioProcessor:Symbol.for("AudioProcessor"),BufferManager:Symbol.for("BufferManager"),FilterManager:Symbol.for("FilterManager"),RendererManager:Symbol.for("RendererManager"),SaveBufferManager:Symbol.for("SaveBufferManager"),ConfigService:Symbol.for("ConfigService"),EventEmitter:Symbol.for("EventEmitter"),BufferPlayer:Symbol.for("BufferPlayer"),BufferDecoderService:Symbol.for("BufferDecoderService"),BufferFetcherService:Symbol.for("BufferFetcherService"),AudioBuffersToFetch:Symbol.for("AudioBuffersToFetch"),Renderers:Symbol.for("Renderers"),Filters:Symbol.for("Filters"),AudioEncoderManager:Symbol.for("AudioEncoderManager"),AudioEncoders:Symbol.for("AudioEncoders"),EntryPointFilter:Symbol.for("EntryPointFilter"),VoiceRecorder:Symbol.for("VoiceRecorder")};let Gt=class{constructor(){this.bufferFetcherService=null,this.bufferDecoderService=null,this.configService=null,this.eventEmitter=null,this.contextManager=null}injectDependencies(e,t,i,r,n){e&&(this.bufferFetcherService=e),t&&(this.bufferDecoderService=t),i&&(this.configService=i),r&&(this.eventEmitter=r),n&&(this.contextManager=n)}};e([J(Ut.BufferFetcherService),i("design:type",Object)],Gt.prototype,"bufferFetcherService",void 0),e([J(Ut.BufferDecoderService),i("design:type",Object)],Gt.prototype,"bufferDecoderService",void 0),e([J(Ut.ConfigService),i("design:type",Object)],Gt.prototype,"configService",void 0),e([J(Ut.EventEmitter),i("design:type",Object)],Gt.prototype,"eventEmitter",void 0),e([J(Ut.AudioContextManager),i("design:type",Object)],Gt.prototype,"contextManager",void 0),Gt=e([ie()],Gt);var Wt=Gt;const Vt={calcAudioDuration:(e,t)=>{if(e){let i=e.duration+1;return null!=t&&(i/=t),i}return 0},loadAudioBuffer:(e,t)=>r(void 0,void 0,void 0,function*(){const i=yield Vt.readAsArrayBufferPromisified(t),r=yield e.decodeAudioData(i);return Vt.decodeBuffer(e,r)}),readAsArrayBufferPromisified:e=>new Promise((t,i)=>{const r=new FileReader;r.onload=e=>{var r;const n=null===(r=null==e?void 0:e.target)||void 0===r?void 0:r.result;n instanceof ArrayBuffer?t(n):i()},e&&r.readAsArrayBuffer(e)}),decodeBuffer:(e,t)=>{if(1==t.numberOfChannels){e.resume();const{duration:i}=t,{sampleRate:r}=e,n=e.createBuffer(2,r*i+2*r,r),s=t.getChannelData(0),o=n.getChannelData(0),a=n.getChannelData(1);for(let e=0;e<s.length;e++)o[e]=s[e],a[e]=s[e];return n}return t},convertAudioBufferToFloat32Array:e=>{const t=[];for(let i=0;i<e.numberOfChannels;i++)t.push(e.getChannelData(i));return t},convertAudioParamToFloat32Array:(e,t)=>{const i=new Float32Array(t);for(let r=0;r<t;r++)i.set([e.value],r);return i},sumAudioBufferChannel:(e,t)=>e.getChannelData(t).reduce((e,t)=>e+t,0),sumAudioBuffer(e){let t=0;for(let i=0;i<e.numberOfChannels;i++)t+=this.sumAudioBufferChannel(e,i);return t},isAudioWorkletCompatible:e=>void 0!==e&&void 0!==e.audioWorklet,isSettingValueValid:e=>!(void 0===e||isNaN(Number(e))||"string"==typeof e&&""===e.trim()),calculateAudioDuration(e,t,i){if(e&&t){const r=this.calcAudioDuration(e,i),n=t.getAddingTime();return n?r+n:r}return 0},forceDownload(e,t){const i=window.document.createElement("a"),r=URL.createObjectURL(e);window.document.body.appendChild(i),i.href=r,i.download=t||"output.wav",i.click(),URL.revokeObjectURL(r),window.document.body.removeChild(i)},clearAudioBuffer(e){if(e)for(let t=0;t<e.numberOfChannels;t++){const i=e.getChannelData(t);for(let e=0;e<i.length;e++)i[e]=0}},floatTo16BitPCM(e,t,i){for(let r=0;r<i.length;r++,t+=2){const n=this.clampFloatValue(i[r]);e.setInt16(t,n<0?32768*n:32767*n,!0)}},convertFloat32Array2Int16(e){const t=new Int16Array(e.length);for(let i=0,r=e.length;i<r;i++){const r=this.clampFloatValue(e[i]);t[i]=Math.round(32767*r)}return t},clampFloatValue:e=>Math.max(-1,Math.min(1,e)),writeStringToDataView(e,t,i){for(let r=0;r<i.length;r++)e.setUint8(t+r,i.charCodeAt(r))},interleaveBuffers(e,t){const i=e.length+t.length;if(0===i)throw new Error("interleaveBuffers: input buffers are empty or invalid");const r=new(0,e.constructor)(i);let n=0,s=0;for(;n<i;)r[n++]=e[s],r[n++]=t[s],s++;return r},getLengthFromBuffers:e=>e?e.reduce((e,t)=>e+t.length,0):0,mergeBuffers(e){const t=this.getLengthFromBuffers(e);if(0===t)throw new Error("mergeTypedArrayBuffers: input buffers are empty or invalid");const i=new(0,e[0].constructor)(t);let r=0;for(const t of e)t?(i.set(t,r),r+=t.length):console.warn("mergeTypedArrayBuffers: undefined buffer has been detected");return i}};var jt;exports.EventType=void 0,(jt=exports.EventType||(exports.EventType={})).LOADING_BUFFERS="loadingBuffers",jt.LOADING_BUFFERS_ERROR="loadingBuffersError",jt.FETCHING_BUFFERS="fetchingBuffers",jt.FETCHING_BUFFERS_ERROR="fetchingBuffersError",jt.FINISHED_FETCHING_BUFFERS="finishedFetchingBuffers",jt.LOADED_BUFFERS="loadedBuffers",jt.COMPATIBILITY_MODE_AUTO_ENABLED="compatibilityModeAutoEnabled",jt.STARTED_RENDERING_AUDIO="renderingAudio",jt.RENDERING_AUDIO_PROBLEM_DETECTED="renderingAudioProblemDetected",jt.AUDIO_RENDERING_FINISHED="audioRenderingFinished",jt.AUDIO_RENDERING_EXCEPTION_THROWN="audioRenderingExceptionThrown",jt.OFFLINE_AUDIO_RENDERING_FINISHED="offlineAudioRenderingFinished",jt.PLAYING_STOPPED="playingStopped",jt.PLAYING_STARTED="playingStarted",jt.PLAYING_FINISHED="playingFinished",jt.PLAYING_UPDATE="playingUpdate",jt.RECORDER_INIT="recorderInit",jt.RECORDER_SUCCESS="recorderSuccess",jt.RECORDER_ERROR="recorderError",jt.RECORDER_UPDATE_CONSTRAINTS="recorderUpdateConstraints",jt.RECORDER_RECORDING="recorderRecording",jt.RECORDER_STOPPED="recorderStopped",jt.RECORDER_PAUSED="recorderPaused",jt.RECORDER_RESETED="recorderReseted",jt.RECORDER_COUNT_UPDATE="recorderCountUpdate",jt.SAMPLE_RATE_CHANGED="sampleRateChanged",jt.DECODING_AUDIO_FILE="decodingAudioFile",jt.DECODED_AUDIO_FILE="decodedAudioFile",jt.ERROR_DECODING_AUDIO_FILE="errorDecodingAudioFile",jt.RECORDER_NOT_FOUND_ERROR="recorderNotFoundError",jt.RECORDER_UNKNOWN_ERROR="recorderUnknownError",jt.UPDATE_AUDIO_TREATMENT_PERCENT="updateAudioTreatmentPercent",jt.UPDATE_REMAINING_TIME_ESTIMATED="updateRemainingTimeEstimated",jt.CANCELLED_AND_LOADED_INITIAL_AUDIO="cancelledAndLoadedInitialAudio",jt.CANCELLING_AUDIO_PROCESSING="cancellingAudioProcessing",jt.PLAYING_FINISHED_LOOP_ALL="playingFinishedLoopAll",jt.LOADED_AUDIO_FILE_FROM_LIST="loadedAudioFileFromList",jt.AUDIO_SPEED_UPDATED="audioSpeedUpdated",jt.AUDIO_DURATION_UPDATED="audioDurationUpdated",jt.FALLBACK_WORKLET_TO_SCRIPT_PROCESSOR="fallbackWorkletToScriptProcessor",jt.WORKLET_SUCCESSFULLY_LOADED="workletSuccessfullyLoaded";let qt=class extends Wt{constructor(e,t,i,r,n,s,o){super(),this.principalBuffer=null,this.fileList=null,this.fileListCurrIndex=0,this.loadingAudio=!1,this.renderingAudio=!1,this.filterManager=e,this.rendererManager=t,this.contextManager=i,this.saveBufferManager=r,this.audioProcessor=n,this.bufferManager=s,this.bufferPlayer=o}setup(){this.eventEmitter?(this.eventEmitter.on(exports.EventType.PLAYING_STARTED,()=>r(this,void 0,void 0,function*(){this.bufferPlayer&&this.bufferPlayer.compatibilityMode&&this.contextManager&&this.contextManager.currentContext&&this.audioProcessor&&(yield this.audioProcessor.setupOutput(this.principalBuffer,this.contextManager.currentContext))})),this.eventEmitter.on(exports.EventType.PLAYING_FINISHED,()=>{this.bufferPlayer&&this.bufferPlayer.loop&&this.bufferPlayer.start()}),this.eventEmitter.on(exports.EventType.PLAYING_FINISHED_LOOP_ALL,()=>r(this,void 0,void 0,function*(){this.bufferPlayer&&this.bufferPlayer.loopAll&&!this.renderingAudio&&!this.loadingAudio&&(yield this.loadNextAudio(!0),this.bufferPlayer.start())}))):console.error("Event Emitter is not available!")}addFilters(...e){this.filterManager&&this.filterManager.addFilters(...e)}addRenderers(...e){this.rendererManager&&this.rendererManager.addRenderers(...e)}get currentSampleRate(){return this.contextManager?this.contextManager.currentSampleRate:0}get defaultDeviceSampleRate(){const e=new AudioContext,{sampleRate:t}=e;return e&&e.close(),t}loadBufferFromFile(e){return r(this,void 0,void 0,function*(){if(this.loadingAudio=!0,this.audioProcessor&&(yield this.audioProcessor.prepareContext(this.principalBuffer)),!(this.contextManager&&this.contextManager.currentContext&&this.bufferDecoderService&&this.audioProcessor))throw this.loadingAudio=!1,new Error("Audio Context is not ready!");if(this.clearPrincipalBuffer(),this.principalBuffer=yield this.bufferDecoderService.decodeBufferFromFile(e),this.audioProcessor.initialRenderingDone=!1,!this.principalBuffer)throw this.loadingAudio=!1,new Error("Error decoding audio file");this.audioProcessor.sumInputBuffer=Vt.sumAudioBuffer(this.principalBuffer),this.audioProcessor.resetAudioRenderingProgress(),this.bufferPlayer&&this.bufferPlayer.loopAll&&this.totalFileList<=1&&this.bufferPlayer.toggleLoop(),this.loadingAudio=!1})}loadFileList(e){return r(this,void 0,void 0,function*(){this.fileList=e,yield this.loadBufferFromFileListIndex(0)})}loadBufferFromFileListIndex(e){return r(this,void 0,void 0,function*(){if(this.fileList){this.fileListCurrIndex=e;const t=this.fileList.item(this.fileListCurrIndex);this.eventEmitter&&this.eventEmitter.emit(exports.EventType.LOADED_AUDIO_FILE_FROM_LIST,e),t&&(yield this.loadBufferFromFile(t))}})}loadPreviousAudio(e){return r(this,void 0,void 0,function*(){const t=this.currentIndexFileList,i=this.totalFileList,r=t-1;r!=t&&(r<0?yield this.loadBufferFromFileListIndex(i-1):yield this.loadBufferFromFileListIndex(r),yield this.renderAudio(e))})}loadNextAudio(e){return r(this,void 0,void 0,function*(){const t=this.currentIndexFileList,i=this.totalFileList,r=t+1;r!=t&&(r>=i?yield this.loadBufferFromFileListIndex(0):yield this.loadBufferFromFileListIndex(r),yield this.renderAudio(e))})}getCurrentFileList(){if(this.fileList){const e=new Map;for(let t=0;t<this.fileList.length;t++){const i=this.fileList.item(t);i&&e.set(i.name,this.currentIndexFileList===t)}return e}return new Map}get currentIndexFileList(){return this.fileListCurrIndex}get totalFileList(){return this.fileList?this.fileList.length:0}loadBuffer(e){this.principalBuffer=e,this.audioProcessor&&(this.audioProcessor.sumInputBuffer=Vt.sumAudioBuffer(this.principalBuffer),this.audioProcessor.initialRenderingDone=!1)}getOutputBuffer(){return this.audioProcessor?this.audioProcessor.renderedBuffer:null}renderAudio(e){return r(this,void 0,void 0,function*(){if(this.audioProcessor)try{this.renderingAudio=!0,this.eventEmitter&&this.eventEmitter.emit(exports.EventType.STARTED_RENDERING_AUDIO);const t=yield this.audioProcessor.renderAudio(this.principalBuffer,e);return this.eventEmitter&&this.eventEmitter.emit(exports.EventType.AUDIO_RENDERING_FINISHED),this.renderingAudio=!1,t}catch(e){this.eventEmitter&&(this.eventEmitter.emit(exports.EventType.AUDIO_RENDERING_FINISHED),this.eventEmitter.emit(exports.EventType.AUDIO_RENDERING_EXCEPTION_THROWN,e)),this.renderingAudio=!1}return!1})}isAudioWorkletAvailable(){return!(!this.contextManager||!this.contextManager.currentContext)&&Vt.isAudioWorkletCompatible(this.contextManager.currentContext)}getFiltersState(){return this.filterManager&&this.rendererManager?Object.assign(Object.assign({},this.filterManager.getFiltersState()),this.rendererManager.getRenderersState()):{}}getFiltersSettings(){return this.filterManager?this.filterManager.getFiltersSettings():new Map}reconnectNodesIfNeeded(){return r(this,void 0,void 0,function*(){if(this.contextManager&&this.bufferPlayer&&this.bufferPlayer.compatibilityMode&&this.contextManager.currentContext&&this.principalBuffer&&this.filterManager&&this.filterManager.entrypointFilter&&(yield this.filterManager.connectNodes(this.contextManager.currentContext,this.principalBuffer,!0,this.bufferPlayer.compatibilityMode),this.audioProcessor)){const e=this.filterManager.entrypointFilter.getSpeed(),t=Vt.calculateAudioDuration(this.principalBuffer,this.filterManager,e);this.audioProcessor.updateAudioSpeedAndDuration(t)}})}enableFilter(e){this.rendererManager&&this.rendererManager.enableRenderer(e),this.filterManager&&(this.filterManager.enableFilter(e),this.reconnectNodesIfNeeded())}disableFilter(e){this.rendererManager&&this.rendererManager.disableRenderer(e),this.filterManager&&(this.filterManager.disableFilter(e),this.reconnectNodesIfNeeded())}toggleFilter(e){this.rendererManager&&this.rendererManager.toggleRenderer(e),this.filterManager&&(this.filterManager.toggleFilter(e),this.reconnectNodesIfNeeded())}changeFilterSettings(e,t){return r(this,void 0,void 0,function*(){this.filterManager&&(yield this.filterManager.changeFilterSettings(e,t),yield this.reconnectNodesIfNeeded())})}resetFilterSettings(e){return r(this,void 0,void 0,function*(){this.filterManager&&(yield this.filterManager.resetFilterSettings(e),yield this.reconnectNodesIfNeeded())})}resetAllFiltersState(){this.rendererManager&&this.rendererManager.resetAllRenderersState(),this.filterManager&&(this.filterManager.resetAllFiltersState(),this.reconnectNodesIfNeeded())}exit(){this.bufferPlayer&&(this.bufferPlayer.stop(),this.bufferPlayer.reset()),this.cancelAudioRendering(),this.clearBuffers(),this.fileList=null,this.fileListCurrIndex=0}clearBuffers(){this.clearPrincipalBuffer(),this.clearRenderedBuffer()}clearPrincipalBuffer(){Vt.clearAudioBuffer(this.principalBuffer),this.principalBuffer=null}clearRenderedBuffer(){this.audioProcessor&&this.audioProcessor.clearRenderedBuffer()}cancelAudioRendering(){this.audioProcessor&&this.audioProcessor.cancelAudioRendering()}on(e,t){this.eventEmitter&&this.eventEmitter.on(e,t)}off(e,t){this.eventEmitter&&this.eventEmitter.off(e,t)}saveBuffer(e){var t;return this.saveBufferManager&&this.audioProcessor?null===(t=this.saveBufferManager)||void 0===t?void 0:t.saveBuffer(this.audioProcessor.renderedBuffer,e):Promise.resolve(!1)}set downloadingInitialData(e){this.bufferManager&&(this.bufferManager.downloadingInitialData=e)}get downloadingInitialData(){return!!this.bufferManager&&this.bufferManager.downloadingInitialData}};e([ae(),i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",void 0)],qt.prototype,"setup",null),qt=e([ie(),se(),t(0,J(Ut.FilterManager)),t(1,J(Ut.RendererManager)),t(2,J(Ut.AudioContextManager)),t(3,J(Ut.SaveBufferManager)),t(4,J(Ut.AudioProcessor)),t(5,J(Ut.BufferManager)),t(6,J(Ut.BufferPlayer)),i("design:paramtypes",[Object,Object,Object,Object,Object,Object,Object])],qt);var Ht=qt;let Kt=class extends Wt{constructor(){super(...arguments),this.buffer=null,this.source=null,this.gainNode=null,this.intervals=[],this._volume=1,this._duration=0,this.currentTime=0,this.displayTime=0,this.playing=!1,this.loop=!1,this.loopAll=!1,this.speedAudio=1,this.compatibilityMode=!1,this.currentNode=null}setup(){this.eventEmitter?(this.eventEmitter.on(exports.EventType.AUDIO_SPEED_UPDATED,e=>{e&&(this.speedAudio=e)}),this.eventEmitter.on(exports.EventType.AUDIO_DURATION_UPDATED,e=>{e&&(this.duration=e)})):console.error("Event Emitter is not available!")}init(e){this.playing=!1,this.contextManager&&this.contextManager.currentContext&&(this.contextManager.currentContext.resume(),!this.compatibilityMode&&this.buffer&&(null==this.source||e||(this.source.buffer=null,this.source.disconnect()),this.createGainNode(e),this.duration=this.buffer.duration,this.source&&this.gainNode&&(this.source.connect(this.gainNode),this.gainNode.connect(this.contextManager.currentContext.destination)))),this.updateInfos()}createGainNode(e){this.contextManager&&this.contextManager.currentContext&&(e||(this.gainNode&&this.gainNode.disconnect(),this.source&&this.source.disconnect()),this.source=this.contextManager.currentContext.createBufferSource(),this.source.buffer=this.buffer,this.gainNode=this.contextManager.currentContext.createGain(),this.setGainNodeValue())}loadBuffer(e){this.compatibilityMode=!1,this.reset(),this.buffer=e,this.init()}setCompatibilityMode(e,t){this.compatibilityMode=!0,this.reset(),this.init(),null!=t&&(this.duration=t*this.speedAudio),this.currentNode=e,this.updateInfos()}reset(e){this.clearIntervals(),this.currentTime=0,this.displayTime=0,e||this.stop()}stop(){var e;this.clearIntervals(),null!=this.source&&null!=this.source&&this.playing&&(this.source.stop(0),this.playing=!1),this.currentNode&&(this.currentNode.disconnect(),this.compatibilityMode&&(this.currentTime=0,this.displayTime=0)),null===(e=this.eventEmitter)||void 0===e||e.emit(exports.EventType.PLAYING_STOPPED),this.updateInfos()}clearIntervals(){for(const e of this.intervals)clearInterval(e);this.intervals=[]}start(e){return r(this,void 0,void 0,function*(){var t;if(this.source||this.compatibilityMode){if(e||this.stop(),this.init(e),yield null===(t=this.eventEmitter)||void 0===t?void 0:t.emit(exports.EventType.PLAYING_STARTED),this.compatibilityMode){if(!(this.currentNode&&this.contextManager&&this.contextManager.currentContext))return Promise.resolve();this.createGainNode(e),this.gainNode?(this.currentNode.connect(this.gainNode),this.gainNode.connect(this.contextManager.currentContext.destination)):this.currentNode.connect(this.contextManager.currentContext.destination)}else{if(!this.source)return Promise.resolve();this.source.start(0,e?0:this.currentTime/this.speedAudio),this.playing=!0}let i=performance.now();this.intervals.push(window.setInterval(()=>{var t,r,n;const s=performance.now(),o=s-i;i=s,this.currentTime+=o/1e3*this.speedAudio,this.displayTime=this.currentTime,this.currentTime>this.duration?this.loop?this.compatibilityMode?null===(t=this.eventEmitter)||void 0===t||t.emit(exports.EventType.PLAYING_FINISHED):(this.reset(e),this.start()):(null===(r=this.eventEmitter)||void 0===r||r.emit(exports.EventType.PLAYING_FINISHED),this.reset(e),this.loopAll&&(null===(n=this.eventEmitter)||void 0===n||n.emit(exports.EventType.PLAYING_FINISHED_LOOP_ALL))):this.updateInfos()},100))}return Promise.resolve()})}playDirect(){return r(this,void 0,void 0,function*(){this.compatibilityMode?yield this.start(!1):yield this.start(!0)})}pause(){this.stop()}updateInfos(){var e;null===(e=this.eventEmitter)||void 0===e||e.emit(exports.EventType.PLAYING_UPDATE)}setTimePercent(e){this.compatibilityMode||(this.currentTime=Math.round(this.duration*(e/100)),this.displayTime=this.currentTime,this.playing?(this.pause(),this.start()):this.updateInfos())}setTime(e){this.compatibilityMode||(this.currentTime=e,this.displayTime=this.currentTime,this.playing?(this.pause(),this.start()):this.updateInfos())}set volume(e){this._volume=e,this.setGainNodeValue()}setGainNodeValue(){this.gainNode&&(this.gainNode.gain.value=Math.pow(this._volume,2))}get volume(){return this._volume}get duration(){return this._duration}set duration(e){this._duration=e*(this.speedAudio||1)}onBeforePlaying(e){this.eventEmitter&&this.eventEmitter.on(exports.EventType.PLAYING_STARTED,e)}toggleLoop(){this.loopAll=!1,this.loop=!this.loop}toggleLoopAll(){this.loop=!1,this.loopAll=!this.loopAll}on(e,t){this.eventEmitter&&this.eventEmitter.on(e,t)}get currentTimeDisplay(){return("0"+Math.trunc(this.displayTime/60)).slice(-2)+":"+("0"+Math.trunc(this.displayTime%60)).slice(-2)}get maxTimeDisplay(){return("0"+Math.trunc(this.duration/60)).slice(-2)+":"+("0"+Math.trunc(this.duration%60)).slice(-2)}get percent(){return 100-Math.round((this.duration-this.displayTime)/this.duration*100)}get remainingTimeDisplay(){return("0"+Math.trunc((this.duration-this.displayTime)/60)).slice(-2)+":"+("0"+Math.trunc((this.duration-this.displayTime)%60)).slice(-2)}};e([ae(),i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",void 0)],Kt.prototype,"setup",null),Kt=e([ie(),se()],Kt);var $t=Kt;class Yt{constructor(e,t){this.seconds=0,this.initialSeconds=0,this.interval=null,this.incr=1,this.countCallback=()=>{},this.seconds=e,this.initialSeconds=e,this.incr=t}start(){this.interval=window.setInterval(()=>this.count(),1e3)}stop(){clearInterval(this.interval)}count(){this.seconds+=this.incr,this.seconds<=0&&this.stop(),this.countCallback&&this.countCallback()}onCount(e){this.countCallback=e}}const zt={REVERB:"reverb",ECHO:"echo",BASS_BOOST:"bassboost",BITCRUSHER:"bitcrusher",HIGH_PASS:"highpass",LIMITER:"limiter",LOW_PASS:"lowpass",RENDERING_PROGRESS_CALCULATION:"renderingProgressCalculationFilter",RETURN_AUDIO:"returnAudio",SOUNDTOUCH:"soundtouch",TELEPHONIZER:"telephonizer",VOCODER:"vocoder"},Xt={AUDIO_EDITOR:"audioEditor",VOICE_RECORDER:"voiceRecorder",BUFFER_PLAYER:"bufferPlayer",AUDIO_CONTEXT_MANAGER:"audioContextManager",AUDIO_PROCESSOR:"audioProcessor",BUFFER_MANAGER:"bufferManager",FILTER_MANAGER:"filterManager",RENDERER_MANAGER:"rendererManager",SAVE_BUFFER_MANAGER:"saveBufferManager",EXPORT_WAV_COMMAND:"exportWAV",EXPORT_MP3_COMMAND:"exportMP3",AUDIO_WAV:"audio/wav",AUDIO_MP3:"audio/mp3",RECORD_COMMAND:"record",INIT_COMMAND:"init",FILTERS_NAMES:zt,WORKLET_PATHS:{BITCRUSHER:"BitCrusher.worklet.js",LIMITER:"Limiter.worklet.js",SOUNDTOUCH:"Soundtouch.worklet.js",RECORDER_WORKLET:"RecorderWorklet.js",RENDERING_PROGRESS_CALCULATION:"RenderingProgressCalculation.worklet.js"},WORKLET_NAMES:{BITCRUSHER:"bitcrusher-processor",LIMITER:"limiter-processor",SOUNDTOUCH:"soundtouch-processor",RECORDER_WORKLET:"recorder-worklet",RENDERING_PROGRESS_CALCULATION:"rendering-progress-calculation-worklet"},PREFERENCES_KEYS:{COMPATIBILITY_MODE_ENABLED:"compatibility-mode-enabled",COMPATIBILITY_MODE_CHECKED:"compatibility-mode-checked",ENABLE_AUDIO_WORKLET:"enable-audio-worklet",ENABLE_SOUNDTOUCH_AUDIO_WORKLET:"enable-soundtouch-audio-worklet",BUFFER_SIZE:"buffer-size",SAMPLE_RATE:"sample-rate",DISABLE_INITIAL_RENDERING:"disable-initial-rendering",BITRATE_MP3:"bitrate-mp3"},ENABLE_SOUNDTOUCH_AUDIO_WORKLET:!0,ENABLE_AUDIO_WORKLET:!0,ENABLE_RECORDER_AUDIO_WORKLET:!0,SOUNDTOUCH_PITCH_SHIFTER_BUFFER_SIZE:16384,SOUNDTOUCH_DEFAULT_SPEED:1,SOUNDTOUCH_DEFAULT_FREQUENCY:1,SOUNDTOUCH_DEFAULT_PITCH_SEMITONES:0,DEFAULT_REVERB_ENVIRONMENT:{name:"Medium Damping Cave E002 M2S",url:"impulse_response.wav",size:1350278,addDuration:4,link:"http://www.cksde.com/p_6_250.htm"},VOCODER_MODULATOR:"modulator.mp3",DEFAULT_BUFFER_SIZE:0,VALID_BUFFER_SIZE:[0,256,512,1024,2048,4096,8192,16384],VALID_MP3_BITRATES:[32,64,96,128,160,256,320],DEFAULT_SAMPLE_RATE:0,VALID_SAMPLE_RATES:[0,8e3,11025,16e3,22050,32e3,44100,48e3,88200,96e3,176400,192e3],TREATMENT_TIME_COUNTING_THROTTLE_INTERVAL:100,TREATMENT_TIME_COUNTING_SMOOTHING_FACTOR:.9,DISABLE_INITIAL_RENDERING:!1,DEFAULT_SAVE_FORMAT:"wav",DEFAULT_MP3_BITRATE:320};function Qt(e){return new Worker((e||"")+"RecorderWorker.js")}let Zt=class{constructor(e){this.worker=null,this.node=null,this.context=null,this.config={bufferLen:4096,sampleRate:44100,numChannels:2,mimeType:"audio/wav",workletBasePath:"worklets/",workerBasePath:"workers/",bitrate:Xt.DEFAULT_MP3_BITRATE,callback:()=>{}},this.callbacks={getBuffer:[],exportWAV:[],exportMP3:[]},this.recording=!1,Object.assign(this.config,e)}setup(e){return r(this,void 0,void 0,function*(){this.node&&(this.node instanceof AudioWorkletNode&&this.node.port.postMessage("stop"),this.node.disconnect()),e&&(this.context=e.context,yield this.createRecorderNode(),this.node&&this.context&&(e.connect(this.node),this.node.connect(this.context.destination))),this.context&&!this.worker&&(this.worker=Qt(this.config.workerBasePath),this.worker&&(this.worker.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:this.config.numChannels,bitrate:this.config.bitrate}}),this.worker.onmessage=e=>{let t=null;switch(e.data.command){case"getBuffer":t=this.callbacks.getBuffer;break;case Xt.EXPORT_WAV_COMMAND:t=this.callbacks.exportWAV;break;case Xt.EXPORT_MP3_COMMAND:t=this.callbacks.exportMP3}if(t){const i=t.pop();"function"==typeof i&&i(e.data.data)}}))})}createRecorderNode(){return r(this,void 0,void 0,function*(){if(this.context)if(Vt.isAudioWorkletCompatible(this.context)&&Xt.ENABLE_RECORDER_AUDIO_WORKLET)try{yield this.createRecorderWorklet()}catch(e){console.error(e),this.createRecorderScriptProcessorNode()}else this.createRecorderScriptProcessorNode()})}createRecorderWorklet(){return r(this,void 0,void 0,function*(){if(this.context&&(yield this.context.audioWorklet.addModule(this.config.workletBasePath+Xt.WORKLET_PATHS.RECORDER_WORKLET),this.node=new AudioWorkletNode(this.context,Xt.WORKLET_NAMES.RECORDER_WORKLET),this.node&&this.node.port)){const e=this.node.parameters.get("numChannels");e&&(e.value=this.config.numChannels,e.setValueAtTime(this.config.numChannels,0)),this.node.port.onmessage=e=>{this.worker&&"record"==e.data.command&&e.data.buffer.length>0&&this.worker.postMessage({command:"record",buffer:e.data.buffer})}}})}createRecorderScriptProcessorNode(){this.context&&(this.node=this.context.createScriptProcessor.call(this.context,this.config.bufferLen,this.config.numChannels,this.config.numChannels),this.node.onaudioprocess=e=>{if(!this.recording)return;const t=[];for(let i=0;i<this.config.numChannels;i++)t.push(e.inputBuffer.getChannelData(i));this.worker&&this.worker.postMessage({command:"record",buffer:t})})}record(){this.recording=!0,this.node instanceof AudioWorkletNode&&this.node.port.postMessage("record")}stop(){this.recording=!1,this.node instanceof AudioWorkletNode&&this.node.port.postMessage("stop")}clear(){this.worker&&this.worker.postMessage({command:"clear"})}kill(){this.clear(),this.stop(),this.worker&&this.worker.terminate()}getBuffer(e){if(!(e=e||this.config.callback))throw new Error("Callback not set");this.callbacks.getBuffer.push(e),this.worker&&this.worker.postMessage({command:"getBuffer"})}exportWAV(e,t){if(t=t||this.config.mimeType,!(e=e||this.config.callback))throw new Error("Callback not set");this.callbacks.exportWAV.push(e),this.worker&&this.worker.postMessage({command:Xt.EXPORT_WAV_COMMAND,type:t})}exportMP3(e,t){if(t=t||this.config.mimeType,!(e=e||this.config.callback))throw new Error("Callback not set");this.callbacks.exportMP3.push(e),this.worker&&this.worker.postMessage({command:Xt.EXPORT_MP3_COMMAND,type:t})}};Zt=e([ie(),i("design:paramtypes",[Object])],Zt);var Jt=Zt;let ei=class extends Wt{constructor(e,t){super(),this.recorder=null,this.input=null,this.stream=null,this.alreadyInit=!1,this.timer=null,this.enableAudioFeedback=!1,this.recording=!1,this.deviceList=[],this.constraints={audio:{noiseSuppression:!0,echoCancellation:!0,autoGainControl:!0,sampleRate:{ideal:44100}}},this.sampleRateConfigNotSupported=!1,this.contextManager=e,this.configService=t}init(){return r(this,void 0,void 0,function*(){var e;if(this.isRecordingAvailable()){this.sampleRateConfigNotSupported=!navigator.mediaDevices.getSupportedConstraints().sampleRate,this.contextManager&&(this.sampleRateConfigNotSupported?this.contextManager.createNewContext(0):this.contextManager.createNewContextIfNeeded()),null===(e=this.eventEmitter)||void 0===e||e.emit(exports.EventType.RECORDER_INIT);try{const e=yield navigator.mediaDevices.getUserMedia(this.constraints);this.contextManager&&this.contextManager.currentContext&&this.contextManager.currentContext.resume(),yield this.setup(e,!1,!1),this.alreadyInit=!0,this.timer=new Yt(0,1),this.timer.onCount(()=>{var e;null===(e=this.eventEmitter)||void 0===e||e.emit(exports.EventType.RECORDER_COUNT_UPDATE)}),this.successCallback()}catch(e){console.error(e);if(e)switch(e.name){case"SecurityError":case"NotAllowedError":this.errorCallback();break;case"NotFoundError":this.notFoundErrorCallback();break;case"NotSupportedError":this.sampleRateConfigNotSupported||(this.sampleRateConfigNotSupported=!0,this.init());break;default:this.unknownErrorCallback()}}navigator.mediaDevices.ondevicechange=()=>this.updateInputList()}})}successCallback(){var e;null===(e=this.eventEmitter)||void 0===e||e.emit(exports.EventType.RECORDER_SUCCESS)}errorCallback(){var e;null===(e=this.eventEmitter)||void 0===e||e.emit(exports.EventType.RECORDER_ERROR)}notFoundErrorCallback(){var e;null===(e=this.eventEmitter)||void 0===e||e.emit(exports.EventType.RECORDER_NOT_FOUND_ERROR)}unknownErrorCallback(){var e;null===(e=this.eventEmitter)||void 0===e||e.emit(exports.EventType.RECORDER_UNKNOWN_ERROR)}audioFeedback(e){var t;this.contextManager&&this.contextManager.currentContext&&(e?(this.input&&this.input.connect(this.contextManager.currentContext.destination),this.enableAudioFeedback=!0):(this.input&&(this.input.connect(this.contextManager.currentContext.destination),this.input.disconnect(this.contextManager.currentContext.destination)),this.enableAudioFeedback=!1),null===(t=this.eventEmitter)||void 0===t||t.emit(exports.EventType.RECORDER_UPDATE_CONSTRAINTS))}getConstraints(){if(this.stream){const e=this.stream.getTracks();if(e&&e.length>0)return e[0].getSettings()}return null}updateConstraints(){var e;const t=this.getConstraints();t&&(this.constraints.audio=Object.assign(this.constraints.audio,t),null===(e=this.eventEmitter)||void 0===e||e.emit(exports.EventType.RECORDER_UPDATE_CONSTRAINTS))}resetConstraints(e){return r(this,void 0,void 0,function*(){if(this.stream){const t=this.enableAudioFeedback,i=this.recording,r=this.stream.getTracks();if(e&&(this.updateConstraints(),this.constraints.audio=Object.assign(this.constraints.audio,e.audio)),r&&r.length>0)try{yield r[0].applyConstraints(this.constraints.audio);const n=this.getConstraints(),s=e?Object.keys(e.audio)[0]:"";if(this.audioFeedback(!1),this.pause(),!e||n&&n[s]!=e.audio[s]){this.stopStream();const e=yield navigator.mediaDevices.getUserMedia(this.constraints);yield this.setup(e,i,t)}else yield this.setup(null,i,t)}catch(e){console.error(e),this.errorCallback()}}})}setup(e,t,i){return r(this,void 0,void 0,function*(){e&&this.contextManager&&this.contextManager.currentContext&&(this.input=this.contextManager.currentContext.createMediaStreamSource(e),this.stream=e),this.recorder&&this.input&&(yield this.recorder.setup(this.input),t&&(yield this.record())),this.audioFeedback(i),this.updateConstraints(),yield this.updateInputList()})}setNoiseSuppression(e){this.resetConstraints({audio:{noiseSuppression:e}})}setAutoGain(e){this.resetConstraints({audio:{autoGainControl:e}})}setEchoCancellation(e){this.resetConstraints({audio:{echoCancellation:e}})}updateInputList(){return r(this,void 0,void 0,function*(){if(this.deviceList){const e=yield navigator.mediaDevices.enumerateDevices();this.deviceList=[],e.forEach(e=>{"audioinput"==e.kind&&this.deviceList.push(e)})}})}changeInput(e,t){t&&(this.constraints.audio.deviceId=e,this.constraints.audio.groupId=t,this.resetConstraints())}record(){return r(this,void 0,void 0,function*(){this.alreadyInit&&this.configService&&this.input&&(this.recorder||(this.recorder=new Jt({bufferLen:this.configService.getBufferSize(),sampleRate:this.configService.getSampleRate(),numChannels:2,workletBasePath:this.configService.getWorkletBasePath(),workerBasePath:this.configService.getWorkerBasePath(),mimeType:"audio/wav"}),yield this.recorder.setup(this.input)),this.recorder&&this.recorder.record(),this.timer&&this.timer.start(),this.recording=!0,this.eventEmitter&&this.eventEmitter.emit(exports.EventType.RECORDER_RECORDING))})}stop(){this.alreadyInit&&this.recorder&&(this.recorder.stop(),this.timer&&this.timer.stop(),this.recording=!1,this.recorder.getBuffer(e=>{var t;if(this.contextManager&&this.contextManager.currentContext){this.contextManager.currentContext.resume();const i=this.contextManager.currentContext.createBuffer(2,e[0].length,this.contextManager.currentContext.sampleRate);i.getChannelData(0).set(e[0]),i.getChannelData(1).set(e[1]),null===(t=this.eventEmitter)||void 0===t||t.emit(exports.EventType.RECORDER_STOPPED,i),this.reset()}}))}pause(){var e;this.alreadyInit&&(this.recorder&&this.recorder.stop(),this.timer&&this.timer.stop(),this.recording=!1,null===(e=this.eventEmitter)||void 0===e||e.emit(exports.EventType.RECORDER_PAUSED))}stopStream(){if(this.stream){const e=this.stream.getTracks();for(let t=0,i=e.length;t<i;t++)e[t].stop()}}reset(){var e;this.recorder&&this.recorder.kill(),this.timer&&this.timer.stop(),this.audioFeedback(!1),this.stopStream(),this.input=null,this.recorder=null,this.stream=null,this.alreadyInit=!1,this.timer=null,null===(e=this.eventEmitter)||void 0===e||e.emit(exports.EventType.RECORDER_RESETED)}get currentTimeDisplay(){var e,t,i;return(null===(e=this.timer)||void 0===e?void 0:e.seconds)?("0"+Math.trunc((null===(t=this.timer)||void 0===t?void 0:t.seconds)/60)).slice(-2)+":"+("0"+Math.trunc((null===(i=this.timer)||void 0===i?void 0:i.seconds)%60)).slice(-2):"00:00"}get currentTime(){return this.timer?this.timer.seconds:0}getSettings(){return{deviceList:this.deviceList,audioFeedback:this.enableAudioFeedback,constraints:this.constraints.audio}}on(e,t){var i;null===(i=this.eventEmitter)||void 0===i||i.on(e,t)}isRecordingAvailable(){return void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia}};ei=e([ie(),se(),t(0,J(Ut.AudioContextManager)),t(1,J(Ut.ConfigService)),i("design:paramtypes",[Object,Object])],ei);var ti=ei;let ii=class extends Wt{constructor(){super(...arguments),this.enabled=!1,this.defaultEnabled=!1}isEnabled(){return this.enabled}isDefaultEnabled(){return this.defaultEnabled}setDefaultEnabled(e){this.defaultEnabled=e,e?this.enable():this.disable()}setEnabled(e){this.enabled=e}enable(){this.setEnabled(!0)}disable(){this.setEnabled(!1)}toggle(){this.setEnabled(!this.isEnabled())}};ii=e([ie()],ii);var ri=ii;class ni extends ri{constructor(){super(...arguments),this.defaultSettings=null,this._totalSamples=0}getAddingTime(){return 0}initializeDefaultSettings(){this.defaultSettings=this.getSettings()}getDefaultSettings(){return this.defaultSettings}resetSettings(){return r(this,void 0,void 0,function*(){if(this.defaultSettings)for(const e in this.defaultSettings)this.defaultSettings&&void 0!==this.defaultSettings[e]&&(yield this.setSetting(e,this.defaultSettings[e]))})}isWorklet(){return!1}bufferFetcherReseted(){return Promise.resolve(!1)}set totalSamples(e){this._totalSamples=e}}class si{constructor(e,t){this._value=0,this._minValue=0,this._maxValue=Number.MAX_SAFE_INTEGER,this._defaultValue=0,this.context=null,this.automationRate="a-rate",this._defaultValue=void 0!==t?t:0,this._value=this._defaultValue,this.context=e}get value(){return this._value}set value(e){this._value=Math.max(this._minValue,Math.min(this._maxValue,e))}get minValue(){return this._minValue}get maxValue(){return this._maxValue}get defaultValue(){return this._defaultValue}setValueAtTime(e,t){return console.warn("setValueAtTime used with AudioParamPolyfill, is not fully compatible with standard AudioParam"),this.value=e,new si(this.context,e)}linearRampToValueAtTime(e,t){return console.warn("linearRampToValueAtTime used with AudioParamPolyfill, is not fully compatible with standard AudioParam"),this.value=e,new si(this.context,e)}exponentialRampToValueAtTime(e,t){return console.warn("exponentialRampToValueAtTime used with AudioParamPolyfill, is not fully compatible with standard AudioParam"),this.value=e,new si(this.context,e)}cancelAndHoldAtTime(e){throw new Error("Method not implemented.")}cancelScheduledValues(e){throw new Error("Method not implemented.")}setTargetAtTime(e,t,i){throw new Error("Method not implemented.")}setValueCurveAtTime(e,t,i){throw new Error("Method not implemented.")}}class oi{constructor(e,t,i){this._parameters=new Map,this._port=null,this.currentContext=null,this.workletProcessor=t,this.currentContext=e,this._scriptProcessorNode=e.createScriptProcessor(i,e.destination.channelCount,e.destination.channelCount),this.setupPort(),this.setupProcessor(),this.setupWorkletScope(e)}setupPort(){const e=new MessageChannel;e.port1.onmessage=e=>{this.workletProcessor&&this.workletProcessor.port2&&this.workletProcessor.port2.postMessage(e.data),e&&"stop"===e.data&&this.stop()},this.workletProcessor&&this.workletProcessor.port2&&(this.workletProcessor.port2.onmessage=t=>{e.port1.postMessage(t.data)}),this._port=e.port2}setupProcessor(){if(!this._scriptProcessorNode||!this.workletProcessor)return;this._scriptProcessorNode.onaudioprocess=e=>{if(this.workletProcessor){const t=[Vt.convertAudioBufferToFloat32Array(e.inputBuffer)],i=[Vt.convertAudioBufferToFloat32Array(e.outputBuffer)],r=[];for(const[e,t]of this._parameters.entries())r.push([e,Vt.convertAudioParamToFloat32Array(t,1)]);const n=Object.fromEntries(r);this.workletProcessor.process(t,i,n)}};const e=this.workletProcessor.defaultParameterDescriptors;e&&e.forEach(e=>{this.currentContext&&this._parameters.set(e.name,new si(this.currentContext,e.defaultValue))})}setupWorkletScope(e){"undefined"!=typeof window&&(window.sampleRate=e.sampleRate)}stop(){this._scriptProcessorNode=null,this._port=null,this._parameters=new Map,this.currentContext=null,this.workletProcessor=null}get port(){return this._port}get parameters(){return this._parameters}get node(){return this._scriptProcessorNode}get context(){var e;return null===(e=this._scriptProcessorNode)||void 0===e?void 0:e.context}}class ai{static registerProcessor(e,t){ai.processorsMap.set(e,t)}static getProcessor(e){const t=ai.processorsMap.get(e);return t?new t:null}}ai.processorsMap=new Map;class ui{constructor(){this.messageChannel=null,this.messageChannel=new MessageChannel}process(e,t,i){return!0}get port(){return this.messageChannel&&this.messageChannel.port1}get port2(){return this.messageChannel&&this.messageChannel.port2}get parameters(){throw new Error("Method not implemented.")}get parameterDescriptors(){throw new Error("Method not implemented.")}get defaultParameterDescriptors(){return[]}}"undefined"==typeof window||"AudioWorkletProcessor"in window||(window.AudioWorkletProcessor=ui,window.registerProcessor=ai.registerProcessor),"undefined"==typeof global||"AudioWorkletProcessor"in global||(global.AudioWorkletProcessor=ui,global.registerProcessor=ai.registerProcessor);class ci extends ni{constructor(){super(...arguments),this.currentWorkletNode=null,this.fallbackToScriptProcessor=!1,this.keepCurrentNodeIfPossible=!1,this.loadedModulesMap=new WeakMap}initializeWorklet(e){return r(this,void 0,void 0,function*(){if(this.stop(),!Vt.isAudioWorkletCompatible(e))return console.error("Audio Worklets not supported on this browser. Fallback to ScriptProcessor"),void(this.fallbackToScriptProcessor=!0);const t=(this.configService?this.configService.getWorkletBasePath():"")+this.workletPath,i=this.loadedModulesMap.get(e);i&&i.has(t)||(yield e.audioWorklet.addModule(t).then(()=>{const r=null!=i?i:new Set;i||this.loadedModulesMap.set(e,r),r.add(t),this.eventEmitter&&this.eventEmitter.emit(exports.EventType.WORKLET_SUCCESSFULLY_LOADED)}).catch(e=>{console.error(`Error when loading Worklet (${t}) for filter ${this.id}. Fallback to ScriptProcessor. Exception:`,e),this.fallbackToScriptProcessor=!0,this.eventEmitter&&this.eventEmitter.emit(exports.EventType.FALLBACK_WORKLET_TO_SCRIPT_PROCESSOR)}))})}isAudioWorkletEnabled(){return this.configService?this.configService.isAudioWorkletEnabled():Xt.ENABLE_AUDIO_WORKLET}isAudioWorkletAvailable(){return this.isAudioWorkletEnabled()&&!this.fallbackToScriptProcessor}initializeNode(e,t){if(this.isAudioWorkletAvailable())this.currentWorkletNode=new AudioWorkletNode(e,t);else{const i=ai.getProcessor(t);if(!i)throw new Error(`No processor registered with name ${t} for filter ${this.id} to use the fallback/polyfill for AudioWorklet. Make sure you have created the class.`);this.currentWorkletNode=new oi(e,i,this.configService.getBufferSize())}this.currentWorkletNode&&this.currentWorkletNode.port&&(this.currentWorkletNode.port.onmessage=e=>this.receiveEvent(e))}applyCurrentSettingsToWorklet(){const e=this.getSettings();for(const t of Object.keys(e))this.setWorkletSetting(t,e[t])}setWorkletSetting(e,t){if(this.currentWorkletNode&&this.currentWorkletNode.parameters){const i=this.currentWorkletNode.parameters.get(e);i&&(i.value=t,i.setValueAtTime(t,0))}}getNode(e){if(this.keepCurrentNodeIfPossible&&this.currentWorkletNode&&this.currentWorkletNode.context==e||(this.stop(),this.initializeNode(e,this.workletName)),this.applyCurrentSettingsToWorklet(),this.setEnabled(this.isEnabled()),this.currentWorkletNode)return this.currentWorkletNode instanceof oi?{input:this.currentWorkletNode.node,output:this.currentWorkletNode.node}:{input:this.currentWorkletNode,output:this.currentWorkletNode};throw new Error("Worklet node has not yet been created")}stop(){this.currentWorkletNode&&this.currentWorkletNode.port&&(this.currentWorkletNode.port.postMessage("stop"),this.currentWorkletNode.port.close(),this.currentWorkletNode.port.onmessage=null),this.currentWorkletNode=null}setEnabled(e){this.currentWorkletNode&&this.currentWorkletNode.port&&this.currentWorkletNode.port.postMessage(e?"enable":"disable"),super.setEnabled(e)}isWorklet(){return!0}}class li extends ri{}let hi=class{constructor(){this._listeners={},this._listeners={}}on(e,t){this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t)}emit(e,t){return r(this,void 0,void 0,function*(){if(this._listeners[e])for(const i of this._listeners[e])yield i(t)})}off(e,t){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter(e=>e!==t))}get listeners(){return this._listeners}set listeners(e){this._listeners=e}};hi=e([ie(),i("design:paramtypes",[])],hi);var di=hi;let fi=class{constructor(){this.mapConfig=new Map,this.workerBasePath="",this.workletBasePath="",this.soundBasePath=""}getConfig(e){return this.mapConfig.get(e)}setConfig(e,t){this.mapConfig.set(e,t)}isCompatibilityModeEnabled(){return"true"==this.getConfig(Xt.PREFERENCES_KEYS.COMPATIBILITY_MODE_ENABLED)}isCompatibilityModeChecked(){return"true"==this.getConfig(Xt.PREFERENCES_KEYS.COMPATIBILITY_MODE_CHECKED)}isAudioWorkletEnabled(){const e=this.getConfig(Xt.PREFERENCES_KEYS.ENABLE_AUDIO_WORKLET);return null!=e?"true"==e:Xt.ENABLE_AUDIO_WORKLET}isSoundtouchAudioWorkletEnabled(){const e=this.getConfig(Xt.PREFERENCES_KEYS.ENABLE_SOUNDTOUCH_AUDIO_WORKLET);return null!=e?"true"==e:Xt.ENABLE_SOUNDTOUCH_AUDIO_WORKLET}getBufferSize(){const e=this.getConfig(Xt.PREFERENCES_KEYS.BUFFER_SIZE);return null!=e?parseInt(e,10):Xt.DEFAULT_BUFFER_SIZE}getSampleRate(){const e=this.getConfig(Xt.PREFERENCES_KEYS.SAMPLE_RATE);return null!=e?parseInt(e,10):Xt.DEFAULT_SAMPLE_RATE}getBitrateMP3(){const e=this.getConfig(Xt.PREFERENCES_KEYS.BITRATE_MP3);return null!=e?parseInt(e,10):Xt.DEFAULT_MP3_BITRATE}enableCompatibilityMode(){this.setConfig(Xt.PREFERENCES_KEYS.COMPATIBILITY_MODE_ENABLED,"true")}disableCompatibilityMode(){this.setConfig(Xt.PREFERENCES_KEYS.COMPATIBILITY_MODE_ENABLED,"false")}getWorkletBasePath(){return this.workletBasePath}getWorkerBasePath(){return this.workerBasePath}getSoundBasePath(){return this.soundBasePath}setWorkletBasePath(e){this.workletBasePath=e}setWorkerBasePath(e){this.workerBasePath=e}setSoundBasePath(e){this.soundBasePath=e}isInitialRenderingDisabled(){const e=this.getConfig(Xt.PREFERENCES_KEYS.DISABLE_INITIAL_RENDERING);return null!=e?"true"==e:Xt.DISABLE_INITIAL_RENDERING}};fi=e([ie()],fi);var pi=fi;let vi=class{constructor(e,t){this.previousSampleRate=Xt.DEFAULT_SAMPLE_RATE,this.eventEmitter=e||new di,this.configService=t}setup(){this.configService&&(this.previousSampleRate=this.configService.getSampleRate(),this.eventEmitter&&this.eventEmitter.emit(exports.EventType.SAMPLE_RATE_CHANGED,this.previousSampleRate)),this.currentContext||this.createNewContext(this.previousSampleRate)}createNewContextIfNeeded(e){if(this.configService&&this.configService.isCompatibilityModeEnabled()&&e){if(this.currentSampleRate!=e.sampleRate)return this.createNewContext(e.sampleRate),!0}else{let e=Xt.DEFAULT_SAMPLE_RATE;if(this.configService&&(e=this.configService.getSampleRate()),e!=this.previousSampleRate)return this.createNewContext(e),!0}return!1}createNewContext(e){this._currentContext&&this._currentContext.close();const t={latencyHint:"interactive"};0!=e&&(t.sampleRate=e),this._currentContext=new AudioContext(t),this.eventEmitter&&this.eventEmitter.emit(exports.EventType.SAMPLE_RATE_CHANGED,this.currentSampleRate),this.previousSampleRate=e}createOfflineAudioContext(e,t,i){const r=document.createElement("iframe");r.style.display="none",document.body.appendChild(r);const n=r.contentWindow;if(!n)throw new Error("Failed to create isolated OfflineAudioContext");const s=new(0,n.OfflineAudioContext)(e,t,i);return s.addEventListener("complete",()=>{setTimeout(()=>document.body.removeChild(r))}),s}get currentSampleRate(){return this.currentContext?this.currentContext.sampleRate:0}get currentContext(){return this._currentContext}};e([ae(),i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",void 0)],vi.prototype,"setup",null),vi=e([ie(),t(0,J(Ut.EventEmitter)),t(1,J(Ut.ConfigService)),i("design:paramtypes",[Object,Object])],vi);var gi=vi;let mi=class extends Wt{constructor(e,t,i,r){super(),this._renderedBuffer=null,this.audioRenderingLastCanceled=!1,this.initialRenderingDone=!1,this.sumInputBuffer=0,this.bufferPlayer=i,this.filterManager=e,this.rendererManager=t,this.bufferManager=r}prepareContext(e){return r(this,void 0,void 0,function*(){if(this.contextManager){this.contextManager.createNewContextIfNeeded(e)&&this.bufferManager&&(yield this.bufferManager.resetBufferFetcher()),this.contextManager.currentContext&&this.contextManager.currentContext.resume()}})}updateAudioSpeedAndDuration(e){if(this.eventEmitter){if(this.filterManager&&this.filterManager.entrypointFilter){const e=this.filterManager.entrypointFilter.getSpeed();this.eventEmitter.emit(exports.EventType.AUDIO_SPEED_UPDATED,e)}null!=e&&this.eventEmitter.emit(exports.EventType.AUDIO_DURATION_UPDATED,e)}}resetAudioRenderingProgress(){this.eventEmitter&&(this.eventEmitter.emit(exports.EventType.UPDATE_AUDIO_TREATMENT_PERCENT,0),this.eventEmitter.emit(exports.EventType.UPDATE_REMAINING_TIME_ESTIMATED,-1)),this.filterManager&&this.filterManager.disableFilter(Xt.FILTERS_NAMES.RENDERING_PROGRESS_CALCULATION)}startRenderingProgressCalculation(){this.filterManager&&this.filterManager.enableFilter(Xt.FILTERS_NAMES.RENDERING_PROGRESS_CALCULATION)}renderAudio(e,t){return r(this,void 0,void 0,function*(){if(yield this.prepareContext(e),!this.contextManager||!this.contextManager.currentContext)throw new Error("AudioContext is not yet available");if(!this.filterManager)throw new Error("Filter manager is not available");if(!this.rendererManager)throw new Error("Renderer manager is not available");if(!this.filterManager.entrypointFilter)throw new Error("Entrypoint filter is not available");if(!e)throw new Error("No principal buffer available");this.eventEmitter&&this.eventEmitter.emit(exports.EventType.AUDIO_SPEED_UPDATED,1);const i=!!this.configService&&this.configService.isCompatibilityModeEnabled();if(!this.initialRenderingDone&&this.configService&&this.configService.isInitialRenderingDisabled()&&!i&&!t)return this.loadInitialBuffer(e),this.initialRenderingDone=!0,!0;this.configService&&this.bufferPlayer&&!i&&this.bufferPlayer.compatibilityMode&&this.bufferPlayer.stop(),this.currentOfflineContext=null,this.audioRenderingLastCanceled=!1;const r=this.filterManager.entrypointFilter.getSpeed(),n=Vt.calculateAudioDuration(e,this.filterManager,r),s=i?this.contextManager.currentContext:this.contextManager.createOfflineAudioContext(2,this.contextManager.currentContext.sampleRate*n,this.contextManager.currentContext.sampleRate);return this._renderedBuffer=yield this.rendererManager.executeAudioRenderers(e,s),this.resetAudioRenderingProgress(),this.filterManager.setupTotalSamples(n,this.contextManager.currentContext),this.setupOutput(e,s,n)})}setupOutput(e,t,i){return r(this,void 0,void 0,function*(){if(this._renderedBuffer&&this.configService&&this.eventEmitter&&this.bufferPlayer&&this.filterManager){const r=t instanceof AudioContext;if(r||this.startRenderingProgressCalculation(),yield this.filterManager.initializeWorklets(t),yield this.filterManager.connectNodes(t,this._renderedBuffer,!1,r),!this.filterManager.currentNodes)throw new Error("Audio nodes are not connected. Please call FilterManager.connectNodes before calling AudioProcessor.setupOutput");if(r)this.bufferPlayer.setCompatibilityMode(this.filterManager.currentNodes.output),this.updateAudioSpeedAndDuration(i),this.initialRenderingDone=!0;else{this.currentOfflineContext=t,this.filterManager.currentNodes.output.connect(t.destination);const r=yield t.startRendering();if(this.cleanupAfterOfflineRendering(),this.contextManager&&!this.loadRenderedAudio(e,r))return this.setupOutput(e,this.contextManager.currentContext,i);if(this.audioRenderingLastCanceled)return!1;this.eventEmitter.emit(exports.EventType.OFFLINE_AUDIO_RENDERING_FINISHED)}return this.eventEmitter&&this.eventEmitter.emit(exports.EventType.AUDIO_RENDERING_FINISHED),!0}return!1})}cancelAudioRendering(){this.currentOfflineContext&&!this.audioRenderingLastCanceled&&this.filterManager&&(this.audioRenderingLastCanceled=!0,this.filterManager.disconnectOldNodes(!1),this.eventEmitter&&this.eventEmitter.emit(exports.EventType.CANCELLING_AUDIO_PROCESSING))}cleanupAfterOfflineRendering(){this.filterManager&&(this.filterManager.clearWorklets(),this.filterManager.disconnectOldNodes(!1)),this.currentOfflineContext&&(this.currentOfflineContext.destination.disconnect(),this.currentOfflineContext=null)}loadRenderedAudio(e,t){if(this.eventEmitter&&this.bufferPlayer){if(this.audioRenderingLastCanceled)this.initialRenderingDone||(this.loadInitialBuffer(e),this.eventEmitter.emit(exports.EventType.CANCELLED_AND_LOADED_INITIAL_AUDIO));else{if(0==Vt.sumAudioBuffer(t)&&0!==this.sumInputBuffer){if(this.configService&&!this.configService.isCompatibilityModeChecked())return this.setCompatibilityModeChecked(!0),this.configService.enableCompatibilityMode(),this.eventEmitter.emit(exports.EventType.COMPATIBILITY_MODE_AUTO_ENABLED),console.warn("Compatibility mode has been automatically enabled because a problem has been detected with the web browser."),!1;this.eventEmitter.emit(exports.EventType.RENDERING_AUDIO_PROBLEM_DETECTED)}this._renderedBuffer=t,this.bufferPlayer.loadBuffer(this._renderedBuffer),this.updateAudioSpeedAndDuration(null)}this.initialRenderingDone=!0}return!0}loadInitialBuffer(e){this.bufferPlayer&&(this._renderedBuffer=e,this.bufferPlayer.loadBuffer(e))}clearRenderedBuffer(){Vt.clearAudioBuffer(this._renderedBuffer),this._renderedBuffer=null}setCompatibilityModeChecked(e){this.configService&&this.configService.setConfig(Xt.PREFERENCES_KEYS.COMPATIBILITY_MODE_CHECKED,String(e))}get renderedBuffer(){return this._renderedBuffer}};mi=e([ie(),se(),t(0,J(Ut.FilterManager)),t(1,J(Ut.RendererManager)),t(2,J(Ut.BufferPlayer)),t(3,J(Ut.BufferManager)),i("design:paramtypes",[Object,Object,Object,Object])],mi);var Ei=mi;let yi=class extends Wt{constructor(e,t,i,r){super(),this.downloadingInitialData=!1,this.audioBuffersToFetch=[],this.bufferFetcherService=t,this.eventEmitter=i,this.filterManager=e,this.filterManager=e,this.audioBuffersToFetch=r}setup(){this.audioBuffersToFetch.length>0&&this.fetchBuffers(!1)}fetchBuffers(e){return r(this,void 0,void 0,function*(){if(!this.downloadingInitialData&&this.bufferFetcherService){this.downloadingInitialData=!0,this.eventEmitter&&!e&&this.eventEmitter.emit(exports.EventType.LOADING_BUFFERS);try{yield this.bufferFetcherService.fetchAllBuffers(this.audioBuffersToFetch),this.downloadingInitialData=!1,this.eventEmitter&&!e&&this.eventEmitter.emit(exports.EventType.LOADED_BUFFERS)}catch(t){console.error(t),this.eventEmitter&&!e&&this.eventEmitter.emit(exports.EventType.LOADING_BUFFERS_ERROR)}}})}resetBufferFetcher(){return r(this,void 0,void 0,function*(){this.bufferFetcherService&&(this.bufferFetcherService.reset(),yield this.fetchBuffers(!0),this.filterManager&&(yield this.filterManager.resetFilterBuffers()))})}};e([ae(),i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",void 0)],yi.prototype,"setup",null),yi=e([ie(),se(),t(0,J(Ut.FilterManager)),t(1,J(Ut.BufferFetcherService)),t(2,J(Ut.EventEmitter)),t(3,J(Ut.AudioBuffersToFetch)),i("design:paramtypes",[Object,Object,Object,Array])],yi);var Si=yi;let bi=class extends Wt{constructor(e,t){super(),this.filters=[],this._entryPointFilter=null,this._currentNodes=null,this.filters=e,this._entryPointFilter=t}setup(){this.initializeFilters(this.filters)}addFilters(...e){this.initializeFilters(e),this.filters.push(...e)}initializeFilters(e){for(const t of e)t.initializeDefaultSettings(),t.injectDependencies(this.bufferFetcherService,this.bufferDecoderService,this.configService,this.eventEmitter,this.contextManager)}getFiltersState(){const e={};return this.filters.forEach(t=>{e[t.id]=t.isEnabled()}),e}getFiltersSettings(){const e=new Map;for(const t of this.filters)e.set(t.id,t.getSettings());return e}enableFilter(e){const t=this.filters.find(t=>t.id===e);t&&t.enable()}disableFilter(e){const t=this.filters.find(t=>t.id===e);t&&t.disable()}toggleFilter(e){const t=this.filters.find(t=>t.id===e);t&&t.toggle()}changeFilterSettings(e,t){return r(this,void 0,void 0,function*(){const i=this.filters.find(t=>t.id===e);if(i)for(const e of Object.keys(t))yield i.setSetting(e,t[e])})}resetFilterSettings(e){return r(this,void 0,void 0,function*(){const t=this.filters.find(t=>t.id===e);t&&(yield t.resetSettings())})}resetAllFiltersState(){this.filters.forEach(e=>{e.isDefaultEnabled()?e.enable():e.disable()})}connectNodes(e,t,i,n){return r(this,void 0,void 0,function*(){if(!this._entryPointFilter)return;let r=null;if(i&&this._currentNodes)r=this._currentNodes.input;else{const i=yield this._entryPointFilter.getEntrypointNode(e,t,!n);r=i.input}const s=[];let o=r;this.disconnectOldNodes(i);const a=this.filters.sort((e,t)=>e.order-t.order).filter((e,t)=>e!==this._entryPointFilter&&(e.isEnabled()||t>=this.filters.length-1));for(const t of a){const i=t.getNode(e);o&&o.connect(i.input),o=i.output,s.push(i)}this._entryPointFilter&&this._entryPointFilter.updateState(),this._currentNodes={input:r,output:o,intermediateNodes:s.filter(e=>e.input!=o&&e.output!=o&&e.input!=r&&e.output!=r)}})}disconnectOldNodes(e){this._currentNodes&&(this._currentNodes.input.disconnect(),e||this._currentNodes.output.disconnect(),this.disconnecteIntermediateNodes())}disconnecteIntermediateNodes(){if(this._currentNodes&&this._currentNodes.intermediateNodes){for(const e of this._currentNodes.intermediateNodes)e.input.disconnect(),e.output.disconnect();this._currentNodes.intermediateNodes=void 0}}initializeWorklets(e){return r(this,void 0,void 0,function*(){for(const t of this.filters)t.isWorklet()&&(this.clearWorklets(),yield t.initializeWorklet(e))})}clearWorklets(){for(const e of this.filters)e.isWorklet()&&e.stop()}getAddingTime(){let e=0;for(const t of this.filters)t.isEnabled()&&(e+=t.getAddingTime());return e}setupTotalSamples(e,t){if(t){const i=e*t.sampleRate;for(const e of this.filters)e.totalSamples=i}}resetFilterBuffers(){return r(this,void 0,void 0,function*(){for(const e of this.filters)yield e.bufferFetcherReseted()})}get entrypointFilter(){return this._entryPointFilter}get currentNodes(){return this._currentNodes}};e([ae(),i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",void 0)],bi.prototype,"setup",null),bi=e([ie(),se(),t(0,oe(Ut.Filters)),t(1,J(Ut.EntryPointFilter)),i("design:paramtypes",[Array,Object])],bi);var Ai=bi;let _i=class extends Wt{constructor(e=[]){super(),this.renderers=[],this.renderers=e}setup(){this.initializeRenderers(this.renderers)}addRenderers(...e){this.initializeRenderers(e),this.renderers.push(...e)}initializeRenderers(e){for(const t of e)t.injectDependencies(this.bufferFetcherService,this.bufferDecoderService,this.configService,this.eventEmitter,this.contextManager)}getRenderersState(){const e={};return this.renderers.forEach(t=>{e[t.id]=t.isEnabled()}),e}enableRenderer(e){const t=this.renderers.find(t=>t.id===e);t&&t.enable()}disableRenderer(e){const t=this.renderers.find(t=>t.id===e);t&&t.disable()}toggleRenderer(e){const t=this.renderers.find(t=>t.id===e);t&&t.toggle()}resetAllRenderersState(){this.renderers.forEach(e=>{e.isDefaultEnabled()?e.enable():e.disable()})}executeAudioRenderers(e,t){return r(this,void 0,void 0,function*(){let i=e;for(const e of this.renderers.sort((e,t)=>e.order-t.order))e.isEnabled()&&(i=yield e.renderAudio(t,i));return i})}};e([ae(),i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",void 0)],_i.prototype,"setup",null),_i=e([ie(),se(),t(0,oe(Ut.Renderers)),i("design:paramtypes",[Array])],_i);var Ri=_i;let wi=class extends Wt{constructor(e,t){super(),this._savingBuffer=!1,this.playingStoppedCallback=null,this.bufferPlayer=t,this.filterManager=e}setup(){this.eventEmitter&&this.eventEmitter.on(exports.EventType.PLAYING_FINISHED,()=>{this._savingBuffer&&this.playingStoppedCallback&&this.eventEmitter&&this.eventEmitter.off(exports.EventType.PLAYING_STOPPED,this.playingStoppedCallback)})}saveBuffer(e,t,i){return r(this,void 0,void 0,function*(){if(this._savingBuffer)throw new Error("The buffer is currently saving");if(!this.bufferPlayer)throw new Error("No buffer player was found");this._savingBuffer=!0;let r=!1;return r=this.bufferPlayer.compatibilityMode?yield this.saveBufferCompatibilityMode(t,i):yield this.saveBufferDirect(e,t),this._savingBuffer=!1,r})}saveBufferDirect(e,t){return new Promise((i,r)=>{var n;if(!e||this.contextManager&&!this.contextManager.currentContext)return void r("No rendered buffer or AudioContext not initialized");const s=Qt(null===(n=this.configService)||void 0===n?void 0:n.getWorkerBasePath());if(s){const r=[];for(let t=0;t<e.numberOfChannels;t++)r.push(e.getChannelData(t));s.onmessage=e=>{e.data.command!=Xt.EXPORT_WAV_COMMAND&&e.data.command!=Xt.EXPORT_MP3_COMMAND||this.downloadAudioBlob(e.data.data,t),s.terminate(),this._savingBuffer=!1,i(!0)},s.postMessage({command:Xt.INIT_COMMAND,config:{sampleRate:e.sampleRate,numChannels:2,bitrate:(null==t?void 0:t.bitrate)||Xt.DEFAULT_MP3_BITRATE}}),s.postMessage({command:Xt.RECORD_COMMAND,buffer:r}),s.postMessage({command:"mp3"===(null==t?void 0:t.format)||"mp3"===Xt.DEFAULT_SAVE_FORMAT?Xt.EXPORT_MP3_COMMAND:Xt.EXPORT_WAV_COMMAND,type:Xt.AUDIO_WAV})}})}saveBufferCompatibilityMode(e,t){return new Promise((i,r)=>{this.bufferPlayer?this.bufferPlayer.start().then(()=>{if(!this.configService)return r("No config service found");if(!this.filterManager)return r("No filter manager found");if(!this.filterManager.currentNodes)return r("No current nodes found");const n=t||new Zt({bufferLen:this.configService.getBufferSize(),sampleRate:this.configService.getSampleRate(),numChannels:2,workletBasePath:this.configService.getWorkletBasePath(),workerBasePath:this.configService.getWorkerBasePath(),mimeType:"mp3"==(null==e?void 0:e.format)?Xt.AUDIO_MP3:Xt.AUDIO_WAV,bitrate:(null==e?void 0:e.bitrate)||Xt.DEFAULT_MP3_BITRATE});n.setup(this.filterManager.currentNodes.output).then(()=>{n.record();const t=()=>{this.playingStoppedCallback&&this.eventEmitter&&this.eventEmitter.off(exports.EventType.PLAYING_STOPPED,this.playingStoppedCallback),n.stop();const r=r=>{this.downloadAudioBlob(r,e),this._savingBuffer=!1,this.eventEmitter&&this.eventEmitter.off(exports.EventType.PLAYING_FINISHED,t),n.kill(),i(!0)};"mp3"===(null==e?void 0:e.format)||"mp3"===Xt.DEFAULT_SAVE_FORMAT?n.exportMP3(r):n.exportWAV(r)};this.playingStoppedCallback=()=>{n.kill(),this._savingBuffer=!1,this.eventEmitter&&(this.eventEmitter.off(exports.EventType.PLAYING_FINISHED,t),this.playingStoppedCallback&&this.eventEmitter.off(exports.EventType.PLAYING_STOPPED,this.playingStoppedCallback)),i(!0)},this.eventEmitter&&(this.eventEmitter.on(exports.EventType.PLAYING_FINISHED,t),this.eventEmitter.on(exports.EventType.PLAYING_STOPPED,this.playingStoppedCallback))})}):r("No buffer player found")})}downloadAudioBlob(e,t){Vt.forceDownload(e,"audio-"+(new Date).toISOString()+"."+((null==t?void 0:t.format)||Xt.DEFAULT_SAVE_FORMAT))}get savingBuffer(){return this._savingBuffer}};e([ae(),i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",void 0)],wi.prototype,"setup",null),wi=e([ie(),se(),t(0,J(Ut.FilterManager)),t(1,J(Ut.BufferPlayer)),i("design:paramtypes",[Object,Object])],wi);var Ii=wi;let Ci=class{constructor(e,t,i){this.buffers=new Map,this.bufferErrors=[],this.configService=null,this.contextManager=e,this.eventEmitter=i||new di,this.configService=t}fetchBuffer(e,t){return r(this,void 0,void 0,function*(){var i,r,n,s;const o=(this.configService?this.configService.getSoundBasePath():"")+e;if(null==this.buffers.get(this.getKeyFromLocation(o))||t){null===(i=this.eventEmitter)||void 0===i||i.emit(exports.EventType.FETCHING_BUFFERS,o);try{const e=yield fetch(o);if(!e.ok)throw this.bufferErrors.push(o),null===(r=this.eventEmitter)||void 0===r||r.emit(exports.EventType.FETCHING_BUFFERS_ERROR,o),exports.EventType.FETCHING_BUFFERS_ERROR;{const t=yield e.arrayBuffer();if(this.contextManager&&this.contextManager.currentContext){const e=yield this.contextManager.currentContext.decodeAudioData(t);this.buffers.set(this.getKeyFromLocation(o),Vt.decodeBuffer(this.contextManager.currentContext,e))}}null===(n=this.eventEmitter)||void 0===n||n.emit(exports.EventType.FINISHED_FETCHING_BUFFERS,o)}catch(e){throw console.error(e),this.bufferErrors.push(o),null===(s=this.eventEmitter)||void 0===s||s.emit(exports.EventType.FETCHING_BUFFERS_ERROR,o),exports.EventType.FETCHING_BUFFERS_ERROR}}})}fetchAllBuffers(e){return r(this,void 0,void 0,function*(){for(const t of e)yield this.fetchBuffer(t)})}getAudioBuffer(e){return this.buffers.get(this.getKeyFromLocation(e))}getOrFetchAudioBuffer(e){return r(this,void 0,void 0,function*(){return null==this.getAudioBuffer(e)&&(yield this.fetchBuffer(e)),this.getAudioBuffer(e)})}getDownloadedBuffersList(){return Array.from(this.buffers.keys())}getKeyFromLocation(e){return e.substring(e.lastIndexOf("/")+1)}reset(){this.buffers.clear()}};Ci=e([ie(),t(0,J(Ut.AudioContextManager)),t(1,J(Ut.ConfigService)),t(2,J(Ut.EventEmitter)),i("design:paramtypes",[Object,Object,Object])],Ci);var Ti=Ci;let Bi=class{constructor(e,t){this.contextManager=e,this.eventEmitter=t||new di}decodeBufferFromFile(e){return r(this,void 0,void 0,function*(){this.eventEmitter&&this.eventEmitter.emit(exports.EventType.DECODING_AUDIO_FILE);try{if(this.contextManager&&this.contextManager.currentContext){const t=yield Vt.loadAudioBuffer(this.contextManager.currentContext,e);return this.eventEmitter&&this.eventEmitter.emit(exports.EventType.DECODED_AUDIO_FILE),t}}catch(e){console.error(e),this.eventEmitter&&(this.eventEmitter.emit(exports.EventType.DECODED_AUDIO_FILE),this.eventEmitter.emit(exports.EventType.ERROR_DECODING_AUDIO_FILE))}return null})}};Bi=e([ie(),t(0,J(Ut.AudioContextManager)),t(1,J(Ut.EventEmitter)),i("design:paramtypes",[Object,Object])],Bi);var Mi=Bi;class Pi extends li{renderAudio(e,t){const i=t.numberOfChannels,r=e.sampleRate*t.duration+2*e.sampleRate,n=e.createBuffer(i,r,e.sampleRate);for(let e=0;e<i;e++){const i=n.getChannelData(e),s=t.getChannelData(e);for(let e=0;e<r;e++)e<s.length?i[e]=s[s.length-1-e]:i[e]=0}return Promise.resolve(n)}get order(){return 0}get id(){return Xt.FILTERS_NAMES.RETURN_AUDIO}}class Ni extends ni{constructor(){super(...arguments),this.frequencyBooster=200,this.frequencyReduce=200,this.dbBooster=20,this.dbReduce=0}getNode(e){const t=e.createBiquadFilter();t.type="lowshelf",t.frequency.value=this.frequencyBooster,t.gain.value=this.dbBooster;const i=e.createBiquadFilter();return i.type="highshelf",i.frequency.value=this.frequencyReduce,i.gain.value=this.dbReduce,i.connect(t),{input:i,output:t}}get order(){return 3}get id(){return Xt.FILTERS_NAMES.BASS_BOOST}getSettings(){return{frequencyBooster:this.frequencyBooster,frequencyReduce:this.frequencyReduce,dbBooster:this.dbBooster,dbReduce:this.dbReduce}}setSetting(e,t){if(!Vt.isSettingValueValid(t))return Promise.resolve();switch(e){case"frequencyBooster":this.frequencyBooster=parseInt(t,10);break;case"frequencyReduce":this.frequencyReduce=parseInt(t,10);break;case"dbBooster":this.dbBooster=parseInt(t,10);break;case"dbReduce":this.dbReduce=parseInt(t,10)}return Promise.resolve()}}class Oi extends AudioWorkletProcessor{constructor(){super(),this.stopped=!1,this.disabled=!1,this.phaser=null,this.last=null,this.port.onmessage=e=>{switch(e.data){case"stop":this.stop();break;case"disable":this.disabled=!0;break;case"enable":this.disabled=!1}}}static get parameterDescriptors(){return[{name:"bits",defaultValue:16},{name:"normFreq",defaultValue:.9}]}get defaultParameterDescriptors(){return Oi.parameterDescriptors}process(e,t,i){if(this.stopped||this.disabled)return!1;const r=e[0],n=t[0],s=2*Math.pow(.5,i.bits[0]),o=(1-i.normFreq[0])/(sampleRate/48e3);if(null==this.last&&(this.last=new Array(r.length).fill(0)),null==this.phaser&&(this.phaser=new Array(r.length).fill(0)),r&&r[0]){const e=r[0].length;for(let t=0;t<r.length;t++){const i=r[t],a=n[t];if(i&&a)for(let r=0;r<e;r++)this.phaser[t]+=o,this.phaser[t]>=1&&(this.phaser[t]-=1,this.last[t]=s*Math.floor(i[r]*(1/s)+.5)),a[r]=this.last[t]}}return!0}stop(){this.stopped=!0,this.phaser=null,this.last=null}}registerProcessor(Xt.WORKLET_NAMES.BITCRUSHER,Oi);class Di extends ci{constructor(){super(...arguments),this.bits=16,this.normFreq=.9}receiveEvent(e){}get workletPath(){return Xt.WORKLET_PATHS.BITCRUSHER}get workletName(){return Xt.WORKLET_NAMES.BITCRUSHER}get order(){return 6}get id(){return Xt.FILTERS_NAMES.BITCRUSHER}getSettings(){return{bits:this.bits,normFreq:this.normFreq}}setSetting(e,t){if(!Vt.isSettingValueValid(t))return Promise.resolve();switch(e){case"bits":this.bits=parseInt(t,10);break;case"normFreq":this.normFreq=parseFloat(t)}return this.applyCurrentSettingsToWorklet(),Promise.resolve()}}class Fi extends ni{constructor(){super(...arguments),this.delay=.2,this.gain=.75}getNode(e){const t=e.createDelay(179);t.delayTime.value=this.delay;const i=e.createGain();return i.gain.value=this.gain,i.connect(t),t.connect(i),{input:i,output:t}}get order(){return 7}get id(){return Xt.FILTERS_NAMES.ECHO}getAddingTime(){return 5}getSettings(){return{delay:this.delay,gain:this.gain}}setSetting(e,t){if(!Vt.isSettingValueValid(t))return Promise.resolve();switch(e){case"delay":this.delay=parseFloat(t);break;case"gain":this.gain=parseFloat(t)}return Promise.resolve()}}class xi extends ni{constructor(){super(...arguments),this.highFrequency=3500}getNode(e){const t=e.createBiquadFilter();return t.type="highpass",t.frequency.value=this.highFrequency,{input:t,output:t}}get order(){return 4}get id(){return Xt.FILTERS_NAMES.HIGH_PASS}getSettings(){return{highFrequency:this.highFrequency}}setSetting(e,t){if(!Vt.isSettingValueValid(t))return Promise.resolve();if("highFrequency"===e)this.highFrequency=parseInt(t,10);return Promise.resolve()}}class ki{constructor(e){this._array=new Float32Array,this.n=0,this.length=0,this.readPointer=0,this.writePointer=0,this.n=Math.floor(e),this.init()}init(){this._array=new Float32Array(2*this.n),this.length=this._array.length,this.readPointer=0,this.writePointer=this.n-1,this._array.fill(0)}read(){const e=this._array[this.readPointer%this.length];return this.readPointer=(this.readPointer+1)%this.length,e}push(e){this._array[this.writePointer%this.length]=e,this.writePointer=(this.writePointer+1)%this.length}reset(){this.init()}clear(){this._array=new Float32Array,this.length=0,this.readPointer=0,this.writePointer=0}sum(){return this._array.reduce((e,t)=>e+t,0)}}class Li extends AudioWorkletProcessor{constructor(){super(),this.delayBuffer=[],this.envelopeSamples=[],this.stopped=!1,this.disabled=!1,this.port.onmessage=e=>{switch(e.data){case"reset":this.reset();break;case"stop":this.stop();break;case"disable":this.disabled=!0;break;case"enable":this.disabled=!1}}}static get parameterDescriptors(){return[{name:"preGain",defaultValue:0},{name:"postGain",defaultValue:0},{name:"attackTime",defaultValue:0},{name:"releaseTime",defaultValue:3},{name:"threshold",defaultValue:-.05},{name:"lookAheadTime",defaultValue:0}]}get defaultParameterDescriptors(){return Li.parameterDescriptors}process(e,t,i){if(this.stopped)return!1;const r=e[0],n=t[0],s=this.applyPreGainAndComputeEnvelope(r,n,i);return this.applyLimiter(r,n,i,s),!0}getEnvelope(e,t,i,r,n){const s=Math.exp(-1/(r*t)),o=Math.exp(-1/(r*i)),a=new Float32Array(e.length);null==this.envelopeSamples[n]&&(this.envelopeSamples[n]=0);for(let t=0;t<e.length;t++){const i=Math.abs(e[t]);this.envelopeSamples[n]<i?this.envelopeSamples[n]=i+s*(this.envelopeSamples[n]-i):this.envelopeSamples[n]=i+o*(this.envelopeSamples[n]-i),a[t]=this.envelopeSamples[n]}return a}getMaxEnvelope(e,t,i){let r=e[0][i];for(let n=0;n<t;n++)e[n][i]>r&&(r=e[n][i]);return r}ampToDB(e){return 20*Math.log10(e)}dBToAmp(e){return Math.pow(10,e/20)}applyPreGainAndComputeEnvelope(e,t,i){const r=this.dBToAmp(i.preGain[0]),n=[];for(let s=0;s<t.length;s++){const o=e[s],a=t[s];null==this.delayBuffer[s]&&(this.delayBuffer[s]=new ki(i.lookAheadTime[0]*sampleRate)),o&&a&&this.applyPreGain(o,a,r),!this.disabled&&a&&(n[s]=this.getEnvelope(a,i.attackTime[0],i.releaseTime[0],sampleRate,s))}return n}applyPreGain(e,t,i){for(let r=0;r<e.length;++r)this.disabled?t[r]=e[r]:t[r]=i*e[r]}applyLimiter(e,t,i,r){const n=this.dBToAmp(i.postGain[0]);for(let s=0;s<t.length;s++){const o=e[s],a=t[s];if(i.lookAheadTime[0]>0&&a&&this.applyLookAheadDelay(a,s),this.disabled)continue;const u=1;if(o&&a)for(let e=0;e<o.length;e++){let s=u*(i.threshold[0]-this.ampToDB(this.getMaxEnvelope(r,t.length,e)));s=Math.min(0,s);const o=this.dBToAmp(s);a[e]*=o*n}}}applyLookAheadDelay(e,t){for(let i=0;i<e.length;i++)this.delayBuffer[t].push(e[i]),e[i]=this.delayBuffer[t].read()}clearBuffers(){for(let e=0;e<this.delayBuffer.length;e++)null!=this.delayBuffer[e]&&this.delayBuffer[e].clear();this.delayBuffer=[],this.envelopeSamples=[]}reset(){this.clearBuffers()}stop(){this.clearBuffers(),this.stopped=!0}}registerProcessor(Xt.WORKLET_NAMES.LIMITER,Li);class Ui extends ci{constructor(){super(),this.preGain=0,this.postGain=0,this.attackTime=0,this.releaseTime=5,this.threshold=0,this.lookAheadTime=.35,this.keepCurrentNodeIfPossible=!0,this.setDefaultEnabled(!0)}receiveEvent(e){}get workletPath(){return Xt.WORKLET_PATHS.LIMITER}get workletName(){return Xt.WORKLET_NAMES.LIMITER}get order(){return 11}get id(){return Xt.FILTERS_NAMES.LIMITER}getAddingTime(){return this.lookAheadTime}getSettings(){return{preGain:this.preGain,postGain:this.postGain,attackTime:this.attackTime,releaseTime:this.releaseTime,threshold:this.threshold,lookAheadTime:this.lookAheadTime}}setSetting(e,t){if(!Vt.isSettingValueValid(t))return Promise.resolve();switch(e){case"preGain":this.preGain=parseFloat(t);break;case"postGain":this.postGain=parseFloat(t);break;case"attackTime":this.attackTime=parseFloat(t);break;case"releaseTime":this.releaseTime=parseFloat(t);break;case"threshold":this.threshold=parseFloat(t);break;case"lookAheadTime":this.lookAheadTime=parseFloat(t)}return this.applyCurrentSettingsToWorklet(),Promise.resolve()}}class Gi extends ni{constructor(){super(...arguments),this.lowFrequency=3500}getNode(e){const t=e.createBiquadFilter();return t.type="lowpass",t.frequency.value=this.lowFrequency,{input:t,output:t}}get order(){return 5}get id(){return Xt.FILTERS_NAMES.LOW_PASS}getSettings(){return{lowFrequency:this.lowFrequency}}setSetting(e,t){if(!Vt.isSettingValueValid(t))return Promise.resolve();if("lowFrequency"===e)this.lowFrequency=parseInt(t,10);return Promise.resolve()}}class Wi extends ni{constructor(){super(...arguments),this.reverbEnvironment=Xt.DEFAULT_REVERB_ENVIRONMENT,this.reverbCustomEnvironmentAddTime=5,this.customEnvironment=null}getNode(e){const t=e.createConvolver();this.reverbEnvironment&&("custom"!=this.reverbEnvironment.url||this.customEnvironment)||(this.reverbEnvironment=Xt.DEFAULT_REVERB_ENVIRONMENT);const i=this.getReverbBuffer(e);return i&&(t.buffer=i),{input:t,output:t}}getReverbBuffer(e){if("custom"==this.reverbEnvironment.url&&this.customEnvironment){if(this.customEnvironment.sampleRate===e.sampleRate)return this.customEnvironment;this.reverbEnvironment=Xt.DEFAULT_REVERB_ENVIRONMENT}else if(this.bufferFetcherService)return this.bufferFetcherService.getAudioBuffer(this.reverbEnvironment.url)}get order(){return 9}get id(){return Xt.FILTERS_NAMES.REVERB}getAddingTime(){const e=this.getSettings();if(e&&e.reverbEnvironment){if("custom"==e.reverbEnvironment.value)return this.reverbCustomEnvironmentAddTime;if(e.reverbEnvironment.additionalData)return e.reverbEnvironment.additionalData.addDuration}return 0}getSettings(){var e;return this.reverbEnvironment?{reverbEnvironment:{name:this.reverbEnvironment.name,value:this.reverbEnvironment.url,additionalData:{size:this.reverbEnvironment.size,link:this.reverbEnvironment.link,addDuration:this.reverbEnvironment.addDuration}},downloadedBuffers:null===(e=this.bufferFetcherService)||void 0===e?void 0:e.getDownloadedBuffersList(),hasCustomEnvironment:Boolean(this.customEnvironment),reverbCustomEnvironmentAddTime:this.reverbCustomEnvironmentAddTime}:{reverbCustomEnvironmentAddTime:this.reverbCustomEnvironmentAddTime}}setSetting(e,t){return r(this,void 0,void 0,function*(){var i;if("reverbEnvironment"==e){const e=t;if(e){const t=e.value;try{"custom"!=t&&(yield null===(i=this.bufferFetcherService)||void 0===i?void 0:i.fetchBuffer(t)),e.additionalData?this.reverbEnvironment={name:e.name,url:t,size:e.additionalData.size,addDuration:e.additionalData.addDuration,link:e.additionalData.link}:this.reverbEnvironment={name:e.name,url:t,size:0,addDuration:0,link:""}}catch(e){console.error(e)}}}else"reverbCustomEnvironmentAddTime"==e?Vt.isSettingValueValid(t)&&(this.reverbCustomEnvironmentAddTime=parseInt(t,10)):"reverbCustomEnvironmentFile"==e&&this.bufferDecoderService&&t&&(this.customEnvironment=yield this.bufferDecoderService.decodeBufferFromFile(t),this.customEnvironment||(this.reverbEnvironment=Xt.DEFAULT_REVERB_ENVIRONMENT))})}bufferFetcherReseted(){return r(this,void 0,void 0,function*(){var e;const t=this.getSettings();if(t){const i=null===(e=t.reverbEnvironment)||void 0===e?void 0:e.value;if(i&&"custom"!==i&&this.bufferFetcherService)return yield this.bufferFetcherService.fetchBuffer(i),!0}return!1})}}class Vi{constructor(){this._vector=new Float32Array,this._position=0,this._frameCount=0}get vector(){return this._vector}get position(){return this._position}get startIndex(){return 2*this._position}get frameCount(){return this._frameCount}get endIndex(){return 2*(this._position+this._frameCount)}clear(){this.receive(this._frameCount),this.rewind()}put(e){this._frameCount+=e}putSamples(e,t,i=0){const r=2*(t=t||0);i>=0||(i=(e.length-r)/2);const n=2*i;this.ensureCapacity(i+this._frameCount);const s=this.endIndex;this.vector.set(e.subarray(r,r+n),s),this._frameCount+=i}putBuffer(e,t,i=0){t=t||0,i>=0||(i=e.frameCount-t),this.putSamples(e.vector,e.position+t,i)}receive(e){e>=0&&!(e>this._frameCount)||(e=this.frameCount),this._frameCount-=e,this._position+=e}receiveSamples(e,t=0){const i=2*t,r=this.startIndex;e.set(this._vector.subarray(r,r+i)),this.receive(t)}extract(e,t=0,i=0){const r=this.startIndex+2*t,n=2*i;e.set(this._vector.subarray(r,r+n))}ensureCapacity(e=0){const t=parseInt(2*e);if(this._vector.length<t){const e=new Float32Array(t);e.set(this._vector.subarray(this.startIndex,this.endIndex)),this._vector=e,this._position=0}else this.rewind()}ensureAdditionalCapacity(e=0){this.ensureCapacity(this._frameCount+e)}rewind(){this._position>0&&(this._vector.set(this._vector.subarray(this.startIndex,this.endIndex)),this._position=0)}}class ji{constructor(e){e?(this._inputBuffer=new Vi,this._outputBuffer=new Vi):this._inputBuffer=this._outputBuffer=null}get inputBuffer(){return this._inputBuffer}set inputBuffer(e){this._inputBuffer=e}get outputBuffer(){return this._outputBuffer}set outputBuffer(e){this._outputBuffer=e}clear(){this._inputBuffer.clear(),this._outputBuffer.clear()}}class qi extends ji{constructor(e){super(e),this.reset(),this._rate=1}set rate(e){this._rate=e}reset(){this.slopeCount=0,this.prevSampleL=0,this.prevSampleR=0}clone(){const e=new qi;return e.rate=this._rate,e}process(){const e=this._inputBuffer.frameCount;this._outputBuffer.ensureAdditionalCapacity(e/this._rate+1);const t=this.transpose(e);this._inputBuffer.receive(),this._outputBuffer.put(t)}transpose(e=0){if(0===e)return 0;const t=this._inputBuffer.vector,i=this._inputBuffer.startIndex,r=this._outputBuffer.vector,n=this._outputBuffer.endIndex;let s=0,o=0;for(;this.slopeCount<1;)r[n+2*o]=(1-this.slopeCount)*this.prevSampleL+this.slopeCount*t[i],r[n+2*o+1]=(1-this.slopeCount)*this.prevSampleR+this.slopeCount*t[i+1],o+=1,this.slopeCount+=this._rate;if(this.slopeCount-=1,1!==e)e:for(;;){for(;this.slopeCount>1;)if(this.slopeCount-=1,s+=1,s>=e-1)break e;const a=i+2*s;r[n+2*o]=(1-this.slopeCount)*t[a]+this.slopeCount*t[a+2],r[n+2*o+1]=(1-this.slopeCount)*t[a+1]+this.slopeCount*t[a+3],o+=1,this.slopeCount+=this._rate}return this.prevSampleL=t[i+2*e-2],this.prevSampleR=t[i+2*e-1],o}}class Hi{constructor(e){this._pipe=e}get pipe(){return this._pipe}get inputBuffer(){return this._pipe.inputBuffer}get outputBuffer(){return this._pipe.outputBuffer}fillInputBuffer(){throw new Error("fillInputBuffer() not overridden")}fillOutputBuffer(e=0){for(;this.outputBuffer.frameCount<e;){const e=16384-this.inputBuffer.frameCount;if(this.fillInputBuffer(e),this.inputBuffer.frameCount<16384)break;this._pipe.process()}}clear(){this._pipe.clear()}}const Ki=function(){};class $i extends Hi{constructor(e,t,i=Ki){super(t),this.callback=i,this.sourceSound=e,this.historyBufferSize=22050,this._sourcePosition=0,this.outputBufferPosition=0,this._position=0}get position(){return this._position}set position(e){if(e>this._position)throw new RangeError("New position may not be greater than current position");const t=this.outputBufferPosition-(this._position-e);if(t<0)throw new RangeError("New position falls outside of history buffer");this.outputBufferPosition=t,this._position=e}get sourcePosition(){return this._sourcePosition}set sourcePosition(e){this.clear(),this._sourcePosition=e}onEnd(){this.callback()}fillInputBuffer(e=0){const t=new Float32Array(2*e),i=this.sourceSound.extract(t,e,this._sourcePosition);this._sourcePosition+=i,this.inputBuffer.putSamples(t,0,i)}extract(e,t=0){this.fillOutputBuffer(this.outputBufferPosition+t);const i=Math.min(t,this.outputBuffer.frameCount-this.outputBufferPosition);this.outputBuffer.extract(e,this.outputBufferPosition,i);const r=this.outputBufferPosition+i;return this.outputBufferPosition=Math.min(this.historyBufferSize,r),this.outputBuffer.receive(Math.max(r-this.historyBufferSize,0)),this._position+=i,i}handleSampleData(e){this.extract(e.data,4096)}clear(){super.clear(),this.outputBufferPosition=0}}const Yi=[[124,186,248,310,372,434,496,558,620,682,744,806,868,930,992,1054,1116,1178,1240,1302,1364,1426,1488,0],[-100,-75,-50,-25,25,50,75,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-20,-15,-10,-5,5,10,15,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-4,-3,-2,-1,1,2,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],zi=-10/3.75;class Xi extends ji{constructor(e){super(e),this._quickSeek=!0,this.midBufferDirty=!1,this.midBuffer=null,this.overlapLength=0,this.autoSeqSetting=!0,this.autoSeekSetting=!0,this._tempo=1,this.setParameters(44100,0,0,8)}clear(){super.clear(),this.clearMidBuffer()}clearMidBuffer(){this.midBufferDirty&&(this.midBufferDirty=!1,this.midBuffer=null)}setParameters(e,t,i,r){e>0&&(this.sampleRate=e),r>0&&(this.overlapMs=r),t>0?(this.sequenceMs=t,this.autoSeqSetting=!1):this.autoSeqSetting=!0,i>0?(this.seekWindowMs=i,this.autoSeekSetting=!1):this.autoSeekSetting=!0,this.calculateSequenceParameters(),this.calculateOverlapLength(this.overlapMs),this.tempo=this._tempo}set tempo(e){let t;this._tempo=e,this.calculateSequenceParameters(),this.nominalSkip=this._tempo*(this.seekWindowLength-this.overlapLength),this.skipFract=0,t=Math.floor(this.nominalSkip+.5),this.sampleReq=Math.max(t+this.overlapLength,this.seekWindowLength)+this.seekLength}get tempo(){return this._tempo}get inputChunkSize(){return this.sampleReq}get outputChunkSize(){return this.overlapLength+Math.max(0,this.seekWindowLength-2*this.overlapLength)}calculateOverlapLength(e=0){let t;t=this.sampleRate*e/1e3,t=t<16?16:t,t-=t%8,this.overlapLength=t,this.refMidBuffer=new Float32Array(2*this.overlapLength),this.midBuffer=new Float32Array(2*this.overlapLength)}checkLimits(e,t,i){return e<t?t:e>i?i:e}calculateSequenceParameters(){let e,t;this.autoSeqSetting&&(e=130+-20*this._tempo,e=this.checkLimits(e,50,125),this.sequenceMs=Math.floor(e+.5)),this.autoSeekSetting&&(t=25.666666666666668+zi*this._tempo,t=this.checkLimits(t,15,25),this.seekWindowMs=Math.floor(t+.5)),this.seekWindowLength=Math.floor(this.sampleRate*this.sequenceMs/1e3),this.seekLength=Math.floor(this.sampleRate*this.seekWindowMs/1e3)}set quickSeek(e){this._quickSeek=e}clone(){const e=new Xi;return e.tempo=this._tempo,e.setParameters(this.sampleRate,this.sequenceMs,this.seekWindowMs,this.overlapMs),e}seekBestOverlapPosition(){return this._quickSeek?this.seekBestOverlapPositionStereoQuick():this.seekBestOverlapPositionStereo()}seekBestOverlapPositionStereo(){let e,t,i,r=0;for(this.preCalculateCorrelationReferenceStereo(),e=0,t=Number.MIN_VALUE;r<this.seekLength;r+=1)i=this.calculateCrossCorrelationStereo(2*r,this.refMidBuffer),i>t&&(t=i,e=r);return e}seekBestOverlapPositionStereoQuick(){let e,t,i,r,n,s=0;for(this.preCalculateCorrelationReferenceStereo(),t=Number.MIN_VALUE,e=0,r=0,n=0;s<4;s+=1){let o=0;for(;Yi[s][o]&&(n=r+Yi[s][o],!(n>=this.seekLength));)i=this.calculateCrossCorrelationStereo(2*n,this.refMidBuffer),i>t&&(t=i,e=n),o+=1;r=e}return e}preCalculateCorrelationReferenceStereo(){let e,t,i=0;for(;i<this.overlapLength;i+=1)t=i*(this.overlapLength-i),e=2*i,this.refMidBuffer[e]=this.midBuffer[e]*t,this.refMidBuffer[e+1]=this.midBuffer[e+1]*t}calculateCrossCorrelationStereo(e,t){const i=this._inputBuffer.vector;e+=this._inputBuffer.startIndex;let r=0,n=2;const s=2*this.overlapLength;let o;for(;n<s;n+=2)o=n+e,r+=i[o]*t[n]+i[o+1]*t[n+1];return r}overlap(e){this.overlapStereo(2*e)}overlapStereo(e){const t=this._inputBuffer.vector;e+=this._inputBuffer.startIndex;const i=this._outputBuffer.vector,r=this._outputBuffer.endIndex;let n,s,o=0;const a=1/this.overlapLength;let u,c,l;for(;o<this.overlapLength;o+=1)s=(this.overlapLength-o)*a,u=o*a,n=2*o,c=n+e,l=n+r,i[l+0]=t[c+0]*u+this.midBuffer[n+0]*s,i[l+1]=t[c+1]*u+this.midBuffer[n+1]*s}process(){let e,t,i;if(null===this.midBuffer){if(this._inputBuffer.frameCount<this.overlapLength)return;this.midBuffer=new Float32Array(2*this.overlapLength),this._inputBuffer.receiveSamples(this.midBuffer,this.overlapLength)}for(;this._inputBuffer.frameCount>=this.sampleReq;){e=this.seekBestOverlapPosition(),this._outputBuffer.ensureAdditionalCapacity(this.overlapLength),this.overlap(Math.floor(e)),this._outputBuffer.put(this.overlapLength),t=this.seekWindowLength-2*this.overlapLength,t>0&&this._outputBuffer.putBuffer(this._inputBuffer,e+this.overlapLength,t);const r=this._inputBuffer.startIndex+2*(e+this.seekWindowLength-this.overlapLength);this.midBuffer.set(this._inputBuffer.vector.subarray(r,r+2*this.overlapLength)),this.skipFract+=this.nominalSkip,i=Math.floor(this.skipFract),this.skipFract-=i,this._inputBuffer.receive(i)}}}const Qi=function(e,t){return(e>t?e-t:t-e)>1e-10};class Zi{constructor(){this.transposer=new qi(!1),this.stretch=new Xi(!1),this._inputBuffer=new Vi,this._intermediateBuffer=new Vi,this._outputBuffer=new Vi,this._rate=0,this._tempo=0,this.virtualPitch=1,this.virtualRate=1,this.virtualTempo=1,this.calculateEffectiveRateAndTempo()}clear(){this.transposer.clear(),this.stretch.clear()}clone(){const e=new Zi;return e.rate=this.rate,e.tempo=this.tempo,e}get rate(){return this._rate}set rate(e){this.virtualRate=e,this.calculateEffectiveRateAndTempo()}set rateChange(e){this._rate=1+.01*e}get tempo(){return this._tempo}set tempo(e){this.virtualTempo=e,this.calculateEffectiveRateAndTempo()}set tempoChange(e){this.tempo=1+.01*e}set pitch(e){this.virtualPitch=e,this.calculateEffectiveRateAndTempo()}set pitchOctaves(e){this.pitch=Math.exp(.69314718056*e),this.calculateEffectiveRateAndTempo()}set pitchSemitones(e){this.pitchOctaves=e/12}get inputBuffer(){return this._inputBuffer}get outputBuffer(){return this._outputBuffer}calculateEffectiveRateAndTempo(){const e=this._tempo,t=this._rate;this._tempo=this.virtualTempo/this.virtualPitch,this._rate=this.virtualRate*this.virtualPitch,Qi(this._tempo,e)&&(this.stretch.tempo=this._tempo),Qi(this._rate,t)&&(this.transposer.rate=this._rate),this._rate>1?this._outputBuffer!=this.transposer.outputBuffer&&(this.stretch.inputBuffer=this._inputBuffer,this.stretch.outputBuffer=this._intermediateBuffer,this.transposer.inputBuffer=this._intermediateBuffer,this.transposer.outputBuffer=this._outputBuffer):this._outputBuffer!=this.stretch.outputBuffer&&(this.transposer.inputBuffer=this._inputBuffer,this.transposer.outputBuffer=this._intermediateBuffer,this.stretch.inputBuffer=this._intermediateBuffer,this.stretch.outputBuffer=this._outputBuffer)}process(){this._rate>1?(this.stretch.process(),this.transposer.process()):(this.transposer.process(),this.stretch.process())}}class Ji{constructor(e){this.buffer=e,this._position=0}get dualChannel(){return this.buffer.numberOfChannels>1}get position(){return this._position}set position(e){this._position=e}extract(e,t=0,i=0){this.position=i;let r=this.buffer.getChannelData(0),n=this.dualChannel?this.buffer.getChannelData(1):this.buffer.getChannelData(0),s=0;for(;s<t;s++)e[2*s]=r[s+i],e[2*s+1]=n[s+i];return Math.min(t,r.length-i)}}const er=function(e){const t=Math.floor(e/60);return`${t}:${function(e,t,i){return i=i||"0",(e+="").length>=t?e:new Array(t-e.length+1).join(i)+e}(parseInt(e-60*t),2)}`},tr=function(e){const t=this.timePlayed,i=this.sampleRate;if(this.sourcePosition=e,this.timePlayed=e/i,t!==this.timePlayed){const e=new CustomEvent("play",{detail:{timePlayed:this.timePlayed,formattedTimePlayed:this.formattedTimePlayed,percentagePlayed:this.percentagePlayed}});this._node.dispatchEvent(e)}};class ir{constructor(e,t,i,r=Ki){this._soundtouch=new Zi;const n=new Ji(t);this.timePlayed=0,this.sourcePosition=0,this._filter=new $i(n,this._soundtouch,r),this._node=function(e,t,i=Ki,r=4096){const n=e.createScriptProcessor(r,2,2),s=new Float32Array(2*r);return n.onaudioprocess=e=>{let n=e.outputBuffer.getChannelData(0),o=e.outputBuffer.getChannelData(1),a=t.extract(s,r);i(t.sourcePosition),0===a&&t.onEnd();let u=0;for(;u<a;u++)n[u]=s[2*u],o[u]=s[2*u+1]},n}(e,this._filter,e=>tr.call(this,e),i),this.tempo=1,this.rate=1,this.duration=t.duration,this.sampleRate=e.sampleRate,this.listeners=[]}get formattedDuration(){return er(this.duration)}get formattedTimePlayed(){return er(this.timePlayed)}get percentagePlayed(){return 100*this._filter.sourcePosition/(this.duration*this.sampleRate)}set percentagePlayed(e){this._filter.sourcePosition=parseInt(e*this.duration*this.sampleRate),this.sourcePosition=this._filter.sourcePosition,this.timePlayed=this.sourcePosition/this.sampleRate}get node(){return this._node}set pitch(e){this._soundtouch.pitch=e}set pitchSemitones(e){this._soundtouch.pitchSemitones=e}set rate(e){this._soundtouch.rate=e}set tempo(e){this._soundtouch.tempo=e}connect(e){this._node.connect(e)}disconnect(){this._node.disconnect()}on(e,t){this.listeners.push({name:e,cb:t}),this._node.addEventListener(e,e=>t(e.detail))}off(e=null){let t=this.listeners;e&&(t=t.filter(t=>t.name===e)),t.forEach(e=>{this._node.removeEventListener(e.name,t=>e.cb(t.detail))})}}class rr extends ci{constructor(){super(),this.speedAudio=Xt.SOUNDTOUCH_DEFAULT_SPEED,this.frequencyAudio=Xt.SOUNDTOUCH_DEFAULT_FREQUENCY,this.pitchSemitones=Xt.SOUNDTOUCH_DEFAULT_PITCH_SEMITONES,this.currentSpeedAudio=Xt.SOUNDTOUCH_DEFAULT_SPEED,this.currentBufferSource=null,this.isOfflineMode=!1,this.setDefaultEnabled(!0)}receiveEvent(e){}get workletPath(){return Xt.WORKLET_PATHS.SOUNDTOUCH}get workletName(){return Xt.WORKLET_NAMES.SOUNDTOUCH}getEntrypointNode(e,t,i){this.isOfflineMode=i,this.cleanUpOldNodes();const{isWorklet:r,renderWithSoundtouch:n}=this.getCurrentRenderingMode();if(n)return r&&Vt.isAudioWorkletCompatible(e)?this.renderWithWorklet(t,e):i?this.renderWithScriptProcessorNode(t,e):(this.currentPitchShifter=this.getSoundtouchScriptProcessorNode(t,e),this.updateState(),Promise.resolve({input:this.currentPitchShifter,output:this.currentPitchShifter}));const s=this.constructBufferSourceNode(e,t);return Promise.resolve({input:s,output:s})}getSoundtouchScriptProcessorNode(e,t){return new ir(t,e,Xt.SOUNDTOUCH_PITCH_SHIFTER_BUFFER_SIZE)}constructBufferSourceNode(e,t){const i=e.createBufferSource();return i.buffer=t,i.start(),this.currentBufferSource=i,i}cleanUpOldNodes(){this.currentPitchShifter&&(this.currentPitchShifter.disconnect(),this.currentPitchShifter._filter=null,this.currentPitchShifter=null),this.currentBufferSource&&(this.currentBufferSource.disconnect(),this.currentBufferSource=null)}renderWithScriptProcessorNode(e,t){return r(this,void 0,void 0,function*(){const i=Vt.calcAudioDuration(e,this.speedAudio);if(this.contextManager){const r=this.contextManager.createOfflineAudioContext(2,t.sampleRate*i,t.sampleRate);this.currentPitchShifter=this.getSoundtouchScriptProcessorNode(e,r),this.updateState(),this.currentPitchShifter.connect(r.destination);const n=yield r.startRendering(),s=this.constructBufferSourceNode(t,n);return this.currentPitchShifter.disconnect(),{input:s,output:s}}throw new Error("AudioContextManager is not available!")})}renderWithWorklet(e,t){try{const i=this.constructBufferSourceNode(t,e),r=this.getNode(t);return i.connect(r.input),this.updateState(),Promise.resolve({input:r.input,output:r.output})}catch(i){return console.error(i),this.renderWithScriptProcessorNode(e,t)}}get order(){return 2}get id(){return Xt.FILTERS_NAMES.SOUNDTOUCH}getSettings(){return{speedAudio:this.speedAudio,frequencyAudio:this.frequencyAudio,pitchSemitones:this.pitchSemitones}}isAudioWorkletEnabled(){return this.configService?this.configService.isSoundtouchAudioWorkletEnabled():Xt.ENABLE_SOUNDTOUCH_AUDIO_WORKLET}getCurrentRenderingMode(){const e=this.speedAudio==Xt.SOUNDTOUCH_DEFAULT_SPEED&&this.frequencyAudio==Xt.SOUNDTOUCH_DEFAULT_FREQUENCY&&this.pitchSemitones==Xt.SOUNDTOUCH_DEFAULT_PITCH_SEMITONES;return!this.isOfflineMode||this.isEnabled()&&!e?this.isAudioWorkletAvailable()?{isWorklet:!0,renderWithSoundtouch:!0}:{isWorklet:!1,renderWithSoundtouch:!0}:{isWorklet:!1,renderWithSoundtouch:!1}}updateState(){const{isWorklet:e,renderWithSoundtouch:t}=this.getCurrentRenderingMode();this.currentSpeedAudio=1;let i=1,r=1,n=0;t&&this.isEnabled()&&(r=this.speedAudio,n=this.pitchSemitones,i=e?this.frequencyAudio*(1/this.speedAudio):this.frequencyAudio,this.currentSpeedAudio=this.speedAudio),e?(this.setWorkletSetting("pitch",i),this.setWorkletSetting("pitchSemitones",n),this.currentBufferSource&&(this.currentBufferSource.playbackRate.value=r)):this.currentPitchShifter&&(this.currentPitchShifter.pitch=i*Math.pow(2,n/12),this.currentPitchShifter.tempo=r)}setSetting(e,t){if(!Vt.isSettingValueValid(t))return Promise.resolve();const i=parseFloat(t);switch(e){case"speedAudio":this.speedAudio=i;break;case"frequencyAudio":this.frequencyAudio=i;break;case"pitchSemitones":this.pitchSemitones=i}return this.updateState(),Promise.resolve()}setEnabled(e){super.setEnabled(e),this.updateState()}getSpeed(){return this.currentSpeedAudio}}class nr extends ni{getNode(e){const t=e.createBiquadFilter();t.type="lowpass",t.frequency.value=2e3;const i=e.createBiquadFilter();i.type="lowpass",i.frequency.value=2e3;const r=e.createBiquadFilter();r.type="highpass",r.frequency.value=500;const n=e.createBiquadFilter();return n.type="highpass",n.frequency.value=500,t.connect(i),i.connect(r),r.connect(n),{input:t,output:n}}get order(){return 7}get id(){return Xt.FILTERS_NAMES.TELEPHONIZER}getSettings(){return{}}setSetting(e,t){return r(this,void 0,void 0,function*(){})}}class sr{constructor(e,t,i){this.FILTER_QUALITY=6,this.FOURIER_SIZE=4096,this.WAVETABLEBOOST=40,this.SAWTOOTHBOOST=.4,this.oscillatorType=4,this.oscillatorDetuneValue=0,this.audioContext=null,this.carrierBuffer=null,this.modulatorNode=null,this.vocoding=!1,this.modulatorInput=null,this.carrierInput=null,this.modulatorGain=null,this.modulatorGainValue=1,this.noiseBuffer=null,this.noiseNode=null,this.noiseGain=null,this.noiseGainValue=.2,this.carrierSampleNode=null,this.carrierSampleGain=null,this.carrierSampleGainValue=0,this.oscillatorNode=null,this.oscillatorGain=null,this.oscillatorGainValue=1,this.wavetable=null,this.wavetableSignalGain=null,this.modFilterBands=null,this.modFilterPostGains=null,this.heterodynes=null,this.powers=null,this.lpFilters=null,this.lpFilterPostGains=null,this.carrierBands=null,this.carrierFilterPostGains=null,this.carrierBandGains=null,this.vocoderBands=null,this.numVocoderBands=0,this.hpFilterGain=null,this.outputGain=null,this.audioContext=e,this.carrierBuffer=t,this.modulatorBuffer=i}init(){this.generateVocoderBands(55,7040,28),this.setupVocoderGraph(),this.vocode()}getNodes(){return{modulatorNode:this.modulatorNode,modulatorGain:this.modulatorGain,synthLevel:this.oscillatorGain,noiseNode:this.noiseGain,oscillatorNode:this.oscillatorNode,hpFilterGain:this.hpFilterGain,outputGain:this.outputGain}}shutOffCarrier(){this.oscillatorNode&&this.noiseNode&&this.carrierSampleNode&&(this.oscillatorNode.stop(0),this.oscillatorNode=null,this.noiseNode.stop(0),this.noiseNode=null,this.carrierSampleNode.stop(0),this.carrierSampleNode=null)}selectSawtooth(){this.wavetableSignalGain&&(this.wavetableSignalGain.gain.value=this.SAWTOOTHBOOST),this.oscillatorNode&&(this.oscillatorNode.type="sawtooth")}selectWavetable(){this.wavetableSignalGain&&(this.wavetableSignalGain.gain.value=this.WAVETABLEBOOST),this.oscillatorNode&&this.wavetable&&this.oscillatorNode.setPeriodicWave(this.wavetable),this.wavetableSignalGain&&(this.wavetableSignalGain.gain.value=this.WAVETABLEBOOST)}updateModGain(e){this.modulatorGainValue=e,this.modulatorGain&&(this.modulatorGain.gain.value=e)}updateSampleLevel(e){this.carrierSampleGainValue=e,this.carrierSampleGain&&(this.carrierSampleGain.gain.value=e)}updateSynthLevel(e){this.oscillatorGainValue=e,this.oscillatorGain&&(this.oscillatorGain.gain.value=e)}updateNoiseLevel(e){this.noiseGainValue=e,this.noiseGain&&(this.noiseGain.gain.value=e)}updateDetuneValue(e){this.oscillatorDetuneValue=e,this.oscillatorNode&&(this.oscillatorNode.detune.value=e)}generateVocoderBands(e,t,i){const r=1200*Math.log(t/e)/Math.LN2/i,n=Math.pow(2,r/1200);this.vocoderBands=[];let s=e;for(let e=0;e<i;e++)this.vocoderBands[e]={frequency:s},s*=n;this.numVocoderBands=i}loadNoiseBuffer(){if(!this.audioContext)return;const e=5*this.audioContext.sampleRate;this.noiseBuffer=this.audioContext.createBuffer(1,e,this.audioContext.sampleRate);const t=this.noiseBuffer.getChannelData(0);for(let i=0;i<e;++i)t[i]=2*Math.random()-1}initBandpassFilters(){if(!this.audioContext)return;this.modulatorInput=this.audioContext.createGain(),this.carrierInput=this.audioContext.createGain(),null==this.modFilterBands&&(this.modFilterBands=[]),null==this.modFilterPostGains&&(this.modFilterPostGains=[]),null==this.heterodynes&&(this.heterodynes=[]),null==this.powers&&(this.powers=[]),null==this.lpFilters&&(this.lpFilters=[]),null==this.lpFilterPostGains&&(this.lpFilterPostGains=[]),null==this.carrierBands&&(this.carrierBands=[]),null==this.carrierFilterPostGains&&(this.carrierFilterPostGains=[]),null==this.carrierBandGains&&(this.carrierBandGains=[]);const e=new Float32Array(65536),t=32768;let i;for(let r=0;r<t;++r)i=r/t,e[t+r]=i,e[t-r-1]=i;const r=this.audioContext.createBiquadFilter();r.type="highpass",r.frequency.value=8e3,r.Q.value=1,this.modulatorInput.connect(r),this.hpFilterGain=this.audioContext.createGain(),this.hpFilterGain.gain.value=0,r.connect(this.hpFilterGain),this.modulatorBuffer&&this.hpFilterGain.connect(this.audioContext.destination),this.modFilterBands.length=0,this.modFilterPostGains.length=0,this.heterodynes.length=0,this.powers.length=0,this.lpFilters.length=0,this.lpFilterPostGains.length=0,this.carrierBands.length=0,this.carrierFilterPostGains.length=0,this.carrierBandGains.length=0,this.outputGain=this.audioContext.createGain(),this.modulatorBuffer&&this.outputGain.connect(this.audioContext.destination);const n=new Float32Array(65536);for(let e=-32768;e<32768;e++)n[e+32768]=(e>0?e:-e)/32768;for(let t=0;t<this.numVocoderBands;t++){const i=this.audioContext.createBiquadFilter();i.type="bandpass",this.vocoderBands&&(i.frequency.value=this.vocoderBands[t].frequency),i.Q.value=this.FILTER_QUALITY,this.modulatorInput.connect(i),this.modFilterBands.push(i);const r=this.audioContext.createBiquadFilter();r.type="bandpass",this.vocoderBands&&(r.frequency.value=this.vocoderBands[t].frequency),r.Q.value=this.FILTER_QUALITY,i.connect(r);const s=this.audioContext.createGain();s.gain.value=6,r.connect(s),this.modFilterPostGains.push(s);const o=this.audioContext.createOscillator();this.vocoderBands&&(o.frequency.value=this.vocoderBands[t].frequency),o.start(0);const a=this.audioContext.createGain();s.connect(a),a.gain.value=0,o.connect(a.gain);const u=this.audioContext.createGain();u.gain.value=2,a.connect(u),this.heterodynes.push(u);const c=this.audioContext.createWaveShaper();c.curve=n,u.connect(c);const l=this.audioContext.createBiquadFilter();l.type="lowpass",l.frequency.value=5,l.Q.value=1,this.lpFilters.push(l),c.connect(l);const h=this.audioContext.createGain();h.gain.value=1,l.connect(h),this.lpFilterPostGains.push(h);const d=this.audioContext.createWaveShaper();d.curve=e,h.connect(d);const f=this.audioContext.createBiquadFilter();f.type="bandpass",this.vocoderBands&&(f.frequency.value=this.vocoderBands[t].frequency),f.Q.value=this.FILTER_QUALITY,this.carrierBands.push(f),this.carrierInput.connect(f);const p=this.audioContext.createBiquadFilter();p.type="bandpass",this.vocoderBands&&(p.frequency.value=this.vocoderBands[t].frequency),p.Q.value=this.FILTER_QUALITY,f.connect(p);const v=this.audioContext.createGain();v.gain.value=10,p.connect(v),this.carrierFilterPostGains.push(v);const g=this.audioContext.createGain();this.carrierBandGains.push(g),v.connect(g),g.gain.value=0,d.connect(g.gain),g.connect(this.outputGain)}const s=new Float32Array(this.FOURIER_SIZE),o=new Float32Array(this.FOURIER_SIZE);s[0]=0,o[0]=0;for(let e=1;e<this.FOURIER_SIZE;e++)s[e]=1,o[e]=1;this.wavetable=this.audioContext.createPeriodicWave(s,o),this.loadNoiseBuffer()}setupVocoderGraph(){this.initBandpassFilters()}createCarriersAndPlay(e){this.audioContext&&e&&(this.carrierSampleNode=this.audioContext.createBufferSource(),this.carrierSampleNode.buffer=this.carrierBuffer,this.carrierSampleNode.loop=!0,this.carrierSampleGain=this.audioContext.createGain(),this.carrierSampleGain.gain.value=this.carrierSampleGainValue,this.carrierSampleNode.connect(this.carrierSampleGain),this.carrierSampleGain.connect(e),this.wavetableSignalGain=this.audioContext.createGain(),this.oscillatorNode=this.audioContext.createOscillator(),4==this.oscillatorType&&this.wavetable?(this.oscillatorNode.setPeriodicWave(this.wavetable),this.wavetableSignalGain.gain.value=this.WAVETABLEBOOST):this.wavetableSignalGain.gain.value=this.SAWTOOTHBOOST,this.oscillatorNode.frequency.value=110,this.oscillatorNode.detune.value=this.oscillatorDetuneValue,this.oscillatorNode.connect(this.wavetableSignalGain),this.oscillatorGain=this.audioContext.createGain(),this.oscillatorGain.gain.value=this.oscillatorGainValue,this.wavetableSignalGain.connect(this.oscillatorGain),this.oscillatorGain.connect(e),this.noiseNode=this.audioContext.createBufferSource(),this.noiseNode.buffer=this.noiseBuffer,this.noiseNode.loop=!0,this.noiseGain=this.audioContext.createGain(),this.noiseGain.gain.value=this.noiseGainValue,this.noiseNode.connect(this.noiseGain),this.noiseGain.connect(e),this.oscillatorNode.start(0),this.noiseNode.start(0),this.carrierSampleNode.start(0))}vocode(){if(this.audioContext){if(this.vocoding)return this.modulatorNode&&this.modulatorNode.stop(0),this.shutOffCarrier(),void(this.vocoding=!1);this.createCarriersAndPlay(this.carrierInput),this.vocoding=!0,this.modulatorGain=this.audioContext.createGain(),this.modulatorGain.gain.value=this.modulatorGainValue,this.modulatorBuffer&&(this.modulatorNode=this.audioContext.createBufferSource(),this.modulatorNode.buffer=this.modulatorBuffer,this.modulatorNode.connect(this.modulatorGain),this.modulatorNode.start(0)),this.modulatorInput&&this.modulatorGain.connect(this.modulatorInput)}}}class or extends ni{constructor(){super(...arguments),this.currentVocoder=null,this.modulatorGainValue=1,this.carrierSampleGainValue=0,this.oscillatorGainValue=1,this.noiseGainValue=.2,this.oscillatorDetuneValue=0}getNode(e){var t;const i=null===(t=this.bufferFetcherService)||void 0===t?void 0:t.getAudioBuffer(Xt.VOCODER_MODULATOR);this.currentVocoder=new sr(e,i),this.currentVocoder.init(),this.applyCurrentSettingsToVocoder();const{modulatorGain:r,outputGain:n}=this.currentVocoder.getNodes();return{input:r,output:n}}getSettings(){return{modulatorGainValue:this.modulatorGainValue,carrierSampleGainValue:this.carrierSampleGainValue,oscillatorGainValue:this.oscillatorGainValue,noiseGainValue:this.noiseGainValue,oscillatorDetuneValue:this.oscillatorDetuneValue}}setSetting(e,t){if(!Vt.isSettingValueValid(t))return Promise.resolve();switch(e){case"modulatorGainValue":this.modulatorGainValue=parseFloat(t);break;case"carrierSampleGainValue":this.carrierSampleGainValue=parseFloat(t);break;case"oscillatorGainValue":this.oscillatorGainValue=parseFloat(t);break;case"noiseGainValue":this.noiseGainValue=parseFloat(t);break;case"oscillatorDetuneValue":this.oscillatorDetuneValue=parseFloat(t)}return this.applyCurrentSettingsToVocoder(),Promise.resolve()}applyCurrentSettingsToVocoder(){this.currentVocoder&&(this.currentVocoder.updateModGain(this.modulatorGainValue),this.currentVocoder.updateSampleLevel(this.carrierSampleGainValue),this.currentVocoder.updateSynthLevel(this.oscillatorGainValue),this.currentVocoder.updateNoiseLevel(this.noiseGainValue),this.currentVocoder.updateDetuneValue(this.oscillatorDetuneValue))}get order(){return 1}get id(){return Xt.FILTERS_NAMES.VOCODER}}class ar extends AudioWorkletProcessor{constructor(){super(),this.stopped=!1,this.disabled=!1,this.samplesCount=0,this.port.onmessage=e=>{switch(e.data){case"stop":this.stop();break;case"disable":this.disabled=!0;break;case"enable":this.disabled=!1}}}static get parameterDescriptors(){return[]}get defaultParameterDescriptors(){return ar.parameterDescriptors}process(e,t){if(this.stopped||this.disabled)return!1;const i=e[0],r=t[0];if(i&&i[0]&&(this.samplesCount+=i[0].length),r){for(let e=0;e<r.length;e++){const t=i[e],n=r[e];if(t)for(let e=0;e<t.length;e++)n[e]=t[e]}this.port.postMessage({command:"update",samplesCount:this.samplesCount})}return!0}stop(){this.stopped=!0}}registerProcessor(Xt.WORKLET_NAMES.RENDERING_PROGRESS_CALCULATION,ar);class ur extends ci{constructor(){super(...arguments),this.currentTime=0,this.lastSampleCount=0,this.samplePerSecond=0,this.currentTimeSamplesPerSecond=0}receiveEvent(e){const t=performance.now(),i=e.data.samplesCount;"update"===e.data.command&&this.calculatePercentageProcessed(t,i),this.calculateRemainingTimeProcessing(t,i)}calculatePercentageProcessed(e,t){0===this.currentTime&&(this.currentTime=e);const i=e-this.currentTime,r=t/this._totalSamples*100;this.eventEmitter&&i>=Xt.TREATMENT_TIME_COUNTING_THROTTLE_INTERVAL&&(this.eventEmitter.emit(exports.EventType.UPDATE_AUDIO_TREATMENT_PERCENT,r),this.currentTime=e),r>=100&&this.stop()}calculateRemainingTimeProcessing(e,t){0===this.currentTimeSamplesPerSecond&&(this.currentTimeSamplesPerSecond=e);const i=e-this.currentTimeSamplesPerSecond,r=this._totalSamples-t;if(this.eventEmitter&&r<=0)this.eventEmitter.emit(exports.EventType.UPDATE_REMAINING_TIME_ESTIMATED,0);else if(this.eventEmitter&&i>=1e3){this.calculateSmoothedSamplePerSecond(i,t);const n=r/this.samplePerSecond;this.currentTimeSamplesPerSecond=e,this.lastSampleCount=t,isNaN(n)||!isFinite(n)?this.eventEmitter.emit(exports.EventType.UPDATE_REMAINING_TIME_ESTIMATED,-1):this.eventEmitter.emit(exports.EventType.UPDATE_REMAINING_TIME_ESTIMATED,n)}}calculateSmoothedSamplePerSecond(e,t){if(e>0){const i=(t-this.lastSampleCount)/(e/1e3);this.samplePerSecond=Xt.TREATMENT_TIME_COUNTING_SMOOTHING_FACTOR*i+(1-Xt.TREATMENT_TIME_COUNTING_SMOOTHING_FACTOR)*this.samplePerSecond}}get workletName(){return Xt.WORKLET_NAMES.RENDERING_PROGRESS_CALCULATION}get workletPath(){return Xt.WORKLET_PATHS.RENDERING_PROGRESS_CALCULATION}get order(){return 10}get id(){return Xt.FILTERS_NAMES.RENDERING_PROGRESS_CALCULATION}set totalSamples(e){super.totalSamples=e,this.currentTime=0,this.currentTimeSamplesPerSecond=0,this.samplePerSecond=0,this.lastSampleCount=0}getSettings(){return{}}setSetting(e,t){return r(this,void 0,void 0,function*(){})}}class cr{static createNewInstance(e){try{const t=function(){const e=new Lt({defaultScope:"Singleton"});return e.bind(Ut.EntryPointFilter).to(rr),e.bind(Ut.Renderers).to(Pi),e.bind(Ut.Filters).toDynamicValue(()=>e.get(Ut.EntryPointFilter)),e.bind(Ut.Filters).to(Ni),e.bind(Ut.Filters).to(Di),e.bind(Ut.Filters).to(Fi),e.bind(Ut.Filters).to(xi),e.bind(Ut.Filters).to(Ui),e.bind(Ut.Filters).to(Gi),e.bind(Ut.Filters).to(Wi),e.bind(Ut.Filters).to(nr),e.bind(Ut.Filters).to(or),e.bind(Ut.Filters).to(ur),e.bind(Ut.EventEmitter).to(di),e.bind(Ut.AudioContextManager).to(gi),e.bind(Ut.AudioEditor).to(Ht),e.bind(Ut.AudioProcessor).to(Ei),e.bind(Ut.BufferManager).to(Si),e.bind(Ut.FilterManager).to(Ai),e.bind(Ut.RendererManager).to(Ri),e.bind(Ut.SaveBufferManager).to(Ii),e.bind(Ut.BufferPlayer).to($t),e.bind(Ut.BufferFetcherService).to(Ti),e.bind(Ut.BufferDecoderService).to(Mi),e.bind(Ut.VoiceRecorder).to(ti),e}();return e&&e.configService?t.bind(Ut.ConfigService).toDynamicValue(()=>e.configService):(t.bind(Ut.ConfigService).to(pi),console.warn("No ConfigService provided. Using default generic implementation.")),t.bind(Ut.AudioBuffersToFetch).toConstantValue(e&&e.buffersToFetch||[]),{audioEditor:t.get(Ut.AudioEditor),audioPlayer:t.get(Ut.BufferPlayer),configService:t.get(Ut.ConfigService),eventEmitter:t.get(Ut.EventEmitter),voiceRecorder:t.get(Ut.VoiceRecorder)}}catch(e){throw console.error("Error when creating new Sound Studio instance\n",e),new Error("Error when creating new Sound Studio instance")}}static createAudioEditor(e,t){if(console.warn("[DEPRECATED] SoundStudioFactory.createAudioEditor is deprecated and will be removed in a future release of simple-sound-studio-lib. Please use SoundStudioFactory.createNewInstance instead, which doesn't work as a singleton."),!cr.ready){const i=cr.createNewInstance({configService:e,buffersToFetch:t});cr.audioEditor=i.audioEditor,cr.audioPlayer=i.audioPlayer,cr.configService=i.configService,cr.eventEmitter=i.eventEmitter,cr.voiceRecorder=i.voiceRecorder,cr.ready=!0}return cr.audioEditor}static createVoiceRecorder(){return console.warn("[DEPRECATED] SoundStudioFactory.createVoiceRecorder is deprecated and will be removed in a future release of simple-sound-studio-lib. Please use SoundStudioFactory.createNewInstance instead, which doesn't work as a singleton."),cr.voiceRecorder}static getAudioEditorInstance(){return console.warn("[DEPRECATED] SoundStudioFactory.getAudioEditorInstance is deprecated and will be removed in a future release of simple-sound-studio-lib. Please use SoundStudioFactory.createNewInstance instead, which doesn't work as a singleton."),cr.audioEditor}static getAudioPlayerInstance(){return console.warn("[DEPRECATED] SoundStudioFactory.getAudioPlayerInstance is deprecated and will be removed in a future release of simple-sound-studio-lib. Please use SoundStudioFactory.createNewInstance instead, which doesn't work as a singleton."),cr.audioPlayer}static getAudioRecorderInstance(){return console.warn("[DEPRECATED] SoundStudioFactory.getAudioRecorderInstance is deprecated and will be removed in a future release of simple-sound-studio-lib. Please use SoundStudioFactory.createNewInstance instead, which doesn't work as a singleton."),cr.voiceRecorder}static getEventEmitterInstance(){return console.warn("[DEPRECATED] SoundStudioFactory.getEventEmitterInstance is deprecated and will be removed in a future release of simple-sound-studio-lib. Please use SoundStudioFactory.createNewInstance instead, which doesn't work as a singleton."),cr.eventEmitter}static getConfigServiceInstance(){return console.warn("[DEPRECATED] SoundStudioFactory.getConfigServiceInstance is deprecated and will be removed in a future release of simple-sound-studio-lib. Please use SoundStudioFactory.createNewInstance instead, which doesn't work as a singleton."),cr.configService}}cr.ready=!1,cr.audioEditor=null,cr.audioPlayer=null,cr.configService=null,cr.eventEmitter=null,cr.voiceRecorder=null,exports.AbstractAudioElement=Wt,exports.AbstractAudioFilter=ni,exports.AbstractAudioFilterWorklet=ci,exports.AbstractAudioNode=ri,exports.AbstractAudioRenderer=li,exports.AudioEditor=Ht,exports.BufferPlayer=$t,exports.Constants=Xt,exports.EventEmitter=di,exports.FilterNames=zt,exports.GenericConfigService=pi,exports.SoundStudioFactory=cr,exports.UtilFunctions=Vt,exports.VoiceRecorder=ti;
//# sourceMappingURL=SimpleSoundStudioLibrary.js.map
